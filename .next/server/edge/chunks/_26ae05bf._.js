(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["chunks/_26ae05bf._.js",662382,e=>{"use strict";let t=new class{isDevelopment=!1;isProduction=!0;sentryEnabled=!0;initSentry(){this.sentryEnabled}constructor(){this.sentryEnabled&&this.initSentry()}error(t,n,r){let a={message:t,error:n instanceof Error?{name:n.name,message:n.message,stack:n.stack}:n,context:r,timestamp:new Date().toISOString(),level:"error"};this.isProduction&&this.sentryEnabled,this.isProduction&&t.includes("[CRITICAL]")&&Promise.resolve().then(()=>e.i(556268)).then(({alertService:e})=>{let s=n instanceof Error?n:Error(t);e.sendCriticalError(s,{context:r,timestamp:a.timestamp}).catch(e=>{this.isDevelopment&&console.error("Failed to send critical alert:",e)})}).catch(()=>{}),(this.isDevelopment||!this.isProduction)&&console.error("âŒ [ERROR]",t,{error:n,context:r,timestamp:a.timestamp})}warn(e,t){let n={message:e,context:t,timestamp:new Date().toISOString(),level:"warn"};this.isDevelopment&&console.warn("âš ï¸ [WARN]",e,{context:t,timestamp:n.timestamp})}info(e,t){let n={message:e,context:t,timestamp:new Date().toISOString(),level:"info"};this.isDevelopment&&console.info("â„¹ï¸ [INFO]",e,{context:t,timestamp:n.timestamp})}debug(e,t){this.isDevelopment&&console.debug("ðŸ› [DEBUG]",e,{context:t,timestamp:new Date().toISOString()})}apiError(e,t,n){this.error(`API Error: ${e}`,t,{...n,endpoint:e})}mutationError(e,t,n){this.error(`Mutation Error: ${e}`,t,{...n,mutationName:e})}queryError(e,t,n){this.error(`Query Error: ${e}`,t,{...n,queryKey:e})}};function n(e){return e?{message:e.message,code:e.code,name:e.name,...{}}:{}}e.s(["logger",0,t,"sanitizeError",()=>n])},538022,(e,t,n)=>{self._ENTRIES||={};let r=Promise.resolve().then(()=>e.i(242738));r.catch(()=>{}),self._ENTRIES.middleware_middleware=new Proxy(r,{get(e,t){if("then"===t)return(t,n)=>e.then(t,n);let n=(...n)=>e.then(e=>(0,e[t])(...n));return n.then=(n,r)=>e.then(e=>e[t]).then(n,r),n}})},50929,e=>{e.v({common:{welcome:"Welcome",dashboard:"Dashboard",students:"Students",programs:"Programs",sessions:"Sessions",formations:"Formations",payments:"Payments",attendance:"Attendance",messages:"Messages",settings:"Settings",logout:"Logout",save:"Save",cancel:"Cancel",delete:"Delete",edit:"Edit",create:"Create",search:"Search",loading:"Loading...",error:"Error",success:"Success",confirm:"Confirm",close:"Close",back:"Back",next:"Next",previous:"Previous",actions:"Actions",filter:"Filter",export:"Export",import:"Import",view:"View",download:"Download",upload:"Upload",refresh:"Refresh",noData:"No data available",noResults:"No results found"},navigation:{main:"Main",pedagogy:"Pedagogy",finance:"Finance",documents:"Documents",admin:"Administration",calendar:"Calendar",recommendations:"Recommendations",reports:"Reports",evaluations:"Evaluations",health:"Health",help:"Help",management:"Management",compliance:"Compliance",helpCenter:"Help Center",myStudents:"My Students",resources:"Resources",tracking:"Tracking",learningPortfolios:"Learning Portfolios",systemHealth:"System Health",exportHistory:"Export History",finances:"Finances",financialReports:"Financial Reports",qualityRegulation:"Quality & Regulation",qualiopi:"Qualiopi",cpf:"CPF",opco:"OPCO",gdpr:"GDPR",accessibility:"Accessibility",videoTutorials:"Video Tutorials",documentation:"Documentation",knowledgeBase:"Knowledge Base",support:"Support",elearning:"E-learning"},dashboard:{title:"Dashboard",totalStudents:"Total students",totalRevenue:"Total revenue",attendanceRate:"Attendance rate",pendingPayments:"Pending payments",monthlyRevenue:"Monthly revenue",revenueEvolution:"Revenue evolution",recentActivity:"Recent activity",quickActions:"Quick actions"},students:{title:"Students",newStudent:"New student",studentNumber:"Student number",firstName:"First name",lastName:"Last name",fullName:"Full name",email:"Email",phone:"Phone",guardian:"Guardian",enrollment:"Enrollment",status:"Status",active:"Active",inactive:"Inactive",graduated:"Graduated",suspended:"Suspended"},programs:{title:"Programs",newProgram:"New program",name:"Name",description:"Description",duration:"Duration",totalFormations:"Number of formations"},sessions:{title:"Sessions",newSession:"New session",name:"Name",startDate:"Start date",endDate:"End date",status:"Status",active:"Active",completed:"Completed",upcoming:"Upcoming"},formations:{title:"Formations",newFormation:"New formation",name:"Name",code:"Code",program:"Program",duration:"Duration"},payments:{title:"Payments",newInvoice:"New invoice",amount:"Amount",currency:"Currency",status:"Status",dueDate:"Due date",issueDate:"Issue date",paid:"Paid",pending:"Pending",overdue:"Overdue",draft:"Draft",cancelled:"Cancelled",paymentMethod:"Payment method",transactionId:"Transaction ID",notes:"Notes",currencyConverter:"Currency Converter",from:"From",to:"To",convert:"Convert",converting:"Converting...",convertedAmount:"Converted amount"},attendance:{title:"Attendance",recordAttendance:"Record attendance",present:"Present",absent:"Absent",late:"Late",excused:"Excused",date:"Date",class:"Class",student:"Student",attendanceRate:"Attendance rate",history:"History"},messages:{title:"Messages",newConversation:"New conversation",newMessage:"New message",send:"Send",reply:"Reply",conversations:"Conversations",noConversations:"No conversations",typeMessage:"Type a message...",attachments:"Attachments",selectFile:"Select a file"},notifications:{title:"Notifications",markAsRead:"Mark as read",markAllAsRead:"Mark all as read",delete:"Delete",noNotifications:"No notifications",all:"All",unread:"Unread"},settings:{title:"Settings",organization:"Organization",profile:"Profile",security:"Security",notifications:"Notifications",appearance:"Appearance",language:"Language",theme:"Theme",light:"Light",dark:"Dark",system:"System"},auth:{login:"Login",logout:"Logout",register:"Register",email:"Email",password:"Password",forgotPassword:"Forgot password?",rememberMe:"Remember me",signIn:"Sign in",signUp:"Sign up"},errors:{generic:"An error occurred",notFound:"Page not found",unauthorized:"Unauthorized",forbidden:"Access forbidden",serverError:"Server error",networkError:"Network error",validationError:"Validation error"},success:{saved:"Saved successfully",deleted:"Deleted successfully",created:"Created successfully",updated:"Updated successfully",sent:"Sent successfully"}})},956036,e=>{e.v({common:{welcome:"Bienvenue",dashboard:"Tableau de bord",students:"Ã‰tudiants",programs:"Programmes",sessions:"Sessions",formations:"Formations",payments:"Paiements",attendance:"PrÃ©sence",messages:"Messages",settings:"ParamÃ¨tres",logout:"DÃ©connexion",save:"Enregistrer",cancel:"Annuler",delete:"Supprimer",edit:"Modifier",create:"CrÃ©er",search:"Rechercher",loading:"Chargement...",error:"Erreur",success:"SuccÃ¨s",confirm:"Confirmer",close:"Fermer",back:"Retour",next:"Suivant",previous:"PrÃ©cÃ©dent",actions:"Actions",filter:"Filtrer",export:"Exporter",import:"Importer",view:"Voir",download:"TÃ©lÃ©charger",upload:"TÃ©lÃ©verser",refresh:"Actualiser",noData:"Aucune donnÃ©e disponible",noResults:"Aucun rÃ©sultat trouvÃ©"},navigation:{main:"Principal",pedagogy:"PÃ©dagogie",finance:"Finance",documents:"Documents",admin:"Administration",calendar:"Calendrier",recommendations:"Recommandations",reports:"Rapports",evaluations:"Ã‰valuations",health:"SantÃ©",help:"Aide",management:"Gestion",compliance:"ConformitÃ©",helpCenter:"Centre d'aide",myStudents:"Mes apprenants",resources:"Ressources",tracking:"Suivi",learningPortfolios:"Livrets d'apprentissage",systemHealth:"SantÃ© systÃ¨me",exportHistory:"Historique exports",finances:"Finances",financialReports:"Rapports financiers",qualityRegulation:"QualitÃ© & RÃ©glementation",qualiopi:"Qualiopi",cpf:"CPF",opco:"OPCO",gdpr:"RGPD",accessibility:"AccessibilitÃ© Handicap",videoTutorials:"Tutoriels vidÃ©o",documentation:"Documentation",knowledgeBase:"Base de connaissances",support:"Support",elearning:"E-learning"},dashboard:{title:"Tableau de bord",totalStudents:"Total Ã©tudiants",totalRevenue:"Revenus totaux",attendanceRate:"Taux de prÃ©sence",pendingPayments:"Paiements en attente",monthlyRevenue:"Revenus du mois",revenueEvolution:"Ã‰volution des revenus",recentActivity:"ActivitÃ© rÃ©cente",quickActions:"Actions rapides"},students:{title:"Ã‰tudiants",newStudent:"Nouvel Ã©tudiant",studentNumber:"NumÃ©ro Ã©tudiant",firstName:"PrÃ©nom",lastName:"Nom",fullName:"Nom complet",email:"Email",phone:"TÃ©lÃ©phone",guardian:"Tuteur",enrollment:"Inscription",status:"Statut",active:"Actif",inactive:"Inactif",graduated:"DiplÃ´mÃ©",suspended:"Suspendu"},programs:{title:"Programmes",newProgram:"Nouveau programme",name:"Nom",description:"Description",duration:"DurÃ©e",totalFormations:"Nombre de formations"},sessions:{title:"Sessions",newSession:"Nouvelle session",name:"Nom",startDate:"Date de dÃ©but",endDate:"Date de fin",status:"Statut",active:"Active",completed:"TerminÃ©e",upcoming:"Ã€ venir"},formations:{title:"Formations",newFormation:"Nouvelle formation",name:"Nom",code:"Code",program:"Programme",duration:"DurÃ©e"},payments:{title:"Paiements",newInvoice:"Nouvelle facture",amount:"Montant",currency:"Devise",status:"Statut",dueDate:"Date d'Ã©chÃ©ance",issueDate:"Date d'Ã©mission",paid:"PayÃ©",pending:"En attente",overdue:"En retard",draft:"Brouillon",cancelled:"AnnulÃ©",paymentMethod:"MÃ©thode de paiement",transactionId:"ID de transaction",notes:"Notes",currencyConverter:"Convertisseur de devises",from:"De",to:"Vers",convert:"Convertir",converting:"Conversion...",convertedAmount:"Montant converti"},attendance:{title:"PrÃ©sence",recordAttendance:"Enregistrer la prÃ©sence",present:"PrÃ©sent",absent:"Absent",late:"En retard",excused:"ExcusÃ©",date:"Date",class:"Classe",student:"Ã‰tudiant",attendanceRate:"Taux de prÃ©sence",history:"Historique"},messages:{title:"Messages",newConversation:"Nouvelle conversation",newMessage:"Nouveau message",send:"Envoyer",reply:"RÃ©pondre",conversations:"Conversations",noConversations:"Aucune conversation",typeMessage:"Taper un message...",attachments:"PiÃ¨ces jointes",selectFile:"SÃ©lectionner un fichier"},notifications:{title:"Notifications",markAsRead:"Marquer comme lu",markAllAsRead:"Tout marquer comme lu",delete:"Supprimer",noNotifications:"Aucune notification",all:"Toutes",unread:"Non lues"},settings:{title:"ParamÃ¨tres",organization:"Organisation",profile:"Profil",security:"SÃ©curitÃ©",notifications:"Notifications",appearance:"Apparence",language:"Langue",theme:"ThÃ¨me",light:"Clair",dark:"Sombre",system:"SystÃ¨me"},auth:{login:"Connexion",logout:"DÃ©connexion",register:"Inscription",email:"Email",password:"Mot de passe",forgotPassword:"Mot de passe oubliÃ© ?",rememberMe:"Se souvenir de moi",signIn:"Se connecter",signUp:"S'inscrire"},errors:{generic:"Une erreur est survenue",notFound:"Page non trouvÃ©e",unauthorized:"Non autorisÃ©",forbidden:"AccÃ¨s interdit",serverError:"Erreur serveur",networkError:"Erreur rÃ©seau",validationError:"Erreur de validation"},success:{saved:"EnregistrÃ© avec succÃ¨s",deleted:"SupprimÃ© avec succÃ¨s",created:"CrÃ©Ã© avec succÃ¨s",updated:"Mis Ã  jour avec succÃ¨s",sent:"EnvoyÃ© avec succÃ¨s"}})},556268,e=>{"use strict";var t=e.i(662382);let n=new class{async blobToBase64(e){return new Promise((t,n)=>{let r=new FileReader;r.onloadend=()=>{t(r.result.split(",")[1])},r.onerror=n,r.readAsDataURL(e)})}async sendEmail(e){try{let t=e.attachments?await Promise.all(e.attachments.map(async e=>{let t;if(e.content instanceof Blob)t=await this.blobToBase64(e.content);else if(e.content instanceof ArrayBuffer){let n=new Blob([e.content],{type:e.contentType});t=await this.blobToBase64(n)}else t=e.content;return{filename:e.filename,content:t,contentType:e.contentType}})):void 0,n=await fetch("/api/email/send",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({to:e.to,subject:e.subject,html:e.html,text:e.text,attachments:t,cc:e.cc,bcc:e.bcc,replyTo:e.replyTo})});if(!n.ok){let e=await n.json();throw Error(e.message||"Erreur lors de l'envoi de l'email")}let r=await n.json();return{success:!0,message:r.message||"Email envoyÃ© avec succÃ¨s"}}catch(e){throw Error(e instanceof Error?e.message:"Erreur lors de l'envoi de l'email")}}async sendDocument(e,t,n,r,a,s){return this.sendEmail({to:e,subject:t,html:a,text:s,attachments:[{filename:r,content:n,contentType:"application/pdf"}]})}async sendMultipleDocuments(e,t,n,r,a){return this.sendEmail({to:e,subject:t,html:r,text:a,attachments:n.map(e=>({filename:e.filename,content:e.blob,contentType:"application/pdf"}))})}};class r{async sendAlert(e){let{level:n,title:r,message:a,details:s={},channel:o="email",recipients:i,organizationId:l}=e;try{t.logger["critical"===n||"error"===n?"error":"warn"](`[ALERT ${n.toUpperCase()}] ${r}: ${a}`,s);let i=[];("email"===o||"both"===o)&&i.push(this.sendEmailAlert(e)),("slack"===o||"both"===o)&&i.push(this.sendSlackAlert(e)),await Promise.allSettled(i)}catch(e){t.logger.error("Failed to send alert:",e)}}async sendEmailAlert(e){let{level:r,title:a,message:s,details:o,recipients:i,organizationId:l}=e,c=[];if(0===(c=i&&i.length>0?i:await this.getAdminEmails(l)).length)return void t.logger.warn("No email recipients found for alert");let d=`[${r.toUpperCase()}] ${a}`,u=this.buildEmailContent(r,a,s,o);for(let e of c)try{await n.sendEmail({to:e,subject:d,html:u})}catch(n){t.logger.error(`Failed to send alert email to ${e}:`,n)}}async sendSlackAlert(e){let{level:n,title:r,message:a,details:s,organizationId:o}=e,i=process.env.SLACK_WEBHOOK_URL;if(!i)return void t.logger.warn("SLACK_WEBHOOK_URL not configured, skipping Slack alert");try{let e={text:`*[${n.toUpperCase()}] ${r}*`,attachments:[{color:{info:"#36a64f",warning:"#ffa500",error:"#ff0000",critical:"#8b0000"}[n],fields:[{title:"Message",value:a,short:!1},...o?[{title:"Organization ID",value:o,short:!0}]:[],...s&&Object.keys(s).length>0?[{title:"Details",value:"```"+JSON.stringify(s,null,2)+"```",short:!1}]:[],{title:"Timestamp",value:new Date().toISOString(),short:!0}]}]},t=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error(`Slack API returned ${t.status}`)}catch(e){throw t.logger.error("Failed to send Slack alert:",e),e}}async getAdminEmails(e){let t=process.env.ADMIN_EMAILS?.split(",")||[];if(t.length>0)return t.filter(e=>e.trim().length>0);let n=process.env.SUPPORT_EMAIL;return n?[n]:[]}buildEmailContent(e,t,n,r){let a={info:"#36a64f",warning:"#ffa500",error:"#ff0000",critical:"#8b0000"}[e],s=new Date().toLocaleString("fr-FR",{dateStyle:"full",timeStyle:"long"});return`
      <!DOCTYPE html>
      <html>
        <head>
          <meta charset="UTF-8">
          <style>
            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }
            .container { max-width: 600px; margin: 0 auto; padding: 20px; }
            .header { background-color: ${a}; color: white; padding: 20px; border-radius: 5px 5px 0 0; }
            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }
            .details { background-color: white; padding: 15px; margin-top: 15px; border-radius: 5px; }
            .footer { text-align: center; margin-top: 20px; color: #666; font-size: 12px; }
            pre { background-color: #f4f4f4; padding: 10px; border-radius: 3px; overflow-x: auto; }
          </style>
        </head>
        <body>
          <div class="container">
            <div class="header">
              <h2>[${e.toUpperCase()}] ${t}</h2>
            </div>
            <div class="content">
              <p><strong>Message:</strong></p>
              <p>${n}</p>
              ${r&&Object.keys(r).length>0?`
                <div class="details">
                  <p><strong>D\xe9tails:</strong></p>
                  <pre>${JSON.stringify(r,null,2)}</pre>
                </div>
              `:""}
            </div>
            <div class="footer">
              <p>Alert g\xe9n\xe9r\xe9e le ${s}</p>
              <p>EDUZEN - Syst\xe8me de gestion scolaire</p>
            </div>
          </div>
        </body>
      </html>
    `}async sendCriticalError(e,t){await this.sendAlert({level:"critical",title:"Erreur Critique",message:e.message,details:{error:e.name,stack:e.stack,...t},channel:"both"})}async sendSystemError(e,t){await this.sendAlert({level:"error",title:"Erreur SystÃ¨me",message:e,details:t,channel:"email"})}async sendWarning(e,t){await this.sendAlert({level:"warning",title:"Avertissement",message:e,details:t,channel:"email"})}async sendInfo(e,t){await this.sendAlert({level:"info",title:"Information",message:e,details:t,channel:"email"})}}let a=new r;e.s(["AlertService",()=>r,"alertService",0,a],556268)}]);

//# sourceMappingURL=_26ae05bf._.js.map