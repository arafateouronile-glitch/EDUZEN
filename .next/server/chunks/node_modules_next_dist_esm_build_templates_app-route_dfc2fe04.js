module.exports=[467864,e=>{"use strict";var t=e.i(747909),r=e.i(174017),s=e.i(996250),a=e.i(759756),i=e.i(561916),o=e.i(174677),n=e.i(869741),l=e.i(316795),u=e.i(487718),c=e.i(995169),d=e.i(47587),p=e.i(666012),h=e.i(570101),g=e.i(626937),f=e.i(10372),w=e.i(193695);e.i(52474);var m=e.i(257297),_=e.i(89171),y=e.i(89660),R=e.i(703755);let b=new class{supabase;constructor(e){this.supabase=e||(0,R.createClient)()}async getCategories(e){let{data:t,error:r}=await this.supabase.from("resource_categories").select("*").eq("organization_id",e).eq("is_active",!0).order("order_index",{ascending:!0});if(r)throw r;return t}async createCategory(e){let{data:t,error:r}=await this.supabase.from("resource_categories").insert(e).select().single();if(r)throw r;return t}async updateCategory(e,t){let{data:r,error:s}=await this.supabase.from("resource_categories").update(t).eq("id",e).select().single();if(s)throw s;return r}async deleteCategory(e){let{error:t}=await this.supabase.from("resource_categories").delete().eq("id",e);if(t)throw t}async getResources(e,t){let r=this.supabase.from("resources").select("*, author:users(id, full_name, email), category:resource_categories(*)").eq("organization_id",e);t?.categoryId&&(r=r.eq("category_id",t.categoryId)),t?.resourceType&&(r=r.eq("resource_type",t.resourceType)),t?.authorId&&(r=r.eq("author_id",t.authorId)),t?.search&&(r=r.or(`title.ilike.%${t.search}%,description.ilike.%${t.search}%`)),t?.tags&&t.tags.length>0&&(r=r.contains("tags",t.tags)),t?.isPublic!==void 0&&(r=r.eq("is_public",t.isPublic));let{data:s,error:a}=await r.order("created_at",{ascending:!1});if(a)throw a;return s}async getResourceBySlug(e,t){let{data:r,error:s}=await this.supabase.from("resources").select("*, author:users(id, full_name, email), category:resource_categories(*)").eq("slug",e).eq("organization_id",t).single();if(s)throw s;return r&&await this.recordView(r.id),r}async createResource(e){let{data:t,error:r}=await this.supabase.from("resources").insert(e).select().single();if(r)throw r;return t}async updateResource(e,t){let{data:r,error:s}=await this.supabase.from("resources").update(t).eq("id",e).select().single();if(s)throw s;return r}async deleteResource(e){let{error:t}=await this.supabase.from("resources").delete().eq("id",e);if(t)throw t}async addToFavorites(e,t){let{data:r,error:s}=await this.supabase.from("resource_favorites").insert({user_id:e,resource_id:t}).select().single();if(s)throw s;return r}async removeFromFavorites(e,t){let{error:r}=await this.supabase.from("resource_favorites").delete().eq("user_id",e).eq("resource_id",t);if(r)throw r}async isFavorite(e,t){let{data:r,error:s}=await this.supabase.from("resource_favorites").select("id").eq("user_id",e).eq("resource_id",t).maybeSingle();if(s)throw s;return!!r}async getUserFavorites(e){let{data:t,error:r}=await this.supabase.from("resource_favorites").select("*, resource:resources(*, category:resource_categories(*), author:users(id, full_name))").eq("user_id",e).order("created_at",{ascending:!1});if(r)throw r;return t}async recordDownload(e,t,r,s){let{data:a,error:i}=await this.supabase.from("resource_downloads").insert({resource_id:e,user_id:t,ip_address:r,user_agent:s}).select().single();if(i)throw i;return a}async getUserDownloads(e){let{data:t,error:r}=await this.supabase.from("resource_downloads").select("*, resource:resources(*)").eq("user_id",e).order("downloaded_at",{ascending:!1}).limit(50);if(r)throw r;return t}async recordView(e,t,r,s){let{data:a,error:i}=await this.supabase.from("resource_views").insert({resource_id:e,user_id:t,ip_address:r,user_agent:s}).select().single();if(i)throw i;return a}async getResourceComments(e){let{data:t,error:r}=await this.supabase.from("resource_comments").select("*, user:users(id, full_name, email), replies:resource_comments!parent_id(*)").eq("resource_id",e).is("parent_id",null).order("created_at",{ascending:!1});if(r)throw r;return t}async createComment(e){let{data:t,error:r}=await this.supabase.from("resource_comments").insert(e).select("*, user:users(id, full_name, email)").single();if(r)throw r;return t}async updateComment(e,t){let{data:r,error:s}=await this.supabase.from("resource_comments").update(t).eq("id",e).select().single();if(s)throw s;return r}async deleteComment(e){let{error:t}=await this.supabase.from("resource_comments").delete().eq("id",e);if(t)throw t}async createRating(e){let{data:t,error:r}=await this.supabase.from("resource_ratings").insert(e).select().single();if(r)throw r;return t}async updateRating(e,t){let{data:r,error:s}=await this.supabase.from("resource_ratings").update(t).eq("id",e).select().single();if(s)throw s;return r}async getResourceRatings(e){let{data:t,error:r}=await this.supabase.from("resource_ratings").select("*, user:users(id, full_name, email)").eq("resource_id",e).order("created_at",{ascending:!1});if(r)throw r;return t}async getResourceRatingStats(e){let{data:t,error:r}=await this.supabase.from("resource_ratings").select("rating").eq("resource_id",e);if(r)throw r;let s={total:t.length,average:0,distribution:{1:0,2:0,3:0,4:0,5:0}};if(t.length>0){let e=t.map(e=>e.rating).filter(Boolean);s.average=e.reduce((e,t)=>e+t,0)/e.length,e.forEach(e=>{s.distribution[e]++})}return s}async getCollections(e,t){let r=this.supabase.from("resource_collections").select("*, user:users(id, full_name, email)").eq("organization_id",e);r=t?r.eq("user_id",t):r.eq("is_public",!0);let{data:s,error:a}=await r.order("created_at",{ascending:!1});if(a)throw a;return s}async getCollectionById(e){let{data:t,error:r}=await this.supabase.from("resource_collections").select("*, user:users(id, full_name, email), items:resource_collection_items(*, resource:resources(*))").eq("id",e).single();if(r)throw r;return t}async createCollection(e){let{data:t,error:r}=await this.supabase.from("resource_collections").insert(e).select().single();if(r)throw r;return t}async updateCollection(e,t){let{data:r,error:s}=await this.supabase.from("resource_collections").update(t).eq("id",e).select().single();if(s)throw s;return r}async deleteCollection(e){let{error:t}=await this.supabase.from("resource_collections").delete().eq("id",e);if(t)throw t}async addResourceToCollection(e,t,r){let{data:s,error:a}=await this.supabase.from("resource_collection_items").insert({collection_id:e,resource_id:t,order_index:r||0}).select().single();if(a)throw a;return s}async removeResourceFromCollection(e,t){let{error:r}=await this.supabase.from("resource_collection_items").delete().eq("collection_id",e).eq("resource_id",t);if(r)throw r}async getPopularResources(e,t=10){let{data:r,error:s}=await this.supabase.from("resources").select("*, author:users(id, full_name, email), category:resource_categories(*)").eq("organization_id",e).order("download_count",{ascending:!1}).limit(t);if(s)throw s;return r}async getRecentResources(e,t=10){let{data:r,error:s}=await this.supabase.from("resources").select("*, author:users(id, full_name, email), category:resource_categories(*)").eq("organization_id",e).order("created_at",{ascending:!1}).limit(t);if(s)throw s;return r}async getResourcesByType(e,t){let{data:r,error:s}=await this.supabase.from("resources").select("*, author:users(id, full_name, email), category:resource_categories(*)").eq("organization_id",e).eq("resource_type",t).order("created_at",{ascending:!1});if(s)throw s;return r}};async function v(e,{params:t}){try{let{id:r}=await t,s=await (0,y.createClient)(),{data:{user:a}}=await s.auth.getUser();if(!a)return _.NextResponse.json({error:"Non authentifié"},{status:401});let{data:i,error:o}=await s.from("resources").select("*").eq("id",r).single();if(o||!i)return _.NextResponse.json({error:"Ressource non trouvée"},{status:404});let n=e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip")||void 0,l=e.headers.get("user-agent")||void 0;if(await b.recordDownload(r,a.id,n,l),i.external_url)return _.NextResponse.redirect(i.external_url);if(i.file_url)return _.NextResponse.redirect(i.file_url);return _.NextResponse.json({error:"Aucun fichier disponible"},{status:404})}catch(e){return console.error("Error downloading resource:",e),_.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Erreur lors du téléchargement"},{status:500})}}e.s(["GET",()=>v],837523);var q=e.i(837523);let C=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/resources/[id]/download/route",pathname:"/api/resources/[id]/download",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/resources/[id]/download/route.ts",nextConfigOutput:"",userland:q}),{workAsyncStorage:E,workUnitAsyncStorage:x,serverHooks:A}=C;function N(){return(0,s.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:x})}async function T(e,t,s){C.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let _="/api/resources/[id]/download/route";_=_.replace(/\/index$/,"")||"/";let y=await C.prepare(e,t,{srcPage:_,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:R,params:b,nextConfig:v,parsedUrl:q,isDraftMode:E,prerenderManifest:x,routerServerContext:A,isOnDemandRevalidate:N,revalidateOnlyGenerated:T,resolvedPathname:P,clientReferenceManifest:S,serverActionsManifest:O}=y,I=(0,n.normalizeAppPath)(_),U=!!(x.dynamicRoutes[I]||x.routes[P]),H=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,q,!1):t.end("This page could not be found"),null);if(U&&!E){let e=!!x.routes[P],t=x.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(v.experimental.adapterPath)return await H();throw new w.NoFallbackError}}let D=null;!U||C.isDev||E||(D="/index"===(D=P)?"/":D);let k=!0===C.isDev||!U,F=U&&!k;O&&S&&(0,o.setManifestsSingleton)({page:_,clientReferenceManifest:S,serverActionsManifest:O});let M=e.method||"GET",j=(0,i.getTracer)(),$=j.getActiveScopeSpan(),B={params:b,prerenderManifest:x,renderOpts:{experimental:{authInterrupts:!!v.experimental.authInterrupts},cacheComponents:!!v.cacheComponents,supportsDynamicResponse:k,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:v.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s,a)=>C.onRequestError(e,t,s,a,A)},sharedContext:{buildId:R}},z=new l.NodeNextRequest(e),K=new l.NodeNextResponse(t),L=u.NextRequestAdapter.fromNodeNextRequest(z,(0,u.signalFromNodeResponse)(t));try{let o=async e=>C.handle(L,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=j.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${M} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${_}`)}),n=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var i,l;let u=async({previousCacheEntry:r})=>{try{if(!n&&N&&T&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(a);e.fetchMetrics=B.renderOpts.fetchMetrics;let l=B.renderOpts.pendingWaitUntil;l&&s.waitUntil&&(s.waitUntil(l),l=void 0);let u=B.renderOpts.collectedTags;if(!U)return await (0,p.sendResponse)(z,K,i,B.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(i.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,s=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await C.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:N})},!1,A),t}},c=await C.handleResponse({req:e,nextConfig:v,cacheKey:D,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:x,isRoutePPREnabled:!1,isOnDemandRevalidate:N,revalidateOnlyGenerated:T,responseGenerator:u,waitUntil:s.waitUntil,isMinimalMode:n});if(!U)return null;if((null==c||null==(i=c.value)?void 0:i.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});n||t.setHeader("x-nextjs-cache",N?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),E&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let w=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return n&&U||w.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||w.get("Cache-Control")||w.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(z,K,new Response(c.value.body,{headers:w,status:c.value.status||200})),null};$?await l($):await j.withPropagatedContext(e.headers,()=>j.trace(c.BaseServerSpan.handleRequest,{spanName:`${M} ${_}`,kind:i.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},l))}catch(t){if(t instanceof w.NoFallbackError||await C.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,d.getRevalidateReason)({isStaticGeneration:F,isOnDemandRevalidate:N})},!1,A),U)throw t;return await (0,p.sendResponse)(z,K,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>N,"routeModule",()=>C,"serverHooks",()=>A,"workAsyncStorage",()=>E,"workUnitAsyncStorage",()=>x],467864)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_dfc2fe04.js.map