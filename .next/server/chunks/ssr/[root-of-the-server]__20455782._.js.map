{"version":3,"sources":["../../../../lib/utils/document-generation/conditional-processor.ts","../../../../lib/utils/pdf-generator.ts"],"sourcesContent":["/**\n * Traite les conditions conditionnelles dans le HTML\n * Supporte les syntaxes : {IF variable}...{ENDIF}, {IF variable}...{ELSE}...{ENDIF}\n */\n\nexport interface DocumentVariables {\n  [key: string]: any\n}\n\n/**\n * Traite les conditions IF/ELSE/ENDIF dans le HTML\n * Supporte aussi la syntaxe JSX : {variable && ...}\n */\nexport function processConditionals(html: string, variables: DocumentVariables): string {\n  if (!html) return html\n\n  let result = html\n\n  // 1. Traiter la syntaxe JSX : {variable && <tag>...</tag>}\n  // Utiliser un parser qui gère correctement les balises HTML imbriquées\n  const processJSXConditionals = (text: string): string => {\n    let processed = text\n    let changed = true\n    let iterations = 0\n    const maxIterations = 10\n    \n    while (changed && iterations < maxIterations) {\n      changed = false\n      iterations++\n      \n      // Trouver toutes les occurrences de {variable && ...\n      const pattern = /\\{([a-zA-Z_][a-zA-Z0-9_]*)\\s+&&\\s+/g\n      let match\n      const replacements: Array<{ start: number; end: number; replacement: string }> = []\n      \n      // Trouver toutes les correspondances et les traiter de droite à gauche\n      const matches: Array<{ varName: string; start: number; varEnd: number }> = []\n      while ((match = pattern.exec(processed)) !== null) {\n        matches.push({\n          varName: match[1].trim(),\n          start: match.index,\n          varEnd: match.index + match[0].length,\n        })\n      }\n      \n      // Traiter de droite à gauche pour préserver les indices\n      for (let i = matches.length - 1; i >= 0; i--) {\n        const m = matches[i]\n        let depth = 1 // On est déjà dans une accolade ouvrante\n        let pos = m.varEnd\n        let inString = false\n        let stringChar = ''\n        let foundEnd = false\n        let endPos = -1\n        \n        // Chercher la fin de la conditionnelle en gérant les accolades imbriquées et les strings\n        while (pos < processed.length && !foundEnd) {\n          const char = processed[pos]\n          \n          if (!inString) {\n            if (char === '\"' || char === \"'\") {\n              inString = true\n              stringChar = char\n            } else if (char === '{') {\n              depth++\n            } else if (char === '}') {\n              depth--\n              if (depth === 0) {\n                foundEnd = true\n                endPos = pos\n              }\n            }\n          } else {\n            if (char === stringChar && processed[pos - 1] !== '\\\\') {\n              inString = false\n            }\n          }\n          \n          pos++\n        }\n        \n        if (foundEnd && endPos > m.start) {\n          const varName = m.varName\n          const content = processed.substring(m.varEnd, endPos)\n          const value = variables[varName]\n          const conditionValue = Boolean(value) && value !== '' && value !== 0 && value !== '0' && value !== null && value !== undefined\n          \n          if (conditionValue) {\n            replacements.push({\n              start: m.start,\n              end: endPos + 1,\n              replacement: content,\n            })\n            changed = true\n          } else {\n            replacements.push({\n              start: m.start,\n              end: endPos + 1,\n              replacement: '',\n            })\n            changed = true\n          }\n        }\n      }\n      \n      // Appliquer les remplacements de droite à gauche\n      for (const rep of replacements) {\n        processed = processed.substring(0, rep.start) + rep.replacement + processed.substring(rep.end)\n      }\n    }\n    \n    return processed\n  }\n\n  result = processJSXConditionals(result)\n\n  // 2. Traiter aussi les conditionnels avec plusieurs variables : {var1 && var2 && ...}\n  const processMultiConditionals = (text: string): string => {\n    let processed = text\n    let changed = true\n    let iterations = 0\n    const maxIterations = 10\n    \n    while (changed && iterations < maxIterations) {\n      changed = false\n      iterations++\n      \n      const pattern = /\\{([a-zA-Z_][a-zA-Z0-9_]*)\\s+&&\\s+([a-zA-Z_][a-zA-Z0-9_]*)\\s+&&\\s+([^}]+)\\}/g\n      \n      processed = processed.replace(pattern, (match, var1, var2, content) => {\n        const val1 = variables[var1.trim()]\n        const val2 = variables[var2.trim()]\n        const conditionValue = Boolean(val1) && val1 !== '' && Boolean(val2) && val2 !== ''\n        \n        if (conditionValue) {\n          changed = true\n          return content\n        }\n        return ''\n      })\n    }\n    \n    return processed\n  }\n\n  result = processMultiConditionals(result)\n\n  // 3. Traiter la syntaxe IF/ELSE/ENDIF classique\n  const conditionalPattern = /\\{IF\\s+([^}]+)\\}([\\s\\S]*?)(?:\\{ELSE\\}([\\s\\S]*?))?\\{ENDIF\\}/gi\n\n  result = result.replace(conditionalPattern, (match, condition, ifContent, elseContent = '') => {\n    // Évaluer la condition\n    const conditionValue = evaluateCondition(condition.trim(), variables)\n    \n    // Retourner le contenu approprié\n    return conditionValue ? ifContent : elseContent\n  })\n\n  return result\n}\n\n/**\n * Alias pour processConditionals (utilisé par html-generator)\n */\nexport const evaluateConditionalContent = processConditionals\n\n// Export par défaut pour compatibilité\nexport default processConditionals\n\n/**\n * Évalue une condition\n */\nfunction evaluateCondition(condition: string, variables: DocumentVariables): boolean {\n  // Supprimer les espaces\n  condition = condition.trim()\n\n  // Vérifier si c'est une variable simple\n  if (variables.hasOwnProperty(condition)) {\n    const value = variables[condition]\n    // Considérer comme vrai si la valeur existe et n'est pas vide/false/0\n    return Boolean(value) && value !== '' && value !== 0 && value !== '0'\n  }\n\n  // Vérifier les opérateurs de comparaison\n  const operators = ['==', '!=', '>', '<', '>=', '<=']\n  \n  for (const op of operators) {\n    if (condition.includes(op)) {\n      const [left, right] = condition.split(op).map(s => s.trim())\n      const leftValue = getVariableValue(left, variables)\n      const rightValue = getVariableValue(right, variables)\n      \n      switch (op) {\n        case '==':\n          return leftValue == rightValue\n        case '!=':\n          return leftValue != rightValue\n        case '>':\n          return Number(leftValue) > Number(rightValue)\n        case '<':\n          return Number(leftValue) < Number(rightValue)\n        case '>=':\n          return Number(leftValue) >= Number(rightValue)\n        case '<=':\n          return Number(leftValue) <= Number(rightValue)\n        default:\n          return false\n      }\n    }\n  }\n\n  // Par défaut, retourner false\n  return false\n}\n\n/**\n * Récupère la valeur d'une variable ou retourne la valeur littérale\n */\nfunction getVariableValue(expression: string, variables: DocumentVariables): any {\n  expression = expression.trim()\n  \n  // Si c'est une chaîne entre guillemets, retourner la valeur sans guillemets\n  if ((expression.startsWith('\"') && expression.endsWith('\"')) ||\n      (expression.startsWith(\"'\") && expression.endsWith(\"'\"))) {\n    return expression.slice(1, -1)\n  }\n  \n  // Si c'est un nombre, retourner le nombre\n  if (!isNaN(Number(expression))) {\n    return Number(expression)\n  }\n  \n  // Sinon, chercher dans les variables\n  return variables[expression] ?? expression\n}\n","import { jsPDF } from 'jspdf'\nimport html2canvas from 'html2canvas'\nimport JSZip from 'jszip'\n\nexport interface DocumentTemplate {\n  title: string\n  content: string\n  logo?: string\n  organization?: {\n    name: string\n    address?: string\n    phone?: string\n    email?: string\n  }\n  metadata?: Record<string, any>\n}\n\n/**\n * Génère un PDF depuis un élément HTML\n */\nexport async function generatePDFFromHTML(\n  elementId: string,\n  filename: string = 'document.pdf',\n  options?: {\n    format?: [number, number]\n    orientation?: 'portrait' | 'landscape'\n    quality?: number\n  }\n): Promise<Blob> {\n  const element = document.getElementById(elementId)\n  if (!element) {\n    throw new Error(`Élément avec l'ID \"${elementId}\" non trouvé`)\n  }\n\n  try {\n    // Vérifier que l'élément est visible et a des dimensions\n    const rect = element.getBoundingClientRect()\n    if (rect.width === 0 || rect.height === 0) {\n      console.warn('Élément sans dimensions, tentative de correction...')\n      // Forcer des dimensions minimales\n      if (element instanceof HTMLElement) {\n        element.style.width = element.style.width || '210mm'\n        element.style.minHeight = element.style.minHeight || '297mm'\n        // Attendre que le style soit appliqué\n        await new Promise((resolve) => setTimeout(resolve, 100))\n      }\n    }\n\n    // Attendre que toutes les images soient chargées\n    const images = element.querySelectorAll('img')\n    await Promise.all(\n      Array.from(images).map((img) => {\n        if (img.complete && img.naturalWidth > 0) return Promise.resolve()\n        return new Promise((resolve) => {\n          img.onload = resolve\n          img.onerror = resolve // Continuer même si une image échoue\n          // Timeout après 5 secondes\n          setTimeout(resolve, 5000)\n        })\n      })\n    )\n\n    // Générer le canvas avec html2canvas\n    const elementWidth = rect.width || element.scrollWidth || 794\n    const elementHeight = element.scrollHeight || 1123\n    \n    const canvas = await html2canvas(element, {\n      scale: 2, // Augmenter la résolution pour une meilleure qualité\n      useCORS: true,\n      allowTaint: true,\n      logging: false,\n      backgroundColor: '#ffffff',\n      removeContainer: false, // Ne pas supprimer le conteneur\n      imageTimeout: 15000,\n      width: elementWidth,\n      height: elementHeight,\n      windowWidth: elementWidth,\n      windowHeight: elementHeight,\n      x: 0,\n      y: 0,\n      onclone: (clonedDoc, element) => {\n        // S'assurer que toutes les images dans le clone sont chargées\n        const clonedImages = clonedDoc.querySelectorAll('img')\n        clonedImages.forEach((img) => {\n          if (!img.complete || img.naturalWidth === 0) {\n            // Remplacer les images non chargées par un placeholder\n            img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2YzZjRmNiIvPjwvc3ZnPg=='\n          }\n        })\n        \n        // S'assurer que l'élément cloné a des dimensions\n        if (element instanceof HTMLElement) {\n          const clonedRect = element.getBoundingClientRect()\n          if (clonedRect.width === 0 || clonedRect.height === 0) {\n            element.style.width = '210mm'\n            element.style.minHeight = '297mm'\n          }\n        }\n      },\n    })\n\n    // Vérifier que le canvas est valide\n    if (!canvas) {\n      throw new Error('Le canvas n\\'a pas pu être généré')\n    }\n    \n    if (canvas.width === 0 || canvas.height === 0) {\n      console.error('Canvas invalide:', { width: canvas.width, height: canvas.height })\n      throw new Error(`Le canvas généré est invalide (${canvas.width}x${canvas.height})`)\n    }\n\n    // Convertir en data URL avec gestion d'erreur\n    let imgData: string\n    try {\n      imgData = canvas.toDataURL('image/png', 0.95)\n      if (!imgData || imgData.length < 100) {\n        throw new Error('Data URL invalide')\n      }\n    } catch (error) {\n      console.error('Erreur lors de la conversion du canvas en data URL:', error)\n      // Essayer avec JPEG comme fallback\n      imgData = canvas.toDataURL('image/jpeg', 0.95)\n    }\n\n    const pdf = new jsPDF({\n      orientation: options?.orientation || 'portrait',\n      unit: 'mm',\n      format: options?.format || 'a4',\n      compress: true,\n    })\n\n    const imgWidth = pdf.internal.pageSize.getWidth()\n    const imgHeight = (canvas.height * imgWidth) / canvas.width\n\n    let heightLeft = imgHeight\n    let position = 0\n\n    // Ajouter la première page\n    try {\n      pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight, undefined, 'FAST')\n    } catch (error) {\n      console.error('Erreur lors de l\\'ajout de l\\'image au PDF:', error)\n      // Essayer avec JPEG si PNG échoue\n      if (imgData.startsWith('data:image/png')) {\n        const jpegData = canvas.toDataURL('image/jpeg', 0.95)\n        pdf.addImage(jpegData, 'JPEG', 0, position, imgWidth, imgHeight, undefined, 'FAST')\n      } else {\n        throw error\n      }\n    }\n\n    heightLeft -= pdf.internal.pageSize.getHeight()\n\n    // Ajouter les pages supplémentaires si nécessaire\n    while (heightLeft >= 0) {\n      position = heightLeft - imgHeight\n      pdf.addPage()\n      try {\n        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight, undefined, 'FAST')\n      } catch (error) {\n        // Si PNG échoue, essayer JPEG\n        if (imgData.startsWith('data:image/png')) {\n          const jpegData = canvas.toDataURL('image/jpeg', 0.95)\n          pdf.addImage(jpegData, 'JPEG', 0, position, imgWidth, imgHeight, undefined, 'FAST')\n        }\n      }\n      heightLeft -= pdf.internal.pageSize.getHeight()\n    }\n\n    pdf.save(filename)\n    return pdf.output('blob')\n  } catch (error) {\n    console.error('Erreur lors de la génération du PDF:', error)\n    throw new Error(`Erreur lors de la génération du PDF: ${error instanceof Error ? error.message : 'Erreur inconnue'}`)\n  }\n}\n\n/**\n * Génère un PDF simple avec du texte\n */\nexport function generateSimplePDF(\n  content: string[],\n  filename: string = 'document.pdf',\n  options?: {\n    title?: string\n    orientation?: 'portrait' | 'landscape'\n  }\n): Blob {\n  const pdf = new jsPDF({\n    orientation: options?.orientation || 'portrait',\n    unit: 'mm',\n    format: 'a4',\n  })\n\n  if (options?.title) {\n    pdf.setFontSize(18)\n    pdf.text(options.title, 105, 20, { align: 'center' })\n    pdf.setFontSize(12)\n    let y = 35\n    content.forEach((line) => {\n      if (y > 280) {\n        pdf.addPage()\n        y = 20\n      }\n      pdf.text(line, 20, y)\n      y += 7\n    })\n  } else {\n    let y = 20\n    content.forEach((line) => {\n      if (y > 280) {\n        pdf.addPage()\n        y = 20\n      }\n      pdf.text(line, 20, y)\n      y += 7\n    })\n  }\n\n  pdf.save(filename)\n  return pdf.output('blob')\n}\n\n/**\n * Formate une date pour l'affichage dans un document\n */\nexport function formatDateForDocument(date: string | Date, locale: string = 'fr-FR'): string {\n  const d = typeof date === 'string' ? new Date(date) : date\n  return new Intl.DateTimeFormat(locale, {\n    year: 'numeric',\n    month: 'long',\n    day: 'numeric',\n  }).format(d)\n}\n\n/**\n * Génère un PDF depuis du HTML (sans téléchargement)\n * Retourne le Blob du PDF\n * Amélioré pour préserver les marges, headers et footers\n */\nexport async function generatePDFBlobFromHTML(\n  elementId: string,\n  options?: {\n    format?: [number, number]\n    orientation?: 'portrait' | 'landscape'\n    quality?: number\n  }\n): Promise<Blob> {\n  const element = document.getElementById(elementId)\n  if (!element) {\n    throw new Error(`Élément avec l'ID \"${elementId}\" non trouvé`)\n  }\n\n  // Vérifier que l'élément est visible et a des dimensions\n  const rect = element.getBoundingClientRect()\n  if (rect.width === 0 || rect.height === 0) {\n    console.warn('Élément sans dimensions, tentative de correction...')\n    if (element instanceof HTMLElement) {\n      element.style.width = element.style.width || '794px'\n      element.style.minHeight = element.style.minHeight || '1123px'\n      await new Promise((resolve) => setTimeout(resolve, 100))\n    }\n  }\n\n  // Attendre que toutes les images soient chargées\n  const images = element.querySelectorAll('img')\n  await Promise.all(\n    Array.from(images).map((img) => {\n      if (img.complete && img.naturalWidth > 0) return Promise.resolve()\n      return new Promise((resolve) => {\n        img.onload = resolve\n        img.onerror = resolve\n        setTimeout(resolve, 5000)\n      })\n    })\n  )\n\n  // Extraire le header et le footer pour traitement séparé\n  const headerElement = element.querySelector('.header') as HTMLElement\n  const footerElement = element.querySelector('.footer') as HTMLElement\n  const contentElement = element.querySelector('.content') as HTMLElement\n  \n  // Vérifier si le header doit être répété sur toutes les pages\n  const headerRepeatOnAllPages = headerElement?.getAttribute('data-repeat-on-all-pages') === 'true' || false\n  \n  // Récupérer les styles calculés de l'élément original avant la capture\n  const originalStyle = window.getComputedStyle(element)\n  const originalPaddingTop = parseFloat(originalStyle.paddingTop) || 75.6 // 20mm par défaut\n  const originalPaddingBottom = parseFloat(originalStyle.paddingBottom) || 75.6\n  const originalPaddingLeft = parseFloat(originalStyle.paddingLeft) || 75.6\n  const originalPaddingRight = parseFloat(originalStyle.paddingRight) || 75.6\n  \n  // Générer le canvas avec html2canvas avec des options optimisées\n  // Utiliser scrollWidth et scrollHeight pour capturer tout le contenu\n  const elementWidth = element.scrollWidth || rect.width || 794\n  const elementHeight = element.scrollHeight || rect.height || 1123\n  \n  // Capturer le footer séparément si présent\n  let footerCanvas: HTMLCanvasElement | null = null\n  let footerHeight = 0\n  if (footerElement) {\n    try {\n      footerHeight = footerElement.offsetHeight || 60\n      footerCanvas = await html2canvas(footerElement, {\n        scale: 2,\n        useCORS: true,\n        allowTaint: true,\n        logging: false,\n        backgroundColor: '#ffffff',\n        width: elementWidth - originalPaddingLeft - originalPaddingRight,\n        height: footerHeight,\n      })\n      console.log('[PDF Generator] Footer capturé séparément:', {\n        width: footerCanvas.width,\n        height: footerCanvas.height,\n        footerHeight,\n      })\n    } catch (error) {\n      console.warn('[PDF Generator] Erreur lors de la capture du footer:', error)\n    }\n  }\n  \n  console.log('[PDF Generator] Capturing element:', {\n    elementId,\n    width: elementWidth,\n    height: elementHeight,\n    scrollWidth: element.scrollWidth,\n    scrollHeight: element.scrollHeight,\n    rectWidth: rect.width,\n    rectHeight: rect.height,\n    computedPadding: originalStyle.padding,\n    paddingTop: originalPaddingTop,\n    paddingBottom: originalPaddingBottom,\n    paddingLeft: originalPaddingLeft,\n    paddingRight: originalPaddingRight,\n  })\n  \n  const canvas = await html2canvas(element, {\n    scale: 2, // Augmenter la résolution pour une meilleure qualité\n    useCORS: true,\n    allowTaint: true,\n    logging: false,\n    backgroundColor: '#ffffff',\n    removeContainer: false,\n    imageTimeout: 15000,\n    width: elementWidth,\n    height: elementHeight,\n    windowWidth: elementWidth,\n    windowHeight: elementHeight,\n    x: 0,\n    y: 0,\n    scrollX: 0,\n    scrollY: 0,\n    onclone: (clonedDoc, clonedElement) => {\n      // S'assurer que toutes les images dans le clone sont chargées\n      const clonedImages = clonedDoc.querySelectorAll('img')\n      clonedImages.forEach((img) => {\n        if (!img.complete || img.naturalWidth === 0) {\n          img.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2YzZjRmNiIvPjwvc3ZnPg=='\n        }\n      })\n      \n      // S'assurer que l'élément cloné a des dimensions et préserve les styles\n      if (clonedElement instanceof HTMLElement) {\n        // Forcer les dimensions de base\n        clonedElement.style.width = '794px'\n        clonedElement.style.minHeight = '1123px'\n        clonedElement.style.backgroundColor = '#ffffff'\n        clonedElement.style.boxSizing = 'border-box'\n        clonedElement.style.position = 'relative'\n        \n        // Appliquer le padding (marges) en utilisant les valeurs de l'original\n        clonedElement.style.padding = `${originalPaddingTop}px ${originalPaddingRight}px ${originalPaddingBottom}px ${originalPaddingLeft}px`\n        \n        // S'assurer que le conteneur utilise flexbox\n        clonedElement.style.display = 'flex'\n        clonedElement.style.flexDirection = 'column'\n        \n        console.log('[PDF Generator] Clone styles applied:', {\n          padding: clonedElement.style.padding,\n          width: clonedElement.style.width,\n          minHeight: clonedElement.style.minHeight,\n          display: clonedElement.style.display,\n        })\n        \n        // S'assurer que header et footer sont visibles et correctement positionnés\n        const clonedHeader = clonedElement.querySelector('.header') as HTMLElement\n        const clonedFooter = clonedElement.querySelector('.footer') as HTMLElement\n        const clonedContent = clonedElement.querySelector('.content') as HTMLElement\n        \n        if (clonedHeader) {\n          // Le header ne doit être visible que sur la première page si repeatOnAllPages est false\n          // Pour l'instant, on le laisse visible pour la première page\n          clonedHeader.style.display = 'block'\n          clonedHeader.style.visibility = 'visible'\n          clonedHeader.style.opacity = '1'\n          clonedHeader.style.width = '100%'\n          clonedHeader.style.marginBottom = '20px'\n          clonedHeader.style.flexShrink = '0'\n          clonedHeader.style.position = 'relative'\n          clonedHeader.style.zIndex = '1'\n          console.log('[PDF Generator] Header cloné activé:', {\n            display: clonedHeader.style.display,\n            visibility: clonedHeader.style.visibility,\n            innerHTML: clonedHeader.innerHTML.substring(0, 100),\n            offsetHeight: clonedHeader.offsetHeight,\n          })\n        } else {\n          console.warn('[PDF Generator] Header non trouvé dans le clone')\n        }\n        \n        // Masquer le footer dans le clone principal car on l'ajoutera séparément sur chaque page\n        if (clonedFooter) {\n          clonedFooter.style.display = 'none'\n          console.log('[PDF Generator] Footer masqué dans le clone principal (sera ajouté séparément)')\n        }\n        \n        if (clonedContent) {\n          clonedContent.style.flex = '1'\n          clonedContent.style.width = '100%'\n          clonedContent.style.overflow = 'visible'\n        }\n      }\n    },\n  })\n\n  // Vérifier que le canvas est valide\n  if (!canvas || canvas.width === 0 || canvas.height === 0) {\n    throw new Error(`Le canvas généré est invalide (${canvas?.width || 0}x${canvas?.height || 0})`)\n  }\n\n  // Convertir en data URL pour la première page (avec header)\n  let imgDataFirstPage: string\n  try {\n    imgDataFirstPage = canvas.toDataURL('image/png', 0.95)\n    if (!imgDataFirstPage || imgDataFirstPage.length < 100) {\n      throw new Error('Data URL invalide')\n    }\n  } catch (error) {\n    console.error('Erreur lors de la conversion du canvas en data URL:', error)\n    imgDataFirstPage = canvas.toDataURL('image/jpeg', 0.95)\n  }\n\n  // Si le header ne doit pas être répété, créer une version sans header pour les pages suivantes\n  let imgDataOtherPages: string | null = null\n  if (headerElement && !headerRepeatOnAllPages) {\n    // Masquer temporairement le header pour capturer le contenu sans header\n    const originalHeaderDisplay = headerElement.style.display\n    headerElement.style.display = 'none'\n    \n    try {\n      await new Promise(resolve => setTimeout(resolve, 100)) // Attendre que le style soit appliqué\n      const canvasWithoutHeader = await html2canvas(element, {\n        scale: 2,\n        useCORS: true,\n        allowTaint: true,\n        logging: false,\n        backgroundColor: '#ffffff',\n        removeContainer: false,\n        imageTimeout: 15000,\n        width: elementWidth,\n        height: elementHeight,\n        windowWidth: elementWidth,\n        windowHeight: elementHeight,\n        x: 0,\n        y: 0,\n        scrollX: 0,\n        scrollY: 0,\n        onclone: (clonedDoc, clonedElement) => {\n          // Masquer le header dans le clone aussi\n          const clonedHeader = clonedElement.querySelector('.header') as HTMLElement\n          if (clonedHeader) {\n            clonedHeader.style.display = 'none'\n          }\n          const clonedFooter = clonedElement.querySelector('.footer') as HTMLElement\n          if (clonedFooter) {\n            clonedFooter.style.display = 'none'\n          }\n        },\n      })\n      \n      imgDataOtherPages = canvasWithoutHeader.toDataURL('image/png', 0.95)\n      console.log('[PDF Generator] Canvas sans header créé pour les pages suivantes')\n    } catch (error) {\n      console.warn('[PDF Generator] Erreur lors de la création du canvas sans header:', error)\n      // Utiliser la même image si l'erreur survient\n      imgDataOtherPages = imgDataFirstPage\n    } finally {\n      // Restaurer l'affichage du header\n      headerElement.style.display = originalHeaderDisplay\n    }\n  } else {\n    // Si le header doit être répété ou s'il n'y a pas de header, utiliser la même image\n    imgDataOtherPages = imgDataFirstPage\n  }\n\n  const pdf = new jsPDF({\n    orientation: options?.orientation || 'portrait',\n    unit: 'mm',\n    format: options?.format || 'a4',\n    compress: true,\n  })\n\n  const imgWidth = pdf.internal.pageSize.getWidth()\n  const imgHeight = (canvas.height * imgWidth) / canvas.width\n  const pageHeight = pdf.internal.pageSize.getHeight()\n  const footerHeightMm = footerHeight / 3.78 // Convertir pixels en mm\n  const marginBottomMm = originalPaddingBottom / 3.78 // Convertir la marge en mm\n\n  let heightLeft = imgHeight\n  let position = 0\n  let pageNumber = 1\n  const totalPages = Math.ceil(imgHeight / pageHeight)\n\n  // Fonction pour ajouter le footer sur une page\n  const addFooterToPage = (page: any, pageNum: number, totalPages: number) => {\n    if (footerCanvas) {\n      try {\n        const footerImgData = footerCanvas.toDataURL('image/png', 0.95)\n        const footerImgWidth = imgWidth\n        const footerImgHeight = (footerCanvas.height * footerImgWidth) / footerCanvas.width\n        const footerY = pageHeight - footerImgHeight - marginBottomMm\n        \n        // Remplacer les variables de pagination dans le footer si nécessaire\n        // (cela nécessiterait de recapturer le footer avec les bonnes valeurs, mais pour l'instant on garde simple)\n        \n        page.addImage(footerImgData, 'PNG', 0, footerY, footerImgWidth, footerImgHeight, undefined, 'FAST')\n        console.log(`[PDF Generator] Footer ajouté sur la page ${pageNum}/${totalPages} à ${footerY}mm du bas`)\n      } catch (error) {\n        console.warn('[PDF Generator] Erreur lors de l\\'ajout du footer:', error)\n      }\n    }\n  }\n\n  // Ajouter la première page (avec header si présent)\n  const imgDataToUseFirst = imgDataFirstPage\n  try {\n    pdf.addImage(imgDataToUseFirst, 'PNG', 0, position, imgWidth, imgHeight, undefined, 'FAST')\n    addFooterToPage(pdf, pageNumber, totalPages)\n  } catch (error) {\n    console.error('Erreur lors de l\\'ajout de l\\'image au PDF:', error)\n    if (imgDataToUseFirst.startsWith('data:image/png')) {\n      const jpegData = canvas.toDataURL('image/jpeg', 0.95)\n      pdf.addImage(jpegData, 'JPEG', 0, position, imgWidth, imgHeight, undefined, 'FAST')\n      addFooterToPage(pdf, pageNumber, totalPages)\n    } else {\n      throw error\n    }\n  }\n\n  heightLeft -= pageHeight\n  pageNumber++\n\n  // Ajouter les pages supplémentaires si nécessaire\n  const imgDataToUseOther = imgDataOtherPages || imgDataFirstPage\n  while (heightLeft >= 0) {\n    position = heightLeft - imgHeight\n    pdf.addPage()\n    \n    // Pour les pages suivantes, utiliser l'image sans header si disponible\n    try {\n      pdf.addImage(imgDataToUseOther, 'PNG', 0, position, imgWidth, imgHeight, undefined, 'FAST')\n      addFooterToPage(pdf, pageNumber, totalPages)\n    } catch (error) {\n      if (imgDataToUseOther.startsWith('data:image/png')) {\n        const jpegData = imgDataToUseOther.replace('data:image/png', 'data:image/jpeg')\n        pdf.addImage(jpegData, 'JPEG', 0, position, imgWidth, imgHeight, undefined, 'FAST')\n        addFooterToPage(pdf, pageNumber, totalPages)\n      }\n    }\n    heightLeft -= pageHeight\n    pageNumber++\n  }\n\n  return pdf.output('blob')\n}\n\n/**\n * Crée un fichier ZIP contenant plusieurs PDFs\n */\nexport async function createZipFromPDFs(\n  files: Array<{ name: string; blob: Blob }>,\n  zipFilename: string = 'documents.zip'\n): Promise<void> {\n  const zip = new JSZip()\n\n  // Ajouter chaque PDF au ZIP\n  for (const file of files) {\n    zip.file(file.name, file.blob)\n  }\n\n  // Générer le ZIP et le télécharger\n  const zipBlob = await zip.generateAsync({ type: 'blob' })\n  const url = URL.createObjectURL(zipBlob)\n  const link = document.createElement('a')\n  link.href = url\n  link.download = zipFilename\n  document.body.appendChild(link)\n  link.click()\n  document.body.removeChild(link)\n  URL.revokeObjectURL(url)\n}\n\n"],"names":[],"mappings":"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"}