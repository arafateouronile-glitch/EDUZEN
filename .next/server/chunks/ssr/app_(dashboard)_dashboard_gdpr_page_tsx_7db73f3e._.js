module.exports=[497829,a=>{"use strict";var b=a.i(187924),c=a.i(433217),d=a.i(937927),e=a.i(913216),f=a.i(269240);let g=new class{supabase;constructor(a){this.supabase=a||(0,f.createClient)()}async getUserConsents(a,b){let{data:c,error:d}=await this.supabase.from("gdpr_consents").select("*").eq("organization_id",a).eq("user_id",b).order("created_at",{ascending:!1});if(d)throw d;return c||[]}async updateConsent(a){let b={...a,updated_at:new Date().toISOString()};a.granted?(b.granted_at=new Date().toISOString(),b.withdrawn_at=null):b.withdrawn_at=new Date().toISOString();let{data:c,error:d}=await this.supabase.from("gdpr_consents").upsert(b,{onConflict:"organization_id,user_id,consent_type"}).select().single();if(d)throw d;return c}async getProcessingRegistry(a){let{data:b,error:c}=await this.supabase.from("gdpr_processing_registry").select("*").eq("organization_id",a).eq("status","active").order("processing_name",{ascending:!0});if(c){if("PGRST200"===c.code||404===c.status||c.message?.includes("does not exist"))return[];throw c}return b||[]}async upsertProcessingRegistry(a){let{data:b,error:c}=await this.supabase.from("gdpr_processing_registry").upsert(a,{onConflict:"id"}).select().single();if(c)throw c;return b}async createDataSubjectRequest(a){let{data:b,error:c}=await this.supabase.from("gdpr_data_subject_requests").insert(a).select().single();if(c)throw c;return b}async getDataSubjectRequests(a,b){let c=this.supabase.from("gdpr_data_subject_requests").select("*").eq("organization_id",a);b?.userId&&(c=c.eq("user_id",b.userId)),b?.requestType&&(c=c.eq("request_type",b.requestType)),b?.status&&(c=c.eq("request_status",b.status));let{data:d,error:e}=await c.order("request_date",{ascending:!1});if(e){if("PGRST200"===e.code||404===e.status||e.message?.includes("does not exist"))return[];throw e}return d||[]}async exportUserData(a,b){let c={profile:await this.getUserProfile(b),enrollments:await this.getUserEnrollments(b),payments:await this.getUserPayments(a,b),documents:await this.getUserDocuments(a,b),consents:await this.getUserConsents(a,b)},{data:d,error:e}=await this.supabase.from("gdpr_data_exports").insert({organization_id:a,user_id:b,export_format:"json",file_url:"",data_categories:Object.keys(c),created_by:(await this.supabase.auth.getUser()).data.user?.id||""}).select().single();if(e)throw e;return{exportId:d.id,fileUrl:d.file_url||""}}async deleteUserData(a,b,c="anonymization"){let{data:d,error:e}=await this.supabase.from("gdpr_data_deletions").insert({organization_id:a,user_id:b,deletion_type:c,data_categories:["all"],deletion_status:"pending",performed_by:(await this.supabase.auth.getUser()).data.user?.id||""}).select().single();if(e)throw e;return{deletionId:d.id,status:d.deletion_status}}async getDataBreaches(a){let{data:b,error:c}=await this.supabase.from("gdpr_data_breaches").select("*").eq("organization_id",a).order("breach_date",{ascending:!1});if(c){if("PGRST200"===c.code||404===c.status||c.message?.includes("does not exist"))return[];throw c}return b||[]}async createDataBreach(a){let{data:b,error:c}=await this.supabase.from("gdpr_data_breaches").insert(a).select().single();if(c)throw c;return b}async notifyCNIL(a){let{error:b}=await this.supabase.from("gdpr_data_breaches").update({cnil_notified:!0,cnil_notification_date:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",a);if(b)throw b}async getUserProfile(a){let{data:b}=await this.supabase.from("users").select("*").eq("id",a).single();return b}async getUserEnrollments(a){let{data:b}=await this.supabase.from("enrollments").select("*").eq("student_id",a);return b||[]}async getUserPayments(a,b){let{data:c}=await this.supabase.from("payments").select("*").eq("organization_id",a).eq("student_id",b);return c||[]}async getUserDocuments(a,b){let{data:c}=await this.supabase.from("generated_documents").select("*").eq("organization_id",a).eq("student_id",b);return c||[]}};var h=a.i(703130),i=a.i(340695),j=a.i(254161),k=a.i(621958),l=a.i(864037),m=a.i(603314),n=a.i(111269),o=a.i(641710),p=a.i(290821),q=a.i(104720),r=a.i(669520),s=a.i(915618),t=a.i(177156),u=a.i(220494),v=a.i(943108),w=a.i(238246),x=a.i(497895);let y={pending:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800",open:"bg-red-100 text-red-800",investigating:"bg-yellow-100 text-yellow-800",remediated:"bg-green-100 text-green-800",closed:"bg-gray-100 text-gray-800"},z={low:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",critical:"bg-red-100 text-red-800"};function A(){let{user:a}=(0,e.useAuth)();(0,d.useQueryClient)();let{addToast:f}=(0,l.useToast)(),{data:A=[],isLoading:B}=(0,c.useQuery)({queryKey:["gdpr-data-requests",a?.organization_id],queryFn:()=>g.getDataSubjectRequests(a.organization_id),enabled:!!a?.organization_id}),{data:C=[],isLoading:D}=(0,c.useQuery)({queryKey:["gdpr-data-breaches",a?.organization_id],queryFn:()=>g.getDataBreaches(a.organization_id),enabled:!!a?.organization_id}),{data:E=[],isLoading:F}=(0,c.useQuery)({queryKey:["gdpr-processing-registry",a?.organization_id],queryFn:()=>g.getProcessingRegistry(a.organization_id),enabled:!!a?.organization_id}),G={totalRequests:A.length,pendingRequests:A.filter(a=>"pending"===a.request_status||"in_progress"===a.request_status).length,totalBreaches:C.length,openBreaches:C.filter(a=>"open"===a.status||"investigating"===a.status).length,totalProcessings:E.length};return B||D||F?(0,b.jsx)("div",{className:"container mx-auto py-8 px-4",children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)(r.RefreshCw,{className:"h-8 w-8 animate-spin text-brand-blue"})})}):(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-2",children:[(0,b.jsx)(m.Shield,{className:"h-8 w-8 text-brand-blue"}),"Conformité RGPD"]}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Gérez la conformité RGPD : consentements, registre des traitements, demandes des personnes concernées"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,b.jsx)(h.Card,{children:(0,b.jsx)(h.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Demandes en attente"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:G.pendingRequests})]}),(0,b.jsx)(o.Clock,{className:"h-8 w-8 text-yellow-500"})]})})}),(0,b.jsx)(h.Card,{children:(0,b.jsx)(h.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Violations ouvertes"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:G.openBreaches})]}),(0,b.jsx)(p.AlertCircle,{className:"h-8 w-8 text-red-500"})]})})}),(0,b.jsx)(h.Card,{children:(0,b.jsx)(h.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Traitements actifs"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:G.totalProcessings})]}),(0,b.jsx)(u.Database,{className:"h-8 w-8 text-blue-500"})]})})}),(0,b.jsx)(h.Card,{children:(0,b.jsx)(h.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total demandes"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:G.totalRequests})]}),(0,b.jsx)(q.FileText,{className:"h-8 w-8 text-green-500"})]})})})]}),(0,b.jsxs)(k.Tabs,{defaultValue:"requests",className:"space-y-6",children:[(0,b.jsxs)(k.TabsList,{children:[(0,b.jsx)(k.TabsTrigger,{value:"requests",children:"Demandes de droits"}),(0,b.jsx)(k.TabsTrigger,{value:"breaches",children:"Violations de données"}),(0,b.jsx)(k.TabsTrigger,{value:"registry",children:"Registre des traitements"}),(0,b.jsx)(k.TabsTrigger,{value:"consents",children:"Consentements"})]}),(0,b.jsx)(k.TabsContent,{value:"requests",children:(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.CardTitle,{children:"Demandes des personnes concernées"}),(0,b.jsx)(h.CardDescription,{children:"Gestion des demandes d'accès, rectification, effacement et portabilité"})]}),(0,b.jsx)(i.Button,{asChild:!0,children:(0,b.jsxs)(w.default,{href:"/dashboard/gdpr/requests/new",children:[(0,b.jsx)(s.Plus,{className:"h-4 w-4 mr-2"}),"Nouvelle demande"]})})]})}),(0,b.jsx)(h.CardContent,{children:0===A.length?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(q.FileText,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:"Aucune demande de droits RGPD enregistrée"})]}):(0,b.jsx)("div",{className:"space-y-4",children:A.map(a=>(0,b.jsx)(h.Card,{className:"hover:shadow-md transition-shadow",children:(0,b.jsx)(h.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:a.request_type.replace(/_/g," ").toUpperCase()}),(0,b.jsx)(j.Badge,{className:y[a.request_status],children:a.request_status.replace(/_/g," ")}),!a.identity_verified&&(0,b.jsx)(j.Badge,{variant:"outline",className:"bg-yellow-50",children:"Vérification requise"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Demandeur"}),(0,b.jsx)("p",{className:"font-medium",children:a.requested_by_name}),(0,b.jsx)("p",{className:"text-muted-foreground",children:a.requested_by_email})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Date de demande"}),(0,b.jsx)("p",{className:"font-medium",children:(0,x.formatDateTime)(a.request_date)})]}),a.completed_at&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Date de traitement"}),(0,b.jsx)("p",{className:"font-medium",children:(0,x.formatDateTime)(a.completed_at)})]})]}),a.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:a.description})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)(i.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,b.jsxs)(w.default,{href:`/dashboard/gdpr/requests/${a.id}`,children:[(0,b.jsx)(t.Eye,{className:"h-4 w-4 mr-2"}),"Voir"]})})})]})})},a.id))})})]})}),(0,b.jsx)(k.TabsContent,{value:"breaches",children:(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.CardTitle,{children:"Violations de données"}),(0,b.jsx)(h.CardDescription,{children:"Gestion des violations de données personnelles (Article 33-34 RGPD)"})]}),(0,b.jsx)(i.Button,{asChild:!0,children:(0,b.jsxs)(w.default,{href:"/dashboard/gdpr/breaches/new",children:[(0,b.jsx)(s.Plus,{className:"h-4 w-4 mr-2"}),"Déclarer une violation"]})})]})}),(0,b.jsx)(h.CardContent,{children:0===C.length?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(v.Lock,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:"Aucune violation de données déclarée"})]}):(0,b.jsx)("div",{className:"space-y-4",children:C.map(a=>(0,b.jsx)(h.Card,{className:"hover:shadow-md transition-shadow",children:(0,b.jsx)(h.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold",children:["Violation ",a.breach_type]}),(0,b.jsx)(j.Badge,{className:z[a.severity],children:a.severity}),(0,b.jsx)(j.Badge,{className:y[a.status],children:a.status})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:a.description}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Date de violation"}),(0,b.jsx)("p",{className:"font-medium",children:(0,x.formatDate)(a.breach_date)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Découverte"}),(0,b.jsx)("p",{className:"font-medium",children:(0,x.formatDate)(a.discovery_date)})]}),a.affected_data_subjects_count&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Personnes concernées"}),(0,b.jsx)("p",{className:"font-medium",children:a.affected_data_subjects_count})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"CNIL notifiée"}),(0,b.jsx)("p",{className:"font-medium",children:a.cnil_notified?(0,b.jsx)(n.CheckCircle2,{className:"h-4 w-4 text-green-500 inline"}):(0,b.jsx)(p.AlertCircle,{className:"h-4 w-4 text-red-500 inline"})})]})]})]}),(0,b.jsx)(i.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,b.jsx)(w.default,{href:`/dashboard/gdpr/breaches/${a.id}`,children:"Voir les détails"})})]})})},a.id))})})]})}),(0,b.jsx)(k.TabsContent,{value:"registry",children:(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.CardTitle,{children:"Registre des traitements"}),(0,b.jsx)(h.CardDescription,{children:"Article 30 RGPD - Registre des activités de traitement"})]}),(0,b.jsx)(i.Button,{asChild:!0,children:(0,b.jsxs)(w.default,{href:"/dashboard/gdpr/registry/new",children:[(0,b.jsx)(s.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter un traitement"]})})]})}),(0,b.jsx)(h.CardContent,{children:0===E.length?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(u.Database,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:"Aucun traitement enregistré"}),(0,b.jsx)(i.Button,{asChild:!0,children:(0,b.jsxs)(w.default,{href:"/dashboard/gdpr/registry/new",children:[(0,b.jsx)(s.Plus,{className:"h-4 w-4 mr-2"}),"Créer le premier traitement"]})})]}):(0,b.jsx)("div",{className:"space-y-4",children:E.map(a=>(0,b.jsx)(h.Card,{className:"hover:shadow-md transition-shadow",children:(0,b.jsx)(h.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:a.processing_name}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:a.processing_purpose}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Base légale"}),(0,b.jsx)("p",{className:"font-medium",children:a.legal_basis.replace(/_/g," ")})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Catégories de données"}),(0,b.jsx)("p",{className:"font-medium",children:a.data_categories.length})]}),a.retention_period&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-muted-foreground",children:"Conservation"}),(0,b.jsx)("p",{className:"font-medium",children:a.retention_period})]})]})]}),(0,b.jsx)(i.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,b.jsx)(w.default,{href:`/dashboard/gdpr/registry/${a.id}`,children:"Voir les détails"})})]})})},a.id))})})]})}),(0,b.jsx)(k.TabsContent,{value:"consents",children:(0,b.jsxs)(h.Card,{children:[(0,b.jsxs)(h.CardHeader,{children:[(0,b.jsx)(h.CardTitle,{children:"Gestion des consentements"}),(0,b.jsx)(h.CardDescription,{children:"Consultez et gérez les consentements RGPD des utilisateurs"})]}),(0,b.jsx)(h.CardContent,{children:(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(m.Shield,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:"Fonctionnalité en cours de développement"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"La gestion détaillée des consentements sera disponible prochainement"})]})})]})})]}),(0,b.jsxs)("div",{className:"mt-8 flex gap-4",children:[(0,b.jsx)(i.Button,{variant:"outline",asChild:!0,children:(0,b.jsxs)(w.default,{href:"/dashboard/gdpr/reports",children:[(0,b.jsx)(q.FileText,{className:"h-4 w-4 mr-2"}),"Rapports de conformité"]})}),(0,b.jsx)(i.Button,{variant:"outline",asChild:!0,children:(0,b.jsxs)(w.default,{href:"/dashboard/gdpr/settings",children:[(0,b.jsx)(m.Shield,{className:"h-4 w-4 mr-2"}),"Paramètres RGPD"]})})]})]})}a.s(["default",()=>A],497829)}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_gdpr_page_tsx_7db73f3e._.js.map