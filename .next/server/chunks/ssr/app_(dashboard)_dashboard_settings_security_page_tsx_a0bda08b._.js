module.exports=[201727,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(292116),i=a.i(340695),j=a.i(703130),k=a.i(205522),l=a.i(917171),m=a.i(280281),n=a.i(864037),o=a.i(603314),p=a.i(495756),q=a.i(290821),r=a.i(284505),s=a.i(669520),t=a.i(481402),u=a.i(114548),v=a.i(965733);function w(){let{user:a}=(0,g.useAuth)(),m=(0,f.useQueryClient)(),{addToast:u}=(0,n.useToast)(),[w,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(!1),{data:G,isLoading:H}=(0,d.useQuery)({queryKey:["2fa-config",a?.id],queryFn:async()=>a?.id?h.twoFactorAuthService.getConfig(a.id):null,enabled:!!a?.id}),I=(0,e.useMutation)({mutationFn:async()=>{let a=await fetch("/api/2fa/generate-secret",{method:"POST"});if(!a.ok)throw Error((await a.json()).error||"Erreur lors de la génération du secret");return a.json()},onSuccess:a=>{m.invalidateQueries({queryKey:["2fa-config"]}),z(!0),u({type:"success",title:"Secret généré",description:"Scannez le QR code avec votre application d'authentification."})},onError:a=>{u({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue."})}}),J=(0,e.useMutation)({mutationFn:async a=>{let b=await fetch("/api/2fa/verify-activation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:a})});if(!b.ok)throw Error((await b.json()).error||"Code invalide");return b.json()},onSuccess:()=>{m.invalidateQueries({queryKey:["2fa-config"]}),B(""),z(!1),u({type:"success",title:"2FA activée",description:"L'authentification à deux facteurs est maintenant activée."})},onError:a=>{u({type:"error",title:"Code invalide",description:a.message||"Le code saisi est incorrect."})}}),K=(0,e.useMutation)({mutationFn:async a=>{let b=await fetch("/api/2fa/disable",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:a})});if(!b.ok)throw Error((await b.json()).error||"Erreur lors de la désactivation");return b.json()},onSuccess:()=>{m.invalidateQueries({queryKey:["2fa-config"]}),D(""),F(!1),u({type:"success",title:"2FA désactivée",description:"L'authentification à deux facteurs a été désactivée."})},onError:a=>{u({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue."})}}),L=(0,e.useMutation)({mutationFn:async()=>{let a=await fetch("/api/2fa/regenerate-backup-codes",{method:"POST"});if(!a.ok)throw Error((await a.json()).error||"Erreur lors de la régénération");return a.json()},onSuccess:a=>{z(!0),u({type:"success",title:"Codes régénérés",description:"Nouveaux codes de récupération générés."})},onError:a=>{u({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue."})}});if(H)return(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)("div",{className:"text-muted-foreground",children:"Chargement..."})})});let M=G?.is_enabled||!1;G?.is_verified;let N=!!I.data;return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[(0,b.jsx)(o.Shield,{className:"mr-3 h-8 w-8 text-primary"}),"Sécurité"]}),(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Gérez votre authentification à deux facteurs (2FA) pour renforcer la sécurité de votre compte"})]}),(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(j.CardTitle,{children:"Authentification à deux facteurs (2FA)"}),(0,b.jsx)(j.CardDescription,{children:"Ajoutez une couche de sécurité supplémentaire à votre compte"})]}),(0,b.jsxs)(j.CardContent,{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:(0,b.jsx)("div",{className:"flex items-center space-x-3",children:M?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.CheckCircle,{className:"h-5 w-5 text-green-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-green-800",children:"2FA Activée"}),G?.last_used_at&&(0,b.jsxs)("p",{className:"text-sm text-green-600",children:["Dernière utilisation: ",new Date(G.last_used_at).toLocaleString("fr-FR")]})]})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.AlertCircle,{className:"h-5 w-5 text-gray-400"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-gray-800",children:"2FA Désactivée"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Votre compte n'est pas protégé par l'authentification à deux facteurs"})]})]})})}),!M&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold mb-2",children:"Activer la 2FA"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Scannez le QR code avec une application d'authentification comme Google Authenticator ou Authy."}),(0,b.jsxs)(i.Button,{onClick:()=>{I.mutate()},disabled:I.isPending,children:[(0,b.jsx)(t.Key,{className:"h-4 w-4 mr-2"}),N?"Régénérer le QR code":"Générer le QR code"]})]}),I.data?.qrCodeUrl&&(0,b.jsxs)("div",{className:"space-y-4 p-4 bg-gray-50 rounded-lg",children:[(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsx)("img",{src:I.data.qrCodeUrl,alt:"QR Code 2FA",className:"w-64 h-64"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Code secret (manuel)"}),(0,b.jsxs)("div",{className:"flex items-center space-x-2 mt-2",children:[(0,b.jsx)(k.Input,{value:I.data.secret,readOnly:!0,className:"font-mono text-sm"}),(0,b.jsx)(i.Button,{variant:"outline",size:"icon",onClick:()=>{navigator.clipboard.writeText(I.data.secret),u({type:"success",title:"Copié",description:"Le secret a été copié dans le presse-papiers."})},children:(0,b.jsx)(t.Key,{className:"h-4 w-4"})})]})]}),w&&I.data.backupCodes&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{children:"Codes de récupération"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Conservez ces codes en lieu sûr. Vous en aurez besoin si vous perdez l'accès à votre application d'authentification."}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2 p-4 bg-white rounded border",children:I.data.backupCodes.map((a,c)=>(0,b.jsx)("div",{className:"font-mono text-sm text-center",children:a},c))}),(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>{let a=new Blob([I.data.backupCodes.join("\n")],{type:"text/plain"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download="eduzen-backup-codes.txt",c.click(),URL.revokeObjectURL(b)},children:[(0,b.jsx)(r.Download,{className:"h-4 w-4 mr-2"}),"Télécharger les codes"]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{children:"Vérifier l'activation"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Entrez le code à 6 chiffres affiché dans votre application d'authentification pour confirmer l'activation."}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(k.Input,{type:"text",inputMode:"numeric",maxLength:6,value:A,onChange:a=>B(a.target.value.replace(/\D/g,"")),placeholder:"000000",className:"font-mono text-center text-2xl tracking-widest"}),(0,b.jsxs)(i.Button,{onClick:()=>{6!==A.length?u({type:"error",title:"Code invalide",description:"Le code doit contenir 6 chiffres."}):J.mutate(A)},disabled:J.isPending||6!==A.length,children:[J.isPending?(0,b.jsx)(s.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(p.CheckCircle,{className:"h-4 w-4 mr-2"}),"Vérifier"]})]})]})]})]}),M&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold mb-2",children:"Désactiver la 2FA"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Vous devrez entrer votre mot de passe pour désactiver l'authentification à deux facteurs."}),(0,b.jsx)(i.Button,{variant:"destructive",onClick:()=>F(!0),children:"Désactiver la 2FA"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold mb-2",children:"Codes de récupération"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Régénérez vos codes de récupération si vous les avez perdus ou utilisés."}),(0,b.jsxs)(i.Button,{variant:"outline",onClick:()=>L.mutate(),disabled:L.isPending,children:[(0,b.jsx)(s.RefreshCw,{className:"h-4 w-4 mr-2"}),"Régénérer les codes"]})]}),w&&L.data?.backupCodes&&(0,b.jsxs)("div",{className:"space-y-2 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[(0,b.jsx)(l.Label,{className:"text-yellow-800",children:"Nouveaux codes de récupération"}),(0,b.jsx)("p",{className:"text-sm text-yellow-700 mb-2",children:"Conservez ces codes en lieu sûr. Les anciens codes ne fonctionneront plus."}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-2 p-4 bg-white rounded border",children:L.data.backupCodes.map((a,c)=>(0,b.jsx)("div",{className:"font-mono text-sm text-center",children:a},c))}),(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",onClick:()=>{let a=new Blob([L.data.backupCodes.join("\n")],{type:"text/plain"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download="eduzen-backup-codes.txt",c.click(),URL.revokeObjectURL(b)},children:[(0,b.jsx)(r.Download,{className:"h-4 w-4 mr-2"}),"Télécharger les codes"]})]})]})]})]}),(0,b.jsx)(v.Dialog,{open:E,onOpenChange:F,children:(0,b.jsxs)(v.DialogContent,{children:[(0,b.jsxs)(v.DialogHeader,{children:[(0,b.jsx)(v.DialogTitle,{children:"Désactiver la 2FA"}),(0,b.jsx)(v.DialogDescription,{children:"Entrez votre mot de passe pour confirmer la désactivation de l'authentification à deux facteurs."})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"disable-password",children:"Mot de passe"}),(0,b.jsx)(k.Input,{id:"disable-password",type:"password",value:C,onChange:a=>D(a.target.value),placeholder:"Votre mot de passe",className:"mt-2"})]}),(0,b.jsxs)("div",{className:"flex justify-end space-x-2",children:[(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>{F(!1),D("")},children:"Annuler"}),(0,b.jsxs)(i.Button,{variant:"destructive",onClick:()=>{C?K.mutate(C):u({type:"error",title:"Mot de passe requis",description:"Veuillez entrer votre mot de passe."})},disabled:K.isPending||!C,children:[K.isPending?(0,b.jsx)(s.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}):null,"Désactiver"]})]})]})]})}),(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(j.CardTitle,{children:"Sessions actives"}),(0,b.jsx)(j.CardDescription,{children:"Gérez vos sessions actives sur différents appareils"})]}),(0,b.jsx)(j.CardContent,{children:(0,b.jsx)(x,{})})]}),(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(j.CardTitle,{children:"Règles de timeout"}),(0,b.jsx)(j.CardDescription,{children:"Configurez les règles de timeout et de gestion des sessions"})]}),(0,b.jsx)(j.CardContent,{children:(0,b.jsx)(y,{})})]})]})}function x(){let{user:a}=(0,g.useAuth)(),c=(0,f.useQueryClient)(),{addToast:h}=(0,n.useToast)(),{data:j,isLoading:k,refetch:l}=(0,d.useQuery)({queryKey:["active-sessions",a?.id],queryFn:async()=>{let a=await fetch("/api/sessions/active");if(!a.ok)throw Error("Erreur lors de la récupération des sessions");return(await a.json()).sessions||[]},enabled:!!a?.id}),m=(0,e.useMutation)({mutationFn:async a=>{let b=await fetch("/api/sessions/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:a})});if(!b.ok)throw Error((await b.json()).error||"Erreur lors de la révocation")},onSuccess:()=>{c.invalidateQueries({queryKey:["active-sessions"]}),h({type:"success",title:"Session révoquée",description:"La session a été révoquée avec succès."})},onError:a=>{h({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue."})}}),o=(0,e.useMutation)({mutationFn:async()=>{let a=await fetch("/api/sessions/revoke",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({revoke_all:!0})});if(!a.ok)throw Error((await a.json()).error||"Erreur lors de la révocation")},onSuccess:()=>{c.invalidateQueries({queryKey:["active-sessions"]}),h({type:"success",title:"Toutes les sessions révoquées",description:"Toutes les sessions ont été révoquées avec succès."})},onError:a=>{h({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue."})}});return k?(0,b.jsx)("div",{className:"text-center text-muted-foreground",children:"Chargement..."}):j&&0!==j.length?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>o.mutate(),disabled:o.isPending,children:"Révoquer toutes les sessions"})}),(0,b.jsx)("div",{className:"space-y-2",children:j.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("p",{className:"font-semibold",children:a.device_name}),a.is_current&&(0,b.jsx)("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-1 rounded",children:"Session actuelle"})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.device_type," • ",a.ip_address," • ",a.country||"Inconnu"]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Dernière activité: ",new Date(a.last_activity_at).toLocaleString("fr-FR")]})]}),!a.is_current&&(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>m.mutate(a.id),disabled:m.isPending,children:"Révoquer"})]},a.id))})]}):(0,b.jsx)("div",{className:"text-center text-muted-foreground",children:"Aucune session active"})}function y(){let{user:a}=(0,g.useAuth)(),h=(0,f.useQueryClient)(),{addToast:j}=(0,n.useToast)(),{data:o,isLoading:p}=(0,d.useQuery)({queryKey:["timeout-rules",a?.organization_id],queryFn:async()=>{let a=await fetch("/api/sessions/timeout-rules");if(!a.ok)throw Error("Erreur lors de la récupération des règles");return(await a.json()).rules},enabled:!!a?.organization_id}),[q,r]=(0,c.useState)({idle_timeout_minutes:o?.idle_timeout_minutes||30,absolute_timeout_minutes:o?.absolute_timeout_minutes||480,max_concurrent_sessions:o?.max_concurrent_sessions||5,allow_multiple_devices:o?.allow_multiple_devices!==!1,require_device_verification:o?.require_device_verification||!1,notify_on_new_device:o?.notify_on_new_device!==!1,notify_on_suspicious_activity:o?.notify_on_suspicious_activity!==!1});(0,c.useEffect)(()=>{o&&r({idle_timeout_minutes:o.idle_timeout_minutes||30,absolute_timeout_minutes:o.absolute_timeout_minutes||480,max_concurrent_sessions:o.max_concurrent_sessions||5,allow_multiple_devices:!1!==o.allow_multiple_devices,require_device_verification:o.require_device_verification||!1,notify_on_new_device:!1!==o.notify_on_new_device,notify_on_suspicious_activity:!1!==o.notify_on_suspicious_activity})},[o]);let s=(0,e.useMutation)({mutationFn:async()=>{let a=await fetch("/api/sessions/timeout-rules",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(q)});if(!a.ok)throw Error((await a.json()).error||"Erreur lors de la sauvegarde");return a.json()},onSuccess:()=>{h.invalidateQueries({queryKey:["timeout-rules"]}),j({type:"success",title:"Règles sauvegardées",description:"Les règles de timeout ont été sauvegardées avec succès."})},onError:a=>{j({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue."})}});return p?(0,b.jsx)("div",{className:"text-center text-muted-foreground",children:"Chargement..."}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"idle-timeout",children:"Timeout d'inactivité (minutes)"}),(0,b.jsx)(k.Input,{id:"idle-timeout",type:"number",value:q.idle_timeout_minutes,onChange:a=>r({...q,idle_timeout_minutes:parseInt(a.target.value)||30}),min:5,max:1440}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Temps d'inactivité avant déconnexion automatique"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"absolute-timeout",children:"Timeout absolu (minutes)"}),(0,b.jsx)(k.Input,{id:"absolute-timeout",type:"number",value:q.absolute_timeout_minutes,onChange:a=>r({...q,absolute_timeout_minutes:parseInt(a.target.value)||480}),min:60,max:10080}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Durée maximale d'une session (même avec activité)"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"max-sessions",children:"Nombre maximum de sessions simultanées"}),(0,b.jsx)(k.Input,{id:"max-sessions",type:"number",value:q.max_concurrent_sessions,onChange:a=>r({...q,max_concurrent_sessions:parseInt(a.target.value)||5}),min:1,max:20})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Autoriser plusieurs appareils"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Permettre aux utilisateurs d'être connectés sur plusieurs appareils simultanément"})]}),(0,b.jsx)(m.Switch,{checked:q.allow_multiple_devices,onCheckedChange:a=>r({...q,allow_multiple_devices:a})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Vérification des appareils"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Exiger une vérification pour les nouveaux appareils"})]}),(0,b.jsx)(m.Switch,{checked:q.require_device_verification,onCheckedChange:a=>r({...q,require_device_verification:a})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Notifier nouveaux appareils"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Envoyer une notification lors d'une connexion depuis un nouvel appareil"})]}),(0,b.jsx)(m.Switch,{checked:q.notify_on_new_device,onCheckedChange:a=>r({...q,notify_on_new_device:a})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Notifier activité suspecte"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Envoyer une notification en cas d'activité suspecte détectée"})]}),(0,b.jsx)(m.Switch,{checked:q.notify_on_suspicious_activity,onCheckedChange:a=>r({...q,notify_on_suspicious_activity:a})})]})]}),(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)(i.Button,{onClick:()=>s.mutate(),disabled:s.isPending,children:[(0,b.jsx)(u.Save,{className:"h-4 w-4 mr-2"}),"Sauvegarder les règles"]})})]})}a.s(["default",()=>w])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_settings_security_page_tsx_a0bda08b._.js.map