module.exports=[726786,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(433217),f=a.i(370025),g=a.i(937927),h=a.i(695245),i=a.i(159501),j=a.i(88780),k=a.i(913216),l=a.i(266275),m=a.i(269240),n=a.i(340695),o=a.i(219897),p=a.i(400210),q=a.i(114548),r=a.i(915618),s=a.i(134148),t=a.i(838632),u=a.i(539833),v=a.i(255225),w=a.i(633508),x=a.i(784581),y=a.i(773320),z=a.i(526017),A=a.i(238246),B=a.i(864037);a.i(460355);var C=a.i(346271),D=a.i(262036),E=a.i(497895);let F=j.z.object({title:j.z.string().min(3,"Le titre doit contenir au moins 3 caractères"),slug:j.z.string().min(3,"Le slug doit contenir au moins 3 caractères").regex(/^[a-z0-9-]+$/,"Le slug ne peut contenir que des lettres minuscules, chiffres et tirets"),description:j.z.string().optional(),section_id:j.z.string().optional(),order_index:j.z.number().min(0).default(0)});function G(){let a=(0,d.useParams)(),j=(0,d.useRouter)(),G=a.slug,{user:H}=(0,k.useAuth)(),{addToast:I}=(0,B.useToast)(),J=(0,g.useQueryClient)(),K=(0,m.createClient)(),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)({}),{data:R}=(0,e.useQuery)({queryKey:["course",G,H?.organization_id],queryFn:async()=>await l.elearningService.getCourseBySlug(G,H?.organization_id||""),enabled:!!G&&!!H?.organization_id}),{data:S}=(0,e.useQuery)({queryKey:["course-sections",R?.id],queryFn:async()=>await l.elearningService.getCourseSections(R?.id||""),enabled:!!R?.id}),{register:T,handleSubmit:U,formState:{errors:V},watch:W,setValue:X}=(0,h.useForm)({resolver:(0,i.zodResolver)(F),mode:"onChange",defaultValues:{order_index:0}});W("title");let Y=a=>{M([...L,{id:Math.random().toString(36).substr(2,9),type:a,data:{content:"text"===a?"":void 0,mediaType:"media"===a?"image":void 0,question:"quiz"===a?"":void 0,pollQuestion:"poll"===a?"":void 0,options:"quiz"===a?[{id:"1",text:"",isCorrect:!1}]:void 0,pollOptions:"poll"===a?[{id:"1",text:""}]:void 0,points:"quiz"===a?1:void 0}}]),O(!1)},Z=(a,b)=>{M(L.map(c=>c.id===a?{...c,data:{...c.data,...b}}:c))},$=async(a,b)=>{if(!H?.organization_id)return void I({type:"error",title:"Erreur",description:"Organisation manquante"});Q(b=>({...b,[a]:!0}));try{let c=b.name.split(".").pop(),d=`${H.organization_id}/elearning/lessons/${Date.now()}-${Math.random().toString(36).substring(7)}.${c}`,e=null,f=null;for(let a of["elearning-media","course-media","course-thumbnails"]){let{error:c}=await K.storage.from(a).upload(d,b,{cacheControl:"3600",upsert:!1});if(!c){e=a,f=null;break}f=c}if(!e)throw f||Error("Échec de l'upload sur tous les buckets disponibles.");let{data:g}=K.storage.from(e).getPublicUrl(d);Z(a,{mediaUrl:g.publicUrl}),I({type:"success",title:"Image uploadée",description:"L'image a été uploadée avec succès."})}catch(a){console.error("Erreur lors de l'upload:",a),I({type:"error",title:"Erreur d'upload",description:a?.message||"Une erreur est survenue lors de l'upload de l'image."})}finally{Q(b=>({...b,[a]:!1}))}},_=(0,f.useMutation)({mutationFn:async a=>{if(!R?.id)throw Error("Course ID manquant");let b=JSON.stringify(L);return l.elearningService.createLesson({course_id:R.id,title:a.title,slug:a.slug,description:a.description||null,section_id:a.section_id||null,order_index:a.order_index,lesson_type:"text",content:b,video_url:null,video_duration_minutes:null,is_preview:!1,attachments:null})},onSuccess:a=>{I({type:"success",title:"Leçon créée avec succès",description:"Votre leçon a été créée. Vous pouvez maintenant la modifier."}),J.invalidateQueries({queryKey:["course",G]}),j.push(`/dashboard/elearning/courses/${G}/lessons/${a.slug}/edit`)},onError:a=>{I({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue lors de la création de la leçon"})}});return R?(0,b.jsxs)(C.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-8 pb-8 max-w-6xl mx-auto p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(A.default,{href:`/dashboard/elearning/courses/${G}`,children:(0,b.jsx)(n.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(p.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Nouvelle leçon"}),(0,b.jsxs)("p",{className:"text-gray-500 mt-1",children:['Ajoutez une nouvelle leçon à "',R.title,'"']})]})]}),(0,b.jsxs)("form",{onSubmit:U(a=>{_.mutate(a)}),className:"space-y-6",children:[(0,b.jsxs)(o.GlassCard,{variant:"premium",className:"p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Informations de base"}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Titre de la leçon *"}),(0,b.jsx)("input",{type:"text",...T("title"),onChange:a=>{let b=a.target.value;X("title",b),b&&X("slug",b.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))},className:(0,E.cn)("w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",V.title?"border-red-500":"border-gray-200"),placeholder:"Ex: Introduction à React"}),V.title&&(0,b.jsx)("p",{className:"text-sm text-red-600 mt-1",children:V.title.message})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Slug (URL) *"}),(0,b.jsx)("input",{type:"text",...T("slug"),className:(0,E.cn)("w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all bg-gray-50",V.slug?"border-red-500":"border-gray-200"),placeholder:"introduction-a-react"}),V.slug&&(0,b.jsx)("p",{className:"text-sm text-red-600 mt-1",children:V.slug.message})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,b.jsx)("textarea",{...T("description"),rows:3,className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all resize-none",placeholder:"Description courte de la leçon..."})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Section (optionnel)"}),(0,b.jsxs)("select",{...T("section_id"),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",children:[(0,b.jsx)("option",{value:"",children:"Aucune section"}),S?.map(a=>(0,b.jsx)("option",{value:a.id,children:a.title},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ordre"}),(0,b.jsx)("input",{type:"number",...T("order_index",{valueAsNumber:!0}),min:"0",className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all"})]})]})]})]}),(0,b.jsxs)(o.GlassCard,{variant:"premium",className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Contenu de la leçon"}),(0,b.jsxs)(n.Button,{type:"button",onClick:()=>O(!N),className:"bg-brand-blue hover:bg-brand-blue/90 text-white",children:[(0,b.jsx)(r.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter un élément"]})]}),(0,b.jsx)(D.AnimatePresence,{children:N&&(0,b.jsxs)(C.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Choisir un type de contenu :"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,b.jsxs)("button",{type:"button",onClick:()=>Y("text"),className:"flex flex-col items-center gap-2 p-4 border border-gray-200 rounded-lg hover:border-brand-blue hover:bg-brand-blue-ghost transition-colors",children:[(0,b.jsx)(s.Type,{className:"h-6 w-6 text-brand-blue"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Texte"})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>Y("media"),className:"flex flex-col items-center gap-2 p-4 border border-gray-200 rounded-lg hover:border-brand-blue hover:bg-brand-blue-ghost transition-colors",children:[(0,b.jsx)(t.Image,{className:"h-6 w-6 text-brand-blue"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Média"})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>Y("quiz"),className:"flex flex-col items-center gap-2 p-4 border border-gray-200 rounded-lg hover:border-brand-blue hover:bg-brand-blue-ghost transition-colors",children:[(0,b.jsx)(u.HelpCircle,{className:"h-6 w-6 text-brand-blue"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Quiz"})]}),(0,b.jsxs)("button",{type:"button",onClick:()=>Y("poll"),className:"flex flex-col items-center gap-2 p-4 border border-gray-200 rounded-lg hover:border-brand-blue hover:bg-brand-blue-ghost transition-colors",children:[(0,b.jsx)(v.BarChart3,{className:"h-6 w-6 text-brand-blue"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Sondage"})]})]})]})}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)(D.AnimatePresence,{children:L.map((a,c)=>(0,b.jsxs)(C.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"border border-gray-200 rounded-lg p-4 bg-white",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(x.GripVertical,{className:"h-4 w-4 text-gray-400"}),(0,b.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["text"===a.type&&"Texte","media"===a.type&&"Média","quiz"===a.type&&"Quiz (évaluable)","poll"===a.type&&"Sondage (non évaluable)"]})]}),(0,b.jsx)("button",{type:"button",onClick:()=>{var b;return b=a.id,void M(L.filter(a=>a.id!==b))},className:"p-1 text-red-500 hover:bg-red-50 rounded transition-colors",children:(0,b.jsx)(w.X,{className:"h-4 w-4"})})]}),"text"===a.type&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contenu"}),(0,b.jsx)("textarea",{value:a.data.content||"",onChange:b=>Z(a.id,{content:b.target.value}),rows:6,className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all resize-none",placeholder:"Saisissez votre texte ici (Markdown supporté)..."})]}),"media"===a.type&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type de média"}),(0,b.jsxs)("select",{value:a.data.mediaType||"image",onChange:b=>Z(a.id,{mediaType:b.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",children:[(0,b.jsx)("option",{value:"image",children:"Image"}),(0,b.jsx)("option",{value:"video",children:"Vidéo"}),(0,b.jsx)("option",{value:"audio",children:"Audio"}),(0,b.jsx)("option",{value:"file",children:"Fichier"})]})]}),"image"===a.data.mediaType&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Uploader une image"}),(0,b.jsx)("div",{className:"flex items-center gap-4",children:(0,b.jsxs)("label",{className:"flex-1 cursor-pointer",children:[(0,b.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:b=>{let c=b.target.files?.[0];c&&$(a.id,c)},disabled:P[a.id]}),(0,b.jsx)("div",{className:(0,E.cn)("flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed rounded-lg transition-colors",P[a.id]?"border-gray-300 bg-gray-50":"border-brand-blue/30 hover:border-brand-blue hover:bg-brand-blue-ghost"),children:P[a.id]?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(z.Loader2,{className:"h-5 w-5 text-brand-blue animate-spin"}),(0,b.jsx)("span",{className:"text-sm text-gray-600",children:"Upload en cours..."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(y.Upload,{className:"h-5 w-5 text-brand-blue"}),(0,b.jsx)("span",{className:"text-sm font-medium text-brand-blue",children:"Choisir un fichier"})]})})]})}),a.data.mediaUrl&&(0,b.jsx)("div",{className:"mt-3",children:(0,b.jsx)("img",{src:a.data.mediaUrl,alt:"Aperçu",className:"max-w-full h-auto max-h-64 rounded-lg border border-gray-200"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"image"===a.data.mediaType?"URL de l'image (ou laisser vide si uploadée ci-dessus)":"URL du média"}),(0,b.jsx)("input",{type:"url",value:a.data.mediaUrl||"",onChange:b=>Z(a.id,{mediaUrl:b.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:"https://..."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Légende (optionnel)"}),(0,b.jsx)("input",{type:"text",value:a.data.caption||"",onChange:b=>Z(a.id,{caption:b.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:"Légende du média..."})]})]}),"quiz"===a.type&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question *"}),(0,b.jsx)("input",{type:"text",value:a.data.question||"",onChange:b=>Z(a.id,{question:b.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:"Quelle est la question ?"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Points"}),(0,b.jsx)("input",{type:"number",value:a.data.points||1,onChange:b=>Z(a.id,{points:parseInt(b.target.value)||1}),min:"1",className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Options de réponse *"}),(0,b.jsx)("button",{type:"button",onClick:()=>(a=>{let b=L.find(b=>b.id===a);if(b&&"quiz"===b.type){let c={id:Math.random().toString(36).substr(2,9),text:"",isCorrect:!1};Z(a,{options:[...b.data.options||[],c]})}})(a.id),className:"text-sm text-brand-blue hover:underline",children:"+ Ajouter une option"})]}),(0,b.jsx)("div",{className:"space-y-2",children:a.data.options?.map((c,d)=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:c.isCorrect,onChange:b=>{let d=a.data.options?.map(a=>a.id===c.id?{...a,isCorrect:b.target.checked}:a);Z(a.id,{options:d})},className:"w-4 h-4 text-brand-blue border-gray-300 rounded focus:ring-brand-blue"}),(0,b.jsx)("input",{type:"text",value:c.text,onChange:b=>{let d=a.data.options?.map(a=>a.id===c.id?{...a,text:b.target.value}:a);Z(a.id,{options:d})},className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:`Option ${d+1}`}),a.data.options&&a.data.options.length>1&&(0,b.jsx)("button",{type:"button",onClick:()=>{let b=a.data.options?.filter(a=>a.id!==c.id);Z(a.id,{options:b})},className:"p-1 text-red-500 hover:bg-red-50 rounded transition-colors",children:(0,b.jsx)(w.X,{className:"h-4 w-4"})})]},c.id))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Explication (optionnel)"}),(0,b.jsx)("textarea",{value:a.data.explanation||"",onChange:b=>Z(a.id,{explanation:b.target.value}),rows:2,className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all resize-none",placeholder:"Explication de la réponse correcte..."})]})]}),"poll"===a.type&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question du sondage *"}),(0,b.jsx)("input",{type:"text",value:a.data.pollQuestion||"",onChange:b=>Z(a.id,{pollQuestion:b.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:"Quelle est votre question ?"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Options de réponse *"}),(0,b.jsx)("button",{type:"button",onClick:()=>(a=>{let b=L.find(b=>b.id===a);if(b&&"poll"===b.type){let c={id:Math.random().toString(36).substr(2,9),text:""};Z(a,{pollOptions:[...b.data.pollOptions||[],c]})}})(a.id),className:"text-sm text-brand-blue hover:underline",children:"+ Ajouter une option"})]}),(0,b.jsx)("div",{className:"space-y-2",children:a.data.pollOptions?.map((c,d)=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"text",value:c.text,onChange:b=>{let d=a.data.pollOptions?.map(a=>a.id===c.id?{...a,text:b.target.value}:a);Z(a.id,{pollOptions:d})},className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:`Option ${d+1}`}),a.data.pollOptions&&a.data.pollOptions.length>1&&(0,b.jsx)("button",{type:"button",onClick:()=>{let b=a.data.pollOptions?.filter(a=>a.id!==c.id);Z(a.id,{pollOptions:b})},className:"p-1 text-red-500 hover:bg-red-50 rounded transition-colors",children:(0,b.jsx)(w.X,{className:"h-4 w-4"})})]},c.id))})]})]})]},a.id))}),0===L.length&&(0,b.jsxs)("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:[(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Aucun contenu ajouté"}),(0,b.jsxs)(n.Button,{type:"button",onClick:()=>O(!0),variant:"outline",children:[(0,b.jsx)(r.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter votre premier élément"]})]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,b.jsx)(A.default,{href:`/dashboard/elearning/courses/${G}`,children:(0,b.jsx)(n.Button,{variant:"ghost",type:"button",children:"Annuler"})}),(0,b.jsx)(n.Button,{type:"submit",disabled:_.isPending,className:"bg-brand-blue hover:bg-brand-blue/90 text-white shadow-lg shadow-brand-blue/20",children:_.isPending?(0,b.jsx)(b.Fragment,{children:"Création..."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.Save,{className:"h-4 w-4 mr-2"}),"Créer la leçon"]})})]})]})]}):(0,b.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:(0,b.jsx)("div",{className:"text-center py-12",children:"Chargement..."})})}a.s(["default",()=>G])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_elearning_courses_%5Bslug%5D_lessons_new_page_tsx_3a857272._.js.map