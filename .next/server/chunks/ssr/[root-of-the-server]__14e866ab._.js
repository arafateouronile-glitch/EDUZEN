module.exports=[224361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},814747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},992258,a=>{"use strict";let b=(0,a.i(170106).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);a.s(["Mail",()=>b],992258)},717371,a=>{"use strict";let b=(0,a.i(170106).default)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);a.s(["UserPlus",()=>b],717371)},193767,a=>{"use strict";let b=new class{async blobToBase64(a){return new Promise((b,c)=>{let d=new FileReader;d.onloadend=()=>{b(d.result.split(",")[1])},d.onerror=c,d.readAsDataURL(a)})}async sendEmail(a){try{let b=a.attachments?await Promise.all(a.attachments.map(async a=>{let b;if(a.content instanceof Blob)b=await this.blobToBase64(a.content);else if(a.content instanceof ArrayBuffer){let c=new Blob([a.content],{type:a.contentType});b=await this.blobToBase64(c)}else b=a.content;return{filename:a.filename,content:b,contentType:a.contentType}})):void 0,c=await fetch("/api/email/send",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({to:a.to,subject:a.subject,html:a.html,text:a.text,attachments:b,cc:a.cc,bcc:a.bcc,replyTo:a.replyTo})});if(!c.ok){let a=await c.json();throw Error(a.message||"Erreur lors de l'envoi de l'email")}let d=await c.json();return{success:!0,message:d.message||"Email envoyé avec succès"}}catch(a){throw Error(a instanceof Error?a.message:"Erreur lors de l'envoi de l'email")}}async sendDocument(a,b,c,d,e,f){return this.sendEmail({to:a,subject:b,html:e,text:f,attachments:[{filename:d,content:c,contentType:"application/pdf"}]})}async sendMultipleDocuments(a,b,c,d,e){return this.sendEmail({to:a,subject:b,html:d,text:e,attachments:c.map(a=>({filename:a.filename,content:a.blob,contentType:"application/pdf"}))})}};a.s(["emailService",0,b])},139966,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(703130),e=a.i(340695),f=a.i(104720),g=a.i(284505),h=a.i(992258),i=a.i(290821),j=a.i(497895),k=a.i(242255),l=a.i(965733),m=a.i(205522),n=a.i(546893),o=a.i(917171),p=a.i(717371);function q({sessionData:a,formation:q,program:r,organization:s,enrollments:t=[],isLoading:u=!1,onShowEnrollmentForm:v,onSwitchTab:w}){let{isGeneratingZip:x,zipGenerationProgress:y,lastZipGeneration:z,handleGenerateConvention:A,handleGenerateContract:B,handleGenerateAllConventionsZip:C,handleGenerateProgram:D,handleGenerateTerms:E,handleGeneratePrivacyPolicy:F,handleSendContractByEmail:G,handleSendContractByEmailWithCustomContent:H,prepareContractEmail:I}=(0,k.useDocumentGeneration)({sessionData:a,formation:q,program:r,organization:s}),[J,K]=(0,c.useState)(null),[L,M]=(0,c.useState)(null);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Conventions et contrats"})}),(0,b.jsxs)(d.CardContent,{className:"space-y-4",children:[t.length>0&&(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-blue-900",children:"Génération en masse"}),(0,b.jsx)("p",{className:"text-sm text-blue-700",children:"Générer toutes les conventions et contrats en un fichier ZIP"}),z&&(0,b.jsxs)("span",{className:"text-xs text-blue-600",children:["Dernière génération : ",(0,j.formatDate)(z.toISOString())]})]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>C(t),disabled:x,children:[(0,b.jsx)(g.Download,{className:"mr-2 h-4 w-4"}),x?`G\xe9n\xe9ration... (${y.current}/${y.total})`:"Générer un ZIP des conventions et contrats"]})]}),x&&(0,b.jsxs)("div",{className:"mt-2",children:[(0,b.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,b.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${y.total>0?y.current/y.total*100:0}%`}})}),(0,b.jsxs)("p",{className:"text-xs text-blue-700 mt-1 text-center",children:["Génération en cours... ",y.current," sur ",y.total," document",y.total>1?"s":""]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(f.FileText,{className:"h-5 w-5 text-gray-400"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Convention"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Convention générale de formation"})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:A,children:(0,b.jsx)(g.Download,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",children:(0,b.jsx)(h.Mail,{className:"h-4 w-4"})})]})]}),u?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Chargement des inscriptions..."}):t.length>0?t.map(a=>{let c=a.students;return c?(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(f.FileText,{className:"h-5 w-5 text-gray-400"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-medium",children:[c.first_name," ",c.last_name]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Contrat particulier"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Contrat"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground mt-1 inline-block",children:"Jamais généré"})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("span",{className:"text-xs bg-brand-blue-ghost text-brand-blue px-2 py-1 rounded",children:"Signé"}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>B(a),children:(0,b.jsx)(g.Download,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>{let b=I(a);b&&(K(b),M({to:b.to,subject:b.subject,body:b.body}))},title:"Envoyer par email",disabled:!c.email,children:(0,b.jsx)(h.Mail,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",children:"⋯"})]})]},a.id):null}):(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)("p",{className:"text-sm",children:"Aucune inscription pour le moment."}),(0,b.jsxs)(e.Button,{variant:"outline",className:"mt-4",onClick:()=>{w("convocations"),v()},children:[(0,b.jsx)(p.UserPlus,{className:"mr-2 h-4 w-4"}),"Inscrire un apprenant"]})]})]})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Autres documents contractuels"})}),(0,b.jsx)(d.CardContent,{className:"space-y-4",children:r?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(f.FileText,{className:"h-5 w-5 text-gray-400"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Programme"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Programme"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground mt-1 inline-block",children:"Jamais généré"})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:D,children:(0,b.jsx)(g.Download,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",children:"⋯"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(f.FileText,{className:"h-5 w-5 text-gray-400"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"CGV"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"CGV"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground mt-1 inline-block",children:"Jamais généré"})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:E,children:(0,b.jsx)(g.Download,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",children:"⋯"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(f.FileText,{className:"h-5 w-5 text-gray-400"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Politique de confidentialité"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Politique de confidentialité"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground mt-1 inline-block",children:"Jamais généré"})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:F,children:(0,b.jsx)(g.Download,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",children:(0,b.jsx)(h.Mail,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",children:"⋯"})]})]})]}):(0,b.jsx)("div",{className:"bg-warning-bg border border-warning-border rounded-lg p-4",children:(0,b.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,b.jsx)(i.AlertCircle,{className:"h-5 w-5 text-warning-primary mt-0.5"}),(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)("p",{className:"text-sm text-warning-primary font-medium",children:"Votre session n'est pas associée à un programme, il n'est pas possible de générer de programme."})})]})})})]}),(0,b.jsx)(l.Dialog,{open:!!J,onOpenChange:a=>{a||(K(null),M(null))},children:(0,b.jsxs)(l.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(l.DialogHeader,{children:[(0,b.jsx)(l.DialogTitle,{children:"Aperçu de l'email"}),(0,b.jsx)(l.DialogDescription,{children:"Vérifiez le contenu et le destinataire avant d'envoyer"})]}),J&&L&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"email-to",children:"Destinataire"}),(0,b.jsx)(m.Input,{id:"email-to",type:"email",value:L.to,onChange:a=>M({...L,to:a.target.value}),className:"mt-1",placeholder:"email@example.com"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"email-subject",children:"Sujet"}),(0,b.jsx)(m.Input,{id:"email-subject",type:"text",value:L.subject,onChange:a=>M({...L,subject:a.target.value}),className:"mt-1",placeholder:"Sujet de l'email"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(o.Label,{htmlFor:"email-body",children:"Contenu"}),(0,b.jsx)(n.Textarea,{id:"email-body",value:L.body.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim(),onChange:a=>M({...L,body:a.target.value}),className:"mt-1 min-h-[200px] font-mono text-sm",placeholder:"Contenu de l'email"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Le formatage HTML sera préservé lors de l'envoi"})]}),(0,b.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,b.jsxs)("p",{className:"text-xs text-blue-800",children:[(0,b.jsx)("strong",{children:"Pièce jointe :"})," Un PDF du contrat sera joint à cet email."]})})]}),(0,b.jsxs)(l.DialogFooter,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>{K(null),M(null)},children:"Annuler"}),(0,b.jsxs)(e.Button,{onClick:async()=>{if(J&&L){let a={...J.enrollment,students:{...J.enrollment.students,email:L.to}};await H(a,L.subject,L.body),K(null),M(null)}},disabled:!L?.to||!L?.subject||!L?.body,children:[(0,b.jsx)(h.Mail,{className:"h-4 w-4 mr-2"}),"Envoyer l'email"]})]})]})})]})}a.s(["GestionConventions",()=>q])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__14e866ab._.js.map