{"version":3,"sources":["../../../../app/%28dashboard%29/dashboard/elearning/courses/%5Bslug%5D/learn/page.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\nimport { useAuth } from '@/lib/hooks/use-auth'\nimport { elearningService } from '@/lib/services/elearning.service'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { CheckCircle, Circle, Play, ChevronRight, ChevronLeft, BookOpen } from 'lucide-react'\nimport Link from 'next/link'\nimport ReactMarkdown from 'react-markdown'\n\nexport default function CourseLearnPage() {\n  const params = useParams()\n  const router = useRouter()\n  const slug = params.slug as string\n  const { user } = useAuth()\n  const queryClient = useQueryClient()\n  const [currentLessonIndex, setCurrentLessonIndex] = useState(0)\n\n  // Récupérer le cours\n  const { data: course } = useQuery<{ id: string; [key: string]: any } | null>({\n    queryKey: ['course', slug, user?.organization_id],\n    queryFn: async () => {\n      const result = await elearningService.getCourseBySlug(slug, user?.organization_id || '')\n      return result as { id: string; [key: string]: any } | null\n    },\n    enabled: !!slug && !!user?.organization_id,\n  })\n\n  // Récupérer l'inscription\n  const { data: enrollment } = useQuery({\n    queryKey: ['course-enrollment', course?.id, user?.id],\n    queryFn: async () => {\n      if (!course?.id || !user?.id) return null\n      const enrollments = await elearningService.getStudentEnrollments(user.id)\n      return enrollments.find((e: any) => e.course_id === course.id)\n    },\n    enabled: !!course?.id && !!user?.id,\n  })\n\n  // Récupérer la progression des leçons\n  const { data: lessonsProgress } = useQuery({\n    queryKey: ['lessons-progress', course?.id, user?.id],\n    queryFn: async () => {\n      if (!course?.lessons || !user?.id) return {}\n      const progressMap: Record<string, any> = {}\n      for (const lesson of course.lessons) {\n        const progress = await elearningService.getLessonProgress(lesson.id, user.id)\n        if (progress) {\n          progressMap[lesson.id] = progress\n        }\n      }\n      return progressMap\n    },\n    enabled: !!course?.lessons && course.lessons.length > 0 && !!user?.id,\n  })\n\n  // Marquer une leçon comme complétée\n  const markCompletedMutation = useMutation({\n    mutationFn: async (lessonId: string) => {\n      if (!user?.id) throw new Error('Non authentifié')\n      return elearningService.markLessonAsCompleted(lessonId, user.id)\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['lessons-progress'] })\n      queryClient.invalidateQueries({ queryKey: ['course-enrollment'] })\n    },\n  })\n\n  // Mettre à jour la progression\n  const updateProgressMutation = useMutation({\n    mutationFn: async ({ lessonId, percentage }: { lessonId: string; percentage: number }) => {\n      if (!user?.id) throw new Error('Non authentifié')\n      return elearningService.updateLessonProgress(lessonId, user.id, {\n        completion_percentage: percentage,\n      })\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['lessons-progress'] })\n    },\n  })\n\n  // Rediriger vers la première leçon si aucune n'est sélectionnée\n  useEffect(() => {\n    if (course?.lessons && course.lessons.length > 0 && !(enrollment as any)?.last_accessed_lesson_id) {\n      const firstLesson = course.lessons[0]\n      router.push(`/dashboard/elearning/courses/${slug}/lessons/${firstLesson.slug}`)\n    } else if ((enrollment as any)?.last_accessed_lesson_id) {\n      const lessonIndex = course?.lessons?.findIndex(\n        (l: any) => l.id === (enrollment as any).last_accessed_lesson_id\n      )\n      if (lessonIndex !== undefined && lessonIndex >= 0) {\n        setCurrentLessonIndex(lessonIndex)\n      }\n    }\n  }, [course, enrollment, slug, router])\n\n  if (!course || !enrollment) {\n    return (\n      <div className=\"container mx-auto py-8 px-4 max-w-7xl\">\n        <div className=\"text-center py-12\">Chargement...</div>\n      </div>\n    )\n  }\n\n  const lessons = course.lessons || []\n  const currentLesson = lessons[currentLessonIndex]\n  const isLessonCompleted = (lessonId: string) => {\n    return lessonsProgress?.[lessonId]?.is_completed || false\n  }\n\n  const handleNextLesson = () => {\n    if (currentLessonIndex < lessons.length - 1) {\n      const nextLesson = lessons[currentLessonIndex + 1]\n      router.push(`/dashboard/elearning/courses/${slug}/lessons/${nextLesson.slug}`)\n    }\n  }\n\n  const handlePreviousLesson = () => {\n    if (currentLessonIndex > 0) {\n      const previousLesson = lessons[currentLessonIndex - 1]\n      router.push(`/dashboard/elearning/courses/${slug}/lessons/${previousLesson.slug}`)\n    }\n  }\n\n  return (\n    <div className=\"container mx-auto py-8 px-4 max-w-7xl\">\n      <div className=\"mb-6\">\n        <Link href={`/dashboard/elearning/courses/${slug}`}>\n          <Button variant=\"ghost\" size=\"sm\" className=\"mb-4\">\n            <ChevronLeft className=\"h-4 w-4 mr-2\" />\n            Retour au cours\n          </Button>\n        </Link>\n        <h1 className=\"text-2xl font-bold\">{course.title}</h1>\n        <div className=\"flex items-center gap-4 mt-2 text-sm text-muted-foreground\">\n          <span>Progression: {Math.round((enrollment as any)?.progress_percentage || 0)}%</span>\n          <span>\n            {(enrollment as any)?.completed_lessons?.length || 0} / {lessons.length} leçons complétées\n          </span>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n        {/* Contenu principal */}\n        <div className=\"lg:col-span-3\">\n          {currentLesson ? (\n            <Card>\n              <CardHeader>\n                <CardTitle>{currentLesson.title}</CardTitle>\n                {currentLesson.description && (\n                  <p className=\"text-sm text-muted-foreground\">{currentLesson.description}</p>\n                )}\n              </CardHeader>\n              <CardContent>\n                {currentLesson.video_url && (\n                  <div className=\"mb-6\">\n                    <div className=\"aspect-video bg-black rounded-lg overflow-hidden\">\n                      <iframe\n                        src={currentLesson.video_url}\n                        className=\"w-full h-full\"\n                        allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                        allowFullScreen\n                      />\n                    </div>\n                  </div>\n                )}\n\n                {currentLesson.content && (\n                  <div className=\"prose prose-sm max-w-none mb-6\">\n                    <ReactMarkdown>{currentLesson.content}</ReactMarkdown>\n                  </div>\n                )}\n\n                {/* Actions */}\n                <div className=\"flex items-center justify-between pt-4 border-t\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={handlePreviousLesson}\n                    disabled={currentLessonIndex === 0}\n                  >\n                    <ChevronLeft className=\"h-4 w-4 mr-2\" />\n                    Leçon précédente\n                  </Button>\n                  <Button\n                    onClick={() => {\n                      if (!isLessonCompleted(currentLesson.id)) {\n                        markCompletedMutation.mutate(currentLesson.id)\n                      }\n                      handleNextLesson()\n                    }}\n                    disabled={currentLessonIndex === lessons.length - 1}\n                  >\n                    {isLessonCompleted(currentLesson.id) ? 'Leçon suivante' : 'Marquer comme complété'}\n                    <ChevronRight className=\"h-4 w-4 ml-2\" />\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ) : (\n            <Card>\n              <CardContent className=\"pt-6 text-center text-muted-foreground\">\n                Aucune leçon disponible\n              </CardContent>\n            </Card>\n          )}\n        </div>\n\n        {/* Sidebar - Navigation */}\n        <div className=\"lg:col-span-1\">\n          <Card className=\"sticky top-4\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Leçons</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                {lessons.map((lesson: any, index: number) => {\n                  const isCompleted = isLessonCompleted(lesson.id)\n                  const isCurrent = index === currentLessonIndex\n\n                  return (\n                    <Link\n                      key={lesson.id}\n                      href={`/dashboard/elearning/courses/${slug}/lessons/${lesson.slug}`}\n                    >\n                      <button\n                        className={`w-full text-left p-2 rounded-lg transition-colors ${\n                          isCurrent\n                            ? 'bg-primary text-white'\n                            : isCompleted\n                            ? 'bg-green-50 text-green-800 hover:bg-green-100'\n                            : 'bg-gray-50 hover:bg-gray-100'\n                        }`}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          {isCompleted ? (\n                            <CheckCircle className=\"h-4 w-4 flex-shrink-0\" />\n                          ) : (\n                            <Circle className=\"h-4 w-4 flex-shrink-0\" />\n                          )}\n                          <span className=\"text-sm font-medium\">\n                            {index + 1}. {lesson.title}\n                          </span>\n                        </div>\n                        {lesson.video_duration_minutes && (\n                          <p className=\"text-xs mt-1 opacity-70\">\n                            {lesson.video_duration_minutes} min\n                          </p>\n                        )}\n                      </button>\n                    </Link>\n                  )\n                })}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n\n\nfunction CourseLearnPage_DUPLICATE_1() {\n  const params = useParams()\n  const router = useRouter()\n  const slug = params.slug as string\n  const { user } = useAuth()\n  const queryClient = useQueryClient()\n  const [currentLessonIndex, setCurrentLessonIndex] = useState(0)\n\n  // Récupérer le cours\n  const { data: course } = useQuery<{ id: string; [key: string]: any } | null>({\n    queryKey: ['course', slug, user?.organization_id],\n    queryFn: async () => {\n      const result = await elearningService.getCourseBySlug(slug, user?.organization_id || '')\n      return result as { id: string; [key: string]: any } | null\n    },\n    enabled: !!slug && !!user?.organization_id,\n  })\n\n  // Récupérer l'inscription\n  const { data: enrollment } = useQuery({\n    queryKey: ['course-enrollment', course?.id, user?.id],\n    queryFn: async () => {\n      if (!course?.id || !user?.id) return null\n      const enrollments = await elearningService.getStudentEnrollments(user.id)\n      return enrollments.find((e: any) => e.course_id === course.id)\n    },\n    enabled: !!course?.id && !!user?.id,\n  })\n\n  // Récupérer la progression des leçons\n  const { data: lessonsProgress } = useQuery({\n    queryKey: ['lessons-progress', course?.id, user?.id],\n    queryFn: async () => {\n      if (!course?.lessons || !user?.id) return {}\n      const progressMap: Record<string, any> = {}\n      for (const lesson of course.lessons) {\n        const progress = await elearningService.getLessonProgress(lesson.id, user.id)\n        if (progress) {\n          progressMap[lesson.id] = progress\n        }\n      }\n      return progressMap\n    },\n    enabled: !!course?.lessons && course.lessons.length > 0 && !!user?.id,\n  })\n\n  // Marquer une leçon comme complétée\n  const markCompletedMutation = useMutation({\n    mutationFn: async (lessonId: string) => {\n      if (!user?.id) throw new Error('Non authentifié')\n      return elearningService.markLessonAsCompleted(lessonId, user.id)\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['lessons-progress'] })\n      queryClient.invalidateQueries({ queryKey: ['course-enrollment'] })\n    },\n  })\n\n  // Mettre à jour la progression\n  const updateProgressMutation = useMutation({\n    mutationFn: async ({ lessonId, percentage }: { lessonId: string; percentage: number }) => {\n      if (!user?.id) throw new Error('Non authentifié')\n      return elearningService.updateLessonProgress(lessonId, user.id, {\n        completion_percentage: percentage,\n      })\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['lessons-progress'] })\n    },\n  })\n\n  // Rediriger vers la première leçon si aucune n'est sélectionnée\n  useEffect(() => {\n    if (course?.lessons && course.lessons.length > 0 && !(enrollment as any)?.last_accessed_lesson_id) {\n      const firstLesson = course.lessons[0]\n      router.push(`/dashboard/elearning/courses/${slug}/lessons/${firstLesson.slug}`)\n    } else if ((enrollment as any)?.last_accessed_lesson_id) {\n      const lessonIndex = course?.lessons?.findIndex(\n        (l: any) => l.id === (enrollment as any).last_accessed_lesson_id\n      )\n      if (lessonIndex !== undefined && lessonIndex >= 0) {\n        setCurrentLessonIndex(lessonIndex)\n      }\n    }\n  }, [course, enrollment, slug, router])\n\n  if (!course || !enrollment) {\n    return (\n      <div className=\"container mx-auto py-8 px-4 max-w-7xl\">\n        <div className=\"text-center py-12\">Chargement...</div>\n      </div>\n    )\n  }\n\n  const lessons = course.lessons || []\n  const currentLesson = lessons[currentLessonIndex]\n  const isLessonCompleted = (lessonId: string) => {\n    return lessonsProgress?.[lessonId]?.is_completed || false\n  }\n\n  const handleNextLesson = () => {\n    if (currentLessonIndex < lessons.length - 1) {\n      const nextLesson = lessons[currentLessonIndex + 1]\n      router.push(`/dashboard/elearning/courses/${slug}/lessons/${nextLesson.slug}`)\n    }\n  }\n\n  const handlePreviousLesson = () => {\n    if (currentLessonIndex > 0) {\n      const previousLesson = lessons[currentLessonIndex - 1]\n      router.push(`/dashboard/elearning/courses/${slug}/lessons/${previousLesson.slug}`)\n    }\n  }\n\n  return (\n    <div className=\"container mx-auto py-8 px-4 max-w-7xl\">\n      <div className=\"mb-6\">\n        <Link href={`/dashboard/elearning/courses/${slug}`}>\n          <Button variant=\"ghost\" size=\"sm\" className=\"mb-4\">\n            <ChevronLeft className=\"h-4 w-4 mr-2\" />\n            Retour au cours\n          </Button>\n        </Link>\n        <h1 className=\"text-2xl font-bold\">{course.title}</h1>\n        <div className=\"flex items-center gap-4 mt-2 text-sm text-muted-foreground\">\n          <span>Progression: {Math.round((enrollment as any)?.progress_percentage || 0)}%</span>\n          <span>\n            {(enrollment as any)?.completed_lessons?.length || 0} / {lessons.length} leçons complétées\n          </span>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n        {/* Contenu principal */}\n        <div className=\"lg:col-span-3\">\n          {currentLesson ? (\n            <Card>\n              <CardHeader>\n                <CardTitle>{currentLesson.title}</CardTitle>\n                {currentLesson.description && (\n                  <p className=\"text-sm text-muted-foreground\">{currentLesson.description}</p>\n                )}\n              </CardHeader>\n              <CardContent>\n                {currentLesson.video_url && (\n                  <div className=\"mb-6\">\n                    <div className=\"aspect-video bg-black rounded-lg overflow-hidden\">\n                      <iframe\n                        src={currentLesson.video_url}\n                        className=\"w-full h-full\"\n                        allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                        allowFullScreen\n                      />\n                    </div>\n                  </div>\n                )}\n\n                {currentLesson.content && (\n                  <div className=\"prose prose-sm max-w-none mb-6\">\n                    <ReactMarkdown>{currentLesson.content}</ReactMarkdown>\n                  </div>\n                )}\n\n                {/* Actions */}\n                <div className=\"flex items-center justify-between pt-4 border-t\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={handlePreviousLesson}\n                    disabled={currentLessonIndex === 0}\n                  >\n                    <ChevronLeft className=\"h-4 w-4 mr-2\" />\n                    Leçon précédente\n                  </Button>\n                  <Button\n                    onClick={() => {\n                      if (!isLessonCompleted(currentLesson.id)) {\n                        markCompletedMutation.mutate(currentLesson.id)\n                      }\n                      handleNextLesson()\n                    }}\n                    disabled={currentLessonIndex === lessons.length - 1}\n                  >\n                    {isLessonCompleted(currentLesson.id) ? 'Leçon suivante' : 'Marquer comme complété'}\n                    <ChevronRight className=\"h-4 w-4 ml-2\" />\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ) : (\n            <Card>\n              <CardContent className=\"pt-6 text-center text-muted-foreground\">\n                Aucune leçon disponible\n              </CardContent>\n            </Card>\n          )}\n        </div>\n\n        {/* Sidebar - Navigation */}\n        <div className=\"lg:col-span-1\">\n          <Card className=\"sticky top-4\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Leçons</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                {lessons.map((lesson: any, index: number) => {\n                  const isCompleted = isLessonCompleted(lesson.id)\n                  const isCurrent = index === currentLessonIndex\n\n                  return (\n                    <Link\n                      key={lesson.id}\n                      href={`/dashboard/elearning/courses/${slug}/lessons/${lesson.slug}`}\n                    >\n                      <button\n                        className={`w-full text-left p-2 rounded-lg transition-colors ${\n                          isCurrent\n                            ? 'bg-primary text-white'\n                            : isCompleted\n                            ? 'bg-green-50 text-green-800 hover:bg-green-100'\n                            : 'bg-gray-50 hover:bg-gray-100'\n                        }`}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          {isCompleted ? (\n                            <CheckCircle className=\"h-4 w-4 flex-shrink-0\" />\n                          ) : (\n                            <Circle className=\"h-4 w-4 flex-shrink-0\" />\n                          )}\n                          <span className=\"text-sm font-medium\">\n                            {index + 1}. {lesson.title}\n                          </span>\n                        </div>\n                        {lesson.video_duration_minutes && (\n                          <p className=\"text-xs mt-1 opacity-70\">\n                            {lesson.video_duration_minutes} min\n                          </p>\n                        )}\n                      </button>\n                    </Link>\n                  )\n                })}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n\n\nfunction CourseLearnPage_DUPLICATE_2() {\n  const params = useParams()\n  const router = useRouter()\n  const slug = params.slug as string\n  const { user } = useAuth()\n  const queryClient = useQueryClient()\n  const [currentLessonIndex, setCurrentLessonIndex] = useState(0)\n\n  // Récupérer le cours\n  const { data: course } = useQuery<{ id: string; [key: string]: any } | null>({\n    queryKey: ['course', slug, user?.organization_id],\n    queryFn: async () => {\n      const result = await elearningService.getCourseBySlug(slug, user?.organization_id || '')\n      return result as { id: string; [key: string]: any } | null\n    },\n    enabled: !!slug && !!user?.organization_id,\n  })\n\n  // Récupérer l'inscription\n  const { data: enrollment } = useQuery({\n    queryKey: ['course-enrollment', course?.id, user?.id],\n    queryFn: async () => {\n      if (!course?.id || !user?.id) return null\n      const enrollments = await elearningService.getStudentEnrollments(user.id)\n      return enrollments.find((e: any) => e.course_id === course.id)\n    },\n    enabled: !!course?.id && !!user?.id,\n  })\n\n  // Récupérer la progression des leçons\n  const { data: lessonsProgress } = useQuery({\n    queryKey: ['lessons-progress', course?.id, user?.id],\n    queryFn: async () => {\n      if (!course?.lessons || !user?.id) return {}\n      const progressMap: Record<string, any> = {}\n      for (const lesson of course.lessons) {\n        const progress = await elearningService.getLessonProgress(lesson.id, user.id)\n        if (progress) {\n          progressMap[lesson.id] = progress\n        }\n      }\n      return progressMap\n    },\n    enabled: !!course?.lessons && course.lessons.length > 0 && !!user?.id,\n  })\n\n  // Marquer une leçon comme complétée\n  const markCompletedMutation = useMutation({\n    mutationFn: async (lessonId: string) => {\n      if (!user?.id) throw new Error('Non authentifié')\n      return elearningService.markLessonAsCompleted(lessonId, user.id)\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['lessons-progress'] })\n      queryClient.invalidateQueries({ queryKey: ['course-enrollment'] })\n    },\n  })\n\n  // Mettre à jour la progression\n  const updateProgressMutation = useMutation({\n    mutationFn: async ({ lessonId, percentage }: { lessonId: string; percentage: number }) => {\n      if (!user?.id) throw new Error('Non authentifié')\n      return elearningService.updateLessonProgress(lessonId, user.id, {\n        completion_percentage: percentage,\n      })\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['lessons-progress'] })\n    },\n  })\n\n  // Rediriger vers la première leçon si aucune n'est sélectionnée\n  useEffect(() => {\n    if (course?.lessons && course.lessons.length > 0 && !(enrollment as any)?.last_accessed_lesson_id) {\n      const firstLesson = course.lessons[0]\n      router.push(`/dashboard/elearning/courses/${slug}/lessons/${firstLesson.slug}`)\n    } else if ((enrollment as any)?.last_accessed_lesson_id) {\n      const lessonIndex = course?.lessons?.findIndex(\n        (l: any) => l.id === (enrollment as any).last_accessed_lesson_id\n      )\n      if (lessonIndex !== undefined && lessonIndex >= 0) {\n        setCurrentLessonIndex(lessonIndex)\n      }\n    }\n  }, [course, enrollment, slug, router])\n\n  if (!course || !enrollment) {\n    return (\n      <div className=\"container mx-auto py-8 px-4 max-w-7xl\">\n        <div className=\"text-center py-12\">Chargement...</div>\n      </div>\n    )\n  }\n\n  const lessons = course.lessons || []\n  const currentLesson = lessons[currentLessonIndex]\n  const isLessonCompleted = (lessonId: string) => {\n    return lessonsProgress?.[lessonId]?.is_completed || false\n  }\n\n  const handleNextLesson = () => {\n    if (currentLessonIndex < lessons.length - 1) {\n      const nextLesson = lessons[currentLessonIndex + 1]\n      router.push(`/dashboard/elearning/courses/${slug}/lessons/${nextLesson.slug}`)\n    }\n  }\n\n  const handlePreviousLesson = () => {\n    if (currentLessonIndex > 0) {\n      const previousLesson = lessons[currentLessonIndex - 1]\n      router.push(`/dashboard/elearning/courses/${slug}/lessons/${previousLesson.slug}`)\n    }\n  }\n\n  return (\n    <div className=\"container mx-auto py-8 px-4 max-w-7xl\">\n      <div className=\"mb-6\">\n        <Link href={`/dashboard/elearning/courses/${slug}`}>\n          <Button variant=\"ghost\" size=\"sm\" className=\"mb-4\">\n            <ChevronLeft className=\"h-4 w-4 mr-2\" />\n            Retour au cours\n          </Button>\n        </Link>\n        <h1 className=\"text-2xl font-bold\">{course.title}</h1>\n        <div className=\"flex items-center gap-4 mt-2 text-sm text-muted-foreground\">\n          <span>Progression: {Math.round((enrollment as any)?.progress_percentage || 0)}%</span>\n          <span>\n            {(enrollment as any)?.completed_lessons?.length || 0} / {lessons.length} leçons complétées\n          </span>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-4 gap-6\">\n        {/* Contenu principal */}\n        <div className=\"lg:col-span-3\">\n          {currentLesson ? (\n            <Card>\n              <CardHeader>\n                <CardTitle>{currentLesson.title}</CardTitle>\n                {currentLesson.description && (\n                  <p className=\"text-sm text-muted-foreground\">{currentLesson.description}</p>\n                )}\n              </CardHeader>\n              <CardContent>\n                {currentLesson.video_url && (\n                  <div className=\"mb-6\">\n                    <div className=\"aspect-video bg-black rounded-lg overflow-hidden\">\n                      <iframe\n                        src={currentLesson.video_url}\n                        className=\"w-full h-full\"\n                        allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\"\n                        allowFullScreen\n                      />\n                    </div>\n                  </div>\n                )}\n\n                {currentLesson.content && (\n                  <div className=\"prose prose-sm max-w-none mb-6\">\n                    <ReactMarkdown>{currentLesson.content}</ReactMarkdown>\n                  </div>\n                )}\n\n                {/* Actions */}\n                <div className=\"flex items-center justify-between pt-4 border-t\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={handlePreviousLesson}\n                    disabled={currentLessonIndex === 0}\n                  >\n                    <ChevronLeft className=\"h-4 w-4 mr-2\" />\n                    Leçon précédente\n                  </Button>\n                  <Button\n                    onClick={() => {\n                      if (!isLessonCompleted(currentLesson.id)) {\n                        markCompletedMutation.mutate(currentLesson.id)\n                      }\n                      handleNextLesson()\n                    }}\n                    disabled={currentLessonIndex === lessons.length - 1}\n                  >\n                    {isLessonCompleted(currentLesson.id) ? 'Leçon suivante' : 'Marquer comme complété'}\n                    <ChevronRight className=\"h-4 w-4 ml-2\" />\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          ) : (\n            <Card>\n              <CardContent className=\"pt-6 text-center text-muted-foreground\">\n                Aucune leçon disponible\n              </CardContent>\n            </Card>\n          )}\n        </div>\n\n        {/* Sidebar - Navigation */}\n        <div className=\"lg:col-span-1\">\n          <Card className=\"sticky top-4\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Leçons</CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                {lessons.map((lesson: any, index: number) => {\n                  const isCompleted = isLessonCompleted(lesson.id)\n                  const isCurrent = index === currentLessonIndex\n\n                  return (\n                    <Link\n                      key={lesson.id}\n                      href={`/dashboard/elearning/courses/${slug}/lessons/${lesson.slug}`}\n                    >\n                      <button\n                        className={`w-full text-left p-2 rounded-lg transition-colors ${\n                          isCurrent\n                            ? 'bg-primary text-white'\n                            : isCompleted\n                            ? 'bg-green-50 text-green-800 hover:bg-green-100'\n                            : 'bg-gray-50 hover:bg-gray-100'\n                        }`}\n                      >\n                        <div className=\"flex items-center gap-2\">\n                          {isCompleted ? (\n                            <CheckCircle className=\"h-4 w-4 flex-shrink-0\" />\n                          ) : (\n                            <Circle className=\"h-4 w-4 flex-shrink-0\" />\n                          )}\n                          <span className=\"text-sm font-medium\">\n                            {index + 1}. {lesson.title}\n                          </span>\n                        </div>\n                        {lesson.video_duration_minutes && (\n                          <p className=\"text-xs mt-1 opacity-70\">\n                            {lesson.video_duration_minutes} min\n                          </p>\n                        )}\n                      </button>\n                    </Link>\n                  )\n                })}\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n\n"],"names":[],"mappings":"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"}