module.exports=[413421,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(50944),h=a.i(913216),i=a.i(315470),j=a.i(703130),k=a.i(340695),l=a.i(205522),m=a.i(917171),n=a.i(546893),o=a.i(864037),p=a.i(400210),q=a.i(915618),r=a.i(781560),s=a.i(114548),t=a.i(238246);function u(){let a=(0,g.useParams)();(0,g.useRouter)();let u=a.id,{user:v}=(0,h.useAuth)(),w=(0,f.useQueryClient)(),{addToast:x}=(0,o.useToast)(),{data:y,isLoading:z}=(0,d.useQuery)({queryKey:["evaluation-template",u],queryFn:async()=>await i.evaluationTemplateService.getTemplateById(u),enabled:!!u}),[A,B]=(0,c.useState)({name:"",description:"",assessment_type:"",subject:"",max_score:20,passing_score:70,time_limit_minutes:null,shuffle_questions:!1,show_correct_answers:!0}),[C,D]=(0,c.useState)([]);(0,c.useEffect)(()=>{y&&(B({name:y.name,description:y.description||"",assessment_type:y.assessment_type||"",subject:y.subject||"",max_score:y.max_score||20,passing_score:y.passing_score||70,time_limit_minutes:y.time_limit_minutes??null,shuffle_questions:y.shuffle_questions||!1,show_correct_answers:!1!==y.show_correct_answers}),D((y.questions||[]).map(a=>({id:a.id,question_text:a.question_text,question_type:a.question_type,options:"string"==typeof a.options?JSON.parse(a.options):a.options,correct_answer:a.correct_answer||void 0,correct_answer_pattern:a.correct_answer_pattern||void 0,points:a.points||1,explanation:a.explanation||void 0,order_index:a.order_index||0}))))},[y]);let E=(0,e.useMutation)({mutationFn:async()=>{if(!A.name)throw Error("Le nom du modèle est requis");if(0===C.length)throw Error("Au moins une question est requise");return i.evaluationTemplateService.updateTemplate(u,{name:A.name,description:A.description||null,assessment_type:A.assessment_type||null,subject:A.subject||null,max_score:A.max_score,passing_score:A.passing_score||null,time_limit_minutes:A.time_limit_minutes||null,shuffle_questions:A.shuffle_questions,show_correct_answers:A.show_correct_answers},C.map(a=>({question_text:a.question_text,question_type:a.question_type,options:a.options?JSON.stringify(a.options):null,correct_answer:a.correct_answer||null,correct_answer_pattern:a.correct_answer_pattern||null,points:a.points,explanation:a.explanation||null,order_index:a.order_index})))},onSuccess:()=>{w.invalidateQueries({queryKey:["evaluation-template",u]}),w.invalidateQueries({queryKey:["evaluation-templates"]}),x({type:"success",title:"Modèle mis à jour",description:"Le modèle d'évaluation a été mis à jour avec succès."})},onError:a=>{x({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue lors de la mise à jour."})}}),F=(a,b)=>{D(C.map(c=>{if(c.id===a){let a={...c,...b};return b.question_type&&b.question_type!==c.question_type&&("multiple_choice"===b.question_type?a.options=[{text:"",is_correct:!1},{text:"",is_correct:!1}]:a.options=void 0,a.correct_answer=void 0),a}return c}))},G=(a,b,c)=>{D(C.map(d=>d.id===a&&d.options?{...d,options:d.options.map((a,d)=>d===b?{...a,...c}:a)}:d))};return z?(0,b.jsx)("div",{className:"space-y-6",children:"Chargement..."}):y?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(t.default,{href:"/dashboard/evaluations/templates",children:(0,b.jsx)(k.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(p.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Modifier le modèle"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Modifiez le modèle d'évaluation et ses questions"})]})]}),(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),E.mutate()},className:"space-y-6",children:[(0,b.jsxs)(j.Card,{children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsx)(j.CardTitle,{children:"Informations générales"})}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{htmlFor:"name",children:"Nom du modèle *"}),(0,b.jsx)(l.Input,{id:"name",value:A.name,onChange:a=>B({...A,name:a.target.value}),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(n.Textarea,{id:"description",value:A.description,onChange:a=>B({...A,description:a.target.value}),rows:3})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{htmlFor:"subject",children:"Sujet/Matière"}),(0,b.jsx)(l.Input,{id:"subject",value:A.subject,onChange:a=>B({...A,subject:a.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{htmlFor:"assessment_type",children:"Type d'évaluation"}),(0,b.jsxs)("select",{id:"assessment_type",value:A.assessment_type,onChange:a=>B({...A,assessment_type:a.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:[(0,b.jsx)("option",{value:"",children:"Sélectionner..."}),(0,b.jsx)("option",{value:"pre_formation",children:"Pré-formation"}),(0,b.jsx)("option",{value:"hot",children:"À chaud"}),(0,b.jsx)("option",{value:"cold",children:"À froid"}),(0,b.jsx)("option",{value:"quiz",children:"Quiz"}),(0,b.jsx)("option",{value:"exam",children:"Examen"}),(0,b.jsx)("option",{value:"other",children:"Autre"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{htmlFor:"max_score",children:"Note maximale"}),(0,b.jsx)(l.Input,{id:"max_score",type:"number",step:"0.01",min:"1",value:A.max_score,onChange:a=>B({...A,max_score:parseFloat(a.target.value)||20})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{htmlFor:"passing_score",children:"Score de réussite (%)"}),(0,b.jsx)(l.Input,{id:"passing_score",type:"number",step:"0.01",min:"0",max:"100",value:A.passing_score,onChange:a=>B({...A,passing_score:parseFloat(a.target.value)||70})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{htmlFor:"time_limit",children:"Durée (minutes)"}),(0,b.jsx)(l.Input,{id:"time_limit",type:"number",min:"1",value:A.time_limit_minutes||"",onChange:a=>B({...A,time_limit_minutes:a.target.value?parseInt(a.target.value):null}),placeholder:"Illimité"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:A.shuffle_questions,onChange:a=>B({...A,shuffle_questions:a.target.checked})}),(0,b.jsx)("span",{children:"Mélanger les questions"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:A.show_correct_answers,onChange:a=>B({...A,show_correct_answers:a.target.checked})}),(0,b.jsx)("span",{children:"Afficher les bonnes réponses après correction"})]})]})]})]}),(0,b.jsxs)(j.Card,{children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(j.CardTitle,{children:"Questions"}),(0,b.jsxs)(k.Button,{type:"button",onClick:()=>{let a={id:`temp-${Date.now()}`,question_text:"",question_type:"multiple_choice",options:[{text:"",is_correct:!1},{text:"",is_correct:!1}],points:1,order_index:C.length+1};D([...C,a])},variant:"outline",children:[(0,b.jsx)(q.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une question"]})]})}),(0,b.jsx)(j.CardContent,{className:"space-y-6",children:0===C.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'Aucune question. Cliquez sur "Ajouter une question" pour commencer.'}):C.map((a,c)=>(0,b.jsxs)(j.Card,{className:"border-2",children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(j.CardTitle,{className:"text-base",children:["Question ",c+1]}),(0,b.jsx)(k.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{var b;return b=a.id,void D(C.filter(a=>a.id!==b).map((a,b)=>({...a,order_index:b+1})))},children:(0,b.jsx)(r.Trash2,{className:"h-4 w-4 text-destructive"})})]})}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{children:"Texte de la question *"}),(0,b.jsx)(n.Textarea,{value:a.question_text,onChange:b=>F(a.id,{question_text:b.target.value}),rows:2,required:!0})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{children:"Type de question *"}),(0,b.jsxs)("select",{value:a.question_type,onChange:b=>F(a.id,{question_type:b.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:[(0,b.jsx)("option",{value:"multiple_choice",children:"Choix multiples"}),(0,b.jsx)("option",{value:"true_false",children:"Vrai/Faux"}),(0,b.jsx)("option",{value:"short_answer",children:"Réponse courte"}),(0,b.jsx)("option",{value:"numeric",children:"Numérique"}),(0,b.jsx)("option",{value:"essay",children:"Dissertation (correction manuelle)"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{children:"Points *"}),(0,b.jsx)(l.Input,{type:"number",step:"0.01",min:"0",value:a.points,onChange:b=>F(a.id,{points:parseFloat(b.target.value)||1}),required:!0})]})]}),"multiple_choice"===a.question_type&&a.options&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{children:"Options de réponse *"}),a.options.map((c,d)=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:c.is_correct,onChange:b=>G(a.id,d,{is_correct:b.target.checked})}),(0,b.jsx)(l.Input,{value:c.text,onChange:b=>G(a.id,d,{text:b.target.value}),placeholder:`Option ${d+1}`,className:"flex-1"}),a.options&&a.options.length>2&&(0,b.jsx)(k.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{var b;return b=a.id,void D(C.map(a=>{if(a.id===b&&a.options){let b=a.options.filter((a,b)=>b!==d);return{...a,options:b.length>0?b:void 0}}return a}))},children:(0,b.jsx)(r.Trash2,{className:"h-4 w-4"})})]},d)),(0,b.jsxs)(k.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{var b;return b=a.id,void D(C.map(a=>a.id===b&&a.options?{...a,options:[...a.options,{text:"",is_correct:!1}]}:a))},children:[(0,b.jsx)(q.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une option"]})]}),"true_false"===a.question_type&&(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{children:"Bonne réponse *"}),(0,b.jsxs)("select",{value:a.correct_answer||"",onChange:b=>F(a.id,{correct_answer:b.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:[(0,b.jsx)("option",{value:"",children:"Sélectionner..."}),(0,b.jsx)("option",{value:"true",children:"Vrai"}),(0,b.jsx)("option",{value:"false",children:"Faux"})]})]}),"short_answer"===a.question_type&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{children:"Bonne réponse *"}),(0,b.jsx)(l.Input,{value:a.correct_answer||"",onChange:b=>F(a.id,{correct_answer:b.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{children:"Pattern regex (optionnel)"}),(0,b.jsx)(l.Input,{value:a.correct_answer_pattern||"",onChange:b=>F(a.id,{correct_answer_pattern:b.target.value})})]})]}),"numeric"===a.question_type&&(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{children:"Bonne réponse (nombre) *"}),(0,b.jsx)(l.Input,{type:"number",step:"0.01",value:a.correct_answer||"",onChange:b=>F(a.id,{correct_answer:b.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(m.Label,{children:"Explication (optionnel)"}),(0,b.jsx)(n.Textarea,{value:a.explanation||"",onChange:b=>F(a.id,{explanation:b.target.value}),rows:2})]})]})]},a.id))})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-4",children:[(0,b.jsx)(t.default,{href:"/dashboard/evaluations/templates",children:(0,b.jsx)(k.Button,{type:"button",variant:"outline",children:"Annuler"})}),(0,b.jsxs)(k.Button,{type:"submit",disabled:E.isPending||0===C.length,children:[(0,b.jsx)(s.Save,{className:"h-4 w-4 mr-2"}),E.isPending?"Sauvegarde...":"Enregistrer"]})]})]})]}):(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold mb-2",children:"Modèle non trouvé"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:"Le modèle demandé n'existe pas ou a été supprimé."}),(0,b.jsx)(t.default,{href:"/dashboard/evaluations/templates",children:(0,b.jsxs)(k.Button,{children:[(0,b.jsx)(p.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour aux modèles"]})})]})})}a.s(["default",()=>u])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_evaluations_templates_%5Bid%5D_page_tsx_bcb0dc44._.js.map