{"version":3,"sources":["../../../../app/%28dashboard%29/dashboard/students/new/page.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { useMutation, useQuery } from '@tanstack/react-query'\nimport { useForm } from 'react-hook-form'\nimport { zodResolver } from '@hookform/resolvers/zod'\nimport { useAuth } from '@/lib/hooks/use-auth'\nimport { createClient } from '@/lib/supabase/client'\nimport { studentService } from '@/lib/services/student.service'\nimport { Button } from '@/components/ui/button'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { ArrowLeft } from 'lucide-react'\nimport Link from 'next/link'\nimport { studentSchema, type StudentFormData } from '@/lib/validations/schemas'\nimport { usePageAnalytics } from '@/lib/hooks/use-page-analytics'\nimport { useCreateStudent } from '@/lib/hooks/use-create-student'\n\nexport default function NewStudentPage() {\n  const router = useRouter()\n  const auth = useAuth()\n  const { user, isLoading: userLoading, session } = auth\n  const supabase = createClient()\n\n  // Tous les hooks doivent être appelés avant les early returns\n  const [step, setStep] = useState(1)\n  \n  // React Hook Form avec validation Zod\n  const {\n    register,\n    handleSubmit,\n    formState: { errors, isValid },\n    setValue,\n    trigger,\n    watch,\n  } = useForm<StudentFormData>({\n    resolver: zodResolver(studentSchema),\n    mode: 'onChange',\n    defaultValues: {\n      first_name: '',\n      last_name: '',\n      date_of_birth: '',\n      gender: '',\n      email: '',\n      phone: '',\n      address: '',\n      city: '',\n      guardian_first_name: '',\n      guardian_last_name: '',\n      guardian_relationship: 'parent',\n      guardian_phone_primary: '',\n      guardian_phone_secondary: '',\n      guardian_email: '',\n      guardian_address: '',\n      class_id: '',\n      enrollment_date: new Date().toISOString().split('T')[0],\n    },\n  })\n\n  // Récupérer les sessions (remplace les classes)\n  const { data: sessions } = useQuery({\n    queryKey: ['program-sessions-all', user?.organization_id],\n    queryFn: async () => {\n      if (!user?.organization_id) return []\n      const { data, error } = await supabase\n        .from('sessions')\n        .select('id, name, start_date, end_date, formations!inner(id, name, code, organization_id, programs(id, name))')\n        .eq('formations.organization_id', user.organization_id)\n        .order('start_date', { ascending: false })\n      if (error) throw error\n      return data?.map((session: any) => ({\n        id: session.id,\n        name: `${session.name} - ${session.formations.name}${session.formations.programs ? ` (${session.formations.programs.name})` : ''}`,\n        code: session.formations.code,\n        start_date: session.start_date,\n        end_date: session.end_date,\n      })) || []\n    },\n    enabled: !!user?.organization_id && !userLoading,\n  })\n\n  const createMutation = useMutation({\n    mutationFn: async (data: StudentFormData) => {\n      if (!user?.organization_id) throw new Error('Organization ID manquant')\n\n      // 1. Créer le tuteur\n      const { data: guardian, error: guardianError } = await supabase\n        .from('guardians')\n        .insert({\n          organization_id: user.organization_id,\n          first_name: data.guardian_first_name,\n          last_name: data.guardian_last_name,\n          relationship: data.guardian_relationship,\n          phone_primary: data.guardian_phone_primary,\n          phone_secondary: data.guardian_phone_secondary || null,\n          email: data.guardian_email || null,\n          address: data.guardian_address || null,\n        })\n        .select()\n        .single()\n\n      if (guardianError) throw guardianError\n\n      // 2. Générer un numéro étudiant unique\n      // Récupérer le code de l'organisation\n      const { data: organization } = await supabase\n        .from('organizations')\n        .select('code')\n        .eq('id', user.organization_id)\n        .single()\n\n      const orgCode = organization?.code || 'EDUZEN'\n      const year = new Date().getFullYear().toString().slice(-2)\n      \n      // Récupérer le dernier numéro d'élève pour cette organisation et cette année\n      const prefix = `${orgCode}${year}`\n      const { data: lastStudent } = await supabase\n        .from('students')\n        .select('student_number')\n        .eq('organization_id', user.organization_id)\n        .like('student_number', `${prefix}%`)\n        .order('student_number', { ascending: false })\n        .limit(1)\n        .maybeSingle()\n      \n      // Générer le prochain numéro\n      let sequence = 1\n      if (lastStudent?.student_number) {\n        // Extraire la séquence du dernier numéro\n        const lastSequence = parseInt(lastStudent.student_number.slice(-4)) || 0\n        sequence = lastSequence + 1\n      }\n      \n      let studentNumber = `${prefix}${String(sequence).padStart(4, '0')}`\n      \n      // Double vérification : s'assurer que ce numéro n'existe pas déjà\n      const { data: existingCheck } = await supabase\n        .from('students')\n        .select('id')\n        .eq('organization_id', user.organization_id)\n        .eq('student_number', studentNumber)\n        .maybeSingle()\n      \n      if (existingCheck) {\n        // Si le numéro existe encore (cas de course), incrémenter jusqu'à trouver un numéro libre\n        let attempts = 0\n        while (attempts < 100) {\n          sequence++\n          studentNumber = `${prefix}${String(sequence).padStart(4, '0')}`\n          \n          const { data: check } = await supabase\n            .from('students')\n            .select('id')\n            .eq('organization_id', user.organization_id)\n            .eq('student_number', studentNumber)\n            .maybeSingle()\n          \n          if (!check) {\n            // Numéro disponible\n            break\n          }\n          attempts++\n        }\n        \n        if (attempts >= 100) {\n          throw new Error('Impossible de générer un numéro d\\'élève unique. Veuillez réessayer.')\n        }\n      }\n\n      // 3. Créer l'élève\n      // Note: class_id n'est pas inséré car il fait référence à la table \"classes\", \n      // pas aux sessions. L'inscription à la session est gérée via la table \"enrollments\"\n      const { data: student, error: studentError } = await supabase\n        .from('students')\n        .insert({\n          organization_id: user.organization_id,\n          student_number: studentNumber,\n          first_name: data.first_name,\n          last_name: data.last_name,\n          date_of_birth: data.date_of_birth || null,\n          gender: (data.gender as 'male' | 'female' | 'other') || null,\n          email: data.email || null,\n          phone: data.phone || null,\n          address: data.address || null,\n          city: data.city || null,\n          // class_id n'est pas inséré ici car il fait référence à \"classes\", pas \"sessions\"\n          // L'inscription à la session sera créée via la table \"enrollments\" ci-dessous\n          enrollment_date: data.enrollment_date,\n          status: 'active', // Statut par défaut pour un nouvel étudiant\n        })\n        .select()\n        .single()\n\n      if (studentError) {\n        console.error('Student creation error:', studentError)\n        console.error('Error details:', {\n          code: studentError.code,\n          message: studentError.message,\n          details: studentError.details,\n          hint: studentError.hint,\n        })\n        \n        // Gérer spécifiquement l'erreur de duplication de numéro d'élève\n        if (studentError.code === '23505') {\n          throw new Error(\n            `Un élève avec le numéro \"${studentNumber}\" existe déjà dans votre organisation. Veuillez réessayer ou contacter le support.`\n          )\n        }\n        \n        throw new Error(\n          studentError.message ||\n          'Une erreur est survenue lors de la création de l\\'élève'\n        )\n      }\n\n      // 4. Lier le tuteur à l'élève\n      const { error: linkError } = await supabase\n        .from('student_guardians')\n        .insert({\n          student_id: student.id,\n          guardian_id: guardian.id,\n          is_primary: true,\n        })\n\n      if (linkError) {\n        console.error('Link guardian error:', linkError)\n        throw new Error('Erreur lors de la liaison du tuteur à l\\'élève')\n      }\n\n      // 5. Créer l'inscription si une session est sélectionnée\n      if (data.class_id) {\n        const { error: enrollmentError } = await supabase\n          .from('enrollments')\n          .insert({\n            student_id: student.id,\n            session_id: data.class_id,\n            enrollment_date: data.enrollment_date,\n            status: 'confirmed',\n            payment_status: 'pending',\n            total_amount: 0,\n            paid_amount: 0,\n          })\n\n        if (enrollmentError) {\n          console.error('Enrollment error:', enrollmentError)\n          // Ne pas faire échouer la création de l'élève si l'inscription échoue\n          // On peut toujours créer l'inscription plus tard\n          console.warn('L\\'élève a été créé mais l\\'inscription à la session a échoué')\n        }\n      }\n\n      return student\n    },\n    onSuccess: (student) => {\n      router.push(`/dashboard/students/${student.id}`)\n    },\n    onError: (error) => {\n      console.error('Student creation mutation error:', error)\n    },\n  })\n\n  const onSubmit = async (data: StudentFormData) => {\n    console.log('onSubmit called:', { step, data })\n    \n    if (step < 3) {\n      // Valider les champs de l'étape actuelle\n      let fieldsToValidate: (keyof StudentFormData)[] = []\n      if (step === 1) {\n        // Étape 1 : Informations personnelles (sans enrollment_date qui est à l'étape 3)\n        fieldsToValidate = ['first_name', 'last_name']\n      } else if (step === 2) {\n        // Étape 2 : Informations du tuteur\n        fieldsToValidate = ['guardian_first_name', 'guardian_last_name', 'guardian_phone_primary']\n      }\n      \n      console.log('Validating fields:', fieldsToValidate)\n      const isValidStep = await trigger(fieldsToValidate)\n      console.log('Validation result:', { step, fieldsToValidate, isValidStep, errors })\n      \n      if (isValidStep) {\n        console.log('Validation passed, moving to step', step + 1)\n        setStep(step + 1)\n      } else {\n        console.log('Validation failed for step', step, 'Errors:', errors)\n      }\n    } else {\n      // Dernière étape : soumettre (valider tous les champs requis)\n      console.log('Final step, validating all fields')\n      const allFieldsValid = await trigger(['first_name', 'last_name', 'guardian_first_name', 'guardian_last_name', 'guardian_phone_primary', 'enrollment_date'])\n      if (allFieldsValid) {\n        console.log('All fields valid, creating student')\n        createMutation.mutate(data)\n      } else {\n        console.log('Final validation failed, errors:', errors)\n      }\n    }\n  }\n\n  // État pour suivre si l'étape actuelle est valide\n  const [isStepValid, setIsStepValid] = useState(false)\n  \n  // Observer les valeurs spécifiques du formulaire pour valider l'étape\n  const first_name = watch('first_name')\n  const last_name = watch('last_name')\n  const enrollment_date = watch('enrollment_date')\n  const guardian_first_name = watch('guardian_first_name')\n  const guardian_last_name = watch('guardian_last_name')\n  const guardian_phone_primary = watch('guardian_phone_primary')\n\n  // Valider l'étape actuelle quand les champs changent\n  const validateCurrentStep = async () => {\n    try {\n      if (step === 1) {\n        // Étape 1 : Seulement prénom et nom (enrollment_date est à l'étape 3)\n        const isValid = await trigger(['first_name', 'last_name'])\n        setIsStepValid(isValid)\n        return isValid\n      }\n      if (step === 2) {\n        const isValid = await trigger(['guardian_first_name', 'guardian_last_name', 'guardian_phone_primary'])\n        setIsStepValid(isValid)\n        return isValid\n      }\n      // Étape 3 : Valider tous les champs requis\n      if (step === 3) {\n        const isValid = await trigger(['enrollment_date'])\n        setIsStepValid(isValid)\n        return isValid\n      }\n      setIsStepValid(true)\n      return true\n    } catch (error) {\n      console.error('Validation error:', error)\n      setIsStepValid(false)\n      return false\n    }\n  }\n\n  // Valider l'étape quand elle change ou quand les valeurs pertinentes changent\n  useEffect(() => {\n    validateCurrentStep()\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [step, first_name, last_name, enrollment_date, guardian_first_name, guardian_last_name, guardian_phone_primary])\n  \n  // Valider aussi au montage initial\n  useEffect(() => {\n    if (step === 1) {\n      validateCurrentStep()\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  // Early returns après tous les hooks\n  if (userLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <p>Chargement...</p>\n      </div>\n    )\n  }\n\n  if (!user) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"bg-warning-bg border border-warning-border rounded-lg p-4\">\n          <h2 className=\"text-lg font-semibold text-warning-primary mb-2\">\n            Utilisateur non trouvé\n          </h2>\n          <p className=\"text-warning-primary mb-4\">\n            Votre compte n'existe pas encore dans la base de données. Cela peut arriver si votre compte a été créé récemment.\n          </p>\n          <div className=\"mt-4 space-y-2\">\n            <p className=\"text-sm text-warning-primary\">\n              Session ID : {session?.user?.id || 'Non défini'}\n            </p>\n            <p className=\"text-sm text-warning-primary\">\n              Email de session : {session?.user?.email || 'Non défini'}\n            </p>\n            <p className=\"text-sm text-warning-primary mt-4\">\n              <strong>Solution :</strong> Déconnectez-vous et créez un nouveau compte via <Link href=\"/auth/register\" className=\"text-primary underline\">/auth/register</Link>\n            </p>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  if (!user.organization_id) {\n    return (\n      <div className=\"space-y-6\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n          <h2 className=\"text-lg font-semibold text-red-800 mb-2\">\n            Organization ID manquant\n          </h2>\n          <p className=\"text-red-700 mb-4\">\n            Votre compte n'est pas associé à une organisation. Suivez les étapes ci-dessous pour corriger cela.\n          </p>\n          <div className=\"mt-4 space-y-2\">\n            <p className=\"text-sm text-red-600\">\n              User ID : {user.id || 'Non défini'}\n            </p>\n            <p className=\"text-sm text-red-600\">\n              Email : {user.email || 'Non défini'}\n            </p>\n            <div className=\"mt-4 p-3 bg-gray-50 rounded\">\n              <p className=\"text-sm font-semibold mb-2\">Pour corriger :</p>\n              <ol className=\"text-sm text-gray-700 list-decimal list-inside space-y-1\">\n                <li>Allez dans le SQL Editor de Supabase</li>\n                <li>Exécutez le script dans <code className=\"bg-gray-200 px-1 rounded\">supabase/fix_missing_organization.sql</code></li>\n                <li>Ou créez un nouveau compte via <Link href=\"/auth/register\" className=\"text-primary underline\">/auth/register</Link></li>\n              </ol>\n            </div>\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center space-x-4\">\n        <Link href=\"/dashboard/students\">\n          <Button variant=\"ghost\" size=\"icon\">\n            <ArrowLeft className=\"h-4 w-4\" />\n          </Button>\n        </Link>\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Nouvel élève</h1>\n          <p className=\"mt-2 text-sm text-gray-600\">\n            Inscrivez un nouvel élève en quelques étapes\n          </p>\n        </div>\n      </div>\n\n      {/* Progress bar */}\n      <div className=\"flex items-center space-x-2\">\n        {[1, 2, 3].map((s) => (\n          <div key={s} className=\"flex-1 flex items-center\">\n            <div\n              className={`flex-1 h-2 rounded ${\n                step >= s ? 'bg-primary' : 'bg-gray-200'\n              }`}\n            />\n            {s < 3 && (\n              <div\n                className={`w-2 h-2 rounded-full ${\n                  step > s ? 'bg-primary' : 'bg-gray-200'\n                }`}\n              />\n            )}\n          </div>\n        ))}\n        <div className=\"ml-4 text-sm text-muted-foreground\">\n          Étape {step} sur 3\n        </div>\n      </div>\n\n      <Card>\n        <CardHeader>\n          <CardTitle>\n            {step === 1 && 'Informations personnelles'}\n            {step === 2 && 'Informations du tuteur'}\n            {step === 3 && 'Informations académiques'}\n          </CardTitle>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\n            {step === 1 && (\n              <>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">\n                      Prénom *\n                    </label>\n                    <input\n                      type=\"text\"\n                      required\n                      {...register('first_name')}\n                      className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                    />\n                    {errors.first_name && (\n                      <p className=\"text-red-500 text-sm mt-1\">{errors.first_name.message}</p>\n                    )}\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">\n                      Nom *\n                    </label>\n                    <input\n                      type=\"text\"\n                      required\n                      {...register('last_name')}\n                      className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                    />\n                    {errors.last_name && (\n                      <p className=\"text-red-500 text-sm mt-1\">{errors.last_name.message}</p>\n                    )}\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">\n                      Date de naissance\n                    </label>\n                    <input\n                      type=\"date\"\n                      {...register('date_of_birth')}\n                      className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                    />\n                    {errors.date_of_birth && (\n                      <p className=\"text-red-500 text-sm mt-1\">{errors.date_of_birth.message}</p>\n                    )}\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">Genre</label>\n                    <select\n                      {...register('gender')}\n                      className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                    >\n                      <option value=\"\">Sélectionner</option>\n                      <option value=\"male\">Masculin</option>\n                      <option value=\"female\">Féminin</option>\n                      <option value=\"other\">Autre</option>\n                    </select>\n                  </div>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">Email</label>\n                    <input\n                      type=\"email\"\n                      {...register('email')}\n                      className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                    />\n                    {errors.email && (\n                      <p className=\"text-red-500 text-sm mt-1\">{errors.email.message}</p>\n                    )}\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">Téléphone</label>\n                    <input\n                      type=\"tel\"\n                      {...register('phone')}\n                      className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                    />\n                    {errors.phone && (\n                      <p className=\"text-red-500 text-sm mt-1\">{errors.phone.message}</p>\n                    )}\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">Adresse</label>\n                  <input\n                    type=\"text\"\n                    {...register('address')}\n                    className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                  />\n                  {errors.address && (\n                    <p className=\"text-red-500 text-sm mt-1\">{errors.address.message}</p>\n                  )}\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">Ville</label>\n                  <input\n                    type=\"text\"\n                    {...register('city')}\n                    className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                  />\n                  {errors.city && (\n                    <p className=\"text-red-500 text-sm mt-1\">{errors.city.message}</p>\n                  )}\n                </div>\n              </>\n            )}\n\n            {step === 2 && (\n              <>\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">\n                      Prénom du tuteur *\n                    </label>\n                    <input\n                      type=\"text\"\n                      required\n                      {...register('guardian_first_name')}\n                      className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                    />\n                    {errors.guardian_first_name && (\n                      <p className=\"text-red-500 text-sm mt-1\">{errors.guardian_first_name.message}</p>\n                    )}\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">\n                      Nom du tuteur *\n                    </label>\n                    <input\n                      type=\"text\"\n                      required\n                      {...register('guardian_last_name')}\n                      className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                    />\n                    {errors.guardian_last_name && (\n                      <p className=\"text-red-500 text-sm mt-1\">{errors.guardian_last_name.message}</p>\n                    )}\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">\n                    Lien de parenté *\n                  </label>\n                  <select\n                    required\n                    {...register('guardian_relationship')}\n                    className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                  >\n                    <option value=\"parent\">Parent</option>\n                    <option value=\"father\">Père</option>\n                    <option value=\"mother\">Mère</option>\n                    <option value=\"guardian\">Tuteur</option>\n                    <option value=\"other\">Autre</option>\n                  </select>\n                </div>\n\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">\n                      Téléphone principal *\n                    </label>\n                    <input\n                      type=\"tel\"\n                      required\n                      {...register('guardian_phone_primary')}\n                      className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                    />\n                    {errors.guardian_phone_primary && (\n                      <p className=\"text-red-500 text-sm mt-1\">{errors.guardian_phone_primary.message}</p>\n                    )}\n                  </div>\n                  <div>\n                    <label className=\"block text-sm font-medium mb-2\">\n                      Téléphone secondaire\n                    </label>\n                    <input\n                      type=\"tel\"\n                      {...register('guardian_phone_secondary')}\n                      className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                    />\n                    {errors.guardian_phone_secondary && (\n                      <p className=\"text-red-500 text-sm mt-1\">{errors.guardian_phone_secondary.message}</p>\n                    )}\n                  </div>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">\n                    Email du tuteur\n                  </label>\n                  <input\n                    type=\"email\"\n                    {...register('guardian_email')}\n                    className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                  />\n                  {errors.guardian_email && (\n                    <p className=\"text-red-500 text-sm mt-1\">{errors.guardian_email.message}</p>\n                  )}\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">\n                    Adresse du tuteur\n                  </label>\n                  <input\n                    type=\"text\"\n                    {...register('guardian_address')}\n                    className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                  />\n                  {errors.guardian_address && (\n                    <p className=\"text-red-500 text-sm mt-1\">{errors.guardian_address.message}</p>\n                  )}\n                </div>\n              </>\n            )}\n\n            {step === 3 && (\n              <>\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">\n                    Session\n                  </label>\n                  <select\n                    {...register('class_id')}\n                    className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                  >\n                    <option value=\"\">Sélectionner une session</option>\n                    {sessions?.map((session) => (\n                      <option key={session.id} value={session.id}>\n                        {session.name}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium mb-2\">\n                    Date d'inscription\n                  </label>\n                  <input\n                    type=\"date\"\n                    required\n                    {...register('enrollment_date')}\n                    className=\"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target\"\n                  />\n                  {errors.enrollment_date && (\n                    <p className=\"text-red-500 text-sm mt-1\">{errors.enrollment_date.message}</p>\n                  )}\n                </div>\n              </>\n            )}\n\n            <div className=\"flex justify-between pt-4\">\n              {step > 1 && (\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setStep(step - 1)}\n                >\n                  Précédent\n                </Button>\n              )}\n              <div className=\"ml-auto\">\n                <Button\n                  type=\"button\"\n                  onClick={async (e) => {\n                    e.preventDefault()\n                    console.log('Button clicked manually, step:', step)\n                    const formData = watch()\n                    console.log('Current form data:', formData)\n                    \n                    // Valider et passer à l'étape suivante\n                    if (step === 1) {\n                      const isValid = await trigger(['first_name', 'last_name'])\n                      console.log('Step 1 validation:', isValid, 'Errors:', errors)\n                      if (isValid) {\n                        console.log('Moving to step 2')\n                        setStep(2)\n                      }\n                    } else if (step === 2) {\n                      const isValid = await trigger(['guardian_first_name', 'guardian_last_name', 'guardian_phone_primary'])\n                      console.log('Step 2 validation:', isValid, 'Errors:', errors)\n                      if (isValid) {\n                        console.log('Moving to step 3')\n                        setStep(3)\n                      }\n                    } else {\n                      // Étape 3 : soumettre le formulaire\n                      await handleSubmit(onSubmit)(e as any)\n                    }\n                  }}\n                  disabled={createMutation.isPending}\n                >\n                  {step < 3\n                    ? 'Suivant'\n                    : createMutation.isPending\n                    ? 'Création...'\n                    : 'Créer l\\'élève'}\n                </Button>\n              </div>\n            </div>\n\n            {createMutation.error && (\n              <div className=\"bg-destructive/10 text-destructive px-4 py-3 rounded-lg text-sm space-y-1\">\n                <p className=\"font-semibold\">Erreur lors de la création de l'élève :</p>\n                <p>\n                  {createMutation.error instanceof Error\n                    ? createMutation.error.message\n                    : 'Une erreur est survenue'}\n                </p>\n                {createMutation.error && 'code' in createMutation.error && (\n                  <p className=\"text-xs opacity-75\">\n                    Code d'erreur: {String(createMutation.error.code)}\n                    {createMutation.error.code === '23505' && (\n                      <span className=\"block mt-1\">\n                        ❌ Un élève avec ce numéro existe déjà. Le système va générer automatiquement un numéro unique lors de la prochaine tentative.\n                      </span>\n                    )}\n                  </p>\n                )}\n              </div>\n            )}\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n\n"],"names":[],"mappings":"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"}