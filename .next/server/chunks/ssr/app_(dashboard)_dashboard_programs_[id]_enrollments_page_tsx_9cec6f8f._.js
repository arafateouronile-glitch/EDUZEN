module.exports=[462993,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(433217),f=a.i(370025),g=a.i(937927),h=a.i(269240),i=a.i(426099),j=a.i(337130),k=a.i(913216),l=a.i(340695),m=a.i(703130),n=a.i(400210),o=a.i(915618),p=a.i(941675),q=a.i(587532),r=a.i(581464),s=a.i(633508),t=a.i(238246),u=a.i(497895);function v(){let a=(0,d.useParams)();(0,d.useRouter)();let v=a.id,w=(0,h.createClient)(),x=(0,g.useQueryClient)(),{user:y}=(0,k.useAuth)(),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)("all"),[F,G]=(0,c.useState)("all"),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)({student_id:"",session_id:"",enrollment_date:new Date().toISOString().split("T")[0],status:"confirmed",payment_status:"pending",total_amount:"0",paid_amount:"0"}),{data:L,isLoading:M}=(0,e.useQuery)({queryKey:["program",v],queryFn:async()=>{let a=await i.programService.getProgramById(v),b=await j.formationService.getAllFormations(y?.organization_id||"",{programId:v});return{...a,formations:b}},enabled:!!v&&!!y?.organization_id}),{data:N}=(0,e.useQuery)({queryKey:["program-sessions",v],queryFn:async()=>{if(!L?.formations)return[];let a=[];for(let b of L.formations||[]){let c=await j.formationService.getSessionsByFormation(b.id);a.push(...c)}return a},enabled:!!L?.formations}),{data:O,isLoading:P}=(0,e.useQuery)({queryKey:["program-enrollments",v,B],queryFn:async()=>{let a=w.from("enrollments").select("*, students(*), sessions(name, formations(name, programs(name)))").order("enrollment_date",{ascending:!1});if(B)a=a.eq("session_id",B);else{if(!N||!(N.length>0))return[];let b=(N||[]).map(a=>a.id).filter(a=>!!a);if(!b||!(b.length>0))return[];a=a.in("session_id",b)}let{data:b,error:c}=await a;if(c)throw c;return b||[]},enabled:!!v&&(null!==B||N&&N.length>0)}),{data:Q}=(0,e.useQuery)({queryKey:["students",y?.organization_id],queryFn:async()=>{if(!y?.organization_id)return[];let{data:a,error:b}=await w.from("students").select("id, first_name, last_name, student_number, email").eq("organization_id",y.organization_id).eq("status","active").order("last_name",{ascending:!0});if(b)throw b;return a||[]},enabled:!!y?.organization_id}),R=O?.filter(a=>{if(z){let b=a.students,c=z.toLowerCase();if(!(b?.first_name?.toLowerCase().includes(c)||b?.last_name?.toLowerCase().includes(c)||b?.student_number?.toLowerCase().includes(c)||b?.email?.toLowerCase().includes(c)))return!1}return("all"===D||a.status===D)&&("all"===F||a.payment_status===F)}),S=(0,f.useMutation)({mutationFn:async()=>{if(!J.student_id||!J.session_id)throw Error("Veuillez sélectionner un élève et une session");let{data:a,error:b}=await w.from("enrollments").insert({student_id:J.student_id,session_id:J.session_id,enrollment_date:J.enrollment_date,status:J.status,payment_status:J.payment_status,total_amount:parseFloat(J.total_amount)||0,paid_amount:parseFloat(J.paid_amount)||0}).select().single();if(b)throw b;return a},onSuccess:()=>{x.invalidateQueries({queryKey:["program-enrollments",v]}),I(!1),K({student_id:"",session_id:"",enrollment_date:new Date().toISOString().split("T")[0],status:"confirmed",payment_status:"pending",total_amount:L?.price?.toString()||"0",paid_amount:"0"})}});(0,c.useEffect)(()=>{L?.price&&!J.total_amount&&K(a=>({...a,total_amount:L.price.toString()}))},[L?.price]);let T=O?{total:O.length,pending:O.filter(a=>"pending"===a.status).length,confirmed:O.filter(a=>"confirmed"===a.status).length,completed:O.filter(a=>"completed"===a.status).length,paid:O.filter(a=>"paid"===a.payment_status).length,totalAmount:O.reduce((a,b)=>a+(b.total_amount||0),0),paidAmount:O.reduce((a,b)=>a+(b.paid_amount||0),0)}:null;return M||P?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)("div",{className:"text-muted-foreground",children:"Chargement..."})})}):L?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(t.default,{href:`/dashboard/programs/${v}`,children:(0,b.jsx)(l.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(n.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Inscriptions"}),(0,b.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Gestion des inscriptions pour ",(0,b.jsx)(t.default,{href:`/dashboard/programs/${v}`,className:"text-primary hover:underline",children:L.name})]})]})]}),(0,b.jsxs)(l.Button,{onClick:()=>I(!0),children:[(0,b.jsx)(o.Plus,{className:"mr-2 h-4 w-4"}),"Nouvelle inscription"]})]}),T&&(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[(0,b.jsx)(m.Card,{children:(0,b.jsx)(m.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:T.total}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total"})]})})}),(0,b.jsx)(m.Card,{children:(0,b.jsx)(m.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-brand-cyan",children:T.pending}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"En attente"})]})})}),(0,b.jsx)(m.Card,{children:(0,b.jsx)(m.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:T.confirmed}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Confirmées"})]})})}),(0,b.jsx)(m.Card,{children:(0,b.jsx)(m.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-brand-blue",children:T.completed}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Terminées"})]})})}),(0,b.jsx)(m.Card,{children:(0,b.jsx)(m.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-brand-blue",children:T.paid}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Payées"})]})})}),(0,b.jsx)(m.Card,{children:(0,b.jsx)(m.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-lg font-bold",children:(0,u.formatCurrency)(T.totalAmount,L.currency||"XOF")}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total"})]})})}),(0,b.jsx)(m.Card,{children:(0,b.jsx)(m.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-lg font-bold",children:(0,u.formatCurrency)(T.paidAmount,L.currency||"XOF")}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Payé"})]})})})]}),(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsxs)(m.CardTitle,{className:"flex items-center",children:[(0,b.jsx)(r.Filter,{className:"mr-2 h-5 w-5"}),"Filtres"]})}),(0,b.jsx)(m.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsx)("div",{className:"md:col-span-1",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(q.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)("input",{type:"text",placeholder:"Rechercher un élève...",value:z,onChange:a=>A(a.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"})]})}),(0,b.jsx)("div",{children:(0,b.jsxs)("select",{value:B||"all",onChange:a=>C("all"===a.target.value?null:a.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,b.jsx)("option",{value:"all",children:"Toutes les sessions"}),N?.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})}),(0,b.jsx)("div",{children:(0,b.jsxs)("select",{value:D,onChange:a=>E(a.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,b.jsx)("option",{value:"all",children:"Tous les statuts"}),(0,b.jsx)("option",{value:"pending",children:"En attente"}),(0,b.jsx)("option",{value:"confirmed",children:"Confirmée"}),(0,b.jsx)("option",{value:"completed",children:"Terminée"}),(0,b.jsx)("option",{value:"cancelled",children:"Annulée"}),(0,b.jsx)("option",{value:"failed",children:"Échouée"})]})}),(0,b.jsx)("div",{children:(0,b.jsxs)("select",{value:F,onChange:a=>G(a.target.value),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,b.jsx)("option",{value:"all",children:"Tous les paiements"}),(0,b.jsx)("option",{value:"pending",children:"En attente"}),(0,b.jsx)("option",{value:"partial",children:"Partiel"}),(0,b.jsx)("option",{value:"paid",children:"Payé"}),(0,b.jsx)("option",{value:"overdue",children:"En retard"})]})})]})})]}),H&&(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(m.CardTitle,{children:"Nouvelle inscription"}),(0,b.jsx)(l.Button,{variant:"ghost",size:"icon",onClick:()=>I(!1),children:(0,b.jsx)(s.X,{className:"h-4 w-4"})})]})}),(0,b.jsx)(m.CardContent,{children:(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),S.mutate()},className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Élève *"}),(0,b.jsxs)("select",{required:!0,value:J.student_id,onChange:a=>K({...J,student_id:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,b.jsx)("option",{value:"",children:"Sélectionner un élève"}),Q?.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.first_name," ",a.last_name," (",a.student_number,")"]},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Session *"}),(0,b.jsxs)("select",{required:!0,value:J.session_id,onChange:a=>K({...J,session_id:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,b.jsx)("option",{value:"",children:"Sélectionner une session"}),N?.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," (",(0,u.formatDate)(a.start_date)," - ",(0,u.formatDate)(a.end_date),")"]},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date d'inscription *"}),(0,b.jsx)("input",{type:"date",required:!0,value:J.enrollment_date,onChange:a=>K({...J,enrollment_date:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Statut *"}),(0,b.jsxs)("select",{required:!0,value:J.status,onChange:a=>K({...J,status:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,b.jsx)("option",{value:"pending",children:"En attente"}),(0,b.jsx)("option",{value:"confirmed",children:"Confirmée"}),(0,b.jsx)("option",{value:"completed",children:"Terminée"}),(0,b.jsx)("option",{value:"cancelled",children:"Annulée"}),(0,b.jsx)("option",{value:"failed",children:"Échouée"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Montant total (",L.currency||"XOF",") *"]}),(0,b.jsx)("input",{type:"number",required:!0,step:"0.01",min:"0",value:J.total_amount,onChange:a=>K({...J,total_amount:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-medium mb-2",children:["Montant payé (",L.currency||"XOF",")"]}),(0,b.jsx)("input",{type:"number",step:"0.01",min:"0",value:J.paid_amount,onChange:a=>{let b=a.target.value,c=parseFloat(J.total_amount)||0,d=parseFloat(b)||0,e="pending";d>=c&&c>0?e="paid":d>0&&(e="partial"),K({...J,paid_amount:b,payment_status:e})},className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Statut de paiement"}),(0,b.jsxs)("select",{value:J.payment_status,onChange:a=>K({...J,payment_status:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,b.jsx)("option",{value:"pending",children:"En attente"}),(0,b.jsx)("option",{value:"partial",children:"Partiel"}),(0,b.jsx)("option",{value:"paid",children:"Payé"}),(0,b.jsx)("option",{value:"overdue",children:"En retard"})]})]})]}),S.error&&(0,b.jsx)("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-lg text-sm",children:S.error instanceof Error?S.error.message:"Une erreur est survenue lors de la création de l'inscription"}),(0,b.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,b.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>I(!1),children:"Annuler"}),(0,b.jsx)(l.Button,{type:"submit",disabled:S.isPending,children:S.isPending?"Création...":"Créer l'inscription"})]})]})})]}),(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsxs)(m.CardTitle,{children:["Liste des inscriptions (",R?.length||0,")"]})}),(0,b.jsx)(m.CardContent,{children:R&&R.length>0?(0,b.jsx)("div",{className:"space-y-4",children:R.map(a=>{let c=a.students,d=a.sessions;return(0,b.jsx)("div",{className:"p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"font-semibold text-lg",children:[c?.first_name," ",c?.last_name]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[c?.student_number," ",c?.email&&`• ${c.email}`]})]}),d&&(0,b.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,b.jsx)(p.Calendar,{className:"mr-1 h-4 w-4"}),d.name]})]}),(0,b.jsxs)("div",{className:"mt-2 flex items-center space-x-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Date d'inscription:"})," ",(0,b.jsx)("span",{className:"font-medium",children:(0,u.formatDate)(a.enrollment_date)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Montant:"})," ",(0,b.jsx)("span",{className:"font-medium",children:(0,u.formatCurrency)(a.total_amount||0,L.currency||"XOF")})]}),a.paid_amount>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Payé:"})," ",(0,b.jsx)("span",{className:"font-medium",children:(0,u.formatCurrency)(a.paid_amount,L.currency||"XOF")})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs font-medium ${(a=>{switch(a){case"pending":return"bg-warning-bg text-warning-primary";case"confirmed":return"bg-blue-100 text-blue-800";case"completed":return"bg-success-bg text-success-primary";case"cancelled":default:return"bg-gray-100 text-gray-800";case"failed":return"bg-red-100 text-red-800"}})(a.status)}`,children:(a=>{switch(a){case"pending":return"En attente";case"confirmed":return"Confirmée";case"completed":return"Terminée";case"cancelled":return"Annulée";case"failed":return"Échouée";default:return a}})(a.status)}),(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs font-medium ${(a=>{switch(a){case"pending":return"bg-brand-cyan-ghost text-brand-cyan";case"partial":return"bg-brand-cyan-pale text-brand-cyan";case"paid":return"bg-brand-blue-ghost text-brand-blue";case"overdue":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(a.payment_status)}`,children:(a=>{switch(a){case"pending":return"En attente";case"partial":return"Partiel";case"paid":return"Payé";case"overdue":return"En retard";default:return a}})(a.payment_status)})]})]})},a.id)})}):(0,b.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:O&&0===O.length?"Aucune inscription pour ce programme":"Aucune inscription ne correspond aux critères de recherche"})})]})]}):(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-muted-foreground",children:"Programme non trouvé"}),(0,b.jsx)(t.default,{href:"/dashboard/programs",children:(0,b.jsx)(l.Button,{className:"mt-4",children:"Retour à la liste"})})]})})}a.s(["default",()=>v])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_programs_%5Bid%5D_enrollments_page_tsx_9cec6f8f._.js.map