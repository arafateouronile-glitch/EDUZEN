module.exports=[231785,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(269240);let i=new class{supabase;constructor(a){this.supabase=a||(0,h.createClient)()}async getIndicators(a){let{data:b,error:c}=await this.supabase.from("qualiopi_indicators").select("*").eq("organization_id",a).order("indicator_code",{ascending:!0});if(c){if("PGRST116"===c.code||"42P01"===c.code||"PGRST301"===c.code||404===c.status||"404"===c.code||c.message?.includes("relation")||c.message?.includes("relationship")||c.message?.includes("does not exist")||c.message?.includes("schema cache"))return console.warn("Table qualiopi_indicators does not exist yet or invalid query:",c?.message),[];throw c}return b||[]}async getIndicatorByCode(a,b){let{data:c,error:d}=await this.supabase.from("qualiopi_indicators").select("*").eq("organization_id",a).eq("indicator_code",b).single();if(d){if("PGRST116"===d.code)return null;throw d}return c}async upsertIndicator(a){let{data:b,error:c}=await this.supabase.from("qualiopi_indicators").upsert(a,{onConflict:"organization_id,indicator_code"}).select().single();if(c)throw c;return b}async updateIndicatorStatus(a,b,c){let d={status:b,updated_at:new Date().toISOString()};void 0!==c&&(d.compliance_rate=c,d.last_evaluation_date=new Date().toISOString());let{error:e}=await this.supabase.from("qualiopi_indicators").update(d).eq("id",a);if(e)throw e}async getEvidence(a){let{data:b,error:c}=await this.supabase.from("qualiopi_evidence").select("*").eq("indicator_id",a).order("upload_date",{ascending:!1});if(c)throw c;return b||[]}async addEvidence(a){let{data:b,error:c}=await this.supabase.from("qualiopi_evidence").insert(a).select().single();if(c)throw c;return b}async getCorrectiveActions(a,b){let c=this.supabase.from("qualiopi_corrective_actions").select("*").eq("organization_id",a);b?.indicatorId&&(c=c.eq("indicator_id",b.indicatorId)),b?.status&&(c=c.eq("status",b.status)),b?.priority&&(c=c.eq("priority",b.priority));let{data:d,error:e}=await c.order("created_at",{ascending:!1});if(e)throw e;return d||[]}async createCorrectiveAction(a){let{data:b,error:c}=await this.supabase.from("qualiopi_corrective_actions").insert(a).select().single();if(c)throw c;return b}async getAudits(a){let{data:b,error:c}=await this.supabase.from("qualiopi_audits").select("*").eq("organization_id",a).order("audit_date",{ascending:!1});if(c)throw c;return b||[]}async createAudit(a){let{data:b,error:c}=await this.supabase.from("qualiopi_audits").insert(a).select().single();if(c)throw c;return b}async calculateComplianceRate(a){try{let{data:b,error:c}=await this.supabase.rpc("calculate_qualiopi_compliance_rate",{org_id:a});if(c){if("PGRST116"===c.code||"42883"===c.code||"PGRST301"===c.code||404===c.status||"404"===c.code||"404"===String(c.status)||"404"===String(c.code)||c.message?.toLowerCase().includes("function")||c.message?.toLowerCase().includes("does not exist")||c.message?.toLowerCase().includes("schema cache")||c.message?.toLowerCase().includes("not found")||c.message?.toLowerCase().includes("404"))return 0;throw c}return b||0}catch(a){if(a?.status===404||a?.code==="404"||"404"===String(a?.status)||a?.message?.toLowerCase().includes("not found")||a?.message?.toLowerCase().includes("404")||a?.message?.toLowerCase().includes("function")||a?.message?.toLowerCase().includes("does not exist"))return 0;throw a}}async initializeIndicators(a){let b=[{code:"1.1",name:"Information préalable",category:"conditions_reception"},{code:"1.2",name:"Accueil et accompagnement",category:"conditions_reception"},{code:"1.3",name:"Accessibilité",category:"conditions_reception"},{code:"2.1",name:"Identification des besoins",category:"identification_objectifs"},{code:"2.2",name:"Définition des objectifs",category:"identification_objectifs"},{code:"3.1",name:"Adaptation pédagogique",category:"adaptation_parcours"},{code:"3.2",name:"Suivi individualisé",category:"adaptation_parcours"},{code:"4.1",name:"Ressources pédagogiques",category:"adéquation_ressources"},{code:"4.2",name:"Ressources techniques",category:"adéquation_ressources"},{code:"4.3",name:"Ressources humaines",category:"adéquation_ressources"},{code:"5.1",name:"Compétences pédagogiques",category:"compétences_formateurs"},{code:"5.2",name:"Compétences techniques",category:"compétences_formateurs"},{code:"5.3",name:"Formation continue",category:"compétences_formateurs"},{code:"6.1",name:"Processus d'inscription",category:"inscription"},{code:"6.2",name:"Contrat de formation",category:"inscription"},{code:"7.1",name:"Évaluation des acquis",category:"evaluation"},{code:"7.2",name:"Certification",category:"evaluation"},{code:"8.1",name:"Accessibilité physique",category:"accessibilite"},{code:"8.2",name:"Accessibilité numérique",category:"accessibilite"},{code:"9.1",name:"Transparence de l'information",category:"information_public"},{code:"9.2",name:"Publicité",category:"information_public"},{code:"10.1",name:"Gouvernance et pilotage",category:"gouvernance"},{code:"10.2",name:"Amélioration continue",category:"gouvernance"}].map(b=>({organization_id:a,indicator_code:b.code,indicator_name:b.name,category:b.category,status:"not_started",compliance_rate:0})),{error:c}=await this.supabase.from("qualiopi_indicators").upsert(b,{onConflict:"organization_id,indicator_code",ignoreDuplicates:!1});if(c){if("PGRST116"===c.code||"42P01"===c.code||"PGRST301"===c.code||404===c.status||"404"===c.code||c.message?.includes("relation")||c.message?.includes("relationship")||c.message?.includes("does not exist")||c.message?.includes("schema cache"))throw console.warn("Table qualiopi_indicators does not exist yet. Please create the table first:",c?.message),Error("La table qualiopi_indicators n'existe pas encore. Veuillez créer la table dans la base de données.");throw c}}};var j=a.i(703130),k=a.i(340695),l=a.i(254161),m=a.i(621958),n=a.i(864037),o=a.i(603314),p=a.i(111269),q=a.i(54018),r=a.i(290821),s=a.i(641710),t=a.i(104720),u=a.i(724669),v=a.i(915618),w=a.i(669520),x=a.i(660450),y=a.i(238246);let z={not_started:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800",compliant:"bg-green-100 text-green-800",non_compliant:"bg-red-100 text-red-800",needs_improvement:"bg-yellow-100 text-yellow-800"},A={not_started:s.Clock,in_progress:w.RefreshCw,compliant:p.CheckCircle2,non_compliant:q.XCircle,needs_improvement:r.AlertCircle};function B(){let{user:a}=(0,g.useAuth)(),h=(0,f.useQueryClient)(),{addToast:B}=(0,n.useToast)(),[C,D]=(0,c.useState)("all"),{data:E=[],isLoading:F}=(0,d.useQuery)({queryKey:["qualiopi-indicators",a?.organization_id],queryFn:async()=>{try{return await i.getIndicators(a.organization_id)}catch(a){if(a?.code==="PGRST116"||a?.code==="42P01"||a?.code==="PGRST301"||a?.status===404||a?.code==="404"||a?.message?.includes("relation")||a?.message?.includes("relationship")||a?.message?.includes("does not exist")||a?.message?.includes("schema cache"))return console.warn("Error fetching qualiopi indicators:",a?.message),[];throw a}},enabled:!!a?.organization_id,retry:!1}),{data:G=0}=(0,d.useQuery)({queryKey:["qualiopi-compliance-rate",a?.organization_id],queryFn:async()=>{try{return await i.calculateComplianceRate(a.organization_id)}catch(a){if(a?.code==="PGRST116"||a?.code==="42883"||a?.code==="PGRST301"||a?.status===404||a?.code==="404"||"404"===String(a?.status)||a?.message?.toLowerCase().includes("function")||a?.message?.toLowerCase().includes("does not exist")||a?.message?.toLowerCase().includes("schema cache")||a?.message?.toLowerCase().includes("not found")||a?.message?.toLowerCase().includes("404"))return 0;throw a}},enabled:!!a?.organization_id,retry:!1}),H=(0,e.useMutation)({mutationFn:()=>i.initializeIndicators(a.organization_id),onSuccess:()=>{h.invalidateQueries({queryKey:["qualiopi-indicators"]}),B({title:"Indicateurs initialisés",description:"Les indicateurs Qualiopi ont été initialisés avec succès.",type:"success"})},onError:a=>{console.error("Error initializing indicators:",a),B({type:"error",title:"Erreur",description:a?.message||"Une erreur est survenue lors de l'initialisation des indicateurs."})}}),I=Array.from(new Set(E.map(a=>a.category))),J="all"===C?E:E.filter(a=>a.category===C),K={total:E.length,compliant:E.filter(a=>"compliant"===a.status).length,inProgress:E.filter(a=>"in_progress"===a.status).length,nonCompliant:E.filter(a=>"non_compliant"===a.status).length};return F?(0,b.jsx)("div",{className:"container mx-auto py-8 px-4",children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)(w.RefreshCw,{className:"h-8 w-8 animate-spin text-brand-blue"})})}):0===E.length?(0,b.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-4xl",children:(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsxs)(j.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Shield,{className:"h-6 w-6"}),"Module Qualiopi"]}),(0,b.jsx)(j.CardDescription,{children:"Initialisez les indicateurs Qualiopi pour commencer la gestion de votre certification qualité"})]}),(0,b.jsx)(j.CardContent,{children:(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("p",{className:"text-muted-foreground mb-6",children:"Aucun indicateur Qualiopi n'a été configuré pour votre organisation."}),(0,b.jsx)(k.Button,{onClick:()=>H.mutate(),disabled:H.isPending,children:H.isPending?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}),"Initialisation..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(v.Plus,{className:"h-4 w-4 mr-2"}),"Initialiser les indicateurs Qualiopi"]})})]})})]})}):(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-2",children:[(0,b.jsx)(o.Shield,{className:"h-8 w-8 text-brand-blue"}),"Certification Qualiopi"]}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Gérez votre certification qualité et vos indicateurs de conformité"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Taux de conformité"}),(0,b.jsxs)("p",{className:"text-2xl font-bold",children:[G.toFixed(1),"%"]})]}),(0,b.jsx)(u.TrendingUp,{className:"h-8 w-8 text-green-500"})]})})}),(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Conformes"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:K.compliant})]}),(0,b.jsx)(p.CheckCircle2,{className:"h-8 w-8 text-green-500"})]})})}),(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"En cours"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:K.inProgress})]}),(0,b.jsx)(s.Clock,{className:"h-8 w-8 text-blue-500"})]})})}),(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Non conformes"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:K.nonCompliant})]}),(0,b.jsx)(q.XCircle,{className:"h-8 w-8 text-red-500"})]})})})]}),(0,b.jsxs)(j.Card,{className:"mb-8 border-blue-200 bg-blue-50/50",children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsxs)(j.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(x.Accessibility,{className:"h-5 w-5 text-blue-600"}),"Critère 8 - Accessibilité Handicap"]}),(0,b.jsx)(j.CardDescription,{children:"Gestion de l'accessibilité conforme aux exigences Qualiopi (indicateurs 8.1 et 8.2)"})]}),(0,b.jsx)(j.CardContent,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Assurez-vous de désigner un référent handicap, définir une politique d'accessibilité, et mettre en place des aménagements pour les stagiaires en situation de handicap."}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)(l.Badge,{variant:"outline",className:"bg-white",children:"Indicateur 8.1 : Accessibilité physique"}),(0,b.jsx)(l.Badge,{variant:"outline",className:"bg-white",children:"Indicateur 8.2 : Accessibilité numérique"})]})]}),(0,b.jsx)(y.default,{href:"/dashboard/accessibility",children:(0,b.jsx)(k.Button,{className:"ml-4",children:"Gérer l'accessibilité"})})]})})]}),(0,b.jsx)(m.Tabs,{value:C,onValueChange:D,className:"mb-6",children:(0,b.jsxs)(m.TabsList,{children:[(0,b.jsxs)(m.TabsTrigger,{value:"all",children:["Tous (",E.length,")"]}),I.map(a=>(0,b.jsx)(m.TabsTrigger,{value:a,children:a.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())},a))]})}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:J.map(a=>{let c=A[a.status];return(0,b.jsxs)(j.Card,{className:"hover:shadow-lg transition-shadow",children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.CardTitle,{className:"text-lg",children:a.indicator_code}),(0,b.jsx)(j.CardDescription,{className:"mt-1",children:a.indicator_name})]}),(0,b.jsx)(c,{className:`h-5 w-5 ${z[a.status].split(" ")[1]}`})]})}),(0,b.jsx)(j.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Statut"}),(0,b.jsx)(l.Badge,{className:z[a.status],children:a.status.replace(/_/g," ")})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Conformité"}),(0,b.jsxs)("span",{className:"font-semibold",children:[a.compliance_rate,"%"]})]}),(0,b.jsx)(k.Button,{variant:"outline",className:"w-full",asChild:!0,children:(0,b.jsxs)(y.default,{href:`/dashboard/qualiopi/indicators/${a.id}`,children:[(0,b.jsx)(t.FileText,{className:"h-4 w-4 mr-2"}),"Voir les détails"]})})]})})]},a.id)})}),(0,b.jsxs)("div",{className:"mt-8 flex gap-4",children:[(0,b.jsx)(k.Button,{asChild:!0,children:(0,b.jsxs)(y.default,{href:"/dashboard/qualiopi/audits",children:[(0,b.jsx)(t.FileText,{className:"h-4 w-4 mr-2"}),"Audits"]})}),(0,b.jsx)(k.Button,{variant:"outline",asChild:!0,children:(0,b.jsxs)(y.default,{href:"/dashboard/qualiopi/actions",children:[(0,b.jsx)(r.AlertCircle,{className:"h-4 w-4 mr-2"}),"Actions correctives"]})}),(0,b.jsx)(k.Button,{variant:"outline",asChild:!0,children:(0,b.jsxs)(y.default,{href:"/dashboard/qualiopi/reports",children:[(0,b.jsx)(t.FileText,{className:"h-4 w-4 mr-2"}),"Rapports"]})})]})]})}a.s(["default",()=>B],231785)}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_qualiopi_page_tsx_a364f636._.js.map