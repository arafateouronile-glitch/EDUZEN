module.exports=[724669,a=>{"use strict";let b=(0,a.i(170106).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);a.s(["TrendingUp",()=>b],724669)},535026,a=>{"use strict";var b=a.i(187924),c=a.i(433217),d=a.i(913216),e=a.i(269240),f=a.i(703130),g=a.i(546842),h=a.i(724669),i=a.i(290821),j=a.i(497895),k=a.i(238246);function l(){let{user:a}=(0,d.useAuth)(),l=(0,e.createClient)(),{data:m}=(0,c.useQuery)({queryKey:["children",a?.id],queryFn:async()=>{if(!a?.id||a?.role!=="parent")return[];let{data:b}=await l.from("guardians").select("id").eq("user_id",a.id);if(!b||0===b.length)return[];let{data:c}=await l.from("student_guardians").select("student_id").in("guardian_id",b.map(a=>a.id));if(!c||0===c.length)return[];let{data:d}=await l.from("students").select("*, classes(name)").in("id",c.map(a=>a.student_id).filter(a=>null!==a)).eq("status","active");return d||[]},enabled:!!a?.id&&a?.role==="parent"}),{data:n}=(0,c.useQuery)({queryKey:["student",a?.id],queryFn:async()=>{if(!a?.id||a?.role!=="student")return null;let{data:b}=await l.from("students").select("*, classes(name)").eq("id",a.id).single();return b},enabled:!!a?.id&&a?.role==="student"}),{data:o}=(0,c.useQuery)({queryKey:["unpaid-invoices",a?.id],queryFn:async()=>{if(!a?.id)return[];let b=[];if(a?.role==="parent"&&m?b=m.map(a=>a.id):a?.role==="student"&&n&&(b=[n.id]),0===b.length)return[];let{data:c}=await l.from("invoices").select("*").in("student_id",b).in("status",["sent","partial","overdue"]).order("due_date",{ascending:!0}).limit(5);return c||[]},enabled:!!a?.id&&a?.role==="parent"&&!!m||!!a?.id&&a?.role==="student"&&!!n}),{data:p}=(0,c.useQuery)({queryKey:["recent-attendance",a?.id],queryFn:async()=>{if(!a?.id)return[];let b=[];if(a?.role==="parent"&&m?b=m.map(a=>a.id):a?.role==="student"&&n&&(b=[n.id]),0===b.length)return[];let{data:c}=await l.from("attendance").select("*, students(first_name, last_name), classes(name)").in("student_id",b).order("date",{ascending:!1}).limit(10);return c||[]},enabled:!!a?.id&&a?.role==="parent"&&!!m||!!a?.id&&a?.role==="student"&&!!n}),{data:q}=(0,c.useQuery)({queryKey:["attendance-stats",a?.id],queryFn:async()=>{if(!a?.id)return null;let b=[];if(a?.role==="parent"&&m?b=m.map(a=>a.id):a?.role==="student"&&n&&(b=[n.id]),0===b.length)return null;let c=new Date;c.setDate(1);let{data:d}=await l.from("attendance").select("status").in("student_id",b).gte("date",c.toISOString().split("T")[0]),e=d?.length||0,f=d?.filter(a=>"present"===a.status).length||0;return{total:e,present:f,absent:d?.filter(a=>"absent"===a.status).length||0,rate:e>0?Math.round(f/e*100):0}},enabled:!!a?.id&&a?.role==="parent"&&!!m||!!a?.id&&a?.role==="student"&&!!n});return a?.role,(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:a?.role==="parent"?"Tableau de bord Parent":"Tableau de bord Étudiant"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Vue d'ensemble de la scolarité"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Taux de présence (mois)"}),(0,b.jsx)(h.TrendingUp,{className:"h-5 w-5 text-brand-blue"})]}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold text-brand-blue",children:[q?.rate||0,"%"]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[q?.present||0," présences / ",q?.total||0," jours"]})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Factures en attente"}),(0,b.jsx)(i.AlertCircle,{className:"h-5 w-5 text-red-600"})]}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:o?.length||0}),o&&o.length>0&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Total: ",(0,j.formatCurrency)(o.reduce((a,b)=>a+Number(b.total_amount)-Number(b.paid_amount||0),0),o[0]?.currency||"XOF")]})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:a?.role==="parent"?"Enfants":"Classe"}),(0,b.jsx)(g.User,{className:"h-5 w-5 text-blue-600"})]}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:a?.role==="parent"?m?.length||0:+!!n}),a?.role==="student"&&n&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:n.classes?.name||"Non assigné"})]})]})]}),a?.role==="parent"&&m&&m.length>0&&(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"Mes enfants"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(a=>(0,b.jsx)(k.default,{href:`/portal/children/${a.id}`,className:"p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[a.photo_url?(0,b.jsx)("img",{src:a.photo_url,alt:`${a.first_name} ${a.last_name}`,className:"h-16 w-16 rounded-full object-cover"}):(0,b.jsxs)("div",{className:"h-16 w-16 rounded-full bg-primary text-white flex items-center justify-center text-xl font-semibold",children:[a.first_name.charAt(0),a.last_name.charAt(0)]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"font-semibold",children:[a.first_name," ",a.last_name]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.classes?.name||"Non assigné"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:a.student_number})]})]})},a.id))})})]}),o&&o.length>0&&(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"Factures en attente de paiement"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:o.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold",children:a.invoice_number}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Échéance: ",(0,j.formatDate)(a.due_date)]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"font-semibold text-lg",children:(0,j.formatCurrency)(Number(a.total_amount)-Number(a.paid_amount||0),a.currency)}),(0,b.jsx)(k.default,{href:`/portal/payments/${a.id}`,children:(0,b.jsx)("button",{className:"mt-2 px-4 py-2 bg-primary text-white rounded-lg text-sm hover:bg-primary-dark transition-colors",children:"Payer"})})]})]},a.id))})})]}),p&&p.length>0&&(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"Présences récentes"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"space-y-2",children:p.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-medium",children:[a.students?.first_name," ",a.students?.last_name,a.classes?.name&&` - ${a.classes.name}`]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,j.formatDate)(a.date)})]}),(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"present"===a.status?"bg-success-bg text-success-primary":"absent"===a.status?"bg-red-100 text-red-800":"late"===a.status?"bg-warning-bg text-warning-primary":"bg-blue-100 text-blue-800"}`,children:"present"===a.status?"Présent":"absent"===a.status?"Absent":"late"===a.status?"En retard":"Justifié"})]},a.id))})})]})]})}a.s(["default",()=>l])}];

//# sourceMappingURL=_fd220511._.js.map