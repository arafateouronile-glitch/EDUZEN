module.exports=[915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},641710,a=>{"use strict";let b=(0,a.i(170106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],641710)},219897,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);a.i(460355);var e=a.i(346271);let f=c.forwardRef(({className:a,variant:c="default",hoverable:f=!1,glow:g=!1,glowColor:h="rgba(51, 90, 207, 0.3)",...i},j)=>(0,b.jsxs)(e.motion.div,{ref:j,className:(0,d.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===c,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===c,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===c,"cursor-pointer":f,"hover:shadow-2xl hover:scale-[1.02]":f,"hover:bg-white/90 dark:hover:bg-gray-900/90":f},a),whileHover:f?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...i,children:[g&&(0,b.jsx)(e.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${h} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,b.jsx)("div",{className:"relative z-10",children:i.children})]}));f.displayName="GlassCard",a.s(["GlassCard",()=>f])},495756,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],495756)},114548,a=>{"use strict";let b=(0,a.i(170106).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);a.s(["Save",()=>b],114548)},724669,a=>{"use strict";let b=(0,a.i(170106).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);a.s(["TrendingUp",()=>b],724669)},581464,a=>{"use strict";let b=(0,a.i(170106).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);a.s(["Filter",()=>b],581464)},613749,a=>{"use strict";let b=(0,a.i(170106).default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);a.s(["ChevronLeft",()=>b],613749)},367329,a=>{"use strict";let b=(0,a.i(170106).default)("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);a.s(["List",()=>b],367329)},960702,a=>{"use strict";let b=(0,a.i(170106).default)("CalendarDays",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);a.s(["CalendarDays",()=>b],960702)},988505,a=>{"use strict";var b=a.i(269240);let c=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getTodos(a,b){let c=this.supabase.from("calendar_todos").select("*").eq("organization_id",a).order("due_date",{ascending:!0});b?.startDate&&(c=c.gte("due_date",b.startDate)),b?.endDate&&(c=c.lte("due_date",b.endDate)),b?.status&&(c=Array.isArray(b.status)?c.in("status",b.status):c.eq("status",b.status)),b?.category&&(c=c.eq("category",b.category)),b?.priority&&(c=c.eq("priority",b.priority)),b?.assignedTo&&(c=c.eq("assigned_to",b.assignedTo)),b?.createdBy&&(c=c.eq("created_by",b.createdBy)),b?.search&&(c=c.or(`title.ilike.%${b.search}%,description.ilike.%${b.search}%`));let{data:d,error:e}=await c;if(e){if("PGRST116"===e.code||"42P01"===e.code||e.message?.includes("does not exist"))return[];throw e}return d||[]}async getTodoById(a){let{data:b,error:c}=await this.supabase.from("calendar_todos").select("*").eq("id",a).single();if(c){if("PGRST116"===c.code||"42P01"===c.code||c.message?.includes("does not exist"))return null;throw c}return b}async createTodo(a){let{data:b,error:c}=await this.supabase.from("calendar_todos").insert(a).select().single();if(c)throw c;return!1!==a.reminder_enabled&&await this.supabase.rpc("create_todo_reminder_notification",{todo_id:b.id}),b}async updateTodo(a,b){let{data:c,error:d}=await this.supabase.from("calendar_todos").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteTodo(a){let{error:b}=await this.supabase.from("calendar_todos").delete().eq("id",a);if(b)throw b}async completeTodo(a){return this.updateTodo(a,{status:"completed"})}async completeTodos(a){let{error:b}=await this.supabase.from("calendar_todos").update({status:"completed"}).in("id",a);if(b)throw b}async getCalendarEvents(a,b,c,d){try{let e={p_organization_id:a,p_start_date:b,p_end_date:c};d&&(e.p_user_id=d);let{data:f,error:g}=await this.supabase.rpc("get_calendar_events",e);if(g){if("42883"===g.code||"PGRST116"===g.code||"42P01"===g.code||"400"===g.code||g.message?.includes("does not exist")||g.message?.includes("function")||g.message?.includes("does not exist"))return this.getCalendarEventsManual(a,b,c,d);throw g}return f||[]}catch(e){return this.getCalendarEventsManual(a,b,c,d)}}async getCalendarEventsManual(a,b,c,d){let e=[];try{let d=await this.getTodos(a,{startDate:b,endDate:c});e.push(...d.map(a=>({event_id:a.id,event_type:"todo",title:a.title,description:a.description,start_date:a.start_date||a.due_date,start_time:a.start_time,end_date:a.due_date,end_time:a.due_time,all_day:a.all_day,status:a.status,color:a.color,category:a.category,priority:a.priority,linked_id:a.linked_session_id||a.linked_formation_id||null})))}catch(a){}try{let f,g=this.supabase.from("sessions").select("id, name, start_date, end_date, start_time, end_time, location, status, formation_id, organization_id, formations(id, name)").eq("organization_id",a);if(d){let{data:a}=await this.supabase.from("users").select("role").eq("id",d).maybeSingle();if(a?.role==="teacher"){let{data:a}=await this.supabase.from("session_teachers").select("session_id").eq("teacher_id",d);if(a&&a.length>0){let b=a.map(a=>a.session_id);g=g.in("id",b)}else{let{data:a,error:b}=await g.limit(0);b&&b.code,f=[]}}}let h=null;if(void 0===f){let{data:a,error:b}=await g;if(f=a,h=b)throw h}if(h)throw h;if(f){let a=new Date(b),d=new Date(c),g=f.filter(b=>{if(!b.start_date)return!1;let c=new Date(b.start_date),e=b.end_date?new Date(b.end_date):null;return c>=a&&c<=d||e&&e>=a&&e<=d||c<=a&&(!e||e>=a)||c<=a&&e&&e>=d}).map(a=>{let b=a.start_date?"string"==typeof a.start_date?a.start_date.split("T")[0]:new Date(a.start_date).toISOString().split("T")[0]:null,c=a.end_date?"string"==typeof a.end_date?a.end_date.split("T")[0]:new Date(a.end_date).toISOString().split("T")[0]:null,d=[];if(a.start_time){let b=a.start_time.slice(0,5),c=a.end_time?a.end_time.slice(0,5):null;c?d.push(`ðŸ• ${b} - ${c}`):d.push(`ðŸ• ${b}`)}return a.location&&d.push(`ðŸ“ ${a.location}`),a.formations?.name&&d.push(`ðŸ“š ${a.formations.name}`),{event_id:a.id,event_type:"session",title:a.name,description:d.length>0?d.join(" â€¢ "):null,start_date:b||"",start_time:a.start_time,end_date:c||b||"",end_time:a.end_time,all_day:!1,status:a.status,color:"#10B981",category:"session",priority:"medium",linked_id:a.formation_id,location:a.location||null,formation_name:a.formations?.name||null}});e.push(...g)}}catch(a){}try{let f=this.supabase.from("formations").select("*, sessions(id, start_date, end_date)").eq("organization_id",a);if(d){let{data:a}=await this.supabase.from("users").select("role").eq("id",d).maybeSingle();if(a?.role==="teacher"){let{data:a}=await this.supabase.from("session_teachers").select("session_id").eq("teacher_id",d);if(!a||!(a.length>0))return e;{let b=a.map(a=>a.session_id),{data:c}=await this.supabase.from("sessions").select("formation_id").in("id",b);if(!c||!(c.length>0))return e;{let a=[...new Set(c.map(a=>a.formation_id).filter(a=>!!a))];if(!(a.length>0))return e;f=f.in("id",a)}}}}let{data:g,error:h}=await f;if(h)throw h;if(g){let a=new Date(b),d=new Date(c),f=g.map(a=>{let b=a.sessions||[];if(0===b.length)return null;let c=b.filter(a=>a.start_date).map(a=>({start:new Date(a.start_date),end:a.end_date?new Date(a.end_date):null}));if(0===c.length)return null;let d=new Date(Math.min(...c.map(a=>a.start.getTime()))),e=c.map(a=>a.end).filter(a=>null!==a),f=e.length>0?new Date(Math.max(...e.map(a=>a.getTime()))):null;return{formation:a,start_date:d,end_date:f}}).filter(a=>null!==a).filter(({start_date:b,end_date:c})=>b>=a&&b<=d||c&&c>=a&&c<=d||b<=a&&(!c||c>=a)||b<=a&&c&&c>=d).map(({formation:a,start_date:b,end_date:c})=>({event_id:a.id,event_type:"formation",title:a.name,description:a.description,start_date:b.toISOString().split("T")[0],start_time:null,end_date:c?c.toISOString().split("T")[0]:b.toISOString().split("T")[0],end_time:null,all_day:!0,status:a.is_active?"active":"inactive",color:"#8B5CF6",category:"formation",priority:"medium",linked_id:a.program_id}));e.push(...f)}}catch(a){}return e}async getNotifications(a,b){let c=this.supabase.from("calendar_notifications").select("*").eq("user_id",a).order("scheduled_at",{ascending:!1});b?.status&&(c=c.eq("status",b.status)),b?.unreadOnly&&(c=c.in("status",["pending","sent"])),b?.limit&&(c=c.limit(b.limit));let{data:d,error:e}=await c;if(e){if("PGRST116"===e.code||"42P01"===e.code||e.message?.includes("does not exist"))return[];throw e}return d||[]}async markNotificationAsRead(a){let{error:b}=await this.supabase.from("calendar_notifications").update({status:"read",read_at:new Date().toISOString()}).eq("id",a);if(b)throw b}async markAllNotificationsAsRead(a){let{error:b}=await this.supabase.from("calendar_notifications").update({status:"read",read_at:new Date().toISOString()}).eq("user_id",a).in("status",["pending","sent"]);if(b)throw b}async dismissNotification(a){let{error:b}=await this.supabase.from("calendar_notifications").update({status:"dismissed"}).eq("id",a);if(b)throw b}async countUnreadNotifications(a){let{count:b,error:c}=await this.supabase.from("calendar_notifications").select("*",{count:"exact",head:!0}).eq("user_id",a).in("status",["pending","sent"]);if(c){if("PGRST116"===c.code||"42P01"===c.code||c.message?.includes("does not exist"))return 0;throw c}return b||0}async getUserPreferences(a,b){let{data:c,error:d}=await this.supabase.from("calendar_user_preferences").select("*").eq("user_id",a).eq("organization_id",b).single();if(d){if("PGRST116"===d.code||"42P01"===d.code||d.message?.includes("does not exist"))return null;throw d}return c}async upsertUserPreferences(a,b,c){let{data:d,error:e}=await this.supabase.from("calendar_user_preferences").upsert({user_id:a,organization_id:b,...c},{onConflict:"user_id,organization_id"}).select().single();if(e)throw e;return d}async getUpcomingTodosWithReminder(a,b=60){let c=new Date,d=new Date(c.getTime()+60*b*1e3),{data:e,error:f}=await this.supabase.from("calendar_todos").select("*").eq("organization_id",a).eq("reminder_enabled",!0).eq("reminder_sent",!1).in("status",["pending","in_progress"]).gte("due_date",c.toISOString().split("T")[0]).lte("due_date",d.toISOString().split("T")[0]);if(f)throw f;return e||[]}async getCalendarStats(a){let b=new Date().toISOString().split("T")[0],{data:c,error:d}=await this.supabase.from("calendar_todos").select("id, status, due_date").eq("organization_id",a);if(d){if("PGRST116"===d.code||"42P01"===d.code||d.message?.includes("does not exist"))return{totalTodos:0,pendingTodos:0,completedTodos:0,overdueTodos:0,todayTodos:0,upcomingTodos:0};throw d}let e=c||[],f=e.length,g=e.filter(a=>"pending"===a.status).length,h=e.filter(a=>"completed"===a.status).length,i=e.filter(a=>"completed"!==a.status&&"cancelled"!==a.status&&a.due_date<b).length;return{totalTodos:f,pendingTodos:g,completedTodos:h,overdueTodos:i,todayTodos:e.filter(a=>a.due_date===b).length,upcomingTodos:e.filter(a=>"completed"!==a.status&&"cancelled"!==a.status&&a.due_date>b).length}}async getConfig(a,b){return null}async upsertConfig(a,b,c){return{organization_id:a,provider:b,...c}}};a.s(["calendarService",0,c])}];

//# sourceMappingURL=_1e169dcb._.js.map