module.exports=[833157,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(433217),f=a.i(370025),g=a.i(937927),h=a.i(913216),i=a.i(269240),j=a.i(426099),k=a.i(595583),l=a.i(872675),m=a.i(866737),n=a.i(340695),o=a.i(887682),p=a.i(703130),q=a.i(965733),r=a.i(400210),s=a.i(284505),t=a.i(104720),u=a.i(501199),v=a.i(87466),w=a.i(941675),x=a.i(911300),y=a.i(93518),z=a.i(469769),A=a.i(953722),B=a.i(46864),C=a.i(603314),D=a.i(218398),E=a.i(254115),F=a.i(495756),G=a.i(992258),H=a.i(692759),I=a.i(633508),J=a.i(111269),K=a.i(238246);function L(){let a=(0,d.useRouter)(),{user:L}=(0,h.useAuth)(),M=(0,i.createClient)(),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(""),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)(""),[X,Y]=(0,c.useState)(""),[Z,$]=(0,c.useState)(""),[_,aa]=(0,c.useState)("fr"),[ab,ac]=(0,c.useState)("pdf"),[ad,ae]=(0,c.useState)(!1),[af,ag]=(0,c.useState)(!1),[ah,ai]=(0,c.useState)(null),[aj,ak]=(0,c.useState)(null),[al,am]=(0,c.useState)(null),[an,ao]=(0,c.useState)(!1),[ap,aq]=(0,c.useState)({to:"",subject:"",message:""}),[ar,as]=(0,c.useState)(""),[at,au]=(0,c.useState)(!1),av=(0,g.useQueryClient)(),{data:aw}=(0,e.useQuery)({queryKey:["students",L?.organization_id,V],queryFn:async()=>{if(!L?.organization_id)return[];if(V){let{data:a,error:b}=await M.from("enrollments").select("student_id").eq("session_id",V).in("status",["confirmed","completed","active"]);if(b)console.warn("Erreur lors de la récupération des inscriptions:",b);else if(a&&a.length>0){let b=a.map(a=>a.student_id).filter(Boolean);if(b.length>0){let{data:a,error:c}=await M.from("students").select("id, first_name, last_name, student_number, date_of_birth, photo_url, class_id, classes(name)").eq("organization_id",L.organization_id).eq("status","active").in("id",b).order("last_name");if(c)throw c;return a||[]}}}let{data:a,error:b}=await M.from("students").select("id, first_name, last_name, student_number, date_of_birth, photo_url, class_id, classes(name)").eq("organization_id",L.organization_id).eq("status","active").order("last_name");if(b)throw b;return a||[]},enabled:!!L?.organization_id}),{data:ax}=(0,e.useQuery)({queryKey:["invoices",L?.organization_id],queryFn:async()=>{if(!L?.organization_id)return[];let a=M.from("invoices").select("id, invoice_number, student_id, issue_date, due_date, amount, tax_amount, total_amount, currency, items, students(first_name, last_name, student_number)").eq("organization_id",L.organization_id).order("created_at",{ascending:!1}).limit(100),{data:b,error:c}=await a;if(c&&("PGRST116"===c.code||c.message?.includes("400")||c.message?.includes("relationship"))){console.warn("Erreur récupération factures avec jointure, réessai sans jointure:",c);let{data:a,error:b}=await M.from("invoices").select("id, invoice_number, student_id, issue_date, due_date, amount, tax_amount, total_amount, currency, items").eq("organization_id",L.organization_id).order("created_at",{ascending:!1}).limit(100);if(b)return console.error("Erreur récupération factures:",b),[];if(a&&a.length>0){let b=a.map(a=>a.student_id).filter(Boolean);if(b.length>0){let{data:c}=await M.from("students").select("id, first_name, last_name, student_number").in("id",b);if(c){let b=new Map(c.map(a=>[a.id,a]));return a.map(a=>({...a,students:a.student_id&&b.get(a.student_id)||null}))}}}return a||[]}return c?(console.error("Erreur récupération factures:",c),[]):b||[]},enabled:!!L?.organization_id&&("facture"===N||"devis"===N)}),{data:ay}=(0,e.useQuery)({queryKey:["current-user",L?.id],queryFn:async()=>{if(!L?.id)return null;let{data:a,error:b}=await M.from("users").select("role").eq("id",L.id).single();if(b)throw b;return a},enabled:!!L?.id});(0,c.useEffect)(()=>{ay&&ak(ay.role)},[ay]);let{data:az}=(0,e.useQuery)({queryKey:["organization",L?.organization_id],queryFn:async()=>{if(!L?.organization_id)return null;let{data:a,error:b}=await M.from("organizations").select("*").eq("id",L.organization_id).single();if(b)throw b;return a},enabled:!!L?.organization_id}),{data:aA}=(0,e.useQuery)({queryKey:["programs",L?.organization_id],queryFn:async()=>L?.organization_id?j.programService.getAllPrograms(L.organization_id,{isActive:!0}):[],enabled:!!L?.organization_id&&"programme"===N}),{data:aB}=(0,e.useQuery)({queryKey:["program",X],queryFn:async()=>X?j.programService.getProgramById(X):null,enabled:!!X&&"programme"===N}),{data:aC}=(0,e.useQuery)({queryKey:["sessions",L?.organization_id],queryFn:async()=>{if(!L?.organization_id)return[];let{data:a,error:b}=await M.from("sessions").select("id, name, formation_id, formations(name, duration_hours, programs(name)), start_date, end_date").eq("formations.organization_id",L.organization_id).order("start_date",{ascending:!1}).limit(50);if(b)throw b;return a||[]},enabled:!!L?.organization_id&&!!N});(0,c.useEffect)(()=>{V&&P&&(aw?.some(a=>a.id===P)||Q(""))},[V,aw,P]);let{data:aD}=(0,e.useQuery)({queryKey:["academic-year",L?.organization_id],queryFn:async()=>{if(!L?.organization_id)return null;let{data:a,error:b}=await M.from("academic_years").select("*").eq("organization_id",L.organization_id).eq("is_current",!0).maybeSingle();return b?(console.warn("Erreur lors de la récupération de l'année académique:",b),null):a||null},enabled:!!L?.organization_id}),{data:aE}=(0,e.useQuery)({queryKey:["document-template",Z],queryFn:async()=>Z?l.documentTemplateService.getTemplateById(Z):null,enabled:!!Z}),aF=async()=>{if(N&&az){if(!Z||!aE)return void alert("Veuillez sélectionner un modèle de document");ae(!0);try{let a,b,c,d,e,f=null;P&&(a=aw?.find(a=>a.id===P)),V&&(b=aC?.find(a=>a.id===V)),X&&aB&&(f=aB),R&&(c=ax?.find(a=>a.id===R))&&c.students&&!a&&(a=c.students);let g=(0,k.extractDocumentVariables)({student:a,organization:az,session:b,invoice:c,program:f,academicYear:aD,language:_,issueDate:new Date().toISOString()});console.log("[Generate] Variables extraites:",{hasStudent:!!a,studentName:a?`${a.first_name} ${a.last_name}`:"N/A",hasInvoice:!!c,invoiceNumber:c?.invoice_number,hasSession:!!b,sessionName:b?.name,variablesCount:Object.keys(g).length,sampleVariables:{eleve_nom:g.eleve_nom,eleve_prenom:g.eleve_prenom,numero_facture:g.numero_facture,formation_nom:g.formation_nom,session_nom:g.session_nom}});let h="word"===ab?".docx":".pdf",i=`document${h}`;i=a?`${N}_${a.last_name}_${a.first_name}${h}`:c?`facture_${c.invoice_number}${h}`:`${N}_${Date.now()}${h}`;let j=null;"word"===ab?(d="/api/documents/generate-docx",e={templateId:Z,variables:g,filename:i},console.log("[Generate] Génération Word automatique depuis template HTML")):(d="/api/documents/generate-pdf",e={template:aE,variables:g,documentId:void 0,organizationId:az?.id});let l="word"===ab?"application/vnd.openxmlformats-officedocument.wordprocessingml.document":"application/pdf";try{let f=await fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!f.ok){let a=f.headers.get("content-type");if(a&&a.includes("application/json")){let a=await f.json();throw console.error(`[Generate ${ab.toUpperCase()}] Erreur d\xe9taill\xe9e:`,a),a.templateInfo&&console.error(`[Generate ${ab.toUpperCase()}] Template info:`,a.templateInfo),a.stack&&console.error(`[Generate ${ab.toUpperCase()}] Stack trace:`,a.stack),Error(a.error||a.message||a.details||`Erreur lors de la g\xe9n\xe9ration du ${"word"===ab?"document Word":"PDF"}`)}{let a=await f.text();throw console.error("Erreur HTML reçue:",a.substring(0,500)),Error(`Erreur serveur (${f.status}): ${f.statusText}`)}}j=await f.blob();let g=URL.createObjectURL(j),h=document.createElement("a");if(h.href=g,h.download=i,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(g),j&&L?.organization_id&&aE)try{let d=c?.student_id||c?.students?.id,e=`documents/${L.organization_id}/${Date.now()}_${i}`,{data:f,error:g}=await M.storage.from("documents").upload(e,j,{cacheControl:"3600",upsert:!1,contentType:l});if(g){console.error("Erreur lors de l'upload du document:",g);let b={fileUrl:URL.createObjectURL(j),filename:i,title:aE.name||i,studentId:a?.id||d,student:a||(d?c?.students:void 0)};am(b),console.log("[Generate] Document généré stocké (upload échoué):",b)}else if(f){let{data:f}=M.storage.from("documents").getPublicUrl(e),g={fileUrl:f.publicUrl,filename:i,title:aE.name||i,studentId:a?.id||d,student:a||(d?c?.students:void 0)};am(g),console.log("[Generate] Document généré stocké (upload réussi):",g);let h={organization_id:L.organization_id,template_id:aE.id,type:(0,k.mapDocumentTypeToTemplateType)(N),file_name:i,file_url:f.publicUrl,format:ab,page_count:"pdf"===ab?1:void 0,metadata:{student:a?{id:a.id,name:`${a.first_name} ${a.last_name}`}:null,session:b?{id:b.id,name:b.name}:null,invoice:c?{id:c.id,invoice_number:c.invoice_number}:null,language:_,generated_at:new Date().toISOString()},generated_by:L.id},j=!!(a||d||b);a?(h.related_entity_type="student",h.related_entity_id=a.id):d?(h.related_entity_type="student",h.related_entity_id=d):b&&(h.related_entity_type="session",h.related_entity_id=b.id);let l=(0,k.mapDocumentTypeToTemplateType)(N),m=aj&&["super_admin","admin","comptable","secretaire"].includes(aj);if(j&&m)if("releve_notes"===l){ai(h),ag(!0);return}else console.log("Document partagé automatiquement avec l'apprenant");else j&&m||(delete h.related_entity_type,delete h.related_entity_id);let{error:n}=await M.from("generated_documents").insert(h);n?console.error("Erreur lors de la sauvegarde du document:",n):console.log("Document sauvegardé avec succès dans generated_documents")}}catch(a){console.error("Erreur lors de la sauvegarde du document:",a)}}catch(a){console.error("Erreur lors de la génération du PDF:",a),alert("Une erreur est survenue lors de la génération du document")}finally{ae(!1)}}catch(a){console.error("Erreur lors de la génération du document:",a),alert("Une erreur est survenue lors de la génération du document"),ae(!1)}}},aG=async a=>{if(!ah)return;ag(!1);let b={...ah};a?console.log("Document partagé avec l'apprenant"):(delete b.related_entity_type,delete b.related_entity_id,console.log("Document non partagé avec l'apprenant (relevé de notes)"));let{error:c}=await M.from("generated_documents").insert(b);c?(console.error("Erreur lors de la sauvegarde du document:",c),alert("Erreur lors de la sauvegarde du document")):console.log("Document sauvegardé avec succès dans generated_documents"),ai(null),ae(!1)};(0,c.useEffect)(()=>{$(""),am(null)},[N]);let aH=async()=>{if(!al)return;let a=[];if(al.studentId){let{data:b,error:c}=await M.from("students").select("email, first_name, last_name").eq("id",al.studentId).single();if(!c&&b){b.email&&a.push(b.email);let{data:c,error:d}=await M.from("student_guardians").select("*, guardians(email)").eq("student_id",al.studentId);!d&&c&&c.forEach(b=>{b.guardians?.email&&a.push(b.guardians.email)}),a=[...new Set(a)];let e=`${al.title}`,f=`${b.first_name||""} ${b.last_name||""}`.trim(),g=`Bonjour ${f||"Madame, Monsieur"},

Veuillez trouver ci-joint votre document.

Cordialement,
L'\xe9quipe EDUZEN`;aq({to:a.join(", "),subject:e,message:g})}else{let a=al.student?.email||"";aq({to:a,subject:`${al.title}`,message:`Bonjour ${al.student?.first_name||""} ${al.student?.last_name||""},

Veuillez trouver ci-joint votre document.

Cordialement,
L'\xe9quipe EDUZEN`})}}else aq({to:"",subject:al.title,message:"Bonjour,\n\nVeuillez trouver ci-joint votre document.\n\nCordialement,\nL'équipe EDUZEN"});ao(!0)},aI=async()=>{if(!al||!ap.to)return void alert("Veuillez renseigner l'adresse email du destinataire");au(!0);try{if(!(await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:ap.to,subject:ap.subject,message:ap.message,attachmentUrl:al.fileUrl,attachmentName:al.filename})})).ok)throw Error("Erreur lors de l'envoi de l'email");alert("Email envoyé avec succès !"),ao(!1),aq({to:"",subject:"",message:""})}catch(a){console.error("Erreur lors de l'envoi de l'email:",a),alert("Erreur lors de l'envoi de l'email")}finally{au(!1)}},aJ=(0,f.useMutation)({mutationFn:async()=>{if(!al||!al.studentId)throw Error("Ce document n'est pas lié à un étudiant");if(!L?.organization_id)throw Error("Organisation ID manquant");let a=al.fileUrl;if(a.startsWith("blob:")||a.startsWith("data:")){let b=await fetch(al.fileUrl);if(!b.ok)throw Error("Impossible de télécharger le fichier");let c=new File([await b.blob()],al.filename,{type:"application/pdf"}),d=`learner_documents/${L.organization_id}/${al.studentId}/${Date.now()}_${al.filename}`,{data:e,error:f}=await M.storage.from("documents").upload(d,c,{cacheControl:"3600",upsert:!1,contentType:"application/pdf"});if(f)throw f;let{data:g}=M.storage.from("documents").getPublicUrl(d);a=g.publicUrl}let b=(0,k.mapDocumentTypeToTemplateType)(N),{error:c}=await M.from("learner_documents").insert({student_id:al.studentId,title:al.title,file_url:a,type:b||N||"other",organization_id:L.organization_id,sent_at:new Date().toISOString(),sent_by:L.id});if(c)throw console.error("Erreur lors de l'insertion dans learner_documents:",c),c},onSuccess:()=>{alert("Document envoyé dans l'espace apprenant avec succès !"),av.invalidateQueries({queryKey:["learner-documents"]})},onError:a=>{console.error("Erreur lors de l'envoi vers l'espace apprenant:",a),alert(a.message||"Erreur lors de l'envoi vers l'espace apprenant")}}),aK=[{type:"convention",name:"Convention de formation",description:"Contrat entre l'établissement et l'apprenant",icon:t.FileText,color:"#335ACF",requiresStudent:!0},{type:"facture",name:"Facture",description:"Document comptable de facturation",icon:u.Receipt,color:"#335ACF",requiresInvoice:!0},{type:"devis",name:"Devis",description:"Estimation de prix avant formation",icon:v.FileCheck,color:"#34B9EE",requiresInvoice:!0},{type:"convocation",name:"Convocation",description:"Invitation à une session ou examen",icon:w.Calendar,color:"#335ACF",requiresSession:!0},{type:"contrat",name:"Contrat de scolarité",description:"Accord de scolarisation officiel",icon:x.ClipboardList,color:"#335ACF",requiresStudent:!0},{type:"attestation_reussite",name:"Attestation de réussite",description:"Certificat de réussite à une formation",icon:y.Award,color:"#335ACF",requiresStudent:!0,requiresSession:!0},{type:"certificat_scolarite",name:"Certificat de scolarité",description:"Justificatif d'inscription dans l'établissement",icon:z.GraduationCap,color:"#335ACF",requiresStudent:!0},{type:"releve_notes",name:"Relevé de notes",description:"Bulletin de notes et appréciations",icon:A.BookOpen,color:"#34B9EE",requiresStudent:!0,requiresSession:!0},{type:"attestation_entree",name:"Attestation d'entrée en formation",description:"Certificat d'inscription à une formation",icon:B.UserCheck,color:"#335ACF",requiresStudent:!0,requiresSession:!0},{type:"reglement_interieur",name:"Règlement intérieur",description:"Règles et procédures de l'établissement",icon:C.Shield,color:"#335ACF"},{type:"cgv",name:"Conditions Générales de Vente",description:"CGV et conditions d'utilisation",icon:D.Scale,color:"#34B9EE"},{type:"programme",name:"Programme de formation",description:"Détails du contenu pédagogique",icon:E.Book,color:"#335ACF"},{type:"attestation_assiduite",name:"Attestation d'assiduité",description:"Justificatif de présence aux cours",icon:F.CheckCircle,color:"#335ACF",requiresStudent:!0,requiresSession:!0}];return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(K.default,{href:"/dashboard/documents",children:(0,b.jsx)(n.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(r.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Générer un document"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Créez et téléchargez vos documents PDF"})]})]}),(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:"Type de document"})}),(0,b.jsx)(p.CardContent,{children:(0,b.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:aK.map(a=>{let c=a.icon;return(0,b.jsxs)("button",{type:"button",onClick:()=>O(a.type),className:`p-4 border-2 rounded-lg text-left transition-colors ${N===a.type?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${a.color}15`},children:(0,b.jsx)(c,{className:"h-5 w-5",style:{color:a.color}})}),(0,b.jsx)("div",{className:"font-medium text-sm",children:a.name})]}),(0,b.jsx)("div",{className:"text-xs text-gray-600",children:a.description})]},a.type)})})})]}),N&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(m.TemplateSelector,{documentType:N,selectedTemplateId:Z,onTemplateSelect:$,onCreateNew:()=>{a.push(`/dashboard/settings/document-templates/${N}/edit`)},onDuplicate:async a=>{try{let b=await l.documentTemplateService.duplicateTemplate(a);$(b.id),alert("Modèle dupliqué avec succès")}catch(a){console.error("Erreur lors de la duplication:",a),alert("Erreur lors de la duplication du modèle")}}}),"programme"===N&&(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:"Programme"})}),(0,b.jsx)(p.CardContent,{children:(0,b.jsxs)("select",{value:X,onChange:a=>Y(a.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",required:!0,children:[(0,b.jsx)("option",{value:"",children:"Sélectionner un programme"}),aA?.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," ",a.code?`(${a.code})`:""]},a.id))]})})]}),(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsxs)(p.CardTitle,{children:["Session de formation ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]})}),(0,b.jsxs)(p.CardContent,{children:[(0,b.jsxs)("select",{value:V,onChange:a=>{W(a.target.value),Q("")},className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",required:!0,children:[(0,b.jsx)("option",{value:"",children:"Sélectionner une session"}),aC?.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," - ",a.formations?.programs?.name]},a.id))]}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"La sélection de la session est obligatoire pour récupérer toutes les données personnalisées."})]})]}),aK.find(a=>a.type===N)?.requiresStudent&&(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsxs)(p.CardTitle,{children:["Apprenant ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]})}),(0,b.jsxs)(p.CardContent,{children:[(0,b.jsxs)("select",{value:P,onChange:a=>Q(a.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",required:aK.find(a=>a.type===N)?.requiresStudent,disabled:!V,children:[(0,b.jsx)("option",{value:"",children:V?"Sélectionner un apprenant":"Veuillez d'abord sélectionner une session"}),V&&aw?.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.last_name," ",a.first_name," (",a.student_number,")"]},a.id))]}),V&&aw&&0===aw.length&&(0,b.jsx)("p",{className:"text-sm text-amber-600 mt-2",children:"Aucun apprenant inscrit à cette session."})]})]}),("facture"===N||"devis"===N)&&(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:"facture"===N?"Facture":"Devis"})}),(0,b.jsx)(p.CardContent,{children:(0,b.jsxs)("select",{value:R,onChange:a=>S(a.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",required:!0,children:[(0,b.jsxs)("option",{value:"",children:["Sélectionner une ","facture"===N?"facture":"devis"]}),ax?.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.invoice_number," - ",a.students?.first_name," ",a.students?.last_name]},a.id))]})})]}),(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:"Options"})}),(0,b.jsxs)(p.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Langue"}),(0,b.jsxs)("select",{value:_,onChange:a=>aa(a.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,b.jsx)("option",{value:"fr",children:"Français"}),(0,b.jsx)("option",{value:"en",children:"English"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Format d'export"}),(0,b.jsxs)(o.Select,{value:ab,onValueChange:a=>ac(a),children:[(0,b.jsx)(o.SelectTrigger,{className:"w-full",children:(0,b.jsx)(o.SelectValue,{placeholder:"Sélectionner un format"})}),(0,b.jsxs)(o.SelectContent,{children:[(0,b.jsx)(o.SelectItem,{value:"pdf",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(t.FileText,{className:"h-4 w-4 text-red-600"}),(0,b.jsx)("span",{children:"PDF (.pdf)"})]})}),(0,b.jsx)(o.SelectItem,{value:"word",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(t.FileText,{className:"h-4 w-4 text-blue-600"}),(0,b.jsx)("span",{children:"Word (.docx)"})]})})]})]})]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,b.jsx)(K.default,{href:"/dashboard/documents",children:(0,b.jsx)(n.Button,{variant:"outline",children:"Annuler"})}),(0,b.jsxs)(n.Button,{onClick:aF,disabled:ad||!Z||!V||aK.find(a=>a.type===N)?.requiresStudent&&!P||aK.find(a=>a.type===N)?.requiresInvoice&&!R||"programme"===N&&!X,children:[(0,b.jsx)(s.Download,{className:"mr-2 h-4 w-4"}),ad?"Génération...":"Générer et télécharger"]})]}),al&&!ad&&(0,b.jsxs)(p.Card,{className:"border-2 border-green-200 bg-green-50/50",children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,b.jsx)(J.CheckCircle2,{className:"h-5 w-5 text-green-600"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(p.CardTitle,{className:"text-green-900",children:"Document généré avec succès !"}),(0,b.jsx)("p",{className:"text-sm text-green-700 mt-1",children:al.title})]})]})}),(0,b.jsx)(p.CardContent,{children:(0,b.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,b.jsxs)(n.Button,{onClick:()=>{if(!al)return;let a=document.createElement("a");a.href=al.fileUrl,a.download=al.filename,document.body.appendChild(a),a.click(),document.body.removeChild(a)},variant:"outline",className:"border-green-300 text-green-700 hover:bg-green-100",children:[(0,b.jsx)(s.Download,{className:"mr-2 h-4 w-4"}),"Télécharger à nouveau"]}),(0,b.jsxs)(n.Button,{onClick:aH,variant:"outline",className:"border-blue-300 text-blue-700 hover:bg-blue-100",children:[(0,b.jsx)(G.Mail,{className:"mr-2 h-4 w-4"}),"Envoyer par email"]}),al.studentId&&(0,b.jsxs)(n.Button,{onClick:()=>aJ.mutate(),disabled:aJ.isPending,variant:"outline",className:"border-purple-300 text-purple-700 hover:bg-purple-100",children:[(0,b.jsx)(H.Send,{className:"mr-2 h-4 w-4"}),aJ.isPending?"Envoi...":"Espace apprenant"]}),(0,b.jsx)(n.Button,{onClick:()=>am(null),variant:"ghost",size:"sm",className:"ml-auto",children:(0,b.jsx)(I.X,{className:"h-4 w-4"})})]})})]})]})]})}),(0,b.jsx)(q.Dialog,{open:an,onOpenChange:ao,children:(0,b.jsxs)(q.DialogContent,{className:"max-w-2xl",children:[(0,b.jsxs)(q.DialogHeader,{children:[(0,b.jsx)(q.DialogTitle,{children:"Envoyer par email"}),(0,b.jsx)(q.DialogDescription,{children:al?.title})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Destinataire *"}),(0,b.jsx)("input",{type:"text",value:ap.to,onChange:a=>aq(b=>({...b,to:a.target.value})),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary",placeholder:"email@example.com, email2@example.com"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Objet *"}),(0,b.jsx)("input",{type:"text",value:ap.subject,onChange:a=>aq(b=>({...b,subject:a.target.value})),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary",placeholder:"Objet de l'email"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"text-sm font-medium",children:"Message"}),(0,b.jsx)("textarea",{value:ap.message,onChange:a=>aq(b=>({...b,message:a.target.value})),rows:6,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary resize-none",placeholder:"Votre message..."})]}),al?.fileUrl&&(0,b.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(t.FileText,{className:"h-5 w-5 text-gray-400"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Pièce jointe"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:al.filename})]})]})})]}),(0,b.jsxs)(q.DialogFooter,{children:[(0,b.jsx)(n.Button,{variant:"outline",onClick:()=>ao(!1),children:"Annuler"}),(0,b.jsx)(n.Button,{onClick:aI,disabled:at||!ap.to||!ap.subject,children:at?"Envoi...":"Envoyer"})]})]})}),(0,b.jsx)(q.Dialog,{open:af,onOpenChange:a=>{!a&&af?aG(!1):ag(a)},children:(0,b.jsxs)(q.DialogContent,{children:[(0,b.jsxs)(q.DialogHeader,{children:[(0,b.jsx)(q.DialogTitle,{children:"Partager le relevé de notes avec l'apprenant ?"}),(0,b.jsxs)(q.DialogDescription,{children:["Souhaitez-vous que ce relevé de notes soit visible dans l'espace personnel de l'apprenant ?",(0,b.jsx)("br",{}),(0,b.jsx)("br",{}),'Si vous choisissez "Non", le document sera sauvegardé mais ne sera pas accessible par l\'apprenant.']})]}),(0,b.jsxs)(q.DialogFooter,{children:[(0,b.jsx)(n.Button,{variant:"outline",onClick:()=>aG(!1),children:"Non, ne pas partager"}),(0,b.jsx)(n.Button,{onClick:()=>aG(!0),children:"Oui, partager avec l'apprenant"})]})]})})]})}a.s(["default",()=>L])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_documents_generate_page_tsx_0275d200._.js.map