module.exports=[849896,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(269240),i=a.i(340695),j=a.i(703130),k=a.i(205522),l=a.i(254161),m=a.i(864037),n=a.i(491829),o=a.i(660246),p=a.i(915618),q=a.i(587532),r=a.i(992258),s=a.i(963519),t=a.i(111269),u=a.i(54018),v=a.i(669520),w=a.i(683245),x=a.i(238246),y=a.i(497895);let z={super_admin:"Super Administrateur",admin:"Administrateur",teacher:"Enseignant",secretary:"SecrÃ©taire",accountant:"Comptable",parent:"Parent",student:"Ã‰tudiant"},A={super_admin:"bg-purple-100 text-purple-800",admin:"bg-blue-100 text-blue-800",teacher:"bg-green-100 text-green-800",secretary:"bg-orange-100 text-orange-800",accountant:"bg-yellow-100 text-yellow-800",parent:"bg-gray-100 text-gray-800",student:"bg-cyan-100 text-cyan-800"};function B(){let{user:a}=(0,g.useAuth)(),n=(0,h.createClient)(),B=(0,f.useQueryClient)(),{addToast:C}=(0,m.useToast)(),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(null);(0,c.useEffect)(()=>{let a=()=>{B.invalidateQueries({queryKey:["organization-users"]})};return window.addEventListener("focus",a),()=>window.removeEventListener("focus",a)},[B]);let{data:H=[],isLoading:I}=(0,d.useQuery)({queryKey:["organization-users",a?.organization_id,D,F],queryFn:async()=>{if(!a?.organization_id)return console.log("âš ï¸ [USERS] Pas d'organization_id pour l'utilisateur:",a?.id),[];console.log("ðŸ” [USERS] RÃ©cupÃ©ration des utilisateurs pour organization_id:",a.organization_id),console.log("ðŸ” [USERS] Utilisateur actuel:",{id:a.id,email:a.email,role:a.role,organization_id:a.organization_id});let b=n.from("users").select("id, email, full_name, phone, role, is_active, last_login_at, created_at, updated_at, organization_id").eq("organization_id",a.organization_id).order("created_at",{ascending:!1});console.log("ðŸ” [USERS] RequÃªte Supabase construite, exÃ©cution..."),D&&(b=b.or(`full_name.ilike.%${D}%,email.ilike.%${D}%`)),F&&(b=b.eq("role",F),console.log("ðŸ” [USERS] Filtre par rÃ´le appliquÃ©:",F));let{data:c,error:d}=await b;if(d)throw console.error("âŒ [USERS] Erreur lors de la rÃ©cupÃ©ration:",d),d;if(console.log("âœ… [USERS] Utilisateurs rÃ©cupÃ©rÃ©s:",c?.length||0),c&&c.length>0){let a=c.map(a=>({id:a.id,email:a.email,full_name:a.full_name,role:a.role,organization_id:a.organization_id,is_active:a.is_active}));console.log("ðŸ“‹ [USERS] DÃ©tails des utilisateurs:",a),console.log("ðŸ“‹ [USERS] DÃ©tails complets (pour debug):",JSON.stringify(a,null,2)),console.log("ðŸ“Š [USERS] RÃ©partition par rÃ´le:",{teachers:c.filter(a=>"teacher"===a.role).length,admins:c.filter(a=>"admin"===a.role||"super_admin"===a.role).length,secretaries:c.filter(a=>"secretary"===a.role).length,accountants:c.filter(a=>"accountant"===a.role).length,others:c.filter(a=>!["teacher","admin","super_admin","secretary","accountant"].includes(a.role)).length})}else console.warn("âš ï¸ [USERS] Aucun utilisateur trouvÃ© pour organization_id:",a.organization_id);return c||[]},enabled:!!a?.organization_id,refetchOnMount:!0,refetchOnWindowFocus:!0,staleTime:0}),J=(0,e.useMutation)({mutationFn:async({userId:a,isActive:b})=>{let{error:c}=await n.from("users").update({is_active:!b}).eq("id",a);if(c)throw c},onSuccess:()=>{B.invalidateQueries({queryKey:["organization-users"]}),C({title:"SuccÃ¨s",description:"Le statut de l'utilisateur a Ã©tÃ© mis Ã  jour",type:"success"})},onError:a=>{C({title:"Erreur",description:a.message||"Erreur lors de la mise Ã  jour",type:"error"})}}),K={total:H.length,active:H.filter(a=>a.is_active).length,inactive:H.filter(a=>!a.is_active).length,byRole:Object.keys(z).reduce((a,b)=>(a[b]=H.filter(a=>a.role===b).length,a),{})};return I?(0,b.jsx)("div",{className:"container mx-auto py-8 px-4",children:(0,b.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,b.jsx)(v.RefreshCw,{className:"h-8 w-8 animate-spin text-brand-blue"})})}):(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-2",children:[(0,b.jsx)(o.Users,{className:"h-8 w-8 text-brand-blue"}),"Gestion des utilisateurs"]}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"GÃ©rez les utilisateurs de votre organisation"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total utilisateurs"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:K.total})]}),(0,b.jsx)(o.Users,{className:"h-8 w-8 text-blue-500"})]})})}),(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Actifs"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-green-600",children:K.active})]}),(0,b.jsx)(t.CheckCircle2,{className:"h-8 w-8 text-green-500"})]})})}),(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Inactifs"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-red-600",children:K.inactive})]}),(0,b.jsx)(u.XCircle,{className:"h-8 w-8 text-red-500"})]})})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8",children:[(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Administrateurs"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:(K.byRole.admin||0)+(K.byRole.super_admin||0)})]})})}),(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Enseignants"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-green-600",children:K.byRole.teacher||0})]})})}),(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"SecrÃ©taires"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:K.byRole.secretary||0})]})})}),(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Comptables"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:K.byRole.accountant||0})]})})}),(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Parents"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-gray-600",children:K.byRole.parent||0})]})})}),(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Ã‰tudiants"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-cyan-600",children:K.byRole.student||0})]})})})]}),(0,b.jsx)(j.Card,{className:"mb-6",children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(q.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,b.jsx)(k.Input,{placeholder:"Rechercher par nom ou email...",value:D,onChange:a=>E(a.target.value),className:"pl-10"})]})}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(i.Button,{variant:null===F?"default":"outline",onClick:()=>G(null),children:"Tous"}),Object.keys(z).map(a=>(0,b.jsx)(i.Button,{variant:F===a?"default":"outline",onClick:()=>G(F===a?null:a),children:z[a]},a))]}),(0,b.jsxs)(i.Button,{variant:"outline",onClick:()=>{B.invalidateQueries({queryKey:["organization-users"]}),B.refetchQueries({queryKey:["organization-users"]}),C({type:"info",title:"Actualisation",description:"Liste des utilisateurs actualisÃ©e"})},disabled:I,children:[(0,b.jsx)(v.RefreshCw,{className:`h-4 w-4 mr-2 ${I?"animate-spin":""}`}),"Actualiser"]}),(0,b.jsx)(i.Button,{asChild:!0,children:(0,b.jsxs)(x.default,{href:"/dashboard/settings/users/new",children:[(0,b.jsx)(p.Plus,{className:"h-4 w-4 mr-2"}),"Nouvel utilisateur"]})})]})})}),(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(j.CardTitle,{children:"Liste des utilisateurs"}),(0,b.jsxs)(j.CardDescription,{children:[H.length," utilisateur",H.length>1?"s":""," trouvÃ©",H.length>1?"s":""]})]}),(0,b.jsx)(j.CardContent,{children:0===H.length?(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(o.Users,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:D||F?"Aucun utilisateur ne correspond Ã  vos critÃ¨res":"Aucun utilisateur trouvÃ©"}),!D&&!F&&(0,b.jsx)(i.Button,{asChild:!0,children:(0,b.jsxs)(x.default,{href:"/dashboard/settings/users/new",children:[(0,b.jsx)(p.Plus,{className:"h-4 w-4 mr-2"}),"CrÃ©er le premier utilisateur"]})})]}):(0,b.jsx)("div",{className:"space-y-4",children:H.map(a=>(0,b.jsx)(j.Card,{className:"hover:shadow-md transition-shadow",children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:a.full_name||"Sans nom"}),(0,b.jsx)(l.Badge,{className:A[a.role]||"bg-gray-100 text-gray-800",children:z[a.role]||a.role}),a.is_active?(0,b.jsxs)(l.Badge,{className:"bg-green-100 text-green-800",children:[(0,b.jsx)(t.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Actif"]}):(0,b.jsxs)(l.Badge,{className:"bg-red-100 text-red-800",children:[(0,b.jsx)(u.XCircle,{className:"h-3 w-3 mr-1"}),"Inactif"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,b.jsx)(r.Mail,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:a.email})]}),a.phone&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,b.jsx)(s.Phone,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:a.phone})]}),a.last_login_at&&(0,b.jsxs)("div",{className:"text-muted-foreground",children:["DerniÃ¨re connexion: ",(0,y.formatDate)(a.last_login_at)]}),(0,b.jsxs)("div",{className:"text-muted-foreground",children:["CrÃ©Ã© le: ",(0,y.formatDate)(a.created_at||"")]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>J.mutate({userId:a.id,isActive:a.is_active??!1}),disabled:J.isPending,children:a.is_active?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(u.XCircle,{className:"h-4 w-4 mr-2"}),"DÃ©sactiver"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Activer"]})}),(0,b.jsx)(i.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,b.jsxs)(x.default,{href:`/dashboard/settings/users/${a.id}`,children:[(0,b.jsx)(w.Edit,{className:"h-4 w-4 mr-2"}),"Modifier"]})})]})]})})},a.id))})})]})]})}function C(){return(0,b.jsx)(n.RoleGuard,{allowedRoles:n.ADMIN_ROLES,children:(0,b.jsx)(B,{})})}a.s(["default",()=>C])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_settings_users_page_tsx_5bd97ed6._.js.map