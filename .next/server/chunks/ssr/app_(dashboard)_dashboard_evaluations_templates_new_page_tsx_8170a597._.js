module.exports=[285848,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(370025),e=a.i(937927),f=a.i(50944),g=a.i(913216),h=a.i(315470),i=a.i(703130),j=a.i(340695),k=a.i(205522),l=a.i(917171),m=a.i(546893),n=a.i(864037),o=a.i(400210),p=a.i(915618),q=a.i(781560),r=a.i(784581),s=a.i(238246);function t(){let a=(0,f.useRouter)(),{user:t}=(0,g.useAuth)(),u=(0,e.useQueryClient)(),{addToast:v}=(0,n.useToast)(),[w,x]=(0,c.useState)({name:"",description:"",assessment_type:"",subject:"",max_score:20,passing_score:70,time_limit_minutes:null,shuffle_questions:!1,show_correct_answers:!0}),[y,z]=(0,c.useState)([]),A=(0,d.useMutation)({mutationFn:async()=>{if(!t?.organization_id)throw Error("Organisation non trouvée");if(!w.name)throw Error("Le nom du modèle est requis");if(0===y.length)throw Error("Au moins une question est requise");return h.evaluationTemplateService.createTemplate(t.organization_id,{name:w.name,description:w.description||null,assessment_type:w.assessment_type||null,subject:w.subject||null,max_score:w.max_score,passing_score:w.passing_score||null,time_limit_minutes:w.time_limit_minutes||null,shuffle_questions:w.shuffle_questions,show_correct_answers:w.show_correct_answers},y.map(a=>({question_text:a.question_text,question_type:a.question_type,options:a.options?JSON.stringify(a.options):null,correct_answer:a.correct_answer||null,correct_answer_pattern:a.correct_answer_pattern||null,points:a.points,explanation:a.explanation||null,order_index:a.order_index})))},onSuccess:b=>{u.invalidateQueries({queryKey:["evaluation-templates"]}),v({type:"success",title:"Modèle créé",description:"Le modèle d'évaluation a été créé avec succès."}),b?.id&&a.push(`/dashboard/evaluations/templates/${b.id}`)},onError:a=>{v({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue lors de la création."})}}),B=(a,b)=>{z(y.map(c=>{if(c.id===a){let a={...c,...b};return b.question_type&&b.question_type!==c.question_type&&("multiple_choice"===b.question_type?a.options=[{text:"",is_correct:!1},{text:"",is_correct:!1}]:a.options=void 0,a.correct_answer=void 0),a}return c}))},C=(a,b,c)=>{z(y.map(d=>d.id===a&&d.options?{...d,options:d.options.map((a,d)=>d===b?{...a,...c}:a)}:d))};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(s.default,{href:"/dashboard/evaluations/templates",children:(0,b.jsx)(j.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(o.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Nouveau modèle d'évaluation"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Créez un modèle avec questions et réponses pour correction automatique"})]})]}),(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),A.mutate()},className:"space-y-6",children:[(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"Informations générales"})}),(0,b.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"name",children:"Nom du modèle *"}),(0,b.jsx)(k.Input,{id:"name",value:w.name,onChange:a=>x({...w,name:a.target.value}),placeholder:"Ex: Évaluation de fin de module",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(m.Textarea,{id:"description",value:w.description,onChange:a=>x({...w,description:a.target.value}),placeholder:"Description du modèle d'évaluation",rows:3})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"subject",children:"Sujet/Matière"}),(0,b.jsx)(k.Input,{id:"subject",value:w.subject,onChange:a=>x({...w,subject:a.target.value}),placeholder:"Ex: Mathématiques"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"assessment_type",children:"Type d'évaluation"}),(0,b.jsxs)("select",{id:"assessment_type",value:w.assessment_type,onChange:a=>x({...w,assessment_type:a.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:[(0,b.jsx)("option",{value:"",children:"Sélectionner..."}),(0,b.jsx)("option",{value:"pre_formation",children:"Pré-formation"}),(0,b.jsx)("option",{value:"hot",children:"À chaud"}),(0,b.jsx)("option",{value:"cold",children:"À froid"}),(0,b.jsx)("option",{value:"quiz",children:"Quiz"}),(0,b.jsx)("option",{value:"exam",children:"Examen"}),(0,b.jsx)("option",{value:"other",children:"Autre"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"max_score",children:"Note maximale"}),(0,b.jsx)(k.Input,{id:"max_score",type:"number",step:"0.01",min:"1",value:w.max_score,onChange:a=>x({...w,max_score:parseFloat(a.target.value)||20})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"passing_score",children:"Score de réussite (%)"}),(0,b.jsx)(k.Input,{id:"passing_score",type:"number",step:"0.01",min:"0",max:"100",value:w.passing_score,onChange:a=>x({...w,passing_score:parseFloat(a.target.value)||70})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"time_limit",children:"Durée (minutes)"}),(0,b.jsx)(k.Input,{id:"time_limit",type:"number",min:"1",value:w.time_limit_minutes||"",onChange:a=>x({...w,time_limit_minutes:a.target.value?parseInt(a.target.value):null}),placeholder:"Illimité"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:w.shuffle_questions,onChange:a=>x({...w,shuffle_questions:a.target.checked})}),(0,b.jsx)("span",{children:"Mélanger les questions"})]}),(0,b.jsxs)("label",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:w.show_correct_answers,onChange:a=>x({...w,show_correct_answers:a.target.checked})}),(0,b.jsx)("span",{children:"Afficher les bonnes réponses après correction"})]})]})]})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(i.CardTitle,{children:"Questions"}),(0,b.jsxs)(j.Button,{type:"button",onClick:()=>{let a={id:`temp-${Date.now()}`,question_text:"",question_type:"multiple_choice",options:[{text:"",is_correct:!1},{text:"",is_correct:!1}],points:1,order_index:y.length+1};z([...y,a])},variant:"outline",children:[(0,b.jsx)(p.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une question"]})]})}),(0,b.jsx)(i.CardContent,{className:"space-y-6",children:0===y.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:'Aucune question. Cliquez sur "Ajouter une question" pour commencer.'}):y.map((a,c)=>(0,b.jsxs)(i.Card,{className:"border-2",children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(r.GripVertical,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsxs)(i.CardTitle,{className:"text-base",children:["Question ",c+1]})]}),(0,b.jsx)(j.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{var b;return b=a.id,void z(y.filter(a=>a.id!==b).map((a,b)=>({...a,order_index:b+1})))},children:(0,b.jsx)(q.Trash2,{className:"h-4 w-4 text-destructive"})})]})}),(0,b.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Texte de la question *"}),(0,b.jsx)(m.Textarea,{value:a.question_text,onChange:b=>B(a.id,{question_text:b.target.value}),placeholder:"Entrez la question...",rows:2,required:!0})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Type de question *"}),(0,b.jsxs)("select",{value:a.question_type,onChange:b=>B(a.id,{question_type:b.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:[(0,b.jsx)("option",{value:"multiple_choice",children:"Choix multiples"}),(0,b.jsx)("option",{value:"true_false",children:"Vrai/Faux"}),(0,b.jsx)("option",{value:"short_answer",children:"Réponse courte"}),(0,b.jsx)("option",{value:"numeric",children:"Numérique"}),(0,b.jsx)("option",{value:"essay",children:"Dissertation (correction manuelle)"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Points *"}),(0,b.jsx)(k.Input,{type:"number",step:"0.01",min:"0",value:a.points,onChange:b=>B(a.id,{points:parseFloat(b.target.value)||1}),required:!0})]})]}),"multiple_choice"===a.question_type&&a.options&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{children:"Options de réponse *"}),a.options.map((c,d)=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",checked:c.is_correct,onChange:b=>C(a.id,d,{is_correct:b.target.checked})}),(0,b.jsx)(k.Input,{value:c.text,onChange:b=>C(a.id,d,{text:b.target.value}),placeholder:`Option ${d+1}`,className:"flex-1"}),a.options&&a.options.length>2&&(0,b.jsx)(j.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{var b;return b=a.id,void z(y.map(a=>{if(a.id===b&&a.options){let b=a.options.filter((a,b)=>b!==d);return{...a,options:b.length>0?b:void 0}}return a}))},children:(0,b.jsx)(q.Trash2,{className:"h-4 w-4"})})]},d)),(0,b.jsxs)(j.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{var b;return b=a.id,void z(y.map(a=>a.id===b&&a.options?{...a,options:[...a.options,{text:"",is_correct:!1}]}:a))},children:[(0,b.jsx)(p.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une option"]})]}),"true_false"===a.question_type&&(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Bonne réponse *"}),(0,b.jsxs)("select",{value:a.correct_answer||"",onChange:b=>B(a.id,{correct_answer:b.target.value}),className:"w-full px-4 py-2 border rounded-lg",children:[(0,b.jsx)("option",{value:"",children:"Sélectionner..."}),(0,b.jsx)("option",{value:"true",children:"Vrai"}),(0,b.jsx)("option",{value:"false",children:"Faux"})]})]}),"short_answer"===a.question_type&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Bonne réponse *"}),(0,b.jsx)(k.Input,{value:a.correct_answer||"",onChange:b=>B(a.id,{correct_answer:b.target.value}),placeholder:"Réponse attendue"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Pattern regex (optionnel)"}),(0,b.jsx)(k.Input,{value:a.correct_answer_pattern||"",onChange:b=>B(a.id,{correct_answer_pattern:b.target.value}),placeholder:"Ex: ^(oui|yes)$ pour accepter 'oui' ou 'yes'"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Permet une validation flexible (insensible à la casse par défaut)"})]})]}),"numeric"===a.question_type&&(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Bonne réponse (nombre) *"}),(0,b.jsx)(k.Input,{type:"number",step:"0.01",value:a.correct_answer||"",onChange:b=>B(a.id,{correct_answer:b.target.value}),placeholder:"Ex: 42"})]}),"essay"===a.question_type&&(0,b.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm text-blue-800",children:[(0,b.jsx)("strong",{children:"Note :"}),' Les questions de type "Dissertation" nécessitent une correction manuelle. La note sera attribuée par l\'enseignant après correction.']}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Explication (optionnel)"}),(0,b.jsx)(m.Textarea,{value:a.explanation||"",onChange:b=>B(a.id,{explanation:b.target.value}),placeholder:"Explication de la réponse correcte (affichée après correction)",rows:2})]})]})]},a.id))})]}),(0,b.jsxs)("div",{className:"flex items-center justify-end gap-4",children:[(0,b.jsx)(s.default,{href:"/dashboard/evaluations/templates",children:(0,b.jsx)(j.Button,{type:"button",variant:"outline",children:"Annuler"})}),(0,b.jsx)(j.Button,{type:"submit",disabled:A.isPending||0===y.length,children:A.isPending?"Création...":"Créer le modèle"})]})]})]})}a.s(["default",()=>t])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_evaluations_templates_new_page_tsx_8170a597._.js.map