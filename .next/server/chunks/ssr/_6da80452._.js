module.exports=[915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},400210,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],400210)},683245,a=>{"use strict";let b=(0,a.i(170106).default)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);a.s(["Edit",()=>b],683245)},705151,a=>{"use strict";let b=(0,a.i(170106).default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);a.s(["Copy",()=>b],705151)},466601,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(269240),i=a.i(703130),j=a.i(340695),k=a.i(205522),l=a.i(254161),m=a.i(864037),n=a.i(104720),o=a.i(915618),p=a.i(587532),q=a.i(683245),r=a.i(781560),s=a.i(705151),t=a.i(400210),u=a.i(238246);a.i(460355);var v=a.i(346271),w=a.i(497895);function x(){let{user:a}=(0,g.useAuth)(),x=(0,h.createClient)(),y=(0,f.useQueryClient)(),{addToast:z}=(0,m.useToast)(),[A,B]=(0,c.useState)(""),{data:C,isLoading:D}=(0,d.useQuery)({queryKey:["portfolio-templates",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)return[];try{let{data:b,error:c}=await x.from("learning_portfolio_templates").select("*").or(`organization_id.eq.${a.organization_id},organization_id.is.null`).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(c){let b=c.status;if("PGRST116"===c.code||c.message?.includes("relationship")||c.message?.includes("Could not find")||400===b){let{data:b,error:c}=await x.from("learning_portfolio_templates").select("*").or(`organization_id.eq.${a.organization_id},organization_id.is.null`).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(c){if("PGRST116"===c.code||c.message?.includes("does not exist"))return console.log("Table learning_portfolio_templates n'existe pas encore"),[];throw c}return await Promise.all((b||[]).map(async a=>{if(a.formation_id){let{data:b}=await x.from("formations").select("id, name").eq("id",a.formation_id).single();return{...a,formation:b||null}}return a}))}if("PGRST116"===c.code||c.message?.includes("does not exist"))return console.log("Table learning_portfolio_templates n'existe pas encore"),[];throw c}return b||[]}catch(a){if(a?.code==="PGRST116"||a?.code==="42P01"||a?.message?.includes("does not exist"))return console.log("Table learning_portfolio_templates n'existe pas encore"),[];return console.error("Erreur:",a),[]}},enabled:!!a?.organization_id}),E=(0,e.useMutation)({mutationFn:async a=>{let{error:b}=await x.from("learning_portfolio_templates").update({is_active:!1}).eq("id",a);if(b)throw b},onSuccess:()=>{y.invalidateQueries({queryKey:["portfolio-templates"]}),z({type:"success",title:"Modèle supprimé",description:"Le modèle a été supprimé avec succès."})},onError:()=>{z({type:"error",title:"Erreur",description:"Impossible de supprimer le modèle."})}}),F=(0,e.useMutation)({mutationFn:async b=>{let{data:c,error:d}=await x.from("learning_portfolio_templates").insert({organization_id:b.organization_id,name:`${b.name} (copie)`,description:b.description,template_structure:b.template_structure,primary_color:b.primary_color,secondary_color:b.secondary_color,created_by:a?.id}).select().single();if(d)throw d;return c},onSuccess:()=>{y.invalidateQueries({queryKey:["portfolio-templates"]}),z({type:"success",title:"Modèle dupliqué",description:"Le modèle a été dupliqué avec succès."})},onError:()=>{z({type:"error",title:"Erreur",description:"Impossible de dupliquer le modèle."})}}),G=C?.filter(a=>a.is_active&&(a.name?.toLowerCase().includes(A.toLowerCase())||a.description?.toLowerCase().includes(A.toLowerCase())));return(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,b.jsxs)(v.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,b.jsx)(u.default,{href:"/dashboard/evaluations/portfolios",children:(0,b.jsx)(j.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(t.ArrowLeft,{className:"h-5 w-5"})})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[(0,b.jsx)(n.FileText,{className:"h-8 w-8 text-brand-blue"}),"Modèles de livrets"]}),(0,b.jsx)("p",{className:"text-gray-600",children:"Créez et gérez vos modèles de livrets d'apprentissage personnalisables"})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"relative w-80",children:[(0,b.jsx)(p.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,b.jsx)(k.Input,{placeholder:"Rechercher un modèle...",value:A,onChange:a=>B(a.target.value),className:"pl-10"})]}),(0,b.jsx)(u.default,{href:"/dashboard/evaluations/portfolios/templates/new",children:(0,b.jsxs)(j.Button,{children:[(0,b.jsx)(o.Plus,{className:"h-4 w-4 mr-2"}),"Nouveau modèle"]})})]})]}),D?(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):G?.length===0?(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)(n.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun modèle de livret"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Créez votre premier modèle de livret d'apprentissage pour commencer."}),(0,b.jsx)(u.default,{href:"/dashboard/evaluations/portfolios/templates/new",children:(0,b.jsxs)(j.Button,{children:[(0,b.jsx)(o.Plus,{className:"h-4 w-4 mr-2"}),"Créer un modèle"]})})]})}):(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:G?.map((a,c)=>(0,b.jsx)(v.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*c},children:(0,b.jsxs)(i.Card,{className:"hover:shadow-lg transition-shadow",children:[(0,b.jsxs)(i.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-lg flex items-center justify-center",style:{backgroundColor:`${a.primary_color}20`},children:(0,b.jsx)(n.FileText,{className:"h-6 w-6",style:{color:a.primary_color}})}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[a.is_default&&(0,b.jsx)(l.Badge,{variant:"secondary",children:"Par défaut"}),(0,b.jsxs)(l.Badge,{variant:"outline",children:["v",a.version]})]})]}),(0,b.jsx)(i.CardTitle,{className:"mt-3",children:a.name}),a.description&&(0,b.jsx)(i.CardDescription,{className:"line-clamp-2",children:a.description})]}),(0,b.jsxs)(i.CardContent,{children:[(0,b.jsxs)("div",{className:"space-y-2 text-sm text-gray-600 mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{children:"Sections"}),(0,b.jsx)("span",{className:"font-medium",children:a.template_structure?.length||0})]}),a.formation&&(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{children:"Formation"}),(0,b.jsx)("span",{className:"font-medium truncate max-w-[150px]",children:a.formation.name})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{children:"Créé le"}),(0,b.jsx)("span",{className:"font-medium",children:(0,w.formatDate)(a.created_at)})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 pt-4 border-t",children:[(0,b.jsx)(u.default,{href:`/dashboard/evaluations/portfolios/templates/${a.id}`,className:"flex-1",children:(0,b.jsxs)(j.Button,{variant:"outline",size:"sm",className:"w-full",children:[(0,b.jsx)(q.Edit,{className:"h-4 w-4 mr-1"}),"Modifier"]})}),(0,b.jsx)(j.Button,{variant:"ghost",size:"sm",onClick:()=>F.mutate(a),disabled:F.isPending,children:(0,b.jsx)(s.Copy,{className:"h-4 w-4"})}),(0,b.jsx)(j.Button,{variant:"ghost",size:"sm",onClick:()=>{confirm("Êtes-vous sûr de vouloir supprimer ce modèle ?")&&E.mutate(a.id)},disabled:E.isPending,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,b.jsx)(r.Trash2,{className:"h-4 w-4"})})]})]})]})},a.id))})]})}a.s(["default",()=>x])}];

//# sourceMappingURL=_6da80452._.js.map