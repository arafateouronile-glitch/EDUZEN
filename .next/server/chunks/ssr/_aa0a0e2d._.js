module.exports=[915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},683245,a=>{"use strict";let b=(0,a.i(170106).default)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);a.s(["Edit",()=>b],683245)},315470,a=>{"use strict";var b=a.i(269240);let c=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getTemplates(a){let{data:b,error:c}=await this.supabase.from("evaluation_templates").select(`
        *,
        questions:evaluation_template_questions(*)
      `).or(`organization_id.eq.${a},organization_id.is.null`).eq("is_active",!0).order("created_at",{ascending:!1});return c?(console.error("Erreur récupération modèles:",c),[]):b||[]}async getTemplateById(a){let{data:b,error:c}=await this.supabase.from("evaluation_templates").select(`
        *,
        questions:evaluation_template_questions(*)
      `).eq("id",a).single();return c?(console.error("Erreur récupération modèle:",c),null):b}async createTemplate(a,b,c){let{data:d,error:e}=await this.supabase.from("evaluation_templates").insert({...b,organization_id:a}).select().single();if(e)throw e;if(c.length>0){let a=c.map((a,b)=>({...a,template_id:d.id,order_index:a.order_index??b+1})),{error:b}=await this.supabase.from("evaluation_template_questions").insert(a);if(b)throw b}let f=await this.getTemplateById(d.id);if(!f)throw Error("Erreur lors de la récupération du modèle créé");return f}async updateTemplate(a,b,c){let{error:d}=await this.supabase.from("evaluation_templates").update(b).eq("id",a);if(d)throw d;if(void 0!==c){let{error:b}=await this.supabase.from("evaluation_template_questions").delete().eq("template_id",a);if(b)throw b;if(c.length>0){let b=c.map((b,c)=>({...b,template_id:a,order_index:b.order_index??c+1})),{error:d}=await this.supabase.from("evaluation_template_questions").insert(b);if(d)throw d}}let e=await this.getTemplateById(a);if(!e)throw Error("Erreur lors de la récupération du modèle mis à jour");return e}async deleteTemplate(a){let{error:b}=await this.supabase.from("evaluation_templates").delete().eq("id",a);if(b)throw b}async createInstance(a,b,c){let{data:d,error:e}=await this.supabase.from("evaluation_template_instances").insert({grade_id:a,template_id:b,max_score:c?.max_score,time_limit_minutes:c?.time_limit_minutes}).select().single();if(e)throw e;return d}async getInstanceByGradeId(a){try{let{data:b,error:c}=await this.supabase.from("evaluation_template_instances").select(`
          *,
          template:evaluation_templates(
            *,
            questions:evaluation_template_questions(*)
          ),
          grade:grades(*)
        `).eq("grade_id",a).single();if(c){if("PGRST116"===c.code)return null;throw c}return b}catch{return null}}async getResponses(a,b){let c=this.supabase.from("evaluation_responses").select("*").eq("instance_id",a);b&&(c=c.eq("student_id",b));let{data:d,error:e}=await c.order("created_at",{ascending:!0});return e?(console.error("Erreur récupération réponses:",e),[]):d||[]}async saveResponse(a,b,c,d){let{data:e,error:f}=await this.supabase.from("evaluation_responses").upsert({instance_id:a,question_id:b,student_id:c,answer_text:d.answer_text,answer_choice:d.answer_choice,answer_boolean:d.answer_boolean},{onConflict:"instance_id,question_id,student_id"}).select().single();if(f)throw f;return e}async autoCorrectResponses(a){let{data:b,error:c}=await this.supabase.rpc("auto_correct_evaluation_responses",{p_instance_id:a});if(c)throw c;return b||0}async calculateScore(a){let{data:b,error:c}=await this.supabase.rpc("calculate_evaluation_score",{p_instance_id:a});return c?(console.error("Erreur calcul score:",c),null):b&&0!==b.length?{total_score:Number(b[0].total_score)||0,max_score:Number(b[0].max_score)||0,percentage:Number(b[0].percentage)||0,correct_count:Number(b[0].correct_count)||0,total_questions:Number(b[0].total_questions)||0}:null}async updateGradeFromScore(a,b){let c=await this.calculateScore(b);if(!c)return;let{error:d}=await this.supabase.from("grades").update({score:c.total_score,max_score:c.max_score}).eq("id",a);if(d)throw d}};a.s(["evaluationTemplateService",0,c])},93314,a=>{"use strict";let b=(0,a.i(170106).default)("FileQuestion",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["path",{d:"M10 10.3c.2-.4.5-.8.9-1a2.1 2.1 0 0 1 2.6.4c.3.4.5.8.5 1.3 0 1.3-2 2-2 2",key:"1umxtm"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);a.s(["FileQuestion",()=>b],93314)},545574,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(315470),i=a.i(703130),j=a.i(340695),k=a.i(205522),l=a.i(254161),m=a.i(864037),n=a.i(915618),o=a.i(587532),p=a.i(683245),q=a.i(781560),r=a.i(93314),s=a.i(238246);a.i(460355);var t=a.i(346271),u=a.i(497895);function v(){let{user:a}=(0,g.useAuth)(),v=(0,f.useQueryClient)(),{addToast:w}=(0,m.useToast)(),[x,y]=(0,c.useState)(""),{data:z,isLoading:A}=(0,d.useQuery)({queryKey:["evaluation-templates",a?.organization_id],queryFn:async()=>a?.organization_id?await h.evaluationTemplateService.getTemplates(a.organization_id):[],enabled:!!a?.organization_id}),B=(0,e.useMutation)({mutationFn:async a=>{let b=z?.find(b=>b.id===a);if(b&&!b.organization_id)throw Error("Les modèles système ne peuvent pas être supprimés");await h.evaluationTemplateService.deleteTemplate(a)},onSuccess:()=>{v.invalidateQueries({queryKey:["evaluation-templates"]}),w({type:"success",title:"Modèle supprimé",description:"Le modèle a été supprimé avec succès."})},onError:a=>{w({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue lors de la suppression."})}}),C=z?.filter(a=>a.name.toLowerCase().includes(x.toLowerCase())||a.description?.toLowerCase().includes(x.toLowerCase())||a.subject?.toLowerCase().includes(x.toLowerCase()))||[];return A?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"h-8 bg-gray-200 rounded w-64 animate-pulse"}),(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:"h-48 bg-gray-200 rounded animate-pulse"},a))})]}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Modèles d'évaluations"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-1",children:"Créez et gérez vos modèles d'évaluations avec questions/réponses"})]}),(0,b.jsx)(s.default,{href:"/dashboard/evaluations/templates/new",children:(0,b.jsxs)(j.Button,{children:[(0,b.jsx)(n.Plus,{className:"h-4 w-4 mr-2"}),"Nouveau modèle"]})})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(o.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(k.Input,{placeholder:"Rechercher un modèle...",value:x,onChange:a=>y(a.target.value),className:"pl-10"})]}),0===C.length?(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"flex flex-col items-center justify-center py-12",children:[(0,b.jsx)(r.FileQuestion,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Aucun modèle trouvé"}),(0,b.jsx)("p",{className:"text-muted-foreground text-center mb-4",children:x?"Aucun modèle ne correspond à votre recherche.":"Créez votre premier modèle d'évaluation pour commencer."}),!x&&(0,b.jsx)(s.default,{href:"/dashboard/evaluations/templates/new",children:(0,b.jsxs)(j.Button,{children:[(0,b.jsx)(n.Plus,{className:"h-4 w-4 mr-2"}),"Créer un modèle"]})})]})}):(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:C.map(a=>(0,b.jsx)(t.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.2},children:(0,b.jsxs)(i.Card,{className:"hover:shadow-lg transition-shadow",children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(i.CardTitle,{className:"text-lg",children:a.name}),!a.organization_id&&(0,b.jsx)(l.Badge,{variant:"outline",className:"text-xs",children:"Système"})]}),(0,b.jsx)(i.CardDescription,{className:"mt-1",children:a.description||"Aucune description"})]}),(0,b.jsxs)(l.Badge,{variant:"secondary",children:[a.questions?.length||0," questions"]})]})}),(0,b.jsxs)(i.CardContent,{children:[(0,b.jsxs)("div",{className:"space-y-3",children:[a.subject&&(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"Sujet :"})," ",(0,b.jsx)("span",{className:"text-muted-foreground",children:a.subject})]}),a.assessment_type&&(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"Type :"})," ",(0,b.jsx)("span",{className:"text-muted-foreground",children:a.assessment_type})]}),(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"Note max :"})," ",(0,b.jsxs)("span",{className:"text-muted-foreground",children:[a.max_score," points"]})]}),a.time_limit_minutes&&(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("span",{className:"font-medium",children:"Durée :"})," ",(0,b.jsxs)("span",{className:"text-muted-foreground",children:[a.time_limit_minutes," min"]})]}),(0,b.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Créé le ",(0,u.formatDate)(a.created_at)]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t",children:[(0,b.jsx)(s.default,{href:`/dashboard/evaluations/templates/${a.id}`,className:"flex-1",children:(0,b.jsxs)(j.Button,{variant:"outline",size:"sm",className:"w-full",children:[(0,b.jsx)(p.Edit,{className:"h-4 w-4 mr-2"}),"Modifier"]})}),a.organization_id&&(0,b.jsx)(j.Button,{variant:"outline",size:"sm",onClick:()=>{confirm("Êtes-vous sûr de vouloir supprimer ce modèle ?")&&B.mutate(a.id)},children:(0,b.jsx)(q.Trash2,{className:"h-4 w-4"})})]})]})]})},a.id))})]})}a.s(["default",()=>v])}];

//# sourceMappingURL=_aa0a0e2d._.js.map