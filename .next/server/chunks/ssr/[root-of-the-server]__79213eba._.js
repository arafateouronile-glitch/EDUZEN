module.exports=[224361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},814747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},219897,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);a.i(460355);var e=a.i(346271);let f=c.forwardRef(({className:a,variant:c="default",hoverable:f=!1,glow:g=!1,glowColor:h="rgba(51, 90, 207, 0.3)",...i},j)=>(0,b.jsxs)(e.motion.div,{ref:j,className:(0,d.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===c,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===c,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===c,"cursor-pointer":f,"hover:shadow-2xl hover:scale-[1.02]":f,"hover:bg-white/90 dark:hover:bg-gray-900/90":f},a),whileHover:f?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...i,children:[g&&(0,b.jsx)(e.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${h} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,b.jsx)("div",{className:"relative z-10",children:i.children})]}));f.displayName="GlassCard",a.s(["GlassCard",()=>f])},992258,a=>{"use strict";let b=(0,a.i(170106).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);a.s(["Mail",()=>b],992258)},773320,a=>{"use strict";let b=(0,a.i(170106).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);a.s(["Upload",()=>b],773320)},427699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},254799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},522734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},500874,(a,b,c)=>{b.exports=a.x("buffer",()=>require("buffer"))},688947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},449719,(a,b,c)=>{b.exports=a.x("assert",()=>require("assert"))},406461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},491829,a=>{"use strict";var b=a.i(187924),c=a.i(913216),d=a.i(50944),e=a.i(572131);let f=(0,a.i(170106).default)("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var g=a.i(340695),h=a.i(703130),i=a.i(238246);function j({children:a,allowedRoles:j,fallback:k,redirectTo:l="/dashboard"}){let{user:m,isLoading:n}=(0,c.useAuth)(),o=(0,d.useRouter)(),[p,q]=(0,e.useState)(null);return((0,e.useEffect)(()=>{if(!n&&m){let a=m.role||"",b=j.includes(a);q(b),b||!l||k||o.push(l)}},[m,n,j,l,o,k]),n||null===p)?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):p?(0,b.jsx)(b.Fragment,{children:a}):k?(0,b.jsx)(b.Fragment,{children:k}):(0,b.jsx)("div",{className:"container mx-auto py-16 px-4",children:(0,b.jsx)(h.Card,{className:"max-w-md mx-auto",children:(0,b.jsxs)(h.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,b.jsx)(f,{className:"h-8 w-8 text-red-600"})}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Accès non autorisé"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Vous n'avez pas les permissions nécessaires pour accéder à cette page."}),(0,b.jsx)(i.default,{href:"/dashboard",children:(0,b.jsx)(g.Button,{children:"Retour au tableau de bord"})})]})})})}a.s(["ADMIN_ROLES",0,["super_admin","admin","secretary","accountant"],"FINANCE_ROLES",0,["super_admin","admin","secretary","accountant"],"FORMATION_MANAGEMENT_ROLES",0,["super_admin","admin","secretary"],"RoleGuard",()=>j],491829)},963519,a=>{"use strict";let b=(0,a.i(170106).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);a.s(["Phone",()=>b],963519)},806368,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);a.i(460355);var e=a.i(346271);let f=c.forwardRef(({className:a,columns:c=4,gap:e="md",children:f,...g},h)=>(0,b.jsx)("div",{ref:h,className:(0,d.cn)("grid",{1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 md:grid-cols-2 lg:grid-cols-4"}[c],{sm:"gap-4",md:"gap-6",lg:"gap-8"}[e],a),...g,children:f}));f.displayName="BentoGrid";let g=c.forwardRef(({className:a,span:c=1,rowSpan:f=1,children:g,...h},i)=>(0,b.jsx)(e.motion.div,{ref:i,className:(0,d.cn)({1:"col-span-1",2:"col-span-1 md:col-span-2",3:"col-span-1 md:col-span-2 lg:col-span-3",4:"col-span-1 md:col-span-2 lg:col-span-4"}[c],{1:"row-span-1",2:"row-span-1 md:row-span-2",3:"row-span-1 md:row-span-3"}[f],a),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:[.16,1,.3,1]},...h,children:g}));g.displayName="BentoCard",a.s(["BentoCard",()=>g,"BentoGrid",()=>f])},613749,a=>{"use strict";let b=(0,a.i(170106).default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);a.s(["ChevronLeft",()=>b],613749)},46864,a=>{"use strict";let b=(0,a.i(170106).default)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);a.s(["UserCheck",()=>b],46864)},950463,a=>{"use strict";var b=a.i(187924),c=a.i(497895);function d({className:a,...d}){return(0,b.jsx)("div",{className:(0,c.cn)("animate-pulse rounded-md bg-gray-200",a),...d})}function e(){return(0,b.jsxs)("div",{className:"rounded-2xl p-6 border-2 border-gray-200 bg-white",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,b.jsx)(d,{className:"h-12 w-12 rounded-2xl"}),(0,b.jsx)(d,{className:"h-6 w-20"})]}),(0,b.jsx)(d,{className:"h-8 w-24 mb-2"}),(0,b.jsx)(d,{className:"h-4 w-32"})]})}function f(){return(0,b.jsxs)("div",{className:"rounded-2xl p-6 border-2 border-gray-200 bg-white",children:[(0,b.jsx)(d,{className:"h-6 w-48 mb-4"}),(0,b.jsx)(d,{className:"h-64 w-full"})]})}function g({count:a=3}){return(0,b.jsx)("div",{className:"space-y-3",children:Array.from({length:a}).map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center gap-4 p-4 border rounded-lg",children:[(0,b.jsx)(d,{className:"h-12 w-12 rounded-full"}),(0,b.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,b.jsx)(d,{className:"h-4 w-3/4"}),(0,b.jsx)(d,{className:"h-3 w-1/2"})]}),(0,b.jsx)(d,{className:"h-8 w-20"})]},c))})}function h({count:a=3}){return(0,b.jsx)(g,{count:a})}function i({items:a=4}){return(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:a}).map((a,c)=>(0,b.jsx)(e,{},c))})}a.s(["ChartSkeleton",()=>f,"Skeleton",()=>d,"SkeletonBentoGrid",()=>i,"SkeletonList",()=>h,"StatsCardSkeleton",()=>e])},452218,571907,a=>{"use strict";var b,c,d=a.i(325383),e=((b={}).AUTH_REQUIRED="AUTH_1001",b.AUTH_INVALID_CREDENTIALS="AUTH_1002",b.AUTH_SESSION_EXPIRED="AUTH_1003",b.AUTH_INSUFFICIENT_PERMISSIONS="AUTH_1004",b.AUTH_2FA_REQUIRED="AUTH_1005",b.AUTH_2FA_INVALID="AUTH_1006",b.VALIDATION_ERROR="VALID_2001",b.VALIDATION_REQUIRED_FIELD="VALID_2002",b.VALIDATION_INVALID_FORMAT="VALID_2003",b.VALIDATION_UNIQUE_CONSTRAINT="VALID_2004",b.DB_CONNECTION_ERROR="DB_3001",b.DB_QUERY_ERROR="DB_3002",b.DB_NOT_FOUND="DB_3003",b.DB_CONSTRAINT_VIOLATION="DB_3004",b.DB_FOREIGN_KEY_CONSTRAINT="DB_3006",b.DB_RLS_POLICY_VIOLATION="DB_3005",b.NETWORK_ERROR="NET_4001",b.API_TIMEOUT="NET_4002",b.API_RATE_LIMIT="NET_4003",b.API_SERVER_ERROR="NET_4004",b.API_NOT_FOUND="NET_4005",b.API_BAD_REQUEST="NET_4006",b.BUSINESS_LOGIC_ERROR="BIZ_5001",b.RESOURCE_LOCKED="BIZ_5002",b.OPERATION_NOT_ALLOWED="BIZ_5003",b.QUOTA_EXCEEDED="BIZ_5004",b.INTERNAL_ERROR="SYS_6001",b.CONFIGURATION_ERROR="SYS_6002",b.SERVICE_UNAVAILABLE="SYS_6003",b);(c={}).LOW="low",c.MEDIUM="medium",c.HIGH="high",c.CRITICAL="critical";class f extends Error{code;severity;userMessage;retryable;context;originalError;constructor(a,b="SYS_6001",c="medium",d={},e){super(a),this.name="AppError",this.code=b,this.severity=c,this.userMessage=d.userMessage||this.getDefaultUserMessage(b),this.retryable=d.retryable??this.isRetryable(b),this.context={...d,code:b,severity:c,timestamp:new Date().toISOString()},this.originalError=e,Error.captureStackTrace&&Error.captureStackTrace(this,f)}getDefaultUserMessage(a){return({AUTH_1001:"Vous devez être connecté pour effectuer cette action.",AUTH_1002:"Email ou mot de passe incorrect.",AUTH_1003:"Votre session a expiré. Veuillez vous reconnecter.",AUTH_1004:"Vous n'avez pas les permissions nécessaires.",AUTH_1005:"Authentification à deux facteurs requise.",AUTH_1006:"Code d'authentification invalide.",VALID_2001:"Les données fournies ne sont pas valides.",VALID_2002:"Certains champs obligatoires sont manquants.",VALID_2003:"Le format des données est incorrect.",VALID_2004:"Cette valeur existe déjà.",DB_3001:"Impossible de se connecter à la base de données.",DB_3002:"Erreur lors de l'exécution de la requête.",DB_3003:"Ressource introuvable.",DB_3004:"Cette opération viole une contrainte de la base de données.",DB_3006:"Cette opération viole une contrainte de clé étrangère.",DB_3005:"Vous n'avez pas accès à cette ressource.",NET_4001:"Erreur de connexion réseau. Vérifiez votre connexion internet.",NET_4002:"La requête a pris trop de temps. Veuillez réessayer.",NET_4003:"Trop de requêtes. Veuillez patienter quelques instants.",NET_4004:"Erreur serveur. Veuillez réessayer plus tard.",NET_4005:"Ressource introuvable.",NET_4006:"Requête invalide.",BIZ_5001:"Cette opération n'est pas autorisée dans le contexte actuel.",BIZ_5002:"Cette ressource est actuellement verrouillée.",BIZ_5003:"Cette opération n'est pas autorisée.",BIZ_5004:"Vous avez atteint la limite autorisée.",SYS_6001:"Une erreur interne est survenue. Veuillez réessayer.",SYS_6002:"Erreur de configuration du système.",SYS_6003:"Service temporairement indisponible."})[a]||"Une erreur inattendue est survenue."}isRetryable(a){return["NET_4001","NET_4002","NET_4004","DB_3001","SYS_6003"].includes(a)}toJSON(){return{name:this.name,message:this.message,code:this.code,severity:this.severity,userMessage:this.userMessage,retryable:this.retryable,context:this.context,stack:this.stack,originalError:this.originalError instanceof Error?{name:this.originalError.name,message:this.originalError.message,stack:this.originalError.stack}:this.originalError}}}let g=new class{handleError(a,b={}){if(a instanceof f)return this.logError(a),a;if(a instanceof Error)return this.handleStandardError(a,b);if(this.isSupabaseError(a))return this.handleSupabaseError(a,b);let c=new f("Une erreur inattendue est survenue.","SYS_6001","high",b,a);return this.logError(c),c}handleStandardError(a,b){let c=a.message.toLowerCase(),d="SYS_6001",e="medium";c.includes("network")||c.includes("fetch")?(d="NET_4001",e="medium"):c.includes("timeout")?(d="NET_4002",e="medium"):c.includes("unauthorized")||c.includes("401")?(d="AUTH_1001",e="high"):c.includes("forbidden")||c.includes("403")?(d="AUTH_1004",e="high"):c.includes("not found")||c.includes("404")?(d="DB_3003",e="low"):(c.includes("validation")||c.includes("invalid"))&&(d="VALID_2001",e="low");let g=new f(a.message,d,e,b,a);return this.logError(g),g}handleSupabaseError(a,b){let c=a.code||a.status,d=a.message||"Erreur Supabase",e=b.code||"DB_3002",g="medium";if(!b.code)switch(c){case"PGRST116":case"42P01":e="DB_3003",g="low";break;case"42501":e="DB_3005",g="high";break;case"23505":e="VALID_2004",g="low";break;case"23503":e="DB_3004",g="medium";break;case"PGRST301":case"400":e="NET_4006",g="low";break;case"401":e="AUTH_1001",g="high";break;case"403":e="AUTH_1004",g="high";break;case"404":e="NET_4005",g="low";break;case"500":e="NET_4004",g="high"}"DB_3006"===e&&(g="medium");let h=new f(d,e,g,b,a);return this.logError(h),h}isSupabaseError(a){return a&&(a.code||a.status||a.message)&&("string"==typeof a.code||"number"==typeof a.status)}logError(a){let b={...a.context,code:a.code,severity:a.severity,retryable:a.retryable};switch(a.severity){case"critical":case"high":d.logger.error(a.message,a.originalError||a,b);break;case"medium":d.logger.warn(a.message,b);break;case"low":d.logger.info(`Error: ${a.message}`,b)}}createValidationError(a,b){return new f(a,"VALID_2001","low",{field:b,userMessage:a})}createAuthError(a,b){return new f(b||"Erreur d'authentification",a,"high")}createDatabaseError(a,b){return new f(a,"DB_3002","medium",{},b)}createNotFoundError(a,b){return new f(a,"DB_3003","low",b)}};a.s(["AppError",()=>f,"ErrorCode",()=>e,"errorHandler",0,g],571907),a.s([],452218)},49492,a=>{"use strict";a.i(452218);var b=a.i(571907);async function c(a,c,d,e){try{let f=a.from(c).select(e?.select||"*").eq("organization_id",d);e?.filters&&Object.entries(e.filters).forEach(([a,b])=>{null!=b&&(f=f.eq(a,b))}),e?.search&&(f=f.ilike(e.search.field,`%${e.search.value}%`)),f=e?.orderBy?f.order(e.orderBy.column,{ascending:e.orderBy.ascending??!1}):f.order("created_at",{ascending:!1});let{data:g,error:h}=await f;if(h)throw b.errorHandler.handleError(h,{organizationId:d,operation:"getAllByOrganization",table:c});return g||[]}catch(a){if(a instanceof b.AppError)throw a;throw b.errorHandler.handleError(a,{organizationId:d,operation:"getAllByOrganization",table:c})}}async function d(a,c,d,e){try{let{data:f,error:g}=await a.from(c).select(e||"*").eq("id",d).single();if(g){if("PGRST116"===g.code||"42P01"===g.code)throw b.errorHandler.handleError(g,{code:b.ErrorCode.DB_NOT_FOUND,operation:"getById",id:d,table:c});throw b.errorHandler.handleError(g,{operation:"getById",id:d,table:c})}if(!f)throw b.errorHandler.createDatabaseError(`Enregistrement avec l'ID ${d} introuvable dans ${c}`,{id:d,table:c});return f}catch(a){if(a instanceof b.AppError)throw a;throw b.errorHandler.handleError(a,{operation:"getById",id:d,table:c})}}a.s(["getAllByOrganization",()=>c,"getById",()=>d])},697662,a=>{"use strict";a.i(452218);var b=a.i(571907);function c(a,c){for(let d of c)if(!a[d])throw b.errorHandler.createValidationError(`Le champ ${String(d)} est obligatoire`,String(d))}a.s(["validateRequired",()=>c])},542502,a=>{"use strict";var b=a.i(269240);a.i(452218);var c=a.i(571907),d=a.i(325383),e=a.i(49492);async function f(a,b,d,e){try{let f=e.year||new Date().getFullYear().toString().slice(-2),g=e.padding||6,h=e.fieldName||"number",i=`${e.prefix}-${e.orgCode}-${f}-%`,{data:j,error:k}=await a.from(b).select(h).eq("organization_id",d).like(h,i).order(h,{ascending:!1}).limit(1).maybeSingle();if(k&&"PGRST116"!==k.code&&"42P01"!==k.code)throw c.errorHandler.handleError(k,{operation:"generateUniqueNumber",table:b,organizationId:d});let l=1;if(j&&j[h]){let a=String(j[h]).split("-");l=parseInt(a[a.length-1]||"0",10)+1}return`${e.prefix}-${e.orgCode}-${f}-${String(l).padStart(g,"0")}`}catch(a){throw c.errorHandler.handleError(a,{operation:"generateUniqueNumber",table:b,organizationId:d})}}var g=a.i(697662);let h=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getAll(a,b){try{let d=b?.page||1,e=b?.limit||50,f=(d-1)*e;if(b?.search){let g=this.supabase.from("students").select("*, classes(id, name, level)",{count:"exact"}).eq("organization_id",a).or(`first_name.ilike.%${b.search}%,last_name.ilike.%${b.search}%,student_number.ilike.%${b.search}%`);b?.classId&&(g=g.eq("class_id",b.classId)),b?.status&&(g=g.eq("status",b.status));let{data:h,error:i,count:j}=await g.order("last_name",{ascending:!0}).range(f,f+e-1);if(i)throw c.errorHandler.handleError(i,{organizationId:a,operation:"getAll",filters:b});return{data:h||[],total:j||0,page:d,limit:e,totalPages:Math.ceil((j||0)/e)}}let g=this.supabase.from("students").select("*, classes(id, name, level)",{count:"exact"}).eq("organization_id",a);b?.classId&&(g=g.eq("class_id",b.classId)),b?.status&&(g=g.eq("status",b.status));let{data:h,error:i,count:j}=await g.order("last_name",{ascending:!0}).range(f,f+e-1);if(i)throw c.errorHandler.handleError(i,{organizationId:a,operation:"getAll",filters:b});return{data:h||[],total:j||0,page:d,limit:e,totalPages:Math.ceil((j||0)/e)}}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{organizationId:a,operation:"getAll"})}}async getById(a){try{return(0,e.getById)(this.supabase,"students",a,"*, classes(id, name, level)")}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"getById",id:a})}}async getByNumber(a,b){try{let{data:d,error:e}=await this.supabase.from("students").select("*").eq("organization_id",a).eq("student_number",b).single();if(e){if("PGRST116"===e.code||"42P01"===e.code)throw c.errorHandler.handleError(e,{code:c.ErrorCode.DB_NOT_FOUND,operation:"getByNumber",organizationId:a,studentNumber:b});throw c.errorHandler.handleError(e,{operation:"getByNumber",organizationId:a,studentNumber:b})}return d}catch(d){if(d instanceof c.AppError)throw d;throw c.errorHandler.handleError(d,{operation:"getByNumber",organizationId:a,studentNumber:b})}}async create(a){try{(0,g.validateRequired)(a,["first_name","last_name","organization_id"]);let b=a.student_number;if(!b||""===b.trim()){let c=a.organization_id;if(!c)throw Error("organization_id is required");let{data:d}=await this.supabase.from("organizations").select("code").eq("id",c).single(),e=d?.code||"ORG",g=new Date().getFullYear().toString().slice(-2);b=await f(this.supabase,"students",c,{prefix:"EDU",orgCode:e,year:g,padding:6,fieldName:"student_number"})}let e={...a,student_number:b},{data:h,error:i}=await this.supabase.from("students").insert(e).select().single();if(i){if("23505"===i.code)throw c.errorHandler.handleError(i,{code:c.ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,operation:"create",field:"student_number"});if("42501"===i.code)throw c.errorHandler.handleError(i,{code:c.ErrorCode.DB_RLS_POLICY_VIOLATION,operation:"create"});throw c.errorHandler.handleError(i,{operation:"create",student:a})}return d.logger.info("Étudiant créé avec succès",{id:h?.id,organizationId:a.organization_id||void 0,studentNumber:h?.student_number}),h}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"create",student:a})}}async update(a,b){try{let e={...b};if("class_id"in e)if(""!==e.class_id&&e.class_id){let{data:a,error:b}=await this.supabase.from("classes").select("id").eq("id",e.class_id).maybeSingle();a||b||(e.class_id=null)}else e.class_id=null;let{data:f,error:g}=await this.supabase.from("students").update(e).eq("id",a).select().single();if(g){if("PGRST116"===g.code||"42P01"===g.code)throw c.errorHandler.handleError(g,{code:c.ErrorCode.DB_NOT_FOUND,operation:"update",id:a});if("42501"===g.code)throw c.errorHandler.handleError(g,{code:c.ErrorCode.DB_RLS_POLICY_VIOLATION,operation:"update",id:a});throw c.errorHandler.handleError(g,{operation:"update",id:a,updates:b})}if(!f)throw c.errorHandler.createDatabaseError(`\xc9tudiant avec l'ID ${a} introuvable pour la mise \xe0 jour`,{id:a});return d.logger.info("Étudiant mis à jour avec succès",{id:a,updates:b}),f}catch(d){if(d instanceof c.AppError)throw d;throw c.errorHandler.handleError(d,{operation:"update",id:a,updates:b})}}async delete(a){return this.update(a,{status:"inactive"})}async import(a,b){try{if(!b||0===b.length)throw c.errorHandler.createValidationError("Aucun étudiant à importer","students");let{data:e}=await this.supabase.from("organizations").select("code").eq("id",a).single(),g=e?.code||"ORG",h=new Date().getFullYear().toString().slice(-2),i=await Promise.all(b.map(async b=>{if(b.student_number&&""!==b.student_number.trim())return b;let c=await f(this.supabase,"students",a,{prefix:"EDU",orgCode:g,year:h,padding:6,fieldName:"student_number"});return{...b,student_number:c}})),{data:j,error:k}=await this.supabase.from("students").insert(i).select();if(k){if("23505"===k.code)throw c.errorHandler.handleError(k,{code:c.ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,operation:"import",field:"student_number"});throw c.errorHandler.handleError(k,{operation:"import",organizationId:a,count:b.length})}return d.logger.info("Étudiants importés avec succès",{organizationId:a,count:j?.length||0}),j||[]}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"import",organizationId:a})}}};a.s(["studentService",0,h],542502)},179257,a=>{"use strict";let b=(0,a.i(170106).default)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]);a.s(["Link",()=>b],179257)},922520,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);a.s(["ArrowUpRight",()=>b],922520)},172162,a=>{"use strict";let b=(0,a.i(170106).default)("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);a.s(["SlidersHorizontal",()=>b],172162)},593547,a=>{"use strict";var b=a.i(269240);class c{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async create(a){try{let{data:b,error:c}=await this.supabase.from("export_history").insert({organization_id:a.organizationId,user_id:a.userId,export_type:a.exportType,entity_type:a.entityType,filename:a.filename,record_count:a.recordCount||0,file_size_bytes:a.fileSizeBytes,filters:a.filters?JSON.stringify(a.filters):null}).select().single();if(c){if("PGRST205"===c.code||c.message?.includes("Could not find the table"))return null;throw c}return b}catch(a){if(a?.code==="PGRST205"||a?.message?.includes("Could not find the table"))return null;throw a}}async getByOrganization(a,b){try{let c=b?.page||1,d=b?.limit||50,e=(c-1)*d,f=this.supabase.from("export_history").select("*, users(full_name, email)",{count:"exact"}).eq("organization_id",a).order("created_at",{ascending:!1});b?.userId&&(f=f.eq("user_id",b.userId)),b?.exportType&&(f=f.eq("export_type",b.exportType)),b?.entityType&&(f=f.eq("entity_type",b.entityType));let{data:g,error:h,count:i}=await f.range(e,e+d-1);if(h){if("PGRST116"===h.code||"PGRST200"===h.code||"42P01"===h.code||"PGRST301"===h.code||400===h.status||404===h.status||"400"===h.code||"404"===h.code||h.message?.includes("relation")||h.message?.includes("does not exist"))return{data:[],total:0,page:c,limit:d,totalPages:0};throw h}return{data:g||[],total:i||0,page:c,limit:d,totalPages:Math.ceil((i||0)/d)}}catch(a){if(a?.code==="PGRST116"||a?.code==="PGRST200"||a?.code==="42P01"||a?.code==="PGRST301"||a?.status===400||a?.status===404||a?.code==="400"||a?.code==="404"||a?.message?.includes("relation")||a?.message?.includes("does not exist"))return{data:[],total:0,page:b?.page||1,limit:b?.limit||50,totalPages:0};throw a}}async getStats(a){try{let{data:b,error:c}=await this.supabase.from("export_history").select("export_type, entity_type, record_count, file_size_bytes").eq("organization_id",a);if(c){if("PGRST116"===c.code||"PGRST200"===c.code||"42P01"===c.code||"PGRST301"===c.code||400===c.status||404===c.status||"400"===c.code||"404"===c.code||c.message?.includes("relation")||c.message?.includes("does not exist"))return{total:0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};throw c}let d={total:b?.length||0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};return b?.forEach(a=>{d.byType[a.export_type]=(d.byType[a.export_type]||0)+1,d.byEntity[a.entity_type]=(d.byEntity[a.entity_type]||0)+1,d.totalRecords+=a.record_count||0,d.totalSizeBytes+=a.file_size_bytes||0}),d}catch(a){if(a?.code==="PGRST116"||a?.code==="PGRST200"||a?.code==="42P01"||a?.code==="PGRST301"||a?.status===400||a?.status===404||a?.code==="400"||a?.code==="404"||a?.message?.includes("relation")||a?.message?.includes("does not exist"))return{total:0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};throw a}}async delete(a,b){let{error:c}=await this.supabase.from("export_history").delete().eq("id",a).eq("user_id",b);if(c)throw c}async deleteByUser(a,b){let{error:c}=await this.supabase.from("export_history").delete().eq("user_id",a).eq("organization_id",b);if(c)throw c}}let d=new c;a.s(["ExportHistoryService",()=>c,"exportHistoryService",0,d])},592319,a=>{"use strict";let b=(0,a.i(170106).default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);a.s(["UserX",()=>b],592319)},624722,a=>{"use strict";let b=(0,a.i(170106).default)("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]);a.s(["FileSpreadsheet",()=>b],624722)},211989,a=>{"use strict";var b=a.i(222703),c=a.i(96659),d=a.i(460017),e=a.i(593547);async function f(a,c={}){if(!a||0===a.length)throw Error("Aucune donnée à exporter");let{filename:g=`export_${new Date().toISOString().split("T")[0]}`,sheetName:h="Données",format:i="xlsx",entityType:j="other",organizationId:k,userId:l}=c,m=`${g}.${"csv"===i?"csv":"xlsx"}`;if("csv"===i)(0,b.exportToCSV)(m,a),d.analytics.export.csv(h,a.length);else{let c=Object.keys(a[0]||{}).map(a=>({header:a,key:a,width:20}));await (0,b.exportToExcel)({filename:m,sheetName:h,columns:c,data:a}),d.analytics.export.excel(h,a.length)}if(k&&l)try{await e.exportHistoryService.create({organizationId:k,userId:l,exportType:"csv"===i?"csv":"excel",entityType:j||"other",filename:m,recordCount:a.length})}catch(a){if(a?.code==="PGRST205"||a?.message?.includes("Could not find the table"))return}}function g(a){return a.map(a=>({Numéro:a.student_number||"",Prénom:a.first_name||"",Nom:a.last_name||"",Email:a.email||"",Téléphone:a.phone||"","Date de naissance":a.date_of_birth?(0,c.formatDate)(a.date_of_birth):"",Statut:"active"===a.status?"Actif":"Inactif","Date d'inscription":a.enrollment_date?(0,c.formatDate)(a.enrollment_date):"",Classe:a.classes?.name||"",Niveau:a.classes?.level||""}))}a.s(["exportData",()=>f,"prepareStudentsExport",()=>g])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__79213eba._.js.map