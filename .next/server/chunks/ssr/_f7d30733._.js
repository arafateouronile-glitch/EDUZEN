module.exports=[941675,a=>{"use strict";let b=(0,a.i(170106).default)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);a.s(["Calendar",()=>b],941675)},641710,a=>{"use strict";let b=(0,a.i(170106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],641710)},400187,a=>{"use strict";var b=a.i(298621);let c=a=>"boolean"==typeof a?`${a}`:0===a?"0":a,d=b.clsx;a.s(["cva",0,(a,b)=>e=>{var f;if((null==b?void 0:b.variants)==null)return d(a,null==e?void 0:e.class,null==e?void 0:e.className);let{variants:g,defaultVariants:h}=b,i=Object.keys(g).map(a=>{let b=null==e?void 0:e[a],d=null==h?void 0:h[a];if(null===b)return null;let f=c(b)||c(d);return g[a][f]}),j=e&&Object.entries(e).reduce((a,b)=>{let[c,d]=b;return void 0===d||(a[c]=d),a},{});return d(a,i,null==b||null==(f=b.compoundVariants)?void 0:f.reduce((a,b)=>{let{class:c,className:d,...e}=b;return Object.entries(e).every(a=>{let[b,c]=a;return Array.isArray(c)?c.includes({...h,...j}[b]):({...h,...j})[b]===c})?[...a,c,d]:a},[]),null==e?void 0:e.class,null==e?void 0:e.className)}])},495756,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],495756)},284505,a=>{"use strict";let b=(0,a.i(170106).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);a.s(["Download",()=>b],284505)},992258,a=>{"use strict";let b=(0,a.i(170106).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);a.s(["Mail",()=>b],992258)},54018,a=>{"use strict";let b=(0,a.i(170106).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);a.s(["XCircle",()=>b],54018)},546842,a=>{"use strict";let b=(0,a.i(170106).default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);a.s(["User",()=>b],546842)},533441,a=>{"use strict";let b=(0,a.i(170106).default)("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);a.s(["Check",()=>b],533441)},124987,a=>{"use strict";let b=(0,a.i(170106).default)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);a.s(["MapPin",()=>b],124987)},773320,a=>{"use strict";let b=(0,a.i(170106).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);a.s(["Upload",()=>b],773320)},452218,571907,a=>{"use strict";var b,c,d=a.i(325383),e=((b={}).AUTH_REQUIRED="AUTH_1001",b.AUTH_INVALID_CREDENTIALS="AUTH_1002",b.AUTH_SESSION_EXPIRED="AUTH_1003",b.AUTH_INSUFFICIENT_PERMISSIONS="AUTH_1004",b.AUTH_2FA_REQUIRED="AUTH_1005",b.AUTH_2FA_INVALID="AUTH_1006",b.VALIDATION_ERROR="VALID_2001",b.VALIDATION_REQUIRED_FIELD="VALID_2002",b.VALIDATION_INVALID_FORMAT="VALID_2003",b.VALIDATION_UNIQUE_CONSTRAINT="VALID_2004",b.DB_CONNECTION_ERROR="DB_3001",b.DB_QUERY_ERROR="DB_3002",b.DB_NOT_FOUND="DB_3003",b.DB_CONSTRAINT_VIOLATION="DB_3004",b.DB_FOREIGN_KEY_CONSTRAINT="DB_3006",b.DB_RLS_POLICY_VIOLATION="DB_3005",b.NETWORK_ERROR="NET_4001",b.API_TIMEOUT="NET_4002",b.API_RATE_LIMIT="NET_4003",b.API_SERVER_ERROR="NET_4004",b.API_NOT_FOUND="NET_4005",b.API_BAD_REQUEST="NET_4006",b.BUSINESS_LOGIC_ERROR="BIZ_5001",b.RESOURCE_LOCKED="BIZ_5002",b.OPERATION_NOT_ALLOWED="BIZ_5003",b.QUOTA_EXCEEDED="BIZ_5004",b.INTERNAL_ERROR="SYS_6001",b.CONFIGURATION_ERROR="SYS_6002",b.SERVICE_UNAVAILABLE="SYS_6003",b);(c={}).LOW="low",c.MEDIUM="medium",c.HIGH="high",c.CRITICAL="critical";class f extends Error{code;severity;userMessage;retryable;context;originalError;constructor(a,b="SYS_6001",c="medium",d={},e){super(a),this.name="AppError",this.code=b,this.severity=c,this.userMessage=d.userMessage||this.getDefaultUserMessage(b),this.retryable=d.retryable??this.isRetryable(b),this.context={...d,code:b,severity:c,timestamp:new Date().toISOString()},this.originalError=e,Error.captureStackTrace&&Error.captureStackTrace(this,f)}getDefaultUserMessage(a){return({AUTH_1001:"Vous devez être connecté pour effectuer cette action.",AUTH_1002:"Email ou mot de passe incorrect.",AUTH_1003:"Votre session a expiré. Veuillez vous reconnecter.",AUTH_1004:"Vous n'avez pas les permissions nécessaires.",AUTH_1005:"Authentification à deux facteurs requise.",AUTH_1006:"Code d'authentification invalide.",VALID_2001:"Les données fournies ne sont pas valides.",VALID_2002:"Certains champs obligatoires sont manquants.",VALID_2003:"Le format des données est incorrect.",VALID_2004:"Cette valeur existe déjà.",DB_3001:"Impossible de se connecter à la base de données.",DB_3002:"Erreur lors de l'exécution de la requête.",DB_3003:"Ressource introuvable.",DB_3004:"Cette opération viole une contrainte de la base de données.",DB_3006:"Cette opération viole une contrainte de clé étrangère.",DB_3005:"Vous n'avez pas accès à cette ressource.",NET_4001:"Erreur de connexion réseau. Vérifiez votre connexion internet.",NET_4002:"La requête a pris trop de temps. Veuillez réessayer.",NET_4003:"Trop de requêtes. Veuillez patienter quelques instants.",NET_4004:"Erreur serveur. Veuillez réessayer plus tard.",NET_4005:"Ressource introuvable.",NET_4006:"Requête invalide.",BIZ_5001:"Cette opération n'est pas autorisée dans le contexte actuel.",BIZ_5002:"Cette ressource est actuellement verrouillée.",BIZ_5003:"Cette opération n'est pas autorisée.",BIZ_5004:"Vous avez atteint la limite autorisée.",SYS_6001:"Une erreur interne est survenue. Veuillez réessayer.",SYS_6002:"Erreur de configuration du système.",SYS_6003:"Service temporairement indisponible."})[a]||"Une erreur inattendue est survenue."}isRetryable(a){return["NET_4001","NET_4002","NET_4004","DB_3001","SYS_6003"].includes(a)}toJSON(){return{name:this.name,message:this.message,code:this.code,severity:this.severity,userMessage:this.userMessage,retryable:this.retryable,context:this.context,stack:this.stack,originalError:this.originalError instanceof Error?{name:this.originalError.name,message:this.originalError.message,stack:this.originalError.stack}:this.originalError}}}let g=new class{handleError(a,b={}){if(a instanceof f)return this.logError(a),a;if(a instanceof Error)return this.handleStandardError(a,b);if(this.isSupabaseError(a))return this.handleSupabaseError(a,b);let c=new f("Une erreur inattendue est survenue.","SYS_6001","high",b,a);return this.logError(c),c}handleStandardError(a,b){let c=a.message.toLowerCase(),d="SYS_6001",e="medium";c.includes("network")||c.includes("fetch")?(d="NET_4001",e="medium"):c.includes("timeout")?(d="NET_4002",e="medium"):c.includes("unauthorized")||c.includes("401")?(d="AUTH_1001",e="high"):c.includes("forbidden")||c.includes("403")?(d="AUTH_1004",e="high"):c.includes("not found")||c.includes("404")?(d="DB_3003",e="low"):(c.includes("validation")||c.includes("invalid"))&&(d="VALID_2001",e="low");let g=new f(a.message,d,e,b,a);return this.logError(g),g}handleSupabaseError(a,b){let c=a.code||a.status,d=a.message||"Erreur Supabase",e=b.code||"DB_3002",g="medium";if(!b.code)switch(c){case"PGRST116":case"42P01":e="DB_3003",g="low";break;case"42501":e="DB_3005",g="high";break;case"23505":e="VALID_2004",g="low";break;case"23503":e="DB_3004",g="medium";break;case"PGRST301":case"400":e="NET_4006",g="low";break;case"401":e="AUTH_1001",g="high";break;case"403":e="AUTH_1004",g="high";break;case"404":e="NET_4005",g="low";break;case"500":e="NET_4004",g="high"}"DB_3006"===e&&(g="medium");let h=new f(d,e,g,b,a);return this.logError(h),h}isSupabaseError(a){return a&&(a.code||a.status||a.message)&&("string"==typeof a.code||"number"==typeof a.status)}logError(a){let b={...a.context,code:a.code,severity:a.severity,retryable:a.retryable};switch(a.severity){case"critical":case"high":d.logger.error(a.message,a.originalError||a,b);break;case"medium":d.logger.warn(a.message,b);break;case"low":d.logger.info(`Error: ${a.message}`,b)}}createValidationError(a,b){return new f(a,"VALID_2001","low",{field:b,userMessage:a})}createAuthError(a,b){return new f(b||"Erreur d'authentification",a,"high")}createDatabaseError(a,b){return new f(a,"DB_3002","medium",{},b)}createNotFoundError(a,b){return new f(a,"DB_3003","low",b)}};a.s(["AppError",()=>f,"ErrorCode",()=>e,"errorHandler",0,g],571907),a.s([],452218)},692759,a=>{"use strict";let b=(0,a.i(170106).default)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);a.s(["Send",()=>b],692759)},405784,a=>{"use strict";let b=(0,a.i(170106).default)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);a.s(["ChevronDown",()=>b],405784)},887682,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);a.i(460355);var e=a.i(346271),f=a.i(262036),g=a.i(405784),h=a.i(290821);c.forwardRef(({className:a,label:i,error:j,helperText:k,variant:l="default",leftIcon:m,id:n,options:o,placeholder:p,value:q,...r},s)=>{let[t,u]=c.useState(!1),[v,w]=c.useState(!1),x=n||`select-${Math.random().toString(36).substr(2,9)}`,y=(0,d.cn)("flex w-full rounded-lg font-medium transition-all duration-300","appearance-none cursor-pointer","focus:outline-none focus:ring-2 focus:ring-primary/20","disabled:cursor-not-allowed disabled:opacity-50",{"border-2 border-input bg-background px-4 py-3 pr-11":"default"===l,"focus:border-primary focus:bg-white":"default"===l&&!j,"border-destructive focus:border-destructive focus:ring-destructive/20":j,"border-2 border-input bg-transparent px-4 py-3 pr-11":"outlined"===l,"focus:border-primary focus:shadow-md focus:shadow-primary/10":"outlined"===l&&!j,"border-0 border-b-2 border-input bg-muted/50 px-4 py-3 pr-11 rounded-b-none":"filled"===l,"focus:bg-muted focus:border-primary":"filled"===l&&!j,"focus:border-destructive bg-destructive/5":"filled"===l&&j},m&&"pl-11",a);return(0,b.jsxs)("div",{className:"w-full space-y-1.5",children:[i&&(0,b.jsxs)(e.motion.label,{htmlFor:x,initial:!1,animate:{color:j?"#EF4444":t?"rgb(37, 99, 235)":"rgb(107, 114, 128)"},className:(0,d.cn)("block text-sm font-medium transition-colors duration-200",j&&"text-destructive"),children:[i,r.required&&(0,b.jsx)("span",{className:"text-destructive ml-1",children:"*"})]}),(0,b.jsxs)("div",{className:"relative",children:[m&&(0,b.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none z-10",children:m}),(0,b.jsxs)(e.motion.select,{ref:s,id:x,value:q,...r,onFocus:a=>{u(!0),r.onFocus?.(a)},onBlur:a=>{u(!1),w(!1),r.onBlur?.(a)},onMouseDown:()=>w(!v),className:y,animate:{scale:t?1.01:1,borderColor:j?"#EF4444":t?"rgb(37, 99, 235)":"rgb(226, 232, 240)"},transition:{duration:.2},children:[p&&(0,b.jsx)("option",{value:"",disabled:!0,children:p}),(o||[]).map(a=>(0,b.jsx)("option",{value:a.value,disabled:a.disabled,children:a.label},a.value))]}),(0,b.jsx)(e.motion.div,{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground",animate:{rotate:180*!!v},transition:{duration:.2},children:(0,b.jsx)(g.ChevronDown,{className:"h-5 w-5"})}),j&&(0,b.jsx)(e.motion.div,{className:"absolute right-11 top-1/2 -translate-y-1/2 pointer-events-none",initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:(0,b.jsx)(h.AlertCircle,{className:"h-5 w-5 text-destructive"})})]}),(0,b.jsx)(f.AnimatePresence,{mode:"wait",children:(j||k)&&(0,b.jsx)(e.motion.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.2},className:(0,d.cn)("text-xs transition-colors duration-200",j?"text-destructive":"text-muted-foreground"),children:j||k})})]})}).displayName="SelectNative";let i=c.createContext({}),j=c.forwardRef(({value:a,onValueChange:d,children:e},f)=>{let[g,h]=c.useState(!1);return(0,b.jsx)(i.Provider,{value:{value:a,onValueChange:d,open:g,setOpen:h},children:(0,b.jsx)("div",{className:"relative",ref:f,children:e})})});j.displayName="SelectRoot";let k=c.forwardRef(({children:a,className:e,...f},h)=>{let{open:j,setOpen:k}=c.useContext(i);return(0,b.jsxs)("button",{ref:h,type:"button",className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),onClick:()=>k?.(!j),...f,children:[a,(0,b.jsx)(g.ChevronDown,{className:(0,d.cn)("h-4 w-4 opacity-50 transition-transform",j&&"rotate-180")})]})});k.displayName="SelectTrigger";let l=c.forwardRef(({placeholder:a},d)=>{let{value:e}=c.useContext(i);return(0,b.jsx)("span",{ref:d,children:e||a})});l.displayName="SelectValue";let m=c.forwardRef(({children:a},d)=>{let e=c.useContext(i);return e?.open&&a?(0,b.jsx)("div",{ref:d,className:"absolute top-full left-0 z-50 mt-1 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md",children:(0,b.jsx)("div",{className:"p-1",children:a})}):null});m.displayName="SelectContent";let n=c.forwardRef(({value:a,children:e,className:f,...g},h)=>{let{value:j,onValueChange:k,setOpen:l}=c.useContext(i),m=j===a;return(0,b.jsx)("div",{ref:h,role:"option","aria-selected":m,className:(0,d.cn)("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 px-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",m&&"bg-accent text-accent-foreground",f),onClick:()=>{k?.(a),l?.(!1)},...g,children:e})});n.displayName="SelectItem",a.s(["Select",0,j,"SelectContent",0,m,"SelectItem",0,n,"SelectRoot",0,j,"SelectTrigger",0,k,"SelectValue",0,l])},482520,(a,b,c)=>{"use strict";b.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},324560,(a,b,c)=>{"use strict";var d=a.r(482520);function e(){}function f(){}f.resetWarningCache=e,b.exports=function(){function a(a,b,c,e,f,g){if(g!==d){var h=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw h.name="Invariant Violation",h}}function b(){return a}a.isRequired=a;var c={array:a,bigint:a,bool:a,func:a,number:a,object:a,string:a,symbol:a,any:a,arrayOf:b,element:a,elementType:a,instanceOf:b,node:a,objectOf:b,oneOf:b,oneOfType:b,shape:b,exact:b,checkPropTypes:f,resetWarningCache:e};return c.PropTypes=c,c}},341212,(a,b,c)=>{b.exports=a.r(324560)()},787654,a=>{"use strict";let b=(0,a.i(170106).default)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);a.s(["RotateCcw",()=>b],787654)},46143,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895),e=a.i(533441);let f=c.forwardRef(({className:a,checked:c,onCheckedChange:f,...g},h)=>(0,b.jsxs)("div",{className:"relative inline-flex items-center",children:[(0,b.jsx)("input",{type:"checkbox",ref:h,checked:c,onChange:a=>f?.(a.target.checked),className:(0,d.cn)("peer h-4 w-4 shrink-0 rounded border border-gray-300","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-blue focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","cursor-pointer",c&&"border-brand-blue bg-brand-blue",a),...g}),c&&(0,b.jsx)(e.Check,{className:"absolute h-3 w-3 text-white pointer-events-none left-0.5 top-0.5"})]}));f.displayName="Checkbox",a.s(["Checkbox",()=>f])},265602,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(400187),e=a.i(497895);let f=(0,d.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),g=c.forwardRef(({className:a,variant:c,...d},g)=>(0,b.jsx)("div",{ref:g,role:"alert",className:(0,e.cn)(f({variant:c}),a),...d}));g.displayName="Alert",c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("h5",{ref:d,className:(0,e.cn)("mb-1 font-medium leading-none tracking-tight",a),...c})).displayName="AlertTitle";let h=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("div",{ref:d,className:(0,e.cn)("text-sm [&_p]:leading-relaxed",a),...c}));h.displayName="AlertDescription",a.s(["Alert",()=>g,"AlertDescription",()=>h])},553817,a=>{"use strict";var b=a.i(269240);a.i(452218);var c=a.i(571907),d=a.i(325383);let e=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getSignaturesByDocument(a){try{let{data:b,error:c}=await this.supabase.from("document_signatures").select(`
          *,
          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role)
        `).eq("document_id",a).eq("status","signed").order("signed_at",{ascending:!0});if(c)throw c;return b||[]}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"getSignaturesByDocument",documentId:a})}}async getSignatureById(a){try{let{data:b,error:d}=await this.supabase.from("document_signatures").select(`
          *,
          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role),
          document:documents(id, title, organization_id)
        `).eq("id",a).single();if(d){if("PGRST116"===d.code)throw c.errorHandler.createNotFoundError(`Signature avec l'ID ${a} introuvable`,{signatureId:a});throw d}return b}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"getSignatureById",signatureId:a})}}async getSignaturesByUser(a,b){try{let{data:c,error:d}=await this.supabase.from("document_signatures").select(`
          *,
          document:documents(id, title, type, organization_id)
        `).eq("signer_id",a).eq("organization_id",b).order("signed_at",{ascending:!1});if(d)throw d;return c||[]}catch(d){if(d instanceof c.AppError)throw d;throw c.errorHandler.handleError(d,{operation:"getSignaturesByUser",userId:a,organizationId:b})}}async getSignaturesBySession(a,b){try{let{data:c,error:d}=await this.supabase.from("enrollments").select("student_id").eq("session_id",a).in("status",["confirmed","completed","active"]);if(d)throw d;if(!c||0===c.length)return[];let e=c.map(a=>a.student_id).filter(Boolean),{data:f,error:g}=await this.supabase.from("documents").select("id").eq("organization_id",b).in("student_id",e);if(g)throw g;if(!f||0===f.length)return[];let h=f.map(a=>a.id),{data:i,error:j}=await this.supabase.from("document_signatures").select(`
          *,
          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role),
          document:documents(id, title, type, student_id, students(id, first_name, last_name))
        `).in("document_id",h).eq("organization_id",b).order("signed_at",{ascending:!1});if(j)throw j;return i||[]}catch(d){if(d instanceof c.AppError)throw d;throw c.errorHandler.handleError(d,{operation:"getSignaturesBySession",sessionId:a,organizationId:b})}}async createSignature(a){try{let{data:b}=await this.supabase.auth.getUser();if(!b.user)throw c.errorHandler.createAuthError(c.ErrorCode.AUTH_REQUIRED,"Utilisateur non authentifié");let e=this.generateValidationCode(),f={document_id:a.documentId,organization_id:a.organizationId,signer_id:a.signerId,signature_data:a.signatureData,signature_type:a.signatureType||"handwritten",signer_name:a.signerName||b.user.user_metadata?.full_name||"Utilisateur",signer_email:a.signerEmail||b.user.email||null,signer_role:a.signerRole||null,position_x:a.positionX||null,position_y:a.positionY||null,width:a.width||200,height:a.height||80,page_number:a.pageNumber||1,status:"signed",is_valid:!0,validation_code:e,comment:a.comment||null,ip_address:null,user_agent:null},{data:g,error:h}=await this.supabase.from("document_signatures").insert(f).select(`
          *,
          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role)
        `).single();if(h)throw h;return d.logger.info("Signature créée",{signatureId:g.id,documentId:a.documentId,signerId:a.signerId}),g}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"createSignature",documentId:a.documentId,signerId:a.signerId})}}async updateSignature(a,b){try{let{data:d,error:e}=await this.supabase.from("document_signatures").update(b).eq("id",a).select().single();if(e){if("PGRST116"===e.code)throw c.errorHandler.createNotFoundError(`Signature avec l'ID ${a} introuvable`,{signatureId:a});throw e}return d}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"updateSignature",signatureId:a})}}async revokeSignature(a,b){try{return this.updateSignature(a,{status:"revoked",is_valid:!1,comment:b||"Signature révoquée"})}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"revokeSignature",signatureId:a})}}async deleteSignature(a){try{let{error:b}=await this.supabase.from("document_signatures").delete().eq("id",a);if(b)throw b;d.logger.info("Signature supprimée",{signatureId:a})}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"deleteSignature",signatureId:a})}}async hasSignatures(a){try{let{count:b,error:c}=await this.supabase.from("document_signatures").select("*",{count:"exact",head:!0}).eq("document_id",a).eq("status","signed");if(c)throw c;return(b||0)>0}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"hasSignatures",documentId:a})}}generateValidationCode(){let a=Date.now(),b=Math.random().toString(36).substring(2,15);return`${a}-${b}`}async validateSignature(a,b){try{let c=await this.getSignatureById(a);return c.validation_code===b&&!0===c.is_valid}catch(a){return!1}}};a.s(["signatureService",0,e])},743793,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944);a.i(406878);var e=a.i(140807),f=a.i(340695),g=a.i(703130),h=a.i(265602),i=a.i(526017),j=a.i(941675),k=a.i(124987),l=a.i(546842),m=a.i(495756),n=a.i(54018),o=a.i(641710);function p(){let a=(0,d.useParams)(),p=a?.token,[q,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(null),[C,D]=(0,c.useState)(null);(0,c.useEffect)(()=>{E()},[p]),(0,c.useEffect)(()=>{q?.attendance_session?.require_geolocation&&F()},[q]);let E=async()=>{try{t(!0),x(null);let a=await fetch(`/api/electronic-attendance/public/${p}`);if(!a.ok){let b=await a.json();throw Error(b.error||"Erreur lors du chargement")}let b=await a.json();r(b)}catch(a){x(a instanceof Error?a.message:"Erreur inconnue")}finally{t(!1)}},F=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(a=>{B({latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy}),D(null)},a=>{D("Impossible d'obtenir votre position. Veuillez autoriser la géolocalisation.")}):D("La géolocalisation n'est pas supportée par votre navigateur")},G=async a=>{try{if(v(!0),x(null),q?.attendance_session?.require_geolocation&&!A)throw Error("La géolocalisation est requise pour émarger");let b=await fetch("/api/electronic-attendance/sign",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:p,signatureData:a,location:A})});if(!b.ok){let a=await b.json();throw Error(a.error||"Erreur lors de la signature")}z(!0)}catch(a){x(a instanceof Error?a.message:"Erreur inconnue")}finally{v(!1)}};if(s)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(i.Loader2,{className:"h-8 w-8 animate-spin mx-auto mb-4 text-primary"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Chargement..."})]})});if(w&&!q)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:(0,b.jsx)(g.Card,{className:"max-w-md w-full",children:(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-red-600 mb-2",children:[(0,b.jsx)(n.XCircle,{className:"h-6 w-6"}),(0,b.jsx)(g.CardTitle,{children:"Erreur"})]}),(0,b.jsx)(g.CardDescription,{children:w})]})})});if(y)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:(0,b.jsxs)(g.Card,{className:"max-w-md w-full",children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-green-600 mb-2",children:[(0,b.jsx)(m.CheckCircle,{className:"h-6 w-6"}),(0,b.jsx)(g.CardTitle,{children:"Émargement enregistré"})]}),(0,b.jsx)(g.CardDescription,{children:"Votre présence a été enregistrée avec succès. Vous pouvez maintenant fermer cette page."})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsx)(f.Button,{onClick:()=>window.close(),className:"w-full",children:"Fermer"})})]})});if(!q)return null;if("pending"!==q.status)return(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 p-4",children:(0,b.jsx)(g.Card,{className:"max-w-md w-full",children:(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-yellow-600 mb-2",children:[(0,b.jsx)(n.XCircle,{className:"h-6 w-6"}),(0,b.jsx)(g.CardTitle,{children:"Émargement non disponible"})]}),(0,b.jsxs)(g.CardDescription,{children:["signed"===q.status&&"Vous avez déjà émargé pour cette session.","expired"===q.status&&"Cette session d'émargement a expiré.","declined"===q.status&&"Vous avez refusé cet émargement."]})]})})});let H=q.attendance_session,I=H?new Date(H.date).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}):"";return(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 py-8 px-4",children:(0,b.jsx)("div",{className:"max-w-4xl mx-auto",children:(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{className:"text-2xl",children:"Émargement électronique"}),(0,b.jsx)(g.CardDescription,{children:"Validez votre présence à la session suivante"})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid gap-4 p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(l.User,{className:"h-5 w-5 text-gray-500 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Apprenant"}),(0,b.jsx)("p",{className:"font-medium",children:q.student_name})]})]}),(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(j.Calendar,{className:"h-5 w-5 text-gray-500 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Session"}),(0,b.jsx)("p",{className:"font-medium",children:H?.title}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:I}),H?.start_time&&(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:[(0,b.jsx)(o.Clock,{className:"h-4 w-4 inline mr-1"}),H.start_time,H.end_time&&` - ${H.end_time}`]})]})]}),H?.location_name&&(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(k.MapPin,{className:"h-5 w-5 text-gray-500 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Lieu"}),(0,b.jsx)("p",{className:"font-medium",children:H.location_name})]})]})]}),H?.require_geolocation&&(0,b.jsxs)(h.Alert,{variant:A?"default":C?"destructive":"default",children:[(0,b.jsx)(k.MapPin,{className:"h-4 w-4"}),(0,b.jsx)(h.AlertDescription,{children:A?(0,b.jsx)("span",{className:"text-green-600",children:"✓ Position GPS vérifiée"}):C?(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Géolocalisation requise"}),(0,b.jsx)("p",{className:"text-sm mt-1",children:C}),(0,b.jsx)(f.Button,{variant:"outline",size:"sm",onClick:F,className:"mt-2",children:"Réessayer"})]}):(0,b.jsx)("span",{children:"Vérification de votre position GPS..."})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-medium mb-4",children:"Votre signature"}),(0,b.jsx)(e.SignaturePad,{width:700,height:200,onSave:G,title:"Signez ci-dessous pour confirmer votre présence",description:"Dessinez votre signature dans la zone ci-dessous",disabled:u||H?.require_geolocation===!0&&!A})]}),w&&(0,b.jsx)(h.Alert,{variant:"destructive",children:(0,b.jsx)(h.AlertDescription,{children:w})}),(0,b.jsx)("div",{className:"text-sm text-gray-500 border-t pt-4",children:(0,b.jsx)("p",{children:"En émargent électroniquement, vous certifiez votre présence à cette session de formation. Votre signature est enregistrée de manière sécurisée et conforme aux normes en vigueur."})})]})]})})})}a.s(["default",()=>p])}];

//# sourceMappingURL=_f7d30733._.js.map