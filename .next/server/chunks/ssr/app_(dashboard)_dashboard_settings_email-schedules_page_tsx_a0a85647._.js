module.exports=[156171,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(416117),i=a.i(792843),j=a.i(872675),k=a.i(340695),l=a.i(703130),m=a.i(205522),n=a.i(917171),o=a.i(546893),p=a.i(280281),q=a.i(864037),r=a.i(992258),s=a.i(915618),t=a.i(683245),u=a.i(781560),v=a.i(325015),w=a.i(308549),x=a.i(641710),y=a.i(941675),z=a.i(660246),A=a.i(321161),B=a.i(591965);a.i(460355);var C=a.i(346271),D=a.i(262036),E=a.i(497895);function F(){let{user:a}=(0,g.useAuth)(),m=(0,f.useQueryClient)(),{addToast:n}=(0,q.useToast)(),[o,p]=(0,c.useState)("schedules"),[t,u]=(0,c.useState)(null),[x,y]=(0,c.useState)(!1),{data:z,isLoading:C}=(0,d.useQuery)({queryKey:["email-schedules",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)throw Error("Organization ID manquant");return h.emailScheduleService.getAllSchedules(a.organization_id)},enabled:!!a?.organization_id}),{data:F}=(0,d.useQuery)({queryKey:["email-templates",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)throw Error("Organization ID manquant");return i.emailTemplateService.getAll(a.organization_id)},enabled:!!a?.organization_id}),{data:I}=(0,d.useQuery)({queryKey:["document-templates",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)throw Error("Organization ID manquant");return j.documentTemplateService.getAllTemplates(a.organization_id)},enabled:!!a?.organization_id}),J=(0,e.useMutation)({mutationFn:async b=>{if(!a?.organization_id)throw Error("Organization ID manquant");return h.emailScheduleService.createSchedule(a.organization_id,b)},onSuccess:()=>{m.invalidateQueries({queryKey:["email-schedules"]}),y(!1),n({title:"Règle créée",description:"La règle de planification a été créée avec succès.",type:"success"})},onError:a=>{n({title:"Erreur",description:a.message||"Erreur lors de la création de la règle.",type:"error"})}}),K=(0,e.useMutation)({mutationFn:async({id:a,input:b})=>h.emailScheduleService.updateSchedule(a,b),onSuccess:()=>{m.invalidateQueries({queryKey:["email-schedules"]}),u(null),n({title:"Règle mise à jour",description:"La règle de planification a été mise à jour avec succès.",type:"success"})},onError:a=>{n({title:"Erreur",description:a.message||"Erreur lors de la mise à jour de la règle.",type:"error"})}}),L=(0,e.useMutation)({mutationFn:async a=>h.emailScheduleService.deleteSchedule(a),onSuccess:()=>{m.invalidateQueries({queryKey:["email-schedules"]}),n({title:"Règle supprimée",description:"La règle de planification a été supprimée avec succès.",type:"success"})},onError:a=>{n({title:"Erreur",description:a.message||"Erreur lors de la suppression de la règle.",type:"error"})}}),M=(0,e.useMutation)({mutationFn:async({id:a,isActive:b})=>h.emailScheduleService.updateSchedule(a,{is_active:b}),onSuccess:()=>{m.invalidateQueries({queryKey:["email-schedules"]}),n({title:"Règle mise à jour",description:`La r\xe8gle a \xe9t\xe9 ${t?"activée":"désactivée"}.`,type:"success"})},onError:a=>{n({title:"Erreur",description:a.message||"Erreur lors de la mise à jour de la règle.",type:"error"})}}),N=z?.filter(a=>a.is_active)||[],O=z?.filter(a=>!a.is_active)||[];return(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[(0,b.jsx)(r.Mail,{className:"h-8 w-8 text-brand-blue"}),"Planification d'emails automatiques"]}),(0,b.jsx)("p",{className:"text-gray-600 mt-2",children:"Configurez et gérez les règles d'envoi automatique d'emails (convocation, rappels, etc.)"})]}),(0,b.jsxs)(k.Button,{onClick:()=>y(!0),className:"bg-brand-blue hover:bg-brand-blue/90",children:[(0,b.jsx)(s.Plus,{className:"h-4 w-4 mr-2"}),"Nouvelle règle"]})]}),(0,b.jsxs)("div",{className:"flex gap-4 border-b border-gray-200 mb-6",children:[(0,b.jsxs)("button",{onClick:()=>p("schedules"),className:(0,E.cn)("px-4 py-2 font-medium text-sm border-b-2 transition-colors","schedules"===o?"border-brand-blue text-brand-blue":"border-transparent text-gray-600 hover:text-gray-900"),children:[(0,b.jsx)(A.Settings,{className:"h-4 w-4 inline mr-2"}),"Règles de planification (",z?.length||0,")"]}),(0,b.jsxs)("button",{onClick:()=>p("history"),className:(0,E.cn)("px-4 py-2 font-medium text-sm border-b-2 transition-colors","history"===o?"border-brand-blue text-brand-blue":"border-transparent text-gray-600 hover:text-gray-900"),children:[(0,b.jsx)(B.History,{className:"h-4 w-4 inline mr-2"}),"Historique"]})]})]}),(0,b.jsx)(D.AnimatePresence,{children:x&&(0,b.jsx)(G,{emailTemplates:F||[],documentTemplates:I||[],onCreate:a=>{J.mutate(a)},onCancel:()=>y(!1),isLoading:J.isPending})}),"schedules"===o&&(0,b.jsx)("div",{className:"space-y-6",children:C?(0,b.jsx)("div",{className:"text-center py-12",children:(0,b.jsx)("p",{className:"text-gray-500",children:"Chargement des règles..."})}):z&&z.length>0?(0,b.jsxs)(b.Fragment,{children:[N.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(v.Play,{className:"h-5 w-5 text-green-600"}),"Règles actives (",N.length,")"]}),(0,b.jsx)("div",{className:"grid gap-4",children:N.map(a=>(0,b.jsx)(H,{schedule:a,emailTemplates:F||[],documentTemplates:I||[],onEdit:()=>u(a.id),onDelete:a=>{confirm("Êtes-vous sûr de vouloir supprimer cette règle ?")&&L.mutate(a)},onToggleActive:(a,b)=>{M.mutate({id:a,isActive:b})},isEditing:t===a.id,onCancelEdit:()=>u(null),onUpdate:b=>{K.mutate({id:a.id,input:b})},isUpdating:K.isPending},a.id))})]}),O.length>0&&(0,b.jsxs)("div",{className:"mt-8",children:[(0,b.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(w.Pause,{className:"h-5 w-5 text-gray-400"}),"Règles inactives (",O.length,")"]}),(0,b.jsx)("div",{className:"grid gap-4",children:O.map(a=>(0,b.jsx)(H,{schedule:a,emailTemplates:F||[],documentTemplates:I||[],onEdit:()=>u(a.id),onDelete:a=>{confirm("Êtes-vous sûr de vouloir supprimer cette règle ?")&&L.mutate(a)},onToggleActive:(a,b)=>{M.mutate({id:a,isActive:b})},isEditing:t===a.id,onCancelEdit:()=>u(null),onUpdate:b=>{K.mutate({id:a.id,input:b})},isUpdating:K.isPending},a.id))})]})]}):(0,b.jsx)(l.Card,{children:(0,b.jsxs)(l.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)(r.Mail,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Aucune règle de planification"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Créez votre première règle pour automatiser l'envoi d'emails."}),(0,b.jsxs)(k.Button,{onClick:()=>y(!0),className:"bg-brand-blue hover:bg-brand-blue/90",children:[(0,b.jsx)(s.Plus,{className:"h-4 w-4 mr-2"}),"Créer une règle"]})]})})}),"history"===o&&(0,b.jsx)("div",{className:"space-y-4",children:(0,b.jsxs)(l.Card,{children:[(0,b.jsxs)(l.CardHeader,{children:[(0,b.jsx)(l.CardTitle,{children:"Historique d'exécution"}),(0,b.jsx)(l.CardDescription,{children:"Consultez l'historique des envois automatiques d'emails"})]}),(0,b.jsx)(l.CardContent,{children:(0,b.jsx)("p",{className:"text-gray-500 text-center py-8",children:"L'historique sera disponible une fois que les règles commenceront à s'exécuter."})})]})})]})}function G({emailTemplates:a,documentTemplates:d,onCreate:e,onCancel:f,isLoading:g}){let[h,i]=(0,c.useState)({name:"",description:"",email_type:"session_reminder",template_id:void 0,trigger_type:"before_session_start",trigger_days:1,trigger_time:"09:00",target_type:"session",is_active:!0,send_to_students:!0,send_to_teachers:!1,send_to_coordinators:!1,send_document:!1,document_type:void 0,document_template_id:void 0});return(0,b.jsx)(C.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,b.jsxs)(l.Card,{className:"mb-6",children:[(0,b.jsxs)(l.CardHeader,{children:[(0,b.jsx)(l.CardTitle,{children:"Nouvelle règle de planification"}),(0,b.jsx)(l.CardDescription,{children:"Configurez une nouvelle règle pour l'envoi automatique d'emails"})]}),(0,b.jsx)(l.CardContent,{children:(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),e(h)},className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"name",children:"Nom de la règle *"}),(0,b.jsx)(m.Input,{id:"name",value:h.name,onChange:a=>i({...h,name:a.target.value}),required:!0,placeholder:"Ex: Rappel session 24h avant"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"email_type",children:"Type d'email *"}),(0,b.jsxs)("select",{id:"email_type",value:h.email_type,onChange:a=>i({...h,email_type:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:!0,children:[(0,b.jsx)("option",{value:"session_reminder",children:"Rappel de session"}),(0,b.jsx)("option",{value:"evaluation_reminder",children:"Rappel d'évaluation"}),(0,b.jsx)("option",{value:"session_cancellation",children:"Annulation de session"}),(0,b.jsx)("option",{value:"evaluation_available",children:"Évaluation disponible"}),(0,b.jsx)("option",{value:"certificate_issued",children:"Certificat délivré"}),(0,b.jsx)("option",{value:"custom",children:"Personnalisé"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"template_id",children:"Modèle de mail d'accompagnement"}),(0,b.jsxs)("select",{id:"template_id",value:h.template_id||"",onChange:a=>i({...h,template_id:a.target.value||void 0}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"Template par défaut"}),a.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," (",a.email_type,")"]},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"trigger_type",children:"Type de déclencheur *"}),(0,b.jsxs)("select",{id:"trigger_type",value:h.trigger_type,onChange:a=>i({...h,trigger_type:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:!0,children:[(0,b.jsx)("option",{value:"before_session_start",children:"Avant le début de session"}),(0,b.jsx)("option",{value:"after_session_end",children:"Après la fin de session"}),(0,b.jsx)("option",{value:"before_evaluation_start",children:"Avant le début d'évaluation"}),(0,b.jsx)("option",{value:"after_evaluation_end",children:"Après la fin d'évaluation"}),(0,b.jsx)("option",{value:"fixed_date",children:"Date/heure fixe"})]})]}),"fixed_date"!==h.trigger_type&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"trigger_days",children:"Jours avant/après *"}),(0,b.jsx)(m.Input,{id:"trigger_days",type:"number",value:h.trigger_days||"",onChange:a=>i({...h,trigger_days:parseInt(a.target.value)||void 0}),placeholder:"Ex: 1 (pour 1 jour avant)"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"trigger_time",children:"Heure d'envoi *"}),(0,b.jsx)(m.Input,{id:"trigger_time",type:"time",value:h.trigger_time||"",onChange:a=>i({...h,trigger_time:a.target.value})})]})]}),"fixed_date"===h.trigger_type&&(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"trigger_datetime",children:"Date/heure d'envoi *"}),(0,b.jsx)(m.Input,{id:"trigger_datetime",type:"datetime-local",value:h.trigger_datetime||"",onChange:a=>i({...h,trigger_datetime:a.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"target_type",children:"Type de cible *"}),(0,b.jsxs)("select",{id:"target_type",value:h.target_type,onChange:a=>i({...h,target_type:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:!0,children:[(0,b.jsx)("option",{value:"session",children:"Session"}),(0,b.jsx)("option",{value:"evaluation",children:"Évaluation"}),(0,b.jsx)("option",{value:"student",children:"Étudiant"}),(0,b.jsx)("option",{value:"teacher",children:"Enseignant"}),(0,b.jsx)("option",{value:"all",children:"Tous"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(o.Textarea,{id:"description",value:h.description||"",onChange:a=>i({...h,description:a.target.value}),rows:3,placeholder:"Description de la règle..."})]}),(0,b.jsxs)("div",{className:"space-y-4 border-t pt-6",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:"Document à joindre"}),(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(n.Label,{htmlFor:"send_document",className:"cursor-pointer",children:"Joindre un document à l'email"}),(0,b.jsx)(p.Switch,{checked:h.send_document??!1,onCheckedChange:a=>i({...h,send_document:a})})]}),h.send_document&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"document_type",children:"Type de document *"}),(0,b.jsxs)("select",{id:"document_type",value:h.document_type||"",onChange:a=>i({...h,document_type:a.target.value||void 0}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:h.send_document,children:[(0,b.jsx)("option",{value:"",children:"Sélectionner un type"}),(0,b.jsx)("option",{value:"convocation",children:"Convocation"}),(0,b.jsx)("option",{value:"certificat_realisation",children:"Certificat de réalisation"}),(0,b.jsx)("option",{value:"evaluation_pre_formation",children:"Évaluation pré-formation"}),(0,b.jsx)("option",{value:"evaluation_post_formation",children:"Évaluation post-formation"}),(0,b.jsx)("option",{value:"attestation",children:"Attestation"}),(0,b.jsx)("option",{value:"bulletin",children:"Bulletin"}),(0,b.jsx)("option",{value:"releve_notes",children:"Relevé de notes"}),(0,b.jsx)("option",{value:"certificat_presence",children:"Certificat de présence"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"document_template_id",children:"Modèle de document"}),(0,b.jsxs)("select",{id:"document_template_id",value:h.document_template_id||"",onChange:a=>i({...h,document_template_id:a.target.value||void 0}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"Modèle par défaut"}),d.filter(a=>!h.document_type||a.type===h.document_type).map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," (",a.type,")"]},a.id))]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Sélectionnez un modèle personnalisé ou laissez vide pour utiliser le modèle par défaut"})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4 border-t pt-6",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:"Destinataires"}),(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(n.Label,{htmlFor:"send_to_students",className:"cursor-pointer",children:"Envoyer aux étudiants"}),(0,b.jsx)(p.Switch,{checked:h.send_to_students??!0,onCheckedChange:a=>i({...h,send_to_students:a})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(n.Label,{htmlFor:"send_to_teachers",className:"cursor-pointer",children:"Envoyer aux enseignants"}),(0,b.jsx)(p.Switch,{checked:h.send_to_teachers??!1,onCheckedChange:a=>i({...h,send_to_teachers:a})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(n.Label,{htmlFor:"send_to_coordinators",className:"cursor-pointer",children:"Envoyer aux coordinateurs"}),(0,b.jsx)(p.Switch,{checked:h.send_to_coordinators??!1,onCheckedChange:a=>i({...h,send_to_coordinators:a})})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(p.Switch,{checked:h.is_active??!0,onCheckedChange:a=>i({...h,is_active:a})}),(0,b.jsx)(n.Label,{htmlFor:"is_active",className:"cursor-pointer",children:"Activer la règle"})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(k.Button,{type:"button",variant:"outline",onClick:f,disabled:g,children:"Annuler"}),(0,b.jsx)(k.Button,{type:"submit",disabled:g,className:"bg-brand-blue hover:bg-brand-blue/90",children:g?"Création...":"Créer la règle"})]})]})]})})]})})}function H({schedule:a,emailTemplates:c,documentTemplates:d,onEdit:e,onDelete:f,onToggleActive:g,isEditing:h,onCancelEdit:i,onUpdate:j,isUpdating:m}){let n=c.find(b=>b.id===a.template_id);return h?(0,b.jsx)(I,{schedule:a,emailTemplates:c,documentTemplates:d,onUpdate:j,onCancel:i,isLoading:m}):(0,b.jsx)(l.Card,{className:(0,E.cn)(!a.is_active&&"opacity-60"),children:(0,b.jsx)(l.CardContent,{className:"p-6",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:a.name}),a.is_active?(0,b.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full",children:"Active"}):(0,b.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-600 rounded-full",children:"Inactive"})]}),a.description&&(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:a.description}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,b.jsx)(r.Mail,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:["Type: ",(0,b.jsx)("span",{className:"font-medium text-gray-900",children:a.email_type})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,b.jsx)(x.Clock,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:["Déclencheur: ",(0,b.jsx)("span",{className:"font-medium text-gray-900",children:a.trigger_type})]})]}),a.trigger_days&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,b.jsx)(y.Calendar,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:[a.trigger_days>0?"+":"",a.trigger_days," jour(s)",a.trigger_time&&` \xe0 ${a.trigger_time}`]})]}),n&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,b.jsx)(A.Settings,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:["Template: ",n.name]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,b.jsx)(z.Users,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:["Cible: ",(0,b.jsx)("span",{className:"font-medium text-gray-900",children:a.target_type})]})]}),a.total_sent>0&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,b.jsx)(r.Mail,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:[a.total_sent," email(s) envoyé(s)"]})]})]}),(0,b.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[a.send_to_students&&(0,b.jsx)("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:"Étudiants"}),a.send_to_teachers&&(0,b.jsx)("span",{className:"px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded",children:"Enseignants"}),a.send_to_coordinators&&(0,b.jsx)("span",{className:"px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded",children:"Coordinateurs"})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,b.jsx)(k.Button,{variant:"outline",size:"sm",onClick:()=>g(a.id,!a.is_active),children:a.is_active?(0,b.jsx)(w.Pause,{className:"h-4 w-4"}):(0,b.jsx)(v.Play,{className:"h-4 w-4"})}),(0,b.jsx)(k.Button,{variant:"outline",size:"sm",onClick:e,children:(0,b.jsx)(t.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(k.Button,{variant:"outline",size:"sm",onClick:()=>f(a.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,b.jsx)(u.Trash2,{className:"h-4 w-4"})})]})]})})})}function I({schedule:a,emailTemplates:d,documentTemplates:e,onUpdate:f,onCancel:g,isLoading:h}){let[i,j]=(0,c.useState)({name:a.name,description:a.description||"",email_type:a.email_type,template_id:a.template_id||void 0,trigger_type:a.trigger_type,trigger_days:a.trigger_days||void 0,trigger_time:a.trigger_time||void 0,trigger_datetime:a.trigger_datetime||void 0,target_type:a.target_type,is_active:a.is_active,send_to_students:a.send_to_students,send_to_teachers:a.send_to_teachers,send_to_coordinators:a.send_to_coordinators,send_document:a.send_document??!1,document_type:a.document_type||void 0,document_template_id:a.document_template_id||void 0});return(0,b.jsx)(l.Card,{className:"border-brand-blue",children:(0,b.jsx)(l.CardContent,{className:"p-6",children:(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),f(i)},className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"edit-name",children:"Nom de la règle *"}),(0,b.jsx)(m.Input,{id:"edit-name",value:i.name||"",onChange:a=>j({...i,name:a.target.value}),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"edit-email_type",children:"Type d'email *"}),(0,b.jsxs)("select",{id:"edit-email_type",value:i.email_type||"",onChange:a=>j({...i,email_type:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:!0,children:[(0,b.jsx)("option",{value:"session_reminder",children:"Rappel de session"}),(0,b.jsx)("option",{value:"evaluation_reminder",children:"Rappel d'évaluation"}),(0,b.jsx)("option",{value:"session_cancellation",children:"Annulation de session"}),(0,b.jsx)("option",{value:"evaluation_available",children:"Évaluation disponible"}),(0,b.jsx)("option",{value:"certificate_issued",children:"Certificat délivré"}),(0,b.jsx)("option",{value:"custom",children:"Personnalisé"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"edit-template_id",children:"Modèle de mail d'accompagnement"}),(0,b.jsxs)("select",{id:"edit-template_id",value:i.template_id||"",onChange:a=>j({...i,template_id:a.target.value||void 0}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"Template par défaut"}),d.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," (",a.email_type,")"]},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"edit-trigger_type",children:"Type de déclencheur *"}),(0,b.jsxs)("select",{id:"edit-trigger_type",value:i.trigger_type||"",onChange:a=>j({...i,trigger_type:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:!0,children:[(0,b.jsx)("option",{value:"before_session_start",children:"Avant le début de session"}),(0,b.jsx)("option",{value:"after_session_end",children:"Après la fin de session"}),(0,b.jsx)("option",{value:"before_evaluation_start",children:"Avant le début d'évaluation"}),(0,b.jsx)("option",{value:"after_evaluation_end",children:"Après la fin d'évaluation"}),(0,b.jsx)("option",{value:"fixed_date",children:"Date/heure fixe"})]})]}),"fixed_date"!==i.trigger_type&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"edit-trigger_days",children:"Jours avant/après"}),(0,b.jsx)(m.Input,{id:"edit-trigger_days",type:"number",value:i.trigger_days||"",onChange:a=>j({...i,trigger_days:parseInt(a.target.value)||void 0})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"edit-trigger_time",children:"Heure d'envoi"}),(0,b.jsx)(m.Input,{id:"edit-trigger_time",type:"time",value:i.trigger_time||"",onChange:a=>j({...i,trigger_time:a.target.value})})]})]}),"fixed_date"===i.trigger_type&&(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"edit-trigger_datetime",children:"Date/heure d'envoi"}),(0,b.jsx)(m.Input,{id:"edit-trigger_datetime",type:"datetime-local",value:i.trigger_datetime||"",onChange:a=>j({...i,trigger_datetime:a.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"edit-target_type",children:"Type de cible *"}),(0,b.jsxs)("select",{id:"edit-target_type",value:i.target_type||"",onChange:a=>j({...i,target_type:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:!0,children:[(0,b.jsx)("option",{value:"session",children:"Session"}),(0,b.jsx)("option",{value:"evaluation",children:"Évaluation"}),(0,b.jsx)("option",{value:"student",children:"Étudiant"}),(0,b.jsx)("option",{value:"teacher",children:"Enseignant"}),(0,b.jsx)("option",{value:"all",children:"Tous"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"edit-description",children:"Description"}),(0,b.jsx)(o.Textarea,{id:"edit-description",value:i.description||"",onChange:a=>j({...i,description:a.target.value}),rows:3})]}),(0,b.jsxs)("div",{className:"space-y-4 border-t pt-6",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:"Document à joindre"}),(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(n.Label,{htmlFor:"edit-send_document",className:"cursor-pointer",children:"Joindre un document à l'email"}),(0,b.jsx)(p.Switch,{checked:i.send_document??!1,onCheckedChange:a=>j({...i,send_document:a})})]}),i.send_document&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"edit-document_type",children:"Type de document *"}),(0,b.jsxs)("select",{id:"edit-document_type",value:i.document_type||"",onChange:a=>j({...i,document_type:a.target.value||void 0}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:i.send_document,children:[(0,b.jsx)("option",{value:"",children:"Sélectionner un type"}),(0,b.jsx)("option",{value:"convocation",children:"Convocation"}),(0,b.jsx)("option",{value:"certificat_realisation",children:"Certificat de réalisation"}),(0,b.jsx)("option",{value:"evaluation_pre_formation",children:"Évaluation pré-formation"}),(0,b.jsx)("option",{value:"evaluation_post_formation",children:"Évaluation post-formation"}),(0,b.jsx)("option",{value:"attestation",children:"Attestation"}),(0,b.jsx)("option",{value:"bulletin",children:"Bulletin"}),(0,b.jsx)("option",{value:"releve_notes",children:"Relevé de notes"}),(0,b.jsx)("option",{value:"certificat_presence",children:"Certificat de présence"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(n.Label,{htmlFor:"edit-document_template_id",children:"Modèle de document"}),(0,b.jsxs)("select",{id:"edit-document_template_id",value:i.document_template_id||"",onChange:a=>j({...i,document_template_id:a.target.value||void 0}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"Modèle par défaut"}),e.filter(a=>!i.document_type||a.type===i.document_type).map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," (",a.type,")"]},a.id))]}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Sélectionnez un modèle personnalisé ou laissez vide pour utiliser le modèle par défaut"})]})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4 border-t pt-6",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:"Destinataires"}),(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(n.Label,{htmlFor:"edit-send_to_students",className:"cursor-pointer",children:"Envoyer aux étudiants"}),(0,b.jsx)(p.Switch,{checked:i.send_to_students??!1,onCheckedChange:a=>j({...i,send_to_students:a})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(n.Label,{htmlFor:"edit-send_to_teachers",className:"cursor-pointer",children:"Envoyer aux enseignants"}),(0,b.jsx)(p.Switch,{checked:i.send_to_teachers??!1,onCheckedChange:a=>j({...i,send_to_teachers:a})})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(n.Label,{htmlFor:"edit-send_to_coordinators",className:"cursor-pointer",children:"Envoyer aux coordinateurs"}),(0,b.jsx)(p.Switch,{checked:i.send_to_coordinators??!1,onCheckedChange:a=>j({...i,send_to_coordinators:a})})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(p.Switch,{checked:i.is_active??!1,onCheckedChange:a=>j({...i,is_active:a})}),(0,b.jsx)(n.Label,{htmlFor:"edit-is_active",className:"cursor-pointer",children:"Activer la règle"})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(k.Button,{type:"button",variant:"outline",onClick:g,disabled:h,children:"Annuler"}),(0,b.jsx)(k.Button,{type:"submit",disabled:h,className:"bg-brand-blue hover:bg-brand-blue/90",children:h?"Mise à jour...":"Enregistrer"})]})]})]})})})}a.s(["default",()=>F])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_settings_email-schedules_page_tsx_a0a85647._.js.map