module.exports=[915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},641710,a=>{"use strict";let b=(0,a.i(170106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],641710)},495756,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],495756)},54018,a=>{"use strict";let b=(0,a.i(170106).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);a.s(["XCircle",()=>b],54018)},581464,a=>{"use strict";let b=(0,a.i(170106).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);a.s(["Filter",()=>b],581464)},146673,a=>{"use strict";var b=a.i(269240);let c=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getCategories(a){let{data:b,error:c}=await this.supabase.from("support_categories").select("*").eq("organization_id",a).eq("is_active",!0).order("order_index",{ascending:!0});if(c){if("PGRST116"===c.code||"42P01"===c.code||"PGRST301"===c.code||404===c.status||"404"===c.code||c.message?.includes("relation")||c.message?.includes("relationship")||c.message?.includes("does not exist")||c.message?.includes("schema cache"))return console.warn("Table support_categories does not exist yet or invalid query:",c?.message),[];throw c}return b||[]}async createCategory(a){let{data:b,error:c}=await this.supabase.from("support_categories").insert(a).select().single();if(c)throw c;return b}async updateCategory(a,b){let{data:c,error:d}=await this.supabase.from("support_categories").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteCategory(a){let{error:b}=await this.supabase.from("support_categories").delete().eq("id",a);if(b)throw b}async getTickets(a,b){let c=this.supabase.from("support_tickets").select(`
        *,
        user:users(id, full_name, email),
        assigned_user:users!support_tickets_assigned_to_fkey(id, full_name, email),
        category:support_categories(*)
      `).eq("organization_id",a);b?.userId&&(c=c.eq("user_id",b.userId)),b?.status&&(c=c.eq("status",b.status)),b?.priority&&(c=c.eq("priority",b.priority)),b?.categoryId&&(c=c.eq("category_id",b.categoryId)),b?.assignedTo&&(c=c.eq("assigned_to",b.assignedTo));let{data:d,error:e}=await c.order("created_at",{ascending:!1});if(e){if("PGRST116"===e.code||"42P01"===e.code||"PGRST301"===e.code||404===e.status||400===e.status||"404"===e.code||"400"===e.code||e.message?.includes("relation")||e.message?.includes("relationship")||e.message?.includes("does not exist")||e.message?.includes("schema cache")||e.message?.includes("Could not find a relationship"))return[];throw e}return d||[]}async getTicketById(a){let{data:b,error:c}=await this.supabase.from("support_tickets").select(`
        *,
        user:users(id, full_name, email),
        assigned_user:users!support_tickets_assigned_to_fkey(id, full_name, email),
        category:support_categories(*)
      `).eq("id",a).single();if(c)throw c;return b}async createTicket(a){let{data:b,error:c}=await this.supabase.from("support_tickets").insert(a).select().single();if(c)throw c;return b}async updateTicket(a,b){let{data:c,error:d}=await this.supabase.from("support_tickets").update(b).eq("id",a).select().single();if(d)throw d;return c}async assignTicket(a,b){return this.updateTicket(a,{assigned_to:b,assigned_at:new Date().toISOString(),status:"in_progress"})}async resolveTicket(a){return this.updateTicket(a,{status:"resolved",resolved_at:new Date().toISOString()})}async closeTicket(a){return this.updateTicket(a,{status:"closed",closed_at:new Date().toISOString()})}async getTicketMessages(a){let{data:b,error:c}=await this.supabase.from("support_ticket_messages").select(`
        *,
        user:users(id, full_name, email)
      `).eq("ticket_id",a).order("created_at",{ascending:!0});if(c)throw c;return b}async createMessage(a){let{data:b,error:c}=await this.supabase.from("support_ticket_messages").insert(a).select(`
        *,
        user:users(id, full_name, email)
      `).single();if(c)throw c;return b}async markMessageAsRead(a){let{data:b,error:c}=await this.supabase.from("support_ticket_messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("id",a).select().single();if(c)throw c;return b}async getTicketNotes(a){let{data:b,error:c}=await this.supabase.from("support_ticket_notes").select(`
        *,
        user:users(id, full_name, email)
      `).eq("ticket_id",a).order("created_at",{ascending:!1});if(c)throw c;return b}async createNote(a){let{data:b,error:c}=await this.supabase.from("support_ticket_notes").insert(a).select(`
        *,
        user:users(id, full_name, email)
      `).single();if(c)throw c;return b}async updateNote(a,b){let{data:c,error:d}=await this.supabase.from("support_ticket_notes").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteNote(a){let{error:b}=await this.supabase.from("support_ticket_notes").delete().eq("id",a);if(b)throw b}async createRating(a){let{data:b,error:c}=await this.supabase.from("support_ticket_ratings").insert(a).select().single();if(c)throw c;return b}async getTicketRating(a){let{data:b,error:c}=await this.supabase.from("support_ticket_ratings").select("*").eq("ticket_id",a).maybeSingle();if(c)throw c;return b}async getTemplates(a){let{data:b,error:c}=await this.supabase.from("support_response_templates").select("*").eq("organization_id",a).eq("is_active",!0).order("name",{ascending:!0});if(c)throw c;return b}async createTemplate(a){let{data:b,error:c}=await this.supabase.from("support_response_templates").insert(a).select().single();if(c)throw c;return b}async updateTemplate(a,b){let{data:c,error:d}=await this.supabase.from("support_response_templates").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteTemplate(a){let{error:b}=await this.supabase.from("support_response_templates").delete().eq("id",a);if(b)throw b}async getStatistics(a,b){let c=this.supabase.from("support_tickets").select("status, priority, created_at, resolved_at, first_response_at").eq("organization_id",a);b?.startDate&&(c=c.gte("created_at",b.startDate)),b?.endDate&&(c=c.lte("created_at",b.endDate));let{data:d,error:e}=await c;if(e)throw e;let f=d||[],g={total:f.length,byStatus:{open:0,in_progress:0,waiting_customer:0,resolved:0,closed:0},byPriority:{low:0,medium:0,high:0,urgent:0},averageResponseTime:0,averageResolutionTime:0,resolutionRate:0},h=0,i=0,j=0,k=0,l=0;return f.forEach(a=>{if(a.status&&a.status in g.byStatus&&g.byStatus[a.status]++,a.priority&&a.priority in g.byPriority&&g.byPriority[a.priority]++,a.first_response_at&&a.created_at){let b=new Date(a.first_response_at).getTime()-new Date(a.created_at).getTime();h+=b,i++}if(a.resolved_at&&a.created_at){let b=new Date(a.resolved_at).getTime()-new Date(a.created_at).getTime();j+=b,k++}("resolved"===a.status||"closed"===a.status)&&l++}),i>0&&(g.averageResponseTime=h/i/6e4),k>0&&(g.averageResolutionTime=j/k/36e5),d.length>0&&(g.resolutionRate=l/d.length*100),g}};a.s(["supportService",0,c])},703292,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(146673),i=a.i(703130),j=a.i(340695),k=a.i(205522),l=a.i(917171),m=a.i(546893),n=a.i(965733),o=a.i(800006),p=a.i(915618),q=a.i(563588),r=a.i(641710),s=a.i(495756),t=a.i(54018),u=a.i(290821),v=a.i(581464),w=a.i(238246),x=a.i(497895);function y(){let{user:a}=(0,g.useAuth)(),y=(0,f.useQueryClient)(),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)("all"),[D,E]=(0,c.useState)("all"),{data:F=[]}=(0,d.useQuery)({queryKey:["support-categories",a?.organization_id],queryFn:async()=>{try{return await h.supportService.getCategories(a?.organization_id||"")}catch(a){if(a?.code==="PGRST116"||a?.code==="42P01"||a?.code==="PGRST301"||a?.status===404||a?.code==="404"||a?.message?.includes("relation")||a?.message?.includes("relationship")||a?.message?.includes("does not exist")||a?.message?.includes("schema cache"))return console.warn("Error fetching support categories:",a?.message),[];throw a}},enabled:!!a?.organization_id,retry:!1}),{data:G=[]}=(0,d.useQuery)({queryKey:["support-tickets",a?.organization_id,B,D],queryFn:async()=>{try{let b={};return"all"!==B&&(b.status=B),"all"!==D&&(b.priority=D),a?.role!=="admin"&&a?.role!=="super_admin"&&a?.role!=="support"&&(b.userId=a?.id),await h.supportService.getTickets(a?.organization_id||"",b)}catch(a){if(a?.code==="PGRST116"||a?.code==="42P01"||a?.code==="PGRST301"||a?.status===404||a?.status===400||a?.code==="404"||a?.code==="400"||a?.message?.includes("relation")||a?.message?.includes("relationship")||a?.message?.includes("does not exist")||a?.message?.includes("schema cache")||a?.message?.includes("Could not find a relationship"))return[];throw a}},enabled:!!a?.organization_id,retry:!1}),H=(0,e.useMutation)({mutationFn:async b=>h.supportService.createTicket({...b,organization_id:a?.organization_id,user_id:a?.id}),onSuccess:()=>{y.invalidateQueries({queryKey:["support-tickets"]}),A(!1)}});return(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,b.jsx)("div",{className:"mb-8",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Support client"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Gérez vos demandes de support et suivez vos tickets"})]}),(0,b.jsxs)(n.Dialog,{open:z,onOpenChange:A,children:[(0,b.jsx)(n.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(j.Button,{children:[(0,b.jsx)(p.Plus,{className:"h-4 w-4 mr-2"}),"Nouveau ticket"]})}),(0,b.jsxs)(n.DialogContent,{className:"max-w-2xl",children:[(0,b.jsxs)(n.DialogHeader,{children:[(0,b.jsx)(n.DialogTitle,{children:"Nouveau ticket de support"}),(0,b.jsx)(n.DialogDescription,{children:"Créez un nouveau ticket pour obtenir de l'aide"})]}),(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault();let b=new FormData(a.currentTarget),c={category_id:b.get("category_id")||null,subject:b.get("subject"),description:b.get("description"),priority:b.get("priority")||"medium",tags:b.get("tags")?.split(",").map(a=>a.trim()).filter(Boolean)||[]};H.mutate(c)},children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"category_id",children:"Catégorie"}),(0,b.jsxs)(o.Select,{children:[(0,b.jsx)(o.SelectTrigger,{children:(0,b.jsx)(o.SelectValue,{placeholder:"Sélectionner une catégorie"})}),(0,b.jsx)(o.SelectContent,{children:F?.map(a=>(0,b.jsx)(o.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"subject",children:"Sujet *"}),(0,b.jsx)(k.Input,{id:"subject",name:"subject",required:!0,placeholder:"Décrivez brièvement votre problème"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"description",children:"Description *"}),(0,b.jsx)(m.Textarea,{id:"description",name:"description",required:!0,rows:6,placeholder:"Décrivez votre problème en détail..."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"priority",children:"Priorité"}),(0,b.jsxs)(o.Select,{children:[(0,b.jsx)(o.SelectTrigger,{children:(0,b.jsx)(o.SelectValue,{})}),(0,b.jsxs)(o.SelectContent,{children:[(0,b.jsx)(o.SelectItem,{value:"low",children:"Basse"}),(0,b.jsx)(o.SelectItem,{value:"medium",children:"Moyenne"}),(0,b.jsx)(o.SelectItem,{value:"high",children:"Élevée"}),(0,b.jsx)(o.SelectItem,{value:"urgent",children:"Urgente"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"tags",children:"Tags (séparés par des virgules)"}),(0,b.jsx)(k.Input,{id:"tags",name:"tags",placeholder:"bug, facturation, fonctionnalité"})]})]}),(0,b.jsxs)(n.DialogFooter,{className:"mt-6",children:[(0,b.jsx)(j.Button,{type:"button",variant:"outline",onClick:()=>A(!1),children:"Annuler"}),(0,b.jsx)(j.Button,{type:"submit",disabled:H.isPending,children:"Créer le ticket"})]})]})]})]})]})}),(0,b.jsx)(i.Card,{className:"mb-6",children:(0,b.jsx)(i.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(v.Filter,{className:"h-4 w-4 text-muted-foreground"}),(0,b.jsx)(l.Label,{children:"Statut:"}),(0,b.jsxs)(o.Select,{value:B,onValueChange:C,children:[(0,b.jsx)(o.SelectTrigger,{className:"w-40",children:(0,b.jsx)(o.SelectValue,{})}),(0,b.jsxs)(o.SelectContent,{children:[(0,b.jsx)(o.SelectItem,{value:"all",children:"Tous"}),(0,b.jsx)(o.SelectItem,{value:"open",children:"Ouvert"}),(0,b.jsx)(o.SelectItem,{value:"in_progress",children:"En cours"}),(0,b.jsx)(o.SelectItem,{value:"waiting_customer",children:"En attente"}),(0,b.jsx)(o.SelectItem,{value:"resolved",children:"Résolu"}),(0,b.jsx)(o.SelectItem,{value:"closed",children:"Fermé"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Label,{children:"Priorité:"}),(0,b.jsxs)(o.Select,{value:D,onValueChange:E,children:[(0,b.jsx)(o.SelectTrigger,{className:"w-40",children:(0,b.jsx)(o.SelectValue,{})}),(0,b.jsxs)(o.SelectContent,{children:[(0,b.jsx)(o.SelectItem,{value:"all",children:"Toutes"}),(0,b.jsx)(o.SelectItem,{value:"urgent",children:"Urgente"}),(0,b.jsx)(o.SelectItem,{value:"high",children:"Élevée"}),(0,b.jsx)(o.SelectItem,{value:"medium",children:"Moyenne"}),(0,b.jsx)(o.SelectItem,{value:"low",children:"Basse"})]})]})]})]})})}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"Mes tickets"})}),(0,b.jsx)(i.CardContent,{children:G&&G.length>0?(0,b.jsx)("div",{className:"space-y-4",children:G.map(a=>(0,b.jsx)(w.default,{href:`/dashboard/support/${a.id}`,className:"block",children:(0,b.jsx)(i.Card,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:(0,b.jsx)(i.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)("span",{className:"font-mono text-sm text-muted-foreground",children:a.ticket_number}),(0,b.jsx)("h3",{className:"font-semibold text-lg",children:a.subject}),(0,b.jsx)("span",{className:`text-xs px-2 py-1 rounded ${(a=>{switch(a){case"urgent":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}})(a.priority)}`,children:(a=>{switch(a){case"urgent":return"Urgent";case"high":return"Élevée";case"medium":return"Moyenne";case"low":return"Basse";default:return a}})(a.priority)})]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:a.description}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(a=>{switch(a){case"open":return(0,b.jsx)(u.AlertCircle,{className:"h-4 w-4 text-blue-600"});case"in_progress":return(0,b.jsx)(r.Clock,{className:"h-4 w-4 text-yellow-600"});case"waiting_customer":return(0,b.jsx)(r.Clock,{className:"h-4 w-4 text-orange-600"});case"resolved":return(0,b.jsx)(s.CheckCircle,{className:"h-4 w-4 text-green-600"});case"closed":return(0,b.jsx)(t.XCircle,{className:"h-4 w-4 text-gray-600"});default:return null}})(a.status),(0,b.jsx)("span",{children:(a=>{switch(a){case"open":return"Ouvert";case"in_progress":return"En cours";case"waiting_customer":return"En attente client";case"resolved":return"Résolu";case"closed":return"Fermé";default:return a}})(a.status)})]}),(0,b.jsxs)("span",{children:["Créé le ",(0,x.formatDate)(a.created_at)]}),a.category&&(0,b.jsx)("span",{children:a.category.name}),a.assigned_user&&(0,b.jsxs)("span",{children:["Assigné à ",a.assigned_user.full_name]})]})]}),(0,b.jsx)(q.MessageSquare,{className:"h-5 w-5 text-muted-foreground"})]})})})},a.id))}):(0,b.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"Aucun ticket trouvé"})})]})]})}a.s(["default",()=>y])}];

//# sourceMappingURL=_3d8f6f0f._.js.map