module.exports=[997241,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(269240),i=a.i(340695),j=a.i(219897),k=a.i(205522),l=a.i(917171),m=a.i(280281),n=a.i(254161),o=a.i(864037),p=a.i(491829);a.i(460355);var q=a.i(346271),r=a.i(523312),s=a.i(992258),t=a.i(563588),u=a.i(963519),v=a.i(641710),w=a.i(114548),x=a.i(669520),y=a.i(786520),z=a.i(111269),A=a.i(580208),B=a.i(692759);let C=(0,a.i(170106).default)("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);function D(){let{user:a}=(0,g.useAuth)(),D=(0,h.createClient)(),E=(0,f.useQueryClient)(),{addToast:F}=(0,o.useToast)(),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)({reminder_enabled:!0,reminder_hours_before:24,email_enabled:!0,whatsapp_enabled:!1,sms_enabled:!1}),[K,L]=(0,c.useState)({account_sid:"",auth_token:"",from_number:""}),{data:M,isLoading:N}=(0,d.useQuery)({queryKey:["organization-settings",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)return null;let{data:b,error:c}=await D.from("organizations").select("id, name, settings, subscription_tier").eq("id",a.organization_id).single();if(c)throw c;return b},enabled:!!a?.organization_id}),O=["premium","enterprise"].includes(M?.subscription_tier||"");(0,c.useEffect)(()=>{if(M?.settings){let a=M.settings,b=a.notifications||{};J({reminder_enabled:!1!==b.reminder_enabled,reminder_hours_before:b.reminder_hours_before||24,email_enabled:!1!==b.email_enabled,whatsapp_enabled:b.whatsapp_enabled||!1,sms_enabled:b.sms_enabled||!1}),a.whatsapp&&L({account_sid:a.whatsapp.account_sid||"",auth_token:a.whatsapp.auth_token?"••••••••":"",from_number:a.whatsapp.from_number||""})}},[M]);let P=(0,e.useMutation)({mutationFn:async()=>{if(!a?.organization_id)throw Error("Organization non trouvée");let b=M?.settings||{},c={...b,notifications:{...I}};K.account_sid&&"••••••••"!==K.auth_token?c.whatsapp={account_sid:K.account_sid,auth_token:K.auth_token,from_number:K.from_number}:K.account_sid&&"••••••••"===K.auth_token&&(c.whatsapp={...b.whatsapp,account_sid:K.account_sid,from_number:K.from_number});let{error:d}=await D.from("organizations").update({settings:c}).eq("id",a.organization_id);if(d)throw d},onSuccess:()=>{E.invalidateQueries({queryKey:["organization-settings"]}),F({type:"success",title:"Succès",description:"Paramètres de notifications sauvegardés"})},onError:a=>{F({type:"error",title:"Erreur",description:a instanceof Error?a.message:"Erreur lors de la sauvegarde"})}}),{data:Q}=(0,d.useQuery)({queryKey:["recent-notifications",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)return[];let{data:b}=await D.from("scheduled_notifications").select("*").eq("organization_id",a.organization_id).order("created_at",{ascending:!1}).limit(10);return b||[]},enabled:!!a?.organization_id}),R={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};return N?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,b.jsx)(x.RefreshCw,{className:"h-8 w-8 animate-spin text-brand-blue"})}):(0,b.jsx)(p.RoleGuard,{allowedRoles:p.ADMIN_ROLES,children:(0,b.jsxs)(q.motion.div,{className:"container mx-auto py-8 px-4 max-w-4xl space-y-8",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",children:[(0,b.jsx)(q.motion.div,{variants:R,children:(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)("div",{className:"p-2 bg-brand-blue/10 rounded-xl",children:(0,b.jsx)(r.Bell,{className:"h-8 w-8 text-brand-blue"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Notifications automatiques"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Configurez les rappels et notifications pour vos enseignants et apprenants"})]})]})}),!O&&(0,b.jsx)(q.motion.div,{variants:R,children:(0,b.jsx)(j.GlassCard,{className:"p-6 bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200",children:(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:"p-3 bg-amber-100 rounded-xl",children:(0,b.jsx)(y.Crown,{className:"h-6 w-6 text-amber-600"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-bold text-amber-900 mb-1",children:"Fonctionnalité Premium"}),(0,b.jsx)("p",{className:"text-amber-700 text-sm mb-3",children:"Les notifications WhatsApp sont disponibles uniquement avec un abonnement Premium ou Enterprise. Les rappels par email restent disponibles pour tous."}),(0,b.jsxs)(i.Button,{size:"sm",className:"bg-amber-600 hover:bg-amber-700",children:[(0,b.jsx)(y.Crown,{className:"h-4 w-4 mr-2"}),"Passer à Premium"]})]})]})})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsx)(q.motion.div,{variants:R,children:(0,b.jsxs)(j.GlassCard,{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,b.jsx)(C,{className:"h-5 w-5 text-brand-blue"}),(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Rappels de sessions"})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-base font-medium",children:"Rappels automatiques"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Envoyer des rappels avant chaque session"})]}),(0,b.jsx)(m.Switch,{checked:I.reminder_enabled,onCheckedChange:a=>J({...I,reminder_enabled:a})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"reminder_hours",children:"Délai avant la session"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,b.jsx)(k.Input,{id:"reminder_hours",type:"number",min:1,max:72,value:I.reminder_hours_before,onChange:a=>J({...I,reminder_hours_before:parseInt(a.target.value)||24}),className:"w-24",disabled:!I.reminder_enabled}),(0,b.jsx)("span",{className:"text-gray-500",children:"heures avant"})]}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Par défaut : 24h (la veille)"})]}),(0,b.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,b.jsx)(l.Label,{className:"text-base font-medium",children:"Canaux de notification"}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(s.Mail,{className:"h-5 w-5 text-blue-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium",children:"Email"}),(0,b.jsx)(n.Badge,{variant:"outline",className:"ml-2 text-xs",children:"Inclus"})]})]}),(0,b.jsx)(m.Switch,{checked:I.email_enabled,onCheckedChange:a=>J({...I,email_enabled:a}),disabled:!I.reminder_enabled})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(t.MessageSquare,{className:"h-5 w-5 text-green-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium",children:"WhatsApp"}),(0,b.jsx)(n.Badge,{className:"ml-2 text-xs bg-amber-100 text-amber-700",children:"Premium"})]})]}),(0,b.jsx)(m.Switch,{checked:I.whatsapp_enabled,onCheckedChange:a=>J({...I,whatsapp_enabled:a}),disabled:!O||!I.reminder_enabled})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg opacity-50",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(u.Phone,{className:"h-5 w-5 text-purple-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium",children:"SMS"}),(0,b.jsx)(n.Badge,{variant:"outline",className:"ml-2 text-xs",children:"Bientôt"})]})]}),(0,b.jsx)(m.Switch,{checked:!1,disabled:!0})]})]})]})]})}),(0,b.jsx)(q.motion.div,{variants:R,children:(0,b.jsxs)(j.GlassCard,{className:`p-6 ${!O?"opacity-60":""}`,children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,b.jsx)(t.MessageSquare,{className:"h-5 w-5 text-green-600"}),(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Configuration WhatsApp"}),!O&&(0,b.jsx)(n.Badge,{className:"bg-amber-100 text-amber-700",children:"Premium requis"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"account_sid",children:"Account SID (Twilio)"}),(0,b.jsx)(k.Input,{id:"account_sid",type:"text",value:K.account_sid,onChange:a=>L({...K,account_sid:a.target.value}),placeholder:"AC...",disabled:!O,className:"mt-2"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"auth_token",children:"Auth Token"}),(0,b.jsx)(k.Input,{id:"auth_token",type:"password",value:K.auth_token,onChange:a=>L({...K,auth_token:a.target.value}),placeholder:"••••••••",disabled:!O,className:"mt-2"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"from_number",children:"Numéro WhatsApp"}),(0,b.jsx)(k.Input,{id:"from_number",type:"text",value:K.from_number,onChange:a=>L({...K,from_number:a.target.value}),placeholder:"+14155238886",disabled:!O,className:"mt-2"}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Numéro WhatsApp Business configuré dans Twilio"})]}),(0,b.jsx)("div",{className:"pt-4 border-t",children:(0,b.jsxs)("p",{className:"text-sm text-gray-600 mb-3",children:["Pour configurer WhatsApp, vous avez besoin d'un compte"," ",(0,b.jsx)("a",{href:"https://www.twilio.com/whatsapp",target:"_blank",rel:"noopener noreferrer",className:"text-brand-blue hover:underline",children:"Twilio WhatsApp Business"})]})})]})]})})]}),(0,b.jsx)(q.motion.div,{variants:R,children:(0,b.jsxs)(j.GlassCard,{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(B.Send,{className:"h-5 w-5 text-brand-blue"}),(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Notifications récentes"})]}),(0,b.jsxs)(n.Badge,{variant:"outline",children:[Q?.length||0," notifications"]})]}),Q&&Q.length>0?(0,b.jsx)("div",{className:"space-y-3",children:Q.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:["email"===a.type?(0,b.jsx)(s.Mail,{className:"h-4 w-4 text-blue-600"}):"whatsapp"===a.type?(0,b.jsx)(t.MessageSquare,{className:"h-4 w-4 text-green-600"}):(0,b.jsx)(u.Phone,{className:"h-4 w-4 text-purple-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-gray-900",children:a.metadata?.recipient_name||"Destinataire"}),(0,b.jsxs)("p",{className:"text-xs text-gray-500",children:[a.subject||a.message?.substring(0,50),"..."]})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:"sent"===a.status?(0,b.jsxs)(n.Badge,{className:"bg-green-100 text-green-700",children:[(0,b.jsx)(z.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Envoyé"]}):"failed"===a.status?(0,b.jsxs)(n.Badge,{className:"bg-red-100 text-red-700",children:[(0,b.jsx)(A.AlertTriangle,{className:"h-3 w-3 mr-1"}),"Échoué"]}):(0,b.jsxs)(n.Badge,{className:"bg-amber-100 text-amber-700",children:[(0,b.jsx)(v.Clock,{className:"h-3 w-3 mr-1"}),"En attente"]})})]},a.id))}):(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)(r.Bell,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Aucune notification envoyée"})]})]})}),(0,b.jsx)(q.motion.div,{variants:R,className:"flex justify-end",children:(0,b.jsx)(i.Button,{onClick:()=>{H(!0),P.mutate(void 0,{onSettled:()=>H(!1)})},disabled:G,size:"lg",className:"shadow-lg shadow-brand-blue/25",children:G?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(x.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}),"Sauvegarde..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.Save,{className:"h-4 w-4 mr-2"}),"Sauvegarder les paramètres"]})})})]})})}a.s(["default",()=>D],997241)}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_settings_notifications_page_tsx_acf07f44._.js.map