module.exports=[495756,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],495756)},114548,a=>{"use strict";let b=(0,a.i(170106).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);a.s(["Save",()=>b],114548)},177156,a=>{"use strict";let b=(0,a.i(170106).default)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);a.s(["Eye",()=>b],177156)},280281,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);let e=c.forwardRef(({checked:a,onCheckedChange:c,disabled:e,className:f,...g},h)=>(0,b.jsx)("button",{type:"button",role:"switch","aria-checked":a,ref:h,disabled:e,onClick:()=>c?.(!a),className:(0,d.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",a?"bg-brand-blue":"bg-input",f),...g,children:(0,b.jsx)("span",{className:(0,d.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",a?"translate-x-5":"translate-x-0")})}));e.displayName="Switch",a.s(["Switch",0,e])},141379,a=>{"use strict";let b=(0,a.i(170106).default)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);a.s(["EyeOff",()=>b],141379)},988505,a=>{"use strict";var b=a.i(269240);let c=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getTodos(a,b){let c=this.supabase.from("calendar_todos").select("*").eq("organization_id",a).order("due_date",{ascending:!0});b?.startDate&&(c=c.gte("due_date",b.startDate)),b?.endDate&&(c=c.lte("due_date",b.endDate)),b?.status&&(c=Array.isArray(b.status)?c.in("status",b.status):c.eq("status",b.status)),b?.category&&(c=c.eq("category",b.category)),b?.priority&&(c=c.eq("priority",b.priority)),b?.assignedTo&&(c=c.eq("assigned_to",b.assignedTo)),b?.createdBy&&(c=c.eq("created_by",b.createdBy)),b?.search&&(c=c.or(`title.ilike.%${b.search}%,description.ilike.%${b.search}%`));let{data:d,error:e}=await c;if(e){if("PGRST116"===e.code||"42P01"===e.code||e.message?.includes("does not exist"))return[];throw e}return d||[]}async getTodoById(a){let{data:b,error:c}=await this.supabase.from("calendar_todos").select("*").eq("id",a).single();if(c){if("PGRST116"===c.code||"42P01"===c.code||c.message?.includes("does not exist"))return null;throw c}return b}async createTodo(a){let{data:b,error:c}=await this.supabase.from("calendar_todos").insert(a).select().single();if(c)throw c;return!1!==a.reminder_enabled&&await this.supabase.rpc("create_todo_reminder_notification",{todo_id:b.id}),b}async updateTodo(a,b){let{data:c,error:d}=await this.supabase.from("calendar_todos").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteTodo(a){let{error:b}=await this.supabase.from("calendar_todos").delete().eq("id",a);if(b)throw b}async completeTodo(a){return this.updateTodo(a,{status:"completed"})}async completeTodos(a){let{error:b}=await this.supabase.from("calendar_todos").update({status:"completed"}).in("id",a);if(b)throw b}async getCalendarEvents(a,b,c,d){try{let e={p_organization_id:a,p_start_date:b,p_end_date:c};d&&(e.p_user_id=d);let{data:f,error:g}=await this.supabase.rpc("get_calendar_events",e);if(g){if("42883"===g.code||"PGRST116"===g.code||"42P01"===g.code||"400"===g.code||g.message?.includes("does not exist")||g.message?.includes("function")||g.message?.includes("does not exist"))return this.getCalendarEventsManual(a,b,c,d);throw g}return f||[]}catch(e){return this.getCalendarEventsManual(a,b,c,d)}}async getCalendarEventsManual(a,b,c,d){let e=[];try{let d=await this.getTodos(a,{startDate:b,endDate:c});e.push(...d.map(a=>({event_id:a.id,event_type:"todo",title:a.title,description:a.description,start_date:a.start_date||a.due_date,start_time:a.start_time,end_date:a.due_date,end_time:a.due_time,all_day:a.all_day,status:a.status,color:a.color,category:a.category,priority:a.priority,linked_id:a.linked_session_id||a.linked_formation_id||null})))}catch(a){}try{let f,g=this.supabase.from("sessions").select("id, name, start_date, end_date, start_time, end_time, location, status, formation_id, organization_id, formations(id, name)").eq("organization_id",a);if(d){let{data:a}=await this.supabase.from("users").select("role").eq("id",d).maybeSingle();if(a?.role==="teacher"){let{data:a}=await this.supabase.from("session_teachers").select("session_id").eq("teacher_id",d);if(a&&a.length>0){let b=a.map(a=>a.session_id);g=g.in("id",b)}else{let{data:a,error:b}=await g.limit(0);b&&b.code,f=[]}}}let h=null;if(void 0===f){let{data:a,error:b}=await g;if(f=a,h=b)throw h}if(h)throw h;if(f){let a=new Date(b),d=new Date(c),g=f.filter(b=>{if(!b.start_date)return!1;let c=new Date(b.start_date),e=b.end_date?new Date(b.end_date):null;return c>=a&&c<=d||e&&e>=a&&e<=d||c<=a&&(!e||e>=a)||c<=a&&e&&e>=d}).map(a=>{let b=a.start_date?"string"==typeof a.start_date?a.start_date.split("T")[0]:new Date(a.start_date).toISOString().split("T")[0]:null,c=a.end_date?"string"==typeof a.end_date?a.end_date.split("T")[0]:new Date(a.end_date).toISOString().split("T")[0]:null,d=[];if(a.start_time){let b=a.start_time.slice(0,5),c=a.end_time?a.end_time.slice(0,5):null;c?d.push(`ðŸ• ${b} - ${c}`):d.push(`ðŸ• ${b}`)}return a.location&&d.push(`ðŸ“ ${a.location}`),a.formations?.name&&d.push(`ðŸ“š ${a.formations.name}`),{event_id:a.id,event_type:"session",title:a.name,description:d.length>0?d.join(" â€¢ "):null,start_date:b||"",start_time:a.start_time,end_date:c||b||"",end_time:a.end_time,all_day:!1,status:a.status,color:"#10B981",category:"session",priority:"medium",linked_id:a.formation_id,location:a.location||null,formation_name:a.formations?.name||null}});e.push(...g)}}catch(a){}try{let f=this.supabase.from("formations").select("*, sessions(id, start_date, end_date)").eq("organization_id",a);if(d){let{data:a}=await this.supabase.from("users").select("role").eq("id",d).maybeSingle();if(a?.role==="teacher"){let{data:a}=await this.supabase.from("session_teachers").select("session_id").eq("teacher_id",d);if(!a||!(a.length>0))return e;{let b=a.map(a=>a.session_id),{data:c}=await this.supabase.from("sessions").select("formation_id").in("id",b);if(!c||!(c.length>0))return e;{let a=[...new Set(c.map(a=>a.formation_id).filter(a=>!!a))];if(!(a.length>0))return e;f=f.in("id",a)}}}}let{data:g,error:h}=await f;if(h)throw h;if(g){let a=new Date(b),d=new Date(c),f=g.map(a=>{let b=a.sessions||[];if(0===b.length)return null;let c=b.filter(a=>a.start_date).map(a=>({start:new Date(a.start_date),end:a.end_date?new Date(a.end_date):null}));if(0===c.length)return null;let d=new Date(Math.min(...c.map(a=>a.start.getTime()))),e=c.map(a=>a.end).filter(a=>null!==a),f=e.length>0?new Date(Math.max(...e.map(a=>a.getTime()))):null;return{formation:a,start_date:d,end_date:f}}).filter(a=>null!==a).filter(({start_date:b,end_date:c})=>b>=a&&b<=d||c&&c>=a&&c<=d||b<=a&&(!c||c>=a)||b<=a&&c&&c>=d).map(({formation:a,start_date:b,end_date:c})=>({event_id:a.id,event_type:"formation",title:a.name,description:a.description,start_date:b.toISOString().split("T")[0],start_time:null,end_date:c?c.toISOString().split("T")[0]:b.toISOString().split("T")[0],end_time:null,all_day:!0,status:a.is_active?"active":"inactive",color:"#8B5CF6",category:"formation",priority:"medium",linked_id:a.program_id}));e.push(...f)}}catch(a){}return e}async getNotifications(a,b){let c=this.supabase.from("calendar_notifications").select("*").eq("user_id",a).order("scheduled_at",{ascending:!1});b?.status&&(c=c.eq("status",b.status)),b?.unreadOnly&&(c=c.in("status",["pending","sent"])),b?.limit&&(c=c.limit(b.limit));let{data:d,error:e}=await c;if(e){if("PGRST116"===e.code||"42P01"===e.code||e.message?.includes("does not exist"))return[];throw e}return d||[]}async markNotificationAsRead(a){let{error:b}=await this.supabase.from("calendar_notifications").update({status:"read",read_at:new Date().toISOString()}).eq("id",a);if(b)throw b}async markAllNotificationsAsRead(a){let{error:b}=await this.supabase.from("calendar_notifications").update({status:"read",read_at:new Date().toISOString()}).eq("user_id",a).in("status",["pending","sent"]);if(b)throw b}async dismissNotification(a){let{error:b}=await this.supabase.from("calendar_notifications").update({status:"dismissed"}).eq("id",a);if(b)throw b}async countUnreadNotifications(a){let{count:b,error:c}=await this.supabase.from("calendar_notifications").select("*",{count:"exact",head:!0}).eq("user_id",a).in("status",["pending","sent"]);if(c){if("PGRST116"===c.code||"42P01"===c.code||c.message?.includes("does not exist"))return 0;throw c}return b||0}async getUserPreferences(a,b){let{data:c,error:d}=await this.supabase.from("calendar_user_preferences").select("*").eq("user_id",a).eq("organization_id",b).single();if(d){if("PGRST116"===d.code||"42P01"===d.code||d.message?.includes("does not exist"))return null;throw d}return c}async upsertUserPreferences(a,b,c){let{data:d,error:e}=await this.supabase.from("calendar_user_preferences").upsert({user_id:a,organization_id:b,...c},{onConflict:"user_id,organization_id"}).select().single();if(e)throw e;return d}async getUpcomingTodosWithReminder(a,b=60){let c=new Date,d=new Date(c.getTime()+60*b*1e3),{data:e,error:f}=await this.supabase.from("calendar_todos").select("*").eq("organization_id",a).eq("reminder_enabled",!0).eq("reminder_sent",!1).in("status",["pending","in_progress"]).gte("due_date",c.toISOString().split("T")[0]).lte("due_date",d.toISOString().split("T")[0]);if(f)throw f;return e||[]}async getCalendarStats(a){let b=new Date().toISOString().split("T")[0],{data:c,error:d}=await this.supabase.from("calendar_todos").select("id, status, due_date").eq("organization_id",a);if(d){if("PGRST116"===d.code||"42P01"===d.code||d.message?.includes("does not exist"))return{totalTodos:0,pendingTodos:0,completedTodos:0,overdueTodos:0,todayTodos:0,upcomingTodos:0};throw d}let e=c||[],f=e.length,g=e.filter(a=>"pending"===a.status).length,h=e.filter(a=>"completed"===a.status).length,i=e.filter(a=>"completed"!==a.status&&"cancelled"!==a.status&&a.due_date<b).length;return{totalTodos:f,pendingTodos:g,completedTodos:h,overdueTodos:i,todayTodos:e.filter(a=>a.due_date===b).length,upcomingTodos:e.filter(a=>"completed"!==a.status&&"cancelled"!==a.status&&a.due_date>b).length}}async getConfig(a,b){return null}async upsertConfig(a,b,c){return{organization_id:a,provider:b,...c}}};a.s(["calendarService",0,c])}];

//# sourceMappingURL=_4b15aaa5._.js.map