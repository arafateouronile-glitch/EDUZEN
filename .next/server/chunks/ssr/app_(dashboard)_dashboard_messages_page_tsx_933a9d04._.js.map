{"version":3,"sources":["../../../../app/%28dashboard%29/dashboard/messages/page.tsx"],"sourcesContent":["'use client'\n\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\nimport { useAuth } from '@/lib/hooks/use-auth'\nimport { messagingService } from '@/lib/services/messaging.service'\nimport { createClient } from '@/lib/supabase/client'\nimport { Card, CardContent } from '@/components/ui/card'\nimport { Input } from '@/components/ui/input'\nimport { Button } from '@/components/ui/button'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog'\nimport { Search, MessageSquare, Users, Plus, MoreVertical, Loader2, AlertCircle, Trash2, Archive } from 'lucide-react'\nimport Link from 'next/link'\nimport { formatRelativeTime } from '@/lib/utils'\nimport { useToast } from '@/components/ui/toast'\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu'\n\nexport default function MessagesPage() {\n  const router = useRouter()\n  const { user } = useAuth()\n  const supabase = createClient()\n  const queryClient = useQueryClient()\n  const { addToast } = useToast()\n  const [searchQuery, setSearchQuery] = useState('')\n  const [showNewConversationDialog, setShowNewConversationDialog] = useState(false)\n  const [userSearchQuery, setUserSearchQuery] = useState('')\n  const [conversationType, setConversationType] = useState<'group' | 'personal'>('personal')\n  const [selectedSessionId, setSelectedSessionId] = useState<string>('')\n  const [selectedStudentId, setSelectedStudentId] = useState<string>('')\n\n  // Récupérer les conversations\n  const { data: conversations } = useQuery({\n    queryKey: ['conversations', user?.id, user?.organization_id],\n    queryFn: () =>\n      messagingService.getConversations(user?.id || '', user?.organization_id || ''),\n    enabled: !!user?.id && !!user?.organization_id,\n  })\n\n  // Mutation pour archiver/supprimer une conversation\n  const deleteConversationMutation = useMutation({\n    mutationFn: async (conversationId: string) => {\n      return messagingService.deleteConversation(conversationId)\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['conversations'] })\n      addToast({\n        type: 'success',\n        title: 'Conversation supprimée',\n        description: 'La conversation a été supprimée avec succès.',\n      })\n    },\n    onError: (error) => {\n      addToast({\n        type: 'error',\n        title: 'Erreur',\n        description: 'Impossible de supprimer la conversation. Veuillez réessayer.',\n      })\n    },\n  })\n\n  // Récupérer les sessions pour les messages groupés\n  const { data: sessions, isLoading: isLoadingSessions } = useQuery({\n    queryKey: ['sessions-for-messages', user?.organization_id],\n    queryFn: async () => {\n      if (!user?.organization_id) return []\n      const { data, error } = await supabase\n        .from('sessions')\n        .select('id, name, start_date, end_date, formations(name)')\n        .eq('organization_id', user.organization_id)\n        .order('start_date', { ascending: false })\n        .limit(100)\n      \n      if (error) throw error\n      return data || []\n    },\n    enabled: !!user?.organization_id && showNewConversationDialog,\n  })\n\n  // Récupérer les étudiants (candidats) d'une session sélectionnée\n  const { data: sessionStudents, isLoading: isLoadingStudents } = useQuery({\n    queryKey: ['session-students', selectedSessionId],\n    queryFn: async () => {\n      if (!selectedSessionId) return []\n      \n      // Récupérer les inscriptions avec les étudiants\n      const { data: enrollments, error: enrollmentsError } = await supabase\n        .from('enrollments')\n        .select(`\n          student_id,\n          status,\n          students!inner(id, first_name, last_name, student_number, email)\n        `)\n        .eq('session_id', selectedSessionId)\n      \n      if (enrollmentsError) {\n        console.error('Erreur récupération inscriptions:', enrollmentsError)\n        throw enrollmentsError\n      }\n      \n      if (!enrollments || enrollments.length === 0) return []\n      \n      // Filtrer les inscriptions annulées/rejetées/abandonnées côté client\n      const validEnrollments = enrollments.filter((e: any) => {\n        const status = e.status\n        return status !== 'cancelled' && status !== 'rejected' && status !== 'dropped'\n      })\n      \n      if (validEnrollments.length === 0) return []\n      \n      // Retourner les étudiants directement (on n'a plus besoin de créer des comptes utilisateur)\n      // Les conversations peuvent maintenant être liées directement aux étudiants via student_id\n      const result = validEnrollments.map((enrollment: any) => {\n        const student = enrollment.students\n        return {\n          student,\n          user: null, // On n'a plus besoin de chercher un utilisateur\n          enrollmentId: enrollment.student_id,\n        }\n      })\n      \n      return result\n    },\n    enabled: !!selectedSessionId && conversationType === 'personal',\n  })\n\n  // Récupérer les utilisateurs de l'organisation pour créer une conversation (fallback)\n  const { data: organizationUsers, isLoading: isLoadingUsers } = useQuery({\n    queryKey: ['organization-users', user?.organization_id],\n    queryFn: async () => {\n      if (!user?.organization_id) return []\n      const { data, error } = await supabase\n        .from('users')\n        .select('id, full_name, email, avatar_url, role')\n        .eq('organization_id', user.organization_id)\n        .neq('id', user.id) // Exclure l'utilisateur actuel\n        .order('full_name')\n      \n      if (error) throw error\n      return data || []\n    },\n    enabled: !!user?.organization_id && showNewConversationDialog && conversationType === 'personal' && !selectedSessionId,\n  })\n\n  // Mutation pour créer une conversation directe\n  const createDirectConversationMutation = useMutation({\n    mutationFn: async ({ userId, studentId }: { userId?: string; studentId?: string }) => {\n      if (!user?.id || !user?.organization_id) {\n        throw new Error('Utilisateur non authentifié')\n      }\n      if (!userId && !studentId) {\n        throw new Error('Either userId or studentId must be provided')\n      }\n      \n      try {\n        const conversation = await messagingService.createDirectConversation(\n          user.id,\n          userId || null,\n          user.organization_id,\n          studentId || null\n        )\n        return conversation\n      } catch (error) {\n        throw error\n      }\n    },\n    onSuccess: (conversation) => {\n      queryClient.invalidateQueries({ queryKey: ['conversations'] })\n      setShowNewConversationDialog(false)\n      resetDialogState()\n      if (conversation?.id) {\n        router.push(`/dashboard/messages/${conversation.id}`)\n      }\n      addToast({\n        type: 'success',\n        title: 'Conversation créée',\n        description: 'La conversation a été créée avec succès.',\n      })\n    },\n    onError: (error) => {\n      addToast({\n        type: 'error',\n        title: 'Erreur',\n        description: error instanceof Error ? error.message : 'Une erreur est survenue lors de la création de la conversation.',\n      })\n    },\n  })\n\n  // Mutation pour créer une conversation de groupe\n  const createGroupConversationMutation = useMutation({\n    mutationFn: async () => {\n      if (!user?.id || !user?.organization_id) {\n        throw new Error('Utilisateur non authentifié')\n      }\n      if (!selectedSessionId) {\n        throw new Error('Veuillez sélectionner une session')\n      }\n\n      // Récupérer tous les étudiants de la session\n      const { data: enrollments, error } = await supabase\n        .from('enrollments')\n        .select(`\n          student_id,\n          status,\n          students!inner(id, email)\n        `)\n        .eq('session_id', selectedSessionId)\n\n      if (error) throw error\n\n      // Filtrer les inscriptions annulées/rejetées/abandonnées côté client\n      const validEnrollments = (enrollments || []).filter((e: any) => {\n        const status = e.status\n        return status !== 'cancelled' && status !== 'rejected' && status !== 'dropped'\n      })\n\n      // Extraire les IDs des étudiants\n      const allStudentIds = validEnrollments\n        .map((e: any) => e.students?.id)\n        .filter((id: string | null) => id)\n\n      // Récupérer les utilisateurs qui ont un compte (pour ceux qui en ont un)\n      let userIds: string[] = []\n      if (allStudentIds.length > 0) {\n        const { data: users, error: usersError } = await supabase\n          .from('users')\n          .select('id')\n          .in('id', allStudentIds)\n          .eq('organization_id', user.organization_id)\n        \n        if (!usersError && users) {\n          userIds = users\n            .map((u: any) => u.id)\n            .filter((id: string) => id !== user.id) // Exclure l'utilisateur actuel\n        }\n      }\n\n      // Filtrer les étudiants qui n'ont pas de compte utilisateur\n      // Ceux-ci seront ajoutés directement avec leur student_id\n      const studentIdsWithoutUser = allStudentIds.filter((studentId: string) => {\n        // Si l'étudiant n'est pas dans la liste des userIds trouvés, il n'a pas de compte\n        return !userIds.includes(studentId) && studentId !== user.id\n      })\n\n      // Ajouter l'utilisateur actuel\n      const allUserIds = [user.id, ...userIds]\n\n      // Récupérer le nom de la session\n      const session = sessions?.find((s: any) => s.id === selectedSessionId)\n      const sessionName = session ? `Session: ${(session as any).name}` : 'Groupe de session'\n\n      return messagingService.createGroupConversation(\n        sessionName,\n        allUserIds,\n        user.organization_id,\n        user.id,\n        studentIdsWithoutUser // Passer les studentIds des étudiants sans compte\n      )\n    },\n    onSuccess: (conversation) => {\n      queryClient.invalidateQueries({ queryKey: ['conversations'] })\n      setShowNewConversationDialog(false)\n      resetDialogState()\n      if (conversation?.id) {\n        router.push(`/dashboard/messages/${conversation.id}`)\n      }\n      addToast({\n        type: 'success',\n        title: 'Conversation de groupe créée',\n        description: 'La conversation de groupe a été créée avec succès.',\n      })\n    },\n    onError: (error) => {\n      addToast({\n        type: 'error',\n        title: 'Erreur',\n        description: error instanceof Error ? error.message : 'Une erreur est survenue lors de la création de la conversation de groupe.',\n      })\n    },\n  })\n\n  const resetDialogState = () => {\n    setUserSearchQuery('')\n    setConversationType('personal')\n    setSelectedSessionId('')\n    setSelectedStudentId('')\n  }\n\n  const filteredUsers = organizationUsers?.filter((u) => {\n    if (!userSearchQuery) return true\n    const searchLower = userSearchQuery.toLowerCase()\n    return (\n      (u as any).full_name?.toLowerCase().includes(searchLower) ||\n      (u as any).email?.toLowerCase().includes(searchLower)\n    )\n  })\n\n  const getConversationName = (conversation: any) => {\n    if (conversation.conversation_type === 'group' && conversation.name) {\n      return conversation.name\n    }\n    // Pour les conversations directes, afficher le nom de l'autre participant (admin ou étudiant)\n    if (conversation.participants) {\n      const otherParticipant = conversation.participants.find(\n        (p: any) => p.user_id !== user?.id\n      )\n      \n      // Si c'est un utilisateur (admin)\n      if (otherParticipant?.user) {\n        return otherParticipant.user.full_name || otherParticipant.user.email || 'Conversation'\n      }\n      \n      // Si c'est un étudiant\n      if (otherParticipant?.student) {\n        const studentName = `${otherParticipant.student.first_name || ''} ${otherParticipant.student.last_name || ''}`.trim()\n        return studentName || otherParticipant.student.email || `Candidat ${otherParticipant.student.student_number || ''}` || 'Conversation'\n      }\n    }\n    return 'Conversation'\n  }\n\n  const getConversationAvatar = (conversation: any) => {\n    if (conversation.avatar_url) {\n      return conversation.avatar_url\n    }\n    if (conversation.conversation_type === 'direct' && conversation.participants) {\n      const otherParticipant = conversation.participants.find(\n        (p: any) => p.user_id !== user?.id\n      )\n      // Si c'est un utilisateur (admin)\n      if (otherParticipant?.user) {\n        return otherParticipant.user.avatar_url\n      }\n      // Si c'est un étudiant, pas d'avatar pour l'instant\n      return null\n    }\n    return null\n  }\n\n  const getUnreadCount = (conversation: any) => {\n    // TODO: Implémenter le comptage des messages non lus\n    return 0\n  }\n\n  const filteredConversations = conversations?.filter((conv: any) => {\n    if (!searchQuery) return true\n    const name = getConversationName(conv).toLowerCase()\n    return name.includes(searchQuery.toLowerCase())\n  })\n\n  return (\n    <div className=\"container mx-auto py-8 px-4 max-w-7xl\">\n      <div className=\"mb-8\">\n        <div className=\"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6 mb-6\">\n          <div className=\"space-y-2\">\n            <div className=\"inline-flex items-center gap-3 mb-2\">\n              <div className=\"p-2.5 bg-gradient-to-br from-brand-blue to-brand-cyan rounded-xl shadow-lg\">\n                <MessageSquare className=\"h-7 w-7 text-white\" />\n              </div>\n              <h1 className=\"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-brand-blue to-brand-cyan bg-clip-text text-transparent\">\n                Messages\n              </h1>\n            </div>\n            <p className=\"text-gray-600 text-sm lg:text-base ml-1\">\n              Communiquez avec vos collègues et candidats\n            </p>\n          </div>\n          <Button\n            onClick={() => setShowNewConversationDialog(true)}\n            className=\"bg-gradient-to-r from-brand-blue to-brand-cyan hover:from-brand-blue-dark hover:to-brand-cyan shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105\"\n          >\n            <Plus className=\"h-4 w-4 mr-2\" />\n            Nouvelle conversation\n          </Button>\n        </div>\n\n        {/* Barre de recherche */}\n        <Card className=\"border-brand-blue/20 bg-gradient-to-br from-brand-blue-ghost/30 to-brand-cyan-ghost/30 backdrop-blur-sm shadow-sm hover:shadow-md transition-all duration-300\">\n          <CardContent className=\"pt-6\">\n            <div className=\"relative\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-brand-blue\" />\n              <Input\n                type=\"text\"\n                placeholder=\"Rechercher une conversation...\"\n                value={searchQuery}\n                onChange={(e) => setSearchQuery(e.target.value)}\n                className=\"pl-10 border-brand-blue/20 focus:border-brand-blue focus:ring-brand-blue\"\n              />\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Liste des conversations */}\n      <div className=\"space-y-3\">\n        {filteredConversations && filteredConversations.length > 0 ? (\n          filteredConversations.map((conversation: any) => {\n            const name = getConversationName(conversation)\n            const avatar = getConversationAvatar(conversation)\n            const unreadCount = getUnreadCount(conversation)\n            // Le last_message peut être un objet ou un tableau selon la requête Supabase\n            const lastMessage = Array.isArray(conversation.last_message)\n              ? conversation.last_message[0]\n              : conversation.last_message\n\n            return (\n              <div key={conversation.id}>\n                <Card className=\"group border-brand-blue/10 hover:border-brand-blue/30 hover:shadow-lg transition-all duration-300 hover:scale-[1.02] cursor-pointer bg-gradient-to-br from-white to-brand-blue-ghost/20\">\n                  <CardContent className=\"p-5\">\n                    <div className=\"flex items-center gap-4\">\n                      <Link href={`/dashboard/messages/${conversation.id}`} className=\"flex-1 flex items-center gap-4\">\n                        {/* Avatar */}\n                        <div className=\"flex-shrink-0 relative\">\n                          {avatar ? (\n                            <img\n                              src={avatar}\n                              alt={name}\n                              className=\"h-14 w-14 rounded-full object-cover ring-2 ring-brand-blue/20 group-hover:ring-brand-blue/40 transition-all\"\n                            />\n                          ) : (\n                            <div className=\"h-14 w-14 rounded-full bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost flex items-center justify-center ring-2 ring-brand-blue/20 group-hover:ring-brand-blue/40 transition-all\">\n                              {conversation.conversation_type === 'group' ? (\n                                <Users className=\"h-7 w-7 text-brand-blue\" />\n                              ) : (\n                                <MessageSquare className=\"h-7 w-7 text-brand-cyan\" />\n                              )}\n                            </div>\n                          )}\n                          {unreadCount > 0 && (\n                            <div className=\"absolute -top-1 -right-1 h-5 w-5 bg-brand-cyan rounded-full flex items-center justify-center shadow-lg\">\n                              <span className=\"text-white text-xs font-bold\">{unreadCount}</span>\n                            </div>\n                          )}\n                        </div>\n\n                        {/* Contenu */}\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center justify-between mb-2\">\n                            <h3 className=\"font-semibold text-gray-900 truncate text-lg group-hover:text-brand-blue transition-colors\">\n                              {name}\n                            </h3>\n                            {conversation.last_message_at && (\n                              <span className=\"text-xs text-gray-500 flex-shrink-0 ml-2 font-medium\">\n                                {formatRelativeTime(conversation.last_message_at)}\n                              </span>\n                            )}\n                          </div>\n                          {lastMessage && (\n                            <div className=\"flex items-center gap-2\">\n                              <p className=\"text-sm text-gray-600 truncate\">\n                                <span className=\"font-medium text-gray-700\">\n                                  {lastMessage.sender?.full_name || lastMessage.sender?.email ||\n                                   (lastMessage.student_sender ?\n                                     `${lastMessage.student_sender.first_name || ''} ${lastMessage.student_sender.last_name || ''}`.trim() ||\n                                     lastMessage.student_sender.email ||\n                                     `Candidat ${lastMessage.student_sender.student_number || ''}` :\n                                     'Expéditeur')}\n                                </span>\n                                :{' '}\n                                {lastMessage.content}\n                              </p>\n                            </div>\n                          )}\n                          {conversation.conversation_type === 'group' && conversation.participants && (\n                            <div className=\"flex items-center gap-1.5 mt-1.5\">\n                              <Users className=\"h-3.5 w-3.5 text-brand-cyan\" />\n                              <p className=\"text-xs text-gray-500 font-medium\">\n                                {conversation.participants.length} participants\n                              </p>\n                            </div>\n                          )}\n                        </div>\n                      </Link>\n\n                      {/* Actions */}\n                      <div className=\"flex-shrink-0\" onClick={(e) => e.stopPropagation()}>\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"hover:bg-brand-blue-ghost\" onClick={(e) => e.stopPropagation()}>\n                              <MoreVertical className=\"h-4 w-4\" />\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"end\">\n                            <DropdownMenuItem\n                              onClick={(e) => {\n                                e.preventDefault()\n                                e.stopPropagation()\n                                if (confirm('Êtes-vous sûr de vouloir supprimer cette conversation ?')) {\n                                  deleteConversationMutation.mutate(conversation.id)\n                                }\n                              }}\n                              disabled={deleteConversationMutation.isPending}\n                              className=\"text-destructive focus:text-destructive\"\n                            >\n                              <Trash2 className=\"mr-2 h-4 w-4\" />\n                              Supprimer\n                            </DropdownMenuItem>\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </div>\n            )\n          })\n        ) : (\n          <Card className=\"border-brand-blue/20 bg-gradient-to-br from-brand-blue-ghost/30 to-brand-cyan-ghost/30\">\n            <CardContent className=\"py-16\">\n              <div className=\"text-center space-y-4\">\n                <div className=\"relative inline-block\">\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <div className=\"w-24 h-24 bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost rounded-full opacity-50 blur-2xl\"></div>\n                  </div>\n                  <div className=\"relative p-6 bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost rounded-2xl inline-block\">\n                    <MessageSquare className=\"h-16 w-16 mx-auto text-brand-blue\" />\n                  </div>\n                </div>\n                <div className=\"space-y-2\">\n                  <h3 className=\"text-xl font-semibold text-gray-900\">\n                    {searchQuery ? 'Aucune conversation trouvée' : 'Aucune conversation'}\n                  </h3>\n                  <p className=\"text-gray-600\">\n                    {searchQuery\n                      ? 'Essayez de modifier votre recherche'\n                      : 'Commencez une nouvelle conversation pour échanger avec vos collègues et candidats'}\n                  </p>\n                </div>\n                {!searchQuery && (\n                  <Button\n                    onClick={() => setShowNewConversationDialog(true)}\n                    className=\"mt-4 bg-gradient-to-r from-brand-blue to-brand-cyan hover:from-brand-blue-dark hover:to-brand-cyan shadow-md hover:shadow-lg transition-all\"\n                  >\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Créer une conversation\n                  </Button>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n\n      {/* Dialog pour créer une nouvelle conversation */}\n      <Dialog \n        open={showNewConversationDialog} \n        onOpenChange={(open) => {\n          setShowNewConversationDialog(open)\n          if (!open) resetDialogState()\n        }}\n      >\n        <DialogContent className=\"sm:max-w-[600px]\">\n          <DialogHeader>\n            <DialogTitle>Nouvelle conversation</DialogTitle>\n            <DialogDescription>\n              Choisissez le type de conversation que vous souhaitez créer\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-4 mt-4\">\n            {/* Sélection du type de conversation */}\n            <div className=\"grid grid-cols-2 gap-4\">\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setConversationType('personal')\n                  setSelectedSessionId('')\n                  setSelectedStudentId('')\n                }}\n                className={`group p-5 border-2 rounded-xl transition-all duration-300 ${\n                  conversationType === 'personal'\n                    ? 'border-brand-blue bg-gradient-to-br from-brand-blue-ghost to-brand-blue-ghost/50 shadow-md scale-105'\n                    : 'border-gray-200 hover:border-brand-blue/40 hover:bg-brand-blue-ghost/30'\n                }`}\n              >\n                <div className={`p-2.5 rounded-lg mb-3 inline-flex ${\n                  conversationType === 'personal'\n                    ? 'bg-brand-blue/20'\n                    : 'bg-brand-blue/10 group-hover:bg-brand-blue/20'\n                }`}>\n                  <MessageSquare className=\"h-6 w-6 text-brand-blue\" />\n                </div>\n                <h3 className=\"font-semibold mb-1 text-gray-900\">Message personnel</h3>\n                <p className=\"text-sm text-gray-600\">\n                  Envoyer un message à un candidat spécifique\n                </p>\n              </button>\n              <button\n                type=\"button\"\n                onClick={() => {\n                  setConversationType('group')\n                  setSelectedStudentId('')\n                }}\n                className={`group p-5 border-2 rounded-xl transition-all duration-300 ${\n                  conversationType === 'group'\n                    ? 'border-brand-cyan bg-gradient-to-br from-brand-cyan-ghost to-brand-cyan-ghost/50 shadow-md scale-105'\n                    : 'border-gray-200 hover:border-brand-cyan/40 hover:bg-brand-cyan-ghost/30'\n                }`}\n              >\n                <div className={`p-2.5 rounded-lg mb-3 inline-flex ${\n                  conversationType === 'group'\n                    ? 'bg-brand-cyan/20'\n                    : 'bg-brand-cyan/10 group-hover:bg-brand-cyan/20'\n                }`}>\n                  <Users className=\"h-6 w-6 text-brand-cyan\" />\n                </div>\n                <h3 className=\"font-semibold mb-1 text-gray-900\">Message groupé</h3>\n                <p className=\"text-sm text-gray-600\">\n                  Envoyer un message à tous les candidats d'une session\n                </p>\n              </button>\n            </div>\n\n            {/* Sélection de la session */}\n            <div>\n              <label className=\"block text-sm font-medium mb-2\">\n                Session {conversationType === 'group' ? '*' : '(optionnel)'}\n              </label>\n              {isLoadingSessions ? (\n                <div className=\"flex items-center justify-center py-4\">\n                  <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n                </div>\n              ) : (\n                <select\n                  value={selectedSessionId}\n                  onChange={(e) => {\n                    setSelectedSessionId(e.target.value)\n                    setSelectedStudentId('')\n                  }}\n                  required={conversationType === 'group'}\n                  className=\"w-full px-4 py-2 rounded-lg border focus:ring-2 focus:ring-brand-blue focus:border-transparent\"\n                >\n                  <option value=\"\">Sélectionner une session</option>\n                  {sessions?.map((session: any) => (\n                    <option key={session.id} value={session.id}>\n                      {session.name} {session.formations?.name ? `- ${session.formations.name}` : ''}\n                    </option>\n                  ))}\n                </select>\n              )}\n            </div>\n\n            {/* Pour message personnel : sélection du candidat */}\n            {conversationType === 'personal' && selectedSessionId && (\n              <div>\n                <label className=\"block text-sm font-medium mb-2\">Candidat *</label>\n                {isLoadingStudents ? (\n                  <div className=\"flex items-center justify-center py-4\">\n                    <Loader2 className=\"h-5 w-5 animate-spin text-muted-foreground\" />\n                  </div>\n                ) : sessionStudents && sessionStudents.length > 0 ? (\n                  <div className=\"max-h-[300px] overflow-y-auto space-y-2 border rounded-lg p-2\">\n                    {sessionStudents.map((item: any) => {\n                      const student = item.student\n                      const displayName = `${student?.first_name || ''} ${student?.last_name || ''}`.trim() ||\n                                        student?.email ||\n                                        `Candidat ${student?.student_number || ''}`\n                      const displayEmail = student?.email\n\n                      return (\n                        <button\n                          key={student?.id}\n                          type=\"button\"\n                          onClick={() => {\n                            const studentId = student?.id || null\n                            if (studentId) {\n                              createDirectConversationMutation.mutate({ userId: undefined, studentId })\n                            } else {\n                              addToast({\n                                type: 'error',\n                                title: 'Erreur',\n                                description: 'Impossible de trouver l\\'identifiant de ce candidat.',\n                              })\n                            }\n                          }}\n                          disabled={createDirectConversationMutation.isPending || !student?.id}\n                          className=\"group w-full flex items-center gap-3 p-3 rounded-xl transition-all duration-300 text-left hover:bg-gradient-to-br hover:from-brand-blue-ghost hover:to-brand-cyan-ghost cursor-pointer border border-transparent hover:border-brand-blue/20 hover:shadow-md\"\n                          title=\"Cliquer pour démarrer une conversation\"\n                        >\n                          <div className=\"h-10 w-10 rounded-full bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost flex items-center justify-center group-hover:scale-110 transition-transform\">\n                            <Users className=\"h-5 w-5 text-brand-blue\" />\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <p className=\"font-medium truncate text-gray-900 group-hover:text-brand-blue transition-colors\">{displayName}</p>\n                            {displayEmail && (\n                              <p className=\"text-sm text-gray-600 truncate\">\n                                {displayEmail}\n                              </p>\n                            )}\n                            {student?.student_number && (\n                              <p className=\"text-xs text-gray-500\">\n                                N°: {student.student_number}\n                              </p>\n                            )}\n                          </div>\n                          {createDirectConversationMutation.isPending && (\n                            <Loader2 className=\"h-4 w-4 animate-spin text-brand-blue\" />\n                          )}\n                        </button>\n                      )\n                    })}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-4 text-muted-foreground text-sm\">\n                    Aucun candidat trouvé dans cette session\n                  </div>\n                )}\n              </div>\n            )}\n\n            {/* Pour message groupé : bouton de création */}\n            {conversationType === 'group' && selectedSessionId && (\n              <div className=\"flex justify-end\">\n                <Button\n                  onClick={() => createGroupConversationMutation.mutate()}\n                  disabled={createGroupConversationMutation.isPending || !selectedSessionId}\n                  className=\"bg-gradient-to-r from-brand-cyan to-brand-blue hover:from-brand-cyan-dark hover:to-brand-blue-dark shadow-md hover:shadow-lg transition-all\"\n                >\n                  {createGroupConversationMutation.isPending ? (\n                    <>\n                      <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                      Création...\n                    </>\n                  ) : (\n                    <>\n                      <Users className=\"mr-2 h-4 w-4\" />\n                      Créer la conversation de groupe\n                    </>\n                  )}\n                </Button>\n              </div>\n            )}\n\n            {/* Fallback : liste des utilisateurs si pas de session sélectionnée pour message personnel */}\n            {conversationType === 'personal' && !selectedSessionId && (\n              <>\n                <div className=\"relative\">\n                  <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                  <Input\n                    type=\"text\"\n                    placeholder=\"Rechercher un utilisateur...\"\n                    value={userSearchQuery}\n                    onChange={(e) => setUserSearchQuery(e.target.value)}\n                    className=\"pl-10\"\n                  />\n                </div>\n\n                <div className=\"max-h-[300px] overflow-y-auto space-y-2\">\n                  {isLoadingUsers ? (\n                    <div className=\"flex items-center justify-center py-8\">\n                      <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n                    </div>\n                  ) : organizationUsers && organizationUsers.length > 0 ? (\n                    organizationUsers\n                      .filter((u) => {\n                        if (!userSearchQuery) return true\n                        const searchLower = userSearchQuery.toLowerCase()\n                        return (\n                          (u as any).full_name?.toLowerCase().includes(searchLower) ||\n                          (u as any).email?.toLowerCase().includes(searchLower)\n                        )\n                      })\n                      .map((orgUser) => (\n                        <button\n                          key={(orgUser as any).id}\n                          onClick={() => createDirectConversationMutation.mutate((orgUser as any).id)}\n                          disabled={createDirectConversationMutation.isPending}\n                          className=\"group w-full flex items-center gap-3 p-3 rounded-xl hover:bg-gradient-to-br hover:from-brand-blue-ghost hover:to-brand-cyan-ghost transition-all duration-300 text-left border border-transparent hover:border-brand-blue/20 hover:shadow-md\"\n                        >\n                          {(orgUser as any).avatar_url ? (\n                            <img\n                              src={(orgUser as any).avatar_url}\n                              alt={(orgUser as any).full_name || (orgUser as any).email}\n                              className=\"h-10 w-10 rounded-full object-cover ring-2 ring-brand-blue/20 group-hover:ring-brand-blue/40 transition-all\"\n                            />\n                          ) : (\n                            <div className=\"h-10 w-10 rounded-full bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost flex items-center justify-center group-hover:scale-110 transition-transform\">\n                              <Users className=\"h-5 w-5 text-brand-blue\" />\n                            </div>\n                          )}\n                          <div className=\"flex-1 min-w-0\">\n                            <p className=\"font-medium truncate text-gray-900 group-hover:text-brand-blue transition-colors\">\n                              {(orgUser as any).full_name || (orgUser as any).email}\n                            </p>\n                            {(orgUser as any).full_name && (\n                              <p className=\"text-sm text-gray-600 truncate\">\n                                {(orgUser as any).email}\n                              </p>\n                            )}\n                            {(orgUser as any).role && (\n                              <p className=\"text-xs text-gray-500 capitalize\">\n                                {(orgUser as any).role}\n                              </p>\n                            )}\n                          </div>\n                          {createDirectConversationMutation.isPending && (\n                            <Loader2 className=\"h-4 w-4 animate-spin text-brand-blue\" />\n                          )}\n                        </button>\n                      ))\n                  ) : (\n                    <div className=\"text-center py-8 text-muted-foreground\">\n                      {userSearchQuery\n                        ? 'Aucun utilisateur trouvé'\n                        : 'Aucun utilisateur disponible'}\n                    </div>\n                  )}\n                </div>\n              </>\n            )}\n          </div>\n        </DialogContent>\n      </Dialog>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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"}