module.exports=[52943,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(908403),i=a.i(371791),j=a.i(269240),k=a.i(340695),l=a.i(219897),m=a.i(806368),n=a.i(915618),o=a.i(587532),p=a.i(104720),q=a.i(290821),r=a.i(495756),s=a.i(724669),t=a.i(633508),u=a.i(790166),v=a.i(501199),w=a.i(911156),x=a.i(922520),y=a.i(172162),z=a.i(653277),A=a.i(405784),B=a.i(767552),C=a.i(497895),D=a.i(238246),E=a.i(457431),F=a.i(677924),G=a.i(264321),H=a.i(427165),I=a.i(467149),J=a.i(758042),K=a.i(994222),L=a.i(54419),M=a.i(659854),N=a.i(902274),O=a.i(48662);a.i(460355);var P=a.i(346271),Q=a.i(262036),R=a.i(491829);function S(){return(0,b.jsx)(R.RoleGuard,{allowedRoles:R.FINANCE_ROLES,children:(0,b.jsx)(T,{})})}function T(){let{user:a}=(0,g.useAuth)(),R=(0,j.createClient)(),S=(0,f.useQueryClient)(),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)("all"),[X,Y]=(0,c.useState)("all"),[Z,$]=(0,c.useState)(!1),[_,aa]=(0,c.useState)("all"),[ab,ac]=(0,c.useState)("all"),[ad,ae]=(0,c.useState)(!1),[af,ag]=(0,c.useState)(!1),[ah,ai]=(0,c.useState)(""),{data:aj}=(0,d.useQuery)({queryKey:["sessions",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)return[];let{data:b,error:c}=await R.from("sessions").select("id, name, start_date, end_date").eq("organization_id",a.organization_id).order("start_date",{ascending:!1}).limit(100);return c?(console.error("Erreur rÃ©cupÃ©ration sessions:",c),[]):b||[]},enabled:!!a?.organization_id}),{data:ak}=(0,d.useQuery)({queryKey:["charge-categories",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)return[];let b=await i.sessionChargesService.getCategories(a.organization_id);return 0===b.length?(await i.sessionChargesService.initDefaultCategories(a.organization_id),i.sessionChargesService.getCategories(a.organization_id)):b},enabled:!!a?.organization_id}),{data:al,isLoading:am}=(0,d.useQuery)({queryKey:["all-session-charges",a?.organization_id],queryFn:async()=>a?.organization_id?await i.sessionChargesService.getAll(a.organization_id):[],enabled:!!a?.organization_id&&ad}),[an,ao]=(0,c.useState)({description:"",amount:"",currency:"EUR",charge_date:new Date().toISOString().split("T")[0],category_id:"",payment_method:"",payment_status:"pending",vendor:"",vendor_invoice_number:"",vendor_invoice_date:"",notes:""}),ap=(0,e.useMutation)({mutationFn:async()=>{if(!a?.organization_id)throw Error("Organisation non trouvÃ©e");if(!ah)throw Error("Veuillez sÃ©lectionner une session");if(!an.description||!an.amount)throw Error("La description et le montant sont requis");return i.sessionChargesService.create(a.organization_id,ah,{description:an.description,amount:parseFloat(an.amount),currency:an.currency,charge_date:an.charge_date,category_id:an.category_id||null,payment_method:an.payment_method||null,payment_status:an.payment_status,paid_at:"paid"===an.payment_status?new Date().toISOString():null,vendor:an.vendor||null,vendor_invoice_number:an.vendor_invoice_number||null,vendor_invoice_date:an.vendor_invoice_date||null,notes:an.notes||null})},onSuccess:()=>{S.invalidateQueries({queryKey:["session-charges"]}),S.invalidateQueries({queryKey:["session-charges-summary"]}),S.invalidateQueries({queryKey:["all-session-charges",a?.organization_id]}),ag(!1),ao({description:"",amount:"",currency:"EUR",charge_date:new Date().toISOString().split("T")[0],category_id:"",payment_method:"",payment_status:"pending",vendor:"",vendor_invoice_number:"",vendor_invoice_date:"",notes:""}),ai("")}}),aq=(0,e.useMutation)({mutationFn:async a=>h.invoiceService.convertQuoteToInvoice(a),onSuccess:()=>{S.invalidateQueries({queryKey:["invoices"]}),S.invalidateQueries({queryKey:["overdue-invoices"]})}}),{data:ar,isLoading:as}=(0,d.useQuery)({queryKey:["invoices",a?.organization_id,T,V,_],queryFn:async()=>{if(!a?.organization_id)return[];try{return await h.invoiceService.getAll(a.organization_id,{search:T,status:"all"!==V?V:void 0,documentType:"all"!==_?_:void 0})}catch(a){if(a?.code==="PGRST116"||a?.code==="42P01")return[];throw a}},enabled:!!a?.organization_id,retry:!1}),at=ar?.filter(a=>"quotes"===ab?"quote"===a.document_type:"invoices"!==ab||"invoice"===a.document_type||!a.document_type)||[],{data:au}=(0,d.useQuery)({queryKey:["overdue-invoices",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)return[];try{return await h.invoiceService.getOverdue(a.organization_id)}catch(a){if(a?.code==="PGRST116"||a?.code==="42P01")return[];throw a}},enabled:!!a?.organization_id,retry:!1}),{data:av}=(0,d.useQuery)({queryKey:["payment-stats",a?.organization_id,X],queryFn:async()=>{if(!a?.organization_id)return null;let b=null,c=new Date;switch(X){case"month":b=new Date(c.getFullYear(),c.getMonth(),1);break;case"quarter":let d=Math.floor(c.getMonth()/3);b=new Date(c.getFullYear(),3*d,1);break;case"year":b=new Date(c.getFullYear(),0,1);break;default:b=null}let e=R.from("payments").select("amount, currency, payment_method, paid_at").eq("organization_id",a.organization_id).eq("status","completed");b&&(e=e.gte("paid_at",b.toISOString()));let{data:f,error:g}=await e;if(g){if("PGRST116"===g.code||"42P01"===g.code||"PGRST301"===g.code||"400"===g.code||g.message?.includes("relation")||g.message?.includes("relationship")||g.message?.includes("does not exist")||g.message?.includes("schema cache")||g.message?.includes("column")||g.message?.includes("permission"))return console.warn("Erreur lors de la rÃ©cupÃ©ration des paiements:",g.message),{totalAmount:0,count:0,byMethod:[],monthlyData:[]};throw g}let h=f||[],i=h.reduce((a,b)=>a+Number(b.amount),0),j={};h.forEach(a=>{let b=a.payment_method||"unknown";j[b]=(j[b]||0)+Number(a.amount)});let k={};h.forEach(a=>{if(a.paid_at){let b=new Date(a.paid_at),c=`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}`;k[c]=(k[c]||0)+Number(a.amount)}});let l=Object.entries(k).sort(([a],[b])=>a.localeCompare(b)).slice(-6).map(([a,b])=>({month:new Date(a+"-01").toLocaleDateString("fr-FR",{month:"short",year:"numeric"}),amount:Math.round(b)})),m=Object.entries(j).map(([a,b])=>({name:"cash"===a?"EspÃ¨ces":"mobile_money"===a?"Mobile Money":"card"===a?"Carte":"bank_transfer"===a?"Virement":a,value:Math.round(b),color:"cash"===a?"#335ACF":"mobile_money"===a?"#34B9EE":"card"===a?"#3B82F6":"bank_transfer"===a?"#8B5CF6":"#6B7280"}));return{totalAmount:i,count:f?.length||0,byMethod:m,monthlyData:l}},enabled:!!a?.organization_id}),aw=ar?.filter(a=>"invoice"===a.document_type||!a.document_type)||[],ax=aw.filter(a=>"paid"===a.status).reduce((a,b)=>a+Number(b.total_amount),0)||0,ay=au?.reduce((a,b)=>a+Number(b.total_amount)-Number(b.paid_amount||0),0)||0,az=aw.filter(a=>["sent","partial"].includes(a.status)).reduce((a,b)=>{let c=b.paid_amount||0;return a+Number(b.total_amount)-Number(c)},0)||0,aA={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5,ease:[.16,1,.3,1]}}};return(0,b.jsxs)(P.motion.div,{className:"space-y-8 pb-12 max-w-[1600px] mx-auto",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",children:[(0,b.jsxs)(P.motion.div,{variants:aA,className:"relative",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-mesh opacity-30 rounded-3xl"}),(0,b.jsxs)("div",{className:"relative flex flex-col md:flex-row items-start md:items-center justify-between gap-6 p-8 rounded-3xl bg-white/50 backdrop-blur-sm border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,b.jsx)(P.motion.div,{className:"p-3 rounded-2xl bg-gradient-to-br from-brand-blue to-brand-cyan",whileHover:{scale:1.05,rotate:5},transition:{duration:.3},children:(0,b.jsx)(u.DollarSign,{className:"h-6 w-6 text-white"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-5xl font-black text-gray-900 tracking-tightest font-display",children:"Paiements"}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mt-2",children:[(0,b.jsxs)("span",{className:"px-4 py-1.5 bg-brand-blue-ghost text-brand-blue rounded-full text-sm font-semibold",children:[at.length," documents"]}),(0,b.jsx)("span",{className:"text-sm text-gray-400",children:"â€¢"}),(0,b.jsxs)("span",{className:"text-sm text-gray-500 font-medium",children:[(0,C.formatCurrency)(ax+az+ay,"EUR")," au total"]})]})]})]}),(0,b.jsx)("p",{className:"text-lg text-gray-600 font-light ml-[72px]",children:"GÃ©rez vos devis, factures et suivez les paiements en temps rÃ©el"})]}),(0,b.jsx)(P.motion.div,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},children:(0,b.jsx)(D.default,{href:"/dashboard/payments/new",children:(0,b.jsxs)(k.Button,{className:"h-14 px-8 text-base font-semibold shadow-2xl shadow-brand-blue/20 hover:shadow-brand-blue/40 bg-gradient-to-r from-brand-blue to-brand-cyan hover:opacity-90 transition-all duration-300",children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-5 w-5"}),"Nouvelle transaction"]})})})]})]}),(0,b.jsx)(P.motion.div,{variants:aA,children:(0,b.jsx)(m.BentoGrid,{columns:4,gap:"md",children:[{title:"Total payÃ©",value:(0,C.formatCurrency)(ax,"EUR"),icon:r.CheckCircle,color:"text-emerald-600",bg:"bg-gradient-to-br from-emerald-50 to-emerald-100/50",borderColor:"border-emerald-200",trend:"+12%",trendUp:!0},{title:"En attente",value:(0,C.formatCurrency)(az,"EUR"),icon:q.AlertCircle,color:"text-amber-600",bg:"bg-gradient-to-br from-amber-50 to-amber-100/50",borderColor:"border-amber-200",trend:"-5%",trendUp:!1},{title:"En retard",value:(0,C.formatCurrency)(ay,"EUR"),icon:t.X,color:"text-red-600",bg:"bg-gradient-to-br from-red-50 to-red-100/50",borderColor:"border-red-200",trend:"-15%",trendUp:!1},{title:"Total factures",value:aw.length.toString(),icon:v.Receipt,color:"text-brand-blue",bg:"bg-gradient-to-br from-brand-blue-ghost to-brand-blue-pale/50",borderColor:"border-brand-blue-pale",trend:"+8%",trendUp:!0}].map((a,c)=>(0,b.jsx)(m.BentoCard,{span:1,children:(0,b.jsx)(P.motion.div,{whileHover:{y:-8,scale:1.02},transition:{duration:.4,ease:[.16,1,.3,1]},children:(0,b.jsxs)(l.GlassCard,{variant:"premium",hoverable:!0,glow:2===c&&ay>0,glowColor:"rgba(239, 68, 68, 0.2)",className:(0,C.cn)("h-full p-8 border-2",a.borderColor,a.bg),children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1",children:a.title}),(0,b.jsx)("div",{className:(0,C.cn)("text-3xl font-black tracking-tighter font-display mt-2",a.color),children:a.value})]}),(0,b.jsx)(P.motion.div,{className:(0,C.cn)("p-4 rounded-2xl shadow-lg",a.bg),whileHover:{scale:1.15,rotate:10},transition:{duration:.3},children:(0,b.jsx)(a.icon,{className:(0,C.cn)("h-6 w-6",a.color)})})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200/50",children:[(0,b.jsxs)(P.motion.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1*c+.3,type:"spring"},className:(0,C.cn)("flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold",a.trendUp?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"),children:[a.trendUp?"â†—":"â†˜"," ",a.trend]}),(0,b.jsx)("span",{className:"text-xs text-gray-500 font-medium",children:"vs mois dernier"})]})]})})},a.title))})}),(0,b.jsx)(P.motion.div,{variants:aA,children:(0,b.jsxs)(l.GlassCard,{variant:"default",className:"p-4 shadow-xl",children:[(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 items-center justify-between",children:[(0,b.jsx)("div",{className:"relative flex p-1.5 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl w-full lg:w-auto shadow-inner",children:["all","quotes","invoices"].map(a=>(0,b.jsxs)(P.motion.button,{onClick:()=>ac(a),className:(0,C.cn)("relative px-8 py-3 rounded-xl text-sm font-semibold transition-all duration-300 flex-1 lg:flex-none",ab===a?"text-white":"text-gray-600 hover:text-gray-900"),whileHover:{scale:ab!==a?1.05:1},whileTap:{scale:.98},children:[ab===a&&(0,b.jsx)(P.motion.div,{layoutId:"activeTabBg",className:"absolute inset-0 bg-gradient-to-r from-brand-blue to-brand-cyan rounded-xl shadow-lg",transition:{duration:.4,ease:[.16,1,.3,1]}}),(0,b.jsx)("span",{className:"relative z-10",children:"all"===a?"Tous":"quotes"===a?"Devis":"Factures"})]},a))}),(0,b.jsxs)("div",{className:"flex flex-1 w-full lg:w-auto gap-3",children:[(0,b.jsxs)("div",{className:"relative flex-1 group",children:[(0,b.jsx)(o.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-brand-blue transition-all duration-300 group-focus-within:scale-110"}),(0,b.jsx)("input",{type:"text",placeholder:"Rechercher un document...",value:T,onChange:a=>U(a.target.value),className:"w-full pl-12 pr-4 py-3 rounded-xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-brand-blue/30 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm font-medium placeholder:text-gray-400"})]}),(0,b.jsx)(P.motion.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,b.jsxs)(k.Button,{variant:"ghost",onClick:()=>$(!Z),className:(0,C.cn)("h-12 px-5 gap-2 rounded-xl font-semibold transition-all duration-300",Z?"bg-brand-blue text-white shadow-lg shadow-brand-blue/30":"bg-gray-50 text-gray-700 hover:bg-gray-100"),children:[(0,b.jsx)(y.SlidersHorizontal,{className:"h-4 w-4"}),"Filtres"]})})]})]}),(0,b.jsx)(Q.AnimatePresence,{children:Z&&(0,b.jsx)(P.motion.div,{initial:{height:0,opacity:0,y:-20},animate:{height:"auto",opacity:1,y:0},exit:{height:0,opacity:0,y:-20},transition:{duration:.4,ease:[.16,1,.3,1]},className:"overflow-hidden",children:(0,b.jsxs)("div",{className:"pt-6 mt-6 grid grid-cols-1 md:grid-cols-3 gap-5 border-t border-gray-200",children:[(0,b.jsxs)(P.motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"space-y-2",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 text-xs font-bold text-gray-700 uppercase tracking-widest",children:[(0,b.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-blue"}),"Statut"]}),(0,b.jsxs)("select",{value:V,onChange:a=>W(a.target.value),className:"w-full px-4 py-3 rounded-xl bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 focus:border-brand-blue/50 focus:ring-4 focus:ring-brand-blue/10 outline-none text-sm font-medium transition-all shadow-sm",children:[(0,b.jsx)("option",{value:"all",children:"Tous les statuts"}),(0,b.jsx)("option",{value:"paid",children:"âœ“ PayÃ©e"}),(0,b.jsx)("option",{value:"sent",children:"â†’ EnvoyÃ©e"}),(0,b.jsx)("option",{value:"partial",children:"âš¡ Partielle"}),(0,b.jsx)("option",{value:"overdue",children:"âš  En retard"}),(0,b.jsx)("option",{value:"draft",children:"ðŸ“ Brouillon"})]})]}),(0,b.jsxs)(P.motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"space-y-2",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 text-xs font-bold text-gray-700 uppercase tracking-widest",children:[(0,b.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-cyan"}),"PÃ©riode"]}),(0,b.jsxs)("select",{value:X,onChange:a=>Y(a.target.value),className:"w-full px-4 py-3 rounded-xl bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 focus:border-brand-cyan/50 focus:ring-4 focus:ring-brand-cyan/10 outline-none text-sm font-medium transition-all shadow-sm",children:[(0,b.jsx)("option",{value:"all",children:"Toutes les pÃ©riodes"}),(0,b.jsx)("option",{value:"month",children:"ðŸ“… Ce mois"}),(0,b.jsx)("option",{value:"quarter",children:"ðŸ“Š Ce trimestre"}),(0,b.jsx)("option",{value:"year",children:"ðŸ“† Cette annÃ©e"})]})]}),(0,b.jsxs)(P.motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},className:"space-y-2",children:[(0,b.jsxs)("label",{className:"flex items-center gap-2 text-xs font-bold text-gray-700 uppercase tracking-widest",children:[(0,b.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),"Type de document"]}),(0,b.jsxs)("select",{value:_,onChange:a=>aa(a.target.value),className:"w-full px-4 py-3 rounded-xl bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 focus:border-emerald-500/50 focus:ring-4 focus:ring-emerald-500/10 outline-none text-sm font-medium transition-all shadow-sm",children:[(0,b.jsx)("option",{value:"all",children:"Tous les types"}),(0,b.jsx)("option",{value:"quote",children:"ðŸ“„ Devis"}),(0,b.jsx)("option",{value:"invoice",children:"ðŸ§¾ Factures"})]})]})]})})})]})}),av&&(av.byMethod.length>0||av.monthlyData.length>0)&&(0,b.jsxs)(P.motion.div,{variants:aA,className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[av.byMethod.length>0&&(0,b.jsx)(P.motion.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.6,ease:[.16,1,.3,1]},children:(0,b.jsxs)(l.GlassCard,{variant:"premium",className:"p-8 h-full border-2 border-gray-100 shadow-xl hover:shadow-2xl transition-all duration-500",children:[(0,b.jsx)("div",{className:"mb-8 flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(P.motion.div,{className:"p-3 rounded-2xl bg-gradient-to-br from-brand-blue-ghost to-brand-blue-pale",whileHover:{scale:1.1,rotate:5},children:(0,b.jsx)(w.CreditCard,{className:"h-6 w-6 text-brand-blue"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xl font-black text-gray-900 tracking-tight font-display",children:"MÃ©thodes de paiement"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 font-medium",children:"RÃ©partition par type"})]})]})}),(0,b.jsxs)("div",{className:"h-[340px] relative",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-mesh opacity-20 rounded-2xl"}),(0,b.jsx)(O.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(G.PieChart,{children:[(0,b.jsx)(H.Pie,{data:av.byMethod,cx:"50%",cy:"50%",innerRadius:70,outerRadius:100,paddingAngle:6,dataKey:"value",children:av.byMethod.map((a,c)=>(0,b.jsx)(I.Cell,{fill:a.color},`cell-${c}`))}),(0,b.jsx)(M.Tooltip,{formatter:a=>(0,C.formatCurrency)(Number(a),"EUR"),contentStyle:{borderRadius:"16px",border:"none",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",padding:"12px 16px",fontWeight:"600"}}),(0,b.jsx)(N.Legend,{verticalAlign:"bottom",height:48,wrapperStyle:{fontSize:"14px",fontWeight:"600"}})]})})]})]})}),av.monthlyData.length>0&&(0,b.jsx)(P.motion.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1,ease:[.16,1,.3,1]},children:(0,b.jsxs)(l.GlassCard,{variant:"premium",className:"p-8 h-full border-2 border-gray-100 shadow-xl hover:shadow-2xl transition-all duration-500",children:[(0,b.jsx)("div",{className:"mb-8 flex items-center justify-between",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(P.motion.div,{className:"p-3 rounded-2xl bg-gradient-to-br from-cyan-50 to-cyan-100",whileHover:{scale:1.1,rotate:5},children:(0,b.jsx)(s.TrendingUp,{className:"h-6 w-6 text-brand-cyan"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-xl font-black text-gray-900 tracking-tight font-display",children:"Ã‰volution des paiements"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 font-medium",children:"6 derniers mois"})]})]})}),(0,b.jsxs)("div",{className:"h-[340px] relative",children:[(0,b.jsx)("div",{className:"absolute inset-0 bg-gradient-aurora opacity-20 rounded-2xl"}),(0,b.jsx)(O.ResponsiveContainer,{width:"100%",height:"100%",children:(0,b.jsxs)(E.LineChart,{data:av.monthlyData,children:[(0,b.jsx)(L.CartesianGrid,{strokeDasharray:"5 5",vertical:!1,stroke:"#E5E7EB"}),(0,b.jsx)(J.XAxis,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fill:"#6B7280",fontSize:12,fontWeight:"600"},dy:12}),(0,b.jsx)(K.YAxis,{axisLine:!1,tickLine:!1,tick:{fill:"#6B7280",fontSize:12,fontWeight:"600"},dx:-10}),(0,b.jsx)(M.Tooltip,{formatter:a=>(0,C.formatCurrency)(Number(a),"EUR"),contentStyle:{borderRadius:"16px",border:"none",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",padding:"12px 16px",fontWeight:"600"}}),(0,b.jsx)(F.Line,{type:"monotone",dataKey:"amount",stroke:"url(#colorGradient)",strokeWidth:4,dot:{fill:"#34B9EE",r:5,strokeWidth:3,stroke:"#fff"},activeDot:{r:7,strokeWidth:0,fill:"#274472"}}),(0,b.jsx)("defs",{children:(0,b.jsxs)("linearGradient",{id:"colorGradient",x1:"0",y1:"0",x2:"1",y2:"0",children:[(0,b.jsx)("stop",{offset:"0%",stopColor:"#274472"}),(0,b.jsx)("stop",{offset:"100%",stopColor:"#34B9EE"})]})})]})})]})]})})]}),(0,b.jsx)(P.motion.div,{variants:aA,children:as?(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5",children:[...Array(8)].map((a,c)=>(0,b.jsx)(P.motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05*c},className:"h-64 bg-gradient-to-br from-gray-50 to-gray-100 rounded-3xl animate-pulse"},c))}):0===at.length?(0,b.jsx)(l.GlassCard,{variant:"premium",className:"p-16 text-center border-2 border-dashed border-gray-200",children:(0,b.jsxs)(P.motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:[(0,b.jsx)("div",{className:"w-24 h-24 bg-gradient-to-br from-gray-50 to-gray-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner",children:(0,b.jsx)(v.Receipt,{className:"h-12 w-12 text-gray-300"})}),(0,b.jsx)("h3",{className:"text-2xl font-black text-gray-900 mb-3 font-display",children:"Aucun document trouvÃ©"}),(0,b.jsx)("p",{className:"text-lg text-gray-500 mb-8 max-w-md mx-auto",children:T||"all"!==V||"all"!==_?"Essayez de modifier vos filtres de recherche.":"Commencez par crÃ©er votre premier document de paiement."}),!T&&"all"===V&&"all"===_&&(0,b.jsx)(P.motion.div,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.98},children:(0,b.jsx)(D.default,{href:"/dashboard/payments/new",children:(0,b.jsxs)(k.Button,{className:"h-12 px-8 text-base font-semibold shadow-lg",children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-5 w-5"}),"CrÃ©er un document"]})})})]})}):(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5",children:(0,b.jsx)(Q.AnimatePresence,{mode:"popLayout",children:at.map((a,c)=>{let d="quote"===a.document_type,e=a.students;return(0,b.jsx)(P.motion.div,{layout:!0,initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-20},transition:{delay:.04*c,duration:.4,ease:[.16,1,.3,1]},children:(0,b.jsx)(D.default,{href:`/dashboard/payments/${a.id}`,children:(0,b.jsx)(P.motion.div,{whileHover:{y:-8,scale:1.02},transition:{duration:.3},children:(0,b.jsxs)(l.GlassCard,{variant:"premium",hoverable:!0,className:"h-full p-6 group flex flex-col justify-between relative overflow-hidden border-2 border-gray-100 hover:border-brand-blue/30 transition-all duration-300",children:[d&&(0,b.jsx)("div",{className:"absolute top-0 right-0 bg-gradient-to-br from-blue-100 to-blue-200 text-blue-700 text-[10px] font-bold px-3 py-1.5 rounded-bl-2xl uppercase tracking-widest shadow-sm",children:"Devis"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-5",children:[(0,b.jsx)(P.motion.div,{whileHover:{scale:1.15,rotate:8},transition:{duration:.3},className:(0,C.cn)("h-14 w-14 rounded-2xl flex items-center justify-center shadow-lg",d?"bg-gradient-to-br from-blue-50 to-blue-100 text-blue-600":"bg-gradient-to-br from-brand-blue-ghost to-brand-blue-pale text-brand-blue"),children:d?(0,b.jsx)(p.FileText,{className:"h-6 w-6"}):(0,b.jsx)(v.Receipt,{className:"h-6 w-6"})}),(0,b.jsx)("span",{className:(0,C.cn)("px-3 py-1.5 rounded-xl text-xs font-bold border-2 shadow-sm",(a=>{switch(a){case"paid":return"bg-emerald-50 text-emerald-700 border-emerald-100";case"sent":return"bg-blue-50 text-blue-700 border-blue-100";case"partial":return"bg-amber-50 text-amber-700 border-amber-100";case"overdue":return"bg-red-50 text-red-700 border-red-100";default:return"bg-gray-50 text-gray-700 border-gray-100"}})(a.status||"draft")),children:(a=>{switch(a){case"paid":return"PayÃ©e";case"sent":return"EnvoyÃ©e";case"partial":return"Partielle";case"overdue":return"En retard";case"draft":return"Brouillon";case"cancelled":return"AnnulÃ©e";default:return a}})(a.status||"draft")})]}),(0,b.jsxs)("div",{className:"mb-5",children:[(0,b.jsx)("h3",{className:"text-lg font-black text-gray-900 truncate group-hover:text-brand-blue transition-colors font-display tracking-tight",children:a.invoice_number||"Brouillon"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1.5 font-medium",children:e?`${e.first_name} ${e.last_name}`:"Client inconnu"})]}),(0,b.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[(0,b.jsx)("span",{className:"text-gray-500 font-medium",children:"Montant"}),(0,b.jsx)("span",{className:"text-lg font-black text-brand-blue font-display",children:(0,C.formatCurrency)(Number(a.total_amount),a.currency||"EUR")})]}),a.issue_date&&(0,b.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,b.jsx)("span",{className:"text-gray-400 font-medium",children:"Date d'Ã©mission"}),(0,b.jsx)("span",{className:"text-gray-600 font-semibold",children:(0,C.formatDate)(a.issue_date)})]})]})]}),(0,b.jsxs)("div",{className:"mt-6 pt-5 border-t-2 border-gray-100 flex items-center justify-between",children:[d?(0,b.jsx)(k.Button,{variant:"ghost",size:"sm",className:"h-9 text-xs font-semibold hover:text-brand-blue hover:bg-brand-blue-ghost -ml-2 px-3",onClick:b=>{b.preventDefault(),aq.mutate(a.id)},disabled:aq.isPending,children:"Convertir en facture"}):(0,b.jsx)("span",{className:"text-xs text-gray-400 font-medium",children:"Voir les dÃ©tails"}),(0,b.jsx)(P.motion.div,{whileHover:{x:2,y:-2},transition:{duration:.2},children:(0,b.jsx)(x.ArrowUpRight,{className:"h-5 w-5 text-gray-300 group-hover:text-brand-blue transition-colors"})})]})]})})})},a.id)})})})}),(0,b.jsx)(P.motion.div,{variants:aA,children:(0,b.jsxs)(l.GlassCard,{variant:"default",className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(z.TrendingDown,{className:"h-5 w-5 text-red-600"}),(0,b.jsx)("h3",{className:"font-bold text-gray-900",children:"Charges de session"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>{ag(!0),ae(!0)},children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"}),"Nouvelle charge"]}),(0,b.jsx)(k.Button,{variant:"ghost",size:"icon",onClick:()=>ae(!ad),children:ad?(0,b.jsx)(B.ChevronUp,{className:"h-4 w-4"}):(0,b.jsx)(A.ChevronDown,{className:"h-4 w-4"})})]})]}),ad&&(0,b.jsxs)("div",{className:"space-y-4",children:[af&&(0,b.jsxs)("div",{className:"border rounded-lg p-6 bg-gray-50",children:[(0,b.jsx)("h4",{className:"font-semibold mb-4",children:"CrÃ©er une nouvelle charge"}),(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),ap.mutate()},className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Session *"}),(0,b.jsxs)("select",{required:!0,value:ah,onChange:a=>ai(a.target.value),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"SÃ©lectionner une session"}),aj?.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," (",a.start_date?new Date(a.start_date).toLocaleDateString("fr-FR"):"N/A",")"]},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Description *"}),(0,b.jsx)("input",{type:"text",required:!0,value:an.description,onChange:a=>ao({...an,description:a.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"Ex: Location de salle pour la formation"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant *"}),(0,b.jsx)("input",{type:"number",required:!0,step:"0.01",min:"0.01",value:an.amount,onChange:a=>ao({...an,amount:a.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"0.00"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Devise"}),(0,b.jsxs)("select",{value:an.currency,onChange:a=>ao({...an,currency:a.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,b.jsx)("option",{value:"EUR",children:"EUR"}),(0,b.jsx)("option",{value:"USD",children:"USD"}),(0,b.jsx)("option",{value:"XOF",children:"XOF"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date *"}),(0,b.jsx)("input",{type:"date",required:!0,value:an.charge_date,onChange:a=>ao({...an,charge_date:a.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"CatÃ©gorie"}),(0,b.jsxs)("select",{value:an.category_id,onChange:a=>ao({...an,category_id:a.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"SÃ©lectionner une catÃ©gorie"}),ak?.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"MÃ©thode de paiement"}),(0,b.jsxs)("select",{value:an.payment_method,onChange:a=>ao({...an,payment_method:a.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"Non spÃ©cifiÃ©"}),(0,b.jsx)("option",{value:"cash",children:"EspÃ¨ces"}),(0,b.jsx)("option",{value:"bank_transfer",children:"Virement bancaire"}),(0,b.jsx)("option",{value:"card",children:"Carte bancaire"}),(0,b.jsx)("option",{value:"mobile_money",children:"Mobile Money"}),(0,b.jsx)("option",{value:"check",children:"ChÃ¨que"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Statut de paiement"}),(0,b.jsxs)("select",{value:an.payment_status,onChange:a=>ao({...an,payment_status:a.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,b.jsx)("option",{value:"pending",children:"En attente"}),(0,b.jsx)("option",{value:"paid",children:"PayÃ©"}),(0,b.jsx)("option",{value:"cancelled",children:"AnnulÃ©"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Fournisseur"}),(0,b.jsx)("input",{type:"text",value:an.vendor,onChange:a=>ao({...an,vendor:a.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"Nom du fournisseur/prestataire"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"NÂ° facture fournisseur"}),(0,b.jsx)("input",{type:"text",value:an.vendor_invoice_number,onChange:a=>ao({...an,vendor_invoice_number:a.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"NÂ° de facture"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date facture fournisseur"}),(0,b.jsx)("input",{type:"date",value:an.vendor_invoice_date,onChange:a=>ao({...an,vendor_invoice_date:a.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,b.jsx)("textarea",{value:an.notes,onChange:a=>ao({...an,notes:a.target.value}),rows:3,className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"Notes supplÃ©mentaires..."})]}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)(k.Button,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{ag(!1),ai("")},children:"Annuler"}),(0,b.jsx)(k.Button,{type:"submit",className:"flex-1",disabled:ap.isPending,children:ap.isPending?"CrÃ©ation...":"CrÃ©er la charge"})]})]})]}),!af&&(0,b.jsx)("div",{className:"space-y-4",children:am?(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent"}),(0,b.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Chargement des charges..."})]}):al&&al.length>0?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("h4",{className:"font-semibold text-gray-900",children:[al.length," charge",al.length>1?"s":""," enregistrÃ©e",al.length>1?"s":""]}),(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",onClick:()=>ag(!0),children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"}),"Ajouter une charge"]})]}),(0,b.jsx)("div",{className:"space-y-2",children:al.map(a=>{let c=a.sessions,d=a.charge_categories,e={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",paid:"bg-green-100 text-green-800 border-green-200",cancelled:"bg-red-100 text-red-800 border-red-200"};return(0,b.jsx)("div",{className:"border rounded-lg p-4 bg-white hover:shadow-md transition-shadow",children:(0,b.jsx)("div",{className:"flex items-start justify-between",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)("h5",{className:"font-semibold text-gray-900",children:a.description}),(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs font-medium border ${e[a.payment_status]||e.pending}`,children:"pending"===a.payment_status?"En attente":"paid"===a.payment_status?"PayÃ©":"AnnulÃ©"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium",children:"Montant:"})," ",(0,b.jsx)("span",{className:"font-bold text-gray-900",children:(0,C.formatCurrency)(Number(a.amount),a.currency||"EUR")})]}),c&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium",children:"Session:"})," ",(0,b.jsx)("span",{className:"text-gray-900",children:c.name})]}),d&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium",children:"CatÃ©gorie:"})," ",(0,b.jsx)("span",{className:"text-gray-900",children:d.name})]}),a.charge_date&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium",children:"Date:"})," ",(0,b.jsx)("span",{className:"text-gray-900",children:(0,C.formatDate)(a.charge_date)})]})]}),a.vendor&&(0,b.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,b.jsx)("span",{className:"font-medium",children:"Fournisseur:"})," ",(0,b.jsx)("span",{className:"text-gray-900",children:a.vendor})]}),a.notes&&(0,b.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,b.jsx)("span",{className:"font-medium",children:"Notes:"})," ",(0,b.jsx)("span",{className:"text-gray-900",children:a.notes})]})]})})},a.id)})})]}):(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(z.TrendingDown,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{children:"GÃ©rez les charges (dÃ©penses) associÃ©es aux sessions de formation."}),(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>ag(!0),children:[(0,b.jsx)(n.Plus,{className:"mr-2 h-4 w-4"}),"Ajouter une charge"]})]})})]})]})})]})}a.s(["default",()=>S])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_payments_page_tsx_fb42a717._.js.map