module.exports=[366389,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(433217),f=a.i(370025),g=a.i(937927),h=a.i(913216),i=a.i(266275),j=a.i(703130),k=a.i(340695),l=a.i(495756),m=a.i(65151),n=a.i(50522),o=a.i(613749),p=a.i(238246),q=a.i(762180);function r(){let a=(0,d.useParams)(),r=(0,d.useRouter)(),s=a.slug,{user:t}=(0,h.useAuth)(),u=(0,g.useQueryClient)(),[v,w]=(0,c.useState)(0),{data:x}=(0,e.useQuery)({queryKey:["course",s,t?.organization_id],queryFn:async()=>await i.elearningService.getCourseBySlug(s,t?.organization_id||""),enabled:!!s&&!!t?.organization_id}),{data:y}=(0,e.useQuery)({queryKey:["course-enrollment",x?.id,t?.id],queryFn:async()=>x?.id&&t?.id?(await i.elearningService.getStudentEnrollments(t.id)).find(a=>a.course_id===x.id):null,enabled:!!x?.id&&!!t?.id}),{data:z}=(0,e.useQuery)({queryKey:["lessons-progress",x?.id,t?.id],queryFn:async()=>{if(!x?.lessons||!t?.id)return{};let a={};for(let b of x.lessons){let c=await i.elearningService.getLessonProgress(b.id,t.id);c&&(a[b.id]=c)}return a},enabled:!!x?.lessons&&x.lessons.length>0&&!!t?.id}),A=(0,f.useMutation)({mutationFn:async a=>{if(!t?.id)throw Error("Non authentifié");return i.elearningService.markLessonAsCompleted(a,t.id)},onSuccess:()=>{u.invalidateQueries({queryKey:["lessons-progress"]}),u.invalidateQueries({queryKey:["course-enrollment"]})}});if((0,f.useMutation)({mutationFn:async({lessonId:a,percentage:b})=>{if(!t?.id)throw Error("Non authentifié");return i.elearningService.updateLessonProgress(a,t.id,{completion_percentage:b})},onSuccess:()=>{u.invalidateQueries({queryKey:["lessons-progress"]})}}),(0,c.useEffect)(()=>{if(x?.lessons&&x.lessons.length>0&&!y?.last_accessed_lesson_id){let a=x.lessons[0];r.push(`/dashboard/elearning/courses/${s}/lessons/${a.slug}`)}else if(y?.last_accessed_lesson_id){let a=x?.lessons?.findIndex(a=>a.id===y.last_accessed_lesson_id);void 0!==a&&a>=0&&w(a)}},[x,y,s,r]),!x||!y)return(0,b.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:(0,b.jsx)("div",{className:"text-center py-12",children:"Chargement..."})});let B=x.lessons||[],C=B[v],D=a=>z?.[a]?.is_completed||!1;return(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)(p.default,{href:`/dashboard/elearning/courses/${s}`,children:(0,b.jsxs)(k.Button,{variant:"ghost",size:"sm",className:"mb-4",children:[(0,b.jsx)(o.ChevronLeft,{className:"h-4 w-4 mr-2"}),"Retour au cours"]})}),(0,b.jsx)("h1",{className:"text-2xl font-bold",children:x.title}),(0,b.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-sm text-muted-foreground",children:[(0,b.jsxs)("span",{children:["Progression: ",Math.round(y?.progress_percentage||0),"%"]}),(0,b.jsxs)("span",{children:[y?.completed_lessons?.length||0," / ",B.length," leçons complétées"]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,b.jsx)("div",{className:"lg:col-span-3",children:C?(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(j.CardTitle,{children:C.title}),C.description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:C.description})]}),(0,b.jsxs)(j.CardContent,{children:[C.video_url&&(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)("div",{className:"aspect-video bg-black rounded-lg overflow-hidden",children:(0,b.jsx)("iframe",{src:C.video_url,className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0})})}),C.content&&(0,b.jsx)("div",{className:"prose prose-sm max-w-none mb-6",children:(0,b.jsx)(q.default,{children:C.content})}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t",children:[(0,b.jsxs)(k.Button,{variant:"outline",onClick:()=>{if(v>0){let a=B[v-1];r.push(`/dashboard/elearning/courses/${s}/lessons/${a.slug}`)}},disabled:0===v,children:[(0,b.jsx)(o.ChevronLeft,{className:"h-4 w-4 mr-2"}),"Leçon précédente"]}),(0,b.jsxs)(k.Button,{onClick:()=>{if(D(C.id)||A.mutate(C.id),v<B.length-1){let a=B[v+1];r.push(`/dashboard/elearning/courses/${s}/lessons/${a.slug}`)}},disabled:v===B.length-1,children:[D(C.id)?"Leçon suivante":"Marquer comme complété",(0,b.jsx)(n.ChevronRight,{className:"h-4 w-4 ml-2"})]})]})]})]}):(0,b.jsx)(j.Card,{children:(0,b.jsx)(j.CardContent,{className:"pt-6 text-center text-muted-foreground",children:"Aucune leçon disponible"})})}),(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsxs)(j.Card,{className:"sticky top-4",children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsx)(j.CardTitle,{className:"text-lg",children:"Leçons"})}),(0,b.jsx)(j.CardContent,{children:(0,b.jsx)("div",{className:"space-y-2",children:B.map((a,c)=>{let d=D(a.id);return(0,b.jsx)(p.default,{href:`/dashboard/elearning/courses/${s}/lessons/${a.slug}`,children:(0,b.jsxs)("button",{className:`w-full text-left p-2 rounded-lg transition-colors ${c===v?"bg-primary text-white":d?"bg-green-50 text-green-800 hover:bg-green-100":"bg-gray-50 hover:bg-gray-100"}`,children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[d?(0,b.jsx)(l.CheckCircle,{className:"h-4 w-4 flex-shrink-0"}):(0,b.jsx)(m.Circle,{className:"h-4 w-4 flex-shrink-0"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:[c+1,". ",a.title]})]}),a.video_duration_minutes&&(0,b.jsxs)("p",{className:"text-xs mt-1 opacity-70",children:[a.video_duration_minutes," min"]})]})},a.id)})})})]})})]})]})}a.s(["default",()=>r])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_elearning_courses_%5Bslug%5D_learn_page_tsx_96afdad9._.js.map