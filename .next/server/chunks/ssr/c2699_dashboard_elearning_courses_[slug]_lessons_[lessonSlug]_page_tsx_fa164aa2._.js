module.exports=[755510,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(433217),f=a.i(370025),g=a.i(937927),h=a.i(913216),i=a.i(266275),j=a.i(703130),k=a.i(340695),l=a.i(219897),m=a.i(400210),n=a.i(495756),o=a.i(65151),p=a.i(50522),q=a.i(613749),r=a.i(953722),s=a.i(539833),t=a.i(255225),u=a.i(683245),v=a.i(104720),w=a.i(238246),x=a.i(762180);a.i(460355);var y=a.i(346271),z=a.i(497895);function A(){let a=(0,d.useParams)();(0,d.useRouter)();let A=a.slug,B=a.lessonSlug,{user:C}=(0,h.useAuth)(),D=(0,g.useQueryClient)(),E=(0,c.useRef)(null),[F,G]=(0,c.useState)([]),[H,I]=(0,c.useState)({}),[J,K]=(0,c.useState)({}),{data:L}=(0,e.useQuery)({queryKey:["course",A,C?.organization_id],queryFn:async()=>await i.elearningService.getCourseBySlug(A,C?.organization_id||""),enabled:!!A&&!!C?.organization_id}),{data:M,isLoading:N}=(0,e.useQuery)({queryKey:["lesson",A,B],queryFn:async()=>{if(!L?.id)throw Error("Course ID manquant");return await i.elearningService.getLessonBySlug(B,L.id)},enabled:!!L?.id&&!!B});(0,c.useEffect)(()=>{if(M?.content)try{let a=JSON.parse(M.content);Array.isArray(a)?G(a):G([{id:"1",type:"text",data:{content:M.content}}])}catch(a){M.content&&G([{id:"1",type:"text",data:{content:M.content}}])}},[M]);let{data:O,refetch:P}=(0,e.useQuery)({queryKey:["lesson-progress",M?.id,C?.id],queryFn:async()=>await i.elearningService.getLessonProgress(M?.id||"",C?.id||""),enabled:!!M?.id&&!!C?.id});(0,c.useEffect)(()=>{if(O){let a=O.quiz_responses||{},b=O.poll_votes||{},c={};Object.entries(a).forEach(([a,b])=>{c[a]=b.answer}),I(c);let d={};Object.entries(b).forEach(([a,b])=>{d[a]=b.option_id}),K(d)}},[O]);let Q=(0,f.useMutation)({mutationFn:async a=>{if(M?.id&&C?.id)return i.elearningService.updateLessonProgress(M.id,C.id,{completion_percentage:a})},onSuccess:()=>{D.invalidateQueries({queryKey:["lesson-progress"]}),D.invalidateQueries({queryKey:["course-enrollment"]})}}),R=(0,f.useMutation)({mutationFn:async()=>{if(M?.id&&C?.id)return i.elearningService.markLessonAsCompleted(M.id,C.id)},onSuccess:()=>{D.invalidateQueries({queryKey:["lesson-progress"]}),D.invalidateQueries({queryKey:["course-enrollment"]})}});(0,c.useEffect)(()=>{let a=E.current;if(!a||M?.lesson_type!=="video")return;let b=()=>{if(a.duration){let b=a.currentTime/a.duration*100;Q.mutate(b)}};return a.addEventListener("timeupdate",b),()=>a.removeEventListener("timeupdate",b)},[M,Q]);let S=L?.lessons||[],T=S.findIndex(a=>a.id===M?.id),U=T>0?S[T-1]:null,V=T<S.length-1?S[T+1]:null,W=O?.is_completed||!1,X=["super_admin","admin","secretary","teacher"].includes(C?.role||""),Y=L?.scores_enabled!==!1,Z=(0,f.useMutation)({mutationFn:async({blockId:a,answer:b,type:c})=>{if(!M?.id)throw Error("Lesson ID manquant");let d=await fetch(`/api/elearning/lessons/${M.id}/responses`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({block_id:a,answer:b,type:c})});if(!d.ok)throw Error((await d.json()).error||"Erreur lors de la sauvegarde");return d.json()},onSuccess:()=>{P(),D.invalidateQueries({queryKey:["lesson-progress",M?.id]})}});return N||!L?(0,b.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:(0,b.jsx)("div",{className:"text-center py-12",children:"Chargement..."})}):M?(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,b.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,b.jsx)(w.default,{href:`/dashboard/elearning/courses/${A}`,children:(0,b.jsxs)(k.Button,{variant:"ghost",size:"sm",children:[(0,b.jsx)(m.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour au cours"]})}),X&&(0,b.jsx)(w.default,{href:`/dashboard/elearning/courses/${A}/lessons/${B}/edit`,children:(0,b.jsxs)(k.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(u.Edit,{className:"h-4 w-4 mr-2"}),"Modifier"]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,b.jsx)("div",{className:"lg:col-span-3",children:(0,b.jsxs)(l.GlassCard,{variant:"premium",className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:M.title}),M.description&&(0,b.jsx)("p",{className:"text-gray-600",children:M.description})]}),W&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-green-600",children:[(0,b.jsx)(n.CheckCircle,{className:"h-5 w-5"}),(0,b.jsx)("span",{className:"text-sm font-medium",children:"Complété"})]})]}),M.video_url&&(0,b.jsx)("div",{className:"mb-8",children:(0,b.jsx)("div",{className:"aspect-video bg-black rounded-lg overflow-hidden shadow-lg",children:M.video_url.includes("youtube.com")||M.video_url.includes("youtu.be")?(0,b.jsx)("iframe",{src:M.video_url.replace("watch?v=","embed/").replace("youtu.be/","youtube.com/embed/"),className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):(0,b.jsx)("video",{ref:E,src:M.video_url,controls:!0,className:"w-full h-full"})})}),(0,b.jsx)("div",{className:"space-y-6",children:F.length>0?F.map((a,c)=>((a,c)=>{switch(a.type){case"text":return(0,b.jsx)(y.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*c},className:"prose prose-sm max-w-none mb-6 p-4 bg-gray-50 rounded-lg",children:(0,b.jsx)(x.default,{children:a.data.content||""})},a.id);case"media":return(0,b.jsx)(y.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*c},className:"mb-6",children:(0,b.jsxs)(l.GlassCard,{variant:"premium",className:"p-4",children:["image"===a.data.mediaType&&a.data.mediaUrl&&(0,b.jsxs)("div",{children:[(0,b.jsx)("img",{src:a.data.mediaUrl,alt:a.data.caption||"Média",className:"w-full rounded-lg mb-2"}),a.data.caption&&(0,b.jsx)("p",{className:"text-sm text-gray-600 italic text-center",children:a.data.caption})]}),"video"===a.data.mediaType&&a.data.mediaUrl&&(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"aspect-video bg-black rounded-lg overflow-hidden",children:a.data.mediaUrl.includes("youtube.com")||a.data.mediaUrl.includes("youtu.be")?(0,b.jsx)("iframe",{src:a.data.mediaUrl.replace("watch?v=","embed/").replace("youtu.be/","youtube.com/embed/"),className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):(0,b.jsx)("video",{src:a.data.mediaUrl,controls:!0,className:"w-full h-full"})}),a.data.caption&&(0,b.jsx)("p",{className:"text-sm text-gray-600 italic text-center mt-2",children:a.data.caption})]}),"audio"===a.data.mediaType&&a.data.mediaUrl&&(0,b.jsxs)("div",{children:[(0,b.jsx)("audio",{src:a.data.mediaUrl,controls:!0,className:"w-full"}),a.data.caption&&(0,b.jsx)("p",{className:"text-sm text-gray-600 italic text-center mt-2",children:a.data.caption})]}),"file"===a.data.mediaType&&a.data.mediaUrl&&(0,b.jsxs)("div",{className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg",children:[(0,b.jsx)(v.FileText,{className:"h-8 w-8 text-brand-blue"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium",children:a.data.caption||"Fichier"}),(0,b.jsx)("a",{href:a.data.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-brand-blue hover:underline",children:"Télécharger"})]})]})]})},a.id);case"quiz":let d=H[a.id];return(0,b.jsx)(y.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*c},className:"mb-6",children:(0,b.jsxs)(l.GlassCard,{variant:"premium",className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)(s.HelpCircle,{className:"h-5 w-5 text-brand-blue"}),(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:Y?"Quiz (évaluable)":"Quiz"}),Y&&a.data.points&&(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:["(",a.data.points," point",a.data.points>1?"s":"",")"]})]}),(0,b.jsx)("p",{className:"text-gray-700 mb-4 font-medium",children:a.data.question}),(0,b.jsx)("div",{className:"space-y-2 mb-4",children:a.data.options?.map(c=>{let e=d===c.id,f=c.isCorrect;return(0,b.jsx)("button",{onClick:()=>{var b,d;return b=a.id,d=c.id,void(I({...H,[b]:d}),Z.mutate({blockId:b,answer:d,type:"quiz"}))},className:(0,z.cn)("w-full text-left p-3 border rounded-lg transition-all",e?Y?f?"bg-green-50 border-green-500 text-green-900":"bg-red-50 border-red-500 text-red-900":"bg-brand-blue-ghost border-brand-blue text-brand-blue":"bg-white border-gray-200 hover:border-brand-blue hover:bg-brand-blue-ghost"),children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:(0,z.cn)("w-4 h-4 rounded-full border-2 flex items-center justify-center",e?Y?f?"border-green-500 bg-green-500":"border-red-500 bg-red-500":"border-brand-blue bg-brand-blue":"border-gray-300"),children:e&&(0,b.jsx)(n.CheckCircle,{className:"h-3 w-3 text-white"})}),(0,b.jsx)("span",{children:c.text}),Y&&e&&f&&(0,b.jsx)(n.CheckCircle,{className:"h-4 w-4 text-green-600 ml-auto"})]})},c.id)})}),Y&&d&&a.data.explanation&&(0,b.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,b.jsxs)("p",{className:"text-sm text-blue-900",children:[(0,b.jsx)("strong",{children:"Explication :"})," ",a.data.explanation]})})]})},a.id);case"poll":let e=J[a.id];return(0,b.jsx)(y.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*c},className:"mb-6",children:(0,b.jsxs)(l.GlassCard,{variant:"premium",className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)(t.BarChart3,{className:"h-5 w-5 text-brand-blue"}),(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"Sondage (non évaluable)"})]}),(0,b.jsx)("p",{className:"text-gray-700 mb-4 font-medium",children:a.data.pollQuestion}),(0,b.jsx)("div",{className:"space-y-2",children:a.data.pollOptions?.map(c=>{let d=e===c.id;return(0,b.jsx)("button",{onClick:()=>{var b,d;return b=a.id,d=c.id,void(K({...J,[b]:d}),Z.mutate({blockId:b,answer:d,type:"poll"}))},disabled:!!e,className:(0,z.cn)("w-full text-left p-3 border rounded-lg transition-all",d?"bg-brand-blue-ghost border-brand-blue text-brand-blue":"bg-white border-gray-200 hover:border-brand-blue hover:bg-brand-blue-ghost",e&&!d&&"opacity-50 cursor-not-allowed"),children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:(0,z.cn)("w-4 h-4 rounded-full border-2",d?"border-brand-blue bg-brand-blue":"border-gray-300")}),(0,b.jsx)("span",{children:c.text}),d&&(0,b.jsx)(n.CheckCircle,{className:"h-4 w-4 text-brand-blue ml-auto"})]})},c.id)})})]})},a.id);default:return null}})(a,c)):(0,b.jsx)("div",{className:"text-center py-12 text-gray-500",children:(0,b.jsx)("p",{children:"Aucun contenu disponible pour cette leçon"})})}),M.attachments&&Array.isArray(M.attachments)&&M.attachments.length>0&&(0,b.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[(0,b.jsx)("h3",{className:"font-semibold mb-4 text-gray-900",children:"Ressources supplémentaires"}),(0,b.jsx)("div",{className:"space-y-2",children:M.attachments.map((a,c)=>(0,b.jsxs)("a",{href:a.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,b.jsx)(r.BookOpen,{className:"h-4 w-4 text-brand-blue"}),(0,b.jsx)("span",{className:"text-sm",children:a.filename||"Télécharger"})]},c))})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-6 mt-6 border-t border-gray-200",children:[(0,b.jsx)("div",{children:U&&(0,b.jsx)(w.default,{href:`/dashboard/elearning/courses/${A}/lessons/${U.slug}`,children:(0,b.jsxs)(k.Button,{variant:"outline",children:[(0,b.jsx)(q.ChevronLeft,{className:"h-4 w-4 mr-2"}),"Leçon précédente"]})})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[!W&&(0,b.jsxs)(k.Button,{onClick:()=>R.mutate(),disabled:R.isPending,className:"bg-brand-blue hover:bg-brand-blue/90 text-white",children:[(0,b.jsx)(n.CheckCircle,{className:"h-4 w-4 mr-2"}),"Marquer comme complété"]}),V&&(0,b.jsx)(w.default,{href:`/dashboard/elearning/courses/${A}/lessons/${V.slug}`,children:(0,b.jsxs)(k.Button,{className:"bg-brand-blue hover:bg-brand-blue/90 text-white",children:["Leçon suivante",(0,b.jsx)(p.ChevronRight,{className:"h-4 w-4 ml-2"})]})}),!V&&(0,b.jsx)(w.default,{href:`/dashboard/elearning/courses/${A}`,children:(0,b.jsxs)(k.Button,{className:"bg-brand-blue hover:bg-brand-blue/90 text-white",children:["Retour au cours",(0,b.jsx)(p.ChevronRight,{className:"h-4 w-4 ml-2"})]})})]})]})]})}),(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsxs)(j.Card,{className:"sticky top-4",children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsx)(j.CardTitle,{className:"text-lg",children:"Leçons"})}),(0,b.jsx)(j.CardContent,{children:(0,b.jsx)("div",{className:"space-y-2",children:S.map((a,c)=>{let d=a.id===M.id;return(0,b.jsx)(w.default,{href:`/dashboard/elearning/courses/${A}/lessons/${a.slug}`,children:(0,b.jsxs)("button",{className:(0,z.cn)("w-full text-left p-2 rounded-lg transition-colors",d?"bg-brand-blue text-white":"bg-gray-50 hover:bg-gray-100"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Circle,{className:"h-4 w-4 flex-shrink-0"}),(0,b.jsxs)("span",{className:"text-sm font-medium",children:[c+1,". ",a.title]})]}),a.video_duration_minutes&&(0,b.jsxs)("p",{className:"text-xs mt-1 opacity-70",children:[a.video_duration_minutes," min"]})]})},a.id)})})})]})})]})]}):(0,b.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Leçon introuvable"}),(0,b.jsx)(w.default,{href:`/dashboard/elearning/courses/${A}`,children:(0,b.jsx)(k.Button,{variant:"outline",children:"Retour au cours"})})]})})}a.s(["default",()=>A])}];

//# sourceMappingURL=c2699_dashboard_elearning_courses_%5Bslug%5D_lessons_%5BlessonSlug%5D_page_tsx_fa164aa2._.js.map