module.exports=[224361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},814747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},992258,a=>{"use strict";let b=(0,a.i(170106).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);a.s(["Mail",()=>b],992258)},717371,a=>{"use strict";let b=(0,a.i(170106).default)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);a.s(["UserPlus",()=>b],717371)},193767,a=>{"use strict";let b=new class{async blobToBase64(a){return new Promise((b,c)=>{let d=new FileReader;d.onloadend=()=>{b(d.result.split(",")[1])},d.onerror=c,d.readAsDataURL(a)})}async sendEmail(a){try{let b=a.attachments?await Promise.all(a.attachments.map(async a=>{let b;if(a.content instanceof Blob)b=await this.blobToBase64(a.content);else if(a.content instanceof ArrayBuffer){let c=new Blob([a.content],{type:a.contentType});b=await this.blobToBase64(c)}else b=a.content;return{filename:a.filename,content:b,contentType:a.contentType}})):void 0,c=await fetch("/api/email/send",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({to:a.to,subject:a.subject,html:a.html,text:a.text,attachments:b,cc:a.cc,bcc:a.bcc,replyTo:a.replyTo})});if(!c.ok){let a=await c.json();throw Error(a.message||"Erreur lors de l'envoi de l'email")}let d=await c.json();return{success:!0,message:d.message||"Email envoyé avec succès"}}catch(a){throw Error(a instanceof Error?a.message:"Erreur lors de l'envoi de l'email")}}async sendDocument(a,b,c,d,e,f){return this.sendEmail({to:a,subject:b,html:e,text:f,attachments:[{filename:d,content:c,contentType:"application/pdf"}]})}async sendMultipleDocuments(a,b,c,d,e){return this.sendEmail({to:a,subject:b,html:d,text:e,attachments:c.map(a=>({filename:a.filename,content:a.blob,contentType:"application/pdf"}))})}};a.s(["emailService",0,b])},130755,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(703130),e=a.i(340695),f=a.i(284505),g=a.i(992258),h=a.i(717371),i=a.i(633508),j=a.i(104720),k=a.i(781560),l=a.i(497895),m=a.i(242255),n=a.i(965733),o=a.i(205522),p=a.i(546893),q=a.i(917171);function r({sessionId:a,sessionData:r,formation:s,program:t,organization:u,enrollments:v=[],students:w=[],showEnrollmentForm:x,enrollmentForm:y,onEnrollmentFormChange:z,onCreateEnrollment:A,createEnrollmentMutation:B,cancelEnrollmentMutation:C,onCloseEnrollmentForm:D,onShowEnrollmentForm:E,isGeneratingZip:F=!1,zipGenerationProgress:G={current:0,total:0},lastZipGeneration:H=null}){let{handleGenerateConvocation:I,handleGenerateAllConvocationsZip:J,handleSendConvocationByEmail:K,handleSendConvocationByEmailWithCustomContent:L,handleSendAllConvocationsByEmail:M,prepareConvocationEmail:N}=(0,m.useDocumentGeneration)({sessionData:r,formation:s,program:t,organization:u}),[O,P]=(0,c.useState)(null),[Q,R]=(0,c.useState)(null);return(0,b.jsxs)("div",{className:"space-y-6",children:[x&&(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(d.CardTitle,{children:"Inscrire un apprenant"}),(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:D,children:(0,b.jsx)(i.X,{className:"h-4 w-4"})})]})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),A()},className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Élève *"}),(0,b.jsxs)("select",{value:y.student_id,onChange:a=>z({...y,student_id:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",required:!0,children:[(0,b.jsx)("option",{value:"",children:"Sélectionner un élève"}),w.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.first_name," ",a.last_name," (",a.student_number,")"]},a.id))]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date d'inscription *"}),(0,b.jsx)("input",{type:"date",value:y.enrollment_date,onChange:a=>z({...y,enrollment_date:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Statut *"}),(0,b.jsxs)("select",{value:y.status||"pending",onChange:a=>z({...y,status:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,b.jsx)("option",{value:"pending",children:"En attente"}),(0,b.jsx)("option",{value:"confirmed",children:"Confirmée"}),(0,b.jsx)("option",{value:"completed",children:"Terminée"}),(0,b.jsx)("option",{value:"cancelled",children:"Annulée"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant total"}),(0,b.jsx)("input",{type:"number",step:"0.01",value:y.total_amount,onChange:a=>z({...y,total_amount:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant payé"}),(0,b.jsx)("input",{type:"number",step:"0.01",value:y.paid_amount,onChange:a=>z({...y,paid_amount:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Statut de paiement *"}),(0,b.jsxs)("select",{value:y.payment_status||"pending",onChange:a=>z({...y,payment_status:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,b.jsx)("option",{value:"pending",children:"En attente"}),(0,b.jsx)("option",{value:"partial",children:"Partiel"}),(0,b.jsx)("option",{value:"paid",children:"Payé"}),(0,b.jsx)("option",{value:"overdue",children:"En retard"})]})]}),B.error&&(0,b.jsx)("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-lg text-sm",children:B.error instanceof Error?B.error.message:"Une erreur est survenue"}),C.error&&(0,b.jsx)("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-lg text-sm",children:C.error instanceof Error?C.error.message:"Une erreur est survenue lors de l'annulation"}),(0,b.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,b.jsx)(e.Button,{type:"button",variant:"outline",onClick:D,children:"Annuler"}),(0,b.jsx)(e.Button,{type:"submit",disabled:B.isPending,children:B.isPending?"Inscription...":"Inscrire"})]})]})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{children:"Génération et envoi des convocations"})}),(0,b.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"p-4 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Convocations"}),H?(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Dernière génération : ",(0,l.formatDate)(H.toISOString())]}):(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Jamais généré"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>J(v),disabled:F||0===v.length,children:[(0,b.jsx)(f.Download,{className:"mr-2 h-4 w-4"}),F?`G\xe9n\xe9ration... (${G.current}/${G.total})`:"Générer un ZIP des convocations"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>M(v),disabled:0===v.length,children:[(0,b.jsx)(g.Mail,{className:"mr-2 h-4 w-4"}),"Envoyer par email"]})]})]}),F&&(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,b.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${G.total>0?G.current/G.total*100:0}%`}})}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1 text-center",children:["Génération en cours... ",G.current," sur ",G.total," convocations"]})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h4",{className:"font-medium",children:["Apprenants inscrits (",v.length,")"]}),!x&&(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:E,children:[(0,b.jsx)(h.UserPlus,{className:"mr-2 h-4 w-4"}),"Inscrire un apprenant"]})]}),0===v.length?(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground border rounded-lg",children:[(0,b.jsx)(j.FileText,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"Aucun apprenant inscrit pour le moment"}),(0,b.jsxs)(e.Button,{variant:"outline",className:"mt-4",onClick:E,children:[(0,b.jsx)(h.UserPlus,{className:"mr-2 h-4 w-4"}),"Inscrire le premier apprenant"]})]}):v.map(a=>{let c=a.students;return c?(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3 flex-1",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:(0,b.jsx)(j.FileText,{className:"h-5 w-5 text-primary"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("p",{className:"font-medium",children:[c.first_name," ",c.last_name]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[c.student_number,c.email&&` • ${c.email}`]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2 mt-1",children:[(0,b.jsx)("span",{className:`text-xs px-2 py-1 rounded ${"confirmed"===a.status?"bg-brand-blue-ghost text-brand-blue":"completed"===a.status?"bg-blue-100 text-blue-800":"cancelled"===a.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:"confirmed"===a.status?"Confirmé":"completed"===a.status?"Terminé":"cancelled"===a.status?"Annulé":"En attente"}),(0,b.jsx)("span",{className:`text-xs px-2 py-1 rounded ${"paid"===a.payment_status?"bg-brand-blue-ghost text-brand-blue":"partial"===a.payment_status?"bg-brand-cyan-ghost text-brand-cyan":"overdue"===a.payment_status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:"paid"===a.payment_status?"Payé":"partial"===a.payment_status?"Partiel":"overdue"===a.payment_status?"En retard":"En attente"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:["cancelled"!==a.status&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>I(a),title:"Générer la convocation",children:(0,b.jsx)(f.Download,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>{let b=N(a);b&&(P(b),R({to:b.to,subject:b.subject,body:b.body}))},title:"Envoyer par email",disabled:!c.email,children:(0,b.jsx)(g.Mail,{className:"h-4 w-4"})})]}),"cancelled"!==a.status&&"completed"!==a.status&&(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>{confirm(`\xcates-vous s\xfbr de vouloir annuler l'inscription de ${c.first_name} ${c.last_name} ?`)&&C.mutate(a.id)},disabled:C.isPending,title:"Annuler l'inscription",className:"text-danger-primary hover:text-danger-primary hover:bg-danger-bg",children:(0,b.jsx)(k.Trash2,{className:"h-4 w-4"})})]}),(0,b.jsx)(n.Dialog,{open:!!O,onOpenChange:a=>{a||(P(null),R(null))},children:(0,b.jsxs)(n.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(n.DialogHeader,{children:[(0,b.jsx)(n.DialogTitle,{children:"Aperçu de l'email"}),(0,b.jsx)(n.DialogDescription,{children:"Vérifiez le contenu et le destinataire avant d'envoyer"})]}),O&&Q&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{htmlFor:"email-to",children:"Destinataire"}),(0,b.jsx)(o.Input,{id:"email-to",type:"email",value:Q.to,onChange:a=>R({...Q,to:a.target.value}),className:"mt-1",placeholder:"email@example.com"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{htmlFor:"email-subject",children:"Sujet"}),(0,b.jsx)(o.Input,{id:"email-subject",type:"text",value:Q.subject,onChange:a=>R({...Q,subject:a.target.value}),className:"mt-1",placeholder:"Sujet de l'email"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(q.Label,{htmlFor:"email-body",children:"Contenu"}),(0,b.jsx)(p.Textarea,{id:"email-body",value:Q.body.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim(),onChange:a=>R({...Q,body:a.target.value}),className:"mt-1 min-h-[200px] font-mono text-sm",placeholder:"Contenu de l'email"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Le formatage HTML sera préservé lors de l'envoi"})]}),(0,b.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,b.jsxs)("p",{className:"text-xs text-blue-800",children:[(0,b.jsx)("strong",{children:"Pièce jointe :"})," Un PDF de la convocation sera joint à cet email."]})})]}),(0,b.jsxs)(n.DialogFooter,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>{P(null),R(null)},children:"Annuler"}),(0,b.jsxs)(e.Button,{onClick:async()=>{if(O&&Q){let a={...O.enrollment,students:{...O.enrollment.students,email:Q.to}};await L(a,Q.subject,Q.body),P(null),R(null)}},disabled:!Q?.to||!Q?.subject||!Q?.body,children:[(0,b.jsx)(g.Mail,{className:"h-4 w-4 mr-2"}),"Envoyer l'email"]})]})]})})]},a.id):null})]})]})]})]})}a.s(["GestionConvocations",()=>r])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__2bee6773._.js.map