module.exports=[989543,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(433217),f=a.i(370025),g=a.i(937927),h=a.i(269240),i=a.i(337130),j=a.i(555074),k=a.i(913216),l=a.i(340695),m=a.i(703130),n=a.i(400210),o=a.i(915618),p=a.i(941675),q=a.i(641710),r=a.i(124987),s=a.i(660246),t=a.i(633508),u=a.i(717371),v=a.i(238246),w=a.i(497895);function x(){let a=(0,d.useParams)();(0,d.useRouter)();let x=a.id,y=(0,h.createClient)(),z=(0,g.useQueryClient)(),{user:A}=(0,k.useAuth)(),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)({student_id:"",enrollment_date:new Date().toISOString().split("T")[0],status:"confirmed",payment_status:"pending",total_amount:"",paid_amount:"0"}),{data:H}=(0,e.useQuery)({queryKey:["formation",x],queryFn:()=>i.formationService.getFormationById(x)}),{data:I,isLoading:J,refetch:K}=(0,e.useQuery)({queryKey:["formation-sessions",x],queryFn:()=>i.formationService.getSessionsByFormation(x)}),{data:L}=(0,e.useQuery)({queryKey:["teachers"],queryFn:async()=>{let{data:a,error:b}=await y.from("users").select("id, full_name").eq("role","teacher").eq("is_active",!0);if(b)throw b;return a||[]}}),{data:M}=(0,e.useQuery)({queryKey:["students",A?.organization_id],queryFn:async()=>{if(!A?.organization_id)return[];let{data:a,error:b}=await y.from("students").select("id, first_name, last_name, student_number, email").eq("organization_id",A.organization_id).eq("status","active").order("last_name",{ascending:!0});if(b)throw b;return a||[]},enabled:!!A?.organization_id}),{data:N}=(0,e.useQuery)({queryKey:["enrollments-for-session",D],queryFn:async()=>{if(!D)return[];let{data:a,error:b}=await y.from("enrollments").select("student_id").eq("session_id",D);if(b)throw b;return a||[]},enabled:!!D&&B}),O=M?.filter(a=>!N?.some(b=>b.student_id===a.id))||[],[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)({name:"",start_date:"",end_date:"",start_time:"",end_time:"",teacher_id:"",location:"",capacity_max:""}),T=(0,f.useMutation)({mutationFn:async()=>{try{return await j.sessionService.createSession({formation_id:x,name:R.name,start_date:R.start_date,end_date:R.end_date,start_time:R.start_time||null,end_time:R.end_time||null,teacher_id:R.teacher_id||null,location:R.location||null,capacity_max:R.capacity_max?parseInt(R.capacity_max):null,status:"planned"})}catch(a){throw console.error("Erreur lors de la création de la session:",a),a}},onSuccess:()=>{Q(!1),S({name:"",start_date:"",end_date:"",start_time:"",end_time:"",teacher_id:"",location:"",capacity_max:""}),z.invalidateQueries({queryKey:["formation-sessions",x]}),K()}}),U=(0,f.useMutation)({mutationFn:async()=>{if(!D||!F.student_id)throw Error("Session et élève sont requis");let{data:a}=await y.from("enrollments").select("id").eq("session_id",D).eq("student_id",F.student_id).maybeSingle();if(a)throw Error("Cet élève est déjà inscrit à cette session");let{data:b,error:c}=await y.from("enrollments").insert({student_id:F.student_id,session_id:D,enrollment_date:F.enrollment_date,status:F.status,payment_status:F.payment_status,total_amount:parseFloat(F.total_amount)||0,paid_amount:parseFloat(F.paid_amount)||0}).select().single();if(c){if("23505"===c.code)throw Error("Cet élève est déjà inscrit à cette session");throw c}return b},onSuccess:()=>{z.invalidateQueries({queryKey:["enrollments-for-session",D]}),z.invalidateQueries({queryKey:["session-enrollments",D]}),C(!1),E(null)}});return J?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)("p",{children:"Chargement..."})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(v.default,{href:`/dashboard/formations/${x}`,children:(0,b.jsx)(l.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(n.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-gray-900",children:["Sessions - ",H?.name||"Formation"]}),(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Gérez les sessions de cette formation"})]})]}),(0,b.jsxs)(l.Button,{onClick:()=>Q(!0),children:[(0,b.jsx)(o.Plus,{className:"mr-2 h-4 w-4"}),"Nouvelle session"]})]}),P&&(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(m.CardTitle,{children:"Nouvelle session"}),(0,b.jsx)(l.Button,{variant:"ghost",size:"icon",onClick:()=>Q(!1),children:(0,b.jsx)(t.X,{className:"h-4 w-4"})})]})}),(0,b.jsx)(m.CardContent,{children:(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),T.mutate()},className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Nom de la session *"}),(0,b.jsx)("input",{type:"text",required:!0,value:R.name,onChange:a=>S({...R,name:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ex: Session Hiver 2024"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Lieu"}),(0,b.jsx)("input",{type:"text",value:R.location,onChange:a=>S({...R,location:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ex: Salle A1"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date de début *"}),(0,b.jsx)("input",{type:"date",required:!0,value:R.start_date,onChange:a=>S({...R,start_date:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date de fin *"}),(0,b.jsx)("input",{type:"date",required:!0,value:R.end_date,onChange:a=>S({...R,end_date:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Heure de début"}),(0,b.jsx)("input",{type:"time",value:R.start_time,onChange:a=>S({...R,start_time:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Heure de fin"}),(0,b.jsx)("input",{type:"time",value:R.end_time,onChange:a=>S({...R,end_time:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Enseignant"}),(0,b.jsxs)("select",{value:R.teacher_id,onChange:a=>S({...R,teacher_id:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"Sélectionner un enseignant"}),L?.map(a=>(0,b.jsx)("option",{value:a.id,children:a.full_name},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Capacité maximale"}),(0,b.jsx)("input",{type:"number",value:R.capacity_max,onChange:a=>S({...R,capacity_max:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ex: 30"})]})]}),T.error&&(0,b.jsx)("div",{className:"bg-red-50 text-red-800 px-4 py-3 rounded-lg text-sm",children:T.error instanceof Error?T.error.message:"Une erreur est survenue"}),(0,b.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,b.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>Q(!1),children:"Annuler"}),(0,b.jsx)(l.Button,{type:"submit",disabled:T.isPending,children:T.isPending?"Création...":"Créer la session"})]})]})})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:I&&I.length>0?I.map(a=>(0,b.jsxs)(m.Card,{className:"hover:shadow-lg transition-shadow",children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(m.CardTitle,{className:"text-lg",children:a.name}),(0,b.jsxs)("div",{className:"flex items-center mt-2 space-x-2 text-sm text-muted-foreground",children:[(0,b.jsx)(p.Calendar,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:[(0,w.formatDate)(a.start_date)," - ",(0,w.formatDate)(a.end_date)]})]})]}),(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs ${(a=>{switch(a){case"planned":return"bg-blue-100 text-blue-800";case"ongoing":return"bg-success-bg text-success-primary";case"completed":default:return"bg-gray-100 text-gray-800";case"cancelled":return"bg-red-100 text-red-800"}})(a.status)}`,children:(a=>{switch(a){case"planned":return"Planifiée";case"ongoing":return"En cours";case"completed":return"Terminée";case"cancelled":return"Annulée";default:return a}})(a.status)})]})}),(0,b.jsxs)(m.CardContent,{className:"space-y-3",children:[a.location&&(0,b.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,b.jsx)(r.MapPin,{className:"mr-2 h-4 w-4"}),a.location]}),a.start_time&&a.end_time&&(0,b.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,b.jsx)(q.Clock,{className:"mr-2 h-4 w-4"}),a.start_time," - ",a.end_time]}),a.capacity_max&&(0,b.jsxs)("div",{className:"flex items-center text-sm text-muted-foreground",children:[(0,b.jsx)(s.Users,{className:"mr-2 h-4 w-4"}),"Capacité: ",a.capacity_max]}),(0,b.jsxs)("div",{className:"flex space-x-2 pt-2",children:[(0,b.jsx)(v.default,{href:`/dashboard/sessions/${a.id}`,className:"flex-1",children:(0,b.jsx)(l.Button,{variant:"outline",className:"w-full",size:"sm",children:"Voir détails"})}),(0,b.jsxs)(l.Button,{variant:"default",className:"flex-1",size:"sm",onClick:()=>{E(a.id),G({student_id:"",enrollment_date:new Date().toISOString().split("T")[0],status:"confirmed",payment_status:"pending",total_amount:H?.price?.toString()||"0",paid_amount:"0"}),C(!0)},children:[(0,b.jsx)(u.UserPlus,{className:"mr-1 h-4 w-4"}),"Inscrire élève"]})]})]})]},a.id)):(0,b.jsxs)("div",{className:"col-span-full text-center py-12 text-muted-foreground",children:[(0,b.jsx)(p.Calendar,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,b.jsx)("p",{children:"Aucune session pour le moment"})]})}),B&&(0,b.jsxs)(m.Card,{children:[(0,b.jsx)(m.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(m.CardTitle,{children:"Inscrire un élève à la session"}),(0,b.jsx)(l.Button,{variant:"ghost",size:"icon",onClick:()=>C(!1),children:(0,b.jsx)(t.X,{className:"h-4 w-4"})})]})}),(0,b.jsx)(m.CardContent,{children:(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),U.mutate()},className:"space-y-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Élève *"}),(0,b.jsxs)("select",{required:!0,value:F.student_id,onChange:a=>G({...F,student_id:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"Sélectionner un élève"}),O.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.first_name," ",a.last_name," (",a.student_number,")"]},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date d'inscription *"}),(0,b.jsx)("input",{type:"date",required:!0,value:F.enrollment_date,onChange:a=>G({...F,enrollment_date:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Statut *"}),(0,b.jsxs)("select",{required:!0,value:F.status,onChange:a=>{let b=a.target.value||"pending",c="failed"===b||"completed"===b||"confirmed"===b||"pending"===b||"cancelled"===b?b:"pending";G({...F,status:c})},className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,b.jsx)("option",{value:"pending",children:"En attente"}),(0,b.jsx)("option",{value:"confirmed",children:"Confirmé"}),(0,b.jsx)("option",{value:"completed",children:"Terminé"}),(0,b.jsx)("option",{value:"cancelled",children:"Annulé"}),(0,b.jsx)("option",{value:"failed",children:"Échoué"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant total *"}),(0,b.jsx)("input",{type:"number",required:!0,step:"0.01",value:F.total_amount,onChange:a=>G({...F,total_amount:a.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant payé"}),(0,b.jsx)("input",{type:"number",step:"0.01",value:F.paid_amount,onChange:a=>{let b=parseFloat(a.target.value)||0,c=parseFloat(F.total_amount)||0;G({...F,paid_amount:a.target.value,payment_status:0===b?"pending":b>=c?"paid":"partial"})},className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Statut de paiement"}),(0,b.jsx)("input",{type:"text",value:"pending"===F.payment_status?"En attente":"partial"===F.payment_status?"Partiel":"paid"===F.payment_status?"Payé":"En retard",disabled:!0,className:"w-full px-4 py-2 border rounded-lg bg-gray-50"})]})]}),U.error&&(0,b.jsx)("div",{className:"bg-red-50 text-red-800 px-4 py-3 rounded-lg text-sm",children:U.error instanceof Error?U.error.message:"Une erreur est survenue"}),(0,b.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,b.jsx)(l.Button,{type:"button",variant:"outline",onClick:()=>C(!1),children:"Annuler"}),(0,b.jsx)(l.Button,{type:"submit",disabled:U.isPending,children:U.isPending?"Inscription...":"Inscrire l'élève"})]})]})})]})]})}a.s(["default",()=>x])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_formations_%5Bid%5D_sessions_page_tsx_c12a3ba8._.js.map