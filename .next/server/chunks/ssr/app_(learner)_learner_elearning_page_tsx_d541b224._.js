module.exports=[173031,a=>{"use strict";var b=a.i(187924),c=a.i(433217),d=a.i(323625),e=a.i(727163),f=a.i(219897),g=a.i(340695),h=a.i(254161),i=a.i(205522),j=a.i(621958);a.i(460355);var k=a.i(346271),l=a.i(71277),m=a.i(953722),n=a.i(641710),o=a.i(111269),p=a.i(587532),q=a.i(325015),r=a.i(724669);let s=(0,a.i(170106).default)("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);var t=a.i(238246),u=a.i(572131),v=a.i(325383);function w(){let{student:a,studentId:w}=(0,d.useLearnerContext)(),x=(0,u.useMemo)(()=>w?(0,e.createLearnerClient)(w):null,[w]),[y,z]=(0,u.useState)(""),{data:A,isLoading:B}=(0,c.useQuery)({queryKey:["learner-session-courses",w],queryFn:async()=>{if(!w||!x)return[];try{let{data:a,error:b}=await x.from("session_courses").select(`
            *,
            course:courses(
              id, title, slug, short_description, description,
              difficulty_level, estimated_duration_hours, thumbnail_url, is_published
            )
          `).order("assigned_at",{ascending:!1});if(b){if("PGRST116"===b.code||"42P01"===b.code||b.message?.includes("does not exist"))return[];throw b}return a||[]}catch(a){return v.logger.warn("Error fetching session courses",{studentId:(0,v.maskId)(w),error:(0,v.sanitizeError)(a)}),[]}},enabled:!!w}),{data:C}=(0,c.useQuery)({queryKey:["learner-lesson-progress",w,A?.map(a=>a.course_id)],queryFn:async()=>{if(!w||!A?.length||!x)return{};let a=A.map(a=>a.course_id);try{let{data:b,error:c}=await x.from("lesson_progress").select("*, lessons(course_id)").eq("student_id",w);if(c)return v.logger.warn("Error fetching lesson progress",{studentId:(0,v.maskId)(w),error:(0,v.sanitizeError)(c)}),{};let{data:d}=await x.from("lessons").select("id, course_id").in("course_id",a),e={};for(let c of a){let a=d?.filter(a=>a.course_id===c)||[],f=(b||[]).filter(a=>a.lessons?.course_id===c&&a.is_completed).length,g=a.length,h=g>0?Math.round(f/g*100):0;e[c]={completed:f,total:g,percentage:h}}return e}catch(a){return v.logger.warn("Error calculating progress",{studentId:(0,v.maskId)(w),error:(0,v.sanitizeError)(a)}),{}}},enabled:!!w&&!!A?.length}),D=(A||[]).map(a=>({id:a.id,course_id:a.course_id,courses:a.course,session:null,progress_percentage:C?.[a.course_id]?.percentage||0,completed_lessons:C?.[a.course_id]?.completed||0,total_lessons:C?.[a.course_id]?.total||0,status:(C?.[a.course_id]?.percentage??0)===100?"completed":(C?.[a.course_id]?.percentage??0)>0?"in_progress":"not_started",is_required:a.is_required,due_date:a.due_date})),{data:E}=(0,c.useQuery)({queryKey:["learner-available-courses",a?.id,a?.organization_id],queryFn:async()=>{if(!a?.id)return[];let b=D?.map(a=>a.course_id)||[];try{if(!x||!a.organization_id)return[];let c=x.from("courses").select("*").eq("is_published",!0).eq("organization_id",a.organization_id);b.length>0&&(c=c.not("id","in",`(${b.join(",")})`));let{data:d,error:e}=await c.order("created_at",{ascending:!1});if(e){if("PGRST116"===e.code||"42P01"===e.code||"PGRST301"===e.code||400===e.status||"400"===e.code||e.message?.includes("relation")||e.message?.includes("relationship")||e.message?.includes("does not exist")||e.message?.includes("schema cache"))return v.logger.warn("Courses table does not exist yet or invalid query",{studentId:(0,v.maskId)(a.id),error:(0,v.sanitizeError)(e)}),[];throw e}return d||[]}catch(b){if(b?.code==="PGRST116"||b?.code==="42P01"||b?.code==="PGRST301"||b?.status===400||b?.code==="400"||b?.message?.includes("relation")||b?.message?.includes("relationship")||b?.message?.includes("does not exist")||b?.message?.includes("schema cache"))return v.logger.warn("Courses table does not exist yet or invalid query",{studentId:(0,v.maskId)(a.id),error:(0,v.sanitizeError)(b)}),[];throw b}},enabled:!!a?.id&&!!a?.organization_id}),F=D?.filter(a=>"in_progress"===a.status)||[],G=D?.filter(a=>"completed"===a.status)||[],H=y.trim().toLowerCase(),I=D?.filter(a=>!H||(a.courses?.title||"").toLowerCase().includes(H))||[],J=({enrollment:a,isAvailable:c=!1})=>{var d;let e=c?a:a.courses,i=a.progress_percentage||0;return e?.slug?(0,b.jsx)(t.default,{href:`/learner/elearning/${e?.slug}`,className:"block",children:(0,b.jsxs)(f.GlassCard,{className:"overflow-hidden hover:shadow-lg transition-all duration-300 group",children:[(0,b.jsxs)("div",{className:"relative h-40 bg-gradient-to-br from-brand-blue/20 to-indigo-100",children:[e?.thumbnail_url?(0,b.jsx)("img",{src:e.thumbnail_url,alt:e.title,className:"w-full h-full object-cover"}):(0,b.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,b.jsx)(m.BookOpen,{className:"h-16 w-16 text-brand-blue/30"})}),(0,b.jsx)("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-16 h-16 rounded-full bg-white/90 flex items-center justify-center",children:(0,b.jsx)(q.Play,{className:"h-8 w-8 text-brand-blue ml-1"})})}),!c&&(0,b.jsxs)("div",{className:"absolute top-3 right-3 flex flex-col gap-1 items-end",children:["completed"===a.status?(0,b.jsxs)(h.Badge,{className:"bg-green-500 text-white",children:[(0,b.jsx)(o.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Terminé"]}):i>0?(0,b.jsx)(h.Badge,{className:"bg-brand-blue text-white",children:"En cours"}):null,a.is_required&&(0,b.jsx)(h.Badge,{variant:"secondary",className:"text-xs",children:"Obligatoire"})]}),!c&&a.session?.name&&(0,b.jsx)("div",{className:"absolute bottom-3 left-3",children:(0,b.jsx)(h.Badge,{variant:"outline",className:"bg-white/90 text-xs",children:a.session.name})})]}),(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsx)("div",{className:"flex items-start justify-between gap-2 mb-2",children:(0,b.jsx)("h3",{className:"font-semibold text-gray-900 line-clamp-2 group-hover:text-brand-blue transition-colors",children:e?.title})}),(e?.description||e?.short_description)&&(0,b.jsx)("p",{className:"text-sm text-gray-500 line-clamp-2 mb-3",children:e.short_description||e.description}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm text-gray-500 mb-3",children:[a.total_lessons>0&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(s,{className:"h-4 w-4"}),a.total_lessons," leçons"]}),e?.estimated_duration_hours&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(n.Clock,{className:"h-4 w-4"}),e.estimated_duration_hours,"h"]}),e?.difficulty_level&&(d=e.difficulty_level,(0,b.jsx)(h.Badge,{className:`${{beginner:"bg-green-100 text-green-700",intermediate:"bg-amber-100 text-amber-700",advanced:"bg-red-100 text-red-700"}[d]||"bg-gray-100 text-gray-700"}`,children:{beginner:"Débutant",intermediate:"Intermédiaire",advanced:"Avancé"}[d]||d}))]}),!c&&a.due_date&&(0,b.jsxs)("div",{className:"text-xs text-amber-600 mb-2 flex items-center gap-1",children:[(0,b.jsx)(n.Clock,{className:"h-3 w-3"}),"Échéance: ",new Date(a.due_date).toLocaleDateString("fr-FR")]}),!c&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,b.jsxs)("span",{className:"text-gray-500",children:[a.completed_lessons,"/",a.total_lessons," leçons"]}),(0,b.jsxs)("span",{className:"font-semibold text-brand-blue",children:[i,"%"]})]}),(0,b.jsx)("div",{className:"h-2 bg-gray-100 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-gradient-to-r from-brand-blue to-indigo-500 rounded-full transition-all duration-500",style:{width:`${i}%`}})})]}),c&&(0,b.jsx)(g.Button,{className:"w-full mt-2",variant:"outline",children:"Commencer le cours"})]})]})}):(0,b.jsx)(f.GlassCard,{className:"overflow-hidden border border-amber-200 bg-amber-50/40",children:(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between gap-2 mb-2",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 line-clamp-2",children:"Cours assigné (détails indisponibles)"}),(0,b.jsx)(h.Badge,{className:"bg-amber-500 text-white",children:"Configuration"})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Ce cours a été assigné à votre session, mais ses informations ne sont pas encore accessibles. Réessayez dans quelques secondes (ou contactez l’administrateur pour appliquer les règles d’accès apprenant)."})]})})},K={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};return(0,b.jsxs)(k.motion.div,{className:"space-y-6 pb-24 lg:pb-8",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",children:[(0,b.jsx)(k.motion.div,{variants:K,children:(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)("div",{className:"p-2 bg-purple-100 rounded-xl",children:(0,b.jsx)(l.PlayCircle,{className:"h-8 w-8 text-purple-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"E-Learning"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Apprenez à votre rythme avec nos cours en ligne"})]})]})}),(0,b.jsxs)(k.motion.div,{variants:K,className:"grid grid-cols-3 gap-4",children:[(0,b.jsxs)(f.GlassCard,{className:"p-4 text-center",children:[(0,b.jsx)(l.PlayCircle,{className:"h-6 w-6 text-purple-600 mx-auto mb-2"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:F.length}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"En cours"})]}),(0,b.jsxs)(f.GlassCard,{className:"p-4 text-center",children:[(0,b.jsx)(o.CheckCircle2,{className:"h-6 w-6 text-green-600 mx-auto mb-2"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:G.length}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Terminés"})]}),(0,b.jsxs)(f.GlassCard,{className:"p-4 text-center",children:[(0,b.jsx)(r.TrendingUp,{className:"h-6 w-6 text-brand-blue mx-auto mb-2"}),(0,b.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:[D?.reduce((a,b)=>a+(b.progress_percentage||0),0)/(D?.length||1)||0,"%"]}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Progression moyenne"})]})]}),(0,b.jsx)(k.motion.div,{variants:K,children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(p.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,b.jsx)(i.Input,{type:"search",placeholder:"Rechercher un cours...",value:y,onChange:a=>z(a.target.value),className:"pl-10"})]})}),(0,b.jsx)(k.motion.div,{variants:K,children:(0,b.jsxs)(j.Tabs,{defaultValue:"my-courses",className:"space-y-6",children:[(0,b.jsxs)(j.TabsList,{className:"bg-white/50 backdrop-blur-sm border border-gray-200/50 p-1 rounded-xl",children:[(0,b.jsxs)(j.TabsTrigger,{value:"my-courses",className:"rounded-lg data-[state=active]:bg-brand-blue data-[state=active]:text-white",children:[(0,b.jsx)(m.BookOpen,{className:"h-4 w-4 mr-2"}),"Mes cours (",D?.length||0,")"]}),(0,b.jsxs)(j.TabsTrigger,{value:"available",className:"rounded-lg data-[state=active]:bg-brand-blue data-[state=active]:text-white",children:[(0,b.jsx)(l.PlayCircle,{className:"h-4 w-4 mr-2"}),"Disponibles (",E?.length||0,")"]})]}),(0,b.jsx)(j.TabsContent,{value:"my-courses",children:B?(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:"h-80 bg-gray-100 rounded-2xl animate-pulse"},a))}):I.length>0?(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:I.map(a=>(0,b.jsx)(J,{enrollment:a},a.id))}):(0,b.jsxs)(f.GlassCard,{className:"p-12 text-center",children:[(0,b.jsx)(m.BookOpen,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Aucun cours"}),(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Vous n'êtes inscrit à aucun cours pour le moment"}),(0,b.jsx)(g.Button,{variant:"outline",children:"Découvrir les cours disponibles"})]})}),(0,b.jsx)(j.TabsContent,{value:"available",children:E&&E.length>0?(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:E.map(a=>(0,b.jsx)(J,{enrollment:a,isAvailable:!0},a.id))}):(0,b.jsxs)(f.GlassCard,{className:"p-12 text-center",children:[(0,b.jsx)(l.PlayCircle,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Tous les cours sont déjà attribués"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Vous avez accès à tous les cours disponibles"})]})})]})})]})}a.s(["default",()=>w],173031)}];

//# sourceMappingURL=app_%28learner%29_learner_elearning_page_tsx_d541b224._.js.map