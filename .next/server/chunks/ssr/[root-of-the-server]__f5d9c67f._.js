module.exports=[224361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},814747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},400210,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],400210)},641710,a=>{"use strict";let b=(0,a.i(170106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],641710)},219897,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);a.i(460355);var e=a.i(346271);let f=c.forwardRef(({className:a,variant:c="default",hoverable:f=!1,glow:g=!1,glowColor:h="rgba(51, 90, 207, 0.3)",...i},j)=>(0,b.jsxs)(e.motion.div,{ref:j,className:(0,d.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===c,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===c,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===c,"cursor-pointer":f,"hover:shadow-2xl hover:scale-[1.02]":f,"hover:bg-white/90 dark:hover:bg-gray-900/90":f},a),whileHover:f?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...i,children:[g&&(0,b.jsx)(e.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${h} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,b.jsx)("div",{className:"relative z-10",children:i.children})]}));f.displayName="GlassCard",a.s(["GlassCard",()=>f])},427699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},254799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},522734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},500874,(a,b,c)=>{b.exports=a.x("buffer",()=>require("buffer"))},688947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},449719,(a,b,c)=>{b.exports=a.x("assert",()=>require("assert"))},406461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},581464,a=>{"use strict";let b=(0,a.i(170106).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);a.s(["Filter",()=>b],581464)},46864,a=>{"use strict";let b=(0,a.i(170106).default)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);a.s(["UserCheck",()=>b],46864)},592319,a=>{"use strict";let b=(0,a.i(170106).default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);a.s(["UserX",()=>b],592319)},672893,a=>{"use strict";let b=(0,a.i(170106).default)("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);a.s(["UserMinus",()=>b],672893)},899025,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(913216),f=a.i(269240),g=a.i(340695),h=a.i(219897),i=a.i(400210),j=a.i(587532),k=a.i(581464),l=a.i(284505),m=a.i(46864),n=a.i(592319),o=a.i(641710),p=a.i(672893),q=a.i(941675),r=a.i(497895),s=a.i(238246);a.i(460355);var t=a.i(346271),u=a.i(222703);function v(){let{user:a}=(0,e.useAuth)(),v=(0,f.createClient)(),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)("all"),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(1),{data:I}=(0,d.useQuery)({queryKey:["all-sessions-for-history",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)return[];let{data:b,error:c}=await v.from("sessions").select("id, name, formations!inner(name, organization_id)").eq("formations.organization_id",a.organization_id).order("name",{ascending:!0});return c?(console.warn("Erreur récupération sessions:",c),[]):b||[]},enabled:!!a?.organization_id}),{data:J}=(0,d.useQuery)({queryKey:["student-search",w],queryFn:async()=>{if(!w||!a?.organization_id)return null;let{data:b,error:c}=await v.from("students").select("id").eq("organization_id",a.organization_id).or(`first_name.ilike.%${w}%,last_name.ilike.%${w}%,student_number.ilike.%${w}%`);return c?(console.warn("Erreur recherche étudiants:",c),null):b?.map(a=>a.id)||[]},enabled:!!w&&!!a?.organization_id}),{data:K,isLoading:L}=(0,d.useQuery)({queryKey:["attendance-history",a?.organization_id,w,J,y,A,C,E,G],queryFn:async()=>{if(!a?.organization_id)return{data:[],total:0};let b=v.from("attendance").select("*, students(first_name, last_name, student_number), sessions(name, formations(name, programs(name)))",{count:"exact"}).eq("organization_id",a.organization_id);if("all"!==y&&(b=b.eq("status",y)),A&&(b=b.gte("date",A)),C&&(b=b.lte("date",C)),E&&(b=b.eq("session_id",E)),w&&J&&J.length>0)b=b.in("student_id",J);else if(w&&(!J||0===J.length))return{data:[],total:0};b=b.order("date",{ascending:!1}).order("created_at",{ascending:!1}).range((G-1)*50,50*G-1);let{data:c,error:d,count:e}=await b;if(d)throw d;return{data:c||[],total:e||0}},enabled:!!a?.organization_id&&(!w||void 0!==J)}),M=Math.ceil((K?.total||0)/50),N=a=>{switch(a){case"present":return"Présent";case"absent":return"Absent";case"late":return"En retard";case"excused":return"Justifié";default:return a}},O=a=>{switch(a){case"present":return"bg-brand-blue-ghost text-brand-blue border-brand-blue/20";case"absent":return"bg-red-50 text-red-600 border-red-100";case"late":return"bg-brand-cyan-ghost text-brand-cyan border-brand-cyan/20";case"excused":return"bg-blue-50 text-blue-600 border-blue-100";default:return"bg-gray-50 text-gray-600 border-gray-100"}},P=async b=>{if(!K?.data||0===K.data.length)return void alert("Aucun émargement à exporter");try{if(!a?.organization_id)throw Error("Organization ID required");let c=v.from("attendance").select("*, students(first_name, last_name, student_number), sessions(name, formations(name, programs(name)))").eq("organization_id",a.organization_id);if("all"!==y&&(c=c.eq("status",y)),A&&(c=c.gte("date",A)),C&&(c=c.lte("date",C)),E&&(c=c.eq("session_id",E)),w&&J&&J.length>0)c=c.in("student_id",J);else if(w&&(!J||0===J.length))return void alert("Aucun étudiant trouvé avec ce critère de recherche");let{data:d,error:e}=await c.order("date",{ascending:!1}).order("created_at",{ascending:!1});if(e)throw e;let f=d.map(a=>{let b=a.students,c=a.sessions,d=c?.formations,e=d?.programs;return{Date:(0,r.formatDate)(a.date),Élève:`${b?.first_name||""} ${b?.last_name||""}`.trim(),Numéro:b?.student_number||"",Session:c?.name||"",Formation:d?.name||"",Programme:e?.name||"",Statut:N(a.status),"Retard (min)":a.late_minutes||0,Notes:a.notes||""}});"xlsx"===b?await (0,u.exportToExcel)({filename:`historique_emargements_${new Date().toISOString().split("T")[0]}.xlsx`,sheetName:"Historique Émargements",columns:[{header:"Date",key:"Date",width:12},{header:"Élève",key:"Élève",width:20},{header:"Numéro",key:"Numéro",width:15},{header:"Session",key:"Session",width:30},{header:"Formation",key:"Formation",width:25},{header:"Programme",key:"Programme",width:25},{header:"Statut",key:"Statut",width:12},{header:"Retard (min)",key:"Retard (min)",width:12},{header:"Notes",key:"Notes",width:30}],data:f}):(0,u.exportToCSV)(`historique_emargements_${new Date().toISOString().split("T")[0]}.csv`,f),alert(`Export ${b.toUpperCase()} r\xe9ussi ! ${f.length} \xe9margement(s) export\xe9(s).`)}catch(a){console.error("Erreur lors de l'export:",a),alert("Erreur lors de l'export des données")}};return(0,b.jsxs)("div",{className:"space-y-6 pb-8 max-w-[1600px] mx-auto",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(s.default,{href:"/dashboard/attendance",children:(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(i.ArrowLeft,{className:"h-5 w-5"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Historique des présences"}),(0,b.jsxs)("p",{className:"text-gray-500 mt-1",children:[K?.total||0," émargement",K?.total!==1?"s":""," trouvé",K?.total!==1?"s":""]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(g.Button,{variant:"outline",onClick:()=>P("csv"),children:[(0,b.jsx)(l.Download,{className:"mr-2 h-4 w-4"}),"CSV"]}),(0,b.jsxs)(g.Button,{variant:"outline",onClick:()=>P("xlsx"),children:[(0,b.jsx)(l.Download,{className:"mr-2 h-4 w-4"}),"Excel"]})]})]}),(0,b.jsxs)(h.GlassCard,{variant:"default",className:"p-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,b.jsxs)("div",{className:"lg:col-span-2",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Recherche"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(j.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,b.jsx)("input",{type:"text",placeholder:"Nom, prénom ou numéro...",value:w,onChange:a=>{x(a.target.value),H(1)},className:"w-full pl-10 pr-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Statut"}),(0,b.jsxs)("select",{value:y,onChange:a=>{z(a.target.value),H(1)},className:"w-full px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm",children:[(0,b.jsx)("option",{value:"all",children:"Tous"}),(0,b.jsx)("option",{value:"present",children:"Présent"}),(0,b.jsx)("option",{value:"absent",children:"Absent"}),(0,b.jsx)("option",{value:"late",children:"En retard"}),(0,b.jsx)("option",{value:"excused",children:"Justifié"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Date début"}),(0,b.jsx)("input",{type:"date",value:A,onChange:a=>{B(a.target.value),H(1)},className:"w-full px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Date fin"}),(0,b.jsx)("input",{type:"date",value:C,onChange:a=>{D(a.target.value),H(1)},className:"w-full px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Session"}),(0,b.jsxs)("select",{value:E,onChange:a=>{F(a.target.value),H(1)},className:"w-full px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm",children:[(0,b.jsx)("option",{value:"",children:"Toutes les sessions"}),I?.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsx)("div",{className:"flex items-end",children:(0,b.jsxs)(g.Button,{variant:"outline",onClick:()=>{x(""),z("all"),B(""),D(""),F(""),H(1)},className:"w-full",children:[(0,b.jsx)(k.Filter,{className:"mr-2 h-4 w-4"}),"Réinitialiser"]})})]})]}),(0,b.jsx)(h.GlassCard,{variant:"default",className:"overflow-hidden p-0",children:L?(0,b.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Chargement..."}):K&&K.data.length>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"divide-y divide-gray-100",children:K.data.map(a=>{let c=a.students,d=a.sessions,e=d?.formations;return(0,b.jsxs)(t.motion.div,{initial:{opacity:0},animate:{opacity:1},className:"p-4 hover:bg-gray-50/50 transition-colors flex items-center justify-between group",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,b.jsx)("div",{className:(0,r.cn)("h-10 w-10 rounded-full flex items-center justify-center transition-colors",O(a.status).replace("border-","").replace("text-","bg-opacity-20 text-")),children:(a=>{switch(a){case"present":return(0,b.jsx)(m.UserCheck,{className:"h-5 w-5"});case"absent":return(0,b.jsx)(n.UserX,{className:"h-5 w-5"});case"late":return(0,b.jsx)(o.Clock,{className:"h-5 w-5"});case"excused":return(0,b.jsx)(p.UserMinus,{className:"h-5 w-5"});default:return null}})(a.status)}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("p",{className:"font-semibold text-gray-900",children:[c?.first_name," ",c?.last_name,c?.student_number&&(0,b.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["(",c.student_number,")"]})]}),(0,b.jsxs)("div",{className:"text-sm text-gray-500 flex items-center gap-2 mt-1",children:[(0,b.jsx)("span",{className:"font-medium text-brand-blue/80",children:d?.name}),e?.name&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),(0,b.jsx)("span",{children:e.name})]}),(0,b.jsx)("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),(0,b.jsx)(q.Calendar,{className:"h-3 w-3"}),(0,b.jsx)("span",{children:(0,r.formatDate)(a.date)})]}),a.notes&&(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1 italic",children:a.notes})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[a.late_minutes&&a.late_minutes>0&&(0,b.jsxs)("span",{className:"text-sm font-medium text-brand-cyan bg-brand-cyan-ghost px-2 py-1 rounded-md",children:["+",a.late_minutes," min"]}),(0,b.jsx)("span",{className:(0,r.cn)("px-3 py-1 rounded-full text-xs font-medium border",O(a.status)),children:N(a.status)})]})]},a.id)})}),M>1&&(0,b.jsxs)("div",{className:"p-4 border-t border-gray-100 bg-gray-50/30 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"text-sm text-gray-500",children:["Page ",G," sur ",M]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(g.Button,{variant:"outline",size:"sm",onClick:()=>H(a=>Math.max(1,a-1)),disabled:1===G,children:"Précédent"}),(0,b.jsx)(g.Button,{variant:"outline",size:"sm",onClick:()=>H(a=>Math.min(M,a+1)),disabled:G===M,children:"Suivant"})]})]})]}):(0,b.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Aucun émargement trouvé avec ces critères"})})]})}a.s(["default",()=>v])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__f5d9c67f._.js.map