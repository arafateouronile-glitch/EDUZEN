{"version":3,"sources":["../../../../node_modules/lucide-react/src/icons/arrow-left.ts","../../../../node_modules/lucide-react/src/icons/mail.ts","../../../../node_modules/lucide-react/src/icons/pen-square.ts","../../../../node_modules/lucide-react/src/icons/dollar-sign.ts","../../../../node_modules/lucide-react/src/icons/phone.ts","../../../../lib/errors/error-handler.ts","../../../../lib/utils/supabase-helpers.ts","../../../../lib/utils/validators.ts","../../../../lib/services/student.service.ts","../../../../lib/utils/number-generator.ts","../../../../node_modules/lucide-react/src/icons/link.ts","../../../../lib/services/invoice.service.ts","../../../../lib/services/payment.service.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name ArrowLeft\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTIgMTktNy03IDctNyIgLz4KICA8cGF0aCBkPSJNMTkgMTJINSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/arrow-left\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ArrowLeft = createLucideIcon('ArrowLeft', [\n  ['path', { d: 'm12 19-7-7 7-7', key: '1l729n' }],\n  ['path', { d: 'M19 12H5', key: 'x3x0zl' }],\n]);\n\nexport default ArrowLeft;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Mail\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cmVjdCB3aWR0aD0iMjAiIGhlaWdodD0iMTYiIHg9IjIiIHk9IjQiIHJ4PSIyIiAvPgogIDxwYXRoIGQ9Im0yMiA3LTguOTcgNS43YTEuOTQgMS45NCAwIDAgMS0yLjA2IDBMMiA3IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/mail\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Mail = createLucideIcon('Mail', [\n  ['rect', { width: '20', height: '16', x: '2', y: '4', rx: '2', key: '18n3k1' }],\n  ['path', { d: 'm22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7', key: '1ocrg3' }],\n]);\n\nexport default Mail;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name PenSquare\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTEgNEg0YTIgMiAwIDAgMC0yIDJ2MTRhMiAyIDAgMCAwIDIgMmgxNGEyIDIgMCAwIDAgMi0ydi03IiAvPgogIDxwYXRoIGQ9Ik0xOC41IDIuNWEyLjEyIDIuMTIgMCAwIDEgMyAzTDEyIDE1bC00IDEgMS00WiIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/pen-square\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst PenSquare = createLucideIcon('PenSquare', [\n  ['path', { d: 'M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7', key: '1qinfi' }],\n  ['path', { d: 'M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z', key: 'w2jsv5' }],\n]);\n\nexport default PenSquare;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name DollarSign\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8bGluZSB4MT0iMTIiIHgyPSIxMiIgeTE9IjIiIHkyPSIyMiIgLz4KICA8cGF0aCBkPSJNMTcgNUg5LjVhMy41IDMuNSAwIDAgMCAwIDdoNWEzLjUgMy41IDAgMCAxIDAgN0g2IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/dollar-sign\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst DollarSign = createLucideIcon('DollarSign', [\n  ['line', { x1: '12', x2: '12', y1: '2', y2: '22', key: '7eqyqh' }],\n  ['path', { d: 'M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6', key: '1b0p4s' }],\n]);\n\nexport default DollarSign;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Phone\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjIgMTYuOTJ2M2EyIDIgMCAwIDEtMi4xOCAyIDE5Ljc5IDE5Ljc5IDAgMCAxLTguNjMtMy4wNyAxOS41IDE5LjUgMCAwIDEtNi02IDE5Ljc5IDE5Ljc5IDAgMCAxLTMuMDctOC42N0EyIDIgMCAwIDEgNC4xMSAyaDNhMiAyIDAgMCAxIDIgMS43MiAxMi44NCAxMi44NCAwIDAgMCAuNyAyLjgxIDIgMiAwIDAgMS0uNDUgMi4xMUw4LjA5IDkuOTFhMTYgMTYgMCAwIDAgNiA2bDEuMjctMS4yN2EyIDIgMCAwIDEgMi4xMS0uNDUgMTIuODQgMTIuODQgMCAwIDAgMi44MS43QTIgMiAwIDAgMSAyMiAxNi45MnoiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/phone\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Phone = createLucideIcon('Phone', [\n  [\n    'path',\n    {\n      d: 'M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z',\n      key: 'foiqr5',\n    },\n  ],\n]);\n\nexport default Phone;\n","/**\n * ErrorHandler Global - Gestion centralisée des erreurs\n * \n * Fournit :\n * - Types d'erreurs personnalisés\n * - Classification automatique des erreurs\n * - Messages utilisateur traduits\n * - Logging automatique\n * - Formatage cohérent\n */\n\nimport { logger } from '@/lib/utils/logger'\nimport type { LogContext } from '@/lib/utils/logger'\n\n// ============================================================================\n// TYPES D'ERREURS PERSONNALISÉS\n// ============================================================================\n\nexport enum ErrorCode {\n  // Erreurs d'authentification (1000-1999)\n  AUTH_REQUIRED = 'AUTH_1001',\n  AUTH_INVALID_CREDENTIALS = 'AUTH_1002',\n  AUTH_SESSION_EXPIRED = 'AUTH_1003',\n  AUTH_INSUFFICIENT_PERMISSIONS = 'AUTH_1004',\n  AUTH_2FA_REQUIRED = 'AUTH_1005',\n  AUTH_2FA_INVALID = 'AUTH_1006',\n\n  // Erreurs de validation (2000-2999)\n  VALIDATION_ERROR = 'VALID_2001',\n  VALIDATION_REQUIRED_FIELD = 'VALID_2002',\n  VALIDATION_INVALID_FORMAT = 'VALID_2003',\n  VALIDATION_UNIQUE_CONSTRAINT = 'VALID_2004',\n\n  // Erreurs de base de données (3000-3999)\n  DB_CONNECTION_ERROR = 'DB_3001',\n  DB_QUERY_ERROR = 'DB_3002',\n  DB_NOT_FOUND = 'DB_3003',\n  DB_CONSTRAINT_VIOLATION = 'DB_3004',\n  DB_FOREIGN_KEY_CONSTRAINT = 'DB_3006',\n  DB_RLS_POLICY_VIOLATION = 'DB_3005',\n\n  // Erreurs réseau/API (4000-4999)\n  NETWORK_ERROR = 'NET_4001',\n  API_TIMEOUT = 'NET_4002',\n  API_RATE_LIMIT = 'NET_4003',\n  API_SERVER_ERROR = 'NET_4004',\n  API_NOT_FOUND = 'NET_4005',\n  API_BAD_REQUEST = 'NET_4006',\n\n  // Erreurs métier (5000-5999)\n  BUSINESS_LOGIC_ERROR = 'BIZ_5001',\n  RESOURCE_LOCKED = 'BIZ_5002',\n  OPERATION_NOT_ALLOWED = 'BIZ_5003',\n  QUOTA_EXCEEDED = 'BIZ_5004',\n\n  // Erreurs système (6000-6999)\n  INTERNAL_ERROR = 'SYS_6001',\n  CONFIGURATION_ERROR = 'SYS_6002',\n  SERVICE_UNAVAILABLE = 'SYS_6003',\n}\n\nexport enum ErrorSeverity {\n  LOW = 'low',\n  MEDIUM = 'medium',\n  HIGH = 'high',\n  CRITICAL = 'critical',\n}\n\nexport interface AppErrorContext extends LogContext {\n  code?: ErrorCode\n  severity?: ErrorSeverity\n  userMessage?: string\n  retryable?: boolean\n  timestamp?: string\n}\n\n/**\n * Classe d'erreur personnalisée pour l'application\n */\nexport class AppError extends Error {\n  public readonly code: ErrorCode\n  public readonly severity: ErrorSeverity\n  public readonly userMessage: string\n  public readonly retryable: boolean\n  public readonly context: AppErrorContext\n  public readonly originalError?: Error | unknown\n\n  constructor(\n    message: string,\n    code: ErrorCode = ErrorCode.INTERNAL_ERROR,\n    severity: ErrorSeverity = ErrorSeverity.MEDIUM,\n    context: AppErrorContext = {},\n    originalError?: Error | unknown\n  ) {\n    super(message)\n    this.name = 'AppError'\n    this.code = code\n    this.severity = severity\n    this.userMessage = context.userMessage || this.getDefaultUserMessage(code)\n    this.retryable = context.retryable ?? this.isRetryable(code)\n    this.context = {\n      ...context,\n      code,\n      severity,\n      timestamp: new Date().toISOString(),\n    }\n    this.originalError = originalError\n\n    // Maintenir la stack trace\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, AppError)\n    }\n  }\n\n  /**\n   * Messages utilisateur par défaut selon le code d'erreur\n   */\n  private getDefaultUserMessage(code: ErrorCode): string {\n    const messages: Record<ErrorCode, string> = {\n      // Auth\n      [ErrorCode.AUTH_REQUIRED]: 'Vous devez être connecté pour effectuer cette action.',\n      [ErrorCode.AUTH_INVALID_CREDENTIALS]: 'Email ou mot de passe incorrect.',\n      [ErrorCode.AUTH_SESSION_EXPIRED]: 'Votre session a expiré. Veuillez vous reconnecter.',\n      [ErrorCode.AUTH_INSUFFICIENT_PERMISSIONS]: \"Vous n'avez pas les permissions nécessaires.\",\n      [ErrorCode.AUTH_2FA_REQUIRED]: 'Authentification à deux facteurs requise.',\n      [ErrorCode.AUTH_2FA_INVALID]: 'Code d\\'authentification invalide.',\n\n      // Validation\n      [ErrorCode.VALIDATION_ERROR]: 'Les données fournies ne sont pas valides.',\n      [ErrorCode.VALIDATION_REQUIRED_FIELD]: 'Certains champs obligatoires sont manquants.',\n      [ErrorCode.VALIDATION_INVALID_FORMAT]: 'Le format des données est incorrect.',\n      [ErrorCode.VALIDATION_UNIQUE_CONSTRAINT]: 'Cette valeur existe déjà.',\n\n      // Database\n      [ErrorCode.DB_CONNECTION_ERROR]: 'Impossible de se connecter à la base de données.',\n      [ErrorCode.DB_QUERY_ERROR]: 'Erreur lors de l\\'exécution de la requête.',\n      [ErrorCode.DB_NOT_FOUND]: 'Ressource introuvable.',\n      [ErrorCode.DB_CONSTRAINT_VIOLATION]: 'Cette opération viole une contrainte de la base de données.',\n      [ErrorCode.DB_FOREIGN_KEY_CONSTRAINT]: 'Cette opération viole une contrainte de clé étrangère.',\n      [ErrorCode.DB_RLS_POLICY_VIOLATION]: 'Vous n\\'avez pas accès à cette ressource.',\n\n      // Network\n      [ErrorCode.NETWORK_ERROR]: 'Erreur de connexion réseau. Vérifiez votre connexion internet.',\n      [ErrorCode.API_TIMEOUT]: 'La requête a pris trop de temps. Veuillez réessayer.',\n      [ErrorCode.API_RATE_LIMIT]: 'Trop de requêtes. Veuillez patienter quelques instants.',\n      [ErrorCode.API_SERVER_ERROR]: 'Erreur serveur. Veuillez réessayer plus tard.',\n      [ErrorCode.API_NOT_FOUND]: 'Ressource introuvable.',\n      [ErrorCode.API_BAD_REQUEST]: 'Requête invalide.',\n\n      // Business\n      [ErrorCode.BUSINESS_LOGIC_ERROR]: 'Cette opération n\\'est pas autorisée dans le contexte actuel.',\n      [ErrorCode.RESOURCE_LOCKED]: 'Cette ressource est actuellement verrouillée.',\n      [ErrorCode.OPERATION_NOT_ALLOWED]: 'Cette opération n\\'est pas autorisée.',\n      [ErrorCode.QUOTA_EXCEEDED]: 'Vous avez atteint la limite autorisée.',\n\n      // System\n      [ErrorCode.INTERNAL_ERROR]: 'Une erreur interne est survenue. Veuillez réessayer.',\n      [ErrorCode.CONFIGURATION_ERROR]: 'Erreur de configuration du système.',\n      [ErrorCode.SERVICE_UNAVAILABLE]: 'Service temporairement indisponible.',\n    }\n\n    return messages[code] || 'Une erreur inattendue est survenue.'\n  }\n\n  /**\n   * Détermine si une erreur est retryable selon son code\n   */\n  private isRetryable(code: ErrorCode): boolean {\n    const retryableCodes = [\n      ErrorCode.NETWORK_ERROR,\n      ErrorCode.API_TIMEOUT,\n      ErrorCode.API_SERVER_ERROR,\n      ErrorCode.DB_CONNECTION_ERROR,\n      ErrorCode.SERVICE_UNAVAILABLE,\n    ]\n    return retryableCodes.includes(code)\n  }\n\n  /**\n   * Convertit l'erreur en objet JSON pour logging\n   */\n  toJSON() {\n    return {\n      name: this.name,\n      message: this.message,\n      code: this.code,\n      severity: this.severity,\n      userMessage: this.userMessage,\n      retryable: this.retryable,\n      context: this.context,\n      stack: this.stack,\n      originalError: this.originalError instanceof Error\n        ? {\n            name: this.originalError.name,\n            message: this.originalError.message,\n            stack: this.originalError.stack,\n          }\n        : this.originalError,\n    }\n  }\n}\n\n// ============================================================================\n// ERROR HANDLER PRINCIPAL\n// ============================================================================\n\nexport class ErrorHandler {\n  /**\n   * Analyse et classe une erreur inconnue\n   */\n  handleError(error: unknown, context: AppErrorContext = {}): AppError {\n    // Si c'est déjà une AppError, la retourner telle quelle\n    if (error instanceof AppError) {\n      this.logError(error)\n      return error\n    }\n\n    // Si c'est une Error standard, la convertir\n    if (error instanceof Error) {\n      return this.handleStandardError(error, context)\n    }\n\n    // Si c'est une erreur Supabase\n    if (this.isSupabaseError(error)) {\n      return this.handleSupabaseError(error, context)\n    }\n\n    // Erreur inconnue\n    const appError = new AppError(\n      'Une erreur inattendue est survenue.',\n      ErrorCode.INTERNAL_ERROR,\n      ErrorSeverity.HIGH,\n      context,\n      error\n    )\n    this.logError(appError)\n    return appError\n  }\n\n  /**\n   * Gère les erreurs Error standard\n   */\n  private handleStandardError(error: Error, context: AppErrorContext): AppError {\n    const message = error.message.toLowerCase()\n\n    // Détection par message\n    let code = ErrorCode.INTERNAL_ERROR\n    let severity = ErrorSeverity.MEDIUM\n\n    if (message.includes('network') || message.includes('fetch')) {\n      code = ErrorCode.NETWORK_ERROR\n      severity = ErrorSeverity.MEDIUM\n    } else if (message.includes('timeout')) {\n      code = ErrorCode.API_TIMEOUT\n      severity = ErrorSeverity.MEDIUM\n    } else if (message.includes('unauthorized') || message.includes('401')) {\n      code = ErrorCode.AUTH_REQUIRED\n      severity = ErrorSeverity.HIGH\n    } else if (message.includes('forbidden') || message.includes('403')) {\n      code = ErrorCode.AUTH_INSUFFICIENT_PERMISSIONS\n      severity = ErrorSeverity.HIGH\n    } else if (message.includes('not found') || message.includes('404')) {\n      code = ErrorCode.DB_NOT_FOUND\n      severity = ErrorSeverity.LOW\n    } else if (message.includes('validation') || message.includes('invalid')) {\n      code = ErrorCode.VALIDATION_ERROR\n      severity = ErrorSeverity.LOW\n    }\n\n    const appError = new AppError(error.message, code, severity, context, error)\n    this.logError(appError)\n    return appError\n  }\n\n  /**\n   * Gère les erreurs Supabase\n   */\n  private handleSupabaseError(error: any, context: AppErrorContext): AppError {\n    const code = error.code || error.status\n    const message = error.message || 'Erreur Supabase'\n\n    // Si un code d'erreur est fourni dans le contexte, l'utiliser en priorité\n    let errorCode = context.code || ErrorCode.DB_QUERY_ERROR\n    let severity = ErrorSeverity.MEDIUM\n\n    // Classification par code Supabase (seulement si pas de code dans le contexte)\n    if (!context.code) {\n      switch (code) {\n        case 'PGRST116':\n        case '42P01':\n          errorCode = ErrorCode.DB_NOT_FOUND\n          severity = ErrorSeverity.LOW\n          break\n        case '42501':\n          errorCode = ErrorCode.DB_RLS_POLICY_VIOLATION\n          severity = ErrorSeverity.HIGH\n          break\n        case '23505':\n          errorCode = ErrorCode.VALIDATION_UNIQUE_CONSTRAINT\n          severity = ErrorSeverity.LOW\n          break\n        case '23503':\n          errorCode = ErrorCode.DB_CONSTRAINT_VIOLATION\n          severity = ErrorSeverity.MEDIUM\n          break\n        case 'PGRST301':\n        case '400':\n          errorCode = ErrorCode.API_BAD_REQUEST\n          severity = ErrorSeverity.LOW\n          break\n        case '401':\n          errorCode = ErrorCode.AUTH_REQUIRED\n          severity = ErrorSeverity.HIGH\n          break\n        case '403':\n          errorCode = ErrorCode.AUTH_INSUFFICIENT_PERMISSIONS\n          severity = ErrorSeverity.HIGH\n          break\n        case '404':\n          errorCode = ErrorCode.API_NOT_FOUND\n          severity = ErrorSeverity.LOW\n          break\n        case '500':\n          errorCode = ErrorCode.API_SERVER_ERROR\n          severity = ErrorSeverity.HIGH\n          break\n      }\n    }\n\n    // Ajuster la sévérité selon le code d'erreur\n    if (errorCode === ErrorCode.DB_FOREIGN_KEY_CONSTRAINT) {\n      severity = ErrorSeverity.MEDIUM\n    }\n\n    const appError = new AppError(message, errorCode, severity, context, error)\n    this.logError(appError)\n    return appError\n  }\n\n  /**\n   * Vérifie si une erreur est une erreur Supabase\n   */\n  private isSupabaseError(error: any): boolean {\n    return (\n      error &&\n      (error.code || error.status || error.message) &&\n      (typeof error.code === 'string' || typeof error.status === 'number')\n    )\n  }\n\n  /**\n   * Log l'erreur selon sa sévérité\n   */\n  private logError(error: AppError) {\n    const logContext: LogContext = {\n      ...error.context,\n      code: error.code,\n      severity: error.severity,\n      retryable: error.retryable,\n    }\n\n    switch (error.severity) {\n      case ErrorSeverity.CRITICAL:\n      case ErrorSeverity.HIGH:\n        logger.error(error.message, error.originalError || error, logContext)\n        break\n      case ErrorSeverity.MEDIUM:\n        logger.warn(error.message, logContext)\n        break\n      case ErrorSeverity.LOW:\n        logger.info(`Error: ${error.message}`, logContext)\n        break\n    }\n  }\n\n  /**\n   * Crée une erreur de validation\n   */\n  createValidationError(message: string, field?: string): AppError {\n    return new AppError(\n      message,\n      ErrorCode.VALIDATION_ERROR,\n      ErrorSeverity.LOW,\n      { field, userMessage: message }\n    )\n  }\n\n  /**\n   * Crée une erreur d'authentification\n   */\n  createAuthError(code: ErrorCode, message?: string): AppError {\n    return new AppError(\n      message || 'Erreur d\\'authentification',\n      code,\n      ErrorSeverity.HIGH\n    )\n  }\n\n  /**\n   * Crée une erreur de base de données\n   */\n  createDatabaseError(message: string, originalError?: unknown): AppError {\n    return new AppError(\n      message,\n      ErrorCode.DB_QUERY_ERROR,\n      ErrorSeverity.MEDIUM,\n      {},\n      originalError\n    )\n  }\n\n  /**\n   * Crée une erreur \"Not Found\"\n   */\n  createNotFoundError(message: string, context?: AppErrorContext): AppError {\n    return new AppError(\n      message,\n      ErrorCode.DB_NOT_FOUND,\n      ErrorSeverity.LOW,\n      context\n    )\n  }\n}\n\n// Export d'une instance singleton\nexport const errorHandler = new ErrorHandler()\n\n// Export de fonctions helper pour faciliter l'utilisation\nexport const handleError = (error: unknown, context?: AppErrorContext) =>\n  errorHandler.handleError(error, context)\n\nexport const createValidationError = (message: string, field?: string) =>\n  errorHandler.createValidationError(message, field)\n\nexport const createAuthError = (code: ErrorCode, message?: string) =>\n  errorHandler.createAuthError(code, message)\n\nexport const createDatabaseError = (message: string, originalError?: unknown) =>\n  errorHandler.createDatabaseError(message, originalError)\n\nexport const createNotFoundError = (message: string, context?: AppErrorContext) =>\n  errorHandler.createNotFoundError(message, context)\n\n// Alias pour NotFoundError (compatibilité)\nexport const NotFoundError = createNotFoundError\n\n","/**\n * Helpers réutilisables pour les requêtes Supabase\n * \n * Réduit la duplication de code dans les services\n */\n\nimport { SupabaseClient } from '@supabase/supabase-js'\nimport { errorHandler, AppError, ErrorCode } from '@/lib/errors'\n\nexport interface GetAllByOrganizationOptions {\n  filters?: Record<string, unknown>\n  orderBy?: { column: string; ascending?: boolean }\n  select?: string\n  search?: { field: string; value: string }\n}\n\n/**\n * Récupère tous les enregistrements d'une organisation avec options\n */\nexport async function getAllByOrganization<T>(\n  supabase: SupabaseClient,\n  table: string,\n  organizationId: string,\n  options?: GetAllByOrganizationOptions\n): Promise<T[]> {\n  try {\n    let query = supabase\n      .from(table)\n      .select(options?.select || '*')\n      .eq('organization_id', organizationId)\n\n    // Appliquer les filtres\n    if (options?.filters) {\n      Object.entries(options.filters).forEach(([key, value]) => {\n        if (value !== undefined && value !== null) {\n          query = query.eq(key, value)\n        }\n      })\n    }\n\n    // Appliquer la recherche\n    if (options?.search) {\n      query = query.ilike(options.search.field, `%${options.search.value}%`)\n    }\n\n    // Appliquer le tri\n    if (options?.orderBy) {\n      query = query.order(options.orderBy.column, {\n        ascending: options.orderBy.ascending ?? false,\n      })\n    } else {\n      query = query.order('created_at', { ascending: false })\n    }\n\n    const { data, error } = await query\n\n    if (error) {\n      throw errorHandler.handleError(error, {\n        organizationId,\n        operation: 'getAllByOrganization',\n        table,\n      })\n    }\n\n    return (data || []) as T[]\n  } catch (error) {\n    if (error instanceof AppError) {\n      throw error\n    }\n    throw errorHandler.handleError(error, {\n      organizationId,\n      operation: 'getAllByOrganization',\n      table,\n    })\n  }\n}\n\n/**\n * Récupère un enregistrement par ID avec gestion d'erreur\n */\nexport async function getById<T>(\n  supabase: SupabaseClient,\n  table: string,\n  id: string,\n  select?: string\n): Promise<T> {\n  try {\n    const { data, error } = await supabase\n      .from(table)\n      .select(select || '*')\n      .eq('id', id)\n      .single()\n\n    if (error) {\n      if (error.code === 'PGRST116' || error.code === '42P01') {\n        throw errorHandler.handleError(error, {\n          code: ErrorCode.DB_NOT_FOUND,\n          operation: 'getById',\n          id,\n          table,\n        })\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'getById',\n        id,\n        table,\n      })\n    }\n\n    if (!data) {\n      throw errorHandler.createDatabaseError(\n        `Enregistrement avec l'ID ${id} introuvable dans ${table}`,\n        { id, table }\n      )\n    }\n\n    return data as T\n  } catch (error) {\n    if (error instanceof AppError) {\n      throw error\n    }\n    throw errorHandler.handleError(error, {\n      operation: 'getById',\n      id,\n      table,\n    })\n  }\n}\n\n","/**\n * Validateurs réutilisables pour les données\n * \n * Réduit la duplication de code pour la validation\n */\n\nimport { errorHandler } from '@/lib/errors'\n\n/**\n * Valide que les champs requis sont présents\n */\nexport function validateRequired<T extends Record<string, unknown>>(\n  data: T,\n  fields: (keyof T)[]\n): void {\n  for (const field of fields) {\n    if (!data[field]) {\n      throw errorHandler.createValidationError(\n        `Le champ ${String(field)} est obligatoire`,\n        String(field)\n      )\n    }\n  }\n}\n\n/**\n * Valide qu'un email est valide\n */\nexport function validateEmail(email: string): void {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/\n  if (!emailRegex.test(email)) {\n    throw errorHandler.createValidationError(\n      'Format d\\'email invalide',\n      'email'\n    )\n  }\n}\n\n/**\n * Valide qu'un montant est positif\n */\nexport function validatePositiveAmount(amount: number, fieldName = 'amount'): void {\n  if (amount <= 0) {\n    throw errorHandler.createValidationError(\n      'Le montant doit être supérieur à 0',\n      fieldName\n    )\n  }\n}\n\n/**\n * Valide qu'une date est valide\n */\nexport function validateDate(date: string, fieldName = 'date'): void {\n  const dateObj = new Date(date)\n  if (isNaN(dateObj.getTime())) {\n    throw errorHandler.createValidationError(\n      'Format de date invalide',\n      fieldName\n    )\n  }\n}\n\n/**\n * Valide qu'une date est dans le futur\n */\nexport function validateFutureDate(date: string, fieldName = 'date'): void {\n  validateDate(date, fieldName)\n  const dateObj = new Date(date)\n  const now = new Date()\n  if (dateObj <= now) {\n    throw errorHandler.createValidationError(\n      'La date doit être dans le futur',\n      fieldName\n    )\n  }\n}\n\n\n\n\n\n","import { createClient } from '@/lib/supabase/client'\nimport type { SupabaseClient } from '@supabase/supabase-js'\nimport { Database } from '@/types/database.types'\nimport type { TableRow, TableInsert, TableUpdate, FlexibleInsert, FlexibleUpdate } from '@/lib/types/supabase-helpers'\nimport { errorHandler, ErrorCode, AppError } from '@/lib/errors'\nimport { logger } from '@/lib/utils/logger'\nimport { getAllByOrganization, getById } from '@/lib/utils/supabase-helpers'\nimport { generateUniqueNumber } from '@/lib/utils/number-generator'\nimport { validateRequired } from '@/lib/utils/validators'\n\ntype Student = TableRow<'students'>\ntype StudentInsert = TableInsert<'students'>\ntype StudentUpdate = TableUpdate<'students'>\n\n/**\n * Service de gestion des étudiants\n * \n * Fournit des méthodes pour CRUD des étudiants avec :\n * - Pagination côté serveur\n * - Recherche textuelle (nom, prénom, numéro, email)\n * - Filtrage par classe et statut\n * - Génération automatique de numéros d'étudiant uniques\n */\nexport class StudentService {\n  private supabase: SupabaseClient<Database>\n\n\n  constructor(supabaseClient?: SupabaseClient<Database>) {\n\n    this.supabase = supabaseClient || createClient()\n\n  }\n\n  /**\n   * Récupère tous les étudiants d'une organisation avec pagination\n   * \n   * @param organizationId - ID de l'organisation\n   * @param filters - Filtres optionnels (classe, statut, recherche, pagination)\n   * @returns Objet avec data, total, page, limit, totalPages\n   */\n  async getAll(organizationId: string, filters?: {\n    classId?: string\n    status?: Student['status']\n    search?: string\n    page?: number\n    limit?: number\n  }) {\n    try {\n      const page = filters?.page || 1\n      const limit = filters?.limit || 50\n      const offset = (page - 1) * limit\n\n      // Pour la recherche, on doit utiliser une requête personnalisée car elle utilise `or`\n      if (filters?.search) {\n        let query = this.supabase\n          .from('students')\n          .select('*, classes(id, name, level)', { count: 'exact' })\n          .eq('organization_id', organizationId)\n          .or(`first_name.ilike.%${filters.search}%,last_name.ilike.%${filters.search}%,student_number.ilike.%${filters.search}%`)\n\n        if (filters?.classId) query = query.eq('class_id', filters.classId)\n        if (filters?.status) query = query.eq('status', filters.status)\n\n        const { data, error, count } = await query\n          .order('last_name', { ascending: true })\n          .range(offset, offset + limit - 1)\n\n        if (error) {\n          throw errorHandler.handleError(error, {\n            organizationId,\n            operation: 'getAll',\n            filters,\n          })\n        }\n\n        return {\n          data: data || [],\n          total: count || 0,\n          page,\n          limit,\n          totalPages: Math.ceil((count || 0) / limit),\n        }\n      }\n\n      // Sinon, utiliser une requête avec pagination\n      let query = this.supabase\n        .from('students')\n        .select('*, classes(id, name, level)', { count: 'exact' })\n        .eq('organization_id', organizationId)\n\n      if (filters?.classId) query = query.eq('class_id', filters.classId)\n      if (filters?.status) query = query.eq('status', filters.status)\n\n      const { data, error, count } = await query\n        .order('last_name', { ascending: true })\n        .range(offset, offset + limit - 1)\n\n      if (error) {\n        throw errorHandler.handleError(error, {\n          organizationId,\n          operation: 'getAll',\n          filters,\n        })\n      }\n\n      return {\n        data: data || [],\n        total: count || 0,\n        page,\n        limit,\n        totalPages: Math.ceil((count || 0) / limit),\n      }\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        organizationId,\n        operation: 'getAll',\n      })\n    }\n  }\n\n  /**\n   * Récupère un étudiant par son ID\n   */\n  async getById(id: string) {\n    try {\n      // Utiliser le helper pour réduire la duplication\n      return getById<Student>(\n        this.supabase,\n        'students',\n        id,\n        '*, classes(id, name, level)'\n      )\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'getById',\n        id,\n      })\n    }\n  }\n\n  /**\n   * Récupère un étudiant par son numéro\n   */\n  async getByNumber(organizationId: string, studentNumber: string) {\n    try {\n      const { data, error } = await this.supabase\n        .from('students')\n        .select('*')\n        .eq('organization_id', organizationId)\n        .eq('student_number', studentNumber)\n        .single()\n\n      if (error) {\n        if (error.code === 'PGRST116' || error.code === '42P01') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_NOT_FOUND,\n            operation: 'getByNumber',\n            organizationId,\n            studentNumber,\n          })\n        }\n        throw errorHandler.handleError(error, {\n          operation: 'getByNumber',\n          organizationId,\n          studentNumber,\n        })\n      }\n\n      return data\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'getByNumber',\n        organizationId,\n        studentNumber,\n      })\n    }\n  }\n\n  /**\n   * Crée un nouvel étudiant\n   */\n  async create(student: FlexibleInsert<'students'>) {\n    try {\n      // Validation avec helper\n      validateRequired(student, ['first_name', 'last_name', 'organization_id'])\n\n      // Générer un numéro d'étudiant si non fourni\n      let studentNumber = student.student_number\n      if (!studentNumber || studentNumber.trim() === '') {\n        // Récupérer le code de l'organisation\n        const orgId = student.organization_id\n        if (!orgId) throw new Error('organization_id is required')\n        \n        const { data: org } = await this.supabase\n          .from('organizations')\n          .select('code')\n          .eq('id', orgId)\n          .single()\n\n        const orgCode = org?.code || 'ORG'\n        const year = new Date().getFullYear().toString().slice(-2)\n\n        // Générer le numéro avec le helper\n        studentNumber = await generateUniqueNumber(\n          this.supabase,\n          'students',\n          orgId,\n          {\n            prefix: 'EDU',\n            orgCode,\n            year,\n            padding: 6,\n            fieldName: 'student_number',\n          }\n        )\n      }\n\n      const studentData = {\n        ...student,\n        student_number: studentNumber,\n      } as StudentInsert\n\n      const { data, error } = await this.supabase\n        .from('students')\n        .insert(studentData)\n        .select()\n        .single()\n\n      if (error) {\n        if (error.code === '23505') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,\n            operation: 'create',\n            field: 'student_number',\n          })\n        }\n        if (error.code === '42501') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_RLS_POLICY_VIOLATION,\n            operation: 'create',\n          })\n        }\n        throw errorHandler.handleError(error, {\n          operation: 'create',\n          student,\n        })\n      }\n\n      logger.info('Étudiant créé avec succès', {\n        id: data?.id,\n        organizationId: student.organization_id || undefined,\n        studentNumber: data?.student_number,\n      })\n\n      return data\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'create',\n        student,\n      })\n    }\n  }\n\n  /**\n   * Met à jour un étudiant\n   */\n  async update(id: string, updates: FlexibleUpdate<'students'>) {\n    try {\n      // Nettoyer les valeurs avant la mise à jour\n      const cleanUpdates = { ...updates }\n      \n      // Convertir les chaînes vides en null pour class_id (pour éviter les erreurs de contrainte FK)\n      if ('class_id' in cleanUpdates) {\n        if (cleanUpdates.class_id === '' || !cleanUpdates.class_id) {\n          cleanUpdates.class_id = null\n        } else {\n          // Vérifier si class_id existe dans la table classes\n          // Si ce n'est pas le cas, cela pourrait être une session ID, on le met à null\n          const { data: classExists, error: classError } = await this.supabase\n            .from('classes')\n            .select('id')\n            .eq('id', cleanUpdates.class_id)\n            .maybeSingle()\n          \n          // Si la classe n'existe pas, on met class_id à null\n          // (car class_id ne devrait pas référencer une session)\n          if (!classExists && !classError) {\n            cleanUpdates.class_id = null\n          }\n        }\n      }\n\n      const { data, error } = await this.supabase\n        .from('students')\n        .update(cleanUpdates as StudentUpdate)\n        .eq('id', id)\n        .select()\n        .single()\n\n      if (error) {\n        if (error.code === 'PGRST116' || error.code === '42P01') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_NOT_FOUND,\n            operation: 'update',\n            id,\n          })\n        }\n        if (error.code === '42501') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_RLS_POLICY_VIOLATION,\n            operation: 'update',\n            id,\n          })\n        }\n        throw errorHandler.handleError(error, {\n          operation: 'update',\n          id,\n          updates,\n        })\n      }\n\n      if (!data) {\n        throw errorHandler.createDatabaseError(\n          `Étudiant avec l'ID ${id} introuvable pour la mise à jour`,\n          { id }\n        )\n      }\n\n      logger.info('Étudiant mis à jour avec succès', {\n        id,\n        updates,\n      })\n\n      return data\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'update',\n        id,\n        updates,\n      })\n    }\n  }\n\n  /**\n   * Supprime un étudiant (soft delete en changeant le statut)\n   */\n  async delete(id: string) {\n    return this.update(id, { status: 'inactive' })\n  }\n\n  /**\n   * Importe plusieurs étudiants depuis un fichier CSV/Excel\n   */\n  async import(organizationId: string, students: FlexibleInsert<'students'>[]) {\n    try {\n      if (!students || students.length === 0) {\n        throw errorHandler.createValidationError(\n          'Aucun étudiant à importer',\n          'students'\n        )\n      }\n\n      // Récupérer le code de l'organisation pour générer les numéros\n      const { data: org } = await this.supabase\n        .from('organizations')\n        .select('code')\n        .eq('id', organizationId)\n        .single()\n\n      const orgCode = org?.code || 'ORG'\n      const year = new Date().getFullYear().toString().slice(-2)\n\n      // Générer les numéros d'étudiants pour ceux qui n'en ont pas\n      const studentsWithNumbers = await Promise.all(\n        students.map(async (student) => {\n          if (student.student_number && student.student_number.trim() !== '') {\n            return student\n          }\n\n          // Générer un numéro unique\n          const studentNumber = await generateUniqueNumber(\n            this.supabase,\n            'students',\n            organizationId,\n            {\n              prefix: 'EDU',\n              orgCode,\n              year,\n              padding: 6,\n              fieldName: 'student_number',\n            }\n          )\n\n          return {\n            ...student,\n            student_number: studentNumber,\n          }\n        })\n      )\n\n      const { data, error } = await this.supabase\n        .from('students')\n        .insert(studentsWithNumbers as StudentInsert[])\n        .select()\n\n      if (error) {\n        if (error.code === '23505') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,\n            operation: 'import',\n            field: 'student_number',\n          })\n        }\n        throw errorHandler.handleError(error, {\n          operation: 'import',\n          organizationId,\n          count: students.length,\n        })\n      }\n\n      logger.info('Étudiants importés avec succès', {\n        organizationId,\n        count: data?.length || 0,\n      })\n\n      return data || []\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'import',\n        organizationId,\n      })\n    }\n  }\n}\n\nexport const studentService = new StudentService()\n\n","/**\n * Générateur de numéros uniques pour factures, étudiants, etc.\n * \n * Réduit la duplication de code pour la génération de numéros\n */\n\nimport { SupabaseClient } from '@supabase/supabase-js'\nimport { errorHandler } from '@/lib/errors'\n\nexport interface GenerateUniqueNumberOptions {\n  prefix: string\n  orgCode: string\n  year?: string\n  padding?: number\n  fieldName?: string\n}\n\n/**\n * Génère un numéro unique pour une table\n */\nexport async function generateUniqueNumber(\n  supabase: SupabaseClient,\n  table: string,\n  organizationId: string,\n  options: GenerateUniqueNumberOptions\n): Promise<string> {\n  try {\n    const year = options.year || new Date().getFullYear().toString().slice(-2)\n    const padding = options.padding || 6\n    const fieldName = options.fieldName || 'number'\n    const pattern = `${options.prefix}-${options.orgCode}-${year}-%`\n\n    const { data: lastRecord, error } = await supabase\n      .from(table)\n      .select(fieldName)\n      .eq('organization_id', organizationId)\n      .like(fieldName, pattern)\n      .order(fieldName, { ascending: false })\n      .limit(1)\n      .maybeSingle()\n\n    if (error && error.code !== 'PGRST116' && error.code !== '42P01') {\n      throw errorHandler.handleError(error, {\n        operation: 'generateUniqueNumber',\n        table,\n        organizationId,\n      })\n    }\n\n    let sequence = 1\n    if (lastRecord && (lastRecord as any)[fieldName]) {\n      const parts = String((lastRecord as any)[fieldName]).split('-')\n      const lastSequence = parseInt(parts[parts.length - 1] || '0', 10)\n      sequence = lastSequence + 1\n    }\n\n    return `${options.prefix}-${options.orgCode}-${year}-${String(sequence).padStart(padding, '0')}`\n  } catch (error) {\n    throw errorHandler.handleError(error, {\n      operation: 'generateUniqueNumber',\n      table,\n      organizationId,\n    })\n  }\n}\n\n\n\n\n\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Link\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTAgMTNhNSA1IDAgMCAwIDcuNTQuNTRsMy0zYTUgNSAwIDAgMC03LjA3LTcuMDdsLTEuNzIgMS43MSIgLz4KICA8cGF0aCBkPSJNMTQgMTFhNSA1IDAgMCAwLTcuNTQtLjU0bC0zIDNhNSA1IDAgMCAwIDcuMDcgNy4wN2wxLjcxLTEuNzEiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/link\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Link = createLucideIcon('Link', [\n  ['path', { d: 'M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71', key: '1cjeqo' }],\n  ['path', { d: 'M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71', key: '19qd67' }],\n]);\n\nexport default Link;\n","import { createClient } from '@/lib/supabase/client'\nimport type { SupabaseClient } from '@supabase/supabase-js'\nimport { Database } from '@/types/database.types'\nimport { errorHandler, ErrorCode, AppError } from '@/lib/errors'\nimport { logger } from '@/lib/utils/logger'\nimport { getAllByOrganization, getById } from '@/lib/utils/supabase-helpers'\nimport { generateUniqueNumber } from '@/lib/utils/number-generator'\nimport { validateRequired, validatePositiveAmount } from '@/lib/utils/validators'\n\ntype Invoice = Database['public']['Tables']['invoices']['Row']\ntype InvoiceInsert = Database['public']['Tables']['invoices']['Insert']\ntype InvoiceUpdate = Database['public']['Tables']['invoices']['Update']\n\nexport class InvoiceService {\n  private supabase: SupabaseClient<Database>\n\n\n  constructor(supabaseClient?: SupabaseClient<Database>) {\n\n    this.supabase = supabaseClient || createClient()\n\n  }\n\n  /**\n   * Récupère toutes les factures d'une organisation\n   */\n  async getAll(organizationId: string, filters?: {\n    studentId?: string\n    status?: Invoice['status']\n    search?: string\n    documentType?: 'quote' | 'invoice'\n  }) {\n    try {\n      // Utiliser le helper pour réduire la duplication\n      const filtersMap: Record<string, unknown> = {}\n      if (filters?.studentId) filtersMap.student_id = filters.studentId\n      if (filters?.status) filtersMap.status = filters.status\n      if (filters?.documentType) filtersMap.document_type = filters.documentType\n\n      return getAllByOrganization<Invoice>(\n        this.supabase,\n        'invoices',\n        organizationId,\n        {\n          select: '*, students(id, first_name, last_name, student_number), payments(id, amount, status, paid_at)',\n          filters: filtersMap,\n          search: filters?.search ? { field: 'invoice_number', value: filters.search } : undefined,\n          orderBy: { column: 'issue_date', ascending: false },\n        }\n      )\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        organizationId,\n        operation: 'getAll',\n      })\n    }\n  }\n\n  /**\n   * Récupère une facture par son ID\n   */\n  async getById(id: string) {\n    try {\n      // Utiliser le helper pour réduire la duplication\n      return getById<Invoice>(\n        this.supabase,\n        'invoices',\n        id,\n        '*, students(*), enrollments(*), payments(*)'\n      )\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'getById',\n        id,\n      })\n    }\n  }\n\n  /**\n   * Génère un numéro de facture unique\n   */\n  private async generateInvoiceNumber(organizationId: string, documentType: 'quote' | 'invoice' = 'invoice'): Promise<string> {\n    const year = new Date().getFullYear().toString()\n    \n    // Trouver le dernier numéro pour cette organisation et ce type pour l'année en cours\n    // Format recherché: ANNEE-NUMERO (ex: 2025-001)\n    const { data: lastInvoice } = await this.supabase\n      .from('invoices')\n      .select('invoice_number')\n      .eq('organization_id', organizationId)\n      .eq('document_type', documentType)\n      .like('invoice_number', `${year}-%`)\n      .order('invoice_number', { ascending: false })\n      .limit(1)\n      .maybeSingle()\n\n    let sequence = 1\n    if (lastInvoice?.invoice_number) {\n      // Extraire le numéro de séquence du format ANNEE-NUMERO\n      const parts = lastInvoice.invoice_number.split('-')\n      if (parts.length >= 2 && parts[0] === year) {\n        const lastSequence = parseInt(parts[1] || '0', 10)\n        sequence = lastSequence + 1\n      }\n    }\n\n    // Format: ANNEE-NUMERO avec 3 chiffres (ex: 2025-001, 2025-002, etc.)\n    return `${year}-${String(sequence).padStart(3, '0')}`\n  }\n\n  /**\n   * Crée une nouvelle facture\n   */\n  async create(invoice: InvoiceInsert) {\n    try {\n      // Utiliser le helper de validation pour réduire la duplication\n      validateRequired(invoice, ['organization_id', 'student_id'])\n\n      // Générer le numéro de facture si vide ou non fourni\n      const invoiceData = invoice as InvoiceInsert & { invoice_number?: string; document_type?: 'quote' | 'invoice' }\n      let invoiceNumber = invoiceData.invoice_number\n      if (!invoiceNumber || invoiceNumber.trim() === '') {\n        const orgId = invoice.organization_id\n        if (!orgId) {\n          throw errorHandler.createValidationError('Organization ID is required to create an invoice.')\n        }\n        invoiceNumber = await this.generateInvoiceNumber(\n          orgId,\n          invoiceData.document_type || 'invoice'\n        )\n      }\n\n      const { data, error } = await this.supabase\n        .from('invoices')\n        .insert({\n          ...invoice,\n          invoice_number: invoiceNumber,\n        } as InvoiceInsert)\n        .select()\n        .single()\n\n      if (error) {\n        if (error.code === '23505') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,\n            operation: 'create',\n            field: 'invoice_number',\n          })\n        }\n        if (error.code === '42501') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_RLS_POLICY_VIOLATION,\n            operation: 'create',\n          })\n        }\n        throw errorHandler.handleError(error, {\n          operation: 'create',\n          invoice,\n        })\n      }\n\n      logger.info('Facture créée avec succès', {\n        id: data?.id,\n        organizationId: invoice.organization_id || undefined,\n        invoiceNumber: data?.invoice_number,\n      })\n\n      return data\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'create',\n        invoice,\n      })\n    }\n  }\n\n  /**\n   * Met à jour une facture\n   */\n  async update(id: string, updates: InvoiceUpdate) {\n    try {\n      const { data, error } = await this.supabase\n        .from('invoices')\n        .update(updates)\n        .eq('id', id)\n        .select()\n        .single()\n\n      if (error) {\n        if (error.code === 'PGRST116' || error.code === '42P01') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_NOT_FOUND,\n            operation: 'update',\n            id,\n          })\n        }\n        if (error.code === '42501') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_RLS_POLICY_VIOLATION,\n            operation: 'update',\n            id,\n          })\n        }\n        throw errorHandler.handleError(error, {\n          operation: 'update',\n          id,\n          updates,\n        })\n      }\n\n      if (!data) {\n        throw errorHandler.createDatabaseError(\n          `Facture avec l'ID ${id} introuvable pour la mise à jour`,\n          { id }\n        )\n      }\n\n      logger.info('Facture mise à jour avec succès', {\n        id,\n        updates,\n      })\n\n      return data\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'update',\n        id,\n        updates,\n      })\n    }\n  }\n\n  /**\n   * Génère des factures en masse pour une classe\n   */\n  async generateForClass(\n    organizationId: string,\n    classId: string,\n    amount: number,\n    currency: string,\n    dueDate: string,\n    type: 'tuition' | 'registration' | 'other' = 'tuition'\n  ) {\n    // Récupérer tous les élèves actifs de la classe\n    const { data: students, error: studentsError } = await this.supabase\n      .from('students')\n      .select('id')\n      .eq('organization_id', organizationId)\n      .eq('class_id', classId)\n      .eq('status', 'active')\n\n    if (studentsError) {\n      throw errorHandler.handleError(studentsError, {\n        operation: 'generateForClass',\n        organizationId,\n        classId,\n        step: 'fetchStudents',\n      })\n    }\n    if (!students || students.length === 0) {\n      throw errorHandler.createValidationError(\n        'Aucun élève actif dans cette classe',\n        'classId'\n      )\n    }\n\n    // Générer le préfixe de numéro\n    const { data: organization } = await this.supabase\n      .from('organizations')\n      .select('code')\n      .eq('id', organizationId)\n      .single()\n\n    const orgCode = organization?.code || 'ORG'\n    const year = new Date().getFullYear().toString().slice(-2)\n    const prefix = 'FAC'\n    \n    // Trouver le dernier numéro pour cette organisation\n    const { data: lastInvoice } = await this.supabase\n      .from('invoices')\n      .select('invoice_number')\n      .eq('organization_id', organizationId)\n      .like('invoice_number', `${prefix}-${orgCode}-${year}-%`)\n      .order('invoice_number', { ascending: false })\n      .limit(1)\n      .maybeSingle()\n\n    let sequence = 1\n    if (lastInvoice?.invoice_number) {\n      const parts = lastInvoice.invoice_number.split('-')\n      const lastSequence = parseInt(parts[parts.length - 1] || '0')\n      sequence = lastSequence + 1\n    }\n\n    // Générer les factures avec numéros uniques\n    const invoices = students.map((student, index) => ({\n      organization_id: organizationId,\n      student_id: student.id,\n      invoice_number: `${prefix}-${orgCode}-${year}-${String(sequence + index).padStart(6, '0')}`,\n      type,\n      document_type: 'invoice' as const,\n      issue_date: new Date().toISOString().split('T')[0],\n      due_date: dueDate,\n      amount: amount,\n      tax_amount: 0,\n      total_amount: amount,\n      currency,\n      status: 'draft' as const,\n      items: [],\n    }))\n\n    const { data, error } = await this.supabase\n      .from('invoices')\n      .insert(invoices as InvoiceInsert[])\n      .select()\n\n    if (error) {\n      throw errorHandler.handleError(error, {\n        operation: 'generateForClass',\n        organizationId,\n        classId,\n        count: invoices.length,\n      })\n    }\n\n    logger.info('Factures générées en masse avec succès', {\n      organizationId,\n      classId,\n      count: data?.length || 0,\n    })\n\n    return data || []\n  }\n\n  /**\n   * Récupère les factures impayées (overdue)\n   */\n  async getOverdue(organizationId: string) {\n    const today = new Date().toISOString().split('T')[0]\n\n    try {\n      const { data, error } = await this.supabase\n        .from('invoices')\n        .select('*, students(id, first_name, last_name, student_number)') // ✅ Jointure optimisée\n        .eq('organization_id', organizationId)\n        .eq('document_type', 'invoice') // Seulement les factures, pas les devis\n        .in('status', ['sent', 'partial'])\n        .lt('due_date', today)\n        .order('due_date', { ascending: true })\n\n      if (error) {\n        throw errorHandler.handleError(error, {\n          operation: 'getOverdue',\n          organizationId,\n        })\n      }\n\n      return data || []\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'getOverdue',\n        organizationId,\n      })\n    }\n  }\n\n  /**\n   * Transforme un devis en facture\n   */\n  async convertQuoteToInvoice(quoteId: string) {\n    try {\n    const { data: quote, error: quoteError } = await this.supabase\n      .from('invoices')\n      .select('*')\n      .eq('id', quoteId)\n      .eq('document_type', 'quote')\n      .single()\n\n    if (quoteError) {\n      if (quoteError.code === 'PGRST116' || quoteError.code === '42P01') {\n        throw errorHandler.handleError(quoteError, {\n          code: ErrorCode.DB_NOT_FOUND,\n          operation: 'convertQuoteToInvoice',\n          quoteId,\n        })\n      }\n      throw errorHandler.handleError(quoteError, {\n        operation: 'convertQuoteToInvoice',\n        quoteId,\n        step: 'fetchQuote',\n      })\n    }\n    if (!quote) {\n      throw errorHandler.createDatabaseError(\n        `Devis avec l'ID ${quoteId} introuvable`,\n        { quoteId }\n      )\n    }\n\n    // Mettre à jour le devis pour en faire une facture\n    const { data, error } = await this.supabase\n      .from('invoices')\n      .update({\n        document_type: 'invoice',\n        status: 'draft', // Facture créée en brouillon, à envoyer ensuite\n        issue_date: quote.issue_date || new Date().toISOString().split('T')[0],\n      })\n      .eq('id', quoteId)\n      .select()\n      .single()\n\n    if (error) {\n      throw errorHandler.handleError(error, {\n        operation: 'convertQuoteToInvoice',\n        quoteId,\n        step: 'updateInvoice',\n      })\n    }\n\n    logger.info('Devis converti en facture avec succès', {\n      quoteId,\n      invoiceId: data?.id,\n    })\n\n    return data\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'convertQuoteToInvoice',\n        quoteId,\n      })\n    }\n  }\n}\n\nexport const invoiceService = new InvoiceService()\n\n","import { createClient } from '@/lib/supabase/client'\nimport type { SupabaseClient } from '@supabase/supabase-js'\nimport { Database } from '@/types/database.types'\nimport type { TableRow, TableInsert, TableUpdate, FlexibleInsert, FlexibleUpdate } from '@/lib/types/supabase-helpers'\nimport { isValidPaymentAmount, calculateInvoiceStatus } from '@/lib/utils/payment-calculations'\nimport { errorHandler, ErrorCode, AppError } from '@/lib/errors'\nimport { logger } from '@/lib/utils/logger'\nimport { getAllByOrganization, getById } from '@/lib/utils/supabase-helpers'\n\ntype Payment = TableRow<'payments'>\ntype PaymentInsert = TableInsert<'payments'>\ntype PaymentUpdate = TableUpdate<'payments'>\ntype Invoice = TableRow<'invoices'>\n\n/**\n * Service de gestion des paiements\n * \n * Gère les paiements avec :\n * - Validation des montants et devises\n * - Mise à jour automatique du statut des factures\n * - Support de multiples méthodes de paiement (Stripe, SEPA, Mobile Money, cash)\n * - Gestion gracieuse des erreurs de relations manquantes\n */\nexport class PaymentService {\n  private supabase: SupabaseClient<Database>\n\n\n  constructor(supabaseClient?: SupabaseClient<Database>) {\n\n    this.supabase = supabaseClient || createClient()\n\n  }\n\n  /**\n   * Récupère tous les paiements d'une organisation\n   * \n   * @param organizationId - ID de l'organisation\n   * @param filters - Filtres optionnels (facture, étudiant, statut)\n   * @returns Liste des paiements avec relations (factures, étudiants)\n   */\n  async getAll(organizationId: string, filters?: {\n    invoiceId?: string\n    studentId?: string\n    status?: Payment['status']\n  }) {\n    try {\n      // Utiliser le helper pour réduire la duplication\n      const filtersMap: Record<string, unknown> = {}\n      if (filters?.invoiceId) filtersMap.invoice_id = filters.invoiceId\n      if (filters?.studentId) filtersMap.student_id = filters.studentId\n      if (filters?.status) filtersMap.status = filters.status\n\n      try {\n        return await getAllByOrganization<Payment>(\n          this.supabase,\n          'payments',\n          organizationId,\n          {\n            select: '*, invoices(*), students(id, first_name, last_name, student_number)',\n            filters: filtersMap,\n            orderBy: { column: 'created_at', ascending: false },\n          }\n        )\n      } catch (error) {\n        // Gestion gracieuse si la table n'existe pas encore ou si les relations sont manquantes\n        const errorCode = (error as any)?.code || (error as any)?.originalError?.code\n        const errorMessage = (error as any)?.message || String(error)\n        \n        // Vérifier les codes d'erreur Supabase et les messages d'erreur liés aux relations\n        if (\n          errorCode === 'PGRST116' || \n          errorCode === '42P01' || \n          errorCode === 'PGRST200' ||\n          errorCode === 'PGRST301' ||\n          errorCode === '400' ||\n          errorMessage?.includes('relation') ||\n          errorMessage?.includes('relationship') ||\n          errorMessage?.includes('does not exist') ||\n          errorMessage?.includes('schema cache')\n        ) {\n          logger.warn('Payments table or relations not available, returning empty array', {\n            organizationId,\n            errorCode,\n            errorMessage,\n          })\n          return []\n        }\n        \n        // Si c'est une AppError, vérifier aussi dans originalError et context\n        if (error instanceof AppError) {\n          const originalError = error.originalError as { code?: string; message?: string } | undefined\n          if (originalError) {\n            const origCode = originalError.code\n            const origMessage = originalError.message || ''\n            if (\n              origCode === 'PGRST116' || \n              origCode === '42P01' || \n              origCode === 'PGRST200' ||\n              origCode === 'PGRST301' ||\n              origCode === '400' ||\n              origMessage.includes('relation') ||\n              origMessage.includes('relationship') ||\n              origMessage.includes('does not exist') ||\n              origMessage.includes('schema cache')\n            ) {\n              logger.warn('Payments table or relations not available (from AppError.originalError), returning empty array', {\n                organizationId,\n                errorCode: origCode,\n                errorMessage: origMessage,\n              })\n              return []\n            }\n          }\n          const contextCode = (error.context as { code?: string })?.code\n          if (contextCode === 'PGRST116' || contextCode === '42P01' || contextCode === 'PGRST200' || contextCode === 'PGRST301' || contextCode === '400') {\n            logger.warn('Payments table or relations not available (from AppError.context), returning empty array', {\n              organizationId,\n              errorCode: contextCode,\n            })\n            return []\n          }\n        }\n        throw error\n      }\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        organizationId,\n        operation: 'getAll',\n      })\n    }\n  }\n\n  /**\n   * Récupère un paiement par son ID\n   */\n  async getById(id: string) {\n    try {\n      // Utiliser le helper pour réduire la duplication\n      return getById<Payment>(\n        this.supabase,\n        'payments',\n        id,\n        '*, invoices(*), students(*)'\n      )\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'getById',\n        id,\n      })\n    }\n  }\n\n  /**\n   * Crée un nouveau paiement\n   */\n  async create(payment: FlexibleInsert<'payments'>) {\n    try {\n      // Validation\n      if (!payment.amount || Number(payment.amount) <= 0) {\n        throw errorHandler.createValidationError(\n          'Le montant doit être supérieur à 0',\n          'amount'\n        )\n      }\n\n      if (!payment.organization_id) {\n        throw errorHandler.createValidationError(\n          'L\\'organisation est obligatoire',\n          'organization_id'\n        )\n      }\n\n      const { data, error } = await this.supabase\n        .from('payments')\n        .insert(payment as PaymentInsert)\n        .select()\n        .single()\n\n      if (error) {\n        if (error.code === '23505') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,\n            operation: 'create',\n            field: 'transaction_id',\n          })\n        }\n        if (error.code === '42501') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_RLS_POLICY_VIOLATION,\n            operation: 'create',\n          })\n        }\n        throw errorHandler.handleError(error, {\n          operation: 'create',\n          payment,\n        })\n      }\n\n      // Mettre à jour le montant payé de la facture et son statut\n      if (payment.invoice_id) {\n        await this.updateInvoicePaymentStatus(payment.invoice_id)\n      }\n\n      logger.info('Paiement créé avec succès', {\n        id: data?.id,\n        organizationId: payment.organization_id,\n        amount: payment.amount,\n      })\n\n      return data\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'create',\n        payment,\n      })\n    }\n  }\n\n  /**\n   * Met à jour un paiement\n   */\n  async update(id: string, updates: FlexibleUpdate<'payments'>) {\n    try {\n      const { data, error } = await this.supabase\n        .from('payments')\n        .update(updates as PaymentUpdate)\n        .eq('id', id)\n        .select()\n        .single()\n\n      if (error) {\n        if (error.code === 'PGRST116' || error.code === '42P01') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_NOT_FOUND,\n            operation: 'update',\n            id,\n          })\n        }\n        if (error.code === '42501') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_RLS_POLICY_VIOLATION,\n            operation: 'update',\n            id,\n          })\n        }\n        throw errorHandler.handleError(error, {\n          operation: 'update',\n          id,\n          updates,\n        })\n      }\n\n      if (!data) {\n        throw errorHandler.createDatabaseError(\n          `Paiement avec l'ID ${id} introuvable pour la mise à jour`,\n          { id }\n        )\n      }\n\n      // Mettre à jour le montant payé de la facture et son statut\n      if (updates.status === 'completed' || updates.status === 'failed') {\n        const payment = await this.getById(id)\n        if (payment && typeof payment === 'object' && 'invoice_id' in payment) {\n          const invoiceId = (payment as { invoice_id?: string }).invoice_id\n          if (invoiceId) {\n            await this.updateInvoicePaymentStatus(invoiceId)\n          }\n        }\n      }\n\n      logger.info('Paiement mis à jour avec succès', {\n        id,\n        updates,\n      })\n\n      return data\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'update',\n        id,\n        updates,\n      })\n    }\n  }\n\n  /**\n   * Met à jour le statut et le montant payé d'une facture\n   */\n  private async updateInvoicePaymentStatus(invoiceId: string) {\n    try {\n      // Calculer le total payé\n      const { data: payments, error: paymentsError } = await this.supabase\n        .from('payments')\n        .select('amount')\n        .eq('invoice_id', invoiceId)\n        .eq('status', 'completed')\n\n      if (paymentsError) {\n        throw errorHandler.handleError(paymentsError, {\n          operation: 'updateInvoicePaymentStatus',\n          invoiceId,\n          step: 'fetchPayments',\n        })\n      }\n\n      const totalPaid = payments?.reduce((sum, p) => sum + Number(p.amount), 0) || 0\n\n      // Récupérer la facture\n      const { data: invoice, error: invoiceError } = await this.supabase\n        .from('invoices')\n        .select('total_amount')\n        .eq('id', invoiceId)\n        .single()\n\n      if (invoiceError) {\n        throw errorHandler.handleError(invoiceError, {\n          operation: 'updateInvoicePaymentStatus',\n          invoiceId,\n          step: 'fetchInvoice',\n        })\n      }\n\n      if (!invoice) {\n        throw errorHandler.createDatabaseError(\n          `Facture avec l'ID ${invoiceId} introuvable`,\n          { invoiceId }\n        )\n      }\n\n      // Déterminer le nouveau statut\n      let newStatus: string = 'sent'\n      if (totalPaid >= Number(invoice.total_amount)) {\n        newStatus = 'paid'\n      } else if (totalPaid > 0) {\n        newStatus = 'partial'\n      }\n\n      // Vérifier si la date d'échéance est dépassée\n      const { data: invoiceDetails } = await this.supabase\n        .from('invoices')\n        .select('due_date')\n        .eq('id', invoiceId)\n        .single()\n\n      if (invoiceDetails) {\n        const today = new Date()\n        const dueDate = new Date(invoiceDetails.due_date)\n        if (dueDate < today && newStatus !== 'paid') {\n          newStatus = 'overdue'\n        }\n      }\n\n      // Mettre à jour la facture\n      const { error: updateError } = await this.supabase\n        .from('invoices')\n        .update({\n          status: newStatus as Invoice['status'],\n          // Note: paid_amount n'existe pas dans le schéma, on utilise les paiements pour le calcul\n        })\n        .eq('id', invoiceId)\n\n      if (updateError) {\n        throw errorHandler.handleError(updateError, {\n          operation: 'updateInvoicePaymentStatus',\n          invoiceId,\n          step: 'updateInvoice',\n        })\n      }\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'updateInvoicePaymentStatus',\n        invoiceId,\n      })\n    }\n  }\n\n  /**\n   * Enregistre un paiement Mobile Money\n   */\n  async recordMobileMoneyPayment(\n    invoiceId: string,\n    amount: number,\n    currency: string,\n    provider: 'mtn' | 'orange' | 'airtel' | 'wave',\n    transactionId: string,\n    phoneNumber: string\n  ) {\n    try {\n      // Validation\n      if (!transactionId) {\n        throw errorHandler.createValidationError(\n          'L\\'ID de transaction est obligatoire',\n          'transactionId'\n        )\n      }\n\n      // Récupérer la facture pour avoir l'organization_id et student_id\n      const { data: invoice, error: invoiceError } = await this.supabase\n        .from('invoices')\n        .select('organization_id, student_id')\n        .eq('id', invoiceId)\n        .single()\n\n      if (invoiceError) {\n        if (invoiceError.code === 'PGRST116' || invoiceError.code === '42P01') {\n          throw errorHandler.handleError(invoiceError, {\n            code: ErrorCode.DB_NOT_FOUND,\n            operation: 'recordMobileMoneyPayment',\n            invoiceId,\n          })\n        }\n        throw errorHandler.handleError(invoiceError, {\n          operation: 'recordMobileMoneyPayment',\n          invoiceId,\n        })\n      }\n\n      if (!invoice) {\n        throw errorHandler.createDatabaseError(\n          `Facture avec l'ID ${invoiceId} introuvable`,\n          { invoiceId }\n        )\n      }\n\n      return this.create({\n        organization_id: invoice.organization_id,\n        invoice_id: invoiceId,\n        student_id: invoice.student_id,\n        amount,\n        currency,\n        payment_method: 'mobile_money',\n        payment_provider: provider,\n        transaction_id: transactionId,\n        status: 'pending', // Sera mis à jour via webhook\n        metadata: {\n          phone_number: phoneNumber,\n        },\n      })\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'recordMobileMoneyPayment',\n        invoiceId,\n        provider,\n      })\n    }\n  }\n}\n\nexport const paymentService = new PaymentService()\n\n"],"names":[],"mappings":"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","ignoreList":[0,1,2,3,4,10]}