{"version":3,"sources":["../../../../app/%28dashboard%29/dashboard/evaluations/portfolios/%5Bid%5D/page.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useParams, useRouter } from 'next/navigation'\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\nimport { useAuth } from '@/lib/hooks/use-auth'\nimport { createClient } from '@/lib/supabase/client'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Switch } from '@/components/ui/switch'\nimport { Badge } from '@/components/ui/badge'\nimport { useToast } from '@/components/ui/toast'\nimport {\n  ArrowLeft, Save, Eye, Download, CheckCircle2, Clock,\n  User, Calendar, Star, Award, FileText, Send, Upload\n} from 'lucide-react'\nimport Link from 'next/link'\nimport { motion } from '@/components/ui/motion'\nimport { formatDate, cn } from '@/lib/utils'\n\nexport default function EditPortfolioPage() {\n  const params = useParams()\n  const router = useRouter()\n  const { user } = useAuth()\n  const supabase = createClient()\n  const queryClient = useQueryClient()\n  const { addToast } = useToast()\n  const portfolioId = params.id as string\n\n  const [formData, setFormData] = useState<Record<string, any>>({})\n  const [teacherNotes, setTeacherNotes] = useState('')\n  const [isVisibleToStudent, setIsVisibleToStudent] = useState(false)\n  const [isSaving, setIsSaving] = useState(false)\n\n  // Récupérer le portfolio\n  const { data: portfolio, isLoading } = useQuery<{\n    id: string;\n    teacher_notes?: string | null;\n    is_visible_to_student?: boolean;\n    content?: Record<string, any>;\n    [key: string]: any;\n  } | null>({\n    queryKey: ['portfolio', portfolioId],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('learning_portfolios')\n        .select(`\n          *,\n          template:learning_portfolio_templates(*),\n          student:students(id, first_name, last_name, email, phone, photo_url),\n          session:sessions(id, name, start_date, end_date, formations(id, name))\n        `)\n        .eq('id', portfolioId)\n        .single()\n\n      if (error) throw error\n      return data as any\n    },\n    enabled: !!portfolioId,\n  })\n\n  // Récupérer les entrées existantes\n  const { data: entries } = useQuery({\n    queryKey: ['portfolio-entries', portfolioId],\n    queryFn: async () => {\n      const { data, error } = await supabase\n        .from('learning_portfolio_entries')\n        .select('*')\n        .eq('portfolio_id', portfolioId)\n\n      if (error) {\n        console.log('Erreur ou table inexistante:', error)\n        return []\n      }\n      return data || []\n    },\n    enabled: !!portfolioId,\n  })\n\n  // Charger les données existantes\n  useEffect(() => {\n    if (portfolio) {\n      setTeacherNotes(portfolio.teacher_notes || '')\n      setIsVisibleToStudent(portfolio.is_visible_to_student || false)\n      \n      // Charger le contenu existant\n      if (portfolio.content) {\n        setFormData(portfolio.content)\n      }\n    }\n  }, [portfolio])\n\n  // Charger les entrées dans le formulaire\n  useEffect(() => {\n    if (entries && entries.length > 0) {\n      const entriesData: Record<string, any> = {}\n      entries.forEach((entry: any) => {\n        const key = `${entry.section_id}.${entry.field_id}`\n        entriesData[key] = entry.value\n        if (entry.teacher_comment) {\n          entriesData[`${key}_comment`] = entry.teacher_comment\n        }\n      })\n      setFormData(prev => ({ ...prev, ...entriesData }))\n    }\n  }, [entries])\n\n  // Mutation pour sauvegarder\n  const saveMutation = useMutation({\n    mutationFn: async (data: { content: Record<string, any>, status: string }) => {\n      // Mettre à jour le portfolio\n      const { error: portfolioError } = await (supabase\n        .from('learning_portfolios') as any)\n        .update({\n          content: data.content,\n          status: data.status,\n          teacher_notes: teacherNotes,\n          is_visible_to_student: isVisibleToStudent,\n          last_modified_by: user?.id,\n          ...(data.status === 'completed' ? { completed_at: new Date().toISOString() } : {}),\n        })\n        .eq('id', portfolioId)\n\n      if (portfolioError) throw portfolioError\n\n      // Sauvegarder les entrées individuelles\n      const entriesToUpsert: any[] = []\n      const template = portfolio?.template\n\n      template?.template_structure?.forEach((section: any) => {\n        section.fields?.forEach((field: any) => {\n          const key = `${section.id}.${field.id}`\n          const value = data.content[key]\n          if (value !== undefined) {\n            entriesToUpsert.push({\n              portfolio_id: portfolioId,\n              section_id: section.id,\n              field_id: field.id,\n              value: value,\n              teacher_comment: data.content[`${key}_comment`] || null,\n              evaluated_by: user?.id,\n              evaluated_at: new Date().toISOString(),\n            })\n          }\n        })\n      })\n\n      if (entriesToUpsert.length > 0) {\n        const { error: entriesError } = await (supabase\n          .from('learning_portfolio_entries') as any)\n          .upsert(entriesToUpsert, { onConflict: 'portfolio_id,section_id,field_id' })\n\n        if (entriesError) {\n          console.error('Erreur sauvegarde entrées:', entriesError)\n        }\n      }\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['portfolio', portfolioId] })\n      queryClient.invalidateQueries({ queryKey: ['portfolio-entries', portfolioId] })\n      addToast({ type: 'success', title: 'Livret sauvegardé', description: 'Les modifications ont été enregistrées.' })\n    },\n    onError: (error: any) => {\n      addToast({ type: 'error', title: 'Erreur', description: error.message || 'Impossible de sauvegarder.' })\n    },\n  })\n\n  const handleSave = (status: string = 'in_progress') => {\n    saveMutation.mutate({ content: formData, status })\n  }\n\n  const handleValidate = () => {\n    if (confirm('Êtes-vous sûr de vouloir valider ce livret ? Il sera visible par l\\'apprenant.')) {\n      saveMutation.mutate({ content: formData, status: 'validated' })\n      setIsVisibleToStudent(true)\n    }\n  }\n\n  const updateField = (sectionId: string, fieldId: string, value: any) => {\n    const key = `${sectionId}.${fieldId}`\n    setFormData(prev => ({ ...prev, [key]: value }))\n  }\n\n  const getFieldValue = (sectionId: string, fieldId: string) => {\n    const key = `${sectionId}.${fieldId}`\n    return formData[key]\n  }\n\n  // Rendu d'un champ selon son type\n  const renderField = (section: any, field: any) => {\n    const value = getFieldValue(section.id, field.id)\n    const key = `${section.id}.${field.id}`\n\n    switch (field.type) {\n      case 'text':\n        return (\n          <Input\n            value={value || ''}\n            onChange={(e) => updateField(section.id, field.id, e.target.value)}\n            placeholder={field.placeholder || ''}\n          />\n        )\n\n      case 'textarea':\n        return (\n          <Textarea\n            value={value || ''}\n            onChange={(e) => updateField(section.id, field.id, e.target.value)}\n            placeholder={field.placeholder || ''}\n            rows={4}\n          />\n        )\n\n      case 'number':\n        return (\n          <Input\n            type=\"number\"\n            value={value || ''}\n            onChange={(e) => updateField(section.id, field.id, parseFloat(e.target.value))}\n            min={field.min}\n            max={field.max}\n          />\n        )\n\n      case 'select':\n        return (\n          <select\n            value={value || ''}\n            onChange={(e) => updateField(section.id, field.id, e.target.value)}\n            className=\"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue\"\n          >\n            <option value=\"\">Sélectionner...</option>\n            {field.options?.map((opt: string) => (\n              <option key={opt} value={opt}>{opt}</option>\n            ))}\n          </select>\n        )\n\n      case 'checkbox':\n        return (\n          <div className=\"flex items-center gap-2\">\n            <input\n              type=\"checkbox\"\n              checked={value || false}\n              onChange={(e) => updateField(section.id, field.id, e.target.checked)}\n              className=\"rounded\"\n            />\n            <span className=\"text-sm text-gray-600\">{field.description || 'Oui'}</span>\n          </div>\n        )\n\n      case 'date':\n        return (\n          <Input\n            type=\"date\"\n            value={value || ''}\n            onChange={(e) => updateField(section.id, field.id, e.target.value)}\n          />\n        )\n\n      case 'rating':\n        const maxRating = field.max || 5\n        const minRating = field.min || 1\n        return (\n          <div className=\"flex items-center gap-1\">\n            {Array.from({ length: maxRating - minRating + 1 }, (_, i) => i + minRating).map((rating) => (\n              <button\n                key={rating}\n                type=\"button\"\n                onClick={() => updateField(section.id, field.id, rating)}\n                className={cn(\n                  'p-1 rounded transition-colors',\n                  (value || 0) >= rating ? 'text-yellow-500' : 'text-gray-300 hover:text-yellow-400'\n                )}\n              >\n                <Star className=\"h-6 w-6 fill-current\" />\n              </button>\n            ))}\n            <span className=\"ml-2 text-sm text-gray-600\">\n              {value ? `${value}/${maxRating}` : 'Non noté'}\n            </span>\n          </div>\n        )\n\n      case 'competency':\n        const levels = field.competencyLevels || ['Non acquis', 'En cours', 'Acquis', 'Maîtrisé']\n        return (\n          <div className=\"flex flex-wrap gap-2\">\n            {levels.map((level: string, index: number) => (\n              <button\n                key={level}\n                type=\"button\"\n                onClick={() => updateField(section.id, field.id, level)}\n                className={cn(\n                  'px-3 py-1.5 rounded-full text-sm font-medium transition-all',\n                  value === level\n                    ? 'bg-brand-blue text-white'\n                    : 'bg-gray-100 text-gray-600 hover:bg-gray-200'\n                )}\n              >\n                {level}\n              </button>\n            ))}\n          </div>\n        )\n\n      case 'file':\n        return (\n          <div className=\"border-2 border-dashed rounded-lg p-4 text-center\">\n            <Upload className=\"h-8 w-8 mx-auto text-gray-400 mb-2\" />\n            <p className=\"text-sm text-gray-600\">\n              Glissez un fichier ici ou cliquez pour sélectionner\n            </p>\n            <input\n              type=\"file\"\n              className=\"hidden\"\n              onChange={(e) => {\n                // TODO: Implémenter l'upload de fichier\n                const file = e.target.files?.[0]\n                if (file) {\n                  updateField(section.id, field.id, { name: file.name, size: file.size })\n                }\n              }}\n            />\n          </div>\n        )\n\n      default:\n        return (\n          <Input\n            value={value || ''}\n            onChange={(e) => updateField(section.id, field.id, e.target.value)}\n          />\n        )\n    }\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue\"></div>\n      </div>\n    )\n  }\n\n  if (!portfolio) {\n    return (\n      <div className=\"container mx-auto py-8 px-4\">\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <FileText className=\"h-12 w-12 text-gray-400 mx-auto mb-4\" />\n            <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Livret non trouvé</h3>\n            <Link href=\"/dashboard/evaluations/portfolios\">\n              <Button>Retour à la liste</Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  const template = portfolio.template\n  const student = portfolio.student\n\n  return (\n    <div className=\"container mx-auto py-8 px-4 max-w-5xl\">\n      {/* Header */}\n      <motion.div\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"mb-8\"\n      >\n        <div className=\"flex items-center gap-4 mb-4\">\n          <Link href=\"/dashboard/evaluations/portfolios\">\n            <Button variant=\"ghost\" size=\"icon\">\n              <ArrowLeft className=\"h-5 w-5\" />\n            </Button>\n          </Link>\n          <div className=\"flex-1\">\n            <h1 className=\"text-2xl font-bold text-gray-900 flex items-center gap-3\">\n              {template?.name || 'Livret d\\'apprentissage'}\n            </h1>\n            <div className=\"flex items-center gap-4 text-sm text-gray-600 mt-1\">\n              <span className=\"flex items-center gap-1\">\n                <User className=\"h-4 w-4\" />\n                {student?.first_name} {student?.last_name}\n              </span>\n              {portfolio.session && (\n                <span className=\"flex items-center gap-1\">\n                  <Calendar className=\"h-4 w-4\" />\n                  {portfolio.session.name}\n                </span>\n              )}\n              <Badge variant={portfolio.status === 'validated' ? 'default' : 'secondary'}>\n                {portfolio.status === 'draft' && 'Brouillon'}\n                {portfolio.status === 'in_progress' && 'En cours'}\n                {portfolio.status === 'completed' && 'Terminé'}\n                {portfolio.status === 'validated' && 'Validé'}\n              </Badge>\n            </div>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button variant=\"outline\" onClick={() => handleSave('in_progress')} disabled={saveMutation.isPending}>\n              <Save className=\"h-4 w-4 mr-2\" />\n              Sauvegarder\n            </Button>\n            <Button onClick={handleValidate} disabled={saveMutation.isPending}>\n              <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n              Valider\n            </Button>\n          </div>\n        </div>\n      </motion.div>\n\n      {/* Info apprenant */}\n      <Card className=\"mb-6\" style={{ borderLeftColor: template?.primary_color, borderLeftWidth: 4 }}>\n        <CardContent className=\"py-4\">\n          <div className=\"flex items-center gap-4\">\n            <div \n              className=\"w-14 h-14 rounded-full flex items-center justify-center text-white text-lg font-medium\"\n              style={{ backgroundColor: template?.primary_color || '#335ACF' }}\n            >\n              {student?.photo_url ? (\n                <img src={student.photo_url} alt=\"\" className=\"w-14 h-14 rounded-full object-cover\" />\n              ) : (\n                `${student?.first_name?.[0]}${student?.last_name?.[0]}`\n              )}\n            </div>\n            <div className=\"flex-1\">\n              <h3 className=\"font-semibold text-gray-900\">{student?.first_name} {student?.last_name}</h3>\n              <p className=\"text-sm text-gray-600\">{student?.email}</p>\n              {portfolio.session?.formations && (\n                <p className=\"text-sm text-gray-500\">{portfolio.session.formations.name}</p>\n              )}\n            </div>\n            <div className=\"text-right\">\n              <p className=\"text-sm text-gray-600\">Progression</p>\n              <p className=\"text-2xl font-bold\" style={{ color: template?.primary_color }}>\n                {Math.round(portfolio.progress_percentage || 0)}%\n              </p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Sections du livret */}\n      <div className=\"space-y-6\">\n        {template?.template_structure?.map((section: any, sectionIndex: number) => (\n          <motion.div\n            key={section.id}\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: sectionIndex * 0.1 }}\n          >\n            <Card>\n              <CardHeader style={{ borderBottomColor: template?.primary_color, borderBottomWidth: 2 }}>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <span \n                    className=\"w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-medium\"\n                    style={{ backgroundColor: template?.primary_color }}\n                  >\n                    {sectionIndex + 1}\n                  </span>\n                  {section.title}\n                </CardTitle>\n                {section.description && (\n                  <CardDescription>{section.description}</CardDescription>\n                )}\n              </CardHeader>\n              <CardContent className=\"pt-6\">\n                <div className=\"space-y-6\">\n                  {section.fields?.map((field: any) => (\n                    <div key={field.id}>\n                      <Label className=\"flex items-center gap-2 mb-2\">\n                        {field.label}\n                        {field.required && <span className=\"text-red-500\">*</span>}\n                      </Label>\n                      {renderField(section, field)}\n                      \n                      {/* Commentaire enseignant optionnel */}\n                      {(field.type === 'competency' || field.type === 'rating') && (\n                        <div className=\"mt-2\">\n                          <Input\n                            placeholder=\"Commentaire (optionnel)\"\n                            value={formData[`${section.id}.${field.id}_comment`] || ''}\n                            onChange={(e) => {\n                              const key = `${section.id}.${field.id}_comment`\n                              setFormData(prev => ({ ...prev, [key]: e.target.value }))\n                            }}\n                            className=\"text-sm\"\n                          />\n                        </div>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n          </motion.div>\n        ))}\n      </div>\n\n      {/* Notes et options */}\n      <Card className=\"mt-6\">\n        <CardHeader>\n          <CardTitle>Notes et options</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div>\n            <Label>Notes du formateur</Label>\n            <Textarea\n              value={teacherNotes}\n              onChange={(e) => setTeacherNotes(e.target.value)}\n              placeholder=\"Notes internes (non visibles par l'apprenant)...\"\n              rows={4}\n            />\n          </div>\n          \n          <div className=\"flex items-center justify-between p-4 bg-gray-50 rounded-lg\">\n            <div>\n              <p className=\"font-medium text-gray-900\">Visibilité apprenant</p>\n              <p className=\"text-sm text-gray-600\">\n                Permettre à l'apprenant de consulter et télécharger son livret\n              </p>\n            </div>\n            <Switch\n              checked={isVisibleToStudent}\n              onCheckedChange={setIsVisibleToStudent}\n            />\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Actions finales */}\n      <div className=\"mt-6 flex justify-between\">\n        <Link href=\"/dashboard/evaluations/portfolios\">\n          <Button variant=\"outline\">\n            <ArrowLeft className=\"h-4 w-4 mr-2\" />\n            Retour\n          </Button>\n        </Link>\n        <div className=\"flex gap-3\">\n          <Button variant=\"outline\" onClick={() => handleSave('in_progress')} disabled={saveMutation.isPending}>\n            <Save className=\"h-4 w-4 mr-2\" />\n            Sauvegarder\n          </Button>\n          <Button onClick={handleValidate} disabled={saveMutation.isPending}>\n            <CheckCircle2 className=\"h-4 w-4 mr-2\" />\n            Valider et rendre visible\n          </Button>\n        </div>\n      </div>\n    </div>\n  )\n}\n\n"],"names":[],"mappings":"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"}