module.exports=[915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},400210,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],400210)},114548,a=>{"use strict";let b=(0,a.i(170106).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);a.s(["Save",()=>b],114548)},195308,a=>{"use strict";var b=a.i(269240);let c=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getConfiguration(a){try{let{data:b,error:c}=await this.supabase.from("accessibility_configurations").select("*").eq("organization_id",a).maybeSingle();if(c){if("PGRST116"===c.code||"42P01"===c.code||"PGRST301"===c.code||404===c.status||c.message?.includes("relation")||c.message?.includes("does not exist"))return console.warn("Table accessibility_configurations does not exist yet:",c?.message),null;throw c}return b}catch(a){if(a?.status===404||a?.message?.toLowerCase().includes("not found"))return null;throw a}}async updateConfiguration(a,b){var c;let d=await this.getConfiguration(a),e={...b};if(delete e.id,delete e.created_at,delete e.updated_at,delete e.organization_id,null===e.referent_user_id||void 0===e.referent_user_id||""!==e.referent_user_id&&(c=e.referent_user_id)&&""!==c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(c)||(e.referent_user_id=null),(""===e.referent_training_date||null===e.referent_training_date)&&(e.referent_training_date=null),""===e.referent_training_certificate&&(e.referent_training_certificate=null),""===e.accessibility_policy&&(e.accessibility_policy=null),""===e.physical_accessibility_statement&&(e.physical_accessibility_statement=null),""===e.digital_accessibility_statement&&(e.digital_accessibility_statement=null),d){let{data:b,error:c}=await this.supabase.from("accessibility_configurations").update(e).eq("organization_id",a).select().single();if(c)throw console.error("[AccessibilityService] Erreur lors de la mise à jour de la configuration:",{error:c,code:c.code,message:c.message,details:c.details,hint:c.hint,cleanData:e,organizationId:a}),c;return b}{let b={organization_id:a,partner_agefiph:!1,partner_cap_emploi:!1,partner_fiphfp:!1,partner_other:[],...e},{data:c,error:d}=await this.supabase.from("accessibility_configurations").insert(b).select().single();if(d)throw console.error("[AccessibilityService] Erreur lors de la création de la configuration:",{error:d,code:d.code,message:d.message,details:d.details,hint:d.hint,insertData:b}),d;return c}}async setReferent(a,b,c,d){await this.updateConfiguration(a,{referent_user_id:b,referent_training_date:c||null,referent_training_certificate:d||null})}async getDisabilityTypes(){try{let{data:a,error:b}=await this.supabase.from("accessibility_disability_types").select("*").order("name_fr",{ascending:!0});if(b){if("PGRST116"===b.code||"42P01"===b.code||404===b.status||b.message?.includes("relation")||b.message?.includes("does not exist"))return console.warn("Table accessibility_disability_types does not exist yet"),[];throw b}return a||[]}catch(a){if(a?.status===404)return[];throw a}}async getStudentNeeds(a,b){try{let c=this.supabase.from("accessibility_student_needs").select("*").eq("organization_id",a);b?.status&&(c=c.eq("status",b.status)),b?.has_disability!==void 0&&(c=c.eq("has_disability",b.has_disability));let{data:d,error:e}=await c.order("created_at",{ascending:!1});if(e){if("PGRST116"===e.code||"42P01"===e.code||404===e.status||e.message?.includes("relation")||e.message?.includes("does not exist"))return console.warn("Table accessibility_student_needs does not exist yet"),[];throw e}return d||[]}catch(a){if(a?.status===404)return[];throw a}}async getStudentNeedByStudentId(a){try{let{data:b,error:c}=await this.supabase.from("accessibility_student_needs").select("*").eq("student_id",a).maybeSingle();if(c){if("PGRST116"===c.code||"42P01"===c.code||404===c.status||c.message?.includes("relation")||c.message?.includes("does not exist"))return null;throw c}return b}catch(a){if(a?.status===404)return null;throw a}}async createStudentNeed(a){let{data:b,error:c}=await this.supabase.from("accessibility_student_needs").insert(a).select().single();if(c)throw c;return b}async updateStudentNeed(a,b){let{data:c,error:d}=await this.supabase.from("accessibility_student_needs").update(b).eq("id",a).select().single();if(d)throw d;return c}async reviewStudentNeed(a,b,c){return this.updateStudentNeed(a,{status:"reviewed",reviewed_by_user_id:b,reviewed_at:new Date().toISOString(),notes:c||null})}async getAccommodations(a,b){try{let c=this.supabase.from("accessibility_accommodations").select("*").eq("organization_id",a);b?.student_id&&(c=c.eq("student_id",b.student_id)),b?.status&&(c=c.eq("status",b.status)),b?.type&&(c=c.eq("accommodation_type",b.type));let{data:d,error:e}=await c.order("created_at",{ascending:!1});if(e){if("PGRST116"===e.code||"42P01"===e.code||404===e.status||e.message?.includes("relation")||e.message?.includes("does not exist"))return console.warn("Table accessibility_accommodations does not exist yet"),[];throw e}return d||[]}catch(a){if(a?.status===404)return[];throw a}}async getStudentAccommodations(a){return this.getAccommodations("",{student_id:a})}async createAccommodation(a){let{data:b,error:c}=await this.supabase.from("accessibility_accommodations").insert(a).select().single();if(c)throw c;return b}async updateAccommodation(a,b){let{data:c,error:d}=await this.supabase.from("accessibility_accommodations").update(b).eq("id",a).select().single();if(d)throw d;return c}async archiveAccommodation(a){await this.updateAccommodation(a,{status:"inactive"})}async getEquipment(a,b){try{let c=this.supabase.from("accessibility_equipment").select("*").eq("organization_id",a);b?.status&&(c=c.eq("status",b.status)),b?.category&&(c=c.eq("category",b.category));let{data:d,error:e}=await c.order("name",{ascending:!0});if(e){if("PGRST116"===e.code||"42P01"===e.code||404===e.status||e.message?.includes("relation")||e.message?.includes("does not exist"))return console.warn("Table accessibility_equipment does not exist yet"),[];throw e}return d||[]}catch(a){if(a?.status===404)return[];throw a}}async createEquipment(a){let{data:b,error:c}=await this.supabase.from("accessibility_equipment").insert(a).select().single();if(c)throw c;return b}async updateEquipment(a,b){let{data:c,error:d}=await this.supabase.from("accessibility_equipment").update(b).eq("id",a).select().single();if(d)throw d;return c}async assignEquipment(a,b,c){let{data:d,error:e}=await this.supabase.from("accessibility_equipment").select("*").eq("id",a).single();if(e)throw e;if(d.quantity_available<=0)throw Error("Équipement non disponible");let{data:f,error:g}=await this.supabase.from("accessibility_equipment_assignments").insert({equipment_id:a,student_id:b,organization_id:d.organization_id,...c}).select().single();if(g)throw g;return await this.updateEquipment(a,{quantity_available:d.quantity_available-1,status:d.quantity_available-1==0?"in_use":d.status}),f}async returnEquipment(a,b){let{data:c,error:d}=await this.supabase.from("accessibility_equipment_assignments").select("*, accessibility_equipment(*)").eq("id",a).single();if(d)throw d;if(await this.supabase.from("accessibility_equipment_assignments").update({status:"returned",actual_return_date:new Date().toISOString().split("T")[0],condition_on_return:b}).eq("id",a),"lost"!==b&&"damaged"!==b){let a=c.accessibility_equipment;await this.updateEquipment(c.equipment_id,{quantity_available:a.quantity_available+1,status:"available"})}}async getEquipmentAssignments(a){try{let{data:b,error:c}=await this.supabase.from("accessibility_equipment_assignments").select("*").eq("equipment_id",a).order("assigned_date",{ascending:!1});if(c){if("PGRST116"===c.code||"42P01"===c.code||404===c.status||c.message?.includes("relation")||c.message?.includes("does not exist"))return console.warn("Table accessibility_equipment_assignments does not exist yet"),[];throw c}return b||[]}catch(a){if(a?.status===404)return[];throw a}}async getDocuments(a,b){try{let c=this.supabase.from("accessibility_documents").select("*").eq("organization_id",a);b&&(c=c.eq("student_id",b));let{data:d,error:e}=await c.order("created_at",{ascending:!1});if(e){if("PGRST116"===e.code||"42P01"===e.code||404===e.status||e.message?.includes("relation")||e.message?.includes("does not exist"))return console.warn("Table accessibility_documents does not exist yet"),[];throw e}return d||[]}catch(a){if(a?.status===404)return[];throw a}}async uploadDocument(a){let{data:b,error:c}=await this.supabase.from("accessibility_documents").insert(a).select().single();if(c)throw c;return b}async deleteDocument(a){let{error:b}=await this.supabase.from("accessibility_documents").delete().eq("id",a);if(b)throw b}async verifyDocument(a,b){await this.supabase.from("accessibility_documents").update({verified:!0,verified_by_user_id:b,verified_at:new Date().toISOString()}).eq("id",a)}async getStats(a){let[b,c,d,e]=await Promise.all([this.getStudentNeeds(a,{has_disability:!0}),this.getAccommodations(a,{status:"active"}),this.getEquipment(a,{status:"available"}),this.calculateComplianceRate(a)]),f=new Map;b.forEach(a=>{a.disability_type_ids.forEach(a=>{f.set(a,(f.get(a)||0)+1)})});let g=new Map;return c.forEach(a=>{g.set(a.accommodation_type,(g.get(a.accommodation_type)||0)+1)}),{total_students_with_needs:b.length,active_accommodations:c.length,available_equipment:d.reduce((a,b)=>a+b.quantity_available,0),compliance_rate:e,students_by_disability_type:Array.from(f.entries()).map(([a,b])=>({type:a,count:b})),accommodations_by_type:Array.from(g.entries()).map(([a,b])=>({type:a,count:b})),pending_reviews:b.filter(a=>"pending"===a.status).length}}async calculateComplianceRate(a){try{let{data:b,error:c}=await this.supabase.rpc("calculate_accessibility_compliance_rate",{org_id:a});if(c){if("PGRST116"===c.code||"42883"===c.code||404===c.status||c.message?.toLowerCase().includes("function")||c.message?.toLowerCase().includes("does not exist"))return 0;throw c}return b||0}catch(a){if(a?.status===404||a?.message?.toLowerCase().includes("not found"))return 0;throw a}}async generateComplianceReport(a,b,c,d){let e=await this.getStats(a),f=await this.getConfiguration(a),g={organization_id:a,report_type:"annual",title:`Rapport de conformit\xe9 accessibilit\xe9 ${new Date().getFullYear()}`,period_start:b,period_end:c,total_students:0,students_with_disabilities:e.total_students_with_needs,accommodations_requested:e.total_students_with_needs,accommodations_implemented:e.active_accommodations,equipment_used:0,referent_training_up_to_date:!!f?.referent_training_date,physical_accessibility_compliant:!!f?.physical_accessibility_statement,digital_accessibility_compliant:!!f?.digital_accessibility_statement,partner_collaborations:+!!f?.partner_agefiph+ +!!f?.partner_cap_emploi+ +!!f?.partner_fiphfp,compliance_rate:e.compliance_rate,findings:[],recommendations:[],generated_by_user_id:d},{data:h,error:i}=await this.supabase.from("accessibility_compliance_reports").insert(g).select().single();if(i)throw i;return h}};a.s(["accessibilityService",0,c])},883497,a=>{"use strict";let b=(0,a.i(170106).default)("Package",[["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}],["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]);a.s(["Package",()=>b],883497)}];

//# sourceMappingURL=_d52abc1f._.js.map