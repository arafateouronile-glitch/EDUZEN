module.exports=[641710,a=>{"use strict";let b=(0,a.i(170106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],641710)},495756,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],495756)},732560,a=>{"use strict";var b=a.i(187924),c=a.i(433217),d=a.i(913216),e=a.i(269240),f=a.i(703130),g=a.i(340695),h=a.i(495756),i=a.i(641710),j=a.i(290821),k=a.i(911156),l=a.i(497895),m=a.i(238246);function n(){let{user:a}=(0,d.useAuth)(),n=(0,e.createClient)(),{data:o}=(0,c.useQuery)({queryKey:["portal-invoices",a?.id],queryFn:async()=>{if(!a?.id)return[];let b=[];if(a?.role==="parent"){let{data:c}=await n.from("guardians").select("id").eq("user_id",a.id);if(!c||0===c.length)return[];let{data:d}=await n.from("student_guardians").select("student_id").in("guardian_id",c.map(a=>a.id));if(!d||0===d.length)return[];b=d.map(a=>a.student_id).filter(a=>null!==a)}else if(a?.role==="student"){let{data:c}=await n.from("students").select("id").eq("id",a.id).single();c&&(b=[c.id])}if(0===b.length)return[];let{data:c}=await n.from("invoices").select("*, students(first_name, last_name)").in("student_id",b).order("issue_date",{ascending:!1});return c||[]},enabled:!!a?.id}),{data:p}=(0,c.useQuery)({queryKey:["portal-payments",a?.id],queryFn:async()=>{if(!a?.id)return[];let b=[];if(a?.role==="parent"){let{data:c}=await n.from("guardians").select("id").eq("user_id",a.id);if(!c||0===c.length)return[];let{data:d}=await n.from("student_guardians").select("student_id").in("guardian_id",c.map(a=>a.id));if(!d||0===d.length)return[];b=d.map(a=>a.student_id).filter(a=>null!==a)}else a?.role==="student"&&(b=[a.id]);if(0===b.length)return[];let{data:c}=await n.from("payments").select("*, invoices(invoice_number), students(first_name, last_name)").in("student_id",b).eq("status","completed").order("paid_at",{ascending:!1}).limit(10);return c||[]},enabled:!!a?.id}),q=o?.filter(a=>"invoice"===a.document_type||!a.document_type)||[],r=q.filter(a=>["sent","partial","overdue"].includes(a.status))||[],s=q.filter(a=>"paid"===a.status)||[];return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Paiements"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Gérez vos factures et paiements"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Factures en attente"}),(0,b.jsx)(j.AlertCircle,{className:"h-5 w-5 text-red-600"})]}),(0,b.jsxs)(f.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:r.length}),r.length>0&&(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Total: ",(0,l.formatCurrency)(r.reduce((a,b)=>a+Number(b.total_amount)-Number(b.paid_amount||0),0),r[0]?.currency||"XOF")]})]})]}),(0,b.jsxs)(f.Card,{children:[(0,b.jsxs)(f.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(f.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Factures payées"}),(0,b.jsx)(h.CheckCircle,{className:"h-5 w-5 text-success-primary"})]}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"text-2xl font-bold text-success-primary",children:s.length})})]})]}),r.length>0&&(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"Factures en attente de paiement"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:r.map(a=>{let c=Number(a.total_amount)-Number(a.paid_amount||0);return(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(a=>{switch(a){case"paid":return(0,b.jsx)(h.CheckCircle,{className:"h-5 w-5 text-success-primary"});case"sent":case"partial":return(0,b.jsx)(i.Clock,{className:"h-5 w-5 text-warning-primary"});case"overdue":return(0,b.jsx)(j.AlertCircle,{className:"h-5 w-5 text-red-600"});default:return null}})(a.status),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold",children:a.invoice_number}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.students?.first_name," ",a.students?.last_name]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Échéance: ",(0,l.formatDate)(a.due_date)]})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"font-semibold text-lg",children:(0,l.formatCurrency)(c,a.currency)}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["sur ",(0,l.formatCurrency)(Number(a.total_amount),a.currency)]})]}),(0,b.jsx)(m.default,{href:`/portal/payments/${a.id}`,children:(0,b.jsxs)(g.Button,{children:[(0,b.jsx)(k.CreditCard,{className:"mr-2 h-4 w-4"}),"Payer"]})})]})]},a.id)})})})]}),p&&p.length>0&&(0,b.jsxs)(f.Card,{children:[(0,b.jsx)(f.CardHeader,{children:(0,b.jsx)(f.CardTitle,{children:"Historique des paiements"})}),(0,b.jsx)(f.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:p.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold",children:a.invoices?.invoice_number||"Paiement"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.students?.first_name," ",a.students?.last_name]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:(0,l.formatDate)(a.paid_at||a.created_at)})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"font-semibold text-success-primary",children:(0,l.formatCurrency)(Number(a.amount),a.currency)}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"mobile_money"===a.payment_method?"Mobile Money":"cash"===a.payment_method?"Espèces":"card"===a.payment_method?"Carte":a.payment_method})]})]},a.id))})})]}),(!o||0===o.length)&&(0,b.jsx)(f.Card,{children:(0,b.jsxs)(f.CardContent,{className:"text-center py-12 text-muted-foreground",children:[(0,b.jsx)(k.CreditCard,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,b.jsx)("p",{children:"Aucune facture disponible"})]})})]})}a.s(["default",()=>n])}];

//# sourceMappingURL=_94293f30._.js.map