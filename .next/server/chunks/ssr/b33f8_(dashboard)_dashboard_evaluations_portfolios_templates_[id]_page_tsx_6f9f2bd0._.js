module.exports=[153992,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(370025),f=a.i(433217),g=a.i(913216),h=a.i(269240),i=a.i(703130),j=a.i(340695),k=a.i(205522),l=a.i(917171),m=a.i(546893),n=a.i(280281),o=a.i(864037),p=a.i(400210),q=a.i(114548),r=a.i(915618),s=a.i(781560),t=a.i(784581),u=a.i(405784),v=a.i(767552),w=a.i(104720),x=a.i(134148),y=a.i(80104),z=a.i(2835),A=a.i(367329),B=a.i(490525),C=a.i(941675),D=a.i(773320),E=a.i(821374),F=a.i(93518),G=a.i(321161),H=a.i(526017),I=a.i(238246);a.i(460355);var J=a.i(346271),K=a.i(262036);let L=[{value:"text",label:"Texte court",icon:x.Type},{value:"textarea",label:"Texte long",icon:y.AlignLeft},{value:"number",label:"Nombre",icon:z.Hash},{value:"select",label:"Liste déroulante",icon:A.List},{value:"checkbox",label:"Case à cocher",icon:B.CheckSquare},{value:"date",label:"Date",icon:C.Calendar},{value:"file",label:"Fichier",icon:D.Upload},{value:"rating",label:"Note (étoiles)",icon:E.Star},{value:"competency",label:"Compétence",icon:F.Award}];function M(){let a=(0,d.useRouter)(),x=(0,d.useParams)().id,{user:y}=(0,g.useAuth)(),z=(0,h.createClient)(),{addToast:A}=(0,o.useToast)(),[B,C]=(0,c.useState)({name:"",description:"",primary_color:"#335ACF",secondary_color:"#34B9EE",formation_id:"",is_default:!1}),[D,E]=(0,c.useState)([]),[F,M]=(0,c.useState)([]),{data:N,isLoading:O}=(0,f.useQuery)({queryKey:["portfolio-template",x],queryFn:async()=>{try{let{data:a,error:b}=await z.from("learning_portfolio_templates").select("*").eq("id",x).single();if(b){if("PGRST116"===b.code||"42P01"===b.code||b.message?.includes("does not exist"))return console.warn("Table learning_portfolio_templates non disponible"),null;throw b}if(!a)return null;if(a.formation_id)try{let{data:b}=await z.from("formations").select("id, name").eq("id",a.formation_id).single();return{...a,formation:b||null}}catch(a){console.warn("Impossible de récupérer la formation:",a)}return{...a,formation:null}}catch(a){if(a?.code==="PGRST116"||a?.code==="42P01"||a?.message?.includes("does not exist"))return console.warn("Table learning_portfolio_templates non disponible"),null;throw a}},enabled:!!x});(0,c.useEffect)(()=>{N&&(C({name:N.name||"",description:N.description||"",primary_color:N.primary_color||"#335ACF",secondary_color:N.secondary_color||"#34B9EE",formation_id:N.formation_id||"",is_default:N.is_default||!1}),N.template_structure&&Array.isArray(N.template_structure)&&(E(N.template_structure),M(N.template_structure.map(a=>a.id))))},[N]);let{data:P}=(0,f.useQuery)({queryKey:["formations-select",y?.organization_id],queryFn:async()=>{if(!y?.organization_id)return[];let{data:a,error:b}=await z.from("formations").select("id, name").eq("organization_id",y.organization_id).eq("is_active",!0);return b?[]:a||[]},enabled:!!y?.organization_id}),Q=(0,e.useMutation)({mutationFn:async()=>{let{data:a,error:b}=await z.from("learning_portfolio_templates").update({name:B.name,description:B.description,template_structure:D,primary_color:B.primary_color,secondary_color:B.secondary_color,formation_id:B.formation_id||null,is_default:B.is_default,updated_at:new Date().toISOString()}).eq("id",x).select().single();if(b)throw b;return a},onSuccess:()=>{A({type:"success",title:"Modèle mis à jour",description:"Le modèle de livret a été mis à jour avec succès."}),a.push("/dashboard/evaluations/portfolios/templates")},onError:a=>{A({type:"error",title:"Erreur",description:a.message||"Impossible de mettre à jour le modèle."})}}),R=()=>{let a={id:`section_${Date.now()}`,title:"Nouvelle section",description:"",fields:[]};E([...D,a]),M([...F,a.id])},S=(a,b)=>{E(D.map(c=>c.id===a?{...c,...b}:c))},T=(a,b,c)=>{E(D.map(d=>d.id===a?{...d,fields:d.fields.map(a=>a.id===b?{...a,...c}:a)}:d))};return O?(0,b.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-5xl",children:(0,b.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,b.jsx)(H.Loader2,{className:"h-8 w-8 animate-spin text-brand-blue"})})}):N?(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-5xl",children:[(0,b.jsx)(J.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,b.jsx)(I.default,{href:"/dashboard/evaluations/portfolios/templates",children:(0,b.jsx)(j.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(p.ArrowLeft,{className:"h-5 w-5"})})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Modifier le modèle"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Modifiez le modèle de livret d'apprentissage"})]})]})}),(0,b.jsx)("form",{onSubmit:a=>{(a.preventDefault(),B.name)?0===D.length?A({type:"error",title:"Erreur",description:"Ajoutez au moins une section."}):Q.mutate():A({type:"error",title:"Erreur",description:"Le nom du modèle est requis."})},children:(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsxs)(i.Card,{className:"sticky top-4",children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(G.Settings,{className:"h-5 w-5"}),"Paramètres"]})}),(0,b.jsxs)(i.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"name",children:"Nom du modèle *"}),(0,b.jsx)(k.Input,{id:"name",value:B.name,onChange:a=>C({...B,name:a.target.value}),placeholder:"Ex: Livret de suivi formation",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"description",children:"Description"}),(0,b.jsx)(m.Textarea,{id:"description",value:B.description,onChange:a=>C({...B,description:a.target.value}),placeholder:"Description du modèle...",rows:3})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"formation",children:"Formation associée (optionnel)"}),(0,b.jsxs)("select",{id:"formation",value:B.formation_id,onChange:a=>C({...B,formation_id:a.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue",children:[(0,b.jsx)("option",{value:"",children:"Aucune (modèle générique)"}),P?.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"primary_color",children:"Couleur principale"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"color",id:"primary_color",value:B.primary_color,onChange:a=>C({...B,primary_color:a.target.value}),className:"w-10 h-10 rounded cursor-pointer"}),(0,b.jsx)(k.Input,{value:B.primary_color,onChange:a=>C({...B,primary_color:a.target.value}),className:"flex-1"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"secondary_color",children:"Couleur secondaire"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"color",id:"secondary_color",value:B.secondary_color,onChange:a=>C({...B,secondary_color:a.target.value}),className:"w-10 h-10 rounded cursor-pointer"}),(0,b.jsx)(k.Input,{value:B.secondary_color,onChange:a=>C({...B,secondary_color:a.target.value}),className:"flex-1"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(l.Label,{htmlFor:"is_default",children:"Modèle par défaut"}),(0,b.jsx)(n.Switch,{checked:B.is_default,onCheckedChange:a=>C({...B,is_default:a})})]}),(0,b.jsx)("div",{className:"pt-4 border-t",children:(0,b.jsxs)(j.Button,{type:"submit",className:"w-full",disabled:Q.isPending,children:[(0,b.jsx)(q.Save,{className:"h-4 w-4 mr-2"}),Q.isPending?"Mise à jour...":"Enregistrer les modifications"]})})]})]})}),(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Structure du livret (",D.length," section",D.length>1?"s":"",")"]}),(0,b.jsxs)(j.Button,{type:"button",onClick:R,children:[(0,b.jsx)(r.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une section"]})]}),0===D.length?(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)(w.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune section"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"Ajoutez des sections pour structurer votre livret d'apprentissage."}),(0,b.jsxs)(j.Button,{type:"button",onClick:R,children:[(0,b.jsx)(r.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une section"]})]})}):(0,b.jsx)(K.AnimatePresence,{children:D.map((a,c)=>(0,b.jsx)(J.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.05*c},children:(0,b.jsxs)(i.Card,{className:"border-l-4",style:{borderLeftColor:B.primary_color},children:[(0,b.jsx)(i.CardHeader,{className:"py-3",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(t.GripVertical,{className:"h-5 w-5 text-gray-400 cursor-move"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(k.Input,{value:a.title,onChange:b=>S(a.id,{title:b.target.value}),className:"font-semibold text-lg border-none p-0 h-auto focus:ring-0",placeholder:"Titre de la section"}),(0,b.jsx)(k.Input,{value:a.description||"",onChange:b=>S(a.id,{description:b.target.value}),className:"text-sm text-gray-500 border-none p-0 h-auto focus:ring-0 mt-1",placeholder:"Description (optionnel)"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)("span",{className:"text-sm text-gray-500",children:[a.fields.length," champ",a.fields.length>1?"s":""]}),(0,b.jsx)(j.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{var b;return b=a.id,void M(a=>a.includes(b)?a.filter(a=>a!==b):[...a,b])},children:F.includes(a.id)?(0,b.jsx)(v.ChevronUp,{className:"h-4 w-4"}):(0,b.jsx)(u.ChevronDown,{className:"h-4 w-4"})}),(0,b.jsx)(j.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{var b;return b=a.id,void E(D.filter(a=>a.id!==b))},className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,b.jsx)(s.Trash2,{className:"h-4 w-4"})})]})]})}),(0,b.jsx)(K.AnimatePresence,{children:F.includes(a.id)&&(0,b.jsx)(J.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},children:(0,b.jsxs)(i.CardContent,{className:"pt-0",children:[(0,b.jsx)("div",{className:"space-y-3",children:a.fields.map((c,d)=>(0,b.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg border",children:[(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-3",children:[(0,b.jsxs)("div",{className:"col-span-5",children:[(0,b.jsx)(l.Label,{className:"text-xs",children:"Label"}),(0,b.jsx)(k.Input,{value:c.label,onChange:b=>T(a.id,c.id,{label:b.target.value}),placeholder:"Nom du champ"})]}),(0,b.jsxs)("div",{className:"col-span-4",children:[(0,b.jsx)(l.Label,{className:"text-xs",children:"Type"}),(0,b.jsx)("select",{value:c.type,onChange:b=>T(a.id,c.id,{type:b.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue text-sm",children:L.map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.value))})]}),(0,b.jsx)("div",{className:"col-span-2 flex items-end justify-center",children:(0,b.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("input",{type:"checkbox",checked:c.required,onChange:b=>T(a.id,c.id,{required:b.target.checked}),className:"rounded"}),"Requis"]})}),(0,b.jsx)("div",{className:"col-span-1 flex items-end justify-end",children:(0,b.jsx)(j.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{var b,d;return b=a.id,d=c.id,void E(D.map(a=>a.id===b?{...a,fields:a.fields.filter(a=>a.id!==d)}:a))},className:"text-red-600 hover:text-red-700",children:(0,b.jsx)(s.Trash2,{className:"h-4 w-4"})})})]}),("select"===c.type||"competency"===c.type)&&(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsxs)(l.Label,{className:"text-xs",children:["competency"===c.type?"Niveaux de compétence":"Options"," (séparées par des virgules)"]}),(0,b.jsx)(k.Input,{value:"competency"===c.type?(c.competencyLevels||["Non acquis","En cours","Acquis","Maîtrisé"]).join(", "):(c.options||[]).join(", "),onChange:b=>{let d=b.target.value.split(",").map(a=>a.trim());"competency"===c.type?T(a.id,c.id,{competencyLevels:d}):T(a.id,c.id,{options:d})},placeholder:"competency"===c.type?"Non acquis, En cours, Acquis, Maîtrisé":"Option 1, Option 2, Option 3"})]}),"rating"===c.type&&(0,b.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-xs",children:"Note min"}),(0,b.jsx)(k.Input,{type:"number",value:c.min||1,onChange:b=>T(a.id,c.id,{min:parseInt(b.target.value)})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{className:"text-xs",children:"Note max"}),(0,b.jsx)(k.Input,{type:"number",value:c.max||5,onChange:b=>T(a.id,c.id,{max:parseInt(b.target.value)})})]})]})]},c.id))}),(0,b.jsxs)(j.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{var b;let c;return b=a.id,c={id:`field_${Date.now()}`,label:"Nouveau champ",type:"text",required:!1},void E(D.map(a=>a.id===b?{...a,fields:[...a.fields,c]}:a))},className:"mt-3 w-full",children:[(0,b.jsx)(r.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter un champ"]})]})})})]})},a.id))})]})]})})]}):(0,b.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-5xl",children:(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)(w.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Modèle introuvable"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Le modèle que vous recherchez n'existe pas ou a été supprimé."}),(0,b.jsx)(I.default,{href:"/dashboard/evaluations/portfolios/templates",children:(0,b.jsxs)(j.Button,{children:[(0,b.jsx)(p.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour aux modèles"]})})]})})})}a.s(["default",()=>M])}];

//# sourceMappingURL=b33f8_%28dashboard%29_dashboard_evaluations_portfolios_templates_%5Bid%5D_page_tsx_6f9f2bd0._.js.map