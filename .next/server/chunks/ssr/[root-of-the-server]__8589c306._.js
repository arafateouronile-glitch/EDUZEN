module.exports=[224361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},814747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},400210,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],400210)},495756,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],495756)},887682,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);a.i(460355);var e=a.i(346271),f=a.i(262036),g=a.i(405784),h=a.i(290821);c.forwardRef(({className:a,label:i,error:j,helperText:k,variant:l="default",leftIcon:m,id:n,options:o,placeholder:p,value:q,...r},s)=>{let[t,u]=c.useState(!1),[v,w]=c.useState(!1),x=n||`select-${Math.random().toString(36).substr(2,9)}`,y=(0,d.cn)("flex w-full rounded-lg font-medium transition-all duration-300","appearance-none cursor-pointer","focus:outline-none focus:ring-2 focus:ring-primary/20","disabled:cursor-not-allowed disabled:opacity-50",{"border-2 border-input bg-background px-4 py-3 pr-11":"default"===l,"focus:border-primary focus:bg-white":"default"===l&&!j,"border-destructive focus:border-destructive focus:ring-destructive/20":j,"border-2 border-input bg-transparent px-4 py-3 pr-11":"outlined"===l,"focus:border-primary focus:shadow-md focus:shadow-primary/10":"outlined"===l&&!j,"border-0 border-b-2 border-input bg-muted/50 px-4 py-3 pr-11 rounded-b-none":"filled"===l,"focus:bg-muted focus:border-primary":"filled"===l&&!j,"focus:border-destructive bg-destructive/5":"filled"===l&&j},m&&"pl-11",a);return(0,b.jsxs)("div",{className:"w-full space-y-1.5",children:[i&&(0,b.jsxs)(e.motion.label,{htmlFor:x,initial:!1,animate:{color:j?"#EF4444":t?"rgb(37, 99, 235)":"rgb(107, 114, 128)"},className:(0,d.cn)("block text-sm font-medium transition-colors duration-200",j&&"text-destructive"),children:[i,r.required&&(0,b.jsx)("span",{className:"text-destructive ml-1",children:"*"})]}),(0,b.jsxs)("div",{className:"relative",children:[m&&(0,b.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none z-10",children:m}),(0,b.jsxs)(e.motion.select,{ref:s,id:x,value:q,...r,onFocus:a=>{u(!0),r.onFocus?.(a)},onBlur:a=>{u(!1),w(!1),r.onBlur?.(a)},onMouseDown:()=>w(!v),className:y,animate:{scale:t?1.01:1,borderColor:j?"#EF4444":t?"rgb(37, 99, 235)":"rgb(226, 232, 240)"},transition:{duration:.2},children:[p&&(0,b.jsx)("option",{value:"",disabled:!0,children:p}),(o||[]).map(a=>(0,b.jsx)("option",{value:a.value,disabled:a.disabled,children:a.label},a.value))]}),(0,b.jsx)(e.motion.div,{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground",animate:{rotate:180*!!v},transition:{duration:.2},children:(0,b.jsx)(g.ChevronDown,{className:"h-5 w-5"})}),j&&(0,b.jsx)(e.motion.div,{className:"absolute right-11 top-1/2 -translate-y-1/2 pointer-events-none",initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:(0,b.jsx)(h.AlertCircle,{className:"h-5 w-5 text-destructive"})})]}),(0,b.jsx)(f.AnimatePresence,{mode:"wait",children:(j||k)&&(0,b.jsx)(e.motion.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.2},className:(0,d.cn)("text-xs transition-colors duration-200",j?"text-destructive":"text-muted-foreground"),children:j||k})})]})}).displayName="SelectNative";let i=c.createContext({}),j=c.forwardRef(({value:a,onValueChange:d,children:e},f)=>{let[g,h]=c.useState(!1);return(0,b.jsx)(i.Provider,{value:{value:a,onValueChange:d,open:g,setOpen:h},children:(0,b.jsx)("div",{className:"relative",ref:f,children:e})})});j.displayName="SelectRoot";let k=c.forwardRef(({children:a,className:e,...f},h)=>{let{open:j,setOpen:k}=c.useContext(i);return(0,b.jsxs)("button",{ref:h,type:"button",className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),onClick:()=>k?.(!j),...f,children:[a,(0,b.jsx)(g.ChevronDown,{className:(0,d.cn)("h-4 w-4 opacity-50 transition-transform",j&&"rotate-180")})]})});k.displayName="SelectTrigger";let l=c.forwardRef(({placeholder:a},d)=>{let{value:e}=c.useContext(i);return(0,b.jsx)("span",{ref:d,children:e||a})});l.displayName="SelectValue";let m=c.forwardRef(({children:a},d)=>{let e=c.useContext(i);return e?.open&&a?(0,b.jsx)("div",{ref:d,className:"absolute top-full left-0 z-50 mt-1 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md",children:(0,b.jsx)("div",{className:"p-1",children:a})}):null});m.displayName="SelectContent";let n=c.forwardRef(({value:a,children:e,className:f,...g},h)=>{let{value:j,onValueChange:k,setOpen:l}=c.useContext(i),m=j===a;return(0,b.jsx)("div",{ref:h,role:"option","aria-selected":m,className:(0,d.cn)("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 px-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",m&&"bg-accent text-accent-foreground",f),onClick:()=>{k?.(a),l?.(!1)},...g,children:e})});n.displayName="SelectItem",a.s(["Select",0,j,"SelectContent",0,m,"SelectItem",0,n,"SelectRoot",0,j,"SelectTrigger",0,k,"SelectValue",0,l])},254799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},522734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},500874,(a,b,c)=>{b.exports=a.x("buffer",()=>require("buffer"))},688947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},705151,a=>{"use strict";let b=(0,a.i(170106).default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);a.s(["Copy",()=>b],705151)},595583,a=>{"use strict";function b(a){let{student:b,organization:d,session:e,invoice:f,program:g,academicYear:h,language:i="fr",issueDate:j=new Date().toISOString()}=a;return{date_emission:new Date().toLocaleDateString("fr-FR"),date_aujourd_hui:new Date().toLocaleDateString("fr-FR"),date_jour:new Date().toLocaleDateString("fr-FR"),annee_courante:new Date().getFullYear().toString(),annee_actuelle:new Date().getFullYear().toString(),date_generation:new Date().toLocaleDateString("fr-FR"),heure:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),ecole_nom:d?.name||"",ecole_logo:d?.logo_url||"",ecole_adresse:d?.address||"",ecole_ville:(d?.address||"").split(",").pop()?.trim()||"",ecole_telephone:d?.phone||"",ecole_email:d?.email||"",ecole_site_web:d?.website||"",ecole_code_postal:(d?.address||"").match(/\d{5}/)?.[0]||"",organisation_nom:d?.name||"",organisation_adresse:d?.address||"",organisation_telephone:d?.phone||"",organisation_email:d?.email||"",organisation_logo:d?.logo_url||"",organisation_site_web:d?.website||"",eleve_nom:b?.last_name||"",eleve_prenom:b?.first_name||"",eleve_numero:b?.student_number||"",eleve_date_naissance:b?.date_of_birth?new Date(b.date_of_birth).toLocaleDateString("fr-FR"):"",eleve_classe:b?.classes?b.classes.name:"",eleve_photo:b?.photo_url||"",eleve_adresse:b?.address||"",eleve_telephone:b?.phone||"",eleve_email:b?.email||"",etudiant_nom:b?.last_name||"",etudiant_prenom:b?.first_name||"",etudiant_nom_complet:b?`${b.first_name} ${b.last_name}`:"",etudiant_numero:b?.student_number||"",etudiant_date_naissance:b?.date_of_birth?new Date(b.date_of_birth).toLocaleDateString("fr-FR"):"",etudiant_adresse:b?.address||"",etudiant_telephone:b?.phone||"",etudiant_email:b?.email||"",etudiant_photo:b?.photo_url||"",classe_nom:b?.classes?b.classes.name:"",annee_academique:h?.name||new Date().getFullYear().toString(),annee_scolaire:h?.name||new Date().getFullYear().toString(),session_nom:e?.name||"",session_debut:e?.start_date?new Date(e.start_date).toLocaleDateString("fr-FR"):"",session_fin:e?.end_date?new Date(e.end_date).toLocaleDateString("fr-FR"):"",session_date_debut:e?.start_date?new Date(e.start_date).toLocaleDateString("fr-FR"):"",session_date_fin:e?.end_date?new Date(e.end_date).toLocaleDateString("fr-FR"):"",formation_nom:e?.formations?.name||"",formation_duree:e?.formations?.duration_hours?`${e.formations?.duration_hours} heures`:"",formation_objectifs:e?.formations?.objectives||g?.objectives||"",formation_public_concerne:e?.formations?.target_audience||g?.target_audience||"",formation_prerequis:e?.formations?.prerequisites||g?.prerequisites||"",formation_qualite_et_resultats:e?.formations?.quality_indicators||g?.quality_indicators||"",formation_contenu:e?.formations?.content||g?.content||"",formation_equipe_pedagogique:e?.formations?.pedagogical_team||g?.pedagogical_team||"",formation_ressources:e?.formations?.resources||g?.resources||"",formation_supports:e?.formations?.materials||g?.materials||"",session_lieu:e?.location||e?.venue||"",session_effectif:e?.enrollment_count?.toString()||e?.student_count?.toString()||"",diplome_ou_certification:e?.formations?.certification||g?.certification||"",ecole_region:d?.region||d?.administrative_region||"",programme_nom:g?.name||e?.formations?.programs?.name||"",programme_code:g?.code||"",programme_description:g?.description||"",programme_objectifs:g?.objectives||"",programme_duree_totale:g?.formations?`${g.formations.reduce((a,b)=>a+(b.duration_hours||0),0)} heures`:"",programme_nombre_formations:g?.formations?`${g.formations.length}`:"",programme_nombre_sessions:"",programme_public_concerne:g?.target_audience||"",programme_modalites:g?.modalities||"",programme_certification:g?.certification||"",numero_facture:f?.invoice_number||"",facture_numero:f?.invoice_number||"",facture_date_emission:f?.issue_date?new Date(f.issue_date).toLocaleDateString("fr-FR"):"",facture_date_echeance:f?.due_date?new Date(f.due_date).toLocaleDateString("fr-FR"):"",date_echeance:f?.due_date?new Date(f.due_date).toLocaleDateString("fr-FR"):"",montant:f?.amount?Number(f.amount).toFixed(2):"0.00",montant_ht:f?.amount?Number(f.amount).toFixed(2):"0.00",montant_ttc:f?.total_amount?Number(f.total_amount).toFixed(2):"0.00",tva:f?.tax_amount?Number(f.tax_amount).toFixed(2):"0.00",taux_tva:f?.tax_amount&&f?.amount?(Number(f.tax_amount)/Number(f.amount)*100).toFixed(2):"0.00",facture_montant:f?.amount?Number(f.amount).toFixed(2):"0.00",facture_tva:f?.tax_amount?Number(f.tax_amount).toFixed(2):"0.00",facture_total:f?.total_amount?Number(f.total_amount).toFixed(2):"0.00",facture_devise:f?.currency||"EUR",facture_items:f?.items?JSON.stringify(f.items):"[]",montant_lettres:f?.total_amount?function(a,b="fr"){return"en"===b?a.toFixed(2)+" euros":function a(b){if(0===b)return"zéro euro";if(b<0)return"moins "+a(-b);let d=Math.floor(b),e=Math.round((b-d)*100),f=c(d);return e>0&&(f+=" virgule "+c(e)),f+(d>1?" euros":" euro")}(a)}(Number(f.total_amount),i):"",mode_paiement:f?.payment_method||"",date_paiement:f?.paid_at?new Date(f.paid_at).toLocaleDateString("fr-FR"):"",ecole_siret:d?.siret||"",ecole_numero_declaration:d?.declaration_number||"",ecole_representant:d?.representative_name||"",langue:i}}function c(a){if(0===a)return"";if(a<10)return["","un","deux","trois","quatre","cinq","six","sept","huit","neuf"][a];if(a<20)return["dix","onze","douze","treize","quatorze","quinze","seize","dix-sept","dix-huit","dix-neuf"][a-10];if(a<100){let b=Math.floor(a/10),d=a%10,e=["","","vingt","trente","quarante","cinquante","soixante","soixante","quatre-vingt","quatre-vingt"][b];return 7===b||9===b?e+="-"+(1===d?"et-":"")+c(10+d):d>0?e+=(1===d&&8!==b?"-et-":"-")+c(d):8===b&&(e+="s"),e}if(a<1e3){let b=Math.floor(a/100),d=a%100,e=1===b?"cent":c(b)+"-cent";return d>0?e+="-"+c(d):b>1&&(e+="s"),e}if(a<1e6){let b=Math.floor(a/1e3),d=a%1e3,e=1===b?"mille":c(b)+"-mille";return d>0&&(e+="-"+c(d)),e}return a.toString()}function d(a){return({attestation:"attestation_reussite",certificate:"certificat_scolarite",invoice:"facture",receipt:"facture",transcript:"releve_notes",report_card:"releve_notes",convocation:"convocation",contract:"contrat"})[a]||a}a.s(["extractDocumentVariables",()=>b,"mapDocumentTypeToTemplateType",()=>d])},866737,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(872675),f=a.i(913216),g=a.i(340695),h=a.i(703130),i=a.i(917171),j=a.i(887682),k=a.i(104720),l=a.i(705151),m=a.i(915618),n=a.i(533441);function o({documentType:a,selectedTemplateId:o,onTemplateSelect:p,onCreateNew:q,onDuplicate:r}){let{user:s}=(0,f.useAuth)(),[t,u]=(0,c.useState)(!1),{data:v,isLoading:w}=(0,d.useQuery)({queryKey:["document-templates-by-type",s?.organization_id,a],queryFn:async()=>{if(!s?.organization_id||!a)return[];try{return await e.documentTemplateService.getTemplatesByType(a,s.organization_id)}catch(a){return console.error("Erreur lors de la récupération des templates:",a),[]}},enabled:!!s?.organization_id&&!!a}),x=v?.filter(a=>a.is_active)||[],y=x.find(a=>a.is_default),z=x.filter(a=>!a.is_default),A=t?x:[y,...z.slice(0,2)].filter(Boolean);return w?(0,b.jsx)(h.Card,{children:(0,b.jsx)(h.CardContent,{className:"pt-6",children:(0,b.jsx)("div",{className:"text-sm text-gray-500",children:"Chargement des modèles..."})})}):x&&0!==x.length?(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(h.CardTitle,{className:"text-lg",children:"Modèle de document"}),q&&(0,b.jsxs)(g.Button,{onClick:q,variant:"outline",size:"sm",children:[(0,b.jsx)(m.Plus,{className:"h-4 w-4 mr-2"}),"Nouveau"]})]})}),(0,b.jsxs)(h.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(i.Label,{htmlFor:"template-select",children:"Sélectionner un modèle"}),(0,b.jsxs)(j.Select,{value:o||y?.id||"",onValueChange:p,children:[(0,b.jsx)(j.SelectTrigger,{id:"template-select",className:"mt-2",children:(0,b.jsx)(j.SelectValue,{placeholder:"Choisir un modèle"})}),(0,b.jsx)(j.SelectContent,{children:x.map(a=>(0,b.jsx)(j.SelectItem,{value:a.id,children:(0,b.jsx)("div",{className:"flex items-center justify-between w-full",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k.FileText,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:a.name}),a.is_default&&(0,b.jsx)("span",{className:"text-xs text-primary font-medium",children:"(Par défaut)"})]})})},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Modèles disponibles"}),(0,b.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:A.map(a=>(0,b.jsxs)("div",{className:`flex items-center justify-between p-3 border rounded-lg transition-colors ${o===a.id?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,b.jsx)(k.FileText,{className:"h-4 w-4 text-gray-400"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"font-medium text-sm",children:a.name}),a.is_default&&(0,b.jsx)("span",{className:"text-xs px-2 py-0.5 bg-primary/10 text-primary rounded-full",children:"Par défaut"}),o===a.id&&(0,b.jsx)(n.Check,{className:"h-4 w-4 text-primary"})]}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:["Modifié le ",new Date(a.updated_at).toLocaleDateString("fr-FR")]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[o!==a.id&&(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>p(a.id),children:"Sélectionner"}),r&&(0,b.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>r(a.id),title:"Dupliquer ce modèle",children:(0,b.jsx)(l.Copy,{className:"h-4 w-4"})})]})]},a.id))}),x.length>A.length&&(0,b.jsx)(g.Button,{variant:"ghost",size:"sm",onClick:()=>u(!t),className:"w-full",children:t?`Afficher moins (${x.length-3} autres)`:`Afficher tous les mod\xe8les (${x.length-A.length} autres)`})]})]})]}):(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{className:"text-lg",children:"Modèle de document"})}),(0,b.jsxs)(h.CardContent,{children:[(0,b.jsx)("div",{className:"text-sm text-gray-500 mb-4",children:"Aucun modèle disponible pour ce type de document."}),q&&(0,b.jsxs)(g.Button,{onClick:q,variant:"outline",size:"sm",children:[(0,b.jsx)(m.Plus,{className:"h-4 w-4 mr-2"}),"Créer un modèle"]})]})]})}a.s(["TemplateSelector",()=>o])},671832,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(433217),f=a.i(913216),g=a.i(269240),h=a.i(716802),i=a.i(789001),j=a.i(595583),k=a.i(872675),l=a.i(866737),m=a.i(340695),n=a.i(703130),o=a.i(400210),p=a.i(284505),q=a.i(104720),r=a.i(660246),s=a.i(495756),t=a.i(238246),u=a.i(864037);function v(){let a=(0,d.useRouter)(),{user:v}=(0,f.useAuth)(),w=(0,g.createClient)(),{addToast:x}=(0,u.useToast)(),[y,z]=(0,c.useState)("attestation"),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)("fr"),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(null),{data:M}=(0,e.useQuery)({queryKey:["organization",v?.organization_id],queryFn:async()=>{if(!v?.organization_id)return null;let{data:a,error:b}=await w.from("organizations").select("*").eq("id",v.organization_id).single();if(b)throw b;return a},enabled:!!v?.organization_id}),{data:N}=(0,e.useQuery)({queryKey:["sessions",v?.organization_id],queryFn:async()=>{if(!v?.organization_id)return[];let{data:a,error:b}=await w.from("sessions").select("id, name, formation_id, formations(name, duration_hours, programs(name)), start_date, end_date, enrollments(*, students(*))").eq("formations.organization_id",v.organization_id).order("start_date",{ascending:!1}).limit(50);if(b)throw b;return a||[]},enabled:!!v?.organization_id}),O=N?.find(a=>a.id===A),P=O?.enrollments?.map(a=>a.students).filter(a=>a&&"active"===a.status)||[],{data:Q}=(0,e.useQuery)({queryKey:["academic-year",v?.organization_id],queryFn:async()=>{if(!v?.organization_id)return null;let{data:a,error:b}=await w.from("academic_years").select("*").eq("organization_id",v.organization_id).eq("is_current",!0).maybeSingle();return b?(console.warn("Erreur lors de la récupération de l'année académique:",b),null):a||null},enabled:!!v?.organization_id}),{data:R}=(0,e.useQuery)({queryKey:["document-template",C],queryFn:async()=>C?k.documentTemplateService.getTemplateById(C):null,enabled:!!C}),S=async()=>{if(!y||!M||!R||!A)return void x({type:"error",title:"Erreur",description:"Veuillez sélectionner un type de document, un modèle, et une session."});let a=E.length>0?P.filter(a=>E.includes(a.id)):P;if(0===a.length)return void x({type:"error",title:"Erreur",description:"Aucun étudiant sélectionné pour la génération."});J(!0),L({current:0,total:a.length});let b=[];try{for(let c=0;c<a.length;c++){let d=a[c];L({current:c+1,total:a.length,currentStudent:`${d.first_name} ${d.last_name}`});try{let a=(0,j.extractDocumentVariables)({student:d,organization:M,session:O,invoice:void 0,academicYear:Q,language:G,issueDate:new Date().toISOString()}),c=await (0,i.generateHTML)(R,a,void 0,v?.organization_id||""),e=`${y}_${d.last_name}_${d.first_name}.pdf`,f=document.createElement("div");f.style.position="absolute",f.style.left="-9999px",f.style.top="0",f.style.width="794px",f.style.minHeight="1123px",f.style.backgroundColor="#ffffff",f.style.overflow="visible",f.style.fontFamily="Arial, sans-serif",document.body.appendChild(f),f.innerHTML=new DOMParser().parseFromString(c.html,"text/html").body.innerHTML;let g=f.querySelector(".document-container")||f.querySelector('[id$="-document"]')||f.firstElementChild;g&&g instanceof HTMLElement||(g=f);let k=`temp-pdf-batch-${d.id}-${Date.now()}`;if(g instanceof HTMLElement&&(g.id=k,g.style.width||(g.style.width="794px"),g.style.minHeight||(g.style.minHeight="1123px"),g.style.backgroundColor="#ffffff"),await new Promise(a=>setTimeout(a,500)),g instanceof HTMLElement){let a=g.getBoundingClientRect();(0===a.width||0===a.height)&&(g=f,f.id=k,f.style.width="794px",f.style.minHeight="1123px")}let l=await (0,h.generatePDFFromHTML)(k,e);b.push({blob:l,filename:e}),f.parentNode===document.body&&document.body.removeChild(f)}catch(a){console.error(`Erreur lors de la g\xe9n\xe9ration pour ${d.first_name} ${d.last_name}:`,a)}}if(b.length>0){let a=`documents_${y}_${O?.name||"batch"}_${Date.now()}.zip`;await (0,h.createZipFromPDFs)(b.map(a=>({name:a.filename,blob:a.blob})),a),x({type:"success",title:"Génération terminée",description:`${b.length} document(s) g\xe9n\xe9r\xe9(s) avec succ\xe8s.`})}else x({type:"error",title:"Erreur",description:"Aucun document n'a pu être généré."})}catch(a){console.error("Erreur lors de la génération en masse:",a),x({type:"error",title:"Erreur",description:"Une erreur est survenue lors de la génération en masse."})}finally{J(!1),L(null),document.querySelectorAll('[id^="temp-pdf-batch-"]').forEach(a=>{a.parentNode===document.body&&document.body.removeChild(a)})}},T=[{value:"attestation",label:"Attestation de scolarité",icon:q.FileText},{value:"certificate",label:"Certificat de formation",icon:q.FileText}];return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(t.default,{href:"/dashboard/documents",children:(0,b.jsx)(m.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(o.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Génération en masse"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Générez plusieurs documents à la fois pour une session"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,b.jsxs)(n.Card,{children:[(0,b.jsx)(n.CardHeader,{children:(0,b.jsx)(n.CardTitle,{children:"Type de document"})}),(0,b.jsx)(n.CardContent,{children:(0,b.jsx)("div",{className:"grid grid-cols-2 gap-4",children:T.map(a=>{let c=a.icon;return(0,b.jsxs)("button",{type:"button",onClick:()=>z(a.value),className:`p-4 border-2 rounded-lg text-left transition-colors ${y===a.value?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[(0,b.jsx)(c,{className:"h-6 w-6 mb-2 text-primary"}),(0,b.jsx)("div",{className:"font-medium",children:a.label})]},a.value)})})})]}),y&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(l.TemplateSelector,{documentType:(0,j.mapDocumentTypeToTemplateType)(y),selectedTemplateId:C,onTemplateSelect:D,onCreateNew:()=>{a.push(`/dashboard/settings/document-templates/${(0,j.mapDocumentTypeToTemplateType)(y)}/edit`)},onDuplicate:async a=>{try{let b=await k.documentTemplateService.duplicateTemplate(a);D(b.id),x({type:"success",title:"Modèle dupliqué",description:"Le modèle a été dupliqué avec succès."})}catch(a){console.error("Erreur lors de la duplication:",a),x({type:"error",title:"Erreur",description:"Erreur lors de la duplication du modèle."})}}}),(0,b.jsxs)(n.Card,{children:[(0,b.jsx)(n.CardHeader,{children:(0,b.jsx)(n.CardTitle,{children:"Session de formation"})}),(0,b.jsx)(n.CardContent,{children:(0,b.jsxs)("select",{value:A,onChange:a=>{B(a.target.value),F([])},className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",required:!0,children:[(0,b.jsx)("option",{value:"",children:"Sélectionner une session"}),N?.map(a=>(0,b.jsxs)("option",{value:a.id,children:[a.name," - ",a.formations?.programs?.name]},a.id))]})})]}),A&&P.length>0&&(0,b.jsxs)(n.Card,{children:[(0,b.jsx)(n.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(n.CardTitle,{children:["Étudiants (",P.length,")"]}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(m.Button,{variant:"outline",size:"sm",onClick:()=>{F(P.map(a=>a.id))},children:"Tout sélectionner"}),(0,b.jsx)(m.Button,{variant:"outline",size:"sm",onClick:()=>{F([])},children:"Tout désélectionner"})]})]})}),(0,b.jsxs)(n.CardContent,{children:[(0,b.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:P.map(a=>(0,b.jsxs)("label",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",checked:E.includes(a.id),onChange:()=>{var b;return b=a.id,void F(a=>a.includes(b)?a.filter(a=>a!==b):[...a,b])},className:"w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary"}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("p",{className:"font-medium",children:[a.first_name," ",a.last_name]}),a.student_number&&(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["N° ",a.student_number]})]})]},a.id))}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-4",children:E.length>0?`${E.length} \xe9tudiant(s) s\xe9lectionn\xe9(s)`:"Aucun étudiant sélectionné (tous seront générés)"})]})]}),(0,b.jsxs)(n.Card,{children:[(0,b.jsx)(n.CardHeader,{children:(0,b.jsx)(n.CardTitle,{children:"Options"})}),(0,b.jsx)(n.CardContent,{children:(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Langue"}),(0,b.jsxs)("select",{value:G,onChange:a=>H(a.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,b.jsx)("option",{value:"fr",children:"Français"}),(0,b.jsx)("option",{value:"en",children:"English"})]})]})})]}),(0,b.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,b.jsx)(t.default,{href:"/dashboard/documents",children:(0,b.jsx)(m.Button,{variant:"outline",children:"Annuler"})}),(0,b.jsxs)(m.Button,{onClick:S,disabled:I||!C||!A||0===P.length,children:[(0,b.jsx)(p.Download,{className:"mr-2 h-4 w-4"}),I?"Génération...":"Générer en masse"]})]})]})]}),(0,b.jsx)("div",{className:"lg:col-span-1",children:(0,b.jsxs)(n.Card,{children:[(0,b.jsx)(n.CardHeader,{children:(0,b.jsx)(n.CardTitle,{children:"Informations"})}),(0,b.jsxs)(n.CardContent,{className:"space-y-4",children:[K&&(0,b.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:"Progression"}),(0,b.jsxs)("span",{className:"text-sm text-gray-600",children:[K.current," / ",K.total]})]}),(0,b.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,b.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${K.current/K.total*100}%`}})}),K.currentStudent&&(0,b.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["En cours: ",K.currentStudent]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(r.Users,{className:"h-4 w-4 text-gray-400"}),(0,b.jsxs)("span",{className:"text-sm text-gray-600",children:[P.length," étudiant(s) dans la session"]})]}),E.length>0&&(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(s.CheckCircle,{className:"h-4 w-4 text-success-primary"}),(0,b.jsxs)("span",{className:"text-sm text-gray-600",children:[E.length," étudiant(s) sélectionné(s)"]})]})]}),(0,b.jsx)("div",{className:"pt-4 border-t",children:(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Les documents générés seront regroupés dans un fichier ZIP."})})]})]})})]})]})}a.s(["default",()=>v])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__8589c306._.js.map