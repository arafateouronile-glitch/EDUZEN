module.exports=[468006,a=>{"use strict";var b=a.i(187924),c=a.i(50944),d=a.i(238246),e=a.i(572131),f=a.i(340695),g=a.i(219897),h=a.i(400210),i=a.i(114548),j=a.i(705151),k=a.i(170106);let l=(0,k.default)("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);var m=a.i(781560),n=a.i(941675),o=a.i(953722),p=a.i(808406),q=a.i(433217),r=a.i(370025),s=a.i(937927),t=a.i(555074),u=a.i(426099),v=a.i(337130),w=a.i(770536),x=a.i(574664),y=a.i(269240),z=a.i(913216),A=a.i(864037),B=a.i(325383),C=a.i(437536),D=a.i(321161);let E=(0,k.default)("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);var F=a.i(469769),G=a.i(495756);let H=[{id:"configuration",label:"Configuration",icon:D.Settings,color:"purple"},{id:"gestion",label:"Gestion",icon:E,color:"teal"},{id:"espace_apprenant",label:"Espace Apprenant",icon:F.GraduationCap,color:"blue"},{id:"suivi",label:"Suivi",icon:G.CheckCircle,color:"yellow"}];function I({activeStep:a,onStepChange:c}){return(0,b.jsx)("div",{className:"flex items-center justify-between border-b pb-4",children:H.map((d,e)=>{let f=d.icon,g=a===d.id,h=H.findIndex(b=>b.id===a)>e;return(0,b.jsxs)("button",{onClick:()=>c(d.id),className:`flex items-center space-x-2 px-4 py-2 rounded-lg transition-colors ${g?"purple"===d.color?"bg-purple-100 text-purple-800":"teal"===d.color?"bg-teal-100 text-teal-800":"blue"===d.color?"bg-blue-100 text-blue-800":"bg-warning-bg text-warning-primary":h?"bg-gray-100 text-gray-600":"bg-white text-gray-400 hover:bg-gray-50"}`,children:[(0,b.jsx)(f,{className:"h-5 w-5"}),(0,b.jsx)("span",{className:"font-medium",children:d.label})]},d.id)})})}let J=[{id:"initialisation",label:"Initialisation"},{id:"dates_prix",label:"Dates et prix"},{id:"apprenants",label:"Apprenants"},{id:"programme",label:"Programme"},{id:"intervenants",label:"Intervenants"}];function K({activeTab:a,onTabChange:c}){return(0,b.jsx)("div",{className:"flex space-x-2 border-b pb-2",children:J.map(d=>(0,b.jsx)("button",{onClick:()=>c(d.id),className:`px-4 py-2 font-medium transition-colors ${a===d.id?"border-b-2 border-primary text-primary":"text-muted-foreground hover:text-foreground"}`,children:d.label},d.id))})}a.i(460355);var L=a.i(346271),M=a.i(104720),N=a.i(523312),O=a.i(93518),P=a.i(790166),Q=a.i(267900),R=a.i(501027),S=a.i(497895);let T=[{id:"conventions",label:"Conventions",icon:M.FileText,color:"from-purple-500 to-purple-600"},{id:"convocations",label:"Convocations",icon:N.Bell,color:"from-brand-blue to-brand-cyan"},{id:"evaluations",label:"Évaluations",icon:O.Award,color:"from-amber-500 to-amber-600"},{id:"finances",label:"Finances",icon:P.DollarSign,color:"from-emerald-500 to-emerald-600"},{id:"espace_entreprise",label:"Espace entreprise",icon:Q.Building2,color:"from-blue-500 to-blue-600"},{id:"automatisation",label:"Automatisation",icon:R.Zap,color:"from-orange-500 to-orange-600"}];function U({activeTab:a,onTabChange:c}){return(0,b.jsx)("div",{className:"flex flex-wrap gap-3 p-1.5 bg-gray-50/50 rounded-2xl border-2 border-gray-100",children:T.map((d,e)=>{let f=a===d.id,g=d.icon;return(0,b.jsxs)(L.motion.button,{onClick:()=>c(d.id),initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*e,duration:.3,ease:[.16,1,.3,1]},whileHover:{scale:1.05,y:-2},whileTap:{scale:.98},className:(0,S.cn)("relative px-5 py-3 rounded-xl font-semibold text-sm transition-all duration-300 flex items-center gap-2.5 tracking-tight","shadow-sm hover:shadow-lg",f?"bg-white text-gray-900 shadow-xl":"text-gray-600 hover:text-gray-900 hover:bg-white/70"),children:[(0,b.jsx)(L.motion.div,{className:(0,S.cn)("p-1.5 rounded-lg",f?`bg-gradient-to-br ${d.color}`:"bg-gray-100"),whileHover:{rotate:5,scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:(0,b.jsx)(g,{className:(0,S.cn)("h-4 w-4",f?"text-white":"text-gray-500")})}),(0,b.jsx)("span",{children:d.label}),f&&(0,b.jsx)(L.motion.div,{layoutId:"activeGestionTab",className:(0,S.cn)("absolute bottom-0 left-0 right-0 h-1 rounded-full",`bg-gradient-to-r ${d.color}`),transition:{type:"spring",stiffness:500,damping:30}}),(0,b.jsx)(L.motion.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent rounded-xl",initial:{x:"-100%"},whileHover:{x:"100%"},transition:{duration:.6,ease:"easeInOut"}})]},d.id)})})}var V=a.i(703130);function W(){return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(V.Card,{children:[(0,b.jsx)(V.CardHeader,{children:(0,b.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/3 animate-pulse"})}),(0,b.jsxs)(V.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full animate-pulse"}),(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6 animate-pulse"}),(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded w-4/6 animate-pulse"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-6",children:[(0,b.jsx)("div",{className:"h-10 bg-gray-200 rounded animate-pulse"}),(0,b.jsx)("div",{className:"h-10 bg-gray-200 rounded animate-pulse"})]})]})]}),(0,b.jsxs)(V.Card,{children:[(0,b.jsx)(V.CardHeader,{children:(0,b.jsx)("div",{className:"h-6 bg-gray-200 rounded w-1/4 animate-pulse"})}),(0,b.jsx)(V.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded w-full animate-pulse"}),(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 animate-pulse"})]})})]})]})}let X=(0,e.lazy)(()=>a.A(323181).then(a=>({default:a.ConfigInitialisation}))),Y=(0,e.lazy)(()=>a.A(719708).then(a=>({default:a.ConfigDatesPrix}))),Z=(0,e.lazy)(()=>a.A(421867).then(a=>({default:a.ConfigProgramme}))),$=(0,e.lazy)(()=>a.A(138224).then(a=>({default:a.ConfigIntervenants}))),_=(0,e.lazy)(()=>a.A(25389).then(a=>({default:a.ConfigApprenants}))),aa=(0,e.lazy)(()=>a.A(116744).then(a=>({default:a.GestionConventions}))),ab=(0,e.lazy)(()=>a.A(533586).then(a=>({default:a.GestionConvocations}))),ac=(0,e.lazy)(()=>a.A(580966).then(a=>({default:a.GestionEvaluations}))),ad=(0,e.lazy)(()=>a.A(852322).then(a=>({default:a.GestionFinances}))),ae=(0,e.lazy)(()=>a.A(801877).then(a=>({default:a.GestionEspaceEntreprise}))),af=(0,e.lazy)(()=>a.A(980508).then(a=>({default:a.GestionAutomatisation}))),ag=(0,e.lazy)(()=>a.A(109426).then(a=>({default:a.EspaceApprenant}))),ah=(0,e.lazy)(()=>a.A(358959).then(a=>({default:a.Suivi})));function ai(){let a=(0,c.useParams)();(0,c.useRouter)();let k=a.id,{activeStep:D,setActiveStep:E,activeTab:F,setActiveTab:G,activeGestionTab:H,setActiveGestionTab:J,formData:M,setFormData:N,slotConfig:O,setSlotConfig:P,showEnrollmentForm:Q,setShowEnrollmentForm:R,session:S,isLoading:T,sessionData:V,formation:ai,program:aj,programs:ak,formations:al,sessionPrograms:am,users:an,sessionSlots:ao,refetchSlots:ap,enrollments:aq,organization:ar,students:as,payments:at,grades:au,gradesStats:av,attendanceStats:aw,enrollmentForm:ax,setEnrollmentForm:ay,evaluationForm:az,setEvaluationForm:aA,showEvaluationForm:aB,setShowEvaluationForm:aC,isGeneratingZip:aD,zipGenerationProgress:aE,lastZipGeneration:aF,updateMutation:aG,createEnrollmentMutation:aH,cancelEnrollmentMutation:aI,createEvaluationMutation:aJ,handleSave:aK,user:aL}=function(a){let b=(0,c.useRouter)(),d=(0,c.useSearchParams)(),f=(0,y.createClient)(),g=(0,s.useQueryClient)(),{user:h}=(0,z.useAuth)(),{addToast:i}=(0,A.useToast)(),j=["configuration","gestion","espace_apprenant","suivi"],[k,l]=(0,e.useState)(()=>"configuration"),[m,n]=(0,e.useState)("initialisation"),[o,p]=(0,e.useState)("conventions");(0,e.useEffect)(()=>{let a=d.get("step");a&&j.includes(a)&&a!==k&&l(a)},[d]);let[D,E]=(0,e.useState)({name:"",type:"formation_professionnelle",code:"",manager1_id:"",manager2_id:"",inter_entreprise:!0,sous_traitance:!1,timezone:"Europe/Paris",formation_id:"",program_ids:[],start_date:"",end_date:"",start_time:"",end_time:"",location:"",capacity_max:"",teacher_id:"",status:"planned"}),[F,G]=(0,e.useState)(!1),[H,I]=(0,e.useState)({student_id:"",enrollment_date:new Date().toISOString().split("T")[0],status:"confirmed",payment_status:"pending",total_amount:"",paid_amount:"0"}),[J,K]=(0,e.useState)(!1),[L,M]=(0,e.useState)({subject:"",assessment_type:"evaluation_generale",student_id:void 0,score:"",max_score:"20",percentage:"",notes:"",graded_at:new Date().toISOString().split("T")[0]}),[N,O]=(0,e.useState)({timeSlotType:"both",morningStart:"09:00",morningEnd:"12:00",afternoonStart:"14:00",afternoonEnd:"17:00"}),[P,Q]=(0,e.useState)(!1),[R,S]=(0,e.useState)({current:0,total:0}),[T,U]=(0,e.useState)(null),{data:V,isLoading:W}=(0,q.useQuery)({queryKey:["session",a],queryFn:()=>t.sessionService.getSessionById(a),enabled:!!a}),{data:X}=(0,q.useQuery)({queryKey:["programs",h?.organization_id],queryFn:async()=>h?.organization_id?u.programService.getAllPrograms(h.organization_id,{isActive:!0}):[],enabled:!!h?.organization_id}),{data:Y}=(0,q.useQuery)({queryKey:["formations",h?.organization_id,D.program_ids],queryFn:async()=>h?.organization_id?D.program_ids&&0!==D.program_ids.length?(await v.formationService.getAllFormations(h.organization_id,{isActive:!0})).map(a=>({...a,programs:a.programs||void 0})).filter(a=>a.program_id&&D.program_ids.includes(a.program_id)):v.formationService.getAllFormations(h.organization_id,{isActive:!0}):[],enabled:!!h?.organization_id}),{data:Z}=(0,q.useQuery)({queryKey:["session-programs",a],queryFn:async()=>a?t.sessionService.getSessionPrograms(a):[],enabled:!!a}),{data:$}=(0,q.useQuery)({queryKey:["users",h?.organization_id],queryFn:async()=>{if(!h?.organization_id)return[];let{data:a,error:b}=await f.from("users").select("id, full_name, email, role").eq("organization_id",h.organization_id).eq("is_active",!0);if(b)throw b;return a||[]},enabled:!!h?.organization_id}),{data:_,refetch:aa}=(0,q.useQuery)({queryKey:["session-slots",a],queryFn:async()=>a?w.sessionSlotService.getBySessionId(a):[],enabled:!!a}),{data:ab,isLoading:ac}=(0,q.useQuery)({queryKey:["session-enrollments",a],queryFn:async()=>{if(!a)return[];let{data:b,error:c}=await f.from("enrollments").select(`
          *,
          students (
            id,
            first_name,
            last_name,
            student_number,
            email,
            phone,
            photo_url,
            date_of_birth,
            gender,
            address,
            city,
            status,
            organization_id
          ),
          sessions (*)
        `).eq("session_id",a).order("enrollment_date",{ascending:!1});if(c)throw c;return b||[]},enabled:!!a,refetchOnWindowFocus:!0,refetchOnMount:!0}),{data:ad}=(0,q.useQuery)({queryKey:["session-payments",a],queryFn:async()=>{if(!a)return[];let{data:b,error:c}=await f.from("payments").select("*, students(*), invoices(*)").eq("organization_id",h?.organization_id||"").in("student_id",ab?.map(a=>a.student_id).filter(a=>null!==a)||[]).order("paid_at",{ascending:!1});if(c)throw c;return b||[]},enabled:!!a&&!!ab&&!!h?.organization_id,refetchOnWindowFocus:!0,refetchOnMount:!0}),{data:ae}=(0,q.useQuery)({queryKey:["students",h?.organization_id],queryFn:async()=>{if(!h?.organization_id)return[];let{data:a,error:b}=await f.from("students").select("id, first_name, last_name, student_number, email").eq("organization_id",h.organization_id).eq("status","active").order("last_name",{ascending:!0});if(b)throw b;return a||[]},enabled:!!h?.organization_id}),{data:af,isLoading:ag}=(0,q.useQuery)({queryKey:["session-attendance-stats",a],queryFn:async()=>{if(!a)return null;let{data:b,error:c}=await f.from("attendance").select("status, student_id").eq("session_id",a);if(c)throw c;let d=b||[],e={total:d.length,present:d.filter(a=>"present"===a.status).length,absent:d.filter(a=>"absent"===a.status).length,late:d.filter(a=>"late"===a.status).length,excused:d.filter(a=>"excused"===a.status).length,byStudent:{}};return d.forEach(a=>{e.byStudent[a.student_id]||(e.byStudent[a.student_id]={present:0,total:0}),e.byStudent[a.student_id].total++,("present"===a.status||"late"===a.status)&&e.byStudent[a.student_id].present++}),e},enabled:!!a,refetchOnWindowFocus:!0,refetchOnMount:!0}),{data:ah,isLoading:ai}=(0,q.useQuery)({queryKey:["session-grades",a],queryFn:async()=>{if(!a)return[];let{data:b,error:c}=await f.from("grades").select("*, students(*)").eq("session_id",a).order("graded_at",{ascending:!1});if(c)throw c;return b||[]},enabled:!!a,refetchOnWindowFocus:!0,refetchOnMount:!0}),{data:aj}=(0,q.useQuery)({queryKey:["organization",h?.organization_id],queryFn:async()=>{if(!h?.organization_id)return null;let{data:a,error:b}=await f.from("organizations").select("*").eq("id",h.organization_id).single();if(b)throw b;return a},enabled:!!h?.organization_id}),ak=V?.formations,al=ak?.programs;(0,e.useEffect)(()=>{if(V&&Z){let a=V?.formations,b=a?.programs,c=[];Z&&Z.length>0?c=Z.map(a=>a.id):V.session_programs&&V.session_programs.length>0?c=V.session_programs.map(a=>a.id):b?.id&&(c=[b.id]),E({name:V.name||"",type:"formation_professionnelle",code:V.code||"",manager1_id:V.manager1_id||h?.id||"",manager2_id:V.manager2_id||"",inter_entreprise:V.inter_entreprise??!0,sous_traitance:V.sous_traitance??!1,timezone:V.timezone||"Europe/Paris",formation_id:a?.id||"",program_ids:c,start_date:V.start_date?.split("T")[0]||"",end_date:V.end_date?.split("T")[0]||"",start_time:V.start_time||"",end_time:V.end_time||"",location:V.location||"",capacity_max:V.capacity_max?.toString()||"",teacher_id:V.teacher_id||"",status:V.status||"planned"}),a&&I(b=>({...b,total_amount:b.total_amount||a.price?.toString()||"0"}))}},[V,h?.id,Z]);let am=(0,r.useMutation)({mutationFn:async b=>t.sessionService.updateSession(a,b),onSuccess:()=>{g.invalidateQueries({queryKey:["session",a]})},onError:b=>{B.logger.error("Erreur lors de la mise à jour de la session",b,{sessionId:a})}}),an=(0,r.useMutation)({mutationFn:async({programIds:b,organizationId:c})=>t.sessionService.updateSessionPrograms(a,b,c),onSuccess:()=>{g.invalidateQueries({queryKey:["session",a]}),g.invalidateQueries({queryKey:["session-programs",a]})}}),ao=(0,r.useMutation)({mutationFn:async()=>{if(!a||!D.start_date||!D.end_date)throw Error("Les dates de début et de fin sont requises");return w.sessionSlotService.generateSlots({sessionId:a,startDate:D.start_date,endDate:D.end_date,timeSlotType:"full_day"===N.timeSlotType?"both":N.timeSlotType,morningStart:N.morningStart,morningEnd:N.morningEnd,afternoonStart:N.afternoonStart,afternoonEnd:N.afternoonEnd,location:D.location||void 0,teacherId:D.teacher_id||void 0,capacityMax:D.capacity_max?parseInt(D.capacity_max):void 0})},onSuccess:()=>{aa()},onError:b=>{B.logger.error("Erreur lors de la génération des séances",b,{sessionId:a,slotConfig:N})}}),ap=(0,r.useMutation)({mutationFn:async a=>w.sessionSlotService.delete(a),onSuccess:()=>{aa()}}),aq=(0,r.useMutation)({mutationFn:async b=>w.sessionSlotService.create({session_id:a,date:b.date,time_slot:b.time_slot,start_time:b.start_time,end_time:b.end_time,location:D.location||null,teacher_id:D.teacher_id||null,capacity_max:D.capacity_max?parseInt(D.capacity_max):null}),onSuccess:()=>{aa()}}),ar=(0,r.useMutation)({mutationFn:async()=>{try{let b={student_id:H.student_id,session_id:a,enrollment_date:H.enrollment_date,status:H.status,payment_status:H.payment_status,total_amount:H.total_amount||"",paid_amount:H.paid_amount||"0"};C.enrollmentSchema.parse(b)}catch(a){if(a instanceof Error||a.errors){let b=(a.errors||[]).map(a=>`${a.path.join(".")}: ${a.message}`).join(", ");throw Error(`Erreur de validation : ${b}`)}throw a}let{data:b,error:c}=await f.from("sessions").select("id, start_date, end_date, status, capacity_max").eq("id",a).single();if(c||!b)throw Error("Session non trouvée");let d=new Date;d.setHours(0,0,0,0);let e=b.end_date?new Date(b.end_date):null;if(e&&e.setHours(23,59,59,999),"completed"===b.status||"cancelled"===b.status||e&&e<d)throw Error("Impossible d'inscrire un apprenant à une session terminée ou annulée");let{data:g}=await f.from("enrollments").select("id").eq("session_id",a).eq("student_id",H.student_id).maybeSingle();if(g)throw Error("Cet élève est déjà inscrit à cette session");if(null!==b.capacity_max&&b.capacity_max>0){let{count:c,error:d}=await f.from("enrollments").select("*",{count:"exact",head:!0}).eq("session_id",a).in("status",["confirmed","pending"]);if(d)throw Error("Erreur lors de la vérification de la capacité");if(null!==c&&c>=b.capacity_max)throw Error(`La session est compl\xe8te (${b.capacity_max} apprenants maximum)`)}let{data:h,error:i}=await f.from("enrollments").insert({student_id:H.student_id,session_id:a,enrollment_date:H.enrollment_date,status:H.status,payment_status:H.payment_status,total_amount:parseFloat(H.total_amount)||0,paid_amount:parseFloat(H.paid_amount)||0}).select().single();if(i){if("23505"===i.code)throw Error("Cet élève est déjà inscrit à cette session");throw i}return h},onSuccess:()=>{g.invalidateQueries({queryKey:["session-enrollments",a]}),g.invalidateQueries({queryKey:["session",a]}),G(!1),I({student_id:"",enrollment_date:new Date().toISOString().split("T")[0],status:"confirmed",payment_status:"pending",total_amount:ak?.price?.toString()||"0",paid_amount:"0"})}}),as=(0,r.useMutation)({mutationFn:async a=>{let{data:b,error:c}=await f.from("enrollments").select("id, session_id, student_id").eq("id",a).single();if(c||!b)throw Error("Inscription non trouvée");let{data:d,error:e}=await f.from("sessions").select("id, start_date, end_date, status").eq("id",b.session_id||"").single();if(e||!d)throw Error("Session non trouvée");let g=new Date;g.setHours(0,0,0,0);let h=d.end_date?new Date(d.end_date):null;if(h&&h.setHours(23,59,59,999),"completed"===d.status||h&&h<g)throw Error("Impossible d'annuler une inscription pour une session déjà terminée");let{data:i,error:j}=await f.from("invoices").select("id, document_type, status").eq("enrollment_id",a).eq("document_type","invoice").maybeSingle();if(j)throw Error("Erreur lors de la vérification des factures");if(i)throw Error("Impossible d'annuler une inscription pour laquelle une facture a été émise");let{data:k,error:l}=await f.from("enrollments").update({status:"cancelled"}).eq("id",a).select().single();if(l)throw l;return k},onSuccess:()=>{g.invalidateQueries({queryKey:["session-enrollments",a]}),g.invalidateQueries({queryKey:["session",a]}),i({type:"success",title:"Inscription annulée",description:"L'inscription a été annulée avec succès."})},onError:b=>{i({type:"error",title:"Erreur",description:b instanceof Error?b.message:"Une erreur est survenue lors de l'annulation de l'inscription."}),B.logger.error("Erreur lors de l'annulation de l'inscription",b,{sessionId:a})}}),at=(0,r.useMutation)({mutationFn:async()=>{var b;if(!L.subject)throw Error("Le sujet est requis");if(!h?.organization_id)throw Error("Organisation non trouvée");let c=L.max_score?parseFloat(L.max_score):null,d=L.score?parseFloat(L.score):null,e=(b=L.assessment_type)&&({evaluation_generale:"other",preformation:"pre_formation",a_chaud:"hot",a_froid:"cold",managers:"manager",intervenants:"instructor",financeurs:"funder",quiz:"quiz",exam:"exam",project:"project",other:"other",pre_formation:"pre_formation",hot:"hot",cold:"cold",manager:"manager",instructor:"instructor",funder:"funder"})[b]||"other",f={subject:L.subject,assessment_type:e,student_id:L.student_id||null,session_id:a,score:d,max_score:c,notes:L.notes||null,graded_at:L.graded_at||new Date().toISOString(),teacher_id:h.id||null};Object.keys(f).forEach(a=>{void 0===f[a]&&(f[a]=null)});try{return await x.evaluationService.create(h.organization_id,f)}catch(a){throw console.error("Erreur détaillée création évaluation:",{error:a,message:a?.message,code:a?.code,details:a?.details,hint:a?.hint,evaluationData:f,organizationId:h.organization_id}),a}},onSuccess:()=>{g.invalidateQueries({queryKey:["session-grades",a]}),K(!1),M({subject:"",assessment_type:"evaluation_generale",student_id:void 0,score:"",max_score:"20",percentage:"",notes:"",graded_at:new Date().toISOString().split("T")[0]}),i({type:"success",title:"Évaluation créée",description:"L'évaluation a été créée avec succès."})},onError:b=>{i({type:"error",title:"Erreur",description:b instanceof Error?b.message:"Une erreur est survenue lors de la création de l'évaluation."}),B.logger.error("Erreur lors de la création de l'évaluation",b,{sessionId:a,evaluationForm:L})}}),au=async()=>{try{let a={formation_id:D.formation_id,name:D.name,code:D.code||"",start_date:D.start_date,end_date:D.end_date,start_time:D.start_time||"",end_time:D.end_time||"",location:D.location||"",capacity_max:D.capacity_max||"",currency:"XOF",status:D.status,teacher_id:D.teacher_id||"",manager1_id:D.manager1_id||"",manager2_id:D.manager2_id||"",inter_entreprise:D.inter_entreprise,sous_traitance:D.sous_traitance,timezone:D.timezone,program_ids:D.program_ids};C.sessionSchema.parse(a)}catch(a){if(a instanceof Error||a.errors){let b=(a.errors||[]).map(a=>`${a.path.join(".")}: ${a.message}`).join(", ");i({type:"error",title:"Erreur de validation",description:`Veuillez corriger les erreurs suivantes : ${b}`}),B.logger.error("Erreur de validation Zod",a,{formData:D});return}}let a={name:D.name,start_date:D.start_date,end_date:D.end_date,start_time:D.start_time||null,end_time:D.end_time||null,location:D.location||null,capacity_max:D.capacity_max?parseInt(D.capacity_max):null,teacher_id:D.teacher_id||null,status:D.status};D.formation_id&&D.formation_id!==V?.formation_id&&(a.formation_id=D.formation_id),await am.mutateAsync(a),h?.organization_id&&D.program_ids&&await an.mutateAsync({programIds:D.program_ids,organizationId:h.organization_id})},av=ah&&ah.length>0?{total:ah.length,average:ah.reduce((a,b)=>a+(Number(b.score)||0),0)/ah.length,averagePercentage:ah.reduce((a,b)=>{let c=Number(b.max_score)||20;return a+(Number(b.score)||0)/c*100},0)/ah.length}:null;return{activeStep:k,setActiveStep:c=>{l(c);let e=new URLSearchParams(d.toString());e.set("step",c),b.push(`/dashboard/sessions/${a}?${e.toString()}`,{scroll:!1})},activeTab:m,setActiveTab:n,activeGestionTab:o,setActiveGestionTab:p,formData:D,setFormData:E,enrollmentForm:H,setEnrollmentForm:I,showEnrollmentForm:F,setShowEnrollmentForm:G,evaluationForm:L,setEvaluationForm:M,showEvaluationForm:J,setShowEvaluationForm:K,slotConfig:N,setSlotConfig:O,isGeneratingZip:P,setIsGeneratingZip:Q,zipGenerationProgress:R,setZipGenerationProgress:S,lastZipGeneration:T,setLastZipGeneration:U,session:V,sessionData:V,formation:ak,program:al,programs:X,formations:Y,sessionPrograms:Z,users:$,sessionSlots:_,enrollments:ab,payments:ad,students:ae,attendanceStats:af,grades:ah,gradesStats:av,organization:aj,isLoading:W||ac||ag||ai,updateMutation:am,updateProgramsMutation:an,generateSlotsMutation:ao,deleteSlotMutation:ap,createSlotMutation:aq,createEnrollmentMutation:ar,cancelEnrollmentMutation:as,createEvaluationMutation:at,handleSave:au,refetchSlots:aa,user:h,router:b,queryClient:g,supabase:f}}(k),aM={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5,ease:[.16,1,.3,1]}}};return T?(0,b.jsxs)(L.motion.div,{className:"space-y-8 pb-8 max-w-[1600px] mx-auto",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3},children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("div",{className:"h-4 bg-gradient-to-r from-gray-200 to-gray-300 rounded w-32 animate-pulse"}),(0,b.jsx)("div",{className:"h-4 bg-gradient-to-r from-gray-200 to-gray-300 rounded w-4 animate-pulse"}),(0,b.jsx)("div",{className:"h-4 bg-gradient-to-r from-gray-200 to-gray-300 rounded w-24 animate-pulse"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-brand-blue/20 to-brand-cyan/20 rounded-2xl animate-pulse"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"h-10 bg-gradient-to-r from-gray-200 to-gray-300 rounded-xl w-64 animate-pulse"}),(0,b.jsx)("div",{className:"h-4 bg-gradient-to-r from-gray-200 to-gray-300 rounded w-48 animate-pulse"})]})]}),(0,b.jsx)("div",{className:"h-12 w-36 bg-gradient-to-br from-brand-blue/20 to-brand-cyan/20 rounded-xl animate-pulse"})]}),(0,b.jsx)("div",{className:"h-20 bg-gradient-to-r from-gray-100 to-gray-200 rounded-2xl animate-pulse"}),(0,b.jsx)(W,{})]}):S?(0,b.jsxs)(L.motion.div,{className:"space-y-8 pb-8 max-w-[1600px] mx-auto",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",children:[(0,b.jsxs)(L.motion.div,{variants:aM,className:"flex items-center space-x-2 text-sm",children:[(0,b.jsx)(d.default,{href:"/dashboard/sessions",className:"text-gray-500 hover:text-brand-blue transition-colors font-medium tracking-tight",children:"Toutes mes sessions"}),(0,b.jsx)("span",{className:"text-gray-300",children:"/"}),(0,b.jsx)("span",{className:"text-gray-700 font-semibold tracking-tight",children:M.name||V?.name}),"configuration"!==D&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"text-gray-300",children:"/"}),(0,b.jsx)("span",{className:"text-brand-blue font-bold tracking-tight",children:"gestion"===D?"Gestion":"espace_apprenant"===D?"Espace Apprenant":"suivi"===D?"Suivi":""})]})]}),(0,b.jsxs)(L.motion.div,{variants:aM,className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(d.default,{href:"/dashboard/sessions",children:(0,b.jsx)(L.motion.div,{whileHover:{scale:1.1,x:-3},whileTap:{scale:.95},transition:{type:"spring",stiffness:400,damping:15},children:(0,b.jsx)(f.Button,{variant:"ghost",size:"icon",className:"h-12 w-12 rounded-2xl hover:bg-gradient-to-br hover:from-brand-blue/10 hover:to-brand-cyan/10 transition-all",children:(0,b.jsx)(h.ArrowLeft,{className:"h-5 w-5"})})})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)(L.motion.div,{className:"p-2.5 bg-gradient-to-br from-brand-blue to-brand-cyan rounded-2xl shadow-lg shadow-brand-blue/20",whileHover:{scale:1.1,rotate:5},transition:{type:"spring",stiffness:400,damping:10},children:(0,b.jsx)(n.Calendar,{className:"h-6 w-6 text-white"})}),(0,b.jsx)("h1",{className:"text-3xl md:text-5xl font-display font-bold text-gray-900 tracking-tighter leading-none",children:M.name||V?.name}),(0,b.jsxs)(L.motion.div,{className:"px-3 py-1.5 bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost border-2 border-brand-blue/20 rounded-xl flex items-center gap-2 shadow-sm",whileHover:{scale:1.05},transition:{type:"spring",stiffness:400,damping:10},children:[(0,b.jsx)(p.Sparkles,{className:"h-4 w-4 text-brand-blue"}),(0,b.jsx)("span",{className:"text-xs font-bold text-brand-blue uppercase tracking-wide",children:"Session active"})]})]}),ai&&(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,b.jsx)(o.BookOpen,{className:"h-4 w-4 text-brand-cyan"}),(0,b.jsxs)("p",{className:"text-base font-medium tracking-tight",children:[ai.name,aj&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{className:"mx-2 text-gray-300",children:"•"}),(0,b.jsx)("span",{className:"text-brand-blue font-semibold",children:aj.name})]})]})]})]})]}),(0,b.jsx)(L.motion.div,{whileHover:{scale:1.05,y:-3},whileTap:{scale:.98},className:"flex items-center space-x-3",children:(0,b.jsxs)(f.Button,{onClick:aK,disabled:aG.isPending,className:"bg-gradient-to-br from-brand-blue to-brand-cyan text-white hover:from-brand-blue-dark hover:to-brand-cyan-dark shadow-xl shadow-brand-blue/20 hover:shadow-2xl hover:shadow-brand-cyan/30 transition-all duration-500 font-semibold tracking-tight px-6 py-6 text-base",children:[(0,b.jsx)(i.Save,{className:"mr-2 h-5 w-5"}),aG.isPending?"Sauvegarde...":"Enregistrer"]})})]}),(0,b.jsx)(L.motion.div,{variants:aM,children:(0,b.jsx)(I,{activeStep:D,onStepChange:E})}),(0,b.jsxs)("div",{children:["configuration"===D&&(0,b.jsx)(L.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.2},children:(0,b.jsx)(K,{activeTab:F,onTabChange:G})},"config-tabs"),"gestion"===D&&(0,b.jsx)(L.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{duration:.2},children:(0,b.jsx)(U,{activeTab:H,onTabChange:J})},"gestion-tabs")]}),(0,b.jsx)(L.motion.div,{variants:aM,children:(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,b.jsxs)("div",{className:"lg:col-span-3 space-y-6",children:["configuration"===D&&"initialisation"===F&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)(X,{formData:M,onFormDataChange:N,users:an})}),"configuration"===D&&"dates_prix"===F&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)(Y,{sessionId:k,formData:M,onFormDataChange:N,slotConfig:O,onSlotConfigChange:P,sessionSlots:ao,onSlotsRefetch:ap})}),"configuration"===D&&"programme"===F&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)(Z,{formData:M,onFormDataChange:N,programs:ak,formations:al,sessionPrograms:am,formation:ai||void 0,program:aj||void 0})}),"configuration"===D&&"intervenants"===F&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)($,{formData:M,onFormDataChange:N,users:an})}),"configuration"===D&&"apprenants"===F&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)(_,{sessionId:k,formationId:M.formation_id,enrollments:aq,students:as,enrollmentForm:ax,onEnrollmentFormChange:a=>{ay({...a,status:a.status||"pending",payment_status:a.payment_status||"pending"})},onCreateEnrollment:()=>aH.mutate(),createEnrollmentMutation:aH,formationPrice:ai?.price?"number"==typeof ai.price?ai.price:"string"==typeof ai.price&&parseFloat(ai.price)||void 0:void 0})}),"gestion"===D&&"conventions"===H&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)(aa,{sessionData:V,formation:ai||void 0,program:aj||void 0,organization:ar,enrollments:aq,isLoading:!aq,onShowEnrollmentForm:()=>{J("convocations"),R(!0)},onSwitchTab:a=>J(a)})}),"gestion"===D&&"convocations"===H&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)(ab,{sessionId:k,sessionData:V,formation:ai||void 0,program:aj||void 0,organization:ar,enrollments:aq,students:as,showEnrollmentForm:Q,enrollmentForm:ax,onEnrollmentFormChange:a=>{ay({...a,status:a.status||"pending",payment_status:a.payment_status||"pending"})},onCreateEnrollment:()=>aH.mutate(),createEnrollmentMutation:aH,cancelEnrollmentMutation:aI,onCloseEnrollmentForm:()=>R(!1),onShowEnrollmentForm:()=>R(!0),isGeneratingZip:aD,zipGenerationProgress:aE,lastZipGeneration:aF})}),"gestion"===D&&"evaluations"===H&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)(ac,{grades:au,gradesStats:av,students:as,showEvaluationForm:aB,evaluationForm:az,onEvaluationFormChange:aA,onCreateEvaluation:()=>aJ.mutate(),createEvaluationMutation:aJ,onCloseEvaluationForm:()=>aC(!1),onShowEvaluationForm:(a,b)=>{aA({...az,assessment_type:a||"evaluation_generale",subject:b||"Évaluation générale"}),aC(!0)}})}),"gestion"===D&&"finances"===H&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)(ad,{enrollments:aq,payments:at,sessionId:k,sessionData:V,organization:ar})}),"gestion"===D&&"espace_entreprise"===H&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)(ae,{sessionData:V,formation:ai||void 0,program:aj||void 0,organization:ar,enrollments:aq})}),"gestion"===D&&"automatisation"===H&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)(af,{sessionId:k,sessionData:V})}),"espace_apprenant"===D&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)(ag,{sessionId:k,sessionData:V,formation:ai||void 0,program:aj||void 0,organization:ar,enrollments:aq,grades:au,attendanceStats:aw,organizationId:aL?.organization_id||void 0,onShowEnrollmentForm:()=>{E("gestion"),J("convocations"),R(!0)},onSwitchToGestion:()=>{E("gestion"),J("convocations")}})}),"suivi"===D&&(0,b.jsx)(e.Suspense,{fallback:(0,b.jsx)(W,{}),children:(0,b.jsx)(ah,{sessionData:V,formation:ai||void 0,program:aj||void 0,organization:ar,enrollments:aq,grades:au,gradesStats:av,attendanceStats:aw})})]}),(0,b.jsx)("div",{className:"lg:col-span-1 space-y-6",children:(0,b.jsxs)(g.GlassCard,{variant:"premium",className:"overflow-hidden border-2 border-transparent hover:border-brand-blue/20 transition-all duration-500",children:[(0,b.jsx)("div",{className:"p-6 border-b-2 border-gray-100",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(L.motion.div,{className:"p-2 bg-gradient-to-br from-brand-blue to-brand-cyan rounded-xl shadow-md",whileHover:{rotate:5,scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:(0,b.jsx)(p.Sparkles,{className:"h-5 w-5 text-white"})}),(0,b.jsx)("h3",{className:"text-lg font-display font-bold text-gray-900 tracking-tight",children:"Actions rapides"})]})}),(0,b.jsxs)("div",{className:"p-4 space-y-3",children:[(0,b.jsx)(L.motion.div,{whileHover:{x:4,scale:1.02},whileTap:{scale:.98},children:(0,b.jsxs)(f.Button,{variant:"outline",className:"w-full justify-start gap-3 h-12 rounded-xl border-2 border-gray-200 hover:border-brand-blue/30 hover:bg-brand-blue-ghost transition-all font-semibold tracking-tight",size:"sm",children:[(0,b.jsx)("div",{className:"p-1.5 bg-brand-blue/10 rounded-lg",children:(0,b.jsx)(j.Copy,{className:"h-4 w-4 text-brand-blue"})}),(0,b.jsx)("span",{children:"Cloner la session"})]})}),(0,b.jsx)(L.motion.div,{whileHover:{x:4,scale:1.02},whileTap:{scale:.98},children:(0,b.jsxs)(f.Button,{variant:"outline",className:"w-full justify-start gap-3 h-12 rounded-xl border-2 border-gray-200 hover:border-brand-cyan/30 hover:bg-brand-cyan-ghost transition-all font-semibold tracking-tight",size:"sm",children:[(0,b.jsx)("div",{className:"p-1.5 bg-brand-cyan/10 rounded-lg",children:(0,b.jsx)(l,{className:"h-4 w-4 text-brand-cyan"})}),(0,b.jsx)("span",{children:"Archiver"})]})}),(0,b.jsx)(L.motion.div,{whileHover:{x:4,scale:1.02},whileTap:{scale:.98},children:(0,b.jsxs)(f.Button,{variant:"outline",className:"w-full justify-start gap-3 h-12 rounded-xl border-2 border-red-200 hover:border-red-400 hover:bg-red-50 text-red-600 hover:text-red-700 transition-all font-semibold tracking-tight",size:"sm",children:[(0,b.jsx)("div",{className:"p-1.5 bg-red-100 rounded-lg",children:(0,b.jsx)(m.Trash2,{className:"h-4 w-4 text-red-600"})}),(0,b.jsx)("span",{children:"Supprimer"})]})})]})]})})]})})]}):(0,b.jsx)(L.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.5,ease:[.16,1,.3,1]},className:"flex items-center justify-center min-h-screen",children:(0,b.jsxs)(g.GlassCard,{variant:"premium",className:"p-16 text-center border-2 border-dashed border-gray-200",children:[(0,b.jsx)(L.motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5,ease:[.16,1,.3,1]},className:"w-20 h-20 bg-gradient-to-br from-brand-blue/10 to-brand-cyan/10 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:(0,b.jsx)(n.Calendar,{className:"h-10 w-10 text-brand-blue"})}),(0,b.jsx)(L.motion.h3,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},className:"text-2xl font-display font-bold text-gray-900 mb-2 tracking-tight",children:"Session non trouvée"}),(0,b.jsx)(L.motion.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},className:"text-gray-600 mb-8 font-medium tracking-tight",children:"Cette session n'existe pas ou a été supprimée."}),(0,b.jsx)(L.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5,duration:.5},whileHover:{scale:1.05,y:-3},whileTap:{scale:.98},children:(0,b.jsx)(d.default,{href:"/dashboard/sessions",children:(0,b.jsxs)(f.Button,{className:"bg-gradient-to-br from-brand-blue to-brand-cyan text-white hover:from-brand-blue-dark hover:to-brand-cyan-dark shadow-xl shadow-brand-blue/20 hover:shadow-2xl hover:shadow-brand-cyan/30 transition-all duration-500 font-semibold tracking-tight px-6 py-6 text-base",children:[(0,b.jsx)(h.ArrowLeft,{className:"mr-2 h-5 w-5"}),"Retour à la liste"]})})})]})})}a.s(["default",()=>ai],468006)}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_sessions_%5Bid%5D_page_tsx_1f88a706._.js.map