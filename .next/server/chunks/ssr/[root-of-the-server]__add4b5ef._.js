module.exports=[224361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},814747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},641710,a=>{"use strict";let b=(0,a.i(170106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],641710)},724669,a=>{"use strict";let b=(0,a.i(170106).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);a.s(["TrendingUp",()=>b],724669)},427699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},254799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},522734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},500874,(a,b,c)=>{b.exports=a.x("buffer",()=>require("buffer"))},688947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},449719,(a,b,c)=>{b.exports=a.x("assert",()=>require("assert"))},406461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},922520,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);a.s(["ArrowUpRight",()=>b],922520)},50429,a=>{"use strict";let b=(0,a.i(170106).default)("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);a.s(["Target",()=>b],50429)},593547,a=>{"use strict";var b=a.i(269240);class c{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async create(a){try{let{data:b,error:c}=await this.supabase.from("export_history").insert({organization_id:a.organizationId,user_id:a.userId,export_type:a.exportType,entity_type:a.entityType,filename:a.filename,record_count:a.recordCount||0,file_size_bytes:a.fileSizeBytes,filters:a.filters?JSON.stringify(a.filters):null}).select().single();if(c){if("PGRST205"===c.code||c.message?.includes("Could not find the table"))return null;throw c}return b}catch(a){if(a?.code==="PGRST205"||a?.message?.includes("Could not find the table"))return null;throw a}}async getByOrganization(a,b){try{let c=b?.page||1,d=b?.limit||50,e=(c-1)*d,f=this.supabase.from("export_history").select("*, users(full_name, email)",{count:"exact"}).eq("organization_id",a).order("created_at",{ascending:!1});b?.userId&&(f=f.eq("user_id",b.userId)),b?.exportType&&(f=f.eq("export_type",b.exportType)),b?.entityType&&(f=f.eq("entity_type",b.entityType));let{data:g,error:h,count:i}=await f.range(e,e+d-1);if(h){if("PGRST116"===h.code||"PGRST200"===h.code||"42P01"===h.code||"PGRST301"===h.code||400===h.status||404===h.status||"400"===h.code||"404"===h.code||h.message?.includes("relation")||h.message?.includes("does not exist"))return{data:[],total:0,page:c,limit:d,totalPages:0};throw h}return{data:g||[],total:i||0,page:c,limit:d,totalPages:Math.ceil((i||0)/d)}}catch(a){if(a?.code==="PGRST116"||a?.code==="PGRST200"||a?.code==="42P01"||a?.code==="PGRST301"||a?.status===400||a?.status===404||a?.code==="400"||a?.code==="404"||a?.message?.includes("relation")||a?.message?.includes("does not exist"))return{data:[],total:0,page:b?.page||1,limit:b?.limit||50,totalPages:0};throw a}}async getStats(a){try{let{data:b,error:c}=await this.supabase.from("export_history").select("export_type, entity_type, record_count, file_size_bytes").eq("organization_id",a);if(c){if("PGRST116"===c.code||"PGRST200"===c.code||"42P01"===c.code||"PGRST301"===c.code||400===c.status||404===c.status||"400"===c.code||"404"===c.code||c.message?.includes("relation")||c.message?.includes("does not exist"))return{total:0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};throw c}let d={total:b?.length||0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};return b?.forEach(a=>{d.byType[a.export_type]=(d.byType[a.export_type]||0)+1,d.byEntity[a.entity_type]=(d.byEntity[a.entity_type]||0)+1,d.totalRecords+=a.record_count||0,d.totalSizeBytes+=a.file_size_bytes||0}),d}catch(a){if(a?.code==="PGRST116"||a?.code==="PGRST200"||a?.code==="42P01"||a?.code==="PGRST301"||a?.status===400||a?.status===404||a?.code==="400"||a?.code==="404"||a?.message?.includes("relation")||a?.message?.includes("does not exist"))return{total:0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};throw a}}async delete(a,b){let{error:c}=await this.supabase.from("export_history").delete().eq("id",a).eq("user_id",b);if(c)throw c}async deleteByUser(a,b){let{error:c}=await this.supabase.from("export_history").delete().eq("user_id",a).eq("organization_id",b);if(c)throw c}}let d=new c;a.s(["ExportHistoryService",()=>c,"exportHistoryService",0,d])},523025,a=>{"use strict";let b=(0,a.i(170106).default)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);a.s(["Minus",()=>b],523025)},211989,a=>{"use strict";var b=a.i(222703),c=a.i(96659),d=a.i(460017),e=a.i(593547);async function f(a,c={}){if(!a||0===a.length)throw Error("Aucune donnée à exporter");let{filename:g=`export_${new Date().toISOString().split("T")[0]}`,sheetName:h="Données",format:i="xlsx",entityType:j="other",organizationId:k,userId:l}=c,m=`${g}.${"csv"===i?"csv":"xlsx"}`;if("csv"===i)(0,b.exportToCSV)(m,a),d.analytics.export.csv(h,a.length);else{let c=Object.keys(a[0]||{}).map(a=>({header:a,key:a,width:20}));await (0,b.exportToExcel)({filename:m,sheetName:h,columns:c,data:a}),d.analytics.export.excel(h,a.length)}if(k&&l)try{await e.exportHistoryService.create({organizationId:k,userId:l,exportType:"csv"===i?"csv":"excel",entityType:j||"other",filename:m,recordCount:a.length})}catch(a){if(a?.code==="PGRST205"||a?.message?.includes("Could not find the table"))return}}function g(a){return a.map(a=>({Numéro:a.student_number||"",Prénom:a.first_name||"",Nom:a.last_name||"",Email:a.email||"",Téléphone:a.phone||"","Date de naissance":a.date_of_birth?(0,c.formatDate)(a.date_of_birth):"",Statut:"active"===a.status?"Actif":"Inactif","Date d'inscription":a.enrollment_date?(0,c.formatDate)(a.enrollment_date):"",Classe:a.classes?.name||"",Niveau:a.classes?.level||""}))}a.s(["exportData",()=>f,"prepareStudentsExport",()=>g])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__add4b5ef._.js.map