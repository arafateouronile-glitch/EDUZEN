module.exports=[495756,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],495756)},114548,a=>{"use strict";let b=(0,a.i(170106).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);a.s(["Save",()=>b],114548)},280281,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);let e=c.forwardRef(({checked:a,onCheckedChange:c,disabled:e,className:f,...g},h)=>(0,b.jsx)("button",{type:"button",role:"switch","aria-checked":a,ref:h,disabled:e,onClick:()=>c?.(!a),className:(0,d.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",a?"bg-brand-blue":"bg-input",f),...g,children:(0,b.jsx)("span",{className:(0,d.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",a?"translate-x-5":"translate-x-0")})}));e.displayName="Switch",a.s(["Switch",0,e])},67117,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(269240),i=a.i(340695),j=a.i(703130),k=a.i(205522),l=a.i(917171),m=a.i(280281),n=a.i(864037),o=a.i(911156),p=a.i(114548),q=a.i(495756),r=a.i(290821),s=a.i(797063);class t{config;constructor(a){this.config=a}async createTransfer(a){let b=await fetch("/api/payments/sepa/create-transfer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:a.amount,currency:a.currency,description:a.description,debtor_name:a.debtorName,debtor_iban:a.debtorIban,debtor_bic:a.debtorBic,debtor_email:a.debtorEmail,reference:a.reference,creditor_name:this.config.creditorName,creditor_iban:this.config.creditorIban,creditor_bic:this.config.creditorBic})});if(!b.ok)throw Error((await b.json()).message||"Erreur lors de la création du virement SEPA");return b.json()}async createDirectDebit(a){if(!a.mandateId)throw Error("Le mandat SEPA est requis pour un prélèvement");let b=await fetch("/api/payments/sepa/create-direct-debit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:a.amount,currency:a.currency,description:a.description,debtor_name:a.debtorName,debtor_iban:a.debtorIban,debtor_bic:a.debtorBic,reference:a.reference,due_date:a.dueDate,mandate_id:a.mandateId,creditor_name:this.config.creditorName,creditor_iban:this.config.creditorIban,creditor_id:this.config.creditorId})});if(!b.ok)throw Error((await b.json()).message||"Erreur lors de la création du prélèvement SEPA");return b.json()}async getPaymentStatus(a){let b=await fetch(`/api/payments/sepa/status/${a}`);if(!b.ok)throw Error((await b.json()).message||"Erreur lors de la vérification du paiement SEPA");return b.json()}validateIBAN(a){let b=a.replace(/\s/g,"").toUpperCase();return!(b.length<15)&&!(b.length>34)&&!!/^[A-Z]{2}\d{2}[A-Z0-9]+$/.test(b)}validateBIC(a){let b=a.replace(/\s/g,"").toUpperCase();return(8===b.length||11===b.length)&&/^[A-Z]{4}[A-Z]{2}[A-Z0-9]{2}([A-Z0-9]{3})?$/.test(b)}}function u(){let{user:a}=(0,g.useAuth)(),u=(0,f.useQueryClient)();(0,h.createClient)();let{addToast:v}=(0,n.useToast)(),[w,x]=(0,c.useState)({creditor_name:"",creditor_iban:"",creditor_bic:"",creditor_id:"",is_active:!1}),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(null),{data:C,isLoading:D}=(0,d.useQuery)({queryKey:["sepa-config",a?.organization_id],queryFn:async()=>a?.organization_id?{creditor_name:"",creditor_iban:"",creditor_bic:"",creditor_id:"",is_active:!1}:null,enabled:!!a?.organization_id}),E=a=>{let b=new t({creditorName:w.creditor_name,creditorIban:a,creditorBic:w.creditor_bic}).validateIBAN(a);return z(b),b},F=a=>{let b=new t({creditorName:w.creditor_name,creditorIban:w.creditor_iban,creditorBic:a}).validateBIC(a);return B(b),b},G=(0,e.useMutation)({mutationFn:async a=>{if(!a.creditor_name)throw Error("Le nom du créancier est requis");if(!a.creditor_iban)throw Error("L'IBAN créancier est requis");if(!E(a.creditor_iban))throw Error("IBAN invalide");if(a.creditor_bic&&!F(a.creditor_bic))throw Error("BIC invalide");return await new Promise(a=>setTimeout(a,500)),a},onSuccess:()=>{u.invalidateQueries({queryKey:["sepa-config"]}),v({title:"Configuration sauvegardée",description:"Les paramètres SEPA ont été enregistrés avec succès.",type:"success"})},onError:a=>{v({title:"Erreur",description:a.message||"Erreur lors de la sauvegarde",type:"error"})}});return D?(0,b.jsx)("div",{className:"container mx-auto py-8",children:(0,b.jsx)("div",{className:"text-center",children:"Chargement..."})}):(0,b.jsxs)("div",{className:"container mx-auto py-8 space-y-6 max-w-4xl",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-2",children:[(0,b.jsx)(o.CreditCard,{className:"h-8 w-8"}),"Configuration SEPA"]}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Configurez les paiements par virement bancaire SEPA et prélèvements automatiques"})]}),(0,b.jsxs)(j.Card,{children:[(0,b.jsx)(j.CardHeader,{children:(0,b.jsxs)(j.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(s.Info,{className:"h-5 w-5"}),"À propos de SEPA"]})}),(0,b.jsxs)(j.CardContent,{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"SEPA (Single Euro Payments Area) permet d'effectuer des virements bancaires et des prélèvements automatiques dans toute la zone euro. Vous devez fournir les informations bancaires de votre organisation."}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Virements SEPA :"})," Les clients effectuent des virements manuels vers votre compte"]}),(0,b.jsxs)("p",{children:[(0,b.jsx)("strong",{children:"Prélèvements SEPA :"})," Vous pouvez prélever automatiquement les montants dus (nécessite un mandat)"]})]})]})]}),(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsx)(j.CardTitle,{children:"Informations bancaires"}),(0,b.jsx)(j.CardDescription,{children:"Entrez les informations bancaires de votre organisation (créancier)"})]}),(0,b.jsxs)(j.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"creditor_name",children:"Nom du créancier"}),(0,b.jsx)(k.Input,{id:"creditor_name",type:"text",placeholder:"Nom de votre organisation",value:w.creditor_name,onChange:a=>x({...w,creditor_name:a.target.value}),className:"mt-1"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Nom qui apparaîtra sur les relevés bancaires des clients"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"creditor_iban",children:"IBAN créancier"}),(0,b.jsx)(k.Input,{id:"creditor_iban",type:"text",placeholder:"FR76 XXXX XXXX XXXX XXXX XXXX XXX",value:w.creditor_iban,onChange:a=>{let b=a.target.value.toUpperCase().replace(/\s/g,"");x({...w,creditor_iban:b}),b.length>4?E(b):z(null)},className:"mt-1"}),!1===y&&(0,b.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"IBAN invalide"}),!0===y&&(0,b.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"IBAN valide"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"IBAN de votre compte bancaire (format: FR76 XXXX XXXX...)"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"creditor_bic",children:"BIC créancier (optionnel mais recommandé)"}),(0,b.jsx)(k.Input,{id:"creditor_bic",type:"text",placeholder:"ABCDEFGH",value:w.creditor_bic,onChange:a=>{let b=a.target.value.toUpperCase().replace(/\s/g,"");x({...w,creditor_bic:b}),b.length>0?F(b):B(null)},className:"mt-1"}),!1===A&&(0,b.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"BIC invalide"}),!0===A&&(0,b.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"BIC valide"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Code BIC/SWIFT de votre banque (8 ou 11 caractères)"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"creditor_id",children:"Identifiant créancier (pour prélèvements)"}),(0,b.jsx)(k.Input,{id:"creditor_id",type:"text",placeholder:"FR98Z123456789",value:w.creditor_id,onChange:a=>x({...w,creditor_id:a.target.value.toUpperCase()}),className:"mt-1"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Identifiant unique délivré par votre banque pour les prélèvements SEPA"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-2",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(l.Label,{htmlFor:"is_active",children:"Activer SEPA"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Activez les paiements SEPA pour votre organisation"})]}),(0,b.jsx)(m.Switch,{checked:w.is_active,onCheckedChange:a=>x({...w,is_active:a})})]})]})]}),(0,b.jsx)("div",{className:"flex gap-4",children:(0,b.jsxs)(i.Button,{onClick:()=>G.mutate(w),disabled:G.isPending||!w.creditor_name||!w.creditor_iban,children:[(0,b.jsx)(p.Save,{className:"h-4 w-4 mr-2"}),G.isPending?"Sauvegarde...":"Sauvegarder"]})}),G.isSuccess&&(0,b.jsx)(j.Card,{className:"border-green-200 bg-green-50",children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-green-800",children:[(0,b.jsx)(q.CheckCircle,{className:"h-5 w-5"}),(0,b.jsx)("span",{className:"font-semibold",children:"Configuration sauvegardée"})]})})}),G.isError&&(0,b.jsx)(j.Card,{className:"border-red-200 bg-red-50",children:(0,b.jsxs)(j.CardContent,{className:"pt-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,b.jsx)(r.AlertCircle,{className:"h-5 w-5"}),(0,b.jsx)("span",{className:"font-semibold",children:"Erreur"})]}),(0,b.jsx)("p",{className:"text-sm text-red-700 mt-2",children:G.error instanceof Error?G.error.message:"Erreur inconnue"})]})})]})}a.s(["default",()=>u],67117)}];

//# sourceMappingURL=_a4fd45c4._.js.map