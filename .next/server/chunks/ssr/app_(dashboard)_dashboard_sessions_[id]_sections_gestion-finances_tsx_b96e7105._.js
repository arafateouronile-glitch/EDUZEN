module.exports=[101732,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(269240),i=a.i(908403),j=a.i(307676),k=a.i(872675),l=a.i(371791),m=a.i(789001),n=a.i(595583),o=a.i(716802),p=a.i(703130),q=a.i(340695),r=a.i(497895),s=a.i(864037),t=a.i(238246),u=a.i(284505),v=a.i(104720),w=a.i(915618),x=a.i(501199),y=a.i(790166),z=a.i(177156),A=a.i(405784),B=a.i(767552),C=a.i(781560),D=a.i(683245),E=a.i(653277);function F({enrollments:a=[],payments:F=[],sessionId:G,sessionData:H,organization:I}){let{user:J}=(0,g.useAuth)(),K=(0,h.createClient)(),L=(0,f.useQueryClient)(),{addToast:M}=(0,s.useToast)(),[N,O]=(0,c.useState)(null),[P,Q]=(0,c.useState)(!1),[R,S]=(0,c.useState)(!1),[T,U]=(0,c.useState)(!1),[V,W]=(0,c.useState)(null),[X,Y]=(0,c.useState)(null),[Z,$]=(0,c.useState)(null),[_,aa]=(0,c.useState)(!1),[ab,ac]=(0,c.useState)(!1),[ad,ae]=(0,c.useState)(null),af=a.map(a=>a.student_id).filter(Boolean),{data:ag}=(0,d.useQuery)({queryKey:["session-invoices",G,af],queryFn:async()=>{if(!J?.organization_id||0===af.length)return[];let a=[];for(let b of af){if(!b)continue;let c=await i.invoiceService.getAll(J.organization_id,{studentId:b});a.push(...c)}return a},enabled:!!J?.organization_id&&af.length>0}),{data:ah}=(0,d.useQuery)({queryKey:["organization",J?.organization_id],queryFn:async()=>{if(!J?.organization_id)return null;let{data:a,error:b}=await K.from("organizations").select("*").eq("id",J.organization_id).single();if(b)throw b;return a},enabled:!!J?.organization_id}),ai=I||ah,{data:aj}=(0,d.useQuery)({queryKey:["academic-year",J?.organization_id],queryFn:async()=>{if(!J?.organization_id)return null;let{data:a,error:b}=await K.from("academic_years").select("*").eq("organization_id",J.organization_id).eq("is_current",!0).maybeSingle();return b?(console.warn("Erreur lors de la récupération de l'année académique:",b),null):a||null},enabled:!!J?.organization_id}),{data:ak}=(0,d.useQuery)({queryKey:["invoice-template",J?.organization_id],queryFn:async()=>{if(!J?.organization_id)return null;let a=await k.documentTemplateService.getTemplatesByType("facture",J.organization_id);return a.length>0?a[0]:null},enabled:!!J?.organization_id}),{data:al}=(0,d.useQuery)({queryKey:["quote-template",J?.organization_id],queryFn:async()=>{if(!J?.organization_id)return null;let a=await k.documentTemplateService.getTemplatesByType("devis",J.organization_id);return a.length>0?a[0]:null},enabled:!!J?.organization_id}),{data:am,refetch:an}=(0,d.useQuery)({queryKey:["session-charges",G],queryFn:async()=>G?l.sessionChargesService.getBySession(G):[],enabled:!!G}),{data:ao}=(0,d.useQuery)({queryKey:["session-charges-summary",G],queryFn:async()=>G?l.sessionChargesService.getSessionSummary(G):null,enabled:!!G}),{data:ap}=(0,d.useQuery)({queryKey:["charge-categories",J?.organization_id],queryFn:async()=>{if(!J?.organization_id)return[];let a=await l.sessionChargesService.getCategories(J.organization_id);return 0===a.length?(await l.sessionChargesService.initDefaultCategories(J.organization_id),l.sessionChargesService.getCategories(J.organization_id)):a},enabled:!!J?.organization_id}),[aq,ar]=(0,c.useState)({description:"",amount:"",currency:"EUR",charge_date:new Date().toISOString().split("T")[0],category_id:"",payment_method:"",payment_status:"pending",vendor:"",vendor_invoice_number:"",vendor_invoice_date:"",notes:""}),[as,at]=(0,c.useState)({amount:"",currency:"EUR",payment_method:"cash",transaction_id:"",notes:""}),[au,av]=(0,c.useState)({amount:"",tax_amount:"0",currency:"EUR",issue_date:new Date().toISOString().split("T")[0],due_date:new Date(Date.now()+2592e6).toISOString().split("T")[0],notes:""}),aw=async(a,b)=>{if(!ai||!a)return void M({type:"error",title:"Erreur",description:"Données manquantes pour la génération du document."});let c="invoice"===b?ak:al;if(!c)return void M({type:"error",title:"Erreur",description:`Aucun mod\xe8le de ${"invoice"===b?"facture":"devis"} trouv\xe9.`});Y(a.id);try{let d=a.students,e=(0,n.extractDocumentVariables)({student:d,organization:ai,session:H,invoice:a,academicYear:aj,language:"fr",issueDate:a.issue_date}),f=await (0,m.generateHTML)(c,e,void 0,J?.organization_id||void 0),g=`${"invoice"===b?"facture":"devis"}_${a.invoice_number}.pdf`,h=document.createElement("div");h.style.position="absolute",h.style.left="-9999px",h.style.top="0",h.style.width="794px",h.style.minHeight="1123px",h.style.backgroundColor="#ffffff",h.style.overflow="visible",h.style.fontFamily="Arial, sans-serif",document.body.appendChild(h),h.innerHTML=new DOMParser().parseFromString(f.html,"text/html").body.innerHTML;let i=h.querySelector(".document-container")||h.querySelector('[id$="-document"]')||h.firstElementChild;i&&i instanceof HTMLElement||(i=h);let j=`temp-pdf-${b}-${a.id}-${Date.now()}`;if(i instanceof HTMLElement&&(i.id=j,i.style.width||(i.style.width="794px"),i.style.minHeight||(i.style.minHeight="1123px"),i.style.backgroundColor="#ffffff"),await new Promise(a=>setTimeout(a,1e3)),i instanceof HTMLElement){let a=i.getBoundingClientRect();(0===a.width||0===a.height)&&(i=h,h.id=j,h.style.width="794px",h.style.minHeight="1123px")}await (0,o.generatePDFFromHTML)(j,g),M({type:"success",title:"Document téléchargé",description:`Le ${"invoice"===b?"facture":"devis"} a \xe9t\xe9 g\xe9n\xe9r\xe9 et t\xe9l\xe9charg\xe9 avec succ\xe8s.`})}catch(a){console.error("Erreur lors de la génération du document:",a),M({type:"error",title:"Erreur",description:"Une erreur est survenue lors de la génération du document."})}finally{Y(null),document.querySelectorAll(`[id^="temp-pdf-${b}-"]`).forEach(a=>{a.parentNode===document.body&&document.body.removeChild(a)})}},ax=(0,e.useMutation)({mutationFn:async()=>{if(!J?.organization_id)throw Error("Données manquantes");if(!N)throw Error("Veuillez sélectionner un étudiant depuis la liste ci-dessus.");let b=a.find(a=>a.id===N);if(!b||!b.students)throw Error("Inscription non trouvée");let c=parseFloat(au.amount)||0,d=parseFloat(au.tax_amount)||0;return i.invoiceService.create({organization_id:J.organization_id,student_id:b.student_id,invoice_number:"",type:"tuition",document_type:"invoice",issue_date:au.issue_date,due_date:au.due_date,amount:c,tax_amount:d,total_amount:c+d,currency:au.currency,status:"sent",notes:au.notes})},onSuccess:()=>{M({type:"success",title:"Facture créée",description:"La facture a été créée avec succès."}),S(!1),av({amount:"",tax_amount:"0",currency:"EUR",issue_date:new Date().toISOString().split("T")[0],due_date:new Date(Date.now()+2592e6).toISOString().split("T")[0],notes:""}),L.invalidateQueries({queryKey:["session-invoices",G]})},onError:a=>{M({type:"error",title:"Erreur",description:a?.message||"Erreur lors de la création de la facture."})}}),ay=(0,e.useMutation)({mutationFn:async()=>{if(!J?.organization_id)throw Error("Données manquantes");if(!N)throw Error("Veuillez sélectionner un étudiant depuis la liste ci-dessus.");let b=a.find(a=>a.id===N);if(!b||!b.students)throw Error("Inscription non trouvée");let c=parseFloat(au.amount)||0,d=parseFloat(au.tax_amount)||0;return i.invoiceService.create({organization_id:J.organization_id,student_id:b.student_id,invoice_number:"",type:"tuition",document_type:"quote",issue_date:au.issue_date,due_date:au.due_date,amount:c,tax_amount:d,total_amount:c+d,currency:au.currency,status:"draft",notes:au.notes})},onSuccess:()=>{M({type:"success",title:"Devis créé",description:"Le devis a été créé avec succès."}),U(!1),av({amount:"",tax_amount:"0",currency:"EUR",issue_date:new Date().toISOString().split("T")[0],due_date:new Date(Date.now()+2592e6).toISOString().split("T")[0],notes:""}),L.invalidateQueries({queryKey:["session-invoices",G]})},onError:a=>{M({type:"error",title:"Erreur",description:a?.message||"Erreur lors de la création du devis."})}}),az=(0,e.useMutation)({mutationFn:async()=>{if(!N||!J?.organization_id)throw Error("Données manquantes");let b=a.find(a=>a.id===N);if(!b||!b.students)throw Error("Inscription non trouvée");let c=parseFloat(as.amount);if(isNaN(c)||c<=0)throw Error("Montant de paiement invalide");let d=ag?.find(a=>a.student_id===b.student_id&&"invoice"===a.document_type);return j.paymentService.create({organization_id:J.organization_id,invoice_id:d?.id||null,student_id:b.student_id,amount:c,currency:as.currency,payment_method:as.payment_method,payment_provider:"card"===as.payment_method||"sepa"===as.payment_method?"stripe":null,transaction_id:as.transaction_id||null,status:"cash"===as.payment_method?"completed":"pending",paid_at:"cash"===as.payment_method?new Date().toISOString():null,metadata:{notes:as.notes}})},onSuccess:()=>{M({type:"success",title:"Paiement enregistré",description:"Le paiement a été enregistré avec succès."}),Q(!1),at({amount:"",currency:"EUR",payment_method:"cash",transaction_id:"",notes:""}),L.invalidateQueries({queryKey:["payments"]})},onError:a=>{M({type:"error",title:"Erreur",description:a?.message||"Erreur lors de l'enregistrement du paiement."})}}),aA=a.reduce((a,b)=>a+Number(b.total_amount||0),0),aB=a.reduce((a,b)=>a+Number(b.paid_amount||0),0),aC=a.reduce((a,b)=>a+(Number(b.total_amount||0)-Number(b.paid_amount||0)),0),aD=F.reduce((a,b)=>a+Number(b.amount||0),0),aE=a.filter(a=>Number(a.total_amount||0)-Number(a.paid_amount||0)>0),aF=(0,e.useMutation)({mutationFn:async()=>{if(!J?.organization_id||!G)throw Error("Données manquantes");if(!aq.description||!aq.amount)throw Error("La description et le montant sont requis");return l.sessionChargesService.create(J.organization_id,G,{description:aq.description,amount:parseFloat(aq.amount),currency:aq.currency,charge_date:aq.charge_date,category_id:aq.category_id||null,payment_method:aq.payment_method||null,payment_status:aq.payment_status,paid_at:"paid"===aq.payment_status?new Date().toISOString():null,vendor:aq.vendor||null,vendor_invoice_number:aq.vendor_invoice_number||null,vendor_invoice_date:aq.vendor_invoice_date||null,notes:aq.notes||null})},onSuccess:()=>{M({type:"success",title:"Charge créée",description:"La charge a été créée avec succès."}),ac(!1),ar({description:"",amount:"",currency:"EUR",charge_date:new Date().toISOString().split("T")[0],category_id:"",payment_method:"",payment_status:"pending",vendor:"",vendor_invoice_number:"",vendor_invoice_date:"",notes:""}),an(),L.invalidateQueries({queryKey:["session-charges-summary",G]})},onError:a=>{M({type:"error",title:"Erreur",description:a?.message||"Erreur lors de la création de la charge."})}}),aG=(0,e.useMutation)({mutationFn:async()=>{if(!ad)throw Error("Aucune charge sélectionnée");if(!aq.description||!aq.amount)throw Error("La description et le montant sont requis");return l.sessionChargesService.update(ad.id,{description:aq.description,amount:parseFloat(aq.amount),currency:aq.currency,charge_date:aq.charge_date,category_id:aq.category_id||null,payment_method:aq.payment_method||null,payment_status:aq.payment_status,paid_at:"paid"===aq.payment_status?ad.paid_at||new Date().toISOString():null,vendor:aq.vendor||null,vendor_invoice_number:aq.vendor_invoice_number||null,vendor_invoice_date:aq.vendor_invoice_date||null,notes:aq.notes||null})},onSuccess:()=>{M({type:"success",title:"Charge mise à jour",description:"La charge a été mise à jour avec succès."}),ac(!1),ae(null),ar({description:"",amount:"",currency:"EUR",charge_date:new Date().toISOString().split("T")[0],category_id:"",payment_method:"",payment_status:"pending",vendor:"",vendor_invoice_number:"",vendor_invoice_date:"",notes:""}),an(),L.invalidateQueries({queryKey:["session-charges-summary",G]})},onError:a=>{M({type:"error",title:"Erreur",description:a?.message||"Erreur lors de la mise à jour de la charge."})}}),aH=(0,e.useMutation)({mutationFn:async a=>{await l.sessionChargesService.delete(a)},onSuccess:()=>{M({type:"success",title:"Charge supprimée",description:"La charge a été supprimée avec succès."}),an(),L.invalidateQueries({queryKey:["session-charges-summary",G]})},onError:a=>{M({type:"error",title:"Erreur",description:a?.message||"Erreur lors de la suppression de la charge."})}}),aI=()=>{ae(null),ar({description:"",amount:"",currency:"EUR",charge_date:new Date().toISOString().split("T")[0],category_id:"",payment_method:"",payment_status:"pending",vendor:"",vendor_invoice_number:"",vendor_invoice_date:"",notes:""}),ac(!0)};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{className:"pb-3",children:(0,b.jsx)(p.CardTitle,{className:"text-base font-medium",children:"Revenu total"})}),(0,b.jsxs)(p.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-brand-blue",children:(0,r.formatCurrency)(aA,"EUR")}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[a.length," inscription",a.length>1?"s":""]})]})]}),(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{className:"pb-3",children:(0,b.jsx)(p.CardTitle,{className:"text-base font-medium",children:"Montant payé"})}),(0,b.jsxs)(p.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:(0,r.formatCurrency)(aB,"EUR")}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[(0,r.formatCurrency)(aD,"EUR")," via paiements"]})]})]}),(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{className:"pb-3",children:(0,b.jsx)(p.CardTitle,{className:"text-base font-medium",children:"Reste à payer"})}),(0,b.jsxs)(p.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:(0,r.formatCurrency)(aC,"EUR")}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[aE.length," inscription",aE.length>1?"s":""," avec solde"]})]})]}),(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{className:"pb-3",children:(0,b.jsx)(p.CardTitle,{className:"text-base font-medium",children:"Charges totales"})}),(0,b.jsxs)(p.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:(0,r.formatCurrency)(ao?.total_amount||0,"EUR")}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[ao?.charge_count||0," charge",(ao?.charge_count||0)>1?"s":""]})]})]})]}),(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(p.CardTitle,{children:"Charges de la session"}),ao&&ao.charge_count>0&&(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["(",(0,r.formatCurrency)(ao.total_amount,"EUR"),")"]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(q.Button,{variant:"outline",size:"sm",onClick:aI,children:[(0,b.jsx)(w.Plus,{className:"mr-2 h-4 w-4"}),"Nouvelle charge"]}),(0,b.jsx)(q.Button,{variant:"ghost",size:"icon",onClick:()=>aa(!_),children:_?(0,b.jsx)(B.ChevronUp,{className:"h-4 w-4"}):(0,b.jsx)(A.ChevronDown,{className:"h-4 w-4"})})]})]})}),_&&(0,b.jsx)(p.CardContent,{children:am&&am.length>0?(0,b.jsxs)("div",{className:"space-y-3",children:[am.map(a=>(0,b.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)("h4",{className:"font-medium",children:a.description}),a.charge_categories&&(0,b.jsx)("span",{className:"text-xs px-2 py-1 bg-blue-50 text-blue-700 rounded",children:a.charge_categories.name})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm text-muted-foreground",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium",children:"Montant:"})," ",(0,b.jsx)("span",{className:"text-red-600 font-bold",children:(0,r.formatCurrency)(Number(a.amount),a.currency)})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium",children:"Date:"})," ",new Date(a.charge_date).toLocaleDateString("fr-FR")]}),a.vendor&&(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium",children:"Fournisseur:"})," ",a.vendor]}),(0,b.jsx)("div",{children:(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"paid"===a.payment_status?"bg-green-100 text-green-700":"pending"===a.payment_status?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:"paid"===a.payment_status?"Payé":"pending"===a.payment_status?"En attente":"Annulé"})})]}),a.notes&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:a.notes})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,b.jsx)(q.Button,{variant:"ghost",size:"icon",onClick:()=>{ae(a),ar({description:a.description,amount:String(a.amount),currency:a.currency,charge_date:a.charge_date,category_id:a.category_id||"",payment_method:a.payment_method||"",payment_status:a.payment_status,vendor:a.vendor||"",vendor_invoice_number:a.vendor_invoice_number||"",vendor_invoice_date:a.vendor_invoice_date||"",notes:a.notes||""}),ac(!0)},children:(0,b.jsx)(D.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(q.Button,{variant:"ghost",size:"icon",onClick:()=>{confirm("Êtes-vous sûr de vouloir supprimer cette charge ?")&&aH.mutate(a.id)},children:(0,b.jsx)(C.Trash2,{className:"h-4 w-4 text-destructive"})})]})]})},a.id)),ao&&(0,b.jsxs)("div",{className:"mt-4 pt-4 border-t grid grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total"}),(0,b.jsx)("p",{className:"text-lg font-bold text-red-600",children:(0,r.formatCurrency)(ao.total_amount,"EUR")})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Payé"}),(0,b.jsx)("p",{className:"text-lg font-bold text-green-600",children:(0,r.formatCurrency)(ao.paid_amount,"EUR")})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"En attente"}),(0,b.jsx)("p",{className:"text-lg font-bold text-yellow-600",children:(0,r.formatCurrency)(ao.pending_amount,"EUR")})]})]})]}):(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(E.TrendingDown,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{children:"Aucune charge enregistrée pour cette session."}),(0,b.jsxs)(q.Button,{variant:"outline",size:"sm",className:"mt-4",onClick:aI,children:[(0,b.jsx)(w.Plus,{className:"mr-2 h-4 w-4"}),"Ajouter une charge"]})]})})]}),(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:"Répartition par statut de paiement"})}),(0,b.jsx)(p.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:a.filter(a=>"pending"===a.payment_status).length}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"En attente"})]}),(0,b.jsxs)("div",{className:"text-center p-4 bg-brand-cyan-ghost rounded-lg",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-brand-cyan",children:a.filter(a=>"partial"===a.payment_status).length}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Partiel"})]}),(0,b.jsxs)("div",{className:"text-center p-4 bg-brand-blue-ghost rounded-lg",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-brand-blue",children:a.filter(a=>"paid"===a.payment_status).length}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Payé"})]}),(0,b.jsxs)("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-red-600",children:a.filter(a=>"overdue"===a.payment_status).length}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"En retard"})]})]})})]}),(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(p.CardTitle,{children:"Détails des inscriptions"}),(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)(q.Button,{variant:"outline",size:"sm",onClick:()=>{O(null),U(!0),S(!1)},children:[(0,b.jsx)(w.Plus,{className:"mr-2 h-4 w-4"}),"Nouveau devis"]}),(0,b.jsxs)(q.Button,{variant:"outline",size:"sm",onClick:()=>{O(null),S(!0),U(!1)},children:[(0,b.jsx)(w.Plus,{className:"mr-2 h-4 w-4"}),"Nouvelle facture"]})]})]})}),(0,b.jsx)(p.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:0===a.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucune inscription pour le moment"}):a.map(a=>{let c,d=a.students;if(!d)return null;let e=Number(a.total_amount||0),f=Number(a.paid_amount||0),g=e-f,h=a.student_id?(c=a.student_id,ag?.filter(a=>a.student_id===c)||[]):[],i=h.filter(a=>"invoice"===a.document_type),j=h.filter(a=>"quote"===a.document_type);return(0,b.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("p",{className:"font-medium",children:[d.first_name," ",d.last_name]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:d.student_number})]}),(0,b.jsxs)("div",{className:"text-right space-y-1",children:[(0,b.jsxs)("p",{className:"text-sm",children:["Total: ",(0,b.jsx)("span",{className:"font-medium",children:(0,r.formatCurrency)(e,"EUR")})]}),(0,b.jsxs)("p",{className:"text-sm",children:["Payé: ",(0,b.jsx)("span",{className:"font-medium text-blue-600",children:(0,r.formatCurrency)(f,"EUR")})]}),g>0&&(0,b.jsxs)("p",{className:"text-sm",children:["Reste: ",(0,b.jsx)("span",{className:"font-medium text-orange-600",children:(0,r.formatCurrency)(g,"EUR")})]}),(0,b.jsx)("span",{className:`text-xs px-2 py-1 rounded inline-block mt-2 ${"paid"===a.payment_status?"bg-brand-blue-ghost text-brand-blue":"partial"===a.payment_status?"bg-brand-cyan-ghost text-brand-cyan":"overdue"===a.payment_status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:"paid"===a.payment_status?"Payé":"partial"===a.payment_status?"Partiel":"overdue"===a.payment_status?"En retard":"En attente"})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2 pt-2 border-t",children:[(0,b.jsxs)(q.Button,{variant:"outline",size:"sm",onClick:()=>{O(a.id),av({...au,amount:a.total_amount?String(a.total_amount):""}),U(!0),S(!1)},children:[(0,b.jsx)(v.FileText,{className:"mr-2 h-3 w-3"}),"Créer devis"]}),(0,b.jsxs)(q.Button,{variant:"outline",size:"sm",onClick:()=>{O(a.id),av({...au,amount:a.total_amount?String(a.total_amount):""}),S(!0),U(!1)},children:[(0,b.jsx)(x.Receipt,{className:"mr-2 h-3 w-3"}),"Créer facture"]}),(0,b.jsxs)(q.Button,{variant:"outline",size:"sm",onClick:()=>{O(a.id),Q(!0)},children:[(0,b.jsx)(y.DollarSign,{className:"mr-2 h-3 w-3"}),"Saisir paiement"]})]}),(i.length>0||j.length>0)&&(0,b.jsxs)("div",{className:"pt-2 border-t space-y-2",children:[j.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Devis :"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:j.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:a.invoice_number}),(0,b.jsx)(q.Button,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>aw(a,"quote"),disabled:X===a.id,children:X===a.id?"...":(0,b.jsx)(u.Download,{className:"h-3 w-3"})})]},a.id))})]}),i.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Factures :"}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:i.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:a.invoice_number}),(0,b.jsx)(q.Button,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>aw(a,"invoice"),disabled:X===a.id,children:X===a.id?"...":(0,b.jsx)(u.Download,{className:"h-3 w-3"})}),(0,b.jsx)(t.default,{href:`/dashboard/payments/${a.id}`,children:(0,b.jsx)(q.Button,{variant:"ghost",size:"sm",className:"h-6 px-2",children:(0,b.jsx)(z.Eye,{className:"h-3 w-3"})})})]},a.id))})]})]})]},a.id)})})})]}),F.length>0&&(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:"Paiements récents"})}),(0,b.jsx)(p.CardContent,{children:(0,b.jsx)("div",{className:"space-y-3",children:F.slice(0,10).map(a=>{let c=a.students;return(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium",children:c?`${c.first_name} ${c.last_name}`:"Apprenant"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.paid_at&&new Date(a.paid_at).toLocaleDateString("fr-FR"),a.payment_method&&` • ${a.payment_method}`]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"font-bold text-lg text-brand-blue",children:(0,r.formatCurrency)(Number(a.amount||0),a.currency||"EUR")}),(0,b.jsx)("p",{className:`text-xs px-2 py-1 rounded inline-block mt-1 ${"completed"===a.status?"bg-brand-blue-ghost text-brand-blue":"pending"===a.status?"bg-brand-cyan-ghost text-brand-cyan":"bg-red-100 text-red-800"}`,children:"completed"===a.status?"Complété":"pending"===a.status?"En attente":"Échoué"})]})]},a.id)})})})]}),P&&N&&(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:"Enregistrer un paiement"})}),(0,b.jsx)(p.CardContent,{children:(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),az.mutate()},className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant *"}),(0,b.jsx)("input",{type:"number",required:!0,step:"0.01",min:"0.01",value:as.amount,onChange:a=>at({...as,amount:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Méthode de paiement *"}),(0,b.jsxs)("select",{required:!0,value:as.payment_method,onChange:a=>at({...as,payment_method:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,b.jsx)("option",{value:"cash",children:"Espèces"}),(0,b.jsx)("option",{value:"card",children:"Carte bancaire"}),(0,b.jsx)("option",{value:"bank_transfer",children:"Virement bancaire"}),(0,b.jsx)("option",{value:"sepa",children:"Virement SEPA"})]})]}),"cash"!==as.payment_method&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"ID de transaction"}),(0,b.jsx)("input",{type:"text",value:as.transaction_id,onChange:a=>at({...as,transaction_id:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"ID de la transaction"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,b.jsx)("textarea",{value:as.notes,onChange:a=>at({...as,notes:a.target.value}),rows:2,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Notes supplémentaires..."})]}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)(q.Button,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{Q(!1),O(null)},children:"Annuler"}),(0,b.jsx)(q.Button,{type:"submit",className:"flex-1",disabled:az.isPending,children:az.isPending?"Enregistrement...":"Enregistrer"})]})]})})]}),R&&(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:"Créer une facture"})}),(0,b.jsxs)(p.CardContent,{children:[!N&&(0,b.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,b.jsx)("p",{className:"text-sm text-yellow-800",children:"⚠️ Veuillez sélectionner un étudiant depuis la liste ci-dessus avant de créer la facture."})}),N&&(0,b.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,b.jsxs)("p",{className:"text-sm text-blue-800",children:["Étudiant sélectionné : ",a.find(a=>a.id===N)?.students?.first_name," ",a.find(a=>a.id===N)?.students?.last_name]})}),(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),ax.mutate()},className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant HT *"}),(0,b.jsx)("input",{type:"number",required:!0,step:"0.01",min:"0.01",value:au.amount,onChange:a=>av({...au,amount:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"TVA"}),(0,b.jsx)("input",{type:"number",step:"0.01",min:"0",value:au.tax_amount,onChange:a=>av({...au,tax_amount:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date d'émission *"}),(0,b.jsx)("input",{type:"date",required:!0,value:au.issue_date,onChange:a=>av({...au,issue_date:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date d'échéance *"}),(0,b.jsx)("input",{type:"date",required:!0,value:au.due_date,onChange:a=>av({...au,due_date:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,b.jsx)("textarea",{value:au.notes,onChange:a=>av({...au,notes:a.target.value}),rows:2,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Notes supplémentaires..."})]}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)(q.Button,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{S(!1),O(null)},children:"Annuler"}),(0,b.jsx)(q.Button,{type:"submit",className:"flex-1",disabled:ax.isPending||!N,children:ax.isPending?"Création...":"Créer la facture"})]})]})]})]}),T&&(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:"Créer un devis"})}),(0,b.jsxs)(p.CardContent,{children:[!N&&(0,b.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,b.jsx)("p",{className:"text-sm text-yellow-800",children:"⚠️ Veuillez sélectionner un étudiant depuis la liste ci-dessus avant de créer le devis."})}),N&&(0,b.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,b.jsxs)("p",{className:"text-sm text-blue-800",children:["Étudiant sélectionné : ",a.find(a=>a.id===N)?.students?.first_name," ",a.find(a=>a.id===N)?.students?.last_name]})}),(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),ay.mutate()},className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant HT *"}),(0,b.jsx)("input",{type:"number",required:!0,step:"0.01",min:"0.01",value:au.amount,onChange:a=>av({...au,amount:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"TVA"}),(0,b.jsx)("input",{type:"number",step:"0.01",min:"0",value:au.tax_amount,onChange:a=>av({...au,tax_amount:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date d'émission *"}),(0,b.jsx)("input",{type:"date",required:!0,value:au.issue_date,onChange:a=>av({...au,issue_date:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date d'échéance *"}),(0,b.jsx)("input",{type:"date",required:!0,value:au.due_date,onChange:a=>av({...au,due_date:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,b.jsx)("textarea",{value:au.notes,onChange:a=>av({...au,notes:a.target.value}),rows:2,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Notes supplémentaires..."})]}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)(q.Button,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{U(!1),O(null)},children:"Annuler"}),(0,b.jsx)(q.Button,{type:"submit",className:"flex-1",disabled:ay.isPending||!N,children:ay.isPending?"Création...":"Créer le devis"})]})]})]})]}),ab&&(0,b.jsxs)(p.Card,{children:[(0,b.jsx)(p.CardHeader,{children:(0,b.jsx)(p.CardTitle,{children:ad?"Modifier la charge":"Nouvelle charge"})}),(0,b.jsx)(p.CardContent,{children:(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),ad?aG.mutate():aF.mutate()},className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Description *"}),(0,b.jsx)("input",{type:"text",required:!0,value:aq.description,onChange:a=>ar({...aq,description:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ex: Location de salle pour la formation"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant *"}),(0,b.jsx)("input",{type:"number",required:!0,step:"0.01",min:"0.01",value:aq.amount,onChange:a=>ar({...aq,amount:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Devise"}),(0,b.jsxs)("select",{value:aq.currency,onChange:a=>ar({...aq,currency:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,b.jsx)("option",{value:"EUR",children:"EUR"}),(0,b.jsx)("option",{value:"USD",children:"USD"}),(0,b.jsx)("option",{value:"XOF",children:"XOF"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date *"}),(0,b.jsx)("input",{type:"date",required:!0,value:aq.charge_date,onChange:a=>ar({...aq,charge_date:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Catégorie"}),(0,b.jsxs)("select",{value:aq.category_id,onChange:a=>ar({...aq,category_id:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"Sélectionner une catégorie"}),ap?.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Méthode de paiement"}),(0,b.jsxs)("select",{value:aq.payment_method,onChange:a=>ar({...aq,payment_method:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,b.jsx)("option",{value:"",children:"Non spécifié"}),(0,b.jsx)("option",{value:"cash",children:"Espèces"}),(0,b.jsx)("option",{value:"bank_transfer",children:"Virement bancaire"}),(0,b.jsx)("option",{value:"card",children:"Carte bancaire"}),(0,b.jsx)("option",{value:"mobile_money",children:"Mobile Money"}),(0,b.jsx)("option",{value:"check",children:"Chèque"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Statut de paiement"}),(0,b.jsxs)("select",{value:aq.payment_status,onChange:a=>ar({...aq,payment_status:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,b.jsx)("option",{value:"pending",children:"En attente"}),(0,b.jsx)("option",{value:"paid",children:"Payé"}),(0,b.jsx)("option",{value:"cancelled",children:"Annulé"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Fournisseur"}),(0,b.jsx)("input",{type:"text",value:aq.vendor,onChange:a=>ar({...aq,vendor:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Nom du fournisseur/prestataire"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"N° facture fournisseur"}),(0,b.jsx)("input",{type:"text",value:aq.vendor_invoice_number,onChange:a=>ar({...aq,vendor_invoice_number:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"N° de facture"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date facture fournisseur"}),(0,b.jsx)("input",{type:"date",value:aq.vendor_invoice_date,onChange:a=>ar({...aq,vendor_invoice_date:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,b.jsx)("textarea",{value:aq.notes,onChange:a=>ar({...aq,notes:a.target.value}),rows:3,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Notes supplémentaires..."})]}),(0,b.jsxs)("div",{className:"flex space-x-2",children:[(0,b.jsx)(q.Button,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{ac(!1),ae(null)},children:"Annuler"}),(0,b.jsx)(q.Button,{type:"submit",className:"flex-1",disabled:aF.isPending||aG.isPending,children:aF.isPending||aG.isPending?"Enregistrement...":ad?"Mettre à jour":"Créer la charge"})]})]})})]})]})}a.s(["GestionFinances",()=>F])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_sessions_%5Bid%5D_sections_gestion-finances_tsx_b96e7105._.js.map