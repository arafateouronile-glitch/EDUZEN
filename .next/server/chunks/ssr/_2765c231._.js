module.exports=[495756,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],495756)},613749,a=>{"use strict";let b=(0,a.i(170106).default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);a.s(["ChevronLeft",()=>b],613749)},266275,a=>{"use strict";var b=a.i(269240);let c=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getCourses(a,b){try{let c=this.supabase.from("courses").select("*, instructor:users(id, full_name, email), formation:formations(*)").eq("organization_id",a);b?.instructorId&&(c=c.eq("instructor_id",b.instructorId)),b?.isPublished!==void 0&&(c=c.eq("is_published",b.isPublished)),b?.isFeatured&&(c=c.eq("is_featured",!0)),b?.difficulty&&(c=c.eq("difficulty_level",b.difficulty)),b?.search&&(c=c.or(`title.ilike.%${b.search}%,description.ilike.%${b.search}%`));let{data:d,error:e}=await c.order("created_at",{ascending:!1});if(e){if("PGRST116"===e.code||"42P01"===e.code||"PGRST301"===e.code||400===e.status||"400"===e.code||e.message?.includes("relation")||e.message?.includes("relationship")||e.message?.includes("does not exist")||e.message?.includes("schema cache"))return console.warn("Table courses does not exist yet or invalid query:",e.message),[];throw e}return d||[]}catch(a){if(a?.code==="PGRST116"||a?.code==="42P01"||a?.code==="PGRST301"||a?.status===400||a?.code==="400"||a?.message?.includes("relation")||a?.message?.includes("relationship")||a?.message?.includes("does not exist")||a?.message?.includes("schema cache"))return console.warn("Table courses does not exist yet or invalid query:",a?.message||String(a)),[];throw a}}async getCourseBySlug(a,b){try{let c=this.supabase.from("courses").select(`
          *,
          instructor:users(id, full_name, email),
          formation:formations(*),
          sections:course_sections(*),
          lessons:lessons(*)
        `).eq("slug",a).eq("organization_id",b),{data:d,error:e}=await c.maybeSingle();if(e){if("PGRST116"===e.code||"42P01"===e.code||"PGRST301"===e.code||400===e.status||"400"===e.code||e.message?.includes("relation")||e.message?.includes("relationship")||e.message?.includes("does not exist")||e.message?.includes("schema cache"))return console.warn("Table courses or relations do not exist yet or invalid query:",e.message),null;throw e}return d}catch(a){if(a?.code==="PGRST116"||a?.code==="42P01"||a?.code==="PGRST301"||a?.status===400||a?.code==="400"||a?.message?.includes("relation")||a?.message?.includes("relationship")||a?.message?.includes("does not exist")||a?.message?.includes("schema cache"))return console.warn("Table courses or relations do not exist yet or invalid query:",a?.message),null;throw a}}async createCourse(a){let{data:b,error:c}=await this.supabase.from("courses").insert(a).select().single();if(c)throw c;return b}async updateCourse(a,b){let{data:c,error:d}=await this.supabase.from("courses").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteCourse(a){let{error:b}=await this.supabase.from("courses").delete().eq("id",a);if(b)throw b}async getCourseSections(a){let{data:b,error:c}=await this.supabase.from("course_sections").select("*").eq("course_id",a).order("order_index",{ascending:!0});if(c)throw c;return b}async createSection(a){let{data:b,error:c}=await this.supabase.from("course_sections").insert(a).select().single();if(c)throw c;return b}async updateSection(a,b){let{data:c,error:d}=await this.supabase.from("course_sections").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteSection(a){let{error:b}=await this.supabase.from("lessons").update({section_id:null}).eq("section_id",a);if(b)throw b;let{error:c}=await this.supabase.from("course_sections").delete().eq("id",a);if(c)throw c}async getCourseLessons(a){let{data:b,error:c}=await this.supabase.from("lessons").select("*").eq("course_id",a).order("order_index",{ascending:!0});if(c)throw c;return b}async getLessonById(a){let{data:b,error:c}=await this.supabase.from("lessons").select("*, course:courses(*), section:course_sections(*)").eq("id",a).single();if(c)throw c;return b}async getLessonBySlug(a,b){let{data:c,error:d}=await this.supabase.from("lessons").select("*, course:courses(*), section:course_sections(*)").eq("slug",a).eq("course_id",b).single();if(d)throw d;return c}async createLesson(a){let{data:b,error:c}=await this.supabase.from("lessons").insert(a).select().single();if(c)throw c;return await this.updateCourseLessonCount(a.course_id),b}async updateLesson(a,b){let{data:c,error:d}=await this.supabase.from("lessons").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteLesson(a){let{data:b}=await this.supabase.from("lessons").select("course_id").eq("id",a).single(),{error:c}=await this.supabase.from("lessons").delete().eq("id",a);if(c)throw c;b&&await this.updateCourseLessonCount(b.course_id)}async updateCourseLessonCount(a){let{count:b}=await this.supabase.from("lessons").select("*",{count:"exact",head:!0}).eq("course_id",a);await this.supabase.from("courses").update({total_lessons:b||0}).eq("id",a)}async enrollInCourse(a,b){let{data:c,error:d}=await this.supabase.from("course_enrollments").insert({course_id:a,student_id:b,enrollment_status:"enrolled"}).select().single();if(d)throw d;return await this.incrementCourseStudentCount(a),c}async getStudentEnrollments(a){try{let{data:b,error:c}=await this.supabase.from("course_enrollments").select(`
          *,
          course:courses(*, instructor:users(id, full_name, email))
        `).eq("student_id",a).order("enrolled_at",{ascending:!1});if(c){if("PGRST116"===c.code||"42P01"===c.code||"PGRST301"===c.code||400===c.status||"400"===c.code||c.message?.includes("relation")||c.message?.includes("relationship")||c.message?.includes("does not exist")||c.message?.includes("schema cache"))return console.warn("Table course_enrollments does not exist yet or invalid query:",c.message),[];throw c}return b||[]}catch(a){if(a?.code==="PGRST116"||a?.code==="42P01"||a?.code==="PGRST301"||a?.status===400||a?.code==="400"||a?.message?.includes("relation")||a?.message?.includes("relationship")||a?.message?.includes("does not exist")||a?.message?.includes("schema cache"))return console.warn("Table course_enrollments does not exist yet or invalid query:",a?.message||String(a)),[];throw a}}async getCourseEnrollments(a){let{data:b,error:c}=await this.supabase.from("course_enrollments").select(`
        *,
        student:users(id, full_name, email)
      `).eq("course_id",a).order("enrolled_at",{ascending:!1});if(c)throw c;return b}async updateEnrollment(a,b){let{data:c,error:d}=await this.supabase.from("course_enrollments").update(b).eq("id",a).select().single();if(d)throw d;return c}async incrementCourseStudentCount(a){let{data:b}=await this.supabase.from("courses").select("total_students").eq("id",a).single();b&&await this.supabase.from("courses").update({total_students:(b.total_students||0)+1}).eq("id",a)}async getLessonProgress(a,b){let{data:c,error:d}=await this.supabase.from("lesson_progress").select("*").eq("lesson_id",a).eq("student_id",b).maybeSingle();if(d)throw d;return c}async updateLessonProgress(a,b,c){let d=await this.getLessonProgress(a,b);if(d){let{data:a,error:b}=await this.supabase.from("lesson_progress").update({...c,last_accessed_at:new Date().toISOString()}).eq("id",d.id).select().single();if(b)throw b;return a}{let{data:d,error:e}=await this.supabase.from("lesson_progress").insert({lesson_id:a,student_id:b,...c,started_at:new Date().toISOString(),last_accessed_at:new Date().toISOString()}).select().single();if(e)throw e;return d}}async markLessonAsCompleted(a,b){return this.updateLessonProgress(a,b,{is_completed:!0,completion_percentage:100,completed_at:new Date().toISOString()})}async getQuiz(a){let{data:b,error:c}=await this.supabase.from("quizzes").select("*, questions:quiz_questions(*)").eq("id",a).single();if(c)throw c;return b}async createQuiz(a){let{data:b,error:c}=await this.supabase.from("quizzes").insert(a).select().single();if(c)throw c;return b}async createQuizQuestion(a){let{data:b,error:c}=await this.supabase.from("quiz_questions").insert(a).select().single();if(c)throw c;return b}async submitQuizAttempt(a){let b=await this.getQuiz(a.quiz_id);if(!b||!b.questions)throw Error("Quiz non trouvé");let c=b.questions,d=a.answers,e=0,f=c.length;c.forEach(a=>{let b=d[a.id],c={question_type:a.question_type,options:a.options,correct_answer:a.correct_answer};this.isAnswerCorrect(c,b)&&e++});let g=f>0?e/f*100:0,h=g>=(b.passing_score||70),{data:i,error:j}=await this.supabase.from("quiz_attempts").insert({...a,score:g,total_questions:f,correct_answers:e,is_passed:h,completed_at:new Date().toISOString()}).select().single();if(j)throw j;return i}isAnswerCorrect(a,b){switch(a.question_type){case"multiple_choice":let c=a.options,d=c?.find(a=>a.is_correct);return b===d?.text;case"true_false":return b===a.correct_answer;case"short_answer":return String(b||"").toLowerCase().trim()===String(a.correct_answer||"").toLowerCase().trim();default:return!1}}async getStudentQuizAttempts(a,b){let{data:c,error:d}=await this.supabase.from("quiz_attempts").select("*").eq("quiz_id",a).eq("student_id",b).order("started_at",{ascending:!1});if(d)throw d;return c}async getCourseAssignments(a){let{data:b,error:c}=await this.supabase.from("assignments").select("*").eq("course_id",a).order("created_at",{ascending:!1});if(c)throw c;return b}async createAssignment(a){let{data:b,error:c}=await this.supabase.from("assignments").insert(a).select().single();if(c)throw c;return b}async submitAssignment(a){let{data:b,error:c}=await this.supabase.from("assignment_submissions").insert(a).select().single();if(c)throw c;return b}async gradeAssignment(a,b,c,d){let{data:e,error:f}=await this.supabase.from("assignment_submissions").update({score:b,feedback:c,graded_by:d,graded_at:new Date().toISOString(),status:"graded"}).eq("id",a).select().single();if(f)throw f;return e}async generateCertificate(a,b){let{data:c}=await this.supabase.from("course_enrollments").select("*").eq("course_id",a).eq("student_id",b).eq("enrollment_status","completed").maybeSingle();if(!c)throw Error("Le cours doit être complété pour générer un certificat");let{data:d}=await this.supabase.from("course_certificates").select("*").eq("course_id",a).eq("student_id",b).maybeSingle();if(d)return d;let{data:e,error:f}=await this.supabase.from("course_certificates").insert({course_id:a,student_id:b,enrollment_id:c.id,certificate_number:""}).select().single();if(f)throw f;return e}async getStudentCertificates(a){let{data:b,error:c}=await this.supabase.from("course_certificates").select("*, course:courses(*)").eq("student_id",a).order("issued_at",{ascending:!1});if(c)throw c;return b}async createReview(a){let{data:b,error:c}=await this.supabase.from("course_reviews").insert(a).select().single();if(c)throw c;return b}async getCourseReviews(a){let{data:b,error:c}=await this.supabase.from("course_reviews").select("*, student:users(id, full_name, email)").eq("course_id",a).order("created_at",{ascending:!1});if(c)throw c;return b}async getCourseRatingStats(a){let{data:b,error:c}=await this.supabase.from("course_reviews").select("rating").eq("course_id",a);if(c)throw c;let d={total:b.length,average:0,distribution:{1:0,2:0,3:0,4:0,5:0}};if(b.length>0){let a=b.map(a=>a.rating).filter(Boolean);d.average=a.reduce((a,b)=>a+b,0)/a.length,a.forEach(a=>{d.distribution[a]++})}return d}};a.s(["elearningService",0,c])}];

//# sourceMappingURL=_2765c231._.js.map