module.exports=[915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},641710,a=>{"use strict";let b=(0,a.i(170106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],641710)},219897,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);a.i(460355);var e=a.i(346271);let f=c.forwardRef(({className:a,variant:c="default",hoverable:f=!1,glow:g=!1,glowColor:h="rgba(51, 90, 207, 0.3)",...i},j)=>(0,b.jsxs)(e.motion.div,{ref:j,className:(0,d.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===c,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===c,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===c,"cursor-pointer":f,"hover:shadow-2xl hover:scale-[1.02]":f,"hover:bg-white/90 dark:hover:bg-gray-900/90":f},a),whileHover:f?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...i,children:[g&&(0,b.jsx)(e.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${h} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,b.jsx)("div",{className:"relative z-10",children:i.children})]}));f.displayName="GlassCard",a.s(["GlassCard",()=>f])},692759,a=>{"use strict";let b=(0,a.i(170106).default)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);a.s(["Send",()=>b],692759)},335151,a=>{"use strict";var b=a.i(188950),c=a.i(212955);function d(a){(0,c.default)(1,arguments);var d=(0,b.default)(a),e=d.getMonth();return d.setFullYear(d.getFullYear(),e+1,0),d.setHours(23,59,59,999),d}a.s(["default",()=>d])},603420,a=>{"use strict";var b=a.i(568425),c=a.i(188950),d=a.i(212955);function e(a,b){(0,d.default)(2,arguments);var e=(0,c.default)(a),f=(0,c.default)(b),g=e.getTime()-f.getTime();return g<0?-1:g>0?1:g}var f=a.i(335151),g={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(a){return a<0?Math.ceil(a):Math.floor(a)}},h=a.i(120866);function i(a,b){if(null==a)throw TypeError("assign requires that input parameter not be null or undefined");for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);return a}var j=a.i(451579);function k(a,k){return(0,d.default)(1,arguments),function(a,k,l){(0,d.default)(2,arguments);var m,n,o,p,q,r=(0,b.getDefaultOptions)(),s=null!=(m=null!=(n=null==l?void 0:l.locale)?n:r.locale)?m:h.default;if(!s.formatDistance)throw RangeError("locale must contain formatDistance property");var t=e(a,k);if(isNaN(t))throw RangeError("Invalid time value");var u=i(i({},l),{addSuffix:!!(null==l?void 0:l.addSuffix),comparison:t});t>0?(o=(0,c.default)(k),p=(0,c.default)(a)):(o=(0,c.default)(a),p=(0,c.default)(k));var v=function(a,b,e){(0,d.default)(2,arguments);var f,h=function(a,b){return(0,d.default)(2,arguments),(0,c.default)(a).getTime()-(0,c.default)(b).getTime()}(a,b)/1e3;return((f=null==e?void 0:e.roundingMethod)?g[f]:g.trunc)(h)}(p,o),w=Math.round((v-((0,j.default)(p)-(0,j.default)(o))/1e3)/60);if(w<2)if(null!=l&&l.includeSeconds)if(v<5)return s.formatDistance("lessThanXSeconds",5,u);else if(v<10)return s.formatDistance("lessThanXSeconds",10,u);else if(v<20)return s.formatDistance("lessThanXSeconds",20,u);else if(v<40)return s.formatDistance("halfAMinute",0,u);else if(v<60)return s.formatDistance("lessThanXMinutes",1,u);else return s.formatDistance("xMinutes",1,u);else if(0===w)return s.formatDistance("lessThanXMinutes",1,u);else return s.formatDistance("xMinutes",w,u);if(w<45)return s.formatDistance("xMinutes",w,u);if(w<90)return s.formatDistance("aboutXHours",1,u);if(w<1440){var x=Math.round(w/60);return s.formatDistance("aboutXHours",x,u)}if(w<2520)return s.formatDistance("xDays",1,u);else if(w<43200){var y=Math.round(w/1440);return s.formatDistance("xDays",y,u)}else if(w<86400)return q=Math.round(w/43200),s.formatDistance("aboutXMonths",q,u);if((q=function(a,b){(0,d.default)(2,arguments);var g,h=(0,c.default)(a),i=(0,c.default)(b),j=e(h,i),k=Math.abs(function(a,b){(0,d.default)(2,arguments);var e=(0,c.default)(a),f=(0,c.default)(b);return 12*(e.getFullYear()-f.getFullYear())+(e.getMonth()-f.getMonth())}(h,i));if(k<1)g=0;else{1===h.getMonth()&&h.getDate()>27&&h.setDate(30),h.setMonth(h.getMonth()-j*k);var l=e(h,i)===-j;(function(a){(0,d.default)(1,arguments);var b=(0,c.default)(a);return(function(a){(0,d.default)(1,arguments);var b=(0,c.default)(a);return b.setHours(23,59,59,999),b})(b).getTime()===(0,f.default)(b).getTime()})((0,c.default)(a))&&1===k&&1===e(a,i)&&(l=!1),g=j*(k-Number(l))}return 0===g?0:g}(p,o))<12){var z=Math.round(w/43200);return s.formatDistance("xMonths",z,u)}var A=q%12,B=Math.floor(q/12);return A<3?s.formatDistance("aboutXYears",B,u):A<9?s.formatDistance("overXYears",B,u):s.formatDistance("almostXYears",B+1,u)}(a,Date.now(),k)}a.s(["formatDistanceToNow",()=>k],603420)},718382,a=>{"use strict";var b=a.i(187924),c=a.i(433217),d=a.i(323625),e=a.i(727163),f=a.i(219897),g=a.i(340695),h=a.i(205522);a.i(460355);var i=a.i(346271),j=a.i(563588),k=a.i(587532),l=a.i(692759),m=a.i(915618),n=a.i(546842),o=a.i(641710),p=a.i(572131),q=a.i(603420),r=a.i(433363),s=a.i(50944),t=a.i(325383);function u(){let{student:a,studentId:u,organizationId:v}=(0,d.useLearnerContext)(),w=(0,s.useRouter)(),[x,y]=(0,p.useState)(""),z=(0,p.useMemo)(()=>(0,e.createLearnerClient)(u),[u]),{data:A,isLoading:B}=(0,c.useQuery)({queryKey:["learner-conversations",u,v],queryFn:async()=>{if(!u||!v)return[];let{data:a,error:b}=await z.from("conversation_participants").select("conversation_id").eq("student_id",u);if(b)throw t.logger.warn("Error fetching conversation participants",{studentId:(0,t.maskId)(u),error:(0,t.sanitizeError)(b)}),b;if(!a||0===a.length)return[];let c=a.map(a=>a.conversation_id),{data:d,error:e}=await z.from("conversations").select("*").eq("organization_id",v).eq("is_archived",!1).in("id",c).order("last_message_at",{ascending:!1,nullsFirst:!1});if(e)throw t.logger.error("Error fetching conversations",e,{studentId:(0,t.maskId)(u),organizationId:(0,t.maskId)(v),error:(0,t.sanitizeError)(e)}),e;return d&&0!==d.length?await Promise.all(d.map(async a=>{let{data:b}=await z.from("conversation_participants").select("*").eq("conversation_id",a.id),c=await Promise.all((b||[]).map(async a=>{let b=null,c=null;if(a.user_id)try{let{data:c,error:d}=await z.rpc("get_user_name",{p_user_id:a.user_id});if(!d&&c)b={id:a.user_id,full_name:c.full_name,email:c.email,avatar_url:null};else{let{data:c}=await z.from("users").select("id, full_name, email, avatar_url").eq("id",a.user_id).maybeSingle();b=c}}catch(d){let{data:c}=await z.from("users").select("id, full_name, email, avatar_url").eq("id",a.user_id).maybeSingle();b=c}if(a.student_id){let{data:b}=await z.from("students").select("id, first_name, last_name, email, student_number").eq("id",a.student_id).maybeSingle();c=b}return{...a,user:b,student:c}})),{data:d}=await z.from("messages").select("*").eq("conversation_id",a.id).eq("is_deleted",!1).order("created_at",{ascending:!1}).limit(1),e=null;if(d&&d.length>0){let a=d[0],b=null,c=null;if(a.sender_id){let{data:c}=await z.from("users").select("id, full_name, email").eq("id",a.sender_id).maybeSingle();b=c}if(a.student_sender_id){let{data:b}=await z.from("students").select("id, first_name, last_name, email, student_number").eq("id",a.student_sender_id).maybeSingle();c=b}e={...a,sender:b,student_sender:c}}return{...a,participants:c,last_message:e}})):[]},enabled:!!u&&!!v,refetchInterval:1e4}),C=a=>{if("group"===a.conversation_type&&a.name)return a.name;if(a.last_message){if(a.last_message.sender){let b=a.last_message.sender.full_name||a.last_message.sender.email;if(b)return b}if(a.last_message.student_sender&&a.last_message.student_sender.id!==u){let b=`${a.last_message.student_sender.first_name||""} ${a.last_message.student_sender.last_name||""}`.trim();return b||a.last_message.student_sender.email||`Candidat ${a.last_message.student_sender.student_number||""}`}}if(a.participants&&a.participants.length>0){let b=a.participants.find(a=>!!a.user_id&&!a.student_id||!!a.user_id&&!!a.student_id&&a.student_id!==u);if(b?.user){let a=b.user.full_name||b.user.email;if(a)return a}let c=a.participants.find(a=>a.student_id&&a.student_id!==u);if(c?.student){let a=`${c.student.first_name||""} ${c.student.last_name||""}`.trim();return a||c.student.email||`Candidat ${c.student.student_number||""}`}}return"Conversation"},D=A?.filter(a=>C(a).toLowerCase().includes(x.toLowerCase()))||[],E={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};return(0,b.jsxs)(i.motion.div,{className:"space-y-6 pb-24 lg:pb-8",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",children:[(0,b.jsx)(i.motion.div,{variants:E,children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-indigo-100 rounded-xl",children:(0,b.jsx)(j.MessageSquare,{className:"h-8 w-8 text-indigo-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Messages"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Communiquez avec vos formateurs et le support"})]})]}),(0,b.jsxs)(g.Button,{children:[(0,b.jsx)(m.Plus,{className:"h-4 w-4 mr-2"}),"Nouveau message"]})]})}),(0,b.jsx)(i.motion.div,{variants:E,children:(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(k.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,b.jsx)(h.Input,{type:"search",placeholder:"Rechercher une conversation...",value:x,onChange:a=>y(a.target.value),className:"pl-10"})]})}),(0,b.jsx)(i.motion.div,{variants:E,children:B?(0,b.jsx)("div",{className:"space-y-4",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:"h-20 bg-gray-100 rounded-2xl animate-pulse"},a))}):D.length>0?(0,b.jsx)("div",{className:"space-y-3",children:D.map(a=>{let c=C(a),d=a.last_message,e=d?.created_at,g=null;return d?.sender?g=d.sender.full_name||d.sender.email:d?.student_sender&&(g=`${d.student_sender.first_name||""} ${d.student_sender.last_name||""}`.trim()||d.student_sender.email),(0,b.jsx)(f.GlassCard,{className:"p-4 cursor-pointer hover:shadow-lg transition-all duration-300",onClick:()=>w.push(`/learner/messages/${a.id}`),children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"relative",children:(0,b.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center text-white font-semibold bg-gradient-to-br from-brand-blue to-indigo-600",children:(0,b.jsx)(n.User,{className:"h-6 w-6"})})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 truncate",children:c}),e&&(0,b.jsxs)("span",{className:"text-xs text-gray-500 flex items-center gap-1",children:[(0,b.jsx)(o.Clock,{className:"h-3 w-3"}),(0,q.formatDistanceToNow)(new Date(e),{addSuffix:!0,locale:r.fr})]})]}),d&&(0,b.jsx)("div",{className:"flex items-center gap-2 mt-1",children:(0,b.jsxs)("p",{className:"text-sm truncate text-gray-500",children:["group"===a.conversation_type&&g?(0,b.jsxs)("span",{className:"font-medium",children:[g,": "]}):null,d.content]})})]})]})},a.id)})}):(0,b.jsxs)(f.GlassCard,{className:"p-12 text-center",children:[(0,b.jsx)(j.MessageSquare,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Aucune conversation"}),(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"Commencez une nouvelle conversation avec un formateur ou le support"}),(0,b.jsxs)(g.Button,{children:[(0,b.jsx)(m.Plus,{className:"h-4 w-4 mr-2"}),"Nouveau message"]})]})}),(0,b.jsx)(i.motion.div,{variants:E,children:(0,b.jsxs)(f.GlassCard,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Actions rapides"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)(g.Button,{variant:"outline",className:"justify-start",children:[(0,b.jsx)(j.MessageSquare,{className:"h-4 w-4 mr-2"}),"Contacter le support"]}),(0,b.jsxs)(g.Button,{variant:"outline",className:"justify-start",children:[(0,b.jsx)(n.User,{className:"h-4 w-4 mr-2"}),"Contacter un formateur"]}),(0,b.jsxs)(g.Button,{variant:"outline",className:"justify-start",children:[(0,b.jsx)(l.Send,{className:"h-4 w-4 mr-2"}),"Signaler un problÃ¨me"]})]})]})})]})}a.s(["default",()=>u])}];

//# sourceMappingURL=_2f809d45._.js.map