module.exports=[400210,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],400210)},177156,a=>{"use strict";let b=(0,a.i(170106).default)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);a.s(["Eye",()=>b],177156)},821374,a=>{"use strict";let b=(0,a.i(170106).default)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);a.s(["Star",()=>b],821374)},976472,a=>{"use strict";let b=(0,a.i(170106).default)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);a.s(["Heart",()=>b],976472)},989451,a=>{"use strict";var b=a.i(269240);let c=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getCategories(a,b=!0){let c=this.supabase.from("documentation_categories").select("*").order("order_index",{ascending:!0});a?c=c.or(`organization_id.eq.${a},is_public.eq.true`):b&&(c=c.eq("is_public",!0));let{data:d,error:e}=await c;if(e)throw e;return d}async getCategoryBySlug(a,b){let c=this.supabase.from("documentation_categories").select("*").eq("slug",a).single();c=b?c.or(`organization_id.eq.${b},is_public.eq.true`):c.eq("is_public",!0);let{data:d,error:e}=await c;if(e)throw e;return d}async createCategory(a){let{data:b,error:c}=await this.supabase.from("documentation_categories").insert(a).select().single();if(c)throw c;return b}async updateCategory(a,b){let{data:c,error:d}=await this.supabase.from("documentation_categories").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteCategory(a){let{error:b}=await this.supabase.from("documentation_categories").delete().eq("id",a);if(b)throw b}async getArticlesByCategory(a,b="published"){let{data:c,error:d}=await this.supabase.from("documentation_articles").select("*, author:users(id, full_name, email)").eq("category_id",a).eq("status",b).order("order_index",{ascending:!0}).order("published_at",{ascending:!1});if(d)throw d;return c}async getArticleBySlug(a,b){let{data:c,error:d}=await this.supabase.from("documentation_articles").select(`
        *,
        category:documentation_categories(*),
        sections:documentation_sections(*),
        author:users(id, full_name, email)
      `).eq("slug",a).eq("category.slug",b).eq("status","published").single();if(d)throw d;return c&&await this.supabase.rpc("increment_article_view_count",{article_uuid:c.id}),c}async searchArticles(a,b){let c=this.supabase.from("documentation_articles").select("*, category:documentation_categories(*), author:users(id, full_name)").eq("status","published").or(`title.ilike.%${a}%,content.ilike.%${a}%,excerpt.ilike.%${a}%`);c=b?c.or(`organization_id.eq.${b},category.is_public.eq.true`):c.eq("category.is_public",!0);let{data:d,error:e}=await c.order("view_count",{ascending:!1}).limit(50);if(e)throw e;return d}async getPopularArticles(a=10,b){let c=this.supabase.from("documentation_articles").select("*, category:documentation_categories(*), author:users(id, full_name)").eq("status","published").order("view_count",{ascending:!1}).limit(a);c=b?c.or(`organization_id.eq.${b},category.is_public.eq.true`):c.eq("category.is_public",!0);let{data:d,error:e}=await c;if(e)throw e;return d}async getRecentArticles(a=10,b){let c=this.supabase.from("documentation_articles").select("*, category:documentation_categories(*), author:users(id, full_name)").eq("status","published").order("published_at",{ascending:!1}).limit(a);c=b?c.or(`organization_id.eq.${b},category.is_public.eq.true`):c.eq("category.is_public",!0);let{data:d,error:e}=await c;if(e)throw e;return d}async getFeaturedArticles(a=5,b){let c=this.supabase.from("documentation_articles").select("*, category:documentation_categories(*), author:users(id, full_name)").eq("status","published").eq("is_featured",!0).order("published_at",{ascending:!1}).limit(a);c=b?c.or(`organization_id.eq.${b},category.is_public.eq.true`):c.eq("category.is_public",!0);let{data:d,error:e}=await c;if(e)throw e;return d}async createArticle(a){let{data:b,error:c}=await this.supabase.from("documentation_articles").insert(a).select().single();if(c)throw c;return b}async updateArticle(a,b){let{data:c,error:d}=await this.supabase.from("documentation_articles").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteArticle(a){let{error:b}=await this.supabase.from("documentation_articles").delete().eq("id",a);if(b)throw b}async getArticleSections(a){let{data:b,error:c}=await this.supabase.from("documentation_sections").select("*").eq("article_id",a).order("order_index",{ascending:!0});if(c)throw c;return b}async createSection(a){let{data:b,error:c}=await this.supabase.from("documentation_sections").insert(a).select().single();if(c)throw c;return b}async updateSection(a,b){let{data:c,error:d}=await this.supabase.from("documentation_sections").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteSection(a){let{error:b}=await this.supabase.from("documentation_sections").delete().eq("id",a);if(b)throw b}async getUserFavorites(a){let{data:b,error:c}=await this.supabase.from("documentation_favorites").select("*, article:documentation_articles(*, category:documentation_categories(*))").eq("user_id",a).order("created_at",{ascending:!1});if(c)throw c;return b}async addFavorite(a,b){let{data:c,error:d}=await this.supabase.from("documentation_favorites").insert({user_id:a,article_id:b}).select().single();if(d)throw d;return c}async removeFavorite(a,b){let{error:c}=await this.supabase.from("documentation_favorites").delete().eq("user_id",a).eq("article_id",b);if(c)throw c}async isFavorite(a,b){let{data:c,error:d}=await this.supabase.from("documentation_favorites").select("id").eq("user_id",a).eq("article_id",b).maybeSingle();if(d)throw d;return!!c}async getUserNotes(a,b){let{data:c,error:d}=await this.supabase.from("documentation_notes").select("*").eq("user_id",a).eq("article_id",b).order("created_at",{ascending:!1}).maybeSingle();if(d)throw d;return c}async upsertNote(a,b,c){let d=await this.getUserNotes(a,b);if(d){let{data:a,error:b}=await this.supabase.from("documentation_notes").update({content:c}).eq("id",d.id).select().single();if(b)throw b;return a}{let{data:d,error:e}=await this.supabase.from("documentation_notes").insert({user_id:a,article_id:b,content:c}).select().single();if(e)throw e;return d}}async deleteNote(a,b){let{error:c}=await this.supabase.from("documentation_notes").delete().eq("user_id",a).eq("article_id",b);if(c)throw c}async createFeedback(a){let{data:b,error:c}=await this.supabase.from("documentation_feedback").insert(a).select().single();if(c)throw c;return b}async getArticleFeedback(a){let{data:b,error:c}=await this.supabase.from("documentation_feedback").select("*, user:users(id, full_name)").eq("article_id",a).order("created_at",{ascending:!1});if(c)throw c;return b}async getArticleFeedbackStats(a){let{data:b,error:c}=await this.supabase.from("documentation_feedback").select("rating, is_helpful").eq("article_id",a);if(c)throw c;let d={total:b.length,averageRating:0,helpfulCount:0,notHelpfulCount:0,ratings:{1:0,2:0,3:0,4:0,5:0}};if(b.length>0){let a=b.filter(a=>a.rating).map(a=>a.rating);a.length>0&&(d.averageRating=a.reduce((a,b)=>a+b,0)/a.length),b.forEach(a=>{a.rating&&d.ratings[a.rating]++,!0===a.is_helpful&&d.helpfulCount++,!1===a.is_helpful&&d.notHelpfulCount++})}return d}async recordSearch(a,b,c){let{error:d}=await this.supabase.from("documentation_search_history").insert({user_id:a,query:b,results_count:c});if(d)throw d}async getSearchHistory(a,b=10){let{data:c,error:d}=await this.supabase.from("documentation_search_history").select("*").eq("user_id",a).order("created_at",{ascending:!1}).limit(b);if(d)throw d;return c}async clearSearchHistory(a){let{error:b}=await this.supabase.from("documentation_search_history").delete().eq("user_id",a);if(b)throw b}};a.s(["documentationService",0,c])},590545,a=>{"use strict";let b=(0,a.i(170106).default)("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);a.s(["ThumbsUp",()=>b],590545)},248518,a=>{"use strict";let b=(0,a.i(170106).default)("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);a.s(["ThumbsDown",()=>b],248518)},619926,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(433217),f=a.i(370025),g=a.i(913216),h=a.i(989451),i=a.i(703130),j=a.i(340695),k=a.i(546893),l=a.i(917171),m=a.i(400210),n=a.i(821374),o=a.i(976472),p=a.i(590545),q=a.i(248518),r=a.i(177156),s=a.i(238246),t=a.i(762180),u=a.i(800006);function v(){let a=(0,d.useParams)(),v=a.categorySlug,w=a.articleSlug,{user:x}=(0,g.useAuth)(),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(null),{data:E}=(0,e.useQuery)({queryKey:["documentation-article",v,w],queryFn:async()=>await h.documentationService.getArticleBySlug(w,v),enabled:!!v&&!!w}),{data:F}=(0,e.useQuery)({queryKey:["documentation-favorite",x?.id,E?.id],queryFn:()=>h.documentationService.isFavorite(x?.id||"",E?.id||""),enabled:!!x?.id&&!!E?.id}),{data:G}=(0,e.useQuery)({queryKey:["documentation-feedback-stats",E?.id],queryFn:()=>h.documentationService.getArticleFeedbackStats(E?.id||""),enabled:!!E?.id}),H=(0,f.useMutation)({mutationFn:async()=>{x?.id&&E?.id&&(F?await h.documentationService.removeFavorite(x.id,E.id):await h.documentationService.addFavorite(x.id,E.id))},onSuccess:()=>{window.location.reload()}}),I=(0,f.useMutation)({mutationFn:async()=>{if(!x?.id||!E?.id)return;let a=await fetch("/api/documentation/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article_id:E.id,rating:y,comment:A,is_helpful:C})});if(!a.ok)throw Error("Erreur lors de l'envoi du feedback");return a.json()},onSuccess:()=>{z(null),B(""),D(null),alert("Merci pour votre feedback !")}});return(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-4xl",children:[(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)(s.default,{href:`/dashboard/documentation/category/${v}`,children:(0,b.jsxs)(j.Button,{variant:"ghost",size:"sm",className:"mb-4",children:[(0,b.jsx)(m.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour à la catégorie"]})})}),E&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(i.Card,{className:"mb-6",children:(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(i.CardTitle,{className:"text-3xl mb-2",children:E.title}),E.excerpt&&(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:E.excerpt}),(0,b.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(r.Eye,{className:"h-4 w-4"}),(0,b.jsxs)("span",{children:[E.view_count," vues"]})]}),E.author&&(0,b.jsxs)("span",{children:["Par ",E.author.full_name||E.author.email]}),E.published_at&&(0,b.jsxs)("span",{children:["Publié le ",new Date(E.published_at).toLocaleDateString("fr-FR")]})]})]}),(0,b.jsxs)(j.Button,{variant:"outline",size:"sm",onClick:()=>H.mutate(),disabled:H.isPending,children:[(0,b.jsx)(o.Heart,{className:`h-4 w-4 mr-2 ${F?"fill-red-500 text-red-500":""}`}),F?"Retirer des favoris":"Ajouter aux favoris"]})]})})}),(0,b.jsx)(i.Card,{className:"mb-6",children:(0,b.jsx)(i.CardContent,{className:"pt-6",children:(0,b.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,b.jsx)(t.default,{children:E.content})})})}),E.sections&&E.sections.length>0&&(0,b.jsx)("div",{className:"space-y-6 mb-6",children:E.sections.map(a=>(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:a.title})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,b.jsx)(t.default,{children:a.content})})})]},a.id))}),(0,b.jsxs)(i.Card,{className:"mb-6",children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsx)(i.CardTitle,{children:"Votre avis"})}),(0,b.jsxs)(i.CardContent,{children:[(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),(y||A||null!==C)&&I.mutate()},className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Note (optionnel)"}),(0,b.jsxs)(u.Select,{value:y?.toString()||"",onValueChange:a=>z(parseInt(a)),children:[(0,b.jsx)(u.SelectTrigger,{children:(0,b.jsx)(u.SelectValue,{placeholder:"Sélectionner une note"})}),(0,b.jsx)(u.SelectContent,{children:[1,2,3,4,5].map(a=>(0,b.jsxs)(u.SelectItem,{value:a.toString(),children:[a," étoile",a>1?"s":""]},a))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Commentaire (optionnel)"}),(0,b.jsx)(k.Textarea,{value:A,onChange:a=>B(a.target.value),placeholder:"Partagez votre avis...",rows:4})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{children:"Cet article vous a-t-il été utile ?"}),(0,b.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,b.jsxs)(j.Button,{type:"button",variant:!0===C?"default":"outline",onClick:()=>D(!0),children:[(0,b.jsx)(p.ThumbsUp,{className:"h-4 w-4 mr-2"}),"Oui"]}),(0,b.jsxs)(j.Button,{type:"button",variant:!1===C?"default":"outline",onClick:()=>D(!1),children:[(0,b.jsx)(q.ThumbsDown,{className:"h-4 w-4 mr-2"}),"Non"]})]})]}),(0,b.jsx)(j.Button,{type:"submit",disabled:I.isPending,children:"Envoyer le feedback"})]}),G&&G.total>0&&(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t",children:[(0,b.jsx)("h3",{className:"font-semibold mb-2",children:"Avis des utilisateurs"}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,b.jsx)(n.Star,{className:"h-5 w-5 text-yellow-500 fill-yellow-500"}),(0,b.jsxs)("span",{className:"font-semibold",children:[G.averageRating.toFixed(1)," / 5"]}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["(",G.total," avis)"]})]}),(0,b.jsxs)("div",{className:"text-sm text-muted-foreground",children:[G.helpfulCount," personne",G.helpfulCount>1?"s":""," ","ont trouvé cet article utile"]})]})]})]})]})]})}a.s(["default",()=>v])}];

//# sourceMappingURL=_ffc53a3d._.js.map