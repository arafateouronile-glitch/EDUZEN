module.exports=[915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},992258,a=>{"use strict";let b=(0,a.i(170106).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);a.s(["Mail",()=>b],992258)},280281,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);let e=c.forwardRef(({checked:a,onCheckedChange:c,disabled:e,className:f,...g},h)=>(0,b.jsx)("button",{type:"button",role:"switch","aria-checked":a,ref:h,disabled:e,onClick:()=>c?.(!a),className:(0,d.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",a?"bg-brand-blue":"bg-input",f),...g,children:(0,b.jsx)("span",{className:(0,d.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",a?"translate-x-5":"translate-x-0")})}));e.displayName="Switch",a.s(["Switch",0,e])},683245,a=>{"use strict";let b=(0,a.i(170106).default)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);a.s(["Edit",()=>b],683245)},887682,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);a.i(460355);var e=a.i(346271),f=a.i(262036),g=a.i(405784),h=a.i(290821);c.forwardRef(({className:a,label:i,error:j,helperText:k,variant:l="default",leftIcon:m,id:n,options:o,placeholder:p,value:q,...r},s)=>{let[t,u]=c.useState(!1),[v,w]=c.useState(!1),x=n||`select-${Math.random().toString(36).substr(2,9)}`,y=(0,d.cn)("flex w-full rounded-lg font-medium transition-all duration-300","appearance-none cursor-pointer","focus:outline-none focus:ring-2 focus:ring-primary/20","disabled:cursor-not-allowed disabled:opacity-50",{"border-2 border-input bg-background px-4 py-3 pr-11":"default"===l,"focus:border-primary focus:bg-white":"default"===l&&!j,"border-destructive focus:border-destructive focus:ring-destructive/20":j,"border-2 border-input bg-transparent px-4 py-3 pr-11":"outlined"===l,"focus:border-primary focus:shadow-md focus:shadow-primary/10":"outlined"===l&&!j,"border-0 border-b-2 border-input bg-muted/50 px-4 py-3 pr-11 rounded-b-none":"filled"===l,"focus:bg-muted focus:border-primary":"filled"===l&&!j,"focus:border-destructive bg-destructive/5":"filled"===l&&j},m&&"pl-11",a);return(0,b.jsxs)("div",{className:"w-full space-y-1.5",children:[i&&(0,b.jsxs)(e.motion.label,{htmlFor:x,initial:!1,animate:{color:j?"#EF4444":t?"rgb(37, 99, 235)":"rgb(107, 114, 128)"},className:(0,d.cn)("block text-sm font-medium transition-colors duration-200",j&&"text-destructive"),children:[i,r.required&&(0,b.jsx)("span",{className:"text-destructive ml-1",children:"*"})]}),(0,b.jsxs)("div",{className:"relative",children:[m&&(0,b.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none z-10",children:m}),(0,b.jsxs)(e.motion.select,{ref:s,id:x,value:q,...r,onFocus:a=>{u(!0),r.onFocus?.(a)},onBlur:a=>{u(!1),w(!1),r.onBlur?.(a)},onMouseDown:()=>w(!v),className:y,animate:{scale:t?1.01:1,borderColor:j?"#EF4444":t?"rgb(37, 99, 235)":"rgb(226, 232, 240)"},transition:{duration:.2},children:[p&&(0,b.jsx)("option",{value:"",disabled:!0,children:p}),(o||[]).map(a=>(0,b.jsx)("option",{value:a.value,disabled:a.disabled,children:a.label},a.value))]}),(0,b.jsx)(e.motion.div,{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground",animate:{rotate:180*!!v},transition:{duration:.2},children:(0,b.jsx)(g.ChevronDown,{className:"h-5 w-5"})}),j&&(0,b.jsx)(e.motion.div,{className:"absolute right-11 top-1/2 -translate-y-1/2 pointer-events-none",initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:(0,b.jsx)(h.AlertCircle,{className:"h-5 w-5 text-destructive"})})]}),(0,b.jsx)(f.AnimatePresence,{mode:"wait",children:(j||k)&&(0,b.jsx)(e.motion.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.2},className:(0,d.cn)("text-xs transition-colors duration-200",j?"text-destructive":"text-muted-foreground"),children:j||k})})]})}).displayName="SelectNative";let i=c.createContext({}),j=c.forwardRef(({value:a,onValueChange:d,children:e},f)=>{let[g,h]=c.useState(!1);return(0,b.jsx)(i.Provider,{value:{value:a,onValueChange:d,open:g,setOpen:h},children:(0,b.jsx)("div",{className:"relative",ref:f,children:e})})});j.displayName="SelectRoot";let k=c.forwardRef(({children:a,className:e,...f},h)=>{let{open:j,setOpen:k}=c.useContext(i);return(0,b.jsxs)("button",{ref:h,type:"button",className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),onClick:()=>k?.(!j),...f,children:[a,(0,b.jsx)(g.ChevronDown,{className:(0,d.cn)("h-4 w-4 opacity-50 transition-transform",j&&"rotate-180")})]})});k.displayName="SelectTrigger";let l=c.forwardRef(({placeholder:a},d)=>{let{value:e}=c.useContext(i);return(0,b.jsx)("span",{ref:d,children:e||a})});l.displayName="SelectValue";let m=c.forwardRef(({children:a},d)=>{let e=c.useContext(i);return e?.open&&a?(0,b.jsx)("div",{ref:d,className:"absolute top-full left-0 z-50 mt-1 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md",children:(0,b.jsx)("div",{className:"p-1",children:a})}):null});m.displayName="SelectContent";let n=c.forwardRef(({value:a,children:e,className:f,...g},h)=>{let{value:j,onValueChange:k,setOpen:l}=c.useContext(i),m=j===a;return(0,b.jsx)("div",{ref:h,role:"option","aria-selected":m,className:(0,d.cn)("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 px-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",m&&"bg-accent text-accent-foreground",f),onClick:()=>{k?.(a),l?.(!1)},...g,children:e})});n.displayName="SelectItem",a.s(["Select",0,j,"SelectContent",0,m,"SelectItem",0,n,"SelectRoot",0,j,"SelectTrigger",0,k,"SelectValue",0,l])},792843,a=>{"use strict";var b=a.i(269240);let c=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getAll(a){let{data:b,error:c}=await this.supabase.from("email_templates").select("*").eq("organization_id",a).eq("is_active",!0).order("email_type",{ascending:!0}).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(c)throw c;return b||[]}async getByType(a,b){let{data:c,error:d}=await this.supabase.from("email_templates").select("*").eq("organization_id",a).eq("email_type",b).eq("is_active",!0).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(d)throw d;return c||[]}async getDefault(a,b){let{data:c,error:d}=await this.supabase.from("email_templates").select("*").eq("organization_id",a).eq("email_type",b).eq("is_default",!0).eq("is_active",!0).maybeSingle();if(d)throw d;return c}async getById(a){let{data:b,error:c}=await this.supabase.from("email_templates").select("*").eq("id",a).maybeSingle();if(c)throw c;return b}async create(a,b){a.is_default&&await this.unsetOtherDefaults(a.organization_id,a.email_type);let{data:c,error:d}=await this.supabase.from("email_templates").insert({...a,created_by:b,available_variables:a.available_variables||[]}).select().single();if(d)throw d;return c}async update(a,b){let c=await this.getById(a);if(!c)throw Error("Modèle non trouvé");b.is_default&&await this.unsetOtherDefaults(c.organization_id,c.email_type,a);let{data:d,error:e}=await this.supabase.from("email_templates").update(b).eq("id",a).select().single();if(e)throw e;return d}async delete(a){let{error:b}=await this.supabase.from("email_templates").update({is_active:!1}).eq("id",a);if(b)throw b}async deletePermanently(a){let{error:b}=await this.supabase.from("email_templates").delete().eq("id",a);if(b)throw b}async unsetOtherDefaults(a,b,c){let d=this.supabase.from("email_templates").update({is_default:!1}).eq("organization_id",a).eq("email_type",b).eq("is_default",!0);c&&(d=d.neq("id",c));let{error:e}=await d;if(e)throw e}replaceVariables(a,b){let c=a;for(let[a,d]of Object.entries(b)){let b=RegExp(`\\{${a}\\}`,"g");c=c.replace(b,d?.toString()||"")}return c}getEmailTypes(){return[{value:"document_generated",label:"Document généré",description:"Email envoyé lors de la génération d'un document",defaultVariables:["student_name","document_title","document_type","organization_name","document_url"]},{value:"invoice_sent",label:"Facture envoyée",description:"Email envoyé lors de l'envoi d'une facture",defaultVariables:["student_name","invoice_number","invoice_amount","due_date","organization_name","invoice_url"]},{value:"payment_reminder",label:"Rappel de paiement",description:"Email de rappel pour un paiement en attente",defaultVariables:["student_name","invoice_number","invoice_amount","due_date","days_overdue","organization_name"]},{value:"enrollment_confirmation",label:"Confirmation d'inscription",description:"Email de confirmation d'inscription à une session",defaultVariables:["student_name","session_name","session_start_date","session_location","organization_name"]},{value:"session_reminder",label:"Rappel de session",description:"Email de rappel avant une session",defaultVariables:["student_name","session_name","session_date","session_time","session_location","organization_name"]},{value:"certificate_issued",label:"Certificat délivré",description:"Email lors de la délivrance d'un certificat",defaultVariables:["student_name","certificate_name","certificate_date","organization_name","certificate_url"]},{value:"notification",label:"Notification générale",description:"Notification générale personnalisée",defaultVariables:["recipient_name","message","organization_name","action_url"]},{value:"custom",label:"Personnalisé",description:"Modèle d'email personnalisé",defaultVariables:[]}]}};a.s(["emailTemplateService",0,c])},963900,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(792843),i=a.i(340695),j=a.i(703130),k=a.i(205522),l=a.i(917171),m=a.i(546893),n=a.i(280281),o=a.i(965733),p=a.i(887682),q=a.i(864037),r=a.i(992258),s=a.i(915618),t=a.i(683245),u=a.i(781560);a.i(460355);var v=a.i(346271);function w(){let{user:a}=(0,g.useAuth)(),w=(0,f.useQueryClient)(),{addToast:x}=(0,q.useToast)(),[y,z]=(0,c.useState)("all"),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)({email_type:"document_generated",name:"",subject:"",body_html:"",body_text:"",is_default:!1,is_active:!0,description:""}),G=h.emailTemplateService.getEmailTypes(),{data:H,isLoading:I}=(0,d.useQuery)({queryKey:["email-templates",a?.organization_id],queryFn:async()=>a?.organization_id?h.emailTemplateService.getAll(a.organization_id):[],enabled:!!a?.organization_id}),J="all"===y?H||[]:(H||[]).filter(a=>a.email_type===y),K=(0,e.useMutation)({mutationFn:async b=>{if(!a?.organization_id||!a?.id)throw Error("Non authentifié");return h.emailTemplateService.create({organization_id:a.organization_id,...b},a.id)},onSuccess:()=>{w.invalidateQueries({queryKey:["email-templates"]}),B(!1),N(),x({title:"Modèle créé",description:"Le modèle d'email a été créé avec succès.",type:"success"})},onError:a=>{x({title:"Erreur",description:a.message||"Une erreur est survenue lors de la création du modèle.",type:"error"})}}),L=(0,e.useMutation)({mutationFn:async({id:a,data:b})=>h.emailTemplateService.update(a,b),onSuccess:()=>{w.invalidateQueries({queryKey:["email-templates"]}),D(null),N(),x({title:"Modèle mis à jour",description:"Le modèle d'email a été mis à jour avec succès.",type:"success"})},onError:a=>{x({title:"Erreur",description:a.message||"Une erreur est survenue lors de la mise à jour du modèle.",type:"error"})}}),M=(0,e.useMutation)({mutationFn:async a=>h.emailTemplateService.delete(a),onSuccess:()=>{w.invalidateQueries({queryKey:["email-templates"]}),x({title:"Modèle supprimé",description:"Le modèle d'email a été supprimé avec succès.",type:"success"})},onError:a=>{x({title:"Erreur",description:a.message||"Une erreur est survenue lors de la suppression du modèle.",type:"error"})}}),N=()=>{F({email_type:"document_generated",name:"",subject:"",body_html:"",body_text:"",is_default:!1,is_active:!0,description:""})},O=()=>{N(),D(null),B(!0)},P=G.find(a=>a.value===E.email_type),Q=J.reduce((a,b)=>(a[b.email_type]||(a[b.email_type]=[]),a[b.email_type].push(b),a),{});return(0,b.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Modèles d'emails"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Gérez les modèles d'emails pour chaque type d'envoi"})]}),(0,b.jsxs)(i.Button,{onClick:O,className:"gap-2",children:[(0,b.jsx)(s.Plus,{className:"w-4 h-4"}),"Nouveau modèle"]})]}),(0,b.jsx)(j.Card,{className:"mb-6",children:(0,b.jsx)(j.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(l.Label,{htmlFor:"email-type-filter",children:"Type d'email :"}),(0,b.jsxs)(p.Select,{value:y,onValueChange:a=>z(a),children:[(0,b.jsx)(p.SelectTrigger,{className:"w-64",children:(0,b.jsx)(p.SelectValue,{})}),(0,b.jsxs)(p.SelectContent,{children:[(0,b.jsx)(p.SelectItem,{value:"all",children:"Tous les types"}),G.map(a=>(0,b.jsx)(p.SelectItem,{value:a.value,children:a.label},a.value))]})]})]})})}),I?(0,b.jsx)("div",{className:"text-center py-12 text-gray-500",children:"Chargement..."}):0===J.length?(0,b.jsx)(j.Card,{children:(0,b.jsxs)(j.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)(r.Mail,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"all"===y?"Aucun modèle d'email configuré":`Aucun mod\xe8le pour le type "${G.find(a=>a.value===y)?.label}"`}),(0,b.jsx)(i.Button,{onClick:O,variant:"outline",children:"Créer le premier modèle"})]})}):(0,b.jsx)("div",{className:"space-y-6",children:Object.entries(Q).map(([a,c])=>{let d=G.find(b=>b.value===a);return(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsxs)(j.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(r.Mail,{className:"w-5 h-5"}),d?.label||a]}),(0,b.jsx)(j.CardDescription,{children:d?.description})]}),(0,b.jsx)(j.CardContent,{children:(0,b.jsx)("div",{className:"space-y-4",children:c.map(a=>(0,b.jsxs)(v.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-start justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:a.name}),a.is_default&&(0,b.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:"Par défaut"}),!a.is_active&&(0,b.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-600 rounded-full",children:"Inactif"})]}),(0,b.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[(0,b.jsx)("strong",{children:"Sujet :"})," ",a.subject]}),a.description&&(0,b.jsx)("p",{className:"text-sm text-gray-500",children:a.description})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>{F({email_type:a.email_type,name:a.name,subject:a.subject,body_html:a.body_html,body_text:a.body_text||"",is_default:a.is_default,is_active:a.is_active,description:a.description||""}),D(a),B(!0)},children:(0,b.jsx)(t.Edit,{className:"w-4 h-4"})}),(0,b.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:()=>{var b;return b=a.id,void(confirm("Êtes-vous sûr de vouloir supprimer ce modèle ?")&&M.mutate(b))},children:(0,b.jsx)(u.Trash2,{className:"w-4 h-4 text-red-600"})})]})]},a.id))})})]},a)})}),(0,b.jsx)(o.Dialog,{open:A,onOpenChange:B,children:(0,b.jsxs)(o.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(o.DialogHeader,{children:[(0,b.jsx)(o.DialogTitle,{children:C?"Modifier le modèle":"Nouveau modèle d'email"}),(0,b.jsx)(o.DialogDescription,{children:C?"Modifiez les informations du modèle d'email":"Créez un nouveau modèle d'email pour un type d'envoi spécifique"})]}),(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"email_type",children:"Type d'email *"}),(0,b.jsxs)(p.Select,{value:E.email_type,onValueChange:a=>{F({...E,email_type:a})},children:[(0,b.jsx)(p.SelectTrigger,{id:"email_type",children:(0,b.jsx)(p.SelectValue,{})}),(0,b.jsx)(p.SelectContent,{children:G.map(a=>(0,b.jsx)(p.SelectItem,{value:a.value,children:a.label},a.value))})]}),P&&(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:P.description})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"name",children:"Nom du modèle *"}),(0,b.jsx)(k.Input,{id:"name",value:E.name,onChange:a=>F({...E,name:a.target.value}),placeholder:"Ex: Document généré - Standard"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"description",children:"Description (optionnel)"}),(0,b.jsx)(m.Textarea,{id:"description",value:E.description,onChange:a=>F({...E,description:a.target.value}),placeholder:"Description du modèle...",rows:2})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"subject",children:"Sujet de l'email *"}),(0,b.jsx)(k.Input,{id:"subject",value:E.subject,onChange:a=>F({...E,subject:a.target.value}),placeholder:"Ex: Votre {document_title}"}),P&&P.defaultVariables.length>0&&(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Variables disponibles : ",P.defaultVariables.join(", ")]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"body_html",children:"Corps de l'email (HTML) *"}),(0,b.jsx)(m.Textarea,{id:"body_html",value:E.body_html,onChange:a=>F({...E,body_html:a.target.value}),placeholder:"<p>Bonjour {student_name},</p><p>Votre document {document_title} est prêt.</p>",rows:12,className:"font-mono text-sm"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:"body_text",children:"Corps de l'email (texte brut - optionnel)"}),(0,b.jsx)(m.Textarea,{id:"body_text",value:E.body_text,onChange:a=>F({...E,body_text:a.target.value}),placeholder:"Version texte de l'email...",rows:6})]}),(0,b.jsxs)("div",{className:"flex items-center gap-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Switch,{checked:E.is_default,onCheckedChange:a=>F({...E,is_default:a})}),(0,b.jsx)(l.Label,{htmlFor:"is_default",children:"Modèle par défaut pour ce type"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Switch,{checked:E.is_active,onCheckedChange:a=>F({...E,is_active:a})}),(0,b.jsx)(l.Label,{htmlFor:"is_active",children:"Actif"})]})]})]}),(0,b.jsxs)(o.DialogFooter,{children:[(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>{B(!1),N(),D(null)},children:"Annuler"}),(0,b.jsx)(i.Button,{onClick:()=>{C?L.mutate({id:C.id,data:E}):K.mutate(E)},disabled:!E.name||!E.subject||!E.body_html||K.isPending||L.isPending,children:C?"Enregistrer":"Créer"})]})]})})]})}a.s(["default",()=>w])}];

//# sourceMappingURL=_1ecb1ba9._.js.map