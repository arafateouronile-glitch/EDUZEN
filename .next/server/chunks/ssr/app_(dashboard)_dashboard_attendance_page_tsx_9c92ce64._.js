module.exports=[485149,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(913216),f=a.i(269240),g=a.i(340695),h=a.i(219897),i=a.i(941675),j=a.i(660246),k=a.i(641710),l=a.i(290821),m=a.i(724669),n=a.i(284505),o=a.i(104720),p=a.i(732860),q=a.i(46864),r=a.i(592319),s=a.i(672893),t=a.i(669520),u=a.i(776803),v=a.i(922520),w=a.i(170106);let x=(0,w.default)("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]),y=(0,w.default)("Hand",[["path",{d:"M18 11V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v0",key:"aigmz7"}],["path",{d:"M14 10V4a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v2",key:"1n6bmn"}],["path",{d:"M10 10.5V6a2 2 0 0 0-2-2v0a2 2 0 0 0-2 2v8",key:"a9iiix"}],["path",{d:"M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15",key:"1s1gnw"}]]);var z=a.i(992258),A=a.i(497895),B=a.i(238246);a.i(460355);var C=a.i(346271),D=a.i(807585),E=a.i(547615),F=a.i(222703),G=a.i(965733),H=a.i(50944);function I(){let{user:a}=(0,e.useAuth)(),w=(0,H.useRouter)(),I=(0,f.createClient)(),[J,K]=(0,c.useState)(new Date().toISOString().split("T")[0]),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)("week"),[R,S]=(0,c.useState)("monthly"),[T,U]=(0,c.useState)(new Date().toISOString().slice(0,7)),[V,W]=(0,c.useState)(new Date().getFullYear().toString()),[X,Y]=(0,c.useState)(!1),Z=a?.role==="teacher",{data:$}=(0,d.useQuery)({queryKey:["teacher-session-ids",a?.id],queryFn:async()=>{if(!a?.id)return[];let{data:b,error:c}=await I.from("session_teachers").select("session_id").eq("teacher_id",a.id);return c?(console.error("Erreur récupération sessions enseignant:",c),[]):b?.map(a=>a.session_id)||[]},enabled:!!a?.id&&Z}),{data:_}=(0,d.useQuery)({queryKey:["program-sessions-all",a?.organization_id,Z,$],queryFn:async()=>{if(!a?.organization_id)return[];let b=I.from("sessions").select("id, name, start_date, end_date, formations!inner(id, name, code, organization_id, programs(id, name))").eq("formations.organization_id",a.organization_id).order("start_date",{ascending:!1});if(Z&&$&&$.length>0)b=b.in("id",$);else if(Z)return[];let{data:c,error:d}=await b;if(d)throw d;return c?.map(a=>({id:a.id,name:`${a.name} - ${a.formations?.name||""}${a.formations?.programs?` (${a.formations.programs.name})`:""}`,code:a.formations?.code||"",start_date:a.start_date,end_date:a.end_date}))||[]},enabled:!!a?.organization_id&&(!Z||Z&&void 0!==$)}),{data:aa}=(0,d.useQuery)({queryKey:["session-slots",L],queryFn:async()=>{if(!L)return[];let{data:a,error:b}=await I.from("session_slots").select("*").eq("session_id",L).order("date",{ascending:!0}).order("start_time",{ascending:!0});return b?(console.warn("Erreur récupération séances:",b),[]):a||[]},enabled:!!L}),{data:ab}=(0,d.useQuery)({queryKey:["upcoming-sessions",a?.organization_id,Z,$],queryFn:async()=>{if(!a?.organization_id)return[];let b=new Date().toISOString().split("T")[0],c=I.from("sessions").select("*, formations!inner(*, programs(*))").eq("formations.organization_id",a.organization_id).gte("start_date",b).lte("end_date",b).in("status",["planned","ongoing"]).order("start_date",{ascending:!0}).limit(10);if(Z&&$&&$.length>0)c=c.in("id",$);else if(Z)return[];let{data:d,error:e}=await c;if(e)throw e;return d||[]},enabled:!!a?.organization_id&&(!Z||Z&&void 0!==$)}),{data:ac,refetch:ad,isLoading:ae}=(0,d.useQuery)({queryKey:["attendance-stats",a?.organization_id,J],queryFn:async()=>{if(!a?.organization_id)return console.warn("[ATTENDANCE STATS] Pas d'organisation ID"),null;let{data:b,error:c}=await I.from("session_slots").select("id, session_id, date, time_slot").eq("date",J);c&&console.warn("[ATTENDANCE STATS] ⚠️ Erreur récupération slots:",c),b?.map(a=>a.session_id),b?.map(a=>a.id);let{data:d,error:e}=await I.from("attendance").select("*").eq("organization_id",a.organization_id).eq("date",J);if(e)throw console.error("[ATTENDANCE STATS] ❌ Erreur Supabase:",e),e;let f=new Map;[...d||[]].sort((a,b)=>{let c=new Date(a.created_at||a.id).getTime();return new Date(b.created_at||b.id).getTime()-c}).forEach(a=>{if(a.student_id){let b=a.session_id?`${a.student_id}_${a.session_id}`:a.student_id;f.has(b)||f.set(b,a)}});let g=Array.from(f.values()),h=0,i=0,j=0,k=0;g.forEach(a=>{let b=a.status?.toLowerCase()||"";"present"===b?h++:"absent"===b?i++:"late"===b?j++:"excused"===b&&k++});let l=g.length,m=l>0?(h+j+k)/l*100:0;return{total:l,present:h,absent:i,late:j,excused:k,attendanceRate:m,statusData:[{name:"Présents",value:h,color:"#335ACF"},{name:"Absents",value:i,color:"#EF4444"},{name:"Retard",value:j,color:"#34B9EE"},{name:"Justifiés",value:k,color:"#3B82F6"}].filter(a=>a.value>0)}},enabled:!!a?.organization_id,refetchOnWindowFocus:!0,refetchOnMount:!0,staleTime:0,gcTime:0}),{data:af}=(0,d.useQuery)({queryKey:["attendance-period-stats",a?.organization_id,P],queryFn:async()=>{let b;if(!a?.organization_id)return null;let c=new Date;switch(c.setHours(0,0,0,0),P){case"week":default:(b=new Date(c)).setDate(c.getDate()-7);break;case"month":b=new Date(c.getFullYear(),c.getMonth(),1);break;case"quarter":let d=Math.floor(c.getMonth()/3);b=new Date(c.getFullYear(),3*d,1)}let{data:e,error:f}=await I.from("attendance").select("date, status").eq("organization_id",a.organization_id).gte("date",b.toISOString().split("T")[0]).lte("date",c.toISOString().split("T")[0]);if(f)throw f;let g=e||[],h=g.length,i=g.filter(a=>"present"===a.status).length,j=g.filter(a=>"absent"===a.status).length,k=g.filter(a=>"late"===a.status).length,l=g.filter(a=>"excused"===a.status).length,m={};return g.forEach(a=>{let b=a.date;m[b]||(m[b]={present:0,absent:0,late:0,total:0}),m[b].total++,"present"===a.status&&m[b].present++,"absent"===a.status&&m[b].absent++,"late"===a.status&&m[b].late++}),{total:h,present:i,absent:j,late:k,excused:l,attendanceRate:h>0?(i+k+l)/h*100:0,dailyData:Object.entries(m).sort(([a],[b])=>a.localeCompare(b)).slice(-14).map(([a,b])=>({date:new Date(a).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}),présent:b.present,absent:b.absent,retard:b.late,taux:b.total>0?Math.round((b.present+b.late)/b.total*100):0}))}},enabled:!!a?.organization_id}),{data:ag}=(0,d.useQuery)({queryKey:["recent-attendance",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)return[];let{data:b,error:c}=await I.from("attendance").select("*, students(first_name, last_name, student_number), sessions(name, formations(name, programs(name)))").eq("organization_id",a.organization_id).order("date",{ascending:!1}).order("created_at",{ascending:!1}).limit(20);if(c)throw c;return b||[]},enabled:!!a?.organization_id}),{data:ah}=(0,d.useQuery)({queryKey:["monthly-attendance-report",a?.organization_id,T],queryFn:async()=>{if(!a?.organization_id||"monthly"!==R)return null;let b=`${T}-01`,c=new Date(new Date(T+"-01").getFullYear(),new Date(T+"-01").getMonth()+1,0).toISOString().split("T")[0],{data:d,error:e}=await I.from("attendance").select("*, students(first_name, last_name, student_number), sessions(name, formations(name, programs(name)))").eq("organization_id",a.organization_id).gte("date",b).lte("date",c).order("date",{ascending:!0});if(e)throw e;let f=d||[],g=f.length,h=f.filter(a=>"present"===a.status).length,i=f.filter(a=>"absent"===a.status).length,j=f.filter(a=>"late"===a.status).length,k=f.filter(a=>"excused"===a.status).length,l={};f.forEach(a=>{let b=a.date;l[b]||(l[b]={present:0,absent:0,late:0,total:0}),l[b].total++,"present"===a.status&&l[b].present++,"absent"===a.status&&l[b].absent++,"late"===a.status&&l[b].late++});let m=Object.entries(l).sort(([a],[b])=>a.localeCompare(b)).map(([a,b])=>({date:new Date(a).toLocaleDateString("fr-FR",{day:"2-digit",month:"short"}),présent:b.present,absent:b.absent,retard:b.late,taux:b.total>0?Math.round((b.present+b.late)/b.total*100):0})),n={};return f.forEach(a=>{let b=a.student_id;b&&(n[b]||(n[b]={student:a.students,present:0,absent:0,late:0,total:0}),n[b].total++,"present"===a.status&&n[b].present++,"absent"===a.status&&n[b].absent++,"late"===a.status&&n[b].late++)}),{total:g,present:h,absent:i,late:j,excused:k,attendanceRate:g>0?(h+j+k)/g*100:0,dailyData:m,studentData:Object.values(n).map(a=>({student:a.student,present:a.present,absent:a.absent,late:a.late,total:a.total,rate:a.total>0?Math.round((a.present+a.late)/a.total*100):0})).sort((a,b)=>b.rate-a.rate)}},enabled:!!a?.organization_id&&"monthly"===R}),{data:ai}=(0,d.useQuery)({queryKey:["yearly-attendance-report",a?.organization_id,V],queryFn:async()=>{if(!a?.organization_id||"yearly"!==R)return null;let b=`${V}-01-01`,c=`${V}-12-31`,{data:d,error:e}=await I.from("attendance").select("date, status").eq("organization_id",a.organization_id).gte("date",b).lte("date",c);if(e)throw e;let f=d||[],g=f.length,h=f.filter(a=>"present"===a.status).length,i=f.filter(a=>"absent"===a.status).length,j=f.filter(a=>"late"===a.status).length,k={};return f.forEach(a=>{if(a.date){let b=new Date(a.date),c=`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}`;k[c]||(k[c]={present:0,absent:0,late:0,total:0}),k[c].total++,"present"===a.status&&k[c].present++,"absent"===a.status&&k[c].absent++,"late"===a.status&&k[c].late++}}),{total:g,present:h,absent:i,late:j,attendanceRate:g>0?(h+j)/g*100:0,monthlyData:Object.entries(k).sort(([a],[b])=>a.localeCompare(b)).map(([a,b])=>({month:new Date(a+"-01").toLocaleDateString("fr-FR",{month:"long",year:"numeric"}),présent:b.present,absent:b.absent,retard:b.late,taux:b.total>0?Math.round((b.present+b.late)/b.total*100):0}))}},enabled:!!a?.organization_id&&"yearly"===R}),aj=a=>{switch(a){case"present":return"Présent";case"absent":return"Absent";case"late":return"En retard";case"excused":return"Justifié";default:return a}},ak=a=>{switch(a){case"present":return"bg-brand-blue-ghost text-brand-blue border-brand-blue/20";case"absent":return"bg-red-50 text-red-600 border-red-100";case"late":return"bg-brand-cyan-ghost text-brand-cyan border-brand-cyan/20";case"excused":return"bg-blue-50 text-blue-600 border-blue-100";default:return"bg-gray-50 text-gray-600 border-gray-100"}},al=async a=>{if(!ag||0===ag.length)return void alert("Aucun émargement à exporter");try{let b=ag.map(a=>{let b=a.students,c=a.sessions,d=c?.formations,e=d?.programs;return{Date:(0,A.formatDate)(a.date),Élève:`${b?.first_name||""} ${b?.last_name||""}`.trim(),Numéro:b?.student_number||"",Session:c?.name||"",Formation:d?.name||"",Programme:e?.name||"",Statut:aj(a.status),"Retard (min)":a.late_minutes||0,Notes:a.notes||""}});"xlsx"===a?await (0,F.exportToExcel)({filename:`emargements_${new Date().toISOString().split("T")[0]}.xlsx`,sheetName:"Émargements",columns:[{header:"Date",key:"Date",width:12},{header:"Élève",key:"Élève",width:20},{header:"Numéro",key:"Numéro",width:15},{header:"Session",key:"Session",width:30},{header:"Formation",key:"Formation",width:25},{header:"Programme",key:"Programme",width:25},{header:"Statut",key:"Statut",width:12},{header:"Retard (min)",key:"Retard (min)",width:12},{header:"Notes",key:"Notes",width:30}],data:b}):(0,F.exportToCSV)(`emargements_${new Date().toISOString().split("T")[0]}.csv`,b),alert(`Export ${a.toUpperCase()} r\xe9ussi ! ${b.length} \xe9margement(s) export\xe9(s).`)}catch(a){console.error("Erreur lors de l'export:",a),alert("Erreur lors de l'export des données")}},am={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5,ease:[.16,1,.3,1]}}};return(0,b.jsxs)(C.motion.div,{className:"space-y-8 pb-8 max-w-[1600px] mx-auto",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",children:[(0,b.jsx)(C.motion.div,{variants:am,className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-6",children:(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-3",children:[(0,b.jsx)(C.motion.div,{className:"p-3 bg-gradient-to-br from-brand-blue to-brand-cyan rounded-2xl shadow-lg shadow-brand-blue/20",whileHover:{scale:1.1,rotate:5},transition:{type:"spring",stiffness:400,damping:10},children:(0,b.jsx)(u.ClipboardCheck,{className:"h-8 w-8 text-white"})}),(0,b.jsx)("h1",{className:"text-4xl md:text-6xl font-display font-bold text-gray-900 tracking-tighter leading-none",children:"Présences"}),ac&&ac.total>0&&(0,b.jsx)(C.motion.span,{className:"px-3 py-1.5 bg-brand-blue-ghost text-brand-blue rounded-full text-sm font-bold flex items-center gap-2 shadow-sm",whileHover:{scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:ac.total})]}),(0,b.jsx)("p",{className:"text-gray-600 font-medium text-lg tracking-tight",children:"Suivi détaillé des présences, retards et absences"})]})}),(0,b.jsxs)(C.motion.div,{variants:am,className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(i.Calendar,{className:"h-5 w-5 text-gray-400"}),(0,b.jsxs)("span",{className:"text-sm text-gray-600",children:["Statistiques de toutes les séances du ",(0,b.jsx)("span",{className:"font-semibold text-gray-900",children:(0,A.formatDate)(J)})]})]}),(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>ad(),className:"flex items-center gap-2",children:[(0,b.jsx)(t.RefreshCw,{className:"h-4 w-4"}),"Actualiser"]})]}),ae?(0,b.jsx)(h.GlassCard,{variant:"default",className:"p-8 text-center",children:(0,b.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,b.jsx)(t.RefreshCw,{className:"h-5 w-5 animate-spin text-brand-blue"}),(0,b.jsx)("span",{className:"text-gray-600",children:"Chargement des statistiques..."})]})}):ac?(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{title:"Total émargements",value:ac.total,icon:j.Users,iconBg:"bg-gradient-to-br from-brand-blue to-brand-blue-dark",cardBg:"bg-gradient-to-br from-brand-blue/5 via-brand-blue/10 to-brand-cyan/5",borderColor:"border-brand-blue/20",glowColor:"rgba(39, 68, 114, 0.15)"},{title:"Présents",value:ac.present,icon:q.UserCheck,iconBg:"bg-gradient-to-br from-emerald-500 to-emerald-600",cardBg:"bg-gradient-to-br from-emerald-50 via-emerald-100/50 to-teal-50",borderColor:"border-emerald-200",glowColor:"rgba(16, 185, 129, 0.15)",highlight:ac.present>0},{title:"Absents",value:ac.absent,icon:r.UserX,iconBg:"bg-gradient-to-br from-red-500 to-red-600",cardBg:"bg-gradient-to-br from-red-50 via-red-100/50 to-pink-50",borderColor:"border-red-200",glowColor:"rgba(239, 68, 68, 0.15)"},{title:"En retard",value:ac.late,icon:k.Clock,iconBg:"bg-gradient-to-br from-brand-cyan to-brand-cyan-dark",cardBg:"bg-gradient-to-br from-brand-cyan/5 via-brand-cyan/10 to-brand-blue/5",borderColor:"border-brand-cyan/20",glowColor:"rgba(52, 185, 238, 0.15)"},{title:"Justifiés",value:ac.excused,icon:s.UserMinus,iconBg:"bg-gradient-to-br from-blue-500 to-blue-600",cardBg:"bg-gradient-to-br from-blue-50 via-blue-100/50 to-indigo-50",borderColor:"border-blue-200",glowColor:"rgba(59, 130, 246, 0.15)"},{title:"Taux présence",value:`${ac.attendanceRate.toFixed(1)}%`,icon:x,iconBg:"bg-gradient-to-br from-brand-blue-light to-brand-cyan",cardBg:"bg-gradient-to-br from-brand-blue-pale/30 via-brand-blue-pale/50 to-brand-cyan-pale/30",borderColor:"border-brand-blue-light/20",glowColor:"rgba(75, 116, 157, 0.15)"}].map((a,c)=>(0,b.jsx)(C.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.05*c,ease:[.16,1,.3,1]},whileHover:{y:-6,scale:1.02},className:"group relative",children:(0,b.jsxs)("div",{className:(0,A.cn)("relative overflow-hidden rounded-2xl p-6 border-2 transition-all duration-500 shadow-lg hover:shadow-2xl",a.cardBg,a.borderColor,a.highlight&&"ring-2 ring-emerald-500/20 animate-pulse-premium"),style:{boxShadow:`0 10px 40px -10px ${a.glowColor}, 0 0 0 1px rgba(255, 255, 255, 0.1)`},children:[(0,b.jsx)(C.motion.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent",initial:{x:"-100%"},whileHover:{x:"100%"},transition:{duration:.6,ease:"easeInOut"}}),(0,b.jsxs)("div",{className:"relative z-10",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,b.jsx)(C.motion.div,{className:(0,A.cn)("p-3.5 rounded-2xl shadow-xl",a.iconBg),whileHover:{rotate:12,scale:1.15},transition:{type:"spring",stiffness:500,damping:15},children:(0,b.jsx)(a.icon,{className:"h-6 w-6 text-white"})}),(0,b.jsxs)(C.motion.div,{className:"text-right",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.05*c+.2,duration:.5},children:[(0,b.jsx)("div",{className:"text-4xl font-display font-bold tracking-tighter text-gray-900 leading-none mb-1",children:a.value}),(0,b.jsx)("p",{className:"text-xs font-bold text-gray-600 uppercase tracking-widest",children:a.title})]})]}),(0,b.jsx)(C.motion.div,{className:"h-1.5 rounded-full mt-4",style:{background:a.iconBg.replace("bg-gradient-to-br","linear-gradient(to right,")},initial:{scaleX:0},animate:{scaleX:1},transition:{delay:.05*c+.3,duration:.6,ease:[.16,1,.3,1]}})]}),(0,b.jsx)("div",{className:"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500",style:{background:`radial-gradient(circle at 50% 50%, ${a.glowColor} 0%, transparent 70%)`}})]})},a.title))}):(0,b.jsxs)(h.GlassCard,{variant:"default",className:"p-8 text-center",children:[(0,b.jsx)(l.AlertCircle,{className:"h-8 w-8 text-gray-400 mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-gray-600 font-medium mb-2",children:"Aucune statistique disponible"}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Aucun émargement trouvé pour le ",(0,A.formatDate)(J)]}),(0,b.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>ad(),className:"mt-4",children:[(0,b.jsx)(t.RefreshCw,{className:"h-4 w-4 mr-2"}),"Réessayer"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsx)(C.motion.div,{variants:am,className:"lg:col-span-2",children:(0,b.jsxs)(h.GlassCard,{variant:"premium",className:"p-6 h-full flex flex-col justify-center border-2 border-transparent hover:border-brand-blue/10 transition-all duration-500",children:[(0,b.jsxs)("h3",{className:"text-xl font-display font-bold text-gray-900 mb-4 flex items-center gap-3 tracking-tight",children:[(0,b.jsx)(C.motion.div,{className:"p-2 bg-gradient-to-br from-brand-blue to-brand-cyan rounded-xl shadow-md",whileHover:{rotate:5,scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:(0,b.jsx)(i.Calendar,{className:"h-5 w-5 text-white"})}),"Émargement Rapide"]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Date"}),(0,b.jsx)("input",{type:"date",value:J,onChange:a=>K(a.target.value),className:"w-full px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm"})]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Session"}),(0,b.jsxs)("select",{value:L,onChange:a=>{M(a.target.value),O("")},className:"w-full px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm",children:[(0,b.jsx)("option",{value:"",children:"Choisir une session..."}),_?.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),L&&aa&&aa.length>0&&(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Séance"}),(0,b.jsxs)("select",{value:N,onChange:a=>{O(a.target.value);let b=aa?.find(b=>b.id===a.target.value);b&&K(b.date)},className:"w-full px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm",children:[(0,b.jsx)("option",{value:"",children:"Choisir une séance..."}),aa.map(a=>{let c=new Date(a.date).toLocaleDateString("fr-FR",{weekday:"short",day:"2-digit",month:"short"}),d="morning"===a.time_slot?"Matin":"afternoon"===a.time_slot?"Après-midi":"Journée";return(0,b.jsxs)("option",{value:a.id,children:[c," - ",d," (",a.start_time," - ",a.end_time,")"]},a.id)})]})]}),(0,b.jsx)("div",{className:"flex items-end",children:(0,b.jsx)(C.motion.div,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.98},children:(0,b.jsxs)(g.Button,{disabled:!L,onClick:()=>Y(!0),className:"w-full sm:w-auto h-[42px] bg-gradient-to-br from-brand-blue to-brand-cyan text-white hover:from-brand-blue-dark hover:to-brand-cyan-dark shadow-xl shadow-brand-blue/20 hover:shadow-2xl hover:shadow-brand-cyan/30 transition-all duration-500 font-semibold tracking-tight",children:["Lancer l'appel",(0,b.jsx)(p.ArrowRight,{className:"ml-2 h-4 w-4"})]})})})]})]})}),(0,b.jsx)(C.motion.div,{variants:am,children:(0,b.jsxs)(h.GlassCard,{variant:"premium",className:"p-6 h-full flex flex-col justify-center border-2 border-transparent hover:border-brand-cyan/10 transition-all duration-500",children:[(0,b.jsxs)("h3",{className:"text-xl font-display font-bold text-gray-900 mb-4 flex items-center gap-3 tracking-tight",children:[(0,b.jsx)(C.motion.div,{className:"p-2 bg-gradient-to-br from-brand-cyan to-brand-blue rounded-xl shadow-md",whileHover:{rotate:-5,scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:(0,b.jsx)(o.FileText,{className:"h-5 w-5 text-white"})}),"Rapports"]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("select",{value:R,onChange:a=>S(a.target.value),className:"flex-1 px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm",children:[(0,b.jsx)("option",{value:"monthly",children:"Mensuel"}),(0,b.jsx)("option",{value:"yearly",children:"Annuel"})]}),"monthly"===R?(0,b.jsx)("input",{type:"month",value:T,onChange:a=>U(a.target.value),className:"flex-1 px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm"}):(0,b.jsx)("select",{value:V,onChange:a=>W(a.target.value),className:"flex-1 px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm",children:Array.from({length:5},(a,c)=>{let d=new Date().getFullYear()-c;return(0,b.jsx)("option",{value:d.toString(),children:d},d)})})]}),(0,b.jsxs)(g.Button,{variant:"outline",className:"w-full",onClick:()=>al("xlsx"),children:[(0,b.jsx)(n.Download,{className:"mr-2 h-4 w-4"}),"Exporter les données"]})]})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[af&&af.dailyData.length>0&&(0,b.jsx)(C.motion.div,{variants:am,className:"h-full",children:(0,b.jsxs)(h.GlassCard,{variant:"premium",className:"p-6 h-full border-2 border-transparent hover:border-brand-blue/10 transition-all duration-500",children:[(0,b.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,b.jsxs)("h3",{className:"text-lg font-display font-bold text-gray-900 flex items-center gap-3 tracking-tight",children:[(0,b.jsx)(C.motion.div,{className:"p-2 bg-gradient-to-br from-brand-blue to-brand-cyan rounded-xl shadow-md",whileHover:{rotate:5,scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:(0,b.jsx)(m.TrendingUp,{className:"h-5 w-5 text-white"})}),"Évolution de la présence"]}),(0,b.jsxs)("select",{value:P,onChange:a=>Q(a.target.value),className:"text-xs font-medium bg-gray-100 border-none rounded-lg px-2 py-1 cursor-pointer hover:bg-gray-200 transition-colors",children:[(0,b.jsx)("option",{value:"week",children:"7 jours"}),(0,b.jsx)("option",{value:"month",children:"Mois"}),(0,b.jsx)("option",{value:"quarter",children:"Trimestre"})]})]}),(0,b.jsx)("div",{className:"h-[300px]",children:(0,b.jsx)(D.PremiumLineChart,{data:af.dailyData,dataKey:"taux",xAxisKey:"date",color:"#3B82F6",gradientColors:{from:"#3B82F6",to:"#60A5FA"},showArea:!0,variant:"default",className:"h-full !p-0 !bg-transparent !border-none !shadow-none",valueFormatter:a=>`${a}%`})})]})}),ac&&ac.statusData&&ac.statusData.length>0&&(0,b.jsx)(C.motion.div,{variants:am,className:"h-full",children:(0,b.jsxs)(h.GlassCard,{variant:"premium",className:"p-6 h-full border-2 border-transparent hover:border-brand-cyan/10 transition-all duration-500",children:[(0,b.jsx)("div",{className:"mb-6 flex items-center justify-between",children:(0,b.jsxs)("h3",{className:"text-lg font-display font-bold text-gray-900 flex items-center gap-3 tracking-tight",children:[(0,b.jsx)(C.motion.div,{className:"p-2 bg-gradient-to-br from-brand-cyan to-brand-blue rounded-xl shadow-md",whileHover:{rotate:-5,scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:(0,b.jsx)(j.Users,{className:"h-5 w-5 text-white"})}),"Répartition du jour"]})}),(0,b.jsx)("div",{className:"h-[300px]",children:(0,b.jsx)(E.PremiumPieChart,{data:ac.statusData,colors:ac.statusData.map(a=>a.color),variant:"default",className:"h-full !p-0 !bg-transparent !border-none !shadow-none",innerRadius:70})})]})})]}),(0,b.jsx)(C.motion.div,{variants:am,children:(0,b.jsxs)(h.GlassCard,{variant:"premium",className:"overflow-hidden p-0 border-2 border-transparent hover:border-brand-blue/10 transition-all duration-500",children:[(0,b.jsx)("div",{className:"p-6 border-b border-gray-100 flex items-center justify-between",children:(0,b.jsxs)("h3",{className:"text-xl font-display font-bold text-gray-900 flex items-center gap-3 tracking-tight",children:[(0,b.jsx)(C.motion.div,{className:"p-2 bg-gradient-to-br from-gray-600 to-gray-700 rounded-xl shadow-md",whileHover:{rotate:5,scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:(0,b.jsx)(k.Clock,{className:"h-5 w-5 text-white"})}),"Derniers émargements"]})}),(0,b.jsx)("div",{className:"divide-y divide-gray-100",children:ag&&ag.length>0?ag.slice(0,10).map((a,c)=>{let d=a.students,e=a.sessions;return e?.formations,(0,b.jsxs)(C.motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.05*c,duration:.5,ease:[.16,1,.3,1]},whileHover:{x:4,backgroundColor:"rgba(249, 250, 251, 0.5)"},className:"p-4 transition-all flex items-center justify-between group",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:(0,A.cn)("h-10 w-10 rounded-full flex items-center justify-center transition-colors",ak(a.status).replace("border-","").replace("text-","bg-opacity-20 text-")),children:(a=>{switch(a){case"present":return(0,b.jsx)(q.UserCheck,{className:"h-5 w-5"});case"absent":return(0,b.jsx)(r.UserX,{className:"h-5 w-5"});case"late":return(0,b.jsx)(k.Clock,{className:"h-5 w-5"});case"excused":return(0,b.jsx)(s.UserMinus,{className:"h-5 w-5"});default:return null}})(a.status)}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-display font-bold text-gray-900 tracking-tight",children:[d?.first_name," ",d?.last_name]}),(0,b.jsxs)("p",{className:"text-sm text-gray-500 flex items-center gap-2 font-medium tracking-tight",children:[(0,b.jsx)("span",{className:"font-semibold text-brand-blue/80",children:e?.name}),(0,b.jsx)("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),(0,b.jsx)("span",{children:(0,A.formatDate)(a.date)})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[a.late_minutes&&a.late_minutes>0&&(0,b.jsxs)("span",{className:"text-sm font-medium text-brand-cyan bg-brand-cyan-ghost px-2 py-1 rounded-md",children:["+",a.late_minutes," min"]}),(0,b.jsx)("span",{className:(0,A.cn)("px-3 py-1 rounded-full text-xs font-medium border",ak(a.status)),children:aj(a.status)})]})]},a.id)}):(0,b.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Aucun émargement récent"})}),(0,b.jsx)("div",{className:"p-4 border-t border-gray-100 bg-gray-50/30 text-center",children:(0,b.jsx)(B.default,{href:"/dashboard/attendance/history",children:(0,b.jsx)(C.motion.div,{whileHover:{scale:1.02},whileTap:{scale:.98},className:"inline-block",children:(0,b.jsxs)(g.Button,{variant:"ghost",className:"text-sm font-semibold text-brand-blue hover:text-brand-blue/80 hover:bg-brand-blue-ghost tracking-tight",children:["Voir tout l'historique",ag&&ag.length>10&&(0,b.jsxs)("span",{className:"ml-2 text-xs opacity-70 font-medium",children:["(",ag.length," résultats)"]}),(0,b.jsx)(v.ArrowUpRight,{className:"ml-2 h-4 w-4"})]})})})})]})}),(0,b.jsx)(G.Dialog,{open:X,onOpenChange:Y,children:(0,b.jsxs)(G.DialogContent,{className:"sm:max-w-[500px]",children:[(0,b.jsxs)(G.DialogHeader,{children:[(0,b.jsx)(G.DialogTitle,{children:"Choisissez le mode d'émargement"}),(0,b.jsx)(G.DialogDescription,{children:"Sélectionnez comment vous souhaitez effectuer l'appel pour cette session"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 gap-4 py-4",children:[(0,b.jsx)(C.motion.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{let a=`/dashboard/attendance/session/${L}?date=${J}${N?`&slotId=${N}`:""}`;w.push(a),Y(!1)},className:"cursor-pointer p-6 border-2 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-all",children:(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:"p-3 bg-blue-100 rounded-lg",children:(0,b.jsx)(y,{className:"h-6 w-6 text-blue-600"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Émargement manuel"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Cochez directement les présences, absences et retards depuis l'interface. Idéal pour les formations en présentiel avec contrôle direct."})]})]})}),(0,b.jsx)(C.motion.div,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{let a=`/dashboard/sessions/${L}?step=suivi`;w.push(a),Y(!1)},className:"cursor-pointer p-6 border-2 rounded-lg hover:border-green-500 hover:bg-green-50 transition-all",children:(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:"p-3 bg-green-100 rounded-lg",children:(0,b.jsx)(z.Mail,{className:"h-6 w-6 text-green-600"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"font-semibold text-lg mb-2",children:"Émargement numérique"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Envoyez automatiquement des demandes d'émargement par email avec signature électronique. Support de la géolocalisation pour valider la présence physique."})]})]})})]})]})})]})}a.s(["default",()=>I],485149)}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_attendance_page_tsx_9c92ce64._.js.map