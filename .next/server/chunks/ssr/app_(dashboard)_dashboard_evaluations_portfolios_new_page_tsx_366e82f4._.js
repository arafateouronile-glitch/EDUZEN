module.exports=[822227,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(433217),f=a.i(370025),g=a.i(913216),h=a.i(269240),i=a.i(703130),j=a.i(340695),k=a.i(205522),l=a.i(864037),m=a.i(400210),n=a.i(915618),o=a.i(587532),p=a.i(660246),q=a.i(104720),r=a.i(941675),s=a.i(111269),t=a.i(953722),u=a.i(238246);a.i(460355);var v=a.i(346271),w=a.i(497895);function x(){let a=(0,d.useRouter)(),{user:x}=(0,g.useAuth)(),y=(0,h.createClient)(),{addToast:z}=(0,l.useToast)(),[A,B]=(0,c.useState)(1),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)(""),{data:K,isLoading:L}=(0,e.useQuery)({queryKey:["portfolio-templates-active",x?.organization_id],queryFn:async()=>{if(!x?.organization_id)return[];let{data:a,error:b}=await y.from("learning_portfolio_templates").select("*").or(`organization_id.eq.${x.organization_id},organization_id.is.null`).eq("is_active",!0).order("is_default",{ascending:!1}).order("name");return b?(console.log("Table non trouvée:",b),[]):a||[]},enabled:!!x?.organization_id}),{data:M}=(0,e.useQuery)({queryKey:["sessions-for-portfolio",x?.organization_id],queryFn:async()=>{if(!x?.organization_id)return[];let{data:a,error:b}=await y.from("sessions").select("id, name, start_date, end_date, formations!inner(id, name, organization_id)").eq("formations.organization_id",x.organization_id).in("status",["planned","ongoing","active","in_progress"]).order("start_date",{ascending:!1});return b?[]:a||[]},enabled:!!x?.organization_id}),{data:N,isLoading:O}=(0,e.useQuery)({queryKey:["session-students",E],queryFn:async()=>{if(!E)return[];let{data:a,error:b}=await y.from("enrollments").select("student:students(id, first_name, last_name, email, photo_url)").eq("session_id",E).not("status","in",'("cancelled","rejected","dropped")');if(b)return console.error("Erreur récupération apprenants:",b),[];let c=new Map;return a?.forEach(a=>{a.student&&a.student.id&&c.set(a.student.id,a.student)}),Array.from(c.values())},enabled:!!E}),P=(0,f.useMutation)({mutationFn:async()=>{let a=G.map(a=>({organization_id:x?.organization_id,template_id:C,student_id:a,session_id:E||null,status:"draft",progress_percentage:0,started_at:new Date().toISOString(),content:{}})),{data:b,error:c}=await y.from("learning_portfolios").insert(a).select();if(c)throw c;return b},onSuccess:b=>{z({type:"success",title:"Livrets créés",description:`${b.length} livret(s) ont \xe9t\xe9 cr\xe9\xe9s avec succ\xe8s.`}),1===b.length?a.push(`/dashboard/evaluations/portfolios/${b[0].id}`):a.push("/dashboard/evaluations/portfolios")},onError:a=>{z({type:"error",title:"Erreur",description:a.message||"Impossible de créer les livrets."})}}),Q=N?.filter(a=>`${a.first_name} ${a.last_name}`.toLowerCase().includes(I.toLowerCase())||a.email?.toLowerCase().includes(I.toLowerCase()));return(0,b.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-4xl",children:[(0,b.jsxs)(v.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,b.jsx)(u.default,{href:"/dashboard/evaluations/portfolios",children:(0,b.jsx)(j.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(m.ArrowLeft,{className:"h-5 w-5"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Nouveau livret d'apprentissage"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Créez un livret pour un ou plusieurs apprenants"})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2 mt-6",children:[1,2,3].map(a=>(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)("div",{className:(0,w.cn)("w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-colors",A>=a?"bg-brand-blue text-white":"bg-gray-200 text-gray-600"),children:A>a?(0,b.jsx)(s.CheckCircle2,{className:"h-5 w-5"}):a}),a<3&&(0,b.jsx)("div",{className:(0,w.cn)("w-12 h-1 mx-2 rounded",A>a?"bg-brand-blue":"bg-gray-200")})]},a))}),(0,b.jsxs)("div",{className:"flex gap-16 mt-2 text-sm text-gray-600",children:[(0,b.jsx)("span",{className:A>=1?"text-brand-blue font-medium":"",children:"Modèle"}),(0,b.jsx)("span",{className:A>=2?"text-brand-blue font-medium":"",children:"Session"}),(0,b.jsx)("span",{className:A>=3?"text-brand-blue font-medium":"",children:"Apprenants"})]})]}),1===A&&(0,b.jsx)(v.motion.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},children:(0,b.jsxs)(i.Card,{children:[(0,b.jsxs)(i.CardHeader,{children:[(0,b.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(q.FileText,{className:"h-5 w-5 text-brand-blue"}),"Choisir un modèle de livret"]}),(0,b.jsx)(i.CardDescription,{children:"Sélectionnez le modèle de livret à utiliser pour ce(s) apprenant(s)"})]}),(0,b.jsxs)(i.CardContent,{children:[L?(0,b.jsx)("div",{className:"flex justify-center py-8",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):K?.length===0?(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)(q.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"Aucun modèle de livret disponible"}),(0,b.jsx)(u.default,{href:"/dashboard/evaluations/portfolios/templates/new",children:(0,b.jsxs)(j.Button,{children:[(0,b.jsx)(n.Plus,{className:"h-4 w-4 mr-2"}),"Créer un modèle"]})})]}):(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:K?.map(a=>(0,b.jsx)("div",{onClick:()=>D(a.id),className:(0,w.cn)("p-4 border-2 rounded-lg cursor-pointer transition-all",C===a.id?"border-brand-blue bg-brand-blue/5":"border-gray-200 hover:border-gray-300"),children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center",style:{backgroundColor:`${a.primary_color}20`},children:(0,b.jsx)(q.FileText,{className:"h-5 w-5",style:{color:a.primary_color}})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"font-medium text-gray-900",children:a.name}),a.description&&(0,b.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:a.description}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[a.template_structure?.length||0," sections"]})]}),C===a.id&&(0,b.jsx)(s.CheckCircle2,{className:"h-5 w-5 text-brand-blue"})]})},a.id))}),(0,b.jsx)("div",{className:"flex justify-end mt-6",children:(0,b.jsx)(j.Button,{onClick:()=>B(2),disabled:!C,children:"Continuer"})})]})]})}),2===A&&(0,b.jsx)(v.motion.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},children:(0,b.jsxs)(i.Card,{children:[(0,b.jsxs)(i.CardHeader,{children:[(0,b.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(r.Calendar,{className:"h-5 w-5 text-brand-blue"}),"Sélectionner une session (optionnel)"]}),(0,b.jsx)(i.CardDescription,{children:"Associez le livret à une session de formation pour faciliter le suivi"})]}),(0,b.jsxs)(i.CardContent,{children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{onClick:()=>F(""),className:(0,w.cn)("p-4 border-2 rounded-lg cursor-pointer transition-all",E?"border-gray-200 hover:border-gray-300":"border-brand-blue bg-brand-blue/5"),children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium text-gray-900",children:"Sans session"}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Créer un livret indépendant"})]}),!E&&(0,b.jsx)(s.CheckCircle2,{className:"h-5 w-5 text-brand-blue"})]})}),M?.map(a=>(0,b.jsx)("div",{onClick:()=>F(a.id),className:(0,w.cn)("p-4 border-2 rounded-lg cursor-pointer transition-all",E===a.id?"border-brand-blue bg-brand-blue/5":"border-gray-200 hover:border-gray-300"),children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-medium text-gray-900",children:a.name}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.formations?.name})]}),E===a.id&&(0,b.jsx)(s.CheckCircle2,{className:"h-5 w-5 text-brand-blue"})]})},a.id))]}),(0,b.jsxs)("div",{className:"flex justify-between mt-6",children:[(0,b.jsx)(j.Button,{variant:"outline",onClick:()=>B(1),children:"Retour"}),(0,b.jsx)(j.Button,{onClick:()=>B(3),children:"Continuer"})]})]})]})}),3===A&&(0,b.jsx)(v.motion.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},children:(0,b.jsxs)(i.Card,{children:[(0,b.jsxs)(i.CardHeader,{children:[(0,b.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(p.Users,{className:"h-5 w-5 text-brand-blue"}),"Sélectionner les apprenants"]}),(0,b.jsx)(i.CardDescription,{children:E?"Sélectionnez les apprenants de la session":"Recherchez et sélectionnez les apprenants"})]}),(0,b.jsxs)(i.CardContent,{children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(o.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,b.jsx)(k.Input,{placeholder:"Rechercher un apprenant...",value:I,onChange:a=>J(a.target.value),className:"pl-10"})]}),N&&N.length>0&&(0,b.jsx)(j.Button,{variant:"outline",onClick:()=>{N&&H(N.map(a=>a.id))},children:"Tout sélectionner"})]}),O?(0,b.jsx)("div",{className:"flex justify-center py-8",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):E?Q?.length===0?(0,b.jsxs)("div",{className:"text-center py-8 text-gray-600",children:[(0,b.jsx)(p.Users,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("p",{children:"Aucun apprenant trouvé dans cette session"})]}):(0,b.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:Q?.map(a=>(0,b.jsxs)("div",{onClick:()=>{var b;return b=a.id,void H(a=>a.includes(b)?a.filter(a=>a!==b):[...a,b])},className:(0,w.cn)("p-3 border rounded-lg cursor-pointer transition-all flex items-center gap-3",G.includes(a.id)?"border-brand-blue bg-brand-blue/5":"border-gray-200 hover:border-gray-300"),children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center text-gray-600 font-medium",children:a.photo_url?(0,b.jsx)("img",{src:a.photo_url,alt:"",className:"w-10 h-10 rounded-full object-cover"}):`${a.first_name?.[0]}${a.last_name?.[0]}`}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("p",{className:"font-medium text-gray-900",children:[a.first_name," ",a.last_name]}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:a.email})]}),G.includes(a.id)&&(0,b.jsx)(s.CheckCircle2,{className:"h-5 w-5 text-brand-blue"})]},a.id))}):(0,b.jsxs)("div",{className:"text-center py-8 text-gray-600",children:[(0,b.jsx)(t.BookOpen,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("p",{children:"Sélectionnez une session à l'étape précédente pour voir les apprenants"}),(0,b.jsx)("p",{className:"text-sm mt-2",children:"ou créez un livret sans session"})]}),G.length>0&&(0,b.jsx)("div",{className:"mt-4 p-3 bg-brand-blue/5 rounded-lg",children:(0,b.jsxs)("p",{className:"text-sm text-brand-blue font-medium",children:[G.length," apprenant(s) sélectionné(s)"]})}),(0,b.jsxs)("div",{className:"flex justify-between mt-6",children:[(0,b.jsx)(j.Button,{variant:"outline",onClick:()=>B(2),children:"Retour"}),(0,b.jsx)(j.Button,{onClick:()=>{C?0===G.length?z({type:"error",title:"Erreur",description:"Sélectionnez au moins un apprenant."}):P.mutate():z({type:"error",title:"Erreur",description:"Sélectionnez un modèle de livret."})},disabled:0===G.length||P.isPending,children:P.isPending?"Création...":`Cr\xe9er ${G.length} livret(s)`})]})]})]})})]})}a.s(["default",()=>x])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_evaluations_portfolios_new_page_tsx_366e82f4._.js.map