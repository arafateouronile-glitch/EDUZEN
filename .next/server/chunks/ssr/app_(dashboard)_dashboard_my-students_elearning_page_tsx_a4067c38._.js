module.exports=[7477,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(913216),f=a.i(269240),g=a.i(703130),h=a.i(340695),i=a.i(254161),j=a.i(602150),k=a.i(205522),l=a.i(887682),m=a.i(469769),n=a.i(660246),o=a.i(953722),p=a.i(724669),q=a.i(495756),r=a.i(71277),s=a.i(54018),t=a.i(587532),u=a.i(400210),v=a.i(405784),w=a.i(767552),x=a.i(238246);a.i(460355);var y=a.i(346271),z=a.i(497895);function A(){let{user:a}=(0,e.useAuth)(),A=(0,f.createClient)(),[B,C]=(0,c.useState)(""),[D,E]=(0,c.useState)("all"),[F,G]=(0,c.useState)("all"),[H,I]=(0,c.useState)(new Set),{data:J,isLoading:K}=(0,d.useQuery)({queryKey:["teacher-sessions",a?.id],queryFn:async()=>{if(!a?.id)return[];try{let{data:b,error:c}=await A.from("sessions").select(`
            id, name, start_date, end_date, status,
            session_trainers!inner(user_id)
          `).eq("session_trainers.user_id",a.id).order("start_date",{ascending:!1});if(c){if(c.message?.includes("relationship")||c.message?.includes("schema cache")){let{data:b,error:c}=await A.from("sessions").select("id, name, start_date, end_date, status").eq("organization_id",a.organization_id||"").order("start_date",{ascending:!1});if(c)throw c;return b||[]}throw c}return b||[]}catch(a){return console.warn("Error fetching teacher sessions:",a),[]}},enabled:!!a?.id}),{data:L}=(0,d.useQuery)({queryKey:["teacher-session-courses",J?.map(a=>a.id)],queryFn:async()=>{if(!J?.length)return[];let a=J.map(a=>a.id);try{let{data:b,error:c}=await A.from("session_courses").select(`
            *,
            course:courses(id, title, slug, difficulty_level),
            session:sessions(id, name)
          `).in("session_id",a);if(c){if("PGRST116"===c.code||"42P01"===c.code||c.message?.includes("does not exist"))return[];throw c}return b||[]}catch(a){return console.warn("Error fetching session courses:",a),[]}},enabled:!!J?.length}),{data:M,isLoading:N}=(0,d.useQuery)({queryKey:["teacher-student-progress",(L||[]).map(a=>a.id)],queryFn:async()=>{if(!L?.length||!J?.length)return[];let a=J.map(a=>a.id),b=[...new Set((L||[]).map(a=>a.course_id))];try{let{data:c,error:d}=await A.from("enrollments").select(`
            student_id, session_id,
            students(id, first_name, last_name, email)
          `).in("session_id",a);if(d)throw d;let{data:e}=await A.from("lessons").select("id, course_id").in("course_id",b),f=[...new Set((c||[]).map(a=>a.student_id))],{data:g}=await A.from("lesson_progress").select("*, lessons(course_id)").in("student_id",f),{data:h}=await A.from("quiz_attempts").select("*, quizzes(lesson_id, lessons(course_id))").in("student_id",f).eq("is_completed",!0),i=[];for(let a of c||[]){let b=a.students;if(b)for(let c of(L||[]).filter(b=>b.session_id===a.session_id)){let d=c.course_id,f=(e||[]).filter(a=>a.course_id===d).length,j=(g||[]).filter(b=>b.student_id===a.student_id&&b.lessons?.course_id===d),k=j.filter(a=>a.is_completed).length,l=f>0?Math.round(k/f*100):0,m=(h||[]).filter(b=>b.student_id===a.student_id&&b.quizzes?.lessons?.course_id===d),n=m.length>0?Math.round(m.reduce((a,b)=>a+(b.score||0),0)/m.length):null,o=j.sort((a,b)=>new Date(b.updated_at||b.created_at).getTime()-new Date(a.updated_at||a.created_at).getTime())[0],p="not_started";k>0&&k>=f?p="completed":k>0&&(p="in_progress"),i.push({student_id:a.student_id,student_name:`${b.first_name} ${b.last_name}`,student_email:b.email||"",course_id:d,course_title:c.course?.title||"Cours",course_slug:c.course?.slug||"",session_id:a.session_id,session_name:c.session?.name||"Session",progress:l,completed_lessons:k,total_lessons:f,quiz_score:n,last_activity:o?.updated_at||o?.created_at||null,status:p,is_required:c.is_required,due_date:c.due_date})}}return i}catch(a){return console.warn("Error fetching student progress:",a),[]}},enabled:!!L?.length}),O=(M||[]).filter(a=>{let b=a.student_name.toLowerCase().includes(B.toLowerCase())||a.student_email.toLowerCase().includes(B.toLowerCase()),c="all"===D||a.session_id===D,d="all"===F||a.course_id===F;return b&&c&&d}),P=O.reduce((a,b)=>(a[b.student_id]||(a[b.student_id]={student_id:b.student_id,student_name:b.student_name,student_email:b.student_email,courses:[]}),a[b.student_id].courses.push(b),a),{}),Q={totalStudents:Object.keys(P).length,totalCourses:[...new Set(O.map(a=>a.course_id))].length,avgProgress:O.length>0?Math.round(O.reduce((a,b)=>a+b.progress,0)/O.length):0,completed:O.filter(a=>"completed"===a.status).length,inProgress:O.filter(a=>"in_progress"===a.status).length,notStarted:O.filter(a=>"not_started"===a.status).length},R=[...new Map((L||[]).map(a=>[a.session_id,{id:a.session_id,name:a.session?.name}])).values()],S=[...new Map((L||[]).map(a=>[a.course_id,{id:a.course_id,title:a.course?.title}])).values()];return(0,b.jsxs)(y.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-6 pb-8",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(x.default,{href:"/dashboard/my-students",children:(0,b.jsx)(h.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(u.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-purple-100 rounded-xl",children:(0,b.jsx)(m.GraduationCap,{className:"h-6 w-6 text-purple-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Suivi E-Learning"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Progression des apprenants dans vos sessions"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:[(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Apprenants"}),(0,b.jsx)("p",{className:"text-xl font-bold",children:Q.totalStudents})]}),(0,b.jsx)(n.Users,{className:"h-6 w-6 text-blue-600 opacity-50"})]})})}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Cours"}),(0,b.jsx)("p",{className:"text-xl font-bold",children:Q.totalCourses})]}),(0,b.jsx)(o.BookOpen,{className:"h-6 w-6 text-purple-600 opacity-50"})]})})}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Progression"}),(0,b.jsxs)("p",{className:"text-xl font-bold",children:[Q.avgProgress,"%"]})]}),(0,b.jsx)(p.TrendingUp,{className:"h-6 w-6 text-indigo-600 opacity-50"})]})})}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Terminés"}),(0,b.jsx)("p",{className:"text-xl font-bold text-green-600",children:Q.completed})]}),(0,b.jsx)(q.CheckCircle,{className:"h-6 w-6 text-green-600 opacity-50"})]})})}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"En cours"}),(0,b.jsx)("p",{className:"text-xl font-bold text-yellow-600",children:Q.inProgress})]}),(0,b.jsx)(r.PlayCircle,{className:"h-6 w-6 text-yellow-600 opacity-50"})]})})}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Non commencés"}),(0,b.jsx)("p",{className:"text-xl font-bold text-gray-400",children:Q.notStarted})]}),(0,b.jsx)(s.XCircle,{className:"h-6 w-6 text-gray-400 opacity-50"})]})})})]}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(t.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(k.Input,{placeholder:"Rechercher un apprenant...",value:B,onChange:a=>C(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(l.Select,{value:D,onValueChange:E,children:[(0,b.jsx)(l.SelectTrigger,{className:"w-full md:w-[200px]",children:(0,b.jsx)(l.SelectValue,{placeholder:"Toutes les sessions"})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"all",children:"Toutes les sessions"}),R.map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)(l.Select,{value:F,onValueChange:G,children:[(0,b.jsx)(l.SelectTrigger,{className:"w-full md:w-[200px]",children:(0,b.jsx)(l.SelectValue,{placeholder:"Tous les cours"})}),(0,b.jsxs)(l.SelectContent,{children:[(0,b.jsx)(l.SelectItem,{value:"all",children:"Tous les cours"}),S.map(a=>(0,b.jsx)(l.SelectItem,{value:a.id,children:a.title},a.id))]})]})]})})}),K||N?(0,b.jsx)("div",{className:"space-y-4",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:"h-24 bg-gray-100 rounded-xl animate-pulse"},a))}):0===Object.keys(P).length?(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"py-12",children:(0,b.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,b.jsx)(m.GraduationCap,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{className:"text-lg font-medium mb-2",children:"Aucune donnée de progression"}),(0,b.jsx)("p",{className:"text-sm",children:L?.length===0?"Aucun cours e-learning n'est assigné à vos sessions.":"Aucun apprenant ne correspond à vos critères de recherche."})]})})}):(0,b.jsx)("div",{className:"space-y-4",children:Object.values(P).map(a=>{let c=H.has(a.student_id),d=Math.round(a.courses.reduce((a,b)=>a+b.progress,0)/a.courses.length),e=a.courses.filter(a=>"completed"===a.status).length;return(0,b.jsx)(g.Card,{className:"overflow-hidden",children:(0,b.jsxs)(g.CardContent,{className:"p-0",children:[(0,b.jsxs)("button",{onClick:()=>{var b;return b=a.student_id,void I(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c})},className:"w-full p-4 flex items-center justify-between hover:bg-gray-50 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:(0,b.jsx)(n.Users,{className:"h-5 w-5 text-purple-600"})}),(0,b.jsxs)("div",{className:"text-left",children:[(0,b.jsx)("h3",{className:"font-semibold",children:a.student_name}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.student_email})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-6 mr-4",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Cours"}),(0,b.jsx)("p",{className:"text-sm font-semibold",children:a.courses.length})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Terminés"}),(0,b.jsxs)("p",{className:"text-sm font-semibold text-green-600",children:[e,"/",a.courses.length]})]}),(0,b.jsxs)("div",{className:"w-24",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground text-center mb-1",children:"Progression"}),(0,b.jsx)(j.Progress,{value:d,className:"h-2"}),(0,b.jsxs)("p",{className:"text-xs text-center mt-1 font-semibold",children:[d,"%"]})]})]}),c?(0,b.jsx)(w.ChevronUp,{className:"h-5 w-5 text-muted-foreground"}):(0,b.jsx)(v.ChevronDown,{className:"h-5 w-5 text-muted-foreground"})]}),c&&(0,b.jsx)("div",{className:"border-t bg-gray-50/50 p-4",children:(0,b.jsx)("div",{className:"space-y-3",children:a.courses.map(c=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,b.jsx)("div",{className:(0,z.cn)("w-8 h-8 rounded-full flex items-center justify-center","completed"===c.status?"bg-green-100":"in_progress"===c.status?"bg-yellow-100":"bg-gray-100"),children:"completed"===c.status?(0,b.jsx)(q.CheckCircle,{className:"h-4 w-4 text-green-600"}):"in_progress"===c.status?(0,b.jsx)(r.PlayCircle,{className:"h-4 w-4 text-yellow-600"}):(0,b.jsx)(s.XCircle,{className:"h-4 w-4 text-gray-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("p",{className:"font-medium text-sm",children:c.course_title}),c.is_required&&(0,b.jsx)(i.Badge,{variant:"secondary",className:"text-xs",children:"Obligatoire"})]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[c.session_name,c.last_activity&&` • Derni\xe8re activit\xe9: ${(0,z.formatDate)(c.last_activity)}`]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Leçons"}),(0,b.jsxs)("p",{className:"text-sm font-semibold",children:[c.completed_lessons,"/",c.total_lessons]})]}),null!==c.quiz_score&&(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Quiz"}),(0,b.jsxs)("p",{className:"text-sm font-semibold",children:[c.quiz_score,"%"]})]}),c.due_date&&(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Échéance"}),(0,b.jsx)("p",{className:(0,z.cn)("text-xs font-semibold",new Date(c.due_date)<new Date&&"completed"!==c.status?"text-red-600":"text-gray-600"),children:(0,z.formatDate)(c.due_date)})]}),(0,b.jsxs)("div",{className:"w-24",children:[(0,b.jsx)(j.Progress,{value:c.progress,className:"h-2"}),(0,b.jsxs)("p",{className:"text-xs text-center mt-1",children:[c.progress,"%"]})]}),(0,b.jsx)(i.Badge,{variant:"completed"===c.status?"default":"in_progress"===c.status?"secondary":"outline",children:"completed"===c.status?"Terminé":"in_progress"===c.status?"En cours":"Non commencé"})]})]},`${a.student_id}-${c.course_id}`))})})]})},a.student_id)})})]})}a.s(["default",()=>A])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_my-students_elearning_page_tsx_a4067c38._.js.map