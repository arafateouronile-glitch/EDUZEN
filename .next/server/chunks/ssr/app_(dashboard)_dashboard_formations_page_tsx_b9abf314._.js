module.exports=[772364,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(913216),f=a.i(337130),g=a.i(426099),h=a.i(269240),i=a.i(340695),j=a.i(219897),k=a.i(915618),l=a.i(587532),m=a.i(987105),n=a.i(941675),o=a.i(660246),p=a.i(790166),q=a.i(724669),r=a.i(495756),s=a.i(54018),t=a.i(290669),u=a.i(172162),v=a.i(922520),w=a.i(641710),x=a.i(238246),y=a.i(497895);a.i(460355);var z=a.i(346271),A=a.i(262036),B=a.i(547615),C=a.i(493610),D=a.i(491829);function E(){return(0,b.jsx)(D.RoleGuard,{allowedRoles:D.FORMATION_MANAGEMENT_ROLES,children:(0,b.jsx)(F,{})})}function F(){let{user:a}=(0,e.useAuth)(),D=(0,h.createClient)(),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(!0),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)(!1),{data:M}=(0,d.useQuery)({queryKey:["programs",a?.organization_id],queryFn:async()=>a?.organization_id?g.programService.getAllPrograms(a.organization_id,{isActive:!0}):[],enabled:!!a?.organization_id}),{data:N,isLoading:O}=(0,d.useQuery)({queryKey:["formations",a?.organization_id,E,G,I],queryFn:async()=>a?.organization_id?f.formationService.getAllFormations(a.organization_id,{programId:I||void 0,search:E,isActive:G||void 0}):[],enabled:!!a?.organization_id}),{data:P}=(0,d.useQuery)({queryKey:["formation-stats",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)return null;let{data:b,error:c}=await D.from("formations").select("is_active, created_at, program_id").eq("organization_id",a.organization_id);if(c)throw c;let d=b||[],e=d.length,f=d.filter(a=>a.is_active).length,g=d.filter(a=>!a.is_active).length,h=0,i=d.map(a=>a.id).filter(a=>!!a);if(i&&i.length>0){let{count:a}=await D.from("sessions").select("*",{count:"exact",head:!0}).in("formation_id",i);h=a||0}let j=0;if(i&&i.length>0){let{data:a,error:b}=await D.from("sessions").select("id").in("formation_id",i);if(b)throw b;let c=a?.map(a=>a.id).filter(a=>!!a)||[];if(c&&c.length>0){let{count:a}=await D.from("enrollments").select("*",{count:"exact",head:!0}).in("session_id",c);j=a||0}}let k=d.filter(a=>{if(!a.created_at)return!1;let b=new Date(a.created_at),c=new Date;return b.getMonth()===c.getMonth()&&b.getFullYear()===c.getFullYear()}).length,l=[{name:"Actives",value:f,color:"#335ACF"},{name:"Inactives",value:g,color:"#6B7280"}].filter(a=>a.value>0),m={};return d.forEach(a=>{if(a.created_at){let b=new Date(a.created_at),c=`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}`;m[c]=(m[c]||0)+1}}),{total:e,active:f,inactive:g,totalSessions:h,totalEnrollments:j,thisMonthCount:k,statusData:l,monthlyData:Object.entries(m).sort(([a],[b])=>a.localeCompare(b)).slice(-6).map(([a,b])=>({month:new Date(a+"-01").toLocaleDateString("fr-FR",{month:"short",year:"numeric"}),formations:b}))}},enabled:!!a?.organization_id}),Q={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};return(0,b.jsxs)(z.motion.div,{className:"space-y-8 pb-8 max-w-[1600px] mx-auto",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",children:[(0,b.jsxs)(z.motion.div,{variants:Q,className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-3",children:[(0,b.jsx)(z.motion.div,{className:"p-3 bg-gradient-to-br from-brand-blue to-brand-cyan rounded-2xl shadow-lg shadow-brand-blue/20",whileHover:{scale:1.1,rotate:5},transition:{type:"spring",stiffness:400,damping:10},children:(0,b.jsx)(m.BookMarked,{className:"h-8 w-8 text-white"})}),(0,b.jsx)("h1",{className:"text-4xl md:text-6xl font-display font-bold text-gray-900 tracking-tighter leading-none",children:"Formations"}),N&&N.length>0&&(0,b.jsx)(z.motion.span,{className:"px-3 py-1.5 bg-brand-blue-ghost text-brand-blue rounded-full text-sm font-bold flex items-center gap-2 shadow-sm",whileHover:{scale:1.1},transition:{type:"spring",stiffness:400,damping:10},children:N.length})]}),(0,b.jsx)("p",{className:"text-gray-600 font-medium text-lg tracking-tight",children:"Gérez vos formations et leurs sessions associées"})]}),(0,b.jsx)(z.motion.div,{whileHover:{scale:1.05,y:-3},whileTap:{scale:.98},children:(0,b.jsx)(x.default,{href:"/dashboard/formations/new",children:(0,b.jsxs)(i.Button,{className:"bg-gradient-to-br from-brand-blue to-brand-cyan text-white hover:from-brand-blue-dark hover:to-brand-cyan-dark shadow-xl shadow-brand-blue/20 hover:shadow-2xl hover:shadow-brand-cyan/30 transition-all duration-500 font-semibold tracking-tight px-6 py-6 text-base",children:[(0,b.jsx)(k.Plus,{className:"h-5 w-5 mr-2"}),"Nouvelle formation"]})})})]}),P&&(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[{title:"Total formations",value:P.total,icon:m.BookMarked,iconBg:"bg-gradient-to-br from-brand-blue to-brand-blue-dark",cardBg:"bg-gradient-to-br from-brand-blue/5 via-brand-blue/10 to-brand-cyan/5",borderColor:"border-brand-blue/20",glowColor:"rgba(39, 68, 114, 0.15)"},{title:"Actives",value:P.active,icon:r.CheckCircle,iconBg:"bg-gradient-to-br from-emerald-500 to-emerald-600",cardBg:"bg-gradient-to-br from-emerald-50 via-emerald-100/50 to-teal-50",borderColor:"border-emerald-200",glowColor:"rgba(16, 185, 129, 0.15)",highlight:P.active>0},{title:"Inactives",value:P.inactive,icon:s.XCircle,iconBg:"bg-gradient-to-br from-gray-400 to-gray-500",cardBg:"bg-gradient-to-br from-gray-50 via-gray-100/50 to-gray-50",borderColor:"border-gray-200",glowColor:"rgba(107, 114, 128, 0.1)"},{title:"Sessions planifiées",value:P.totalSessions,icon:n.Calendar,iconBg:"bg-gradient-to-br from-purple-500 to-purple-600",cardBg:"bg-gradient-to-br from-purple-50 via-purple-100/50 to-pink-50",borderColor:"border-purple-200",glowColor:"rgba(168, 85, 247, 0.15)"},{title:"Inscriptions",value:P.totalEnrollments,icon:o.Users,iconBg:"bg-gradient-to-br from-brand-cyan to-brand-cyan-dark",cardBg:"bg-gradient-to-br from-brand-cyan/5 via-brand-cyan/10 to-brand-blue/5",borderColor:"border-brand-cyan/20",glowColor:"rgba(52, 185, 238, 0.15)"},{title:"Créées ce mois",value:P.thisMonthCount,icon:w.Clock,iconBg:"bg-gradient-to-br from-brand-blue-light to-brand-cyan",cardBg:"bg-gradient-to-br from-brand-blue-pale/30 via-brand-blue-pale/50 to-brand-cyan-pale/30",borderColor:"border-brand-blue-light/20",glowColor:"rgba(75, 116, 157, 0.15)"}].map((a,c)=>(0,b.jsx)(z.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.05*c,ease:"easeOut"},whileHover:{y:-6,scale:1.02},className:"group relative",children:(0,b.jsxs)("div",{className:(0,y.cn)("relative overflow-hidden rounded-2xl p-6 border-2 transition-all duration-500 shadow-lg hover:shadow-2xl",a.cardBg,a.borderColor,a.highlight&&"ring-2 ring-emerald-500/20 animate-pulse-premium"),style:{boxShadow:`0 10px 40px -10px ${a.glowColor}, 0 0 0 1px rgba(255, 255, 255, 0.1)`},children:[(0,b.jsx)(z.motion.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent",initial:{x:"-100%"},whileHover:{x:"100%"},transition:{duration:.6,ease:"easeInOut"}}),(0,b.jsxs)("div",{className:"relative z-10",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,b.jsx)(z.motion.div,{className:(0,y.cn)("p-3.5 rounded-2xl shadow-xl",a.iconBg),whileHover:{rotate:12,scale:1.15},transition:{type:"spring",stiffness:500,damping:15},children:(0,b.jsx)(a.icon,{className:"h-6 w-6 text-white"})}),(0,b.jsxs)(z.motion.div,{className:"text-right",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.05*c+.2,duration:.5},children:[(0,b.jsx)("div",{className:"text-4xl font-display font-bold tracking-tighter text-gray-900 leading-none mb-1",children:a.value}),(0,b.jsx)("p",{className:"text-xs font-bold text-gray-600 uppercase tracking-widest",children:a.title})]})]}),(0,b.jsx)(z.motion.div,{className:"h-1.5 rounded-full mt-4",style:{background:a.iconBg.replace("bg-gradient-to-br","linear-gradient(to right,")},initial:{scaleX:0},animate:{scaleX:1},transition:{delay:.05*c+.3,duration:.6,ease:[.16,1,.3,1]}})]}),(0,b.jsx)("div",{className:"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500",style:{background:`radial-gradient(circle at 50% 50%, ${a.glowColor} 0%, transparent 70%)`}})]})},a.title))}),P&&(P.statusData.length>0||P.monthlyData.length>0)&&(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[P.statusData.length>0&&(0,b.jsx)(z.motion.div,{variants:Q,className:"h-full",children:(0,b.jsxs)(j.GlassCard,{variant:"default",className:"p-6 h-full",children:[(0,b.jsx)("div",{className:"mb-6 flex items-center justify-between",children:(0,b.jsxs)("h3",{className:"font-bold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(t.Activity,{className:"h-5 w-5 text-brand-blue"}),"Répartition par statut"]})}),(0,b.jsx)("div",{className:"h-[300px]",children:(0,b.jsx)(B.PremiumPieChart,{data:P.statusData,colors:P.statusData.map(a=>a.color),variant:"default",className:"h-full !p-0 !bg-transparent !border-none !shadow-none",innerRadius:70})})]})}),P.monthlyData.length>0&&(0,b.jsx)(z.motion.div,{variants:Q,className:"h-full",children:(0,b.jsxs)(j.GlassCard,{variant:"default",className:"p-6 h-full",children:[(0,b.jsx)("div",{className:"mb-6 flex items-center justify-between",children:(0,b.jsxs)("h3",{className:"font-bold text-gray-900 flex items-center gap-2",children:[(0,b.jsx)(q.TrendingUp,{className:"h-5 w-5 text-brand-cyan"}),"Évolution des formations"]})}),(0,b.jsx)("div",{className:"h-[300px]",children:(0,b.jsx)(C.PremiumBarChart,{data:P.monthlyData,dataKey:"formations",xAxisKey:"month",color:"#8B5CF6",variant:"default",className:"h-full !p-0 !bg-transparent !border-none !shadow-none"})})]})})]}),(0,b.jsx)(z.motion.div,{variants:Q,children:(0,b.jsxs)(j.GlassCard,{variant:"premium",className:"p-4 border-2 border-transparent hover:border-brand-blue/10 transition-all duration-500",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row gap-3",children:[(0,b.jsxs)("div",{className:"relative flex-1 group",children:[(0,b.jsx)(l.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-brand-blue transition-colors"}),(0,b.jsx)("input",{type:"text",placeholder:"Rechercher une formation...",value:E,onChange:a=>F(a.target.value),className:"w-full pl-12 pr-4 py-3 rounded-xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-brand-blue/30 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm font-medium tracking-tight shadow-sm"})]}),(0,b.jsx)(z.motion.div,{whileHover:{scale:1.02},whileTap:{scale:.98},children:(0,b.jsxs)(i.Button,{variant:"ghost",onClick:()=>L(!K),className:(0,y.cn)("gap-2 transition-all px-6 py-3 rounded-xl font-semibold tracking-tight shadow-sm",K?"bg-brand-blue text-white hover:bg-brand-blue-dark":"bg-gray-100 text-gray-700 hover:bg-gray-200"),children:[(0,b.jsx)(u.SlidersHorizontal,{className:"h-4 w-4"}),"Filtres",(I||!G)&&(0,b.jsx)(z.motion.span,{className:"w-5 h-5 bg-brand-cyan text-white text-[10px] flex items-center justify-center rounded-full ml-1 font-bold shadow-md",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:15},children:"!"})]})})]}),(0,b.jsx)(A.AnimatePresence,{children:K&&(0,b.jsx)(z.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:(0,b.jsxs)("div",{className:"p-4 grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-100 mt-2",children:[(0,b.jsx)("div",{className:"flex items-center gap-3",children:(0,b.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer group",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("input",{type:"checkbox",checked:G,onChange:a=>H(a.target.checked),className:"sr-only peer"}),(0,b.jsx)("div",{className:"w-10 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-brand-blue/20 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-brand-blue"})]}),(0,b.jsx)("span",{className:"text-sm font-medium text-gray-600 group-hover:text-gray-900 transition-colors",children:"Actives uniquement"})]})}),M&&M.length>0&&(0,b.jsxs)("div",{className:"space-y-1.5",children:[(0,b.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Programme"}),(0,b.jsxs)("select",{value:I,onChange:a=>J(a.target.value),className:"w-full px-3 py-2 rounded-lg bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-2 focus:ring-brand-blue/10 outline-none text-sm transition-all",children:[(0,b.jsx)("option",{value:"",children:"Tous les programmes"}),M?.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]})]})})})]})}),(0,b.jsx)(z.motion.div,{variants:Q,children:O?(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((a,c)=>(0,b.jsx)("div",{className:"h-64 bg-gray-100 rounded-2xl animate-pulse"},c))}):N&&N.length>0?(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:(0,b.jsx)(A.AnimatePresence,{mode:"popLayout",children:N?.map((a,c)=>(0,b.jsx)(z.motion.div,{layout:!0,initial:{opacity:0,scale:.95,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:-20},transition:{delay:.05*c,duration:.5,ease:"easeOut"},whileHover:{y:-8,scale:1.02},children:(0,b.jsx)(x.default,{href:`/dashboard/formations/${a.id}`,children:(0,b.jsxs)(j.GlassCard,{variant:"premium",hoverable:!0,className:"h-full p-0 group cursor-pointer flex flex-col overflow-hidden border-2 border-transparent hover:border-brand-blue/20 transition-all duration-500 shadow-lg hover:shadow-2xl",children:[(0,b.jsxs)("div",{className:"p-6 flex-1",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,b.jsx)(z.motion.div,{whileHover:{scale:1.15,rotate:8},transition:{type:"spring",stiffness:500,damping:15},className:(0,y.cn)("h-12 w-12 rounded-2xl flex items-center justify-center shadow-lg",a.is_active?"bg-gradient-to-br from-brand-blue to-brand-cyan text-white shadow-brand-blue/20":"bg-gray-100 text-gray-400"),children:(0,b.jsx)(m.BookMarked,{className:"h-6 w-6"})}),(0,b.jsx)(z.motion.span,{className:(0,y.cn)("px-3 py-1.5 rounded-xl text-xs font-bold border-2 shadow-sm uppercase tracking-wide",a.is_active?"bg-emerald-50 text-emerald-700 border-emerald-200":"bg-gray-50 text-gray-600 border-gray-200"),whileHover:{scale:1.05},transition:{type:"spring",stiffness:400,damping:10},children:a.is_active?"Active":"Inactive"})]}),(0,b.jsx)("h3",{className:"text-xl font-display font-bold text-gray-900 mb-1 line-clamp-1 group-hover:text-brand-blue transition-colors tracking-tight leading-tight",children:a.name}),a.programs&&(0,b.jsx)("div",{className:"mb-3",children:(0,b.jsx)("span",{className:"text-xs font-bold bg-brand-blue-pale/50 text-brand-blue px-2.5 py-1 rounded-lg border border-brand-blue/20 tracking-tight",children:a.programs.name})}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2.5 text-sm text-gray-600 mb-4",children:[a.duration_hours&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-lg group-hover:bg-gray-100 transition-colors",children:[(0,b.jsx)("div",{className:"p-1 bg-gray-100 rounded-md group-hover:bg-brand-blue-ghost transition-colors",children:(0,b.jsx)(n.Calendar,{className:"h-3.5 w-3.5 text-gray-500 group-hover:text-brand-blue transition-colors"})}),(0,b.jsxs)("span",{className:"font-medium tracking-tight",children:[a.duration_hours,"h"]})]}),a.price&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-lg group-hover:bg-gray-100 transition-colors",children:[(0,b.jsx)("div",{className:"p-1 bg-gray-100 rounded-md group-hover:bg-emerald-50 transition-colors",children:(0,b.jsx)(p.DollarSign,{className:"h-3.5 w-3.5 text-gray-500 group-hover:text-emerald-600 transition-colors"})}),(0,b.jsx)("span",{className:"font-medium tracking-tight",children:(0,y.formatCurrency)(Number(a.price),a.currency)})]}),a.capacity_max&&(0,b.jsxs)("div",{className:"flex items-center gap-2 bg-gray-50 px-3 py-1.5 rounded-lg group-hover:bg-gray-100 transition-colors",children:[(0,b.jsx)("div",{className:"p-1 bg-gray-100 rounded-md group-hover:bg-brand-cyan-ghost transition-colors",children:(0,b.jsx)(o.Users,{className:"h-3.5 w-3.5 text-gray-500 group-hover:text-brand-cyan transition-colors"})}),(0,b.jsx)("span",{className:"font-medium tracking-tight",children:a.capacity_max})]})]}),a.description&&(0,b.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2 font-medium tracking-tight leading-relaxed",children:a.description})]}),(0,b.jsxs)(z.motion.div,{className:"px-6 py-4 bg-gray-50/50 border-t-2 border-gray-100 group-hover:border-brand-blue/20 flex items-center justify-between transition-colors",whileHover:{x:2},transition:{type:"spring",stiffness:400,damping:20},children:[(0,b.jsx)("span",{className:"text-sm font-bold text-gray-500 group-hover:text-brand-blue transition-colors tracking-tight",children:"Gérer la formation"}),(0,b.jsx)(z.motion.div,{whileHover:{scale:1.2,rotate:5},transition:{type:"spring",stiffness:500,damping:15},children:(0,b.jsx)(v.ArrowUpRight,{className:"h-5 w-5 text-gray-400 group-hover:text-brand-cyan transition-colors"})})]})]})})},a.id))})}):(0,b.jsx)(z.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:[.16,1,.3,1]},children:(0,b.jsxs)(j.GlassCard,{variant:"premium",className:"p-16 text-center border-2 border-dashed border-gray-200",children:[(0,b.jsx)(z.motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.2,duration:.5,ease:[.16,1,.3,1]},className:"w-20 h-20 bg-gradient-to-br from-brand-blue/10 to-brand-cyan/10 rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-lg",children:(0,b.jsx)(m.BookMarked,{className:"h-10 w-10 text-brand-blue"})}),(0,b.jsx)(z.motion.h3,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3,duration:.5},className:"text-2xl font-display font-bold text-gray-900 mb-2 tracking-tight",children:"Aucune formation trouvée"}),(0,b.jsx)(z.motion.p,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.4,duration:.5},className:"text-gray-600 mb-8 font-medium tracking-tight",children:E||I||!G?"Essayez de modifier vos filtres de recherche.":"Commencez par créer votre première formation."}),!E&&!I&&G&&(0,b.jsx)(z.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.5,duration:.5},whileHover:{scale:1.05,y:-3},whileTap:{scale:.98},children:(0,b.jsx)(x.default,{href:"/dashboard/formations/new",children:(0,b.jsxs)(i.Button,{className:"bg-gradient-to-br from-brand-blue to-brand-cyan text-white hover:from-brand-blue-dark hover:to-brand-cyan-dark shadow-xl shadow-brand-blue/20 hover:shadow-2xl hover:shadow-brand-cyan/30 transition-all duration-500 font-semibold tracking-tight px-6 py-6 text-base",children:[(0,b.jsx)(k.Plus,{className:"mr-2 h-5 w-5"}),"Créer une formation"]})})})]})})})]})}a.s(["default",()=>E])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_formations_page_tsx_b9abf314._.js.map