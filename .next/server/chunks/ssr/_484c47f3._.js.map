{"version":3,"sources":["../../../../node_modules/lucide-react/src/icons/arrow-left.ts","../../../../node_modules/lucide-react/src/icons/clock.ts","../../../../node_modules/lucide-react/src/icons/check-circle.ts","../../../../node_modules/lucide-react/src/icons/save.ts","../../../../node_modules/lucide-react/src/icons/x-circle.ts","../../../../lib/errors/error-handler.ts","../../../../lib/utils/supabase-helpers.ts","../../../../lib/services/session.service.ts","../../../../lib/services/videoconference.service.ts","../../../../lib/services/signature.service.ts","../../../../lib/services/attendance.service.ts"],"sourcesContent":["import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name ArrowLeft\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJtMTIgMTktNy03IDctNyIgLz4KICA8cGF0aCBkPSJNMTkgMTJINSIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/arrow-left\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst ArrowLeft = createLucideIcon('ArrowLeft', [\n  ['path', { d: 'm12 19-7-7 7-7', key: '1l729n' }],\n  ['path', { d: 'M19 12H5', key: 'x3x0zl' }],\n]);\n\nexport default ArrowLeft;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Clock\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgLz4KICA8cG9seWxpbmUgcG9pbnRzPSIxMiA2IDEyIDEyIDE2IDE0IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/clock\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Clock = createLucideIcon('Clock', [\n  ['circle', { cx: '12', cy: '12', r: '10', key: '1mglay' }],\n  ['polyline', { points: '12 6 12 12 16 14', key: '68esgv' }],\n]);\n\nexport default Clock;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name CheckCircle\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjIgMTEuMDhWMTJhMTAgMTAgMCAxIDEtNS45My05LjE0IiAvPgogIDxwYXRoIGQ9Im05IDExIDMgM0wyMiA0IiAvPgo8L3N2Zz4K) - https://lucide.dev/icons/check-circle\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst CheckCircle = createLucideIcon('CheckCircle', [\n  ['path', { d: 'M22 11.08V12a10 10 0 1 1-5.93-9.14', key: 'g774vq' }],\n  ['path', { d: 'm9 11 3 3L22 4', key: '1pflzl' }],\n]);\n\nexport default CheckCircle;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Save\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMTkgMjFINWEyIDIgMCAwIDEtMi0yVjVhMiAyIDAgMCAxIDItMmgxMWw1IDV2MTFhMiAyIDAgMCAxLTIgMnoiIC8+CiAgPHBvbHlsaW5lIHBvaW50cz0iMTcgMjEgMTcgMTMgNyAxMyA3IDIxIiAvPgogIDxwb2x5bGluZSBwb2ludHM9IjcgMyA3IDggMTUgOCIgLz4KPC9zdmc+Cg==) - https://lucide.dev/icons/save\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Save = createLucideIcon('Save', [\n  ['path', { d: 'M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z', key: '1owoqh' }],\n  ['polyline', { points: '17 21 17 13 7 13 7 21', key: '1md35c' }],\n  ['polyline', { points: '7 3 7 8 15 8', key: '8nz8an' }],\n]);\n\nexport default Save;\n","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name XCircle\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMCIgLz4KICA8cGF0aCBkPSJtMTUgOS02IDYiIC8+CiAgPHBhdGggZD0ibTkgOSA2IDYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/x-circle\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst XCircle = createLucideIcon('XCircle', [\n  ['circle', { cx: '12', cy: '12', r: '10', key: '1mglay' }],\n  ['path', { d: 'm15 9-6 6', key: '1uzhvr' }],\n  ['path', { d: 'm9 9 6 6', key: 'z0biqf' }],\n]);\n\nexport default XCircle;\n","/**\n * ErrorHandler Global - Gestion centralisée des erreurs\n * \n * Fournit :\n * - Types d'erreurs personnalisés\n * - Classification automatique des erreurs\n * - Messages utilisateur traduits\n * - Logging automatique\n * - Formatage cohérent\n */\n\nimport { logger } from '@/lib/utils/logger'\nimport type { LogContext } from '@/lib/utils/logger'\n\n// ============================================================================\n// TYPES D'ERREURS PERSONNALISÉS\n// ============================================================================\n\nexport enum ErrorCode {\n  // Erreurs d'authentification (1000-1999)\n  AUTH_REQUIRED = 'AUTH_1001',\n  AUTH_INVALID_CREDENTIALS = 'AUTH_1002',\n  AUTH_SESSION_EXPIRED = 'AUTH_1003',\n  AUTH_INSUFFICIENT_PERMISSIONS = 'AUTH_1004',\n  AUTH_2FA_REQUIRED = 'AUTH_1005',\n  AUTH_2FA_INVALID = 'AUTH_1006',\n\n  // Erreurs de validation (2000-2999)\n  VALIDATION_ERROR = 'VALID_2001',\n  VALIDATION_REQUIRED_FIELD = 'VALID_2002',\n  VALIDATION_INVALID_FORMAT = 'VALID_2003',\n  VALIDATION_UNIQUE_CONSTRAINT = 'VALID_2004',\n\n  // Erreurs de base de données (3000-3999)\n  DB_CONNECTION_ERROR = 'DB_3001',\n  DB_QUERY_ERROR = 'DB_3002',\n  DB_NOT_FOUND = 'DB_3003',\n  DB_CONSTRAINT_VIOLATION = 'DB_3004',\n  DB_FOREIGN_KEY_CONSTRAINT = 'DB_3006',\n  DB_RLS_POLICY_VIOLATION = 'DB_3005',\n\n  // Erreurs réseau/API (4000-4999)\n  NETWORK_ERROR = 'NET_4001',\n  API_TIMEOUT = 'NET_4002',\n  API_RATE_LIMIT = 'NET_4003',\n  API_SERVER_ERROR = 'NET_4004',\n  API_NOT_FOUND = 'NET_4005',\n  API_BAD_REQUEST = 'NET_4006',\n\n  // Erreurs métier (5000-5999)\n  BUSINESS_LOGIC_ERROR = 'BIZ_5001',\n  RESOURCE_LOCKED = 'BIZ_5002',\n  OPERATION_NOT_ALLOWED = 'BIZ_5003',\n  QUOTA_EXCEEDED = 'BIZ_5004',\n\n  // Erreurs système (6000-6999)\n  INTERNAL_ERROR = 'SYS_6001',\n  CONFIGURATION_ERROR = 'SYS_6002',\n  SERVICE_UNAVAILABLE = 'SYS_6003',\n}\n\nexport enum ErrorSeverity {\n  LOW = 'low',\n  MEDIUM = 'medium',\n  HIGH = 'high',\n  CRITICAL = 'critical',\n}\n\nexport interface AppErrorContext extends LogContext {\n  code?: ErrorCode\n  severity?: ErrorSeverity\n  userMessage?: string\n  retryable?: boolean\n  timestamp?: string\n}\n\n/**\n * Classe d'erreur personnalisée pour l'application\n */\nexport class AppError extends Error {\n  public readonly code: ErrorCode\n  public readonly severity: ErrorSeverity\n  public readonly userMessage: string\n  public readonly retryable: boolean\n  public readonly context: AppErrorContext\n  public readonly originalError?: Error | unknown\n\n  constructor(\n    message: string,\n    code: ErrorCode = ErrorCode.INTERNAL_ERROR,\n    severity: ErrorSeverity = ErrorSeverity.MEDIUM,\n    context: AppErrorContext = {},\n    originalError?: Error | unknown\n  ) {\n    super(message)\n    this.name = 'AppError'\n    this.code = code\n    this.severity = severity\n    this.userMessage = context.userMessage || this.getDefaultUserMessage(code)\n    this.retryable = context.retryable ?? this.isRetryable(code)\n    this.context = {\n      ...context,\n      code,\n      severity,\n      timestamp: new Date().toISOString(),\n    }\n    this.originalError = originalError\n\n    // Maintenir la stack trace\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, AppError)\n    }\n  }\n\n  /**\n   * Messages utilisateur par défaut selon le code d'erreur\n   */\n  private getDefaultUserMessage(code: ErrorCode): string {\n    const messages: Record<ErrorCode, string> = {\n      // Auth\n      [ErrorCode.AUTH_REQUIRED]: 'Vous devez être connecté pour effectuer cette action.',\n      [ErrorCode.AUTH_INVALID_CREDENTIALS]: 'Email ou mot de passe incorrect.',\n      [ErrorCode.AUTH_SESSION_EXPIRED]: 'Votre session a expiré. Veuillez vous reconnecter.',\n      [ErrorCode.AUTH_INSUFFICIENT_PERMISSIONS]: \"Vous n'avez pas les permissions nécessaires.\",\n      [ErrorCode.AUTH_2FA_REQUIRED]: 'Authentification à deux facteurs requise.',\n      [ErrorCode.AUTH_2FA_INVALID]: 'Code d\\'authentification invalide.',\n\n      // Validation\n      [ErrorCode.VALIDATION_ERROR]: 'Les données fournies ne sont pas valides.',\n      [ErrorCode.VALIDATION_REQUIRED_FIELD]: 'Certains champs obligatoires sont manquants.',\n      [ErrorCode.VALIDATION_INVALID_FORMAT]: 'Le format des données est incorrect.',\n      [ErrorCode.VALIDATION_UNIQUE_CONSTRAINT]: 'Cette valeur existe déjà.',\n\n      // Database\n      [ErrorCode.DB_CONNECTION_ERROR]: 'Impossible de se connecter à la base de données.',\n      [ErrorCode.DB_QUERY_ERROR]: 'Erreur lors de l\\'exécution de la requête.',\n      [ErrorCode.DB_NOT_FOUND]: 'Ressource introuvable.',\n      [ErrorCode.DB_CONSTRAINT_VIOLATION]: 'Cette opération viole une contrainte de la base de données.',\n      [ErrorCode.DB_FOREIGN_KEY_CONSTRAINT]: 'Cette opération viole une contrainte de clé étrangère.',\n      [ErrorCode.DB_RLS_POLICY_VIOLATION]: 'Vous n\\'avez pas accès à cette ressource.',\n\n      // Network\n      [ErrorCode.NETWORK_ERROR]: 'Erreur de connexion réseau. Vérifiez votre connexion internet.',\n      [ErrorCode.API_TIMEOUT]: 'La requête a pris trop de temps. Veuillez réessayer.',\n      [ErrorCode.API_RATE_LIMIT]: 'Trop de requêtes. Veuillez patienter quelques instants.',\n      [ErrorCode.API_SERVER_ERROR]: 'Erreur serveur. Veuillez réessayer plus tard.',\n      [ErrorCode.API_NOT_FOUND]: 'Ressource introuvable.',\n      [ErrorCode.API_BAD_REQUEST]: 'Requête invalide.',\n\n      // Business\n      [ErrorCode.BUSINESS_LOGIC_ERROR]: 'Cette opération n\\'est pas autorisée dans le contexte actuel.',\n      [ErrorCode.RESOURCE_LOCKED]: 'Cette ressource est actuellement verrouillée.',\n      [ErrorCode.OPERATION_NOT_ALLOWED]: 'Cette opération n\\'est pas autorisée.',\n      [ErrorCode.QUOTA_EXCEEDED]: 'Vous avez atteint la limite autorisée.',\n\n      // System\n      [ErrorCode.INTERNAL_ERROR]: 'Une erreur interne est survenue. Veuillez réessayer.',\n      [ErrorCode.CONFIGURATION_ERROR]: 'Erreur de configuration du système.',\n      [ErrorCode.SERVICE_UNAVAILABLE]: 'Service temporairement indisponible.',\n    }\n\n    return messages[code] || 'Une erreur inattendue est survenue.'\n  }\n\n  /**\n   * Détermine si une erreur est retryable selon son code\n   */\n  private isRetryable(code: ErrorCode): boolean {\n    const retryableCodes = [\n      ErrorCode.NETWORK_ERROR,\n      ErrorCode.API_TIMEOUT,\n      ErrorCode.API_SERVER_ERROR,\n      ErrorCode.DB_CONNECTION_ERROR,\n      ErrorCode.SERVICE_UNAVAILABLE,\n    ]\n    return retryableCodes.includes(code)\n  }\n\n  /**\n   * Convertit l'erreur en objet JSON pour logging\n   */\n  toJSON() {\n    return {\n      name: this.name,\n      message: this.message,\n      code: this.code,\n      severity: this.severity,\n      userMessage: this.userMessage,\n      retryable: this.retryable,\n      context: this.context,\n      stack: this.stack,\n      originalError: this.originalError instanceof Error\n        ? {\n            name: this.originalError.name,\n            message: this.originalError.message,\n            stack: this.originalError.stack,\n          }\n        : this.originalError,\n    }\n  }\n}\n\n// ============================================================================\n// ERROR HANDLER PRINCIPAL\n// ============================================================================\n\nexport class ErrorHandler {\n  /**\n   * Analyse et classe une erreur inconnue\n   */\n  handleError(error: unknown, context: AppErrorContext = {}): AppError {\n    // Si c'est déjà une AppError, la retourner telle quelle\n    if (error instanceof AppError) {\n      this.logError(error)\n      return error\n    }\n\n    // Si c'est une Error standard, la convertir\n    if (error instanceof Error) {\n      return this.handleStandardError(error, context)\n    }\n\n    // Si c'est une erreur Supabase\n    if (this.isSupabaseError(error)) {\n      return this.handleSupabaseError(error, context)\n    }\n\n    // Erreur inconnue\n    const appError = new AppError(\n      'Une erreur inattendue est survenue.',\n      ErrorCode.INTERNAL_ERROR,\n      ErrorSeverity.HIGH,\n      context,\n      error\n    )\n    this.logError(appError)\n    return appError\n  }\n\n  /**\n   * Gère les erreurs Error standard\n   */\n  private handleStandardError(error: Error, context: AppErrorContext): AppError {\n    const message = error.message.toLowerCase()\n\n    // Détection par message\n    let code = ErrorCode.INTERNAL_ERROR\n    let severity = ErrorSeverity.MEDIUM\n\n    if (message.includes('network') || message.includes('fetch')) {\n      code = ErrorCode.NETWORK_ERROR\n      severity = ErrorSeverity.MEDIUM\n    } else if (message.includes('timeout')) {\n      code = ErrorCode.API_TIMEOUT\n      severity = ErrorSeverity.MEDIUM\n    } else if (message.includes('unauthorized') || message.includes('401')) {\n      code = ErrorCode.AUTH_REQUIRED\n      severity = ErrorSeverity.HIGH\n    } else if (message.includes('forbidden') || message.includes('403')) {\n      code = ErrorCode.AUTH_INSUFFICIENT_PERMISSIONS\n      severity = ErrorSeverity.HIGH\n    } else if (message.includes('not found') || message.includes('404')) {\n      code = ErrorCode.DB_NOT_FOUND\n      severity = ErrorSeverity.LOW\n    } else if (message.includes('validation') || message.includes('invalid')) {\n      code = ErrorCode.VALIDATION_ERROR\n      severity = ErrorSeverity.LOW\n    }\n\n    const appError = new AppError(error.message, code, severity, context, error)\n    this.logError(appError)\n    return appError\n  }\n\n  /**\n   * Gère les erreurs Supabase\n   */\n  private handleSupabaseError(error: any, context: AppErrorContext): AppError {\n    const code = error.code || error.status\n    const message = error.message || 'Erreur Supabase'\n\n    // Si un code d'erreur est fourni dans le contexte, l'utiliser en priorité\n    let errorCode = context.code || ErrorCode.DB_QUERY_ERROR\n    let severity = ErrorSeverity.MEDIUM\n\n    // Classification par code Supabase (seulement si pas de code dans le contexte)\n    if (!context.code) {\n      switch (code) {\n        case 'PGRST116':\n        case '42P01':\n          errorCode = ErrorCode.DB_NOT_FOUND\n          severity = ErrorSeverity.LOW\n          break\n        case '42501':\n          errorCode = ErrorCode.DB_RLS_POLICY_VIOLATION\n          severity = ErrorSeverity.HIGH\n          break\n        case '23505':\n          errorCode = ErrorCode.VALIDATION_UNIQUE_CONSTRAINT\n          severity = ErrorSeverity.LOW\n          break\n        case '23503':\n          errorCode = ErrorCode.DB_CONSTRAINT_VIOLATION\n          severity = ErrorSeverity.MEDIUM\n          break\n        case 'PGRST301':\n        case '400':\n          errorCode = ErrorCode.API_BAD_REQUEST\n          severity = ErrorSeverity.LOW\n          break\n        case '401':\n          errorCode = ErrorCode.AUTH_REQUIRED\n          severity = ErrorSeverity.HIGH\n          break\n        case '403':\n          errorCode = ErrorCode.AUTH_INSUFFICIENT_PERMISSIONS\n          severity = ErrorSeverity.HIGH\n          break\n        case '404':\n          errorCode = ErrorCode.API_NOT_FOUND\n          severity = ErrorSeverity.LOW\n          break\n        case '500':\n          errorCode = ErrorCode.API_SERVER_ERROR\n          severity = ErrorSeverity.HIGH\n          break\n      }\n    }\n\n    // Ajuster la sévérité selon le code d'erreur\n    if (errorCode === ErrorCode.DB_FOREIGN_KEY_CONSTRAINT) {\n      severity = ErrorSeverity.MEDIUM\n    }\n\n    const appError = new AppError(message, errorCode, severity, context, error)\n    this.logError(appError)\n    return appError\n  }\n\n  /**\n   * Vérifie si une erreur est une erreur Supabase\n   */\n  private isSupabaseError(error: any): boolean {\n    return (\n      error &&\n      (error.code || error.status || error.message) &&\n      (typeof error.code === 'string' || typeof error.status === 'number')\n    )\n  }\n\n  /**\n   * Log l'erreur selon sa sévérité\n   */\n  private logError(error: AppError) {\n    const logContext: LogContext = {\n      ...error.context,\n      code: error.code,\n      severity: error.severity,\n      retryable: error.retryable,\n    }\n\n    switch (error.severity) {\n      case ErrorSeverity.CRITICAL:\n      case ErrorSeverity.HIGH:\n        logger.error(error.message, error.originalError || error, logContext)\n        break\n      case ErrorSeverity.MEDIUM:\n        logger.warn(error.message, logContext)\n        break\n      case ErrorSeverity.LOW:\n        logger.info(`Error: ${error.message}`, logContext)\n        break\n    }\n  }\n\n  /**\n   * Crée une erreur de validation\n   */\n  createValidationError(message: string, field?: string): AppError {\n    return new AppError(\n      message,\n      ErrorCode.VALIDATION_ERROR,\n      ErrorSeverity.LOW,\n      { field, userMessage: message }\n    )\n  }\n\n  /**\n   * Crée une erreur d'authentification\n   */\n  createAuthError(code: ErrorCode, message?: string): AppError {\n    return new AppError(\n      message || 'Erreur d\\'authentification',\n      code,\n      ErrorSeverity.HIGH\n    )\n  }\n\n  /**\n   * Crée une erreur de base de données\n   */\n  createDatabaseError(message: string, originalError?: unknown): AppError {\n    return new AppError(\n      message,\n      ErrorCode.DB_QUERY_ERROR,\n      ErrorSeverity.MEDIUM,\n      {},\n      originalError\n    )\n  }\n\n  /**\n   * Crée une erreur \"Not Found\"\n   */\n  createNotFoundError(message: string, context?: AppErrorContext): AppError {\n    return new AppError(\n      message,\n      ErrorCode.DB_NOT_FOUND,\n      ErrorSeverity.LOW,\n      context\n    )\n  }\n}\n\n// Export d'une instance singleton\nexport const errorHandler = new ErrorHandler()\n\n// Export de fonctions helper pour faciliter l'utilisation\nexport const handleError = (error: unknown, context?: AppErrorContext) =>\n  errorHandler.handleError(error, context)\n\nexport const createValidationError = (message: string, field?: string) =>\n  errorHandler.createValidationError(message, field)\n\nexport const createAuthError = (code: ErrorCode, message?: string) =>\n  errorHandler.createAuthError(code, message)\n\nexport const createDatabaseError = (message: string, originalError?: unknown) =>\n  errorHandler.createDatabaseError(message, originalError)\n\nexport const createNotFoundError = (message: string, context?: AppErrorContext) =>\n  errorHandler.createNotFoundError(message, context)\n\n// Alias pour NotFoundError (compatibilité)\nexport const NotFoundError = createNotFoundError\n\n","/**\n * Helpers réutilisables pour les requêtes Supabase\n * \n * Réduit la duplication de code dans les services\n */\n\nimport { SupabaseClient } from '@supabase/supabase-js'\nimport { errorHandler, AppError, ErrorCode } from '@/lib/errors'\n\nexport interface GetAllByOrganizationOptions {\n  filters?: Record<string, unknown>\n  orderBy?: { column: string; ascending?: boolean }\n  select?: string\n  search?: { field: string; value: string }\n}\n\n/**\n * Récupère tous les enregistrements d'une organisation avec options\n */\nexport async function getAllByOrganization<T>(\n  supabase: SupabaseClient,\n  table: string,\n  organizationId: string,\n  options?: GetAllByOrganizationOptions\n): Promise<T[]> {\n  try {\n    let query = supabase\n      .from(table)\n      .select(options?.select || '*')\n      .eq('organization_id', organizationId)\n\n    // Appliquer les filtres\n    if (options?.filters) {\n      Object.entries(options.filters).forEach(([key, value]) => {\n        if (value !== undefined && value !== null) {\n          query = query.eq(key, value)\n        }\n      })\n    }\n\n    // Appliquer la recherche\n    if (options?.search) {\n      query = query.ilike(options.search.field, `%${options.search.value}%`)\n    }\n\n    // Appliquer le tri\n    if (options?.orderBy) {\n      query = query.order(options.orderBy.column, {\n        ascending: options.orderBy.ascending ?? false,\n      })\n    } else {\n      query = query.order('created_at', { ascending: false })\n    }\n\n    const { data, error } = await query\n\n    if (error) {\n      throw errorHandler.handleError(error, {\n        organizationId,\n        operation: 'getAllByOrganization',\n        table,\n      })\n    }\n\n    return (data || []) as T[]\n  } catch (error) {\n    if (error instanceof AppError) {\n      throw error\n    }\n    throw errorHandler.handleError(error, {\n      organizationId,\n      operation: 'getAllByOrganization',\n      table,\n    })\n  }\n}\n\n/**\n * Récupère un enregistrement par ID avec gestion d'erreur\n */\nexport async function getById<T>(\n  supabase: SupabaseClient,\n  table: string,\n  id: string,\n  select?: string\n): Promise<T> {\n  try {\n    const { data, error } = await supabase\n      .from(table)\n      .select(select || '*')\n      .eq('id', id)\n      .single()\n\n    if (error) {\n      if (error.code === 'PGRST116' || error.code === '42P01') {\n        throw errorHandler.handleError(error, {\n          code: ErrorCode.DB_NOT_FOUND,\n          operation: 'getById',\n          id,\n          table,\n        })\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'getById',\n        id,\n        table,\n      })\n    }\n\n    if (!data) {\n      throw errorHandler.createDatabaseError(\n        `Enregistrement avec l'ID ${id} introuvable dans ${table}`,\n        { id, table }\n      )\n    }\n\n    return data as T\n  } catch (error) {\n    if (error instanceof AppError) {\n      throw error\n    }\n    throw errorHandler.handleError(error, {\n      operation: 'getById',\n      id,\n      table,\n    })\n  }\n}\n\n","import { createClient } from '@/lib/supabase/client'\nimport type { SupabaseClient } from '@supabase/supabase-js'\nimport { calendarService } from './calendar.service'\nimport { videoconferenceService } from './videoconference.service'\nimport type { TableRow, TableInsert, TableUpdate, FlexibleInsert, FlexibleUpdate } from '@/lib/types/supabase-helpers'\n\n// Types pour les sessions (niveau 3)\ntype Session = TableRow<'sessions'>\ntype SessionInsert = TableInsert<'sessions'>\ntype SessionUpdate = TableUpdate<'sessions'>\n\n/**\n * Service pour gérer les SESSIONS\n * Une session appartient à une formation\n * Exemple : \"Session Hiver 2024\" (de la formation \"Excel avancé\")\n */\nexport class SessionService {\n  private supabase: SupabaseClient<any>\n\n\n  constructor(supabaseClient?: SupabaseClient<any>) {\n\n    this.supabase = supabaseClient || createClient()\n\n  }\n\n  /**\n   * Récupère toutes les sessions d'une organisation\n   */\n  async getAllSessions(organizationId: string, filters?: {\n    formationId?: string\n    status?: Session['status']\n    startDate?: string\n    endDate?: string\n    search?: string\n  }) {\n    let query = this.supabase\n      .from('sessions')\n      .select(`\n        *,\n        formations!inner(\n          *,\n          programs(*)\n        )\n      `)\n      .eq('formations.organization_id', organizationId)\n\n    if (filters?.formationId) {\n      query = query.eq('formation_id', filters.formationId)\n    }\n\n    if (filters?.status) {\n      query = query.eq('status', filters.status)\n    }\n\n    if (filters?.startDate) {\n      query = query.gte('start_date', filters.startDate)\n    }\n\n    if (filters?.endDate) {\n      query = query.lte('end_date', filters.endDate)\n    }\n\n    if (filters?.search) {\n      query = query.ilike('name', `%${filters.search}%`)\n    }\n\n    const { data, error } = await query.order('start_date', { ascending: true })\n\n    if (error) throw error\n    return data\n  }\n\n  /**\n   * Récupère une session par son ID avec sa formation, son programme (via formation) et tous ses programmes associés\n   */\n  async getSessionById(id: string) {\n    // Récupérer la session avec sa formation et son programme (relation indirecte)\n    const { data: session, error: sessionError } = await this.supabase\n      .from('sessions')\n      .select(`\n        *,\n        formations!inner(\n          *,\n          programs(*)\n        )\n      `)\n      .eq('id', id)\n      .single()\n\n    if (sessionError) throw sessionError\n\n    // Récupérer tous les programmes associés directement à cette session (relation many-to-many)\n    const { data: sessionPrograms, error: programsError } = await this.supabase\n      .from('session_programs')\n      .select(`\n        program_id,\n        programs(*)\n      `)\n      .eq('session_id', id)\n\n    if (programsError) throw programsError\n\n    // Ajouter les programmes associés à la session\n    return {\n      ...session,\n      session_programs: sessionPrograms?.map((sp: { programs: unknown }) => sp.programs).filter(Boolean) || [],\n    }\n  }\n\n  /**\n   * Crée une nouvelle session avec optionnellement plusieurs programmes associés\n   */\n  async createSession(session: FlexibleInsert<'sessions'>, programIds?: string[], organizationId?: string) {\n    // Vérifier d'abord que la formation existe et appartient à l'organisation de l'utilisateur\n    if (session.formation_id) {\n      const { data: formation, error: formationError } = await this.supabase\n        .from('formations')\n        .select('id, organization_id')\n        .eq('id', session.formation_id)\n        .single()\n\n      if (formationError) {\n        console.error('Erreur lors de la vérification de la formation:', formationError)\n        throw new Error(`Formation non trouvée: ${formationError.message}`)\n      }\n\n      if (!formation) {\n        throw new Error('Formation non trouvée')\n      }\n\n      console.log('Formation trouvée:', formation)\n    }\n\n    // Créer la session\n    const { data, error } = await this.supabase\n      .from('sessions')\n      .insert(session as SessionInsert)\n      .select()\n      .single()\n\n    if (error) {\n      console.error('Erreur RLS lors de la création de la session:', {\n        code: error.code,\n        message: error.message,\n        details: error.details,\n        hint: error.hint,\n        formation_id: session.formation_id,\n      })\n      throw error\n    }\n\n    // Si des programmes sont fournis, créer les associations\n    if (programIds && programIds.length > 0 && data) {\n      // Récupérer l'organization_id de la formation\n      const { data: formation } = await this.supabase\n        .from('formations')\n        .select('organization_id')\n        .eq('id', data.formation_id)\n        .single()\n\n      if (formation) {\n        const sessionPrograms = programIds.map((programId) => ({\n          session_id: data.id,\n          program_id: programId,\n          organization_id: formation.organization_id,\n        }))\n\n        const { error: linkError } = await this.supabase\n          .from('session_programs')\n          .insert(sessionPrograms)\n\n        if (linkError) {\n          console.error('Erreur lors de la création des associations session-programme:', linkError)\n          // Ne pas échouer complètement, mais logger l'erreur\n        }\n\n        // Synchroniser avec les calendriers si activé\n        if (formation.organization_id) {\n          await this.syncWithCalendars(data.id, formation.organization_id, 'create').catch((error) => {\n            console.error('Erreur lors de la synchronisation calendrier:', error)\n            // Ne pas échouer la création de session si la synchronisation échoue\n          })\n        }\n\n        // Créer une réunion visioconférence si activé\n        if (formation.organization_id) {\n          await this.createVideoconferenceMeeting(data.id, formation.organization_id).catch((error) => {\n            console.error('Erreur lors de la création de la réunion visioconférence:', error)\n            // Ne pas échouer la création de session si la création de réunion échoue\n          })\n        }\n      }\n    }\n\n    console.log('Session créée avec succès:', data)\n    return data\n  }\n\n  /**\n   * Met à jour les programmes associés à une session\n   */\n  async updateSessionPrograms(sessionId: string, programIds: string[], organizationId: string) {\n    // Supprimer toutes les associations existantes\n    const { error: deleteError } = await this.supabase\n      .from('session_programs')\n      .delete()\n      .eq('session_id', sessionId)\n\n    if (deleteError) throw deleteError\n\n    // Créer les nouvelles associations\n    if (programIds.length > 0) {\n      const sessionPrograms = programIds.map((programId) => ({\n        session_id: sessionId,\n        program_id: programId,\n        organization_id: organizationId,\n      }))\n\n      const { error: insertError } = await this.supabase\n        .from('session_programs')\n        .insert(sessionPrograms)\n\n      if (insertError) throw insertError\n    }\n\n    return true\n  }\n\n  /**\n   * Récupère tous les programmes associés à une session\n   */\n  async getSessionPrograms(sessionId: string) {\n    const { data, error } = await this.supabase\n      .from('session_programs')\n      .select(`\n        program_id,\n        programs(*)\n      `)\n      .eq('session_id', sessionId)\n\n    if (error) throw error\n    return data?.map((sp: { programs: unknown }) => sp.programs).filter(Boolean) || []\n  }\n\n  /**\n   * Met à jour une session\n   */\n  async updateSession(id: string, updates: FlexibleUpdate<'sessions'>) {\n    // Récupérer l'organization_id avant la mise à jour\n    const { data: existingSession } = await this.supabase\n      .from('sessions')\n      .select('formation_id, formations(organization_id)')\n      .eq('id', id)\n      .single()\n\n    const { data, error } = await this.supabase\n      .from('sessions')\n      .update(updates as SessionUpdate)\n      .eq('id', id)\n      .select()\n      .single()\n\n    if (error) throw error\n\n    // Synchroniser avec les calendriers si activé\n    const formation = existingSession?.formations as { organization_id?: string } | null\n    if (existingSession && formation?.organization_id) {\n      await this.syncWithCalendars(id, formation.organization_id, 'update').catch((error) => {\n        console.error('Erreur lors de la synchronisation calendrier:', error)\n      })\n    }\n\n    return data\n  }\n\n  /**\n   * Supprime une session\n   */\n  async deleteSession(id: string) {\n    // Récupérer l'organization_id avant la suppression\n    const { data: existingSession } = await this.supabase\n      .from('sessions')\n      .select('formation_id, formations(organization_id)')\n      .eq('id', id)\n      .single()\n\n    // Supprimer les événements calendrier si activé\n    const formation = existingSession?.formations as { organization_id?: string } | null\n    if (existingSession && formation?.organization_id) {\n      await this.syncWithCalendars(id, formation.organization_id, 'delete').catch((error) => {\n        console.error('Erreur lors de la suppression de l\\'événement calendrier:', error)\n      })\n    }\n\n    const { error } = await this.supabase\n      .from('sessions')\n      .delete()\n      .eq('id', id)\n\n    if (error) throw error\n  }\n\n  /**\n   * Crée une réunion visioconférence pour une session\n   */\n  private async createVideoconferenceMeeting(\n    sessionId: string,\n    organizationId: string\n  ): Promise<void> {\n    // Récupérer les intégrations visioconférence actives\n    const { data: integrations } = await this.supabase\n      .from('videoconference_integrations')\n      .select('*')\n      .eq('organization_id', organizationId)\n      .eq('is_active', true)\n      .eq('auto_create_meetings', true)\n\n    if (!integrations || integrations.length === 0) {\n      return // Pas d'intégrations actives\n    }\n\n    // Créer une réunion avec chaque système actif\n    for (const integration of integrations) {\n      try {\n        await videoconferenceService.createMeetingForSession(\n          sessionId,\n          { organizationId, provider: integration.provider as string }\n        )\n      } catch (error) {\n        console.error(`Erreur lors de la création de réunion avec ${integration.provider}:`, error)\n        // Continuer avec les autres intégrations même si une échoue\n      }\n    }\n  }\n\n  /**\n   * Synchronise une session avec les calendriers configurés\n   */\n  private async syncWithCalendars(\n    sessionId: string,\n    organizationId: string,\n    action: 'create' | 'update' | 'delete'\n  ): Promise<void> {\n    // Récupérer les intégrations calendrier actives\n    const { data: integrations } = await this.supabase\n      .from('calendar_integrations')\n      .select('*')\n      .eq('organization_id', organizationId)\n      .eq('is_active', true)\n      .eq('sync_sessions', true)\n      .eq('create_events_for_sessions', true)\n\n    if (!integrations || integrations.length === 0) {\n      return // Pas d'intégrations actives\n    }\n\n    // Synchroniser avec chaque calendrier\n    for (const integration of integrations) {\n      try {\n        // TODO: Implémenter deleteSessionEvent et syncSession dans CalendarService\n        // if (action === 'delete') {\n        //   await calendarService.deleteSessionEvent(\n        //     organizationId,\n        //     integration.provider as string,\n        //     sessionId\n        //   )\n        // } else {\n        //   await calendarService.syncSession(\n        //     organizationId,\n        //     integration.provider as string,\n        //     sessionId\n        //   )\n        // }\n        console.warn(`Calendar sync for ${action} not implemented yet for provider ${integration.provider}`)\n      } catch (error) {\n        console.error(`Erreur lors de la synchronisation avec ${integration.provider}:`, error)\n        // Continuer avec les autres intégrations même si une échoue\n      }\n    }\n  }\n\n  /**\n   * Récupère les sessions à venir\n   */\n  async getUpcomingSessions(organizationId: string, limit: number = 10) {\n    const today = new Date().toISOString().split('T')[0]\n    \n    const { data, error } = await this.supabase\n      .from('sessions')\n      .select(`\n        *,\n        formations!inner(\n          *,\n          programs(*)\n        )\n      `)\n      .eq('formations.organization_id', organizationId)\n      .gte('start_date', today)\n      .eq('status', 'planned')\n      .order('start_date', { ascending: true })\n      .limit(limit)\n\n    if (error) throw error\n    return data\n  }\n\n  /**\n   * Récupère les sessions en cours\n   */\n  async getOngoingSessions(organizationId: string) {\n    const today = new Date().toISOString().split('T')[0]\n    \n    const { data, error } = await this.supabase\n      .from('sessions')\n      .select(`\n        *,\n        formations!inner(\n          *,\n          programs(*)\n        )\n      `)\n      .eq('formations.organization_id', organizationId)\n      .lte('start_date', today)\n      .gte('end_date', today)\n      .eq('status', 'ongoing')\n      .order('start_date', { ascending: true })\n\n    if (error) throw error\n    return data\n  }\n\n  // ========== GESTION DES RELATIONS N:N FORMATION-SESSION ==========\n\n  /**\n   * Associe une session à une ou plusieurs formations\n   */\n  async addSessionToFormations(sessionId: string, formationIds: string[], organizationId: string) {\n    const formationSessions = formationIds.map((formationId, index) => ({\n      session_id: sessionId,\n      formation_id: formationId,\n      organization_id: organizationId,\n      order_index: index,\n    }))\n\n    const { data, error } = await this.supabase\n      .from('formation_sessions')\n      .insert(formationSessions)\n      .select()\n\n    if (error) throw error\n    return data\n  }\n\n  /**\n   * Retire une session d'une formation\n   */\n  async removeSessionFromFormation(sessionId: string, formationId: string) {\n    const { error } = await this.supabase\n      .from('formation_sessions')\n      .delete()\n      .eq('session_id', sessionId)\n      .eq('formation_id', formationId)\n\n    if (error) throw error\n    return true\n  }\n\n  /**\n   * Met à jour les formations associées à une session\n   */\n  async updateSessionFormations(sessionId: string, formationIds: string[], organizationId: string) {\n    // Supprimer toutes les associations existantes\n    const { error: deleteError } = await this.supabase\n      .from('formation_sessions')\n      .delete()\n      .eq('session_id', sessionId)\n\n    if (deleteError) throw deleteError\n\n    // Créer les nouvelles associations\n    if (formationIds.length > 0) {\n      return this.addSessionToFormations(sessionId, formationIds, organizationId)\n    }\n\n    return []\n  }\n\n  /**\n   * Récupère toutes les formations associées à une session\n   */\n  async getSessionFormations(sessionId: string) {\n    const { data, error } = await this.supabase\n      .from('formation_sessions')\n      .select(`\n        formation_id,\n        order_index,\n        formations(*)\n      `)\n      .eq('session_id', sessionId)\n      .order('order_index', { ascending: true })\n\n    if (error) throw error\n    return data?.map((fs: { formations: unknown }) => fs.formations).filter(Boolean) || []\n  }\n\n  /**\n   * Récupère toutes les sessions d'une formation (via la table de liaison N:N)\n   */\n  async getFormationSessions(formationId: string) {\n    const { data, error } = await this.supabase\n      .from('formation_sessions')\n      .select(`\n        session_id,\n        order_index,\n        sessions(*)\n      `)\n      .eq('formation_id', formationId)\n      .order('order_index', { ascending: true })\n\n    if (error) throw error\n    return data?.map((fs: { sessions: unknown }) => fs.sessions).filter(Boolean) || []\n  }\n\n  /**\n   * Crée une session indépendante (sans formation obligatoire)\n   */\n  async createIndependentSession(\n    session: Omit<FlexibleInsert<'sessions'>, 'formation_id'> & { organization_id: string },\n    programIds?: string[],\n    formationIds?: string[]\n  ) {\n    // Créer la session sans formation_id\n    const { data, error } = await this.supabase\n      .from('sessions')\n      .insert({\n        ...session,\n        formation_id: null, // Pas de formation directe\n      } as SessionInsert)\n      .select()\n      .single()\n\n    if (error) throw error\n\n    // Associer les programmes si fournis\n    if (programIds && programIds.length > 0 && data) {\n      await this.updateSessionPrograms(data.id, programIds, session.organization_id)\n    }\n\n    // Associer les formations si fournies\n    if (formationIds && formationIds.length > 0 && data) {\n      await this.addSessionToFormations(data.id, formationIds, session.organization_id)\n    }\n\n    return data\n  }\n}\n\nexport const sessionService = new SessionService()\n\n\n\n\n\n\n\n\n\n\n\n","/**\n * Service pour gérer les vidéoconférences\n * TODO: Implémenter le service de vidéoconférence\n */\n\nexport const videoconferenceService = {\n  /**\n   * Crée une réunion vidéo pour une session\n   */\n  async createMeetingForSession(sessionId: string, options?: any) {\n    // TODO: Implémenter la création de réunion vidéo\n    console.warn('videoconferenceService.createMeetingForSession not implemented')\n    return null\n  },\n}\n","import { createClient } from '@/lib/supabase/client'\nimport type { SupabaseClient } from '@supabase/supabase-js'\nimport { Database } from '@/types/database.types'\nimport type { TableRow, TableInsert, TableUpdate, FlexibleInsert, FlexibleUpdate } from '@/lib/types/supabase-helpers'\nimport { errorHandler, ErrorCode, AppError } from '@/lib/errors'\nimport { logger } from '@/lib/utils/logger'\n\ntype DocumentSignature = TableRow<'document_signatures'>\ntype DocumentSignatureInsert = TableInsert<'document_signatures'>\ntype DocumentSignatureUpdate = TableUpdate<'document_signatures'>\n\nexport interface CreateSignatureParams {\n  documentId: string\n  organizationId: string\n  signerId: string\n  signatureData: string // Base64 image\n  signatureType?: 'handwritten' | 'typed' | 'image'\n  signerName?: string\n  signerEmail?: string\n  signerRole?: string\n  positionX?: number\n  positionY?: number\n  width?: number\n  height?: number\n  pageNumber?: number\n  comment?: string\n}\n\nexport interface SignatureWithUser {\n  id: string\n  document_id: string\n  signer_id: string\n  signature_data: string\n  signature_type: 'handwritten' | 'typed' | 'image' | null\n  signer_name: string | null\n  signer_email: string | null\n  signer_role: string | null\n  position_x: number | null\n  position_y: number | null\n  width: number | null\n  height: number | null\n  page_number: number | null\n  status: 'pending' | 'signed' | 'declined' | 'revoked' | 'expired' | null\n  is_valid: boolean | null\n  signed_at: string | null\n  comment: string | null\n  created_at: string\n  signer: {\n    id: string\n    full_name: string | null\n    email: string | null\n    role: string | null\n  } | null\n}\n\n/**\n * Service pour gérer les signatures électroniques de documents\n */\nexport class SignatureService {\n  private supabase: SupabaseClient<Database>\n\n\n  constructor(supabaseClient?: SupabaseClient<Database>) {\n\n    this.supabase = supabaseClient || createClient()\n\n  }\n\n  /**\n   * Récupère toutes les signatures d'un document\n   */\n  async getSignaturesByDocument(documentId: string) {\n    try {\n      const { data, error } = await this.supabase\n        .from('document_signatures')\n        .select(`\n          *,\n          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role)\n        `)\n        .eq('document_id', documentId)\n        .eq('status', 'signed')\n        .order('signed_at', { ascending: true })\n\n      if (error) throw error\n      return (data || []) as SignatureWithUser[]\n    } catch (error) {\n      if (error instanceof AppError) throw error\n      throw errorHandler.handleError(error, {\n        operation: 'getSignaturesByDocument',\n        documentId,\n      })\n    }\n  }\n\n  /**\n   * Récupère une signature par son ID\n   */\n  async getSignatureById(signatureId: string) {\n    try {\n      const { data, error } = await this.supabase\n        .from('document_signatures')\n        .select(`\n          *,\n          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role),\n          document:documents(id, title, organization_id)\n        `)\n        .eq('id', signatureId)\n        .single()\n\n      if (error) {\n        if (error.code === 'PGRST116') {\n          throw errorHandler.createNotFoundError(\n            `Signature avec l'ID ${signatureId} introuvable`,\n            { signatureId }\n          )\n        }\n        throw error\n      }\n\n      return data as SignatureWithUser & {\n        document: { id: string; title: string | null; organization_id: string } | null\n      }\n    } catch (error) {\n      if (error instanceof AppError) throw error\n      throw errorHandler.handleError(error, {\n        operation: 'getSignatureById',\n        signatureId,\n      })\n    }\n  }\n\n  /**\n   * Récupère toutes les signatures d'un utilisateur\n   */\n  async getSignaturesByUser(userId: string, organizationId: string) {\n    try {\n      const { data, error } = await this.supabase\n        .from('document_signatures')\n        .select(`\n          *,\n          document:documents(id, title, type, organization_id)\n        `)\n        .eq('signer_id', userId)\n        .eq('organization_id', organizationId)\n        .order('signed_at', { ascending: false })\n\n      if (error) throw error\n      return data || []\n    } catch (error) {\n      if (error instanceof AppError) throw error\n      throw errorHandler.handleError(error, {\n        operation: 'getSignaturesByUser',\n        userId,\n        organizationId,\n      })\n    }\n  }\n\n  /**\n   * Récupère toutes les signatures pour les documents liés à une session\n   * (via les étudiants inscrits à la session)\n   */\n  async getSignaturesBySession(sessionId: string, organizationId: string) {\n    try {\n      // Récupérer les étudiants inscrits à la session\n      const { data: enrollments, error: enrollmentsError } = await this.supabase\n        .from('enrollments')\n        .select('student_id')\n        .eq('session_id', sessionId)\n        .in('status', ['confirmed', 'completed', 'active'])\n\n      if (enrollmentsError) throw enrollmentsError\n      if (!enrollments || enrollments.length === 0) return []\n\n      const studentIds = enrollments.map((e: any) => e.student_id).filter(Boolean)\n\n      // Récupérer les documents de ces étudiants\n      const { data: documents, error: documentsError } = await this.supabase\n        .from('documents')\n        .select('id')\n        .eq('organization_id', organizationId)\n        .in('student_id', studentIds)\n\n      if (documentsError) throw documentsError\n      if (!documents || documents.length === 0) return []\n\n      const documentIds = documents.map((d: any) => d.id)\n\n      // Récupérer les signatures de ces documents\n      const { data, error } = await this.supabase\n        .from('document_signatures')\n        .select(`\n          *,\n          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role),\n          document:documents(id, title, type, student_id, students(id, first_name, last_name))\n        `)\n        .in('document_id', documentIds)\n        .eq('organization_id', organizationId)\n        .order('signed_at', { ascending: false })\n\n      if (error) throw error\n      return (data || []) as (SignatureWithUser & {\n        document: {\n          id: string\n          title: string | null\n          type: string | null\n          student_id: string | null\n          students: { id: string; first_name: string | null; last_name: string | null } | null\n        } | null\n      })[]\n    } catch (error) {\n      if (error instanceof AppError) throw error\n      throw errorHandler.handleError(error, {\n        operation: 'getSignaturesBySession',\n        sessionId,\n        organizationId,\n      })\n    }\n  }\n\n  /**\n   * Crée une nouvelle signature\n   */\n  async createSignature(params: CreateSignatureParams) {\n    try {\n      // Récupérer les informations de l'utilisateur\n      const { data: userData } = await this.supabase.auth.getUser()\n      if (!userData.user) {\n        throw errorHandler.createAuthError(ErrorCode.AUTH_REQUIRED, 'Utilisateur non authentifié')\n      }\n\n      // Générer un code de validation\n      const validationCode = this.generateValidationCode()\n\n      // Récupérer l'IP et le user agent si disponibles\n      let ipAddress: string | null = null\n      let userAgent: string | null = null\n      \n      if (typeof window !== 'undefined') {\n        userAgent = navigator.userAgent\n        // L'IP sera récupérée côté serveur si nécessaire\n      }\n\n      const signatureData: FlexibleInsert<'document_signatures'> = {\n        document_id: params.documentId,\n        organization_id: params.organizationId,\n        signer_id: params.signerId,\n        signature_data: params.signatureData,\n        signature_type: params.signatureType || 'handwritten',\n        signer_name: params.signerName || userData.user.user_metadata?.full_name || 'Utilisateur',\n        signer_email: params.signerEmail || userData.user.email || null,\n        signer_role: params.signerRole || null,\n        position_x: params.positionX || null,\n        position_y: params.positionY || null,\n        width: params.width || 200,\n        height: params.height || 80,\n        page_number: params.pageNumber || 1,\n        status: 'signed',\n        is_valid: true,\n        validation_code: validationCode,\n        comment: params.comment || null,\n        ip_address: ipAddress,\n        user_agent: userAgent,\n      }\n\n      const { data, error } = await this.supabase\n        .from('document_signatures')\n        .insert(signatureData as DocumentSignatureInsert)\n        .select(`\n          *,\n          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role)\n        `)\n        .single()\n\n      if (error) throw error\n\n      logger.info('Signature créée', {\n        signatureId: data.id,\n        documentId: params.documentId,\n        signerId: params.signerId,\n      })\n\n      return data as SignatureWithUser\n    } catch (error) {\n      if (error instanceof AppError) throw error\n      throw errorHandler.handleError(error, {\n        operation: 'createSignature',\n        documentId: params.documentId,\n        signerId: params.signerId,\n      })\n    }\n  }\n\n  /**\n   * Met à jour une signature\n   */\n  async updateSignature(signatureId: string, updates: FlexibleUpdate<'document_signatures'>) {\n    try {\n      const { data, error } = await this.supabase\n        .from('document_signatures')\n        .update(updates as DocumentSignatureUpdate)\n        .eq('id', signatureId)\n        .select()\n        .single()\n\n      if (error) {\n        if (error.code === 'PGRST116') {\n          throw errorHandler.createNotFoundError(\n            `Signature avec l'ID ${signatureId} introuvable`,\n            { signatureId }\n          )\n        }\n        throw error\n      }\n\n      return data\n    } catch (error) {\n      if (error instanceof AppError) throw error\n      throw errorHandler.handleError(error, {\n        operation: 'updateSignature',\n        signatureId,\n      })\n    }\n  }\n\n  /**\n   * Révoque une signature\n   */\n  async revokeSignature(signatureId: string, reason?: string) {\n    try {\n      return this.updateSignature(signatureId, {\n        status: 'revoked',\n        is_valid: false,\n        comment: reason || 'Signature révoquée',\n      })\n    } catch (error) {\n      if (error instanceof AppError) throw error\n      throw errorHandler.handleError(error, {\n        operation: 'revokeSignature',\n        signatureId,\n      })\n    }\n  }\n\n  /**\n   * Supprime une signature\n   */\n  async deleteSignature(signatureId: string) {\n    try {\n      const { error } = await this.supabase\n        .from('document_signatures')\n        .delete()\n        .eq('id', signatureId)\n\n      if (error) throw error\n\n      logger.info('Signature supprimée', { signatureId })\n    } catch (error) {\n      if (error instanceof AppError) throw error\n      throw errorHandler.handleError(error, {\n        operation: 'deleteSignature',\n        signatureId,\n      })\n    }\n  }\n\n  /**\n   * Vérifie si un document a des signatures\n   */\n  async hasSignatures(documentId: string): Promise<boolean> {\n    try {\n      const { count, error } = await this.supabase\n        .from('document_signatures')\n        .select('*', { count: 'exact', head: true })\n        .eq('document_id', documentId)\n        .eq('status', 'signed')\n\n      if (error) throw error\n      return (count || 0) > 0\n    } catch (error) {\n      if (error instanceof AppError) throw error\n      throw errorHandler.handleError(error, {\n        operation: 'hasSignatures',\n        documentId,\n      })\n    }\n  }\n\n  /**\n   * Génère un code de validation pour la signature\n   */\n  private generateValidationCode(): string {\n    const timestamp = Date.now()\n    const random = Math.random().toString(36).substring(2, 15)\n    return `${timestamp}-${random}`\n  }\n\n  /**\n   * Valide l'intégrité d'une signature\n   */\n  async validateSignature(signatureId: string, validationCode: string): Promise<boolean> {\n    try {\n      const signature = await this.getSignatureById(signatureId)\n      const sig = signature as any\n      return (sig.validation_code === validationCode) && (sig.is_valid === true)\n    } catch (error) {\n      return false\n    }\n  }\n}\n\nexport const signatureService = new SignatureService()\n\n","import { createClient } from '@/lib/supabase/client'\nimport type { SupabaseClient } from '@supabase/supabase-js'\nimport { Database } from '@/types/database.types'\nimport { errorHandler, ErrorCode, AppError } from '@/lib/errors'\nimport { logger } from '@/lib/utils/logger'\nimport { getAllByOrganization, getById } from '@/lib/utils/supabase-helpers'\n\ntype Attendance = Database['public']['Tables']['attendance']['Row']\ntype AttendanceInsert = Database['public']['Tables']['attendance']['Insert']\ntype AttendanceUpdate = Database['public']['Tables']['attendance']['Update']\n\nexport class AttendanceService {\n  private supabase: SupabaseClient<Database>\n\n\n  constructor(supabaseClient?: SupabaseClient<Database>) {\n\n    this.supabase = supabaseClient || createClient()\n\n  }\n\n  /**\n   * Récupère toutes les présences d'une organisation\n   */\n  async getAll(organizationId: string, filters?: {\n    studentId?: string\n    classId?: string\n    programSessionId?: string\n    date?: string\n    status?: Attendance['status']\n  }) {\n    try {\n      // Utiliser le helper pour réduire la duplication\n      const filtersMap: Record<string, unknown> = {}\n      if (filters?.studentId) filtersMap.student_id = filters.studentId\n      if (filters?.classId) filtersMap.class_id = filters.classId\n      if (filters?.programSessionId) filtersMap.session_id = filters.programSessionId\n      if (filters?.date) filtersMap.date = filters.date\n      if (filters?.status) filtersMap.status = filters.status\n\n      return getAllByOrganization<Attendance>(\n        this.supabase,\n        'attendance',\n        organizationId,\n        {\n          select: '*, students(id, first_name, last_name, student_number), classes(id, name), sessions(id, title, start_time)',\n          filters: filtersMap,\n          orderBy: { column: 'date', ascending: false },\n        }\n      )\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        organizationId,\n        operation: 'getAll',\n      })\n    }\n  }\n\n  /**\n   * Récupère l'émargement d'une classe pour une date donnée\n   */\n  async getByClassAndDate(classId: string, date: string) {\n    try {\n      const { data, error } = await this.supabase\n        .from('attendance')\n        .select('*, students(id, first_name, last_name, student_number)') // ✅ Jointure optimisée\n        .eq('class_id', classId)\n        .eq('date', date)\n        .order('students(last_name)', { ascending: true })\n\n      if (error) {\n        throw errorHandler.handleError(error, {\n          operation: 'getByClassAndDate',\n          classId,\n          date,\n        })\n      }\n\n      return data || []\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'getByClassAndDate',\n        classId,\n        date,\n      })\n    }\n  }\n\n  /**\n   * Récupère l'émargement d'une session pour une date donnée\n   */\n  async getBySessionAndDate(sessionId: string, date: string) {\n    try {\n      const { data, error } = await this.supabase\n        .from('attendance')\n        .select('*, students(id, first_name, last_name, student_number)') // ✅ Jointure optimisée\n        .eq('session_id', sessionId)\n        .eq('date', date)\n        .order('students(last_name)', { ascending: true })\n\n      if (error) {\n        throw errorHandler.handleError(error, {\n          operation: 'getBySessionAndDate',\n          sessionId,\n          date,\n        })\n      }\n\n      return data || []\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'getBySessionAndDate',\n        sessionId,\n        date,\n      })\n    }\n  }\n\n  /**\n   * Crée ou met à jour un émargement\n   */\n  async upsert(attendance: AttendanceInsert & {\n    latitude?: number\n    longitude?: number\n    location_accuracy?: number\n    location_address?: string\n    location_method?: 'manual' | 'qr_code' | 'gps' | 'ip'\n  }) {\n    // Vérifier la géolocalisation si la session l'exige\n    if (attendance.session_id && (attendance.latitude || attendance.longitude)) {\n      const locationValid = await this.validateLocation(\n        attendance.session_id,\n        attendance.latitude,\n        attendance.longitude\n      )\n\n      if (!locationValid.valid) {\n        throw errorHandler.createValidationError(\n          locationValid.error || 'Localisation invalide',\n          'location'\n        )\n      }\n\n      // Ajouter les informations de vérification\n      ;(attendance as Attendance & { location_verified?: boolean }).location_verified = locationValid.verified\n    }\n\n    try {\n      const { data, error } = await this.supabase\n        .from('attendance')\n        .upsert(attendance, {\n          onConflict: 'student_id,class_id,session_id,date',\n        })\n        .select()\n        .single()\n\n      if (error) {\n        if (error.code === '42501') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_RLS_POLICY_VIOLATION,\n            operation: 'upsert',\n          })\n        }\n        throw errorHandler.handleError(error, {\n          operation: 'upsert',\n          attendance,\n        })\n      }\n\n      logger.info('Émargement créé/mis à jour avec succès', {\n        id: data?.id,\n        studentId: attendance.student_id,\n        date: attendance.date,\n      })\n\n      return data\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'upsert',\n        attendance,\n      })\n    }\n  }\n\n  /**\n   * Valide la géolocalisation pour un émargement\n   */\n  async validateLocation(\n    sessionId: string,\n    latitude?: number,\n    longitude?: number\n  ): Promise<{ valid: boolean; verified: boolean; error?: string; distance?: number }> {\n    if (!latitude || !longitude) {\n      return { valid: false, verified: false, error: 'Coordonnées GPS manquantes' }\n    }\n\n    // Récupérer les informations de la session\n    const { data: session, error } = await this.supabase\n      .from('sessions')\n      .select('latitude, longitude, require_location_for_attendance, allowed_attendance_radius_meters')\n      .eq('id', sessionId)\n      .single()\n\n    if (error || !session) {\n      return { valid: false, verified: false, error: 'Session non trouvée' }\n    }\n\n    const sessionData = session as any\n\n    // Si la géolocalisation n'est pas requise, c'est valide\n    if (!sessionData.require_location_for_attendance) {\n      return { valid: true, verified: false }\n    }\n\n    // Si la session n'a pas de coordonnées GPS, on ne peut pas vérifier\n    if (!sessionData.latitude || !sessionData.longitude) {\n      return { valid: true, verified: false, error: 'Session sans coordonnées GPS' }\n    }\n\n    // Calculer la distance\n    const distance = this.calculateDistance(\n      sessionData.latitude,\n      sessionData.longitude,\n      latitude,\n      longitude\n    )\n\n    // Vérifier le rayon autorisé\n    if (sessionData.allowed_attendance_radius_meters) {\n      if (distance > sessionData.allowed_attendance_radius_meters) {\n        return {\n          valid: false,\n          verified: false,\n          error: `Vous êtes trop loin de la session (${Math.round(distance)}m, maximum: ${sessionData.allowed_attendance_radius_meters}m)`,\n          distance,\n        }\n      }\n    }\n\n    return { valid: true, verified: true, distance }\n  }\n\n  /**\n   * Calcule la distance entre deux points GPS (formule de Haversine)\n   */\n  private calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n    const R = 6371e3 // Rayon de la Terre en mètres\n    const φ1 = (lat1 * Math.PI) / 180\n    const φ2 = (lat2 * Math.PI) / 180\n    const Δφ = ((lat2 - lat1) * Math.PI) / 180\n    const Δλ = ((lon2 - lon1) * Math.PI) / 180\n\n    const a =\n      Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +\n      Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ / 2) * Math.sin(Δλ / 2)\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a))\n\n    return R * c // Distance en mètres\n  }\n\n  /**\n   * Met à jour un émargement\n   */\n  async update(id: string, updates: AttendanceUpdate) {\n    try {\n      const { data, error } = await this.supabase\n        .from('attendance')\n        .update(updates)\n        .eq('id', id)\n        .select()\n        .single()\n\n      if (error) {\n        if (error.code === 'PGRST116' || error.code === '42P01') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_NOT_FOUND,\n            operation: 'update',\n            id,\n          })\n        }\n        if (error.code === '42501') {\n          throw errorHandler.handleError(error, {\n            code: ErrorCode.DB_RLS_POLICY_VIOLATION,\n            operation: 'update',\n            id,\n          })\n        }\n        throw errorHandler.handleError(error, {\n          operation: 'update',\n          id,\n          updates,\n        })\n      }\n\n      if (!data) {\n        throw errorHandler.createDatabaseError(\n          `Émargement avec l'ID ${id} introuvable pour la mise à jour`,\n          { id }\n        )\n      }\n\n      logger.info('Émargement mis à jour avec succès', {\n        id,\n        updates,\n      })\n\n      return data\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'update',\n        id,\n        updates,\n      })\n    }\n  }\n\n  /**\n   * Marque plusieurs présences en une fois\n   */\n  async markMultiple(\n    organizationId: string,\n    records: Array<{\n      student_id: string\n      class_id?: string\n      session_id?: string // Utiliser session_id au lieu de program_session_id\n      date: string\n      status: 'present' | 'absent' | 'late' | 'excused'\n      late_minutes?: number\n      teacher_id?: string\n      notes?: string\n    }>\n  ) {\n    const attendanceRecords = records.map((record) => ({\n      organization_id: organizationId,\n      ...record,\n      late_minutes: record.late_minutes || 0,\n    }))\n\n    try {\n      if (!records || records.length === 0) {\n        throw errorHandler.createValidationError(\n          'Aucun enregistrement à marquer',\n          'records'\n        )\n      }\n\n      const { data, error } = await this.supabase\n        .from('attendance')\n        .upsert(attendanceRecords, {\n          onConflict: 'student_id,class_id,session_id,date',\n        })\n        .select()\n\n      if (error) {\n        throw errorHandler.handleError(error, {\n          operation: 'markMultiple',\n          organizationId,\n          count: records.length,\n        })\n      }\n\n      logger.info('Présences marquées en masse avec succès', {\n        organizationId,\n        count: data?.length || 0,\n      })\n\n      return data || []\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'markMultiple',\n        organizationId,\n      })\n    }\n  }\n\n  /**\n   * Récupère les statistiques de présence pour un élève\n   */\n  async getStudentStats(studentId: string, startDate?: string, endDate?: string) {\n    let query = this.supabase\n      .from('attendance')\n      .select('status, date')\n      .eq('student_id', studentId)\n\n    if (startDate) {\n      query = query.gte('date', startDate)\n    }\n\n    if (endDate) {\n      query = query.lte('date', endDate)\n    }\n\n    try {\n      const { data, error } = await query\n\n      if (error) throw error\n\n      const total = data?.length || 0\n      const present = data?.filter((a) => a.status === 'present').length || 0\n      const absent = data?.filter((a) => a.status === 'absent').length || 0\n      const late = data?.filter((a) => a.status === 'late').length || 0\n      const excused = data?.filter((a) => a.status === 'excused').length || 0\n\n      return {\n        total,\n        present,\n        absent,\n        late,\n        excused,\n        attendanceRate: total > 0 ? (present / total) * 100 : 0,\n      }\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'getStudentStats',\n        studentId,\n      })\n    }\n  }\n\n  /**\n   * Récupère les statistiques de présence pour une classe\n   */\n  async getClassStats(classId: string, date?: string) {\n    let query = this.supabase\n      .from('attendance')\n      .select('status')\n      .eq('class_id', classId)\n\n    if (date) {\n      query = query.eq('date', date)\n    }\n\n    try {\n      const { data, error } = await query\n\n      if (error) {\n        throw errorHandler.handleError(error, {\n          operation: 'getClassStats',\n          classId,\n          date,\n        })\n      }\n\n      const total = data?.length || 0\n      const present = data?.filter((a) => a.status === 'present').length || 0\n      const absent = data?.filter((a) => a.status === 'absent').length || 0\n\n      return {\n        total,\n        present,\n        absent,\n        attendanceRate: total > 0 ? (present / total) * 100 : 0,\n      }\n    } catch (error) {\n      if (error instanceof AppError) {\n        throw error\n      }\n      throw errorHandler.handleError(error, {\n        operation: 'getClassStats',\n        classId,\n      })\n    }\n  }\n\n  /**\n   * Sauvegarde une signature d'enseignant\n   */\n  async saveTeacherSignature(attendanceId: string, signatureUrl: string) {\n    return this.update(attendanceId, {\n      teacher_signature_url: signatureUrl,\n    })\n  }\n}\n\nexport const attendanceService = new AttendanceService()\n"],"names":[],"mappings":"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","ignoreList":[0,1,2,3,4]}