module.exports=[385239,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(703130),e=a.i(340695),f=a.i(254161),g=a.i(205522);a.i(460355);var h=a.i(346271),i=a.i(497895),j=a.i(546842),k=a.i(724669),l=a.i(911300),m=a.i(93518),n=a.i(124987),o=a.i(941675),p=a.i(641710),q=a.i(284505),r=a.i(717371),s=a.i(177156),t=a.i(452495),u=a.i(587532),v=a.i(495756),w=a.i(54018),x=a.i(290821),y=a.i(255225),z=a.i(660246),A=a.i(469769),B=a.i(911156);let C=(0,a.i(170106).default)("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);var D=a.i(705151),E=a.i(669520),F=a.i(526017),G=a.i(53569),H=a.i(370025),I=a.i(823292),J=a.i(433217),K=a.i(104720),L=a.i(915618),M=a.i(992258),N=a.i(163584),O=a.i(864037);function P({studentId:a,organizationId:c}){let{addToast:f}=(0,O.useToast)(),{data:g,isLoading:h}=(0,J.useQuery)({queryKey:["student-documents",a,c],queryFn:async()=>c?N.documentService.getAll(c,{studentId:a}):{data:[],total:0,page:1,limit:50,totalPages:0},enabled:!!a&&!!c});return(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"text-base flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"flex items-center",children:[(0,b.jsx)(K.FileText,{className:"h-5 w-5 mr-2"}),"Documents partagés"]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>{f({type:"info",title:"Fonctionnalité à venir",description:"L'upload de documents sera implémenté prochainement. Vous pourrez ajouter des supports de cours, exercices et autres documents.",duration:7e3})},children:[(0,b.jsx)(L.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter un document"]})]})}),(0,b.jsx)(d.CardContent,{children:h?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Chargement des documents..."}):g&&g.data&&g.data.length>0?(0,b.jsx)("div",{className:"space-y-3",children:g.data.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3 flex-1",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:(a=>{switch(a){case"certificate":return(0,b.jsx)(m.Award,{className:"h-4 w-4"});case"transcript":case"attestation":case"contract":default:return(0,b.jsx)(K.FileText,{className:"h-4 w-4"});case"convocation":return(0,b.jsx)(M.Mail,{className:"h-4 w-4"})}})(a.type)}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium",children:a.title}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(a=>{switch(a){case"certificate":return"Certificat";case"transcript":return"Relevé de notes";case"attestation":return"Attestation";case"contract":return"Contrat";case"convocation":return"Convocation";case"invoice":return"Facture";case"receipt":return"Reçu";default:return a}})(a.type),a.created_at&&` • ${(0,i.formatDate)(a.created_at)}`]})]})]}),(0,b.jsx)("div",{className:"flex items-center space-x-2",children:a.file_url&&(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>{a.file_url&&window.open(a.file_url,"_blank")},children:(0,b.jsx)(q.Download,{className:"h-4 w-4"})})})]},a.id))}):(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(K.FileText,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"Aucun document partagé pour le moment"}),(0,b.jsx)("p",{className:"text-xs mt-1",children:"Les supports de cours et exercices apparaîtront ici"})]})})]})}var Q=a.i(602150),R=a.i(965733),S=a.i(887682),T=a.i(917171),U=a.i(46143),V=a.i(781560),W=a.i(953722),X=a.i(71277),Y=a.i(937927),Z=a.i(269240),$=a.i(238246);function _({sessionId:a,organizationId:h,enrollments:j}){let l=(0,Z.createClient)(),m=(0,Y.useQueryClient)(),[n,o]=(0,c.useState)(!1),[q,r]=(0,c.useState)(""),[u,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)(""),[E,G]=(0,c.useState)(null),[K,M]=(0,c.useState)("student"),[N,O]=(0,c.useState)(null),P=a=>{let b=a?.code,c=a?.status,d=(a?.message||"").toLowerCase();return"PGRST116"===b||"PGRST205"===b||"42P01"===b||404===c||d.includes("could not find the table")||d.includes("schema cache")||d.includes("does not exist")},{data:_,isLoading:aa}=(0,J.useQuery)({queryKey:["session-courses",a],queryFn:async()=>{try{let{data:b,error:c}=await l.from("session_courses").select(`
            *,
            course:courses(
              id, title, slug, short_description, difficulty_level,
              estimated_duration_hours, thumbnail_url, is_published
            )
          `).eq("session_id",a).order("assigned_at",{ascending:!1});if(c){if(P(c))return[];throw c}return b||[]}catch(a){if(P(a))return[];return console.warn("Error fetching session courses:",a),[]}},enabled:!!a}),{data:ab}=(0,J.useQuery)({queryKey:["available-courses",h],queryFn:async()=>{try{let{data:a,error:b}=await l.from("courses").select("id, title, slug, is_published, difficulty_level").eq("organization_id",h).eq("is_published",!0).order("title",{ascending:!0});if(b){if("PGRST116"===b.code||"42P01"===b.code)return[];throw b}return a||[]}catch(a){return console.warn("Error fetching available courses:",a),[]}},enabled:!!h}),{data:ac}=(0,J.useQuery)({queryKey:["session-elearning-progress",a,_?.map(a=>a.course_id)],queryFn:async()=>{if(!_?.length||!j.length)return[];let a=_.map(a=>a.course_id),b=j.map(a=>a.student_id).filter(a=>null!==a);try{let{data:c,error:d}=await l.from("course_enrollments").select("*").in("course_id",a).in("student_id",b);if(d){if(P(d))return[];return console.warn("Error fetching course enrollments:",d),[]}let{data:e,error:f}=await l.from("lesson_progress").select("*, lessons(course_id)").in("student_id",b);f&&!P(f)&&console.warn("Error fetching lesson progress:",f);let{data:g,error:h}=await l.from("lessons").select("id, course_id").in("course_id",a);h&&!P(h)&&console.warn("Error fetching lessons:",h);let{data:i,error:k}=await l.from("quiz_attempts").select("*, quizzes(lesson_id, lessons(course_id))").in("student_id",b).not("completed_at","is",null);k&&!P(k)&&console.warn("Error fetching quiz attempts:",k);let m=[];for(let a of j){let b=a.students;if(b)for(let c of _){let d=c.course_id,f=(g?.filter(a=>a.course_id===d)||[]).length,h=(e||[]).filter(b=>b.student_id===a.student_id&&b.lessons?.course_id===d),j=h.filter(a=>a.is_completed).length,k=f>0?Math.round(j/f*100):0,l=(i||[]).filter(b=>b.student_id===a.student_id&&b.quizzes?.lessons?.course_id===d),n=l.length>0?Math.round(l.reduce((a,b)=>a+(b.score||0),0)/l.length):null,o=h.sort((a,b)=>new Date(b.last_accessed_at||b.started_at||b.completed_at||0).getTime()-new Date(a.last_accessed_at||a.started_at||a.completed_at||0).getTime())[0],p="not_started";j>0&&j>=f?p="completed":j>0&&(p="in_progress"),a.student_id&&m.push({student_id:a.student_id,student_name:`${b.first_name} ${b.last_name}`,course_id:d,progress:k,completed_lessons:j,total_lessons:f,quiz_score:n,last_activity:o?.last_accessed_at||o?.started_at||o?.completed_at||null,status:p})}}return m}catch(a){if(P(a))return[];return console.warn("Error calculating progress:",a),[]}},enabled:!!_?.length&&!!j.length}),ad=(0,H.useMutation)({mutationFn:async()=>{if(!q)throw Error("Veuillez sélectionner un cours");let{data:b,error:c}=await l.from("session_courses").insert({session_id:a,course_id:q,is_required:u,due_date:C||null}).select().single();if(c)throw c;return b},onSuccess:()=>{I.toast.success("Cours ajouté à la session"),m.invalidateQueries({queryKey:["session-courses",a]}),o(!1),r(""),B(!0),D("")},onError:a=>{I.toast.error(a.message||"Erreur lors de l'ajout du cours")}}),ae=(0,H.useMutation)({mutationFn:async a=>{let{error:b}=await l.from("session_courses").delete().eq("id",a);if(b)throw b},onSuccess:()=>{I.toast.success("Cours retiré de la session"),m.invalidateQueries({queryKey:["session-courses",a]})},onError:a=>{I.toast.error(a.message||"Erreur lors de la suppression du cours")}}),af=(()=>{if(!ac?.length||!_?.length)return{avgProgress:0,completed:0,inProgress:0,notStarted:0,avgScore:null};let a=ac.length,b=Math.round(ac.reduce((a,b)=>a+b.progress,0)/a),c=ac.filter(a=>"completed"===a.status).length,d=ac.filter(a=>"in_progress"===a.status).length,e=ac.filter(a=>"not_started"===a.status).length,f=ac.filter(a=>null!==a.quiz_score);return{avgProgress:b,completed:c,inProgress:d,notStarted:e,avgScore:f.length>0?Math.round(f.reduce((a,b)=>a+(b.quiz_score||0),0)/f.length):null}})(),ag=(ab||[]).filter(a=>!_?.some(b=>b.course_id===a.id)),ah=(ac||[]).reduce((a,b)=>(a[b.student_id]=a[b.student_id]||{student_id:b.student_id,student_name:b.student_name,courses:[]},a[b.student_id].courses.push(b),a),{});return aa?(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"py-12",children:(0,b.jsx)("div",{className:"flex items-center justify-center",children:(0,b.jsx)(F.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})})})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)(d.Card,{className:"border-purple-200 bg-gradient-to-r from-purple-50/50 to-indigo-50/50",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(d.CardTitle,{className:"text-lg flex items-center",children:[(0,b.jsx)(A.GraduationCap,{className:"h-5 w-5 mr-2 text-purple-600"}),"E-Learning de la session"]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,b.jsxs)("div",{className:"flex rounded-lg border bg-white/70 p-1",children:[(0,b.jsx)("button",{type:"button",className:(0,i.cn)("px-3 py-1 text-sm rounded-md","student"===K?"bg-purple-600 text-white":"text-gray-700"),onClick:()=>M("student"),children:"Suivi nominatif"}),(0,b.jsx)("button",{type:"button",className:(0,i.cn)("px-3 py-1 text-sm rounded-md","course"===K?"bg-purple-600 text-white":"text-gray-700"),onClick:()=>M("course"),children:"Par séquence"})]}),(0,b.jsxs)(e.Button,{onClick:()=>o(!0),disabled:0===ag.length,className:"bg-purple-600 hover:bg-purple-700",children:[(0,b.jsx)(L.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une séquence"]})]})]})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Assignez des séquences e-learning aux apprenants de cette session et suivez leur progression."})})]}),_&&_.length>0&&(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Séquences"}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:_.length})]}),(0,b.jsx)(W.BookOpen,{className:"h-8 w-8 text-purple-600 opacity-50"})]})})}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Progression moy."}),(0,b.jsxs)("p",{className:"text-2xl font-bold",children:[af.avgProgress,"%"]})]}),(0,b.jsx)(k.TrendingUp,{className:"h-8 w-8 text-blue-600 opacity-50"})]})})}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Terminés"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-green-600",children:af.completed})]}),(0,b.jsx)(v.CheckCircle,{className:"h-8 w-8 text-green-600 opacity-50"})]})})}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"En cours"}),(0,b.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:af.inProgress})]}),(0,b.jsx)(X.PlayCircle,{className:"h-8 w-8 text-yellow-600 opacity-50"})]})})}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Score moy."}),(0,b.jsx)("p",{className:"text-2xl font-bold",children:null!==af.avgScore?`${af.avgScore}%`:"N/A"})]}),(0,b.jsx)(y.BarChart3,{className:"h-8 w-8 text-indigo-600 opacity-50"})]})})})]}),_&&0!==_.length?(0,b.jsx)(b.Fragment,{children:"student"===K?(0,b.jsx)("div",{className:"space-y-4",children:j.map(a=>{let c,g,h,j,k,l,m=a.students;if(!m||!a.student_id)return null;let n=a.student_id,o=(g=(c=ah?.[n]?.courses||[]).length?Math.round(c.reduce((a,b)=>a+b.progress,0)/c.length):0,h=c.filter(a=>"completed"===a.status).length,j=c.filter(a=>"in_progress"===a.status).length,k=c.filter(a=>"not_started"===a.status).length,{avgProgress:g,completed:h,inProgress:j,notStarted:k,avgScore:(l=c.filter(a=>null!==a.quiz_score).map(a=>a.quiz_score)).length?Math.round(l.reduce((a,b)=>a+b,0)/l.length):null}),p=N===n,q=ah?.[n]?.courses||[];return(0,b.jsx)(d.Card,{className:"overflow-hidden",children:(0,b.jsxs)(d.CardContent,{className:"p-0",children:[(0,b.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:(0,b.jsx)(z.Users,{className:"h-5 w-5 text-purple-600"})}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsxs)("p",{className:"font-semibold truncate",children:[m.first_name," ",m.last_name]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:m.email})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-6 mr-4",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Progression"}),(0,b.jsxs)("p",{className:"text-sm font-semibold",children:[o.avgProgress,"%"]})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Terminés"}),(0,b.jsx)("p",{className:"text-sm font-semibold text-green-600",children:o.completed})]}),null!==o.avgScore&&(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Score"}),(0,b.jsxs)("p",{className:"text-sm font-semibold",children:[o.avgScore,"%"]})]})]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>O(p?null:a.student_id),children:[(0,b.jsx)(s.Eye,{className:"h-4 w-4 mr-2"}),p?"Masquer":"Détails"]})]}),(0,b.jsx)("div",{className:"px-4 pb-4",children:(0,b.jsx)(Q.Progress,{value:o.avgProgress,className:"h-2"})}),p&&(0,b.jsx)("div",{className:"border-t bg-gray-50/50 p-4 space-y-2",children:0===q.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune séquence assignée ou aucune progression enregistrée."}):q.map(a=>{let c=_.find(b=>b.course_id===a.course_id);return(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-sm truncate",children:c?.course?.title||"Séquence"}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.completed_lessons,"/",a.total_lessons," leçons",a.last_activity&&` • Derni\xe8re activit\xe9: ${(0,i.formatDate)(a.last_activity)}`]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"w-24",children:[(0,b.jsx)(Q.Progress,{value:a.progress,className:"h-2"}),(0,b.jsxs)("p",{className:"text-xs text-center mt-1",children:[a.progress,"%"]})]}),null!==a.quiz_score&&(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Quiz"}),(0,b.jsxs)("p",{className:"text-sm font-semibold",children:[a.quiz_score,"%"]})]}),(0,b.jsx)(f.Badge,{variant:"completed"===a.status?"default":"in_progress"===a.status?"secondary":"outline",children:"completed"===a.status?"Terminé":"in_progress"===a.status?"En cours":"Non commencé"})]})]},`${a.student_id}-${a.course_id}`)})})]})},a.student_id)})}):(0,b.jsx)("div",{className:"space-y-4",children:_.map(a=>{let c=a.course;if(!c)return null;let g=(a=>{let b=ac?.filter(b=>b.course_id===a)||[];if(!b.length)return{avgProgress:0,completed:0,total:j.length,avgScore:null};let c=Math.round(b.reduce((a,b)=>a+b.progress,0)/b.length),d=b.filter(a=>"completed"===a.status).length,e=b.filter(a=>null!==a.quiz_score),f=e.length>0?Math.round(e.reduce((a,b)=>a+(b.quiz_score||0),0)/e.length):null;return{avgProgress:c,completed:d,total:j.length,avgScore:f}})(a.course_id),h=E===a.id,k=ac?.filter(b=>b.course_id===a.course_id)||[];return(0,b.jsx)(d.Card,{className:"overflow-hidden",children:(0,b.jsxs)(d.CardContent,{className:"p-0",children:[(0,b.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[c.thumbnail_url?(0,b.jsx)("img",{src:c.thumbnail_url,alt:c.title,className:"w-16 h-16 rounded-lg object-cover"}):(0,b.jsx)("div",{className:"w-16 h-16 rounded-lg bg-purple-100 flex items-center justify-center",children:(0,b.jsx)(W.BookOpen,{className:"h-8 w-8 text-purple-600"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,b.jsx)("h3",{className:"font-semibold",children:c.title}),a.is_required&&(0,b.jsx)(f.Badge,{variant:"secondary",className:"text-xs",children:"Obligatoire"}),(0,b.jsx)(f.Badge,{variant:"outline",className:"text-xs",children:"beginner"===c.difficulty_level?"Débutant":"intermediate"===c.difficulty_level?"Intermédiaire":"Avancé"})]}),c.short_description&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-1",children:c.short_description}),(0,b.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[c.estimated_duration_hours&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(p.Clock,{className:"h-3 w-3"}),c.estimated_duration_hours,"h"]}),a.due_date&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(x.AlertCircle,{className:"h-3 w-3"}),"Échéance: ",(0,i.formatDate)(a.due_date)]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-6 mr-4",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Progression"}),(0,b.jsxs)("p",{className:"text-sm font-semibold",children:[g.avgProgress,"%"]})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Terminés"}),(0,b.jsxs)("p",{className:"text-sm font-semibold text-green-600",children:[g.completed,"/",g.total]})]}),null!==g.avgScore&&(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Score"}),(0,b.jsxs)("p",{className:"text-sm font-semibold",children:[g.avgScore,"%"]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsxs)(e.Button,{variant:"ghost",size:"sm",onClick:()=>G(h?null:a.id),children:[(0,b.jsx)(s.Eye,{className:"h-4 w-4 mr-1"}),h?"Masquer":"Détails"]}),(0,b.jsx)($.default,{href:`/dashboard/elearning/courses/${c.slug}`,target:"_blank",children:(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",children:(0,b.jsx)(t.ExternalLink,{className:"h-4 w-4"})})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>ae.mutate(a.id),disabled:ae.isPending,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,b.jsx)(V.Trash2,{className:"h-4 w-4"})})]})]}),(0,b.jsx)("div",{className:"px-4 pb-4",children:(0,b.jsx)(Q.Progress,{value:g.avgProgress,className:"h-2"})}),h&&(0,b.jsxs)("div",{className:"border-t bg-gray-50/50 p-4",children:[(0,b.jsxs)("h4",{className:"text-sm font-medium mb-3 flex items-center",children:[(0,b.jsx)(z.Users,{className:"h-4 w-4 mr-2"}),"Progression par apprenant"]}),(0,b.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:0===k.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune donnée de progression disponible"}):k.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,b.jsx)("div",{className:(0,i.cn)("w-8 h-8 rounded-full flex items-center justify-center","completed"===a.status?"bg-green-100":"in_progress"===a.status?"bg-yellow-100":"bg-gray-100"),children:"completed"===a.status?(0,b.jsx)(v.CheckCircle,{className:"h-4 w-4 text-green-600"}):"in_progress"===a.status?(0,b.jsx)(X.PlayCircle,{className:"h-4 w-4 text-yellow-600"}):(0,b.jsx)(w.XCircle,{className:"h-4 w-4 text-gray-400"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-sm",children:a.student_name}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.completed_lessons,"/",a.total_lessons," leçons",a.last_activity&&` • Derni\xe8re activit\xe9: ${(0,i.formatDate)(a.last_activity)}`]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"w-24",children:[(0,b.jsx)(Q.Progress,{value:a.progress,className:"h-2"}),(0,b.jsxs)("p",{className:"text-xs text-center mt-1",children:[a.progress,"%"]})]}),null!==a.quiz_score&&(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Quiz"}),(0,b.jsxs)("p",{className:"text-sm font-semibold",children:[a.quiz_score,"%"]})]}),(0,b.jsx)(f.Badge,{variant:"completed"===a.status?"default":"in_progress"===a.status?"secondary":"outline",children:"completed"===a.status?"Terminé":"in_progress"===a.status?"En cours":"Non commencé"})]})]},`${a.student_id}-${a.course_id}`))})]})]})},a.id)})})}):(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"py-12",children:(0,b.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,b.jsx)(A.GraduationCap,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{className:"text-lg font-medium mb-2",children:"Aucune séquence e-learning assignée"}),(0,b.jsx)("p",{className:"text-sm mb-4",children:"Ajoutez des séquences e-learning pour permettre aux apprenants de suivre des cours en ligne."}),ag.length>0?(0,b.jsxs)(e.Button,{onClick:()=>o(!0),className:"bg-purple-600 hover:bg-purple-700",children:[(0,b.jsx)(L.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une séquence"]}):(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Aucun cours e-learning disponible."," ",(0,b.jsx)($.default,{href:"/dashboard/elearning",className:"text-purple-600 hover:underline",children:"Créer un cours"})]})]})})}),(0,b.jsx)(R.Dialog,{open:n,onOpenChange:o,children:(0,b.jsxs)(R.DialogContent,{children:[(0,b.jsxs)(R.DialogHeader,{children:[(0,b.jsx)(R.DialogTitle,{children:"Ajouter une séquence e-learning"}),(0,b.jsx)(R.DialogDescription,{children:"Sélectionnez une séquence à assigner aux apprenants de cette session."})]}),(0,b.jsxs)("div",{className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(T.Label,{children:"Séquence e-learning"}),(0,b.jsxs)(S.Select,{value:q,onValueChange:r,children:[(0,b.jsx)(S.SelectTrigger,{children:(0,b.jsx)(S.SelectValue,{placeholder:"Sélectionner une séquence"})}),(0,b.jsx)(S.SelectContent,{children:ag.map(a=>(0,b.jsx)(S.SelectItem,{value:a.id,children:a.title},a.id))})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(U.Checkbox,{id:"isRequired",checked:u,onCheckedChange:a=>B(a)}),(0,b.jsx)(T.Label,{htmlFor:"isRequired",className:"cursor-pointer",children:"Séquence obligatoire"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(T.Label,{children:"Date limite (optionnel)"}),(0,b.jsx)(g.Input,{type:"date",value:C,onChange:a=>D(a.target.value)})]})]}),(0,b.jsxs)(R.DialogFooter,{children:[(0,b.jsx)(e.Button,{variant:"outline",onClick:()=>o(!1),children:"Annuler"}),(0,b.jsx)(e.Button,{onClick:()=>ad.mutate(),disabled:!q||ad.isPending,className:"bg-purple-600 hover:bg-purple-700",children:ad.isPending?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(F.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Ajout..."]}):"Ajouter"})]})]})})]})}var aa=a.i(242255);function ab({sessionId:a,sessionData:K,formation:L,program:M,organization:N,enrollments:O=[],grades:Q=[],attendanceStats:R,organizationId:S,onShowEnrollmentForm:T,onSwitchToGestion:U}){let[V,W]=(0,c.useState)(""),[X,Y]=(0,c.useState)(null),[ab,ac]=(0,c.useState)(!1),[ad,ae]=(0,c.useState)([]),af=(0,Z.createClient)(),ag=(0,H.useMutation)({mutationFn:async({studentId:a,studentName:b,studentEmail:c})=>({studentId:a,studentName:b,studentEmail:c,accessUrl:`http://localhost:3001/learner/access/${a}`,expiresAt:new Date(Date.now()+2592e6).toISOString()}),onSuccess:a=>{ae(b=>{let c=b.findIndex(b=>b.studentId===a.studentId);if(c>=0){let d=[...b];return d[c]=a,d}return[...b,a]}),I.toast.success(`Lien g\xe9n\xe9r\xe9 pour ${a.studentName}`)},onError:a=>{I.toast.error(a.message)}}),ah=(0,H.useMutation)({mutationFn:async()=>{if(!O?.length)throw Error("Aucun étudiant inscrit à cette session");let a=O.map(a=>({studentId:a.students.id,studentName:`${a.students.first_name} ${a.students.last_name}`,studentEmail:a.students.email,accessUrl:`http://localhost:3001/learner/access/${a.students.id}`,expiresAt:new Date(Date.now()+2592e6).toISOString()}));return{tokens:a,count:a.length}},onSuccess:a=>{ae(a.tokens||[]),I.toast.success(`${a.count} liens d'acc\xe8s g\xe9n\xe9r\xe9s avec succ\xe8s`)},onError:a=>{I.toast.error(a.message)}}),ai=async(a,b)=>{try{await navigator.clipboard.writeText(a),I.toast.success(`Lien copi\xe9 pour ${b}`)}catch{I.toast.error("Impossible de copier le lien")}},aj=async()=>{if(0===ad.length)return;let a=ad.map(a=>`${a.studentName}: ${a.accessUrl}`).join("\n");try{await navigator.clipboard.writeText(a),I.toast.success("Tous les liens ont été copiés")}catch{I.toast.error("Impossible de copier les liens")}},{handleGenerateCertificate:ak}=(0,aa.useDocumentGeneration)({sessionData:K,formation:L,program:M,organization:N}),{data:al,refetch:am}=(0,J.useQuery)({queryKey:["student-payments",X,a,S],queryFn:async()=>{if(!X||!S)return[];let{data:a,error:b}=await af.from("payments").select("*, invoices(invoice_number, total_amount, status), students(first_name, last_name)").eq("student_id",X).eq("organization_id",S).order("paid_at",{ascending:!1});return b?(console.warn("Error fetching student payments:",b),[]):a||[]},enabled:!!X&&!!S,refetchOnWindowFocus:!0,refetchOnMount:!0}),{data:an,refetch:ao}=(0,J.useQuery)({queryKey:["student-attendance-details",X,a],queryFn:async()=>{if(!X||!a)return[];let{data:b,error:c}=await af.from("attendance").select("*, session_slots(date, start_time, end_time)").eq("student_id",X).eq("session_id",a).order("created_at",{ascending:!1});return c?(console.warn("Error fetching student attendance:",c),[]):b||[]},enabled:!!X&&!!a,refetchOnWindowFocus:!0,refetchOnMount:!0}),{data:ap,refetch:aq}=(0,J.useQuery)({queryKey:["student-grades-details",X,a],queryFn:async()=>{if(!X||!a)return[];let{data:b,error:c}=await af.from("grades").select("*").eq("student_id",X).eq("session_id",a).order("graded_at",{ascending:!1});return c?(console.warn("Error fetching student grades:",c),[]):b||[]},enabled:!!X&&!!a,refetchOnWindowFocus:!0,refetchOnMount:!0}),ar=O.filter(a=>{if(!V)return!0;let b=a.students;if(!b)return!1;let c=V.toLowerCase();return b.first_name?.toLowerCase().includes(c)||b.last_name?.toLowerCase().includes(c)||b.email?.toLowerCase().includes(c)||b.student_number?.toLowerCase().includes(c)}),as=O.length,at=O.filter(a=>"confirmed"===a.status).length,au=O.filter(a=>"completed"===a.status).length,av=R&&as>0?Math.round(R.present/R.total*100):0;if(0===O.length)return(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"py-12",children:(0,b.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,b.jsx)(j.User,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),(0,b.jsx)("p",{className:"text-lg font-medium mb-2",children:"Aucun apprenant inscrit"}),(0,b.jsx)("p",{className:"text-sm mb-4",children:"Les apprenants inscrits à cette session apparaîtront ici"}),(0,b.jsxs)(e.Button,{variant:"outline",onClick:()=>{U(),T()},children:[(0,b.jsx)(r.UserPlus,{className:"h-4 w-4 mr-2"}),"Inscrire un apprenant"]})]})})});if(X){let a=O.find(a=>a.student_id===X);if(!a)return Y(null),null;let c=a.students;if(!c)return null;let f=an||[],g=ap||[],r=al||[],s=f.filter(a=>"present"===a.status||"late"===a.status).length,u=f.length,y=u>0?{present:s,total:u}:a.student_id&&R?.byStudent?.[a.student_id]||{present:0,total:0},z=y.total>0?Math.round(y.present/y.total*100):0,A=g.length>0?g:Q.filter(b=>b.student_id===a.student_id);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(e.Button,{variant:"ghost",onClick:()=>Y(null),children:"← Retour à la liste"}),(0,b.jsxs)("h2",{className:"text-2xl font-bold",children:["Espace Apprenant - ",c.first_name," ",c.last_name]}),(0,b.jsx)("div",{className:"w-24"})," "]}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:(0,b.jsx)(j.User,{className:"h-8 w-8 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(d.CardTitle,{className:"text-xl",children:[c.first_name," ",c.last_name]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[c.student_number,c.email&&` • ${c.email}`]})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)($.default,{href:"/learner",target:"_blank",children:(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(t.ExternalLink,{className:"h-4 w-4 mr-2"}),"Voir son espace"]})}),(0,b.jsx)("span",{className:`px-3 py-1 rounded text-sm ${"completed"===a.status?"bg-brand-blue-ghost text-brand-blue":"confirmed"===a.status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:"completed"===a.status?"Terminé":"confirmed"===a.status?"Confirmé":"En attente"})]})]})})}),K&&(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsx)(d.CardTitle,{className:"text-base",children:"Informations de la session"})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[K.start_date&&(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(o.Calendar,{className:"h-5 w-5 text-brand-blue"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Dates"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,i.formatDate)(K.start_date),K.end_date&&` - ${(0,i.formatDate)(K.end_date)}`]})]})]}),(K.start_time||K.end_time)&&(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(p.Clock,{className:"h-5 w-5 text-blue-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Horaires"}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground",children:[K.start_time||"N/A",K.end_time&&` - ${K.end_time}`]})]})]}),K.location&&(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(n.MapPin,{className:"h-5 w-5 text-red-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Lieu"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:K.location})]})]}),L&&(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(l.ClipboardList,{className:"h-5 w-5 text-purple-600"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Formation"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:L.name})]})]})]})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"text-base flex items-center",children:[(0,b.jsx)(k.TrendingUp,{className:"h-5 w-5 mr-2"}),"Progression"]})}),(0,b.jsx)(d.CardContent,{children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-sm font-medium",children:"Taux de présence"}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:[z,"%"]})]}),(0,b.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,b.jsx)(h.motion.div,{className:"bg-brand-blue h-3 rounded-full transition-all",style:{width:`${z}%`}})}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-2 text-xs text-muted-foreground",children:[(0,b.jsxs)("span",{children:[y.present," présent",y.present>1?"s":""]}),(0,b.jsxs)("span",{children:[y.total-y.present," absent",y.total-y.present>1?"s":""]})]})]}),A.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium mb-3",children:"Notes récentes"}),(0,b.jsx)("div",{className:"space-y-2",children:A.slice(0,5).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:a.subject}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.assessment_type||"Évaluation"," • ",a.graded_at&&(0,i.formatDate)(a.graded_at)]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("p",{className:"text-sm font-bold",children:[a.score,"/",a.max_score||20]}),null!==a.percentage&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.percentage,"%"]})]})]},a.id))})]})]})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"text-base flex items-center",children:[(0,b.jsx)(l.ClipboardList,{className:"h-5 w-5 mr-2"}),"Évaluations"]})}),(0,b.jsx)(d.CardContent,{children:A.length>0?(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mb-3",children:[A.length," évaluation",A.length>1?"s":""," complétée",A.length>1?"s":""]}),(0,b.jsx)("div",{className:"space-y-2",children:A.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(l.ClipboardList,{className:"h-5 w-5 text-brand-blue"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.subject}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.graded_at&&(0,i.formatDate)(a.graded_at)})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("p",{className:"font-bold",children:[a.score,"/",a.max_score||20]}),null!==a.percentage&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.percentage,"%"]})]})]},a.id))})]}):(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(l.ClipboardList,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"Aucune évaluation complétée pour le moment"})]})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"text-base flex items-center",children:[(0,b.jsx)(B.CreditCard,{className:"h-5 w-5 mr-2"}),"Paiements"]})}),(0,b.jsx)(d.CardContent,{children:r.length>0?(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("div",{className:"space-y-2",children:r.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(B.CreditCard,{className:"h-5 w-5 text-brand-blue"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:(0,i.formatCurrency)(a.amount||0,a.currency||"EUR")}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.paid_at?(0,i.formatDate)(a.paid_at):"Date non disponible",a.invoices&&a.invoices.invoice_number&&` • Facture ${a.invoices.invoice_number}`]})]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"completed"===a.status?"bg-green-100 text-green-800":"pending"===a.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:"completed"===a.status?"Payé":"pending"===a.status?"En attente":a.status}),a.payment_method&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"cash"===a.payment_method?"Espèces":"card"===a.payment_method?"Carte":"bank_transfer"===a.payment_method?"Virement":"sepa"===a.payment_method?"SEPA":a.payment_method})]})]},a.id))}),(0,b.jsx)("div",{className:"pt-3 border-t",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("span",{className:"font-medium",children:"Total payé"}),(0,b.jsx)("span",{className:"font-bold text-lg",children:(0,i.formatCurrency)(r.filter(a=>"completed"===a.status).reduce((a,b)=>a+parseFloat(b.amount||0),0),r[0]?.currency||"EUR")})]})})]}):(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(B.CreditCard,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"Aucun paiement enregistré pour le moment"})]})})]}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"text-base flex items-center",children:[(0,b.jsx)(o.Calendar,{className:"h-5 w-5 mr-2"}),"Historique des présences"]})}),(0,b.jsx)(d.CardContent,{children:f.length>0?(0,b.jsx)("div",{className:"space-y-2",children:(0,b.jsx)("div",{className:"space-y-2",children:f.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:["present"===a.status?(0,b.jsx)(v.CheckCircle,{className:"h-5 w-5 text-green-600"}):"late"===a.status?(0,b.jsx)(p.Clock,{className:"h-5 w-5 text-yellow-600"}):"excused"===a.status?(0,b.jsx)(x.AlertCircle,{className:"h-5 w-5 text-blue-600"}):(0,b.jsx)(w.XCircle,{className:"h-5 w-5 text-red-600"}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-medium",children:[a.session_slots?.date?(0,i.formatDate)(a.session_slots.date):"Date non disponible",a.session_slots?.start_time&&a.session_slots?.end_time&&(0,b.jsxs)("span",{className:"text-sm text-muted-foreground ml-2",children:[a.session_slots.start_time," - ",a.session_slots.end_time]})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:a.created_at&&(0,i.formatDate)(a.created_at)})]})]}),(0,b.jsx)("div",{className:"text-right",children:(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"present"===a.status?"bg-green-100 text-green-800":"late"===a.status?"bg-yellow-100 text-yellow-800":"excused"===a.status?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:"present"===a.status?"Présent":"late"===a.status?"En retard":"excused"===a.status?"Excusé":"Absent"})})]},a.id))})}):(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(o.Calendar,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"Aucune présence enregistrée pour le moment"})]})})]}),S&&a.student_id&&(0,b.jsx)(P,{studentId:a.student_id,organizationId:S}),(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)(d.CardTitle,{className:"text-base flex items-center",children:[(0,b.jsx)(m.Award,{className:"h-5 w-5 mr-2"}),"Certificats"]})}),(0,b.jsx)(d.CardContent,{children:"completed"===a.status?(0,b.jsx)("div",{className:"space-y-3",children:(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-warning-bg to-brand-cyan-ghost border border-warning-border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(m.Award,{className:"h-8 w-8 text-brand-cyan"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:"Certificat de formation"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Session terminée avec succès"})]})]}),(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>ak(a),children:[(0,b.jsx)(q.Download,{className:"h-4 w-4 mr-2"}),"Télécharger"]})]})}):(0,b.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,b.jsx)(m.Award,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{className:"text-sm",children:"Le certificat sera disponible une fois la session terminée"})]})})]})]})}return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{label:"Total apprenants",value:as,icon:z.Users,iconBg:"bg-gradient-to-br from-brand-blue to-brand-blue-dark",cardBg:"bg-gradient-to-br from-brand-blue/5 via-brand-blue/10 to-brand-cyan/5",borderColor:"border-brand-blue/20",glowColor:"rgba(39, 68, 114, 0.15)"},{label:"Confirmés",value:at,icon:v.CheckCircle,iconBg:"bg-gradient-to-br from-emerald-500 to-emerald-600",cardBg:"bg-gradient-to-br from-emerald-50 via-emerald-100/50 to-teal-50",borderColor:"border-emerald-200",glowColor:"rgba(16, 185, 129, 0.15)"},{label:"Terminés",value:au,icon:A.GraduationCap,iconBg:"bg-gradient-to-br from-brand-cyan to-brand-cyan-dark",cardBg:"bg-gradient-to-br from-brand-cyan/5 via-brand-cyan/10 to-brand-blue/5",borderColor:"border-brand-cyan/20",glowColor:"rgba(52, 185, 238, 0.15)"},{label:"Présence moyenne",value:`${av}%`,icon:y.BarChart3,iconBg:"bg-gradient-to-br from-purple-500 to-purple-600",cardBg:"bg-gradient-to-br from-purple-50 via-purple-100/50 to-pink-50",borderColor:"border-purple-200",glowColor:"rgba(168, 85, 247, 0.15)"}].map((a,c)=>(0,b.jsx)(h.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.05*c,ease:[.16,1,.3,1]},whileHover:{y:-6,scale:1.02},className:"group relative",children:(0,b.jsxs)(h.motion.div,{className:(0,i.cn)("relative overflow-hidden rounded-2xl p-6 border-2 transition-all duration-500 shadow-lg hover:shadow-2xl",a.cardBg,a.borderColor),style:{boxShadow:`0 10px 40px -10px ${a.glowColor}, 0 0 0 1px rgba(255, 255, 255, 0.1)`},children:[(0,b.jsx)(h.motion.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent",initial:{x:"-100%"},whileHover:{x:"100%"},transition:{duration:.6,ease:"easeInOut"}}),(0,b.jsxs)("div",{className:"relative z-10",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,b.jsx)(h.motion.div,{className:(0,i.cn)("p-3.5 rounded-2xl shadow-xl",a.iconBg),whileHover:{rotate:12,scale:1.15},transition:{type:"spring",stiffness:500,damping:15},children:(0,b.jsx)(a.icon,{className:"h-6 w-6 text-white"})}),(0,b.jsxs)(h.motion.div,{className:"text-right",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.05*c+.2,duration:.5},children:[(0,b.jsx)("div",{className:"text-4xl font-display font-bold tracking-tighter text-gray-900 leading-none mb-1",children:a.value}),(0,b.jsx)("p",{className:"text-xs font-bold text-gray-600 uppercase tracking-widest",children:a.label})]})]}),(0,b.jsx)(h.motion.div,{className:"h-1.5 rounded-full mt-4",style:{background:a.iconBg.replace("bg-gradient-to-br","linear-gradient(to right,")},initial:{scaleX:0},animate:{scaleX:1},transition:{delay:.05*c+.3,duration:.6,ease:[.16,1,.3,1]}})]}),(0,b.jsx)(h.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500",style:{background:`radial-gradient(circle at 50% 50%, ${a.glowColor} 0%, transparent 70%)`}})]})},a.label))}),(0,b.jsxs)(d.Card,{className:"border-blue-200 bg-gradient-to-r from-blue-50/50 to-indigo-50/50",children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(d.CardTitle,{className:"text-base flex items-center",children:[(0,b.jsx)(C,{className:"h-5 w-5 mr-2 text-blue-600"}),"Liens d'accès directs"]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[ab&&ad.length>0&&(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:aj,children:[(0,b.jsx)(D.Copy,{className:"h-4 w-4 mr-2"}),"Copier tous"]}),(0,b.jsxs)(e.Button,{variant:ab?"secondary":"outline",size:"sm",onClick:()=>ac(!ab),children:[(0,b.jsx)(G.Share2,{className:"h-4 w-4 mr-2"}),ab?"Masquer":"Gérer les liens"]})]})]})}),ab&&(0,b.jsx)(d.CardContent,{className:"pt-0",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"text-sm text-muted-foreground bg-white/50 p-3 rounded-lg",children:[(0,b.jsxs)("p",{children:["Générez des liens d'accès personnalisés pour permettre aux stagiaires d'accéder directement à leur espace personnel ",(0,b.jsx)("strong",{children:"sans avoir besoin de se connecter"}),"."]}),(0,b.jsx)("p",{className:"mt-2 text-xs",children:"⏱️ Les liens expirent après 30 jours et peuvent être régénérés à tout moment."})]}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsxs)(e.Button,{onClick:()=>ah.mutate(),disabled:ah.isPending,className:"bg-blue-600 hover:bg-blue-700",children:[ah.isPending?(0,b.jsx)(F.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,b.jsx)(E.RefreshCw,{className:"h-4 w-4 mr-2"}),"Générer tous les liens"]}),(0,b.jsxs)("span",{className:"text-sm text-muted-foreground",children:["(",O.length," apprenant",O.length>1?"s":"",")"]})]}),(0,b.jsxs)("div",{className:"space-y-2 mt-4",children:[(0,b.jsx)("h4",{className:"text-sm font-medium mb-3",children:"Générer des liens pour chaque apprenant :"}),(0,b.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-2",children:O.map(a=>{let c=a.students;if(!c)return null;let d=ad.find(b=>b.studentId===a.student_id),f=`${c.first_name} ${c.last_name}`;return(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,b.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:(0,b.jsx)(j.User,{className:"h-4 w-4 text-blue-600"})}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"font-medium text-sm truncate",children:f}),c.email&&(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate max-w-xs",children:c.email})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2 flex-shrink-0",children:d?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("div",{className:"flex items-center gap-2 min-w-0 max-w-xs",children:(0,b.jsx)("p",{className:"text-xs text-muted-foreground truncate hidden md:block",children:d.accessUrl})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",onClick:()=>ai(d.accessUrl,f),title:"Copier le lien",children:(0,b.jsx)(D.Copy,{className:"h-4 w-4"})}),(0,b.jsx)(e.Button,{variant:"ghost",size:"sm",asChild:!0,title:"Ouvrir le lien",children:(0,b.jsx)("a",{href:d.accessUrl,target:"_blank",rel:"noopener noreferrer",children:(0,b.jsx)(t.ExternalLink,{className:"h-4 w-4"})})}),(0,b.jsx)(e.Button,{variant:"outline",size:"sm",onClick:()=>ag.mutate({studentId:a.student_id||"",studentName:f,studentEmail:c.email||""}),disabled:ag.isPending,title:"Régénérer le lien",children:ag.isPending?(0,b.jsx)(F.Loader2,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(E.RefreshCw,{className:"h-4 w-4"})})]}):(0,b.jsx)(e.Button,{variant:"default",size:"sm",onClick:()=>ag.mutate({studentId:a.student_id||"",studentName:f,studentEmail:c.email||""}),disabled:ag.isPending,className:"bg-blue-600 hover:bg-blue-700",children:ag.isPending?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(F.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Génération..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(C,{className:"h-4 w-4 mr-2"}),"Générer"]})})})]},a.student_id)})})]}),0===ad.length&&!ah.isPending&&(0,b.jsxs)("div",{className:"text-center py-6 text-muted-foreground",children:[(0,b.jsx)(C,{className:"h-10 w-10 mx-auto mb-3 opacity-30"}),(0,b.jsx)("p",{className:"text-sm",children:"Aucun lien généré pour cette session"}),(0,b.jsx)("p",{className:"text-xs mt-1",children:'Cliquez sur "Générer tous les liens" pour créer les accès'})]})]})})]}),S&&(0,b.jsx)(_,{sessionId:a,organizationId:S,enrollments:O}),(0,b.jsx)(d.Card,{children:(0,b.jsx)(d.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)(u.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(g.Input,{placeholder:"Rechercher un apprenant...",value:V,onChange:a=>W(a.target.value),className:"pl-10"})]}),(0,b.jsxs)(e.Button,{variant:"outline",onClick:()=>{U(),T()},children:[(0,b.jsx)(r.UserPlus,{className:"h-4 w-4 mr-2"}),"Ajouter un apprenant"]})]})})}),(0,b.jsx)("div",{className:"space-y-4",children:0===ar.length?(0,b.jsx)(d.Card,{children:(0,b.jsxs)(d.CardContent,{className:"py-12 text-center text-muted-foreground",children:[(0,b.jsx)(j.User,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,b.jsx)("p",{children:"Aucun apprenant trouvé"})]})}):ar.map(a=>{let c,g=a.students;if(!g)return null;let i=a.student_id&&R?.byStudent?.[a.student_id]||{present:0,total:0},k=i.total>0?Math.round(i.present/i.total*100):0,l=a.student_id?Q.filter(b=>b.student_id===a.student_id):[],m=l.length>0?Math.round(l.reduce((a,b)=>a+(null!==b.percentage?b.percentage:(b.score??0)/(b.max_score||20)*100),0)/l.length):null;return(0,b.jsx)(d.Card,{className:"hover:shadow-md transition-shadow",children:(0,b.jsxs)(d.CardContent,{className:"pt-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[(0,b.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:(0,b.jsx)(j.User,{className:"h-6 w-6 text-primary"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsxs)("h3",{className:"font-semibold text-lg",children:[g.first_name," ",g.last_name]}),(0,b.jsx)(f.Badge,{variant:"completed"===a.status?"default":"confirmed"===a.status?"secondary":"outline",children:"completed"===a.status?"Terminé":"confirmed"===a.status?"Confirmé":"En attente"})]}),(0,b.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[g.student_number,g.email&&` • ${g.email}`]})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-6 mr-6",children:[(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Présence"}),(0,b.jsxs)("p",{className:"text-sm font-semibold",children:[k,"%"]})]}),null!==m&&(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Moyenne"}),(0,b.jsxs)("p",{className:"text-sm font-semibold",children:[m,"%"]})]}),(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"Évaluations"}),(0,b.jsx)("p",{className:"text-sm font-semibold",children:l.length})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",onClick:()=>Y(a.student_id),children:[(0,b.jsx)(s.Eye,{className:"h-4 w-4 mr-2"}),"Voir détails"]}),(c=ad.find(b=>b.studentId===a.student_id))?(0,b.jsx)("a",{href:c.accessUrl,target:"_blank",rel:"noopener noreferrer",children:(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(t.ExternalLink,{className:"h-4 w-4 mr-2"}),"Accès direct"]})}):(0,b.jsx)($.default,{href:"/learner",target:"_blank",children:(0,b.jsxs)(e.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(t.ExternalLink,{className:"h-4 w-4 mr-2"}),"Espace apprenant"]})})]})]}),i.total>0&&(0,b.jsxs)("div",{className:"mt-4 pt-4 border-t",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:"Progression de présence"}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:[i.present,"/",i.total," séances"]})]}),(0,b.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,b.jsx)(h.motion.div,{className:`h-2 rounded-full transition-all ${k>=80?"bg-green-500":k>=60?"bg-yellow-500":"bg-red-500"}`,style:{width:`${k}%`}})})]})]})},a.id)})})]})}a.s(["EspaceApprenant",()=>ab],385239)}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_sessions_%5Bid%5D_sections_espace-apprenant_tsx_2a25f1ed._.js.map