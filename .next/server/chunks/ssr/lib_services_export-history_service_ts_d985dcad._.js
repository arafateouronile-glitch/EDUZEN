module.exports=[593547,a=>{"use strict";var b=a.i(269240);class c{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async create(a){try{let{data:b,error:c}=await this.supabase.from("export_history").insert({organization_id:a.organizationId,user_id:a.userId,export_type:a.exportType,entity_type:a.entityType,filename:a.filename,record_count:a.recordCount||0,file_size_bytes:a.fileSizeBytes,filters:a.filters?JSON.stringify(a.filters):null}).select().single();if(c){if("PGRST205"===c.code||c.message?.includes("Could not find the table"))return null;throw c}return b}catch(a){if(a?.code==="PGRST205"||a?.message?.includes("Could not find the table"))return null;throw a}}async getByOrganization(a,b){try{let c=b?.page||1,d=b?.limit||50,e=(c-1)*d,f=this.supabase.from("export_history").select("*, users(full_name, email)",{count:"exact"}).eq("organization_id",a).order("created_at",{ascending:!1});b?.userId&&(f=f.eq("user_id",b.userId)),b?.exportType&&(f=f.eq("export_type",b.exportType)),b?.entityType&&(f=f.eq("entity_type",b.entityType));let{data:g,error:h,count:i}=await f.range(e,e+d-1);if(h){if("PGRST116"===h.code||"PGRST200"===h.code||"42P01"===h.code||"PGRST301"===h.code||400===h.status||404===h.status||"400"===h.code||"404"===h.code||h.message?.includes("relation")||h.message?.includes("does not exist"))return{data:[],total:0,page:c,limit:d,totalPages:0};throw h}return{data:g||[],total:i||0,page:c,limit:d,totalPages:Math.ceil((i||0)/d)}}catch(a){if(a?.code==="PGRST116"||a?.code==="PGRST200"||a?.code==="42P01"||a?.code==="PGRST301"||a?.status===400||a?.status===404||a?.code==="400"||a?.code==="404"||a?.message?.includes("relation")||a?.message?.includes("does not exist"))return{data:[],total:0,page:b?.page||1,limit:b?.limit||50,totalPages:0};throw a}}async getStats(a){try{let{data:b,error:c}=await this.supabase.from("export_history").select("export_type, entity_type, record_count, file_size_bytes").eq("organization_id",a);if(c){if("PGRST116"===c.code||"PGRST200"===c.code||"42P01"===c.code||"PGRST301"===c.code||400===c.status||404===c.status||"400"===c.code||"404"===c.code||c.message?.includes("relation")||c.message?.includes("does not exist"))return{total:0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};throw c}let d={total:b?.length||0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};return b?.forEach(a=>{d.byType[a.export_type]=(d.byType[a.export_type]||0)+1,d.byEntity[a.entity_type]=(d.byEntity[a.entity_type]||0)+1,d.totalRecords+=a.record_count||0,d.totalSizeBytes+=a.file_size_bytes||0}),d}catch(a){if(a?.code==="PGRST116"||a?.code==="PGRST200"||a?.code==="42P01"||a?.code==="PGRST301"||a?.status===400||a?.status===404||a?.code==="400"||a?.code==="404"||a?.message?.includes("relation")||a?.message?.includes("does not exist"))return{total:0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};throw a}}async delete(a,b){let{error:c}=await this.supabase.from("export_history").delete().eq("id",a).eq("user_id",b);if(c)throw c}async deleteByUser(a,b){let{error:c}=await this.supabase.from("export_history").delete().eq("user_id",a).eq("organization_id",b);if(c)throw c}}let d=new c;a.s(["ExportHistoryService",()=>c,"exportHistoryService",0,d])}];

//# sourceMappingURL=lib_services_export-history_service_ts_d985dcad._.js.map