module.exports=[768397,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(370025),f=a.i(937927),g=a.i(913216),h=a.i(988505),i=a.i(340695),j=a.i(703130),k=a.i(205522),l=a.i(917171),m=a.i(280281),n=a.i(864037),o=a.i(941675),p=a.i(114548),q=a.i(495756),r=a.i(290821),s=a.i(177156),t=a.i(141379),u=a.i(797063),v=a.i(669520),w=a.i(452495);let x=[{value:"google",label:"Google Calendar",color:"bg-blue-500",docs:"https://developers.google.com/calendar/api"},{value:"outlook",label:"Microsoft Outlook",color:"bg-orange-500",docs:"https://learn.microsoft.com/en-us/graph/api/resources/calendar"}];function y(){let{user:a}=(0,g.useAuth)(),y=(0,f.useQueryClient)(),{addToast:z}=(0,n.useToast)(),[A,B]=(0,c.useState)("google"),[C,D]=(0,c.useState)({}),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)({google:{api_key:"",api_secret:"",sync_sessions:!0,sync_attendance:!1,auto_sync:!1,sync_frequency:"realtime",create_events_for_sessions:!0,include_students_in_events:!1,include_location:!0,send_reminders:!1,reminder_minutes:15,is_test_mode:!0},outlook:{api_key:"",api_secret:"",sync_sessions:!0,sync_attendance:!1,auto_sync:!1,sync_frequency:"realtime",create_events_for_sessions:!0,include_students_in_events:!1,include_location:!0,send_reminders:!1,reminder_minutes:15,is_test_mode:!0}}),{data:I,isLoading:J}=(0,d.useQuery)({queryKey:["calendar-configs",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)return{};let b={};for(let c of["google","outlook"]){let d=await h.calendarService.getConfig(a.organization_id,c);d&&(b[c]=d,H(a=>({...a,[c]:{api_key:d.api_key||"",api_secret:d.api_secret||"",sync_sessions:d.sync_sessions,sync_attendance:d.sync_attendance,auto_sync:d.auto_sync,sync_frequency:d.sync_frequency,create_events_for_sessions:d.create_events_for_sessions,include_students_in_events:d.include_students_in_events,include_location:d.include_location,send_reminders:d.send_reminders,reminder_minutes:d.reminder_minutes||15,is_test_mode:d.is_test_mode}})))}return b},enabled:!!a?.organization_id}),K=(0,e.useMutation)({mutationFn:async b=>{if(!a?.organization_id)throw Error("Organization ID manquant");return h.calendarService.upsertConfig(a.organization_id,b,G[b])},onSuccess:(a,b)=>{y.invalidateQueries({queryKey:["calendar-configs"]}),z({type:"success",title:"Configuration sauvegardée",description:`La configuration ${x.find(a=>a.value===b)?.label} a \xe9t\xe9 sauvegard\xe9e.`})},onError:a=>{z({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue lors de la sauvegarde."})}}),L=(0,e.useMutation)({mutationFn:async a=>{let b=await fetch(`/api/calendar/authenticate/${a}`);if(!b.ok)throw Error((await b.json()).error||"Erreur lors de l'authentification");let c=await b.json();c.auth_url&&(window.location.href=c.auth_url)},onError:a=>{z({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue lors de l'authentification."}),F(!1)}}),M=(a,b,c)=>{H(d=>({...d,[a]:{...d[a],[b]:c}}))},N=a=>{D(b=>({...b,[a]:!b[a]}))};if(J)return(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)("div",{className:"text-muted-foreground",children:"Chargement..."})})});let O=I?.[A];return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[(0,b.jsx)(o.Calendar,{className:"mr-3 h-8 w-8 text-primary"}),"Intégrations Calendrier"]}),(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Synchronisez vos sessions avec Google Calendar ou Microsoft Outlook"})]}),(0,b.jsx)("div",{className:"flex space-x-4",children:x.map(a=>{let c=I?.[a.value],d=c?.is_active||!1;return(0,b.jsx)("button",{onClick:()=>B(a.value),className:`flex-1 p-4 border-2 rounded-lg transition-all ${A===a.value?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:`w-3 h-3 rounded-full ${a.color}`}),(0,b.jsx)("span",{className:"font-semibold",children:a.label})]}),d&&(0,b.jsx)(q.CheckCircle,{className:"h-5 w-5 text-green-600"})]})},a.value)})}),A&&(0,b.jsxs)(j.Card,{children:[(0,b.jsxs)(j.CardHeader,{children:[(0,b.jsxs)(j.CardTitle,{children:["Configuration ",x.find(a=>a.value===A)?.label]}),(0,b.jsxs)(j.CardDescription,{children:["Configurez les paramètres d'API pour ",x.find(a=>a.value===A)?.label]})]}),(0,b.jsxs)(j.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:`test-mode-${A}`,children:"Mode test"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Activez le mode test pour tester les intégrations sans impact sur vos calendriers réels"})]}),(0,b.jsx)(m.Switch,{checked:G[A].is_test_mode,onCheckedChange:a=>M(A,"is_test_mode",a)})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:`api-key-${A}`,children:"Clé API (Client ID)"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(k.Input,{id:`api-key-${A}`,type:C[`${A}-api-key`]?"text":"password",value:G[A].api_key,onChange:a=>M(A,"api_key",a.target.value),placeholder:"Votre clé API"}),(0,b.jsx)("button",{type:"button",onClick:()=>N(`${A}-api-key`),className:"absolute right-3 top-1/2 -translate-y-1/2",children:C[`${A}-api-key`]?(0,b.jsx)(t.EyeOff,{className:"h-4 w-4 text-gray-400"}):(0,b.jsx)(s.Eye,{className:"h-4 w-4 text-gray-400"})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:`api-secret-${A}`,children:"Secret API (Client Secret)"}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(k.Input,{id:`api-secret-${A}`,type:C[`${A}-api-secret`]?"text":"password",value:G[A].api_secret,onChange:a=>M(A,"api_secret",a.target.value),placeholder:"Votre secret API"}),(0,b.jsx)("button",{type:"button",onClick:()=>N(`${A}-api-secret`),className:"absolute right-3 top-1/2 -translate-y-1/2",children:C[`${A}-api-secret`]?(0,b.jsx)(t.EyeOff,{className:"h-4 w-4 text-gray-400"}):(0,b.jsx)(s.Eye,{className:"h-4 w-4 text-gray-400"})})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"Options de synchronisation"}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:`sync-sessions-${A}`,children:"Synchroniser les sessions"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Créer automatiquement des événements calendrier pour chaque session"})]}),(0,b.jsx)(m.Switch,{checked:G[A].sync_sessions,onCheckedChange:a=>M(A,"sync_sessions",a)})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:`create-events-${A}`,children:"Créer des événements pour les sessions"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Créer automatiquement un événement lors de la création d'une session"})]}),(0,b.jsx)(m.Switch,{checked:G[A].create_events_for_sessions,onCheckedChange:a=>M(A,"create_events_for_sessions",a)})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:`include-students-${A}`,children:"Inclure les étudiants dans les événements"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ajouter les étudiants comme participants aux événements calendrier"})]}),(0,b.jsx)(m.Switch,{checked:G[A].include_students_in_events,onCheckedChange:a=>M(A,"include_students_in_events",a)})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:`include-location-${A}`,children:"Inclure le lieu"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Ajouter le lieu de la session dans l'événement calendrier"})]}),(0,b.jsx)(m.Switch,{checked:G[A].include_location,onCheckedChange:a=>M(A,"include_location",a)})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:`send-reminders-${A}`,children:"Envoyer des rappels"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Activer les rappels pour les événements calendrier"})]}),(0,b.jsx)(m.Switch,{checked:G[A].send_reminders,onCheckedChange:a=>M(A,"send_reminders",a)})]}),G[A].send_reminders&&(0,b.jsxs)("div",{children:[(0,b.jsx)(l.Label,{htmlFor:`reminder-minutes-${A}`,children:"Minutes avant l'événement"}),(0,b.jsx)(k.Input,{id:`reminder-minutes-${A}`,type:"number",min:"0",max:"20160",value:G[A].reminder_minutes,onChange:a=>M(A,"reminder_minutes",parseInt(a.target.value)||15),className:"mt-2"})]})]}),O?.is_active&&(0,b.jsx)("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-green-800",children:"Connecté"}),O.default_calendar_name&&(0,b.jsxs)("p",{className:"text-sm text-green-600",children:["Calendrier: ",O.default_calendar_name]}),O.last_sync_at&&(0,b.jsxs)("p",{className:"text-xs text-green-600 mt-1",children:["Dernière synchronisation: ",new Date(O.last_sync_at).toLocaleString("fr-FR")]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:["success"===O.last_sync_status&&(0,b.jsx)(q.CheckCircle,{className:"h-5 w-5 text-green-600"}),"failed"===O.last_sync_status&&(0,b.jsx)(r.AlertCircle,{className:"h-5 w-5 text-red-600"})]})]})}),(0,b.jsx)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:(0,b.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,b.jsx)(u.Info,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,b.jsxs)("div",{className:"text-sm text-blue-800",children:[(0,b.jsx)("p",{className:"font-semibold mb-1",children:"Comment obtenir vos identifiants API ?"}),(0,b.jsxs)("p",{className:"mb-2",children:["Consultez la documentation de ",x.find(a=>a.value===A)?.label," pour créer une application et obtenir vos identifiants."]}),(0,b.jsxs)("a",{href:x.find(a=>a.value===A)?.docs,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline flex items-center space-x-1",children:[(0,b.jsx)("span",{children:"Documentation"}),(0,b.jsx)(w.ExternalLink,{className:"h-3 w-3"})]})]})]})}),(0,b.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,b.jsxs)(i.Button,{variant:"outline",onClick:()=>{K.mutate(A)},disabled:K.isPending,children:[(0,b.jsx)(p.Save,{className:"h-4 w-4 mr-2"}),"Sauvegarder"]}),O?.api_key&&O?.api_secret&&(0,b.jsx)(b.Fragment,{children:O.is_active?(0,b.jsxs)(i.Button,{variant:"outline",onClick:()=>{z({type:"info",title:"Synchronisation",description:"La synchronisation se fait automatiquement lors de la création/modification de sessions."})},children:[(0,b.jsx)(v.RefreshCw,{className:"h-4 w-4 mr-2"}),"Info Sync"]}):(0,b.jsx)(i.Button,{onClick:()=>{F(!0),L.mutate(A)},disabled:E||L.isPending,children:E?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(v.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}),"Authentification..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.ExternalLink,{className:"h-4 w-4 mr-2"}),"Connecter"]})})})]})]})]})]})}a.s(["default",()=>y])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_settings_calendar_page_tsx_b1e43ee7._.js.map