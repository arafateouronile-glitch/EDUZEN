module.exports=[400210,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],400210)},426099,a=>{"use strict";var b=a.i(269240);let c=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getAllPrograms(a,b){let c=this.supabase.from("programs").select("*").eq("organization_id",a);b?.isActive!==void 0&&(c=c.eq("is_active",b.isActive)),b?.search&&(c=c.or(`name.ilike.%${b.search}%,code.ilike.%${b.search}%,description.ilike.%${b.search}%`));let{data:d,error:e}=await c.order("created_at",{ascending:!1});if(e)throw e;return d}async getProgramById(a){let{data:b,error:c}=await this.supabase.from("programs").select(`
        *,
        formations(*)
      `).eq("id",a).single();if(c)throw c;return b}async createProgram(a){let{data:b,error:c}=await this.supabase.from("programs").insert(a).select().single();if(c)throw c;return b}async updateProgram(a,b){let{data:c,error:d}=await this.supabase.from("programs").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteProgram(a){return this.updateProgram(a,{is_active:!1})}async getFormationsByProgram(a){let{data:b,error:c}=await this.supabase.from("formations").select("*").eq("program_id",a).order("created_at",{ascending:!1});if(c)throw c;return b}async getGlobalStats(a){let{data:b,error:c}=await this.supabase.from("programs").select("id, is_active, created_at").eq("organization_id",a);if(c)throw c;let d=b||[],e=d.length,f=d.filter(a=>a.is_active).length,g=d.filter(a=>!a.is_active).length,h=0,i=d.map(a=>a.id);if(i.length>0){let{count:a,error:b}=await this.supabase.from("formations").select("*",{count:"exact",head:!0}).in("program_id",i);if(b)throw b;h=a||0}let j=0;if(i.length>0){let{data:a,error:b}=await this.supabase.from("formations").select("id").in("program_id",i);if(b)throw b;let c=a?.map(a=>a.id)||[];if(c.length>0){let{count:a,error:b}=await this.supabase.from("sessions").select("*",{count:"exact",head:!0}).in("formation_id",c);if(b)throw b;j=a||0}}let k=0;if(i.length>0){let{data:a,error:b}=await this.supabase.from("formations").select("id").in("program_id",i);if(b)throw b;let c=a?.map(a=>a.id)||[];if(c.length>0){let{data:a,error:b}=await this.supabase.from("sessions").select("id").in("formation_id",c);if(b)throw b;let d=a?.map(a=>a.id)||[];if(d.length>0){let{count:a,error:b}=await this.supabase.from("enrollments").select("*",{count:"exact",head:!0}).in("session_id",d);if(b)throw b;k=a||0}}}let l=[{name:"Actifs",value:f,color:"#335ACF"},{name:"Inactifs",value:g,color:"#6B7280"}].filter(a=>a.value>0),m={};return d.forEach(a=>{if(a.created_at){let b=new Date(a.created_at),c=`${b.getFullYear()}-${String(b.getMonth()+1).padStart(2,"0")}`;m[c]=(m[c]||0)+1}}),{total:e,active:f,inactive:g,totalFormations:h,totalSessions:j,totalEnrollments:k,statusData:l,monthlyData:Object.entries(m).sort(([a],[b])=>a.localeCompare(b)).slice(-6).map(([a,b])=>({month:new Date(a+"-01").toLocaleDateString("fr-FR",{month:"short",year:"numeric"}),programmes:b}))}}};a.s(["programService",0,c])},926979,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(370025),f=a.i(433217),g=a.i(937927),h=a.i(913216),i=a.i(426099),j=a.i(340695),k=a.i(703130),l=a.i(400210),m=a.i(238246);function n(){let a=(0,d.useRouter)(),n=(0,d.useParams)().id,o=(0,g.useQueryClient)(),{user:p,isLoading:q}=(0,h.useAuth)(),[r,s]=(0,c.useState)({code:"",name:"",description:"",duration_hours:"",price:"",currency:"XOF",payment_plan:"full",prerequisites:"",capacity_max:"",age_min:"",age_max:"",certification_issued:!1,is_active:!0}),{data:t,isLoading:u}=(0,f.useQuery)({queryKey:["program",n],queryFn:()=>i.programService.getProgramById(n),enabled:!!n});(0,c.useEffect)(()=>{if(t){let a=t.formations?.[0];s({code:t.code||"",name:t.name||"",description:t.description||"",duration_hours:a?.duration_hours?.toString()||"",price:a?.price?.toString()||"",currency:a?.currency||"XOF",payment_plan:a?.payment_plan||"full",prerequisites:a?.prerequisites||"",capacity_max:a?.capacity_max?.toString()||"",age_min:a?.age_min?.toString()||"",age_max:a?.age_max?.toString()||"",certification_issued:a?.certification_issued||!1,is_active:t.is_active??!0})}},[t]);let v=(0,e.useMutation)({mutationFn:async()=>{if(!p?.organization_id)throw Error("Organization ID manquant");console.log("Mise à jour du programme:",n,r);let a=await i.programService.updateProgram(n,{code:r.code,name:r.name,description:r.description||null,is_active:r.is_active});return console.log("Programme mis à jour avec succès:",a),a},onSuccess:b=>{console.log("onSuccess appelé avec:",b),o.invalidateQueries({queryKey:["program",n]}),o.invalidateQueries({queryKey:["programs"]}),a.push(`/dashboard/programs/${b.id}`)},onError:a=>{console.error("Erreur lors de la mise à jour du programme:",a)}});return q||u?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)("p",{children:"Chargement..."})}):p?p.organization_id?t?(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(m.default,{href:`/dashboard/programs/${n}`,children:(0,b.jsx)(j.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(l.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Modifier la formation"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Modifiez les informations de la formation"})]})]}),(0,b.jsxs)(k.Card,{children:[(0,b.jsx)(k.CardHeader,{children:(0,b.jsx)(k.CardTitle,{children:"Informations de la formation"})}),(0,b.jsx)(k.CardContent,{children:(0,b.jsxs)("form",{onSubmit:a=>{a.preventDefault(),v.mutate()},className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Code de la formation *"}),(0,b.jsx)("input",{type:"text",required:!0,value:r.code,onChange:a=>s({...r,code:a.target.value.toUpperCase()}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"EX: FORM-2024-001"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Nom de la formation *"}),(0,b.jsx)("input",{type:"text",required:!0,value:r.name,onChange:a=>s({...r,name:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"Ex: Formation en Informatique"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Description"}),(0,b.jsx)("textarea",{value:r.description,onChange:a=>s({...r,description:a.target.value}),rows:4,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Description détaillée de la formation..."})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Durée (heures)"}),(0,b.jsx)("input",{type:"number",value:r.duration_hours,onChange:a=>s({...r,duration_hours:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"Ex: 120"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Prix *"}),(0,b.jsx)("input",{type:"number",required:!0,step:"0.01",value:r.price,onChange:a=>s({...r,price:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"0.00"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Devise"}),(0,b.jsxs)("select",{value:r.currency,onChange:a=>s({...r,currency:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,b.jsx)("option",{value:"XOF",children:"XOF (Franc CFA Ouest)"}),(0,b.jsx)("option",{value:"XAF",children:"XAF (Franc CFA Centre)"}),(0,b.jsx)("option",{value:"EUR",children:"EUR (Euro)"}),(0,b.jsx)("option",{value:"USD",children:"USD (Dollar)"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Plan de paiement"}),(0,b.jsxs)("select",{value:r.payment_plan,onChange:a=>s({...r,payment_plan:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,b.jsx)("option",{value:"full",children:"Paiement unique"}),(0,b.jsx)("option",{value:"installment",children:"Échelonné"}),(0,b.jsx)("option",{value:"custom",children:"Personnalisé"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Capacité maximale"}),(0,b.jsx)("input",{type:"number",value:r.capacity_max,onChange:a=>s({...r,capacity_max:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"Ex: 30"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Âge minimum"}),(0,b.jsx)("input",{type:"number",value:r.age_min,onChange:a=>s({...r,age_min:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Âge maximum"}),(0,b.jsx)("input",{type:"number",value:r.age_max,onChange:a=>s({...r,age_max:a.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Prérequis"}),(0,b.jsx)("textarea",{value:r.prerequisites,onChange:a=>s({...r,prerequisites:a.target.value}),rows:2,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Prérequis pour suivre cette formation..."})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("input",{type:"checkbox",id:"certification",checked:r.certification_issued,onChange:a=>s({...r,certification_issued:a.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),(0,b.jsx)("label",{htmlFor:"certification",className:"text-sm font-medium",children:"Certificat délivré à l'issue de la formation"})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("input",{type:"checkbox",id:"is_active",checked:r.is_active,onChange:a=>s({...r,is_active:a.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),(0,b.jsx)("label",{htmlFor:"is_active",className:"text-sm font-medium",children:"Formation active"})]})]}),v.error&&(0,b.jsx)("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-lg text-sm",children:v.error instanceof Error?v.error.message:"Une erreur est survenue"}),(0,b.jsxs)("div",{className:"flex justify-end space-x-4 pt-4",children:[(0,b.jsx)(m.default,{href:`/dashboard/programs/${n}`,children:(0,b.jsx)(j.Button,{type:"button",variant:"outline",children:"Annuler"})}),(0,b.jsx)(j.Button,{type:"submit",disabled:v.isPending,children:v.isPending?"Enregistrement...":"Enregistrer les modifications"})]})]})})]})]}):(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("p",{className:"text-muted-foreground mb-4",children:"Formation non trouvée"}),(0,b.jsx)(m.default,{href:"/dashboard/programs",children:(0,b.jsx)(j.Button,{children:"Retour à la liste"})})]})}):(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Organization ID manquant"}),(0,b.jsx)("p",{className:"text-red-700 mb-4",children:"Votre compte n'est pas associé à une organisation."})]})}):(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)("div",{className:"bg-warning-bg border border-warning-border rounded-lg p-4",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-warning-primary mb-2",children:"Utilisateur non trouvé"}),(0,b.jsx)("p",{className:"text-warning-primary",children:"Votre compte n'existe pas encore dans la base de données. Déconnectez-vous et créez un nouveau compte."})]})})}a.s(["default",()=>n])}];

//# sourceMappingURL=_5f0a20e4._.js.map