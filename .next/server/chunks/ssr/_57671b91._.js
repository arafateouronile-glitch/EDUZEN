module.exports=[915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},400210,a=>{"use strict";let b=(0,a.i(170106).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",()=>b],400210)},641710,a=>{"use strict";let b=(0,a.i(170106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],641710)},495756,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],495756)},114548,a=>{"use strict";let b=(0,a.i(170106).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);a.s(["Save",()=>b],114548)},992258,a=>{"use strict";let b=(0,a.i(170106).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);a.s(["Mail",()=>b],992258)},54018,a=>{"use strict";let b=(0,a.i(170106).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);a.s(["XCircle",()=>b],54018)},621958,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);let e=c.createContext(void 0);function f({value:a,defaultValue:f,onValueChange:g,children:h,className:i}){let j=void 0!==a,[k,l]=c.useState(f??"");c.useEffect(()=>{j||void 0===f||l(f)},[f]);let m=j?a:k,n=c.useCallback(a=>{j||l(a),g?.(a)},[j,g]);return(0,b.jsx)(e.Provider,{value:{value:m,onValueChange:n},children:(0,b.jsx)("div",{className:(0,d.cn)("w-full",i),children:h})})}function g(){let a=c.useContext(e);if(!a)throw Error("Tabs components must be used within a Tabs component");return a}function h({children:a,className:c}){return(0,b.jsx)("div",{className:(0,d.cn)("inline-flex h-10 items-center justify-center rounded-lg bg-bg-gray-100 p-1 text-text-tertiary",c),children:a})}function i({value:a,children:c,className:e}){let{value:f,onValueChange:h}=g(),i=f===a;return(0,b.jsx)("button",{type:"button",onClick:()=>h(a),className:(0,d.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-outline-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",i?"bg-white text-text-primary shadow-sm":"text-text-tertiary hover:text-text-primary",e),children:c})}function j({value:a,children:c,className:e}){let{value:f}=g();return f!==a?null:(0,b.jsx)("div",{className:(0,d.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),children:c})}a.s(["Tabs",()=>f,"TabsContent",()=>j,"TabsList",()=>h,"TabsTrigger",()=>i])},692759,a=>{"use strict";let b=(0,a.i(170106).default)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);a.s(["Send",()=>b],692759)},452218,571907,a=>{"use strict";var b,c,d=a.i(325383),e=((b={}).AUTH_REQUIRED="AUTH_1001",b.AUTH_INVALID_CREDENTIALS="AUTH_1002",b.AUTH_SESSION_EXPIRED="AUTH_1003",b.AUTH_INSUFFICIENT_PERMISSIONS="AUTH_1004",b.AUTH_2FA_REQUIRED="AUTH_1005",b.AUTH_2FA_INVALID="AUTH_1006",b.VALIDATION_ERROR="VALID_2001",b.VALIDATION_REQUIRED_FIELD="VALID_2002",b.VALIDATION_INVALID_FORMAT="VALID_2003",b.VALIDATION_UNIQUE_CONSTRAINT="VALID_2004",b.DB_CONNECTION_ERROR="DB_3001",b.DB_QUERY_ERROR="DB_3002",b.DB_NOT_FOUND="DB_3003",b.DB_CONSTRAINT_VIOLATION="DB_3004",b.DB_FOREIGN_KEY_CONSTRAINT="DB_3006",b.DB_RLS_POLICY_VIOLATION="DB_3005",b.NETWORK_ERROR="NET_4001",b.API_TIMEOUT="NET_4002",b.API_RATE_LIMIT="NET_4003",b.API_SERVER_ERROR="NET_4004",b.API_NOT_FOUND="NET_4005",b.API_BAD_REQUEST="NET_4006",b.BUSINESS_LOGIC_ERROR="BIZ_5001",b.RESOURCE_LOCKED="BIZ_5002",b.OPERATION_NOT_ALLOWED="BIZ_5003",b.QUOTA_EXCEEDED="BIZ_5004",b.INTERNAL_ERROR="SYS_6001",b.CONFIGURATION_ERROR="SYS_6002",b.SERVICE_UNAVAILABLE="SYS_6003",b);(c={}).LOW="low",c.MEDIUM="medium",c.HIGH="high",c.CRITICAL="critical";class f extends Error{code;severity;userMessage;retryable;context;originalError;constructor(a,b="SYS_6001",c="medium",d={},e){super(a),this.name="AppError",this.code=b,this.severity=c,this.userMessage=d.userMessage||this.getDefaultUserMessage(b),this.retryable=d.retryable??this.isRetryable(b),this.context={...d,code:b,severity:c,timestamp:new Date().toISOString()},this.originalError=e,Error.captureStackTrace&&Error.captureStackTrace(this,f)}getDefaultUserMessage(a){return({AUTH_1001:"Vous devez être connecté pour effectuer cette action.",AUTH_1002:"Email ou mot de passe incorrect.",AUTH_1003:"Votre session a expiré. Veuillez vous reconnecter.",AUTH_1004:"Vous n'avez pas les permissions nécessaires.",AUTH_1005:"Authentification à deux facteurs requise.",AUTH_1006:"Code d'authentification invalide.",VALID_2001:"Les données fournies ne sont pas valides.",VALID_2002:"Certains champs obligatoires sont manquants.",VALID_2003:"Le format des données est incorrect.",VALID_2004:"Cette valeur existe déjà.",DB_3001:"Impossible de se connecter à la base de données.",DB_3002:"Erreur lors de l'exécution de la requête.",DB_3003:"Ressource introuvable.",DB_3004:"Cette opération viole une contrainte de la base de données.",DB_3006:"Cette opération viole une contrainte de clé étrangère.",DB_3005:"Vous n'avez pas accès à cette ressource.",NET_4001:"Erreur de connexion réseau. Vérifiez votre connexion internet.",NET_4002:"La requête a pris trop de temps. Veuillez réessayer.",NET_4003:"Trop de requêtes. Veuillez patienter quelques instants.",NET_4004:"Erreur serveur. Veuillez réessayer plus tard.",NET_4005:"Ressource introuvable.",NET_4006:"Requête invalide.",BIZ_5001:"Cette opération n'est pas autorisée dans le contexte actuel.",BIZ_5002:"Cette ressource est actuellement verrouillée.",BIZ_5003:"Cette opération n'est pas autorisée.",BIZ_5004:"Vous avez atteint la limite autorisée.",SYS_6001:"Une erreur interne est survenue. Veuillez réessayer.",SYS_6002:"Erreur de configuration du système.",SYS_6003:"Service temporairement indisponible."})[a]||"Une erreur inattendue est survenue."}isRetryable(a){return["NET_4001","NET_4002","NET_4004","DB_3001","SYS_6003"].includes(a)}toJSON(){return{name:this.name,message:this.message,code:this.code,severity:this.severity,userMessage:this.userMessage,retryable:this.retryable,context:this.context,stack:this.stack,originalError:this.originalError instanceof Error?{name:this.originalError.name,message:this.originalError.message,stack:this.originalError.stack}:this.originalError}}}let g=new class{handleError(a,b={}){if(a instanceof f)return this.logError(a),a;if(a instanceof Error)return this.handleStandardError(a,b);if(this.isSupabaseError(a))return this.handleSupabaseError(a,b);let c=new f("Une erreur inattendue est survenue.","SYS_6001","high",b,a);return this.logError(c),c}handleStandardError(a,b){let c=a.message.toLowerCase(),d="SYS_6001",e="medium";c.includes("network")||c.includes("fetch")?(d="NET_4001",e="medium"):c.includes("timeout")?(d="NET_4002",e="medium"):c.includes("unauthorized")||c.includes("401")?(d="AUTH_1001",e="high"):c.includes("forbidden")||c.includes("403")?(d="AUTH_1004",e="high"):c.includes("not found")||c.includes("404")?(d="DB_3003",e="low"):(c.includes("validation")||c.includes("invalid"))&&(d="VALID_2001",e="low");let g=new f(a.message,d,e,b,a);return this.logError(g),g}handleSupabaseError(a,b){let c=a.code||a.status,d=a.message||"Erreur Supabase",e=b.code||"DB_3002",g="medium";if(!b.code)switch(c){case"PGRST116":case"42P01":e="DB_3003",g="low";break;case"42501":e="DB_3005",g="high";break;case"23505":e="VALID_2004",g="low";break;case"23503":e="DB_3004",g="medium";break;case"PGRST301":case"400":e="NET_4006",g="low";break;case"401":e="AUTH_1001",g="high";break;case"403":e="AUTH_1004",g="high";break;case"404":e="NET_4005",g="low";break;case"500":e="NET_4004",g="high"}"DB_3006"===e&&(g="medium");let h=new f(d,e,g,b,a);return this.logError(h),h}isSupabaseError(a){return a&&(a.code||a.status||a.message)&&("string"==typeof a.code||"number"==typeof a.status)}logError(a){let b={...a.context,code:a.code,severity:a.severity,retryable:a.retryable};switch(a.severity){case"critical":case"high":d.logger.error(a.message,a.originalError||a,b);break;case"medium":d.logger.warn(a.message,b);break;case"low":d.logger.info(`Error: ${a.message}`,b)}}createValidationError(a,b){return new f(a,"VALID_2001","low",{field:b,userMessage:a})}createAuthError(a,b){return new f(b||"Erreur d'authentification",a,"high")}createDatabaseError(a,b){return new f(a,"DB_3002","medium",{},b)}createNotFoundError(a,b){return new f(a,"DB_3003","low",b)}};a.s(["AppError",()=>f,"ErrorCode",()=>e,"errorHandler",0,g],571907),a.s([],452218)},49492,a=>{"use strict";a.i(452218);var b=a.i(571907);async function c(a,c,d,e){try{let f=a.from(c).select(e?.select||"*").eq("organization_id",d);e?.filters&&Object.entries(e.filters).forEach(([a,b])=>{null!=b&&(f=f.eq(a,b))}),e?.search&&(f=f.ilike(e.search.field,`%${e.search.value}%`)),f=e?.orderBy?f.order(e.orderBy.column,{ascending:e.orderBy.ascending??!1}):f.order("created_at",{ascending:!1});let{data:g,error:h}=await f;if(h)throw b.errorHandler.handleError(h,{organizationId:d,operation:"getAllByOrganization",table:c});return g||[]}catch(a){if(a instanceof b.AppError)throw a;throw b.errorHandler.handleError(a,{organizationId:d,operation:"getAllByOrganization",table:c})}}async function d(a,c,d,e){try{let{data:f,error:g}=await a.from(c).select(e||"*").eq("id",d).single();if(g){if("PGRST116"===g.code||"42P01"===g.code)throw b.errorHandler.handleError(g,{code:b.ErrorCode.DB_NOT_FOUND,operation:"getById",id:d,table:c});throw b.errorHandler.handleError(g,{operation:"getById",id:d,table:c})}if(!f)throw b.errorHandler.createDatabaseError(`Enregistrement avec l'ID ${d} introuvable dans ${c}`,{id:d,table:c});return f}catch(a){if(a instanceof b.AppError)throw a;throw b.errorHandler.handleError(a,{operation:"getById",id:d,table:c})}}a.s(["getAllByOrganization",()=>c,"getById",()=>d])},555074,a=>{"use strict";var b=a.i(269240);let c=async(a,b)=>(console.warn("videoconferenceService.createMeetingForSession not implemented"),null),d=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getAllSessions(a,b){let c=this.supabase.from("sessions").select(`
        *,
        formations!inner(
          *,
          programs(*)
        )
      `).eq("formations.organization_id",a);b?.formationId&&(c=c.eq("formation_id",b.formationId)),b?.status&&(c=c.eq("status",b.status)),b?.startDate&&(c=c.gte("start_date",b.startDate)),b?.endDate&&(c=c.lte("end_date",b.endDate)),b?.search&&(c=c.ilike("name",`%${b.search}%`));let{data:d,error:e}=await c.order("start_date",{ascending:!0});if(e)throw e;return d}async getSessionById(a){let{data:b,error:c}=await this.supabase.from("sessions").select(`
        *,
        formations!inner(
          *,
          programs(*)
        )
      `).eq("id",a).single();if(c)throw c;let{data:d,error:e}=await this.supabase.from("session_programs").select(`
        program_id,
        programs(*)
      `).eq("session_id",a);if(e)throw e;return{...b,session_programs:d?.map(a=>a.programs).filter(Boolean)||[]}}async createSession(a,b,c){if(a.formation_id){let{data:b,error:c}=await this.supabase.from("formations").select("id, organization_id").eq("id",a.formation_id).single();if(c)throw console.error("Erreur lors de la vérification de la formation:",c),Error(`Formation non trouv\xe9e: ${c.message}`);if(!b)throw Error("Formation non trouvée");console.log("Formation trouvée:",b)}let{data:d,error:e}=await this.supabase.from("sessions").insert(a).select().single();if(e)throw console.error("Erreur RLS lors de la création de la session:",{code:e.code,message:e.message,details:e.details,hint:e.hint,formation_id:a.formation_id}),e;if(b&&b.length>0&&d){let{data:a}=await this.supabase.from("formations").select("organization_id").eq("id",d.formation_id).single();if(a){let c=b.map(b=>({session_id:d.id,program_id:b,organization_id:a.organization_id})),{error:e}=await this.supabase.from("session_programs").insert(c);e&&console.error("Erreur lors de la création des associations session-programme:",e),a.organization_id&&await this.syncWithCalendars(d.id,a.organization_id,"create").catch(a=>{console.error("Erreur lors de la synchronisation calendrier:",a)}),a.organization_id&&await this.createVideoconferenceMeeting(d.id,a.organization_id).catch(a=>{console.error("Erreur lors de la création de la réunion visioconférence:",a)})}}return console.log("Session créée avec succès:",d),d}async updateSessionPrograms(a,b,c){let{error:d}=await this.supabase.from("session_programs").delete().eq("session_id",a);if(d)throw d;if(b.length>0){let d=b.map(b=>({session_id:a,program_id:b,organization_id:c})),{error:e}=await this.supabase.from("session_programs").insert(d);if(e)throw e}return!0}async getSessionPrograms(a){let{data:b,error:c}=await this.supabase.from("session_programs").select(`
        program_id,
        programs(*)
      `).eq("session_id",a);if(c)throw c;return b?.map(a=>a.programs).filter(Boolean)||[]}async updateSession(a,b){let{data:c}=await this.supabase.from("sessions").select("formation_id, formations(organization_id)").eq("id",a).single(),{data:d,error:e}=await this.supabase.from("sessions").update(b).eq("id",a).select().single();if(e)throw e;let f=c?.formations;return c&&f?.organization_id&&await this.syncWithCalendars(a,f.organization_id,"update").catch(a=>{console.error("Erreur lors de la synchronisation calendrier:",a)}),d}async deleteSession(a){let{data:b}=await this.supabase.from("sessions").select("formation_id, formations(organization_id)").eq("id",a).single(),c=b?.formations;b&&c?.organization_id&&await this.syncWithCalendars(a,c.organization_id,"delete").catch(a=>{console.error("Erreur lors de la suppression de l'événement calendrier:",a)});let{error:d}=await this.supabase.from("sessions").delete().eq("id",a);if(d)throw d}async createVideoconferenceMeeting(a,b){let{data:d}=await this.supabase.from("videoconference_integrations").select("*").eq("organization_id",b).eq("is_active",!0).eq("auto_create_meetings",!0);if(d&&0!==d.length)for(let e of d)try{await c(a,{organizationId:b,provider:e.provider})}catch(a){console.error(`Erreur lors de la cr\xe9ation de r\xe9union avec ${e.provider}:`,a)}}async syncWithCalendars(a,b,c){let{data:d}=await this.supabase.from("calendar_integrations").select("*").eq("organization_id",b).eq("is_active",!0).eq("sync_sessions",!0).eq("create_events_for_sessions",!0);if(d&&0!==d.length)for(let a of d)try{console.warn(`Calendar sync for ${c} not implemented yet for provider ${a.provider}`)}catch(b){console.error(`Erreur lors de la synchronisation avec ${a.provider}:`,b)}}async getUpcomingSessions(a,b=10){let c=new Date().toISOString().split("T")[0],{data:d,error:e}=await this.supabase.from("sessions").select(`
        *,
        formations!inner(
          *,
          programs(*)
        )
      `).eq("formations.organization_id",a).gte("start_date",c).eq("status","planned").order("start_date",{ascending:!0}).limit(b);if(e)throw e;return d}async getOngoingSessions(a){let b=new Date().toISOString().split("T")[0],{data:c,error:d}=await this.supabase.from("sessions").select(`
        *,
        formations!inner(
          *,
          programs(*)
        )
      `).eq("formations.organization_id",a).lte("start_date",b).gte("end_date",b).eq("status","ongoing").order("start_date",{ascending:!0});if(d)throw d;return c}async addSessionToFormations(a,b,c){let d=b.map((b,d)=>({session_id:a,formation_id:b,organization_id:c,order_index:d})),{data:e,error:f}=await this.supabase.from("formation_sessions").insert(d).select();if(f)throw f;return e}async removeSessionFromFormation(a,b){let{error:c}=await this.supabase.from("formation_sessions").delete().eq("session_id",a).eq("formation_id",b);if(c)throw c;return!0}async updateSessionFormations(a,b,c){let{error:d}=await this.supabase.from("formation_sessions").delete().eq("session_id",a);if(d)throw d;return b.length>0?this.addSessionToFormations(a,b,c):[]}async getSessionFormations(a){let{data:b,error:c}=await this.supabase.from("formation_sessions").select(`
        formation_id,
        order_index,
        formations(*)
      `).eq("session_id",a).order("order_index",{ascending:!0});if(c)throw c;return b?.map(a=>a.formations).filter(Boolean)||[]}async getFormationSessions(a){let{data:b,error:c}=await this.supabase.from("formation_sessions").select(`
        session_id,
        order_index,
        sessions(*)
      `).eq("formation_id",a).order("order_index",{ascending:!0});if(c)throw c;return b?.map(a=>a.sessions).filter(Boolean)||[]}async createIndependentSession(a,b,c){let{data:d,error:e}=await this.supabase.from("sessions").insert({...a,formation_id:null}).select().single();if(e)throw e;return b&&b.length>0&&d&&await this.updateSessionPrograms(d.id,b,a.organization_id),c&&c.length>0&&d&&await this.addSessionToFormations(d.id,c,a.organization_id),d}};a.s(["sessionService",0,d],555074)},46143,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895),e=a.i(533441);let f=c.forwardRef(({className:a,checked:c,onCheckedChange:f,...g},h)=>(0,b.jsxs)("div",{className:"relative inline-flex items-center",children:[(0,b.jsx)("input",{type:"checkbox",ref:h,checked:c,onChange:a=>f?.(a.target.checked),className:(0,d.cn)("peer h-4 w-4 shrink-0 rounded border border-gray-300","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-blue focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","cursor-pointer",c&&"border-brand-blue bg-brand-blue",a),...g}),c&&(0,b.jsx)(e.Check,{className:"absolute h-3 w-3 text-white pointer-events-none left-0.5 top-0.5"})]}));f.displayName="Checkbox",a.s(["Checkbox",()=>f])},265602,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(400187),e=a.i(497895);let f=(0,d.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),g=c.forwardRef(({className:a,variant:c,...d},g)=>(0,b.jsx)("div",{ref:g,role:"alert",className:(0,e.cn)(f({variant:c}),a),...d}));g.displayName="Alert",c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("h5",{ref:d,className:(0,e.cn)("mb-1 font-medium leading-none tracking-tight",a),...c})).displayName="AlertTitle";let h=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("div",{ref:d,className:(0,e.cn)("text-sm [&_p]:leading-relaxed",a),...c}));h.displayName="AlertDescription",a.s(["Alert",()=>g,"AlertDescription",()=>h])},335151,a=>{"use strict";var b=a.i(188950),c=a.i(212955);function d(a){(0,c.default)(1,arguments);var d=(0,b.default)(a),e=d.getMonth();return d.setFullYear(d.getFullYear(),e+1,0),d.setHours(23,59,59,999),d}a.s(["default",()=>d])},603420,a=>{"use strict";var b=a.i(568425),c=a.i(188950),d=a.i(212955);function e(a,b){(0,d.default)(2,arguments);var e=(0,c.default)(a),f=(0,c.default)(b),g=e.getTime()-f.getTime();return g<0?-1:g>0?1:g}var f=a.i(335151),g={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(a){return a<0?Math.ceil(a):Math.floor(a)}},h=a.i(120866);function i(a,b){if(null==a)throw TypeError("assign requires that input parameter not be null or undefined");for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);return a}var j=a.i(451579);function k(a,k){return(0,d.default)(1,arguments),function(a,k,l){(0,d.default)(2,arguments);var m,n,o,p,q,r=(0,b.getDefaultOptions)(),s=null!=(m=null!=(n=null==l?void 0:l.locale)?n:r.locale)?m:h.default;if(!s.formatDistance)throw RangeError("locale must contain formatDistance property");var t=e(a,k);if(isNaN(t))throw RangeError("Invalid time value");var u=i(i({},l),{addSuffix:!!(null==l?void 0:l.addSuffix),comparison:t});t>0?(o=(0,c.default)(k),p=(0,c.default)(a)):(o=(0,c.default)(a),p=(0,c.default)(k));var v=function(a,b,e){(0,d.default)(2,arguments);var f,h=function(a,b){return(0,d.default)(2,arguments),(0,c.default)(a).getTime()-(0,c.default)(b).getTime()}(a,b)/1e3;return((f=null==e?void 0:e.roundingMethod)?g[f]:g.trunc)(h)}(p,o),w=Math.round((v-((0,j.default)(p)-(0,j.default)(o))/1e3)/60);if(w<2)if(null!=l&&l.includeSeconds)if(v<5)return s.formatDistance("lessThanXSeconds",5,u);else if(v<10)return s.formatDistance("lessThanXSeconds",10,u);else if(v<20)return s.formatDistance("lessThanXSeconds",20,u);else if(v<40)return s.formatDistance("halfAMinute",0,u);else if(v<60)return s.formatDistance("lessThanXMinutes",1,u);else return s.formatDistance("xMinutes",1,u);else if(0===w)return s.formatDistance("lessThanXMinutes",1,u);else return s.formatDistance("xMinutes",w,u);if(w<45)return s.formatDistance("xMinutes",w,u);if(w<90)return s.formatDistance("aboutXHours",1,u);if(w<1440){var x=Math.round(w/60);return s.formatDistance("aboutXHours",x,u)}if(w<2520)return s.formatDistance("xDays",1,u);else if(w<43200){var y=Math.round(w/1440);return s.formatDistance("xDays",y,u)}else if(w<86400)return q=Math.round(w/43200),s.formatDistance("aboutXMonths",q,u);if((q=function(a,b){(0,d.default)(2,arguments);var g,h=(0,c.default)(a),i=(0,c.default)(b),j=e(h,i),k=Math.abs(function(a,b){(0,d.default)(2,arguments);var e=(0,c.default)(a),f=(0,c.default)(b);return 12*(e.getFullYear()-f.getFullYear())+(e.getMonth()-f.getMonth())}(h,i));if(k<1)g=0;else{1===h.getMonth()&&h.getDate()>27&&h.setDate(30),h.setMonth(h.getMonth()-j*k);var l=e(h,i)===-j;(function(a){(0,d.default)(1,arguments);var b=(0,c.default)(a);return(function(a){(0,d.default)(1,arguments);var b=(0,c.default)(a);return b.setHours(23,59,59,999),b})(b).getTime()===(0,f.default)(b).getTime()})((0,c.default)(a))&&1===k&&1===e(a,i)&&(l=!1),g=j*(k-Number(l))}return 0===g?0:g}(p,o))<12){var z=Math.round(w/43200);return s.formatDistance("xMonths",z,u)}var A=q%12,B=Math.floor(q/12);return A<3?s.formatDistance("aboutXYears",B,u):A<9?s.formatDistance("overXYears",B,u):s.formatDistance("almostXYears",B+1,u)}(a,Date.now(),k)}a.s(["formatDistanceToNow",()=>k],603420)},952498,a=>{"use strict";var b=a.i(269240);a.i(452218);var c=a.i(571907),d=a.i(325383),e=a.i(49492);let f=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getAll(a,b){try{let c={};return b?.studentId&&(c.student_id=b.studentId),b?.classId&&(c.class_id=b.classId),b?.programSessionId&&(c.session_id=b.programSessionId),b?.date&&(c.date=b.date),b?.status&&(c.status=b.status),(0,e.getAllByOrganization)(this.supabase,"attendance",a,{select:"*, students(id, first_name, last_name, student_number), classes(id, name), sessions(id, title, start_time)",filters:c,orderBy:{column:"date",ascending:!1}})}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{organizationId:a,operation:"getAll"})}}async getByClassAndDate(a,b){try{let{data:d,error:e}=await this.supabase.from("attendance").select("*, students(id, first_name, last_name, student_number)").eq("class_id",a).eq("date",b).order("students(last_name)",{ascending:!0});if(e)throw c.errorHandler.handleError(e,{operation:"getByClassAndDate",classId:a,date:b});return d||[]}catch(d){if(d instanceof c.AppError)throw d;throw c.errorHandler.handleError(d,{operation:"getByClassAndDate",classId:a,date:b})}}async getBySessionAndDate(a,b){try{let{data:d,error:e}=await this.supabase.from("attendance").select("*, students(id, first_name, last_name, student_number)").eq("session_id",a).eq("date",b).order("students(last_name)",{ascending:!0});if(e)throw c.errorHandler.handleError(e,{operation:"getBySessionAndDate",sessionId:a,date:b});return d||[]}catch(d){if(d instanceof c.AppError)throw d;throw c.errorHandler.handleError(d,{operation:"getBySessionAndDate",sessionId:a,date:b})}}async upsert(a){if(a.session_id&&(a.latitude||a.longitude)){let b=await this.validateLocation(a.session_id,a.latitude,a.longitude);if(!b.valid)throw c.errorHandler.createValidationError(b.error||"Localisation invalide","location");a.location_verified=b.verified}try{let{data:b,error:e}=await this.supabase.from("attendance").upsert(a,{onConflict:"student_id,class_id,session_id,date"}).select().single();if(e){if("42501"===e.code)throw c.errorHandler.handleError(e,{code:c.ErrorCode.DB_RLS_POLICY_VIOLATION,operation:"upsert"});throw c.errorHandler.handleError(e,{operation:"upsert",attendance:a})}return d.logger.info("Émargement créé/mis à jour avec succès",{id:b?.id,studentId:a.student_id,date:a.date}),b}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"upsert",attendance:a})}}async validateLocation(a,b,c){if(!b||!c)return{valid:!1,verified:!1,error:"Coordonnées GPS manquantes"};let{data:d,error:e}=await this.supabase.from("sessions").select("latitude, longitude, require_location_for_attendance, allowed_attendance_radius_meters").eq("id",a).single();if(e||!d)return{valid:!1,verified:!1,error:"Session non trouvée"};if(!d.require_location_for_attendance)return{valid:!0,verified:!1};if(!d.latitude||!d.longitude)return{valid:!0,verified:!1,error:"Session sans coordonnées GPS"};let f=this.calculateDistance(d.latitude,d.longitude,b,c);return d.allowed_attendance_radius_meters&&f>d.allowed_attendance_radius_meters?{valid:!1,verified:!1,error:`Vous \xeates trop loin de la session (${Math.round(f)}m, maximum: ${d.allowed_attendance_radius_meters}m)`,distance:f}:{valid:!0,verified:!0,distance:f}}calculateDistance(a,b,c,d){let e=a*Math.PI/180,f=c*Math.PI/180,g=(c-a)*Math.PI/180,h=(d-b)*Math.PI/180,i=Math.sin(g/2)*Math.sin(g/2)+Math.cos(e)*Math.cos(f)*Math.sin(h/2)*Math.sin(h/2);return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))*6371e3}async update(a,b){try{let{data:e,error:f}=await this.supabase.from("attendance").update(b).eq("id",a).select().single();if(f){if("PGRST116"===f.code||"42P01"===f.code)throw c.errorHandler.handleError(f,{code:c.ErrorCode.DB_NOT_FOUND,operation:"update",id:a});if("42501"===f.code)throw c.errorHandler.handleError(f,{code:c.ErrorCode.DB_RLS_POLICY_VIOLATION,operation:"update",id:a});throw c.errorHandler.handleError(f,{operation:"update",id:a,updates:b})}if(!e)throw c.errorHandler.createDatabaseError(`\xc9margement avec l'ID ${a} introuvable pour la mise \xe0 jour`,{id:a});return d.logger.info("Émargement mis à jour avec succès",{id:a,updates:b}),e}catch(d){if(d instanceof c.AppError)throw d;throw c.errorHandler.handleError(d,{operation:"update",id:a,updates:b})}}async markMultiple(a,b){let e=b.map(b=>({organization_id:a,...b,late_minutes:b.late_minutes||0}));try{if(!b||0===b.length)throw c.errorHandler.createValidationError("Aucun enregistrement à marquer","records");let{data:f,error:g}=await this.supabase.from("attendance").upsert(e,{onConflict:"student_id,class_id,session_id,date"}).select();if(g)throw c.errorHandler.handleError(g,{operation:"markMultiple",organizationId:a,count:b.length});return d.logger.info("Présences marquées en masse avec succès",{organizationId:a,count:f?.length||0}),f||[]}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"markMultiple",organizationId:a})}}async getStudentStats(a,b,d){let e=this.supabase.from("attendance").select("status, date").eq("student_id",a);b&&(e=e.gte("date",b)),d&&(e=e.lte("date",d));try{let{data:a,error:b}=await e;if(b)throw b;let c=a?.length||0,d=a?.filter(a=>"present"===a.status).length||0,f=a?.filter(a=>"absent"===a.status).length||0,g=a?.filter(a=>"late"===a.status).length||0,h=a?.filter(a=>"excused"===a.status).length||0;return{total:c,present:d,absent:f,late:g,excused:h,attendanceRate:c>0?d/c*100:0}}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"getStudentStats",studentId:a})}}async getClassStats(a,b){let d=this.supabase.from("attendance").select("status").eq("class_id",a);b&&(d=d.eq("date",b));try{let{data:e,error:f}=await d;if(f)throw c.errorHandler.handleError(f,{operation:"getClassStats",classId:a,date:b});let g=e?.length||0,h=e?.filter(a=>"present"===a.status).length||0,i=e?.filter(a=>"absent"===a.status).length||0;return{total:g,present:h,absent:i,attendanceRate:g>0?h/g*100:0}}catch(b){if(b instanceof c.AppError)throw b;throw c.errorHandler.handleError(b,{operation:"getClassStats",classId:a})}}async saveTeacherSignature(a,b){return this.update(a,{teacher_signature_url:b})}};a.s(["attendanceService",0,f])},611099,a=>{"use strict";var b=a.i(187924),c=a.i(50944),d=a.i(433217),e=a.i(370025),f=a.i(269240),g=a.i(952498),h=a.i(555074),i=a.i(913216),j=a.i(340695),k=a.i(703130),l=a.i(400210),m=a.i(114548),n=a.i(495756),o=a.i(54018),p=a.i(641710),q=a.i(290821),r=a.i(941675),s=a.i(238246),t=a.i(497895),u=a.i(572131);a.i(158057);var v=a.i(59573),w=a.i(621958);function x(){let a=(0,c.useParams)(),x=(0,c.useSearchParams)();(0,c.useRouter)();let y=a.id,z=x.get("date")||new Date().toISOString().split("T")[0],{user:A}=(0,i.useAuth)(),B=(0,f.createClient)(),{data:C,isLoading:D}=(0,d.useQuery)({queryKey:["session",y],queryFn:()=>h.sessionService.getSessionById(y),enabled:!!y}),{data:E,isLoading:F}=(0,d.useQuery)({queryKey:["session-enrollments",y],queryFn:async()=>{let{data:a,error:b}=await B.from("enrollments").select("*, students(*)").eq("session_id",y).in("status",["confirmed","completed"]).order("students(last_name)",{ascending:!0});if(b)throw b;return(a||[]).map(a=>({...a,students:a.students||void 0}))},enabled:!!y}),{data:G,refetch:H}=(0,d.useQuery)({queryKey:["attendance-session",y,z],queryFn:async()=>(await g.attendanceService.getBySessionAndDate(y,z)).map(a=>({...a,students:a.students||void 0})),enabled:!!y}),[I,J]=(0,u.useState)({});(0,u.useEffect)(()=>{if(G&&Array.isArray(G)&&E){let a={};for(let b of G)b.student_id&&(a[b.student_id]={status:b.status,lateMinutes:b.late_minutes??void 0,notes:b.notes||""});E.forEach(b=>{let c=b.student_id;c&&!a[c]&&(a[c]={status:"present",lateMinutes:0,notes:""})}),J(a)}else if(E&&Array.isArray(E)){let a={};for(let b of E)b.student_id&&(a[b.student_id]={status:"present",lateMinutes:0,notes:""});J(a)}},[G,E]);let K=(a,b,c)=>{J(d=>({...d,[a]:{...d[a],[b]:c}}))},L=(0,e.useMutation)({mutationFn:async()=>{if(!A?.organization_id||!E)throw Error("Données manquantes");let a=E.filter(a=>a.student_id).map(a=>({student_id:a.student_id,session_id:y,date:z,status:I[a.student_id]?.status||"present",late_minutes:I[a.student_id]?.lateMinutes||0,teacher_id:A.id,notes:I[a.student_id]?.notes||void 0}));return g.attendanceService.markMultiple(A.organization_id,a)},onSuccess:()=>{H()}}),M=E?.map(a=>a.students).filter(Boolean)||[],N=M.length>0?{total:M.length,present:Object.values(I).filter(a=>"present"===a.status).length,absent:Object.values(I).filter(a=>"absent"===a.status).length,late:Object.values(I).filter(a=>"late"===a.status).length,excused:Object.values(I).filter(a=>"excused"===a.status).length}:null;if(D||F)return(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)("div",{className:"text-center",children:(0,b.jsx)("div",{className:"text-muted-foreground",children:"Chargement..."})})});if(!C)return(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-muted-foreground",children:"Session non trouvée"}),(0,b.jsx)(s.default,{href:"/dashboard/sessions",children:(0,b.jsx)(j.Button,{className:"mt-4",children:"Retour à la liste des sessions"})})]})});let O=C?.formations,P=O?.programs;return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)(s.default,{href:`/dashboard/sessions/${y}`,children:(0,b.jsx)(j.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(l.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-bold text-gray-900",children:["Émargement - ",C?.name||"Session"]}),(0,b.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:[O&&(0,b.jsx)(s.default,{href:`/dashboard/formations/${O?.id}`,className:"text-primary hover:underline",children:O?.name}),P&&(0,b.jsxs)(b.Fragment,{children:[" • ",(0,b.jsx)(s.default,{href:`/dashboard/programs/${P?.id}`,className:"text-primary hover:underline",children:P?.name})]})," - ",(0,b.jsxs)("span",{className:"flex items-center inline-flex mt-1",children:[(0,b.jsx)(r.Calendar,{className:"mr-1 h-3 w-3"}),(0,t.formatDate)(z)]}),C?.location&&` - ${C.location}`]})]})]}),(0,b.jsxs)(w.Tabs,{defaultValue:"manual",className:"w-full",children:[(0,b.jsxs)(w.TabsList,{className:"grid w-full grid-cols-2",children:[(0,b.jsx)(w.TabsTrigger,{value:"manual",children:"Émargement manuel"}),(0,b.jsx)(w.TabsTrigger,{value:"electronic",children:"Émargement électronique"})]}),(0,b.jsxs)(w.TabsContent,{value:"manual",className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex items-center justify-end",children:(0,b.jsxs)(j.Button,{onClick:()=>L.mutate(),disabled:L.isPending||0===M.length,children:[(0,b.jsx)(m.Save,{className:"mr-2 h-4 w-4"}),L.isPending?"Enregistrement...":"Enregistrer"]})}),N&&(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,b.jsx)(k.Card,{children:(0,b.jsx)(k.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:N.total}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total"})]})})}),(0,b.jsx)(k.Card,{children:(0,b.jsx)(k.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-success-primary",children:N.present}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Présents"})]})})}),(0,b.jsx)(k.Card,{children:(0,b.jsx)(k.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:N.absent}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Absents"})]})})}),(0,b.jsx)(k.Card,{children:(0,b.jsx)(k.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-warning-primary",children:N.late}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"En retard"})]})})}),(0,b.jsx)(k.Card,{children:(0,b.jsx)(k.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:N.excused}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Justifiés"})]})})})]}),(0,b.jsxs)(k.Card,{children:[(0,b.jsx)(k.CardHeader,{children:(0,b.jsx)(k.CardTitle,{children:"Liste des participants"})}),(0,b.jsx)(k.CardContent,{children:E&&E.length>0?(0,b.jsx)("div",{className:"space-y-4",children:E.map(a=>{let c=a.students;if(!c)return null;let d=I[a.student_id||""]||{status:"present",lateMinutes:0,notes:""};return(0,b.jsxs)("div",{className:"flex items-center space-x-4 p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:c.photo_url?(0,b.jsx)("img",{src:c.photo_url,alt:`${c.first_name} ${c.last_name}`,className:"h-12 w-12 rounded-full object-cover"}):(0,b.jsxs)("div",{className:"h-12 w-12 rounded-full bg-primary text-white flex items-center justify-center font-semibold",children:[c.first_name.charAt(0),c.last_name.charAt(0)]})}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsxs)("h3",{className:"font-semibold truncate",children:[c.first_name," ",c.last_name]}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:c.student_number})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,b.jsx)("div",{className:"flex space-x-2",children:["present","absent","late","excused"].map(a=>(0,b.jsx)("button",{type:"button",onClick:()=>K(c.id,"status",a),className:`p-2 rounded-lg transition-colors min-touch-target touch-manipulation ${d.status===a?"bg-primary text-white":"bg-gray-100 hover:bg-gray-200"}`,title:(a=>{switch(a){case"present":return"Présent";case"absent":return"Absent";case"late":return"En retard";case"excused":return"Justifié"}})(a),children:(a=>{switch(a){case"present":return(0,b.jsx)(n.CheckCircle,{className:"h-5 w-5 text-success-primary"});case"absent":return(0,b.jsx)(o.XCircle,{className:"h-5 w-5 text-red-600"});case"late":return(0,b.jsx)(p.Clock,{className:"h-5 w-5 text-warning-primary"});case"excused":return(0,b.jsx)(q.AlertCircle,{className:"h-5 w-5 text-blue-600"})}})(a)},a))}),"late"===d.status&&(0,b.jsxs)("div",{className:"w-20",children:[(0,b.jsx)("input",{type:"number",min:"0",value:d.lateMinutes||0,onChange:b=>K(a.student_id||"","lateMinutes",parseInt(b.target.value)||0),className:"w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"min"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground text-center mt-1",children:"min"})]}),(0,b.jsx)("div",{className:"w-32",children:(0,b.jsx)("input",{type:"text",value:d.notes||"",onChange:b=>K(a.student_id||"","notes",b.target.value),className:"w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"Notes..."})})]})]},a.id)})}):(0,b.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"Aucun participant inscrit à cette session"})})]}),L.error&&(0,b.jsx)("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-lg text-sm",children:L.error instanceof Error?L.error.message:"Une erreur est survenue lors de l'enregistrement"}),L.isSuccess&&(0,b.jsx)("div",{className:"bg-success-bg text-success-primary px-4 py-3 rounded-lg text-sm",children:"Émargement enregistré avec succès !"})]}),(0,b.jsx)(w.TabsContent,{value:"electronic",className:"space-y-6",children:A?.organization_id&&(0,b.jsx)(v.ElectronicAttendanceManager,{sessionId:y,organizationId:A.organization_id})})]})]})}a.s(["default",()=>x])}];

//# sourceMappingURL=_57671b91._.js.map