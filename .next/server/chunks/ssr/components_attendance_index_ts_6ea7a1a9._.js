module.exports=[158057,59573,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(340695),e=a.i(703130),f=a.i(265602),g=a.i(254161),h=a.i(965733),i=a.i(205522),j=a.i(917171),k=a.i(46143),l=a.i(497895);let m=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("div",{className:"relative w-full overflow-auto",children:(0,b.jsx)("table",{ref:d,className:(0,l.cn)("w-full caption-bottom text-sm",a),...c})}));m.displayName="Table";let n=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("thead",{ref:d,className:(0,l.cn)("[&_tr]:border-b",a),...c}));n.displayName="TableHeader";let o=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("tbody",{ref:d,className:(0,l.cn)("[&_tr:last-child]:border-0",a),...c}));o.displayName="TableBody",c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("tfoot",{ref:d,className:(0,l.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...c})).displayName="TableFooter";let p=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("tr",{ref:d,className:(0,l.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...c}));p.displayName="TableRow";let q=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("th",{ref:d,className:(0,l.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...c}));q.displayName="TableHead";let r=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("td",{ref:d,className:(0,l.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",a),...c}));r.displayName="TableCell",c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("caption",{ref:d,className:(0,l.cn)("mt-4 text-sm text-muted-foreground",a),...c})).displayName="TableCaption";var s=a.i(526017),t=a.i(915618),u=a.i(692759),v=a.i(495756),w=a.i(992258),x=a.i(124987),y=a.i(284505),z=a.i(603420),A=a.i(433363);function B({sessionId:a,organizationId:l}){let[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(!0),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)({title:"",date:new Date().toISOString().split("T")[0],startTime:"",endTime:"",requireGeolocation:!1,allowedRadiusMeters:100});(0,c.useEffect)(()=>{N()},[a]);let N=async()=>{try{E(!0),G(null);let b=await fetch(`/api/electronic-attendance/sessions?sessionId=${a}`);if(!b.ok)throw Error("Erreur lors du chargement");let c=await b.json();C(c)}catch(a){G(a instanceof Error?a.message:"Erreur inconnue")}finally{E(!1)}},O=async()=>{try{K(!0),G(null);let b=await fetch("/api/electronic-attendance/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:a,organizationId:l,title:L.title,date:L.date,startTime:L.startTime||null,endTime:L.endTime||null,mode:"electronic",requireGeolocation:L.requireGeolocation,allowedRadiusMeters:L.allowedRadiusMeters})});if(!b.ok){let a=await b.json();throw Error(a.error||"Erreur lors de la création")}I(!1),M({title:"",date:new Date().toISOString().split("T")[0],startTime:"",endTime:"",requireGeolocation:!1,allowedRadiusMeters:100}),N()}catch(a){G(a instanceof Error?a.message:"Erreur inconnue")}finally{K(!1)}},P=async a=>{if(confirm("Voulez-vous lancer cette session d'émargement ? Des emails seront envoyés à tous les apprenants inscrits."))try{let b=await fetch(`/api/electronic-attendance/sessions/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"launch",sendEmails:!0})});if(!b.ok){let a=await b.json();throw Error(a.error||"Erreur lors du lancement")}N()}catch(a){G(a instanceof Error?a.message:"Erreur inconnue")}},Q=async a=>{if(confirm("Voulez-vous fermer cette session d'émargement ? Les demandes non signées seront marquées comme expirées."))try{let b=await fetch(`/api/electronic-attendance/sessions/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"close"})});if(!b.ok){let a=await b.json();throw Error(a.error||"Erreur lors de la fermeture")}N()}catch(a){G(a instanceof Error?a.message:"Erreur inconnue")}},R=async a=>{try{let b=await fetch(`/api/electronic-attendance/requests/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"remind"})});if(!b.ok){let a=await b.json();throw Error(a.error||"Erreur lors de l'envoi du rappel")}alert("Rappel envoyé avec succès")}catch(a){G(a instanceof Error?a.message:"Erreur inconnue")}},S=a=>{switch(a){case"draft":return(0,b.jsx)(g.Badge,{variant:"secondary",children:"Brouillon"});case"active":return(0,b.jsx)(g.Badge,{className:"bg-green-500",children:"Active"});case"closed":return(0,b.jsx)(g.Badge,{variant:"outline",children:"Fermée"});case"cancelled":return(0,b.jsx)(g.Badge,{variant:"destructive",children:"Annulée"});case"signed":return(0,b.jsx)(g.Badge,{className:"bg-green-500",children:"Signé"});case"pending":return(0,b.jsx)(g.Badge,{variant:"secondary",children:"En attente"});case"expired":return(0,b.jsx)(g.Badge,{variant:"outline",children:"Expiré"});default:return(0,b.jsx)(g.Badge,{children:a})}};return D&&0===B.length?(0,b.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,b.jsx)(s.Loader2,{className:"h-6 w-6 animate-spin"})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)(e.Card,{children:(0,b.jsx)(e.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Gestion des émargements"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Deux modes d'émargement sont disponibles pour vos sessions de formation :"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)("div",{className:"p-4 border rounded-lg bg-blue-50 border-blue-200",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(v.CheckCircle,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold text-blue-900 mb-1",children:"Émargement manuel"}),(0,b.jsx)("p",{className:"text-sm text-blue-700",children:"Cochez directement les présences, absences et retards depuis l'interface. Idéal pour les formations en présentiel avec contrôle direct."})]})]})}),(0,b.jsx)("div",{className:"p-4 border rounded-lg bg-green-50 border-green-200",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(w.Mail,{className:"h-5 w-5 text-green-600 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h4",{className:"font-semibold text-green-900 mb-1",children:"Émargement numérique"}),(0,b.jsx)("p",{className:"text-sm text-green-700",children:"Envoyez automatiquement des demandes d'émargement par email avec signature électronique. Support de la géolocalisation pour valider la présence physique."})]})]})})]})]})})}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"Sessions d'émargement numérique"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Créez et gérez les sessions d'émargement avec envoi d'emails automatiques aux apprenants"})]}),(0,b.jsxs)(h.Dialog,{open:H,onOpenChange:I,children:[(0,b.jsx)(h.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(d.Button,{children:[(0,b.jsx)(t.Plus,{className:"h-4 w-4 mr-2"}),"Nouvelle session"]})}),(0,b.jsxs)(h.DialogContent,{children:[(0,b.jsxs)(h.DialogHeader,{children:[(0,b.jsx)(h.DialogTitle,{children:"Nouvelle session d'émargement numérique"}),(0,b.jsx)(h.DialogDescription,{children:"Créez une session d'émargement avec envoi automatique d'emails aux apprenants inscrits"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"title",children:"Titre *"}),(0,b.jsx)(i.Input,{id:"title",value:L.title,onChange:a=>M({...L,title:a.target.value}),placeholder:"Ex: Émargement du 15 janvier"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"date",children:"Date *"}),(0,b.jsx)(i.Input,{id:"date",type:"date",value:L.date,onChange:a=>M({...L,date:a.target.value})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"startTime",children:"Heure de début"}),(0,b.jsx)(i.Input,{id:"startTime",type:"time",value:L.startTime,onChange:a=>M({...L,startTime:a.target.value})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"endTime",children:"Heure de fin"}),(0,b.jsx)(i.Input,{id:"endTime",type:"time",value:L.endTime,onChange:a=>M({...L,endTime:a.target.value})})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(k.Checkbox,{id:"requireGeolocation",checked:L.requireGeolocation,onCheckedChange:a=>M({...L,requireGeolocation:a})}),(0,b.jsx)(j.Label,{htmlFor:"requireGeolocation",className:"cursor-pointer",children:"Exiger la géolocalisation"})]}),L.requireGeolocation&&(0,b.jsxs)("div",{children:[(0,b.jsx)(j.Label,{htmlFor:"allowedRadiusMeters",children:"Rayon autorisé (mètres)"}),(0,b.jsx)(i.Input,{id:"allowedRadiusMeters",type:"number",min:"10",value:L.allowedRadiusMeters,onChange:a=>M({...L,allowedRadiusMeters:parseInt(a.target.value)||100})})]})]}),(0,b.jsxs)(h.DialogFooter,{children:[(0,b.jsx)(d.Button,{variant:"outline",onClick:()=>I(!1),disabled:J,children:"Annuler"}),(0,b.jsxs)(d.Button,{onClick:O,disabled:J||!L.title,children:[J&&(0,b.jsx)(s.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Créer"]})]})]})]})]}),F&&(0,b.jsx)(f.Alert,{variant:"destructive",children:(0,b.jsx)(f.AlertDescription,{children:F})}),0===B.length?(0,b.jsx)(e.Card,{children:(0,b.jsxs)(e.CardContent,{className:"flex flex-col items-center justify-center p-8 text-center",children:[(0,b.jsx)("p",{className:"text-gray-500",children:"Aucune session d'émargement"}),(0,b.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Créez une session pour commencer à gérer les émargements"})]})}):(0,b.jsx)("div",{className:"space-y-4",children:B.map(a=>(0,b.jsxs)(e.Card,{children:[(0,b.jsx)(e.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(e.CardTitle,{className:"text-base",children:a.title}),(0,b.jsxs)(e.CardDescription,{children:[new Date(a.date).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),a.start_time&&` • ${a.start_time}`,a.require_geolocation&&(0,b.jsxs)("span",{className:"inline-flex items-center ml-2",children:[(0,b.jsx)(x.MapPin,{className:"h-3 w-3 mr-1"}),"Géolocalisation requise"]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[S(a.status),(0,b.jsxs)(g.Badge,{variant:"outline",children:[a.total_signed,"/",a.total_expected]})]})]})}),(0,b.jsxs)(e.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:["draft"===a.status&&(0,b.jsxs)(d.Button,{onClick:()=>P(a.id),size:"sm",children:[(0,b.jsx)(u.Send,{className:"h-4 w-4 mr-2"}),"Lancer"]}),"active"===a.status&&(0,b.jsx)(d.Button,{onClick:()=>Q(a.id),size:"sm",variant:"outline",children:"Fermer"}),(0,b.jsxs)(d.Button,{size:"sm",variant:"outline",children:[(0,b.jsx)(y.Download,{className:"h-4 w-4 mr-2"}),"Exporter"]})]}),a.requests&&a.requests.length>0&&(0,b.jsx)("div",{className:"border rounded-lg",children:(0,b.jsxs)(m,{children:[(0,b.jsx)(n,{children:(0,b.jsxs)(p,{children:[(0,b.jsx)(q,{children:"Apprenant"}),(0,b.jsx)(q,{children:"Email"}),(0,b.jsx)(q,{children:"Statut"}),(0,b.jsx)(q,{children:"Date de signature"}),(0,b.jsx)(q,{className:"text-right",children:"Actions"})]})}),(0,b.jsx)(o,{children:a.requests.map(a=>(0,b.jsxs)(p,{children:[(0,b.jsx)(r,{className:"font-medium",children:a.student_name}),(0,b.jsx)(r,{children:a.student_email}),(0,b.jsx)(r,{children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[S(a.status),a.location_verified&&(0,b.jsx)("span",{title:"Position vérifiée",children:(0,b.jsx)(x.MapPin,{className:"h-3 w-3 text-green-500"})})]})}),(0,b.jsx)(r,{children:a.signed_at?(0,z.formatDistanceToNow)(new Date(a.signed_at),{addSuffix:!0,locale:A.fr}):"-"}),(0,b.jsx)(r,{className:"text-right",children:"pending"===a.status&&(0,b.jsx)(d.Button,{size:"sm",variant:"ghost",onClick:()=>R(a.id),children:(0,b.jsx)(w.Mail,{className:"h-4 w-4"})})})]},a.id))})]})})]})]},a.id))})]})}a.s(["ElectronicAttendanceManager",()=>B],59573),a.s([],158057)}];

//# sourceMappingURL=components_attendance_index_ts_6ea7a1a9._.js.map