module.exports=[704615,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944),e=a.i(370025),f=a.i(433217),g=a.i(695245),h=a.i(159501),i=a.i(88780),j=a.i(913216),k=a.i(235792),l=a.i(269240),m=a.i(340695),n=a.i(219897),o=a.i(400210),p=a.i(109347),q=a.i(114548),r=a.i(773320),s=a.i(633508),t=a.i(104720),u=a.i(64791),v=a.i(838632),w=a.i(179257),x=a.i(216686),y=a.i(238246),z=a.i(864037);a.i(460355);var A=a.i(346271),B=a.i(497895);let C=i.z.object({title:i.z.string().min(3,"Le titre doit contenir au moins 3 caractères"),slug:i.z.string().min(3,"Le slug doit contenir au moins 3 caractères").regex(/^[a-z0-9-]+$/,"Le slug ne peut contenir que des lettres minuscules, chiffres et tirets"),description:i.z.string().optional(),resource_type:i.z.enum(["document","video","audio","image","link","interactive","other"]).default("document"),category_id:i.z.string().optional(),external_url:i.z.string().url().optional().or(i.z.literal("")),tags:i.z.string().optional(),is_featured:i.z.boolean().default(!1),status:i.z.enum(["draft","published","archived"]).default("published")}),D={document:t.FileText,video:u.Video,audio:x.Music,image:v.Image,link:w.Link,interactive:t.FileText,other:t.FileText},E={document:"Document",video:"Vidéo",audio:"Audio",image:"Image",link:"Lien externe",interactive:"Interactif",other:"Autre"};function F(){let a=(0,d.useRouter)(),{user:i}=(0,j.useAuth)(),{addToast:u}=(0,z.useToast)(),v=(0,l.createClient)(),[w,x]=(0,c.useState)(null),[F,G]=(0,c.useState)(null),[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)(null),{data:L}=(0,f.useQuery)({queryKey:["resource-categories",i?.organization_id],queryFn:()=>k.educationalResourcesService.getCategories(i?.organization_id||""),enabled:!!i?.organization_id}),{register:M,handleSubmit:N,formState:{errors:O},watch:P,setValue:Q}=(0,g.useForm)({resolver:(0,h.zodResolver)(C),mode:"onChange",defaultValues:{resource_type:"document",status:"published",is_featured:!1}}),R=P("resource_type");P("title");let S=(0,e.useMutation)({mutationFn:async a=>{if(!i?.organization_id)throw Error("Organization ID manquant");let b=null,c=null;if(w){let a=w.name.split(".").pop(),d=`${i.organization_id}/resources/${Date.now()}.${a}`,{data:e,error:f}=await v.storage.from("educational-resources").upload(d,w);if(f)throw f;let{data:g}=v.storage.from("educational-resources").getPublicUrl(d);b=g.publicUrl,c=w.size}let d=null;if(H){let a=H.name.split(".").pop(),b=`${i.organization_id}/thumbnails/${Date.now()}.${a}`,{data:c,error:e}=await v.storage.from("resource-thumbnails").upload(b,H);if(e)throw e;let{data:f}=v.storage.from("resource-thumbnails").getPublicUrl(b);d=f.publicUrl}let e=a.tags?a.tags.split(",").map(a=>a.trim()).filter(a=>a.length>0):[];return k.educationalResourcesService.createResource({organization_id:i.organization_id,title:a.title,slug:a.slug,description:a.description||null,resource_type:a.resource_type,category_id:a.category_id||null,external_url:a.external_url||null,file_url:b,thumbnail_url:d,file_size_bytes:c,tags:e.length>0?e:null,is_featured:a.is_featured,status:a.status,author_id:i.id,view_count:0,download_count:0,favorite_count:0})},onSuccess:b=>{u({type:"success",title:"Ressource créée avec succès",description:"Votre ressource a été ajoutée à la bibliothèque."}),a.push(`/dashboard/resources/${b.slug}`)},onError:a=>{u({type:"error",title:"Erreur",description:a.message||"Une erreur est survenue lors de la création de la ressource"})}});return(0,b.jsxs)(A.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-8 pb-8 max-w-5xl mx-auto p-6",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(y.default,{href:"/dashboard/resources",children:(0,b.jsx)(m.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(o.ArrowLeft,{className:"h-4 w-4"})})}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-brand-blue-ghost rounded-xl",children:(0,b.jsx)(p.Library,{className:"h-6 w-6 text-brand-blue"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Nouvelle ressource"}),(0,b.jsx)("p",{className:"text-gray-500 mt-1",children:"Ajoutez une ressource à la bibliothèque pédagogique"})]})]})]}),(0,b.jsxs)("form",{onSubmit:N(a=>{S.mutate(a)}),className:"space-y-6",children:[(0,b.jsxs)(n.GlassCard,{variant:"premium",className:"p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Informations principales"}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Titre de la ressource *"}),(0,b.jsx)("input",{type:"text",...M("title"),onChange:a=>{let b=a.target.value;Q("title",b),b&&Q("slug",b.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))},className:(0,B.cn)("w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",O.title?"border-red-500":"border-gray-200"),placeholder:"Ex: Guide complet de React"}),O.title&&(0,b.jsx)("p",{className:"text-sm text-red-600 mt-1",children:O.title.message})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Slug (URL) *"}),(0,b.jsx)("input",{type:"text",...M("slug"),className:(0,B.cn)("w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all bg-gray-50",O.slug?"border-red-500":"border-gray-200"),placeholder:"guide-complet-react"}),O.slug&&(0,b.jsx)("p",{className:"text-sm text-red-600 mt-1",children:O.slug.message})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type de ressource"}),(0,b.jsx)("select",{...M("resource_type"),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",children:Object.entries(E).map(([a,c])=>(D[a],(0,b.jsx)("option",{value:a,children:c},a)))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,b.jsx)("textarea",{...M("description"),rows:6,className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all resize-none",placeholder:"Décrivez cette ressource en détail..."})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Catégorie"}),(0,b.jsxs)("select",{...M("category_id"),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",children:[(0,b.jsx)("option",{value:"",children:"Aucune catégorie"}),L?.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tags (séparés par des virgules)"}),(0,b.jsx)("input",{type:"text",...M("tags"),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:"Ex: react, javascript, tutoriel"}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Séparez les tags par des virgules"})]}),"link"===R&&(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"URL externe *"}),(0,b.jsx)("input",{type:"url",...M("external_url"),className:(0,B.cn)("w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",O.external_url?"border-red-500":"border-gray-200"),placeholder:"https://example.com"}),O.external_url&&(0,b.jsx)("p",{className:"text-sm text-red-600 mt-1",children:O.external_url.message})]})]})]}),"link"!==R&&(0,b.jsxs)(n.GlassCard,{variant:"premium",className:"p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Fichier"}),(0,b.jsx)("div",{className:"space-y-4",children:F?(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("img",{src:F,alt:"Aperçu",className:"w-full h-64 object-cover rounded-lg border border-gray-200"}),(0,b.jsx)("button",{type:"button",onClick:()=>{x(null),G(null)},className:"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:(0,b.jsx)(s.X,{className:"h-4 w-4"})})]}):w?(0,b.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4 flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)(t.FileText,{className:"h-8 w-8 text-gray-400"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:w.name}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[(w.size/1024/1024).toFixed(2)," MB"]})]})]}),(0,b.jsx)("button",{type:"button",onClick:()=>x(null),className:"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors",children:(0,b.jsx)(s.X,{className:"h-4 w-4"})})]}):(0,b.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-brand-blue transition-colors",children:[(0,b.jsx)(r.Upload,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600 mb-2",children:"Cliquez pour télécharger un fichier"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Tous les formats acceptés jusqu'à 100MB"}),(0,b.jsx)("input",{type:"file",onChange:a=>{let b=a.target.files?.[0];if(b&&(x(b),b.type.startsWith("image/"))){let a=new FileReader;a.onloadend=()=>{G(a.result)},a.readAsDataURL(b)}},className:"hidden",id:"file-upload"}),(0,b.jsx)("label",{htmlFor:"file-upload",className:"inline-block px-4 py-2 bg-brand-blue text-white rounded-lg hover:bg-brand-blue/90 transition-colors cursor-pointer",children:"Choisir un fichier"})]})})]}),(0,b.jsxs)(n.GlassCard,{variant:"premium",className:"p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Miniature (optionnel)"}),(0,b.jsx)("div",{className:"space-y-4",children:J?(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("img",{src:J,alt:"Aperçu",className:"w-full h-64 object-cover rounded-lg border border-gray-200"}),(0,b.jsx)("button",{type:"button",onClick:()=>{I(null),K(null)},className:"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:(0,b.jsx)(s.X,{className:"h-4 w-4"})})]}):(0,b.jsxs)("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-12 text-center hover:border-brand-blue transition-colors",children:[(0,b.jsx)(r.Upload,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600 mb-2",children:"Cliquez pour télécharger une miniature"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"PNG, JPG jusqu'à 5MB"}),(0,b.jsx)("input",{type:"file",accept:"image/*",onChange:a=>{let b=a.target.files?.[0];if(b){I(b);let a=new FileReader;a.onloadend=()=>{K(a.result)},a.readAsDataURL(b)}},className:"hidden",id:"thumbnail-upload"}),(0,b.jsx)("label",{htmlFor:"thumbnail-upload",className:"mt-4 inline-block px-4 py-2 bg-brand-blue text-white rounded-lg hover:bg-brand-blue/90 transition-colors cursor-pointer",children:"Choisir un fichier"})]})})]}),(0,b.jsxs)(n.GlassCard,{variant:"premium",className:"p-6",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Options de publication"}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Statut"}),(0,b.jsxs)("select",{...M("status"),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",children:[(0,b.jsx)("option",{value:"draft",children:"Brouillon"}),(0,b.jsx)("option",{value:"published",children:"Publié"}),(0,b.jsx)("option",{value:"archived",children:"Archivé"})]})]}),(0,b.jsxs)("label",{className:"flex items-center gap-3 cursor-pointer",children:[(0,b.jsx)("input",{type:"checkbox",...M("is_featured"),className:"w-5 h-5 text-brand-blue border-gray-300 rounded focus:ring-brand-blue"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"font-medium text-gray-900",children:"Mettre en vedette"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:'La ressource apparaîtra dans la section "En vedette"'})]})]})]})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,b.jsx)(y.default,{href:"/dashboard/resources",children:(0,b.jsx)(m.Button,{variant:"ghost",type:"button",children:"Annuler"})}),(0,b.jsx)(m.Button,{type:"submit",disabled:S.isPending,className:"bg-brand-blue hover:bg-brand-blue/90 text-white shadow-lg shadow-brand-blue/20",children:S.isPending?(0,b.jsx)(b.Fragment,{children:"Création..."}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.Save,{className:"h-4 w-4 mr-2"}),"Créer la ressource"]})})]})]})]})}a.s(["default",()=>F])}];

//# sourceMappingURL=app_%28dashboard%29_dashboard_resources_new_page_tsx_7e1f1d83._.js.map