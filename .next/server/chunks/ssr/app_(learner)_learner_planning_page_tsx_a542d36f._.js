module.exports=[610214,a=>{"use strict";var b=a.i(187924),c=a.i(433217),d=a.i(572131),e=a.i(323625),f=a.i(727163),g=a.i(219897),h=a.i(340695),i=a.i(254161);a.i(460355);var j=a.i(346271),k=a.i(941675),l=a.i(641710),m=a.i(124987),n=a.i(613749),o=a.i(50522),p=a.i(960702),q=a.i(64791),r=a.i(660246),s=a.i(800515),t=a.i(188950),u=a.i(212955),v=a.i(335151),v=v;function w(a,b){(0,u.default)(1,arguments);var c,d=a||{},e=(0,t.default)(d.start),f=(0,t.default)(d.end).getTime();if(!(e.getTime()<=f))throw RangeError("Invalid interval");var g=[];e.setHours(0,0,0,0);var h=Number(null!=(c=null==b?void 0:b.step)?c:1);if(h<1||isNaN(h))throw RangeError("`options.step` must be a number greater than 1");for(;e.getTime()<=f;)g.push((0,t.default)(e)),e.setDate(e.getDate()+h),e.setHours(0,0,0,0);return g}var x=a.i(780330);function y(a,b){(0,u.default)(2,arguments);var c=(0,x.default)(a),d=(0,x.default)(b);return c.getTime()===d.getTime()}var z=a.i(955401);function A(a,b){(0,u.default)(2,arguments);var c=(0,t.default)(a),d=(0,z.default)(b);if(isNaN(d))return new Date(NaN);if(!d)return c;var e=c.getDate(),f=new Date(c.getTime());return(f.setMonth(c.getMonth()+d+1,0),e>=f.getDate())?f:(c.setFullYear(f.getFullYear(),f.getMonth(),e),c)}function B(a,b){(0,u.default)(1,arguments);var c,d,e,f=(0,z.default)(null!=(c=null==b?void 0:b.additionalDigits)?c:2);if(2!==f&&1!==f&&0!==f)throw RangeError("additionalDigits must be 0, 1 or 2");if("string"!=typeof a&&"[object String]"!==Object.prototype.toString.call(a))return new Date(NaN);var g=function(a){var b,c={},d=a.split(C);if(d.length>2)return c;if(/:/.test(d[0])?b=d[0]:(c.date=d[0],b=d[1],D.test(c.date)&&(c.date=a.split(D)[0],b=a.substr(c.date.length,a.length))),b){var e=E.exec(b);e?(c.time=b.replace(e[1],""),c.timezone=e[1]):c.time=b}return c}(a);if(g.date){var h=function(a,b){var c=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+b)+"})|(\\d{2}|[+-]\\d{"+(2+b)+"})$)"),d=a.match(c);if(!d)return{year:NaN,restDateString:""};var e=d[1]?parseInt(d[1]):null,f=d[2]?parseInt(d[2]):null;return{year:null===f?e:100*f,restDateString:a.slice((d[1]||d[2]).length)}}(g.date,f);d=function(a,b){if(null===b)return new Date(NaN);var c,d,e,f,g,h,i,j,k,l,m,n,o=a.match(F);if(!o)return new Date(NaN);var p=!!o[4],q=I(o[1]),r=I(o[2])-1,s=I(o[3]),t=I(o[4]),u=I(o[5])-1;if(p){return(c=t,d=u,c>=1&&c<=53&&d>=0&&d<=6)?(e=b,f=t,g=u,(h=new Date(0)).setUTCFullYear(e,0,4),i=h.getUTCDay()||7,h.setUTCDate(h.getUTCDate()+((f-1)*7+g+1-i)),h):new Date(NaN)}var v=new Date(0);return(j=b,k=r,l=s,k>=0&&k<=11&&l>=1&&l<=(K[k]||(L(j)?29:28))&&(m=b,(n=q)>=1&&n<=(L(m)?366:365)))?(v.setUTCFullYear(b,r,Math.max(q,s)),v):new Date(NaN)}(h.restDateString,h.year)}if(!d||isNaN(d.getTime()))return new Date(NaN);var i=d.getTime(),j=0;if(g.time&&isNaN(j=function(a){var b,c,d,e=a.match(G);if(!e)return NaN;var f=J(e[1]),g=J(e[2]),h=J(e[3]);return(b=f,c=g,d=h,24===b?0===c&&0===d:d>=0&&d<60&&c>=0&&c<60&&b>=0&&b<25)?36e5*f+6e4*g+1e3*h:NaN}(g.time)))return new Date(NaN);if(g.timezone){if(isNaN(e=function(a){if("Z"===a)return 0;var b,c=a.match(H);if(!c)return 0;var d="+"===c[1]?-1:1,e=parseInt(c[2]),f=c[3]&&parseInt(c[3])||0;return(b=f)>=0&&b<=59?d*(36e5*e+6e4*f):NaN}(g.timezone)))return new Date(NaN)}else{var k=new Date(i+j),l=new Date(0);return l.setFullYear(k.getUTCFullYear(),k.getUTCMonth(),k.getUTCDate()),l.setHours(k.getUTCHours(),k.getUTCMinutes(),k.getUTCSeconds(),k.getUTCMilliseconds()),l}return new Date(i+j+e)}var C=/[T ]/,D=/[Z ]/i,E=/([Z+-].*)$/,F=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,G=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,H=/^([+-])(\d{2})(?::?(\d{2}))?$/;function I(a){return a?parseInt(a):1}function J(a){return a&&parseFloat(a.replace(",","."))||0}var K=[31,null,31,30,31,30,31,31,30,31,30,31];function L(a){return a%400==0||a%4==0&&a%100!=0}var M=a.i(433363),N=a.i(325383);function O(){let{student:a,studentId:x}=(0,e.useLearnerContext)(),C=(0,d.useMemo)(()=>x?(0,f.createLearnerClient)(x):null,[x]),[D,E]=(0,d.useState)(new Date),[F,G]=(0,d.useState)(null),{data:H,isLoading:I}=(0,c.useQuery)({queryKey:["learner-sessions-calendar",x],queryFn:async()=>{if(!x||!C)return[];try{let{data:a,error:b}=await C.from("enrollments").select(`
            *,
            sessions(
              id,
              name,
              start_date,
              end_date,
              location,
              status,
              formations(id, name),
              session_slots(
                id,
                date,
                start_time,
                end_time,
                location
              )
            )
          `).eq("student_id",x);if(b){if("PGRST116"===b.code||"42P01"===b.code||"PGRST301"===b.code||"42P17"===b.code||400===b.status||"400"===b.code||b.message?.includes("relation")||b.message?.includes("relationship")||b.message?.includes("does not exist")||b.message?.includes("schema cache")||b.message?.includes("infinite recursion"))return N.logger.warn("Enrollments table may not be accessible (RLS or missing)",{studentId:(0,N.maskId)(x),error:(0,N.sanitizeError)(b)}),[];return N.logger.error("Error fetching enrollments",b,{studentId:(0,N.maskId)(x),error:(0,N.sanitizeError)(b)}),[]}return a||[]}catch(a){return N.logger.error("Unexpected error fetching enrollments",a,{studentId:(0,N.maskId)(x),error:(0,N.sanitizeError)(a)}),[]}},enabled:!!x&&!!C,refetchOnWindowFocus:!0,refetchOnMount:!0}),J=H||[],K=function(a){(0,u.default)(1,arguments);var b=(0,t.default)(a);return b.setDate(1),b.setHours(0,0,0,0),b}(D),L=w({start:K,end:(0,v.default)(D)}),O=(0,d.useMemo)(()=>{let a={};return J?.forEach(b=>{let c=b.sessions;if(c?.start_date)if(c.session_slots&&c.session_slots.length>0)c.session_slots.forEach(c=>{if(!c.date)return;let d=B(c.date),e=(0,s.format)(d,"yyyy-MM-dd");a[e]||(a[e]=[]),a[e].push({...b,slot:c,isStart:!0,isEnd:!0})});else{let d=B(c.start_date),e=c.end_date?B(c.end_date):d;w({start:d,end:e}).forEach(c=>{let f=(0,s.format)(c,"yyyy-MM-dd");a[f]||(a[f]=[]),a[f].push({...b,isStart:y(c,d),isEnd:y(c,e)})})}}),a},[J]),P=F&&O[(0,s.format)(F,"yyyy-MM-dd")]||[],Q=(0,d.useMemo)(()=>{let a=new Date,b=[];return J?.forEach(c=>{let d=c.sessions;if(d){if(d.session_slots&&d.session_slots.length>0)d.session_slots.forEach(d=>{if(!d.date)return;let e=B(d.date);e>=a&&b.push({...c,slot:d,displayDate:e})});else if(d.start_date){let e=B(d.start_date);e>=a&&b.push({...c,displayDate:e})}}}),b.sort((a,b)=>a.displayDate.getTime()-b.displayDate.getTime()).slice(0,5)},[J]),R={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};return(0,b.jsxs)(j.motion.div,{className:"space-y-6 pb-24 lg:pb-8",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",children:[(0,b.jsx)(j.motion.div,{variants:R,children:(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)("div",{className:"p-2 bg-blue-100 rounded-xl",children:(0,b.jsx)(k.Calendar,{className:"h-8 w-8 text-blue-600"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Mon planning"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Calendrier de vos sessions de formation"})]})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,b.jsx)(j.motion.div,{variants:R,className:"lg:col-span-2",children:(0,b.jsxs)(g.GlassCard,{className:"p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:(0,s.format)(D,"MMMM yyyy",{locale:M.fr})}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Button,{variant:"outline",size:"icon",onClick:()=>E(function(a,b){return(0,u.default)(2,arguments),A(a,-(0,z.default)(b))}(D,1)),children:(0,b.jsx)(n.ChevronLeft,{className:"h-4 w-4"})}),(0,b.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>E(new Date),children:"Aujourd'hui"}),(0,b.jsx)(h.Button,{variant:"outline",size:"icon",onClick:()=>E(A(D,1)),children:(0,b.jsx)(o.ChevronRight,{className:"h-4 w-4"})})]})]}),(0,b.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"].map(a=>(0,b.jsx)("div",{className:"text-center text-sm font-medium text-gray-500 py-2",children:a},a))}),(0,b.jsxs)("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:(K.getDay()+6)%7}).map((a,c)=>(0,b.jsx)("div",{className:"aspect-square p-1"},`empty-${c}`)),L.map(a=>{let c=(0,s.format)(a,"yyyy-MM-dd"),d=O[c]||[],e=d.length>0,f=F&&y(a,F);return(0,b.jsx)("button",{onClick:()=>G(a),className:`
                      aspect-square p-1 rounded-lg transition-all relative
                      ${!function(a){return(0,u.default)(1,arguments),y(a,Date.now())}(a)?"":"ring-2 ring-brand-blue ring-offset-2"}
                      ${f?"bg-brand-blue text-white":"hover:bg-gray-100"}
                      ${!function(a,b){(0,u.default)(2,arguments);var c=(0,t.default)(a),d=(0,t.default)(b);return c.getFullYear()===d.getFullYear()&&c.getMonth()===d.getMonth()}(a,D)?"opacity-30":""}
                    `,children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,b.jsx)("span",{className:`text-sm font-medium ${f?"text-white":""}`,children:(0,s.format)(a,"d")}),e&&(0,b.jsx)("div",{className:"flex gap-0.5 mt-1",children:d.slice(0,3).map((a,c)=>(0,b.jsx)("div",{className:`w-1.5 h-1.5 rounded-full ${f?"bg-white":"bg-brand-blue"}`},c))})]})},c)})]}),F&&(0,b.jsxs)("div",{className:"mt-6 pt-6 border-t",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:(0,s.format)(F,"EEEE d MMMM",{locale:M.fr})}),P.length>0?(0,b.jsx)("div",{className:"space-y-3",children:P.map((a,c)=>{let d=a.sessions,e=a.slot;return(0,b.jsx)("div",{className:"p-4 bg-gradient-to-r from-brand-blue/5 to-indigo-50 rounded-xl border border-brand-blue/10",children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)("div",{className:"p-2 bg-brand-blue/10 rounded-lg",children:d?.is_remote?(0,b.jsx)(q.Video,{className:"h-5 w-5 text-brand-blue"}):(0,b.jsx)(r.Users,{className:"h-5 w-5 text-brand-blue"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"font-semibold text-gray-900",children:d?.formations?.name||d?.name}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-3 mt-2 text-sm text-gray-500",children:[a.slot?.start_time?(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(l.Clock,{className:"h-4 w-4"}),a.slot.start_time,a.slot.end_time&&` - ${a.slot.end_time}`]}):d?.start_time?(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(l.Clock,{className:"h-4 w-4"}),d.start_time,d.end_time&&` - ${d.end_time}`]}):null,(a.slot?.location||d?.location)&&(0,b.jsxs)("span",{className:"flex items-center gap-1",children:[(0,b.jsx)(m.MapPin,{className:"h-4 w-4"}),a.slot?.location||d.location]})]})]}),(0,b.jsx)(i.Badge,{className:d?.is_remote?"bg-purple-100 text-purple-700":"bg-green-100 text-green-700",children:d?.is_remote?"À distance":"Présentiel"})]})},`${a.id}-${e?.id||c}`)})}):(0,b.jsx)("p",{className:"text-gray-500 text-center py-4",children:"Aucune session prévue ce jour"})]})]})}),(0,b.jsxs)(j.motion.div,{variants:R,children:[(0,b.jsxs)(g.GlassCard,{className:"p-6 h-fit",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)(p.CalendarDays,{className:"h-5 w-5 text-brand-blue"}),(0,b.jsx)("h3",{className:"font-bold text-gray-900",children:"Prochaines sessions"})]}),I?(0,b.jsx)("div",{className:"space-y-3",children:[1,2,3].map(a=>(0,b.jsx)("div",{className:"h-20 bg-gray-100 rounded-xl animate-pulse"},a))}):Q.length>0?(0,b.jsx)("div",{className:"space-y-3",children:Q.map((a,c)=>{let d=a.sessions,e=a.displayDate||(d?.start_date?B(d.start_date):null),f=a.slot;return(0,b.jsxs)("div",{className:"p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors cursor-pointer",onClick:()=>e&&G(e),children:[(0,b.jsx)("h4",{className:"font-medium text-gray-900 text-sm mb-1",children:d?.formations?.name||d?.name}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[(0,b.jsx)(k.Calendar,{className:"h-3 w-3"}),e&&(0,s.format)(e,"dd MMM",{locale:M.fr}),(f?.start_time||d?.start_time)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("span",{children:"•"}),(0,b.jsx)(l.Clock,{className:"h-3 w-3"}),f?.start_time||d.start_time,(f?.end_time||d?.end_time)&&` - ${f?.end_time||d.end_time}`]})]})]},`${a.id}-${f?.id||c}`)})}):(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)(k.Calendar,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Aucune session à venir"})]})]}),(0,b.jsxs)(g.GlassCard,{className:"p-6 mt-4",children:[(0,b.jsx)("h4",{className:"font-semibold text-gray-900 mb-3",children:"Légende"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("div",{className:"w-3 h-3 rounded-full bg-brand-blue"}),(0,b.jsx)("span",{className:"text-gray-600",children:"Session prévue"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("div",{className:"w-6 h-6 rounded ring-2 ring-brand-blue ring-offset-2 flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xs",children:(0,s.format)(new Date,"d")})}),(0,b.jsx)("span",{className:"text-gray-600",children:"Aujourd'hui"})]})]})]})]})]})]})}a.s(["default",()=>O],610214)}];

//# sourceMappingURL=app_%28learner%29_learner_planning_page_tsx_a542d36f._.js.map