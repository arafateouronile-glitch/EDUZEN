module.exports=[915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},219897,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);a.i(460355);var e=a.i(346271);let f=c.forwardRef(({className:a,variant:c="default",hoverable:f=!1,glow:g=!1,glowColor:h="rgba(51, 90, 207, 0.3)",...i},j)=>(0,b.jsxs)(e.motion.div,{ref:j,className:(0,d.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===c,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===c,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===c,"cursor-pointer":f,"hover:shadow-2xl hover:scale-[1.02]":f,"hover:bg-white/90 dark:hover:bg-gray-900/90":f},a),whileHover:f?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...i,children:[g&&(0,b.jsx)(e.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${h} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,b.jsx)("div",{className:"relative z-10",children:i.children})]}));f.displayName="GlassCard",a.s(["GlassCard",()=>f])},495756,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],495756)},177156,a=>{"use strict";let b=(0,a.i(170106).default)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);a.s(["Eye",()=>b],177156)},54018,a=>{"use strict";let b=(0,a.i(170106).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);a.s(["XCircle",()=>b],54018)},683245,a=>{"use strict";let b=(0,a.i(170106).default)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);a.s(["Edit",()=>b],683245)},491829,a=>{"use strict";var b=a.i(187924),c=a.i(913216),d=a.i(50944),e=a.i(572131);let f=(0,a.i(170106).default)("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var g=a.i(340695),h=a.i(703130),i=a.i(238246);function j({children:a,allowedRoles:j,fallback:k,redirectTo:l="/dashboard"}){let{user:m,isLoading:n}=(0,c.useAuth)(),o=(0,d.useRouter)(),[p,q]=(0,e.useState)(null);return((0,e.useEffect)(()=>{if(!n&&m){let a=m.role||"",b=j.includes(a);q(b),b||!l||k||o.push(l)}},[m,n,j,l,o,k]),n||null===p)?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):p?(0,b.jsx)(b.Fragment,{children:a}):k?(0,b.jsx)(b.Fragment,{children:k}):(0,b.jsx)("div",{className:"container mx-auto py-16 px-4",children:(0,b.jsx)(h.Card,{className:"max-w-md mx-auto",children:(0,b.jsxs)(h.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,b.jsx)(f,{className:"h-8 w-8 text-red-600"})}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Accès non autorisé"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Vous n'avez pas les permissions nécessaires pour accéder à cette page."}),(0,b.jsx)(i.default,{href:"/dashboard",children:(0,b.jsx)(g.Button,{children:"Retour au tableau de bord"})})]})})})}a.s(["ADMIN_ROLES",0,["super_admin","admin","secretary","accountant"],"FINANCE_ROLES",0,["super_admin","admin","secretary","accountant"],"FORMATION_MANAGEMENT_ROLES",0,["super_admin","admin","secretary"],"RoleGuard",()=>j],491829)},806368,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);a.i(460355);var e=a.i(346271);let f=c.forwardRef(({className:a,columns:c=4,gap:e="md",children:f,...g},h)=>(0,b.jsx)("div",{ref:h,className:(0,d.cn)("grid",{1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 md:grid-cols-2 lg:grid-cols-4"}[c],{sm:"gap-4",md:"gap-6",lg:"gap-8"}[e],a),...g,children:f}));f.displayName="BentoGrid";let g=c.forwardRef(({className:a,span:c=1,rowSpan:f=1,children:g,...h},i)=>(0,b.jsx)(e.motion.div,{ref:i,className:(0,d.cn)({1:"col-span-1",2:"col-span-1 md:col-span-2",3:"col-span-1 md:col-span-2 lg:col-span-3",4:"col-span-1 md:col-span-2 lg:col-span-4"}[c],{1:"row-span-1",2:"row-span-1 md:row-span-2",3:"row-span-1 md:row-span-3"}[f],a),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:[.16,1,.3,1]},...h,children:g}));g.displayName="BentoCard",a.s(["BentoCard",()=>g,"BentoGrid",()=>f])},783876,a=>{"use strict";var b=a.i(269240);let c=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getPublicFormations(a){let b=this.supabase.from("public_formations").select("*").eq("is_public",!0).not("published_at","is",null);a?.organizationId&&(b=b.eq("organization_id",a.organizationId)),a?.featured&&(b=b.eq("is_featured",!0)),a?.siteId&&(b=b.contains("available_at_sites",[a.siteId])),a?.search&&(b=b.or(`public_title.ilike.%${a.search}%,public_description.ilike.%${a.search}%,seo_keywords.cs.{${a.search}}`)),b=b.order("is_featured",{ascending:!1}).order("published_at",{ascending:!1}),a?.limit&&(b=b.limit(a.limit));let{data:c,error:d}=await b;if(d)throw d;return c||[]}async getBySlug(a){let{data:b,error:c}=await this.supabase.from("public_formations").select("*").eq("slug",a).eq("is_public",!0).not("published_at","is",null).maybeSingle();if(c)throw c;return b}async getById(a,b){let c=this.supabase.from("public_formations").select("*").eq("id",a);b&&(c=c.eq("organization_id",b));let{data:d,error:e}=await c.single();if(e)throw e;return d}async getAll(a,b){let c=this.supabase.from("public_formations").select("*").eq("organization_id",a);b?.isPublic!==void 0&&(c=c.eq("is_public",b.isPublic)),b?.search&&(c=c.or(`public_title.ilike.%${b.search}%,slug.ilike.%${b.search}%`));let{data:d,error:e}=await c.order("created_at",{ascending:!1});if(e)throw e;return d||[]}async create(a){!a.slug&&a.public_title&&(a.slug=this.generateSlug(a.public_title,a.organization_id));let{data:b,error:c}=await this.supabase.from("public_formations").insert(a).select().single();if(c)throw c;return b}async update(a,b){if(b.public_title&&!b.slug){let c=await this.getById(a);c.organization_id&&(b.slug=this.generateSlug(b.public_title,c.organization_id))}b.is_public&&!b.published_at&&((await this.getById(a)).published_at||(b.published_at=new Date().toISOString()));let{data:c,error:d}=await this.supabase.from("public_formations").update(b).eq("id",a).select().single();if(d)throw d;return c}async delete(a){let{error:b}=await this.supabase.from("public_formations").delete().eq("id",a);if(b)throw b}generateSlug(a,b){let c=a.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,100);return`${c}-${b.slice(0,8)}`}async createEnrollment(a){let b=await this.getById(a.public_formation_id,a.organization_id);if(!b.allow_online_registration)throw Error("Cette formation n'accepte pas les inscriptions en ligne");if(b.registration_deadline){let a=new Date(b.registration_deadline);if(new Date>a)throw Error("La date limite d'inscription est dépassée")}let{data:c,error:d}=await this.supabase.from("public_enrollments").insert(a).select().single();if(d)throw d;return c}async getEnrollments(a,b){let c=this.supabase.from("public_enrollments").select("*, public_formations(*), sites(*)").eq("organization_id",a);b?.status&&(c=c.eq("status",b.status)),b?.formationId&&(c=c.eq("public_formation_id",b.formationId)),b?.search&&(c=c.or(`first_name.ilike.%${b.search}%,last_name.ilike.%${b.search}%,email.ilike.%${b.search}%`));let{data:d,error:e}=await c.order("created_at",{ascending:!1});if(e)throw e;return d||[]}async updateEnrollmentStatus(a,b,c,d){let e={status:b,processed_at:new Date().toISOString()};c&&(e.processed_by=c),d&&(e.admin_notes=d);let{data:f,error:g}=await this.supabase.from("public_enrollments").update(e).eq("id",a).select().single();if(g)throw g;return f}};a.s(["publicCatalogService",0,c])},722463,a=>{"use strict";var b=a.i(187924),c=a.i(433217),d=a.i(370025),e=a.i(937927),f=a.i(913216),g=a.i(783876),h=a.i(340695),i=a.i(219897),j=a.i(806368),k=a.i(864037),l=a.i(915618),m=a.i(244494),n=a.i(177156),o=a.i(683245),p=a.i(495756),q=a.i(54018),r=a.i(452495),s=a.i(953722),t=a.i(104720),u=a.i(660246),v=a.i(808406),w=a.i(491829),x=a.i(269240),y=a.i(238246);a.i(460355);var z=a.i(346271),A=a.i(497895);function B(){return(0,b.jsx)(w.RoleGuard,{allowedRoles:w.FORMATION_MANAGEMENT_ROLES,children:(0,b.jsx)(C,{})})}function C(){let{user:a}=(0,f.useAuth)(),n=(0,e.useQueryClient)(),{addToast:o}=(0,k.useToast)(),q=(0,x.createClient)(),{data:w}=(0,c.useQuery)({queryKey:["organization-code",a?.organization_id],queryFn:async()=>{if(!a?.organization_id)return null;let{data:b,error:c}=await q.from("organizations").select("id, code").eq("id",a.organization_id).maybeSingle();if(c)throw c;return b},enabled:!!a?.organization_id}),{data:A,isLoading:B}=(0,c.useQuery)({queryKey:["public-formations",a?.organization_id],queryFn:async()=>a?.organization_id?await g.publicCatalogService.getAll(a.organization_id):[],enabled:!!a?.organization_id}),{data:C}=(0,c.useQuery)({queryKey:["public-enrollments",a?.organization_id],queryFn:async()=>a?.organization_id?g.publicCatalogService.getEnrollments(a.organization_id,{status:"pending"}):[],enabled:!!a?.organization_id}),E=(0,d.useMutation)({mutationFn:async({id:a,isPublic:b})=>g.publicCatalogService.update(a,{is_public:b}),onSuccess:()=>{n.invalidateQueries({queryKey:["public-formations"]}),o({title:"Succès",description:"Formation mise à jour avec succès",type:"success"})}});if(!a?.organization_id)return(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("p",{children:"Aucune organisation"})});let F=A?.filter(a=>a.is_public)||[],G=A?.filter(a=>!a.is_public)||[];return(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)(z.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex justify-between items-start mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-brand-blue to-brand-cyan bg-clip-text text-transparent",children:"Catalogue Public"}),(0,b.jsx)("p",{className:"text-gray-600 mt-2",children:"Gérez vos formations publiques et inscriptions en ligne"})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[w&&(0,b.jsx)(y.default,{href:`/cataloguepublic/${w.code||w.id}`,target:"_blank",children:(0,b.jsxs)(h.Button,{variant:"outline",className:"border-brand-blue/20 hover:bg-brand-blue/5",children:[(0,b.jsx)(r.ExternalLink,{className:"w-4 h-4 mr-2"}),"Voir le site public"]})}),(0,b.jsxs)(h.Button,{className:"bg-brand-blue hover:bg-brand-blue-dark shadow-lg shadow-brand-blue/20",children:[(0,b.jsx)(l.Plus,{className:"w-4 h-4 mr-2"}),"Nouvelle formation"]})]})]}),(0,b.jsxs)(j.BentoGrid,{columns:4,gap:"md",children:[(0,b.jsx)(j.BentoCard,{span:1,children:(0,b.jsx)(i.GlassCard,{variant:"premium",className:"p-6 h-full border-2 border-transparent hover:border-brand-blue/10 transition-all duration-500",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-brand-blue",children:A?.length||0}),(0,b.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Total formations"})]}),(0,b.jsx)(s.BookOpen,{className:"w-8 h-8 text-brand-blue/30"})]})})}),(0,b.jsx)(j.BentoCard,{span:1,children:(0,b.jsx)(i.GlassCard,{variant:"premium",className:"p-6 h-full border-2 border-transparent hover:border-green-500/10 transition-all duration-500",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-green-600",children:F.length}),(0,b.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Publiées"})]}),(0,b.jsx)(p.CheckCircle,{className:"w-8 h-8 text-green-500/30"})]})})}),(0,b.jsx)(j.BentoCard,{span:1,children:(0,b.jsx)(i.GlassCard,{variant:"premium",className:"p-6 h-full border-2 border-transparent hover:border-gray-400/10 transition-all duration-500",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-gray-600",children:G.length}),(0,b.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Brouillons"})]}),(0,b.jsx)(t.FileText,{className:"w-8 h-8 text-gray-400/30"})]})})}),(0,b.jsx)(j.BentoCard,{span:1,children:(0,b.jsx)(i.GlassCard,{variant:"premium",className:"p-6 h-full border-2 border-transparent hover:border-brand-cyan/10 transition-all duration-500",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-3xl font-bold text-brand-cyan",children:C?.length||0}),(0,b.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Inscriptions en attente"})]}),(0,b.jsx)(u.Users,{className:"w-8 h-8 text-brand-cyan/30"})]})})})]}),F.length>0&&(0,b.jsxs)(z.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,b.jsx)(v.Sparkles,{className:"w-5 h-5 text-brand-blue"}),(0,b.jsx)("h2",{className:"text-xl font-bold",children:"Formations publiées"})]}),(0,b.jsx)(j.BentoGrid,{columns:3,gap:"md",children:F.map(a=>(0,b.jsx)(j.BentoCard,{span:1,children:(0,b.jsx)(D,{formation:a,onTogglePublish:b=>E.mutate({id:a.id,isPublic:b})})},a.id))})]}),G.length>0&&(0,b.jsxs)(z.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-4 mt-8",children:[(0,b.jsx)(t.FileText,{className:"w-5 h-5 text-gray-500"}),(0,b.jsx)("h2",{className:"text-xl font-bold",children:"Brouillons"})]}),(0,b.jsx)(j.BentoGrid,{columns:3,gap:"md",children:G.map(a=>(0,b.jsx)(j.BentoCard,{span:1,children:(0,b.jsx)(D,{formation:a,onTogglePublish:b=>E.mutate({id:a.id,isPublic:b})})},a.id))})]}),B?(0,b.jsx)(i.GlassCard,{variant:"default",className:"p-12 text-center border-2 border-brand-blue/20 bg-gradient-to-br from-brand-blue-ghost/30 to-brand-cyan-ghost/30",children:(0,b.jsx)("div",{className:"animate-pulse",children:"Chargement..."})}):A&&0===A.length?(0,b.jsxs)(i.GlassCard,{variant:"default",className:"p-12 text-center border-2 border-brand-blue/20 bg-gradient-to-br from-brand-blue-ghost/30 to-brand-cyan-ghost/30",children:[(0,b.jsx)(m.Globe,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6 text-lg",children:"Aucune formation dans le catalogue"}),(0,b.jsxs)(h.Button,{className:"bg-brand-blue hover:bg-brand-blue-dark shadow-lg shadow-brand-blue/20",children:[(0,b.jsx)(l.Plus,{className:"w-4 h-4 mr-2"}),"Créer la première formation"]})]}):null]})}function D({formation:a,onTogglePublish:c}){return(0,b.jsxs)(i.GlassCard,{variant:"premium",className:"p-6 h-full flex flex-col border-2 border-transparent hover:border-brand-blue/10 transition-all duration-500",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("div",{className:"flex justify-between items-start mb-3",children:(0,b.jsx)("h3",{className:"font-bold text-lg line-clamp-2 flex-1 pr-2",children:a.public_title})}),a.is_featured&&(0,b.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-gradient-to-r from-yellow-100 to-yellow-50 text-yellow-800 rounded-full mb-3 border border-yellow-200",children:[(0,b.jsx)(v.Sparkles,{className:"w-3 h-3"}),"Mise en avant"]}),(0,b.jsx)("div",{className:"flex items-center gap-2 mb-3",children:a.is_public?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.CheckCircle,{className:"w-4 h-4 text-green-600"}),(0,b.jsx)("span",{className:"text-sm text-green-600 font-medium",children:"Publiée"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(q.XCircle,{className:"w-4 h-4 text-gray-400"}),(0,b.jsx)("span",{className:"text-sm text-gray-400",children:"Brouillon"})]})}),a.slug&&(0,b.jsxs)("div",{className:"text-xs text-gray-500 mb-4 font-mono bg-gray-50 px-2 py-1 rounded",children:["/formations/",a.slug]})]}),(0,b.jsxs)("div",{className:"flex gap-2 pt-4 border-t border-gray-200",children:[(0,b.jsx)(y.default,{href:`/formations/${a.slug||a.id}`,target:"_blank",className:"flex-1",children:(0,b.jsxs)(h.Button,{variant:"outline",size:"sm",className:"w-full border-brand-blue/20 hover:bg-brand-blue/5",children:[(0,b.jsx)(n.Eye,{className:"w-3 h-3 mr-1"}),"Voir"]})}),(0,b.jsx)(h.Button,{variant:"outline",size:"sm",className:"border-brand-blue/20 hover:bg-brand-blue/5",children:(0,b.jsx)(o.Edit,{className:"w-3 h-3"})}),(0,b.jsx)(h.Button,{variant:"outline",size:"sm",onClick:()=>c(!a.is_public),className:(0,A.cn)("border-brand-blue/20 hover:bg-brand-blue/5",a.is_public?"hover:border-red-300":"hover:border-green-300"),children:a.is_public?(0,b.jsx)(q.XCircle,{className:"w-3 h-3 text-red-600"}):(0,b.jsx)(p.CheckCircle,{className:"w-3 h-3 text-green-600"})})]})]})}a.s(["default",()=>B])}];

//# sourceMappingURL=_18cb0ceb._.js.map