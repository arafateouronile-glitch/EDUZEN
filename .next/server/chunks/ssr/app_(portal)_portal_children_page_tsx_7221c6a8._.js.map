{"version":3,"sources":["../../../../app/%28portal%29/portal/children/page.tsx"],"sourcesContent":["'use client'\n\nimport { useQuery } from '@tanstack/react-query'\nimport { useAuth } from '@/lib/hooks/use-auth'\nimport { createClient } from '@/lib/supabase/client'\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card'\nimport { User, Calendar, ClipboardList, BookOpen, CreditCard } from 'lucide-react'\nimport Link from 'next/link'\nimport type { StudentWithRelations } from '@/lib/types/query-types'\n\nexport default function ChildrenPage() {\n  const { user } = useAuth()\n  const supabase = createClient()\n\n  const { data: children } = useQuery({\n    queryKey: ['children', user?.id],\n    queryFn: async () => {\n      if (!user?.id || user?.role !== 'parent') return []\n\n      const { data: guardians } = await supabase\n        .from('guardians')\n        .select('id')\n        .eq('user_id', user.id)\n\n      if (!guardians || guardians.length === 0) return []\n\n      const { data: studentGuardians } = await supabase\n        .from('student_guardians')\n        .select('student_id')\n        .in('guardian_id', guardians.map((g) => g.id))\n\n      if (!studentGuardians || studentGuardians.length === 0) return []\n\n      const { data: students } = await supabase\n        .from('students')\n        .select('*, classes(name)')\n        .in('id', studentGuardians.map((sg) => sg.student_id).filter((id): id is string => id !== null))\n        .eq('status', 'active')\n\n      return students || []\n    },\n    enabled: !!user?.id && user?.role === 'parent',\n  })\n\n  if (user?.role !== 'parent') {\n    return (\n      <div className=\"text-center py-12 text-muted-foreground\">\n        Accès réservé aux parents\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-bold text-gray-900\">Mes enfants</h1>\n        <p className=\"mt-2 text-sm text-gray-600\">\n          Gérez les informations de vos enfants\n        </p>\n      </div>\n\n      {children && children.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {(children as StudentWithRelations[]).map((child) => (\n            <Card key={child.id} className=\"hover:shadow-lg transition-shadow\">\n              <CardHeader>\n                <div className=\"flex items-center space-x-4\">\n                  {child.photo_url ? (\n                    <img\n                      src={child.photo_url}\n                      alt={`${child.first_name} ${child.last_name}`}\n                      className=\"h-20 w-20 rounded-full object-cover\"\n                    />\n                  ) : (\n                    <div className=\"h-20 w-20 rounded-full bg-primary text-white flex items-center justify-center text-2xl font-semibold\">\n                      {child.first_name.charAt(0)}{child.last_name.charAt(0)}\n                    </div>\n                  )}\n                  <div>\n                    <CardTitle className=\"text-lg\">\n                      {child.first_name} {child.last_name}\n                    </CardTitle>\n                    <p className=\"text-sm text-muted-foreground\">\n                      {((child as any).classes as { name: string } | undefined)?.name || 'Non assigné'}\n                    </p>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-2 mb-4\">\n                  <p className=\"text-sm text-muted-foreground\">\n                    N° étudiant: <span className=\"font-medium\">{child.student_number}</span>\n                  </p>\n                  {child.email && (\n                    <p className=\"text-sm text-muted-foreground\">\n                      Email: <span className=\"font-medium\">{child.email}</span>\n                    </p>\n                  )}\n                </div>\n                <div className=\"grid grid-cols-2 gap-2 mt-4\">\n                  <Link\n                    href={`/portal/children/${child.id}/attendance`}\n                    className=\"flex flex-col items-center p-3 border rounded-lg hover:bg-gray-50 transition-colors\"\n                  >\n                    <ClipboardList className=\"h-5 w-5 text-primary mb-1\" />\n                    <span className=\"text-xs text-center\">Présences</span>\n                  </Link>\n                  <Link\n                    href={`/portal/children/${child.id}/grades`}\n                    className=\"flex flex-col items-center p-3 border rounded-lg hover:bg-gray-50 transition-colors\"\n                  >\n                    <BookOpen className=\"h-5 w-5 text-primary mb-1\" />\n                    <span className=\"text-xs text-center\">Notes</span>\n                  </Link>\n                  <Link\n                    href={`/portal/children/${child.id}/schedule`}\n                    className=\"flex flex-col items-center p-3 border rounded-lg hover:bg-gray-50 transition-colors\"\n                  >\n                    <Calendar className=\"h-5 w-5 text-primary mb-1\" />\n                    <span className=\"text-xs text-center\">Emploi du temps</span>\n                  </Link>\n                  <Link\n                    href={`/portal/children/${child.id}/payments`}\n                    className=\"flex flex-col items-center p-3 border rounded-lg hover:bg-gray-50 transition-colors\"\n                  >\n                    <CreditCard className=\"h-5 w-5 text-primary mb-1\" />\n                    <span className=\"text-xs text-center\">Paiements</span>\n                  </Link>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"text-center py-12 text-muted-foreground\">\n            <User className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n            <p>Aucun enfant enregistré</p>\n          </CardContent>\n        </Card>\n      )}\n    </div>\n  )\n}\n\n"],"names":[],"mappings":"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"}