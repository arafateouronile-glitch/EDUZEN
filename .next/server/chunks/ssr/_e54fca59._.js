module.exports=[47349,(a,b,c)=>{"use strict";var d=a.r(572131);d.useState,d.useEffect,d.useLayoutEffect,d.useDebugValue,c.useSyncExternalStore=void 0!==d.useSyncExternalStore?d.useSyncExternalStore:function(a,b){return b()}},487610,(a,b,c)=>{"use strict";b.exports=a.r(47349)},997514,(a,b,c)=>{"use strict";var d=a.r(572131),e=a.r(487610),f="function"==typeof Object.is?Object.is:function(a,b){return a===b&&(0!==a||1/a==1/b)||a!=a&&b!=b},g=e.useSyncExternalStore,h=d.useRef,i=d.useEffect,j=d.useMemo,k=d.useDebugValue;c.useSyncExternalStoreWithSelector=function(a,b,c,d,e){var l=h(null);if(null===l.current){var m={hasValue:!1,value:null};l.current=m}else m=l.current;var n=g(a,(l=j(function(){function a(a){if(!i){if(i=!0,g=a,a=d(a),void 0!==e&&m.hasValue){var b=m.value;if(e(b,a))return h=b}return h=a}if(b=h,f(g,a))return b;var c=d(a);return void 0!==e&&e(b,c)?(g=a,b):(g=a,h=c)}var g,h,i=!1,j=void 0===c?null:c;return[function(){return a(b())},null===j?void 0:function(){return a(j())}]},[b,c,d,e]))[0],l[1]);return i(function(){m.hasValue=!0,m.value=n},[n]),k(n),n}},864442,(a,b,c)=>{"use strict";b.exports=a.r(997514)},401794,a=>{"use strict";let b={save:{key:"s",ctrl:!0},undo:{key:"z",ctrl:!0},redo:{key:"y",ctrl:!0},copy:{key:"c",ctrl:!0},paste:{key:"v",ctrl:!0},cut:{key:"x",ctrl:!0},selectAll:{key:"a",ctrl:!0},bold:{key:"b",ctrl:!0},italic:{key:"i",ctrl:!0},underline:{key:"u",ctrl:!0}};function c(){return{}}function d(a){}function e(a){return b[a]||{key:""}}function f(a,b){return a.key.toLowerCase()===b.key.toLowerCase()&&(!b.ctrl||!!a.ctrlKey||!!a.metaKey)&&(!b.shift||!!a.shiftKey)&&(!b.alt||!!a.altKey)&&(!b.meta||!!a.metaKey)&&(!!b.ctrl||!a.ctrlKey&&!a.metaKey)&&(!!b.shift||!a.shiftKey)&&(!!b.alt||!a.altKey)&&(!!b.meta||!a.metaKey)&&!0}a.s(["DEFAULT_SHORTCUTS",0,b,"getShortcutConfig",()=>e,"loadCustomShortcuts",()=>c,"matchesShortcut",()=>f,"saveCustomShortcuts",()=>d])},249705,a=>{"use strict";let b,c,d,e;var f=a.i(187924),g=a.i(572131),h=a.i(50944),i=a.i(433217),j=a.i(370025),k=a.i(937927),l=a.i(913216),m=a.i(872675),n=a.i(340695),o=a.i(586547),p=a.i(400210),q=a.i(114548),r=a.i(177156),s=a.i(787654),t=a.i(591965),u=a.i(526017),v=a.i(470880),w=a.i(65341),x=a.i(170106);let y=(0,x.default)("Keyboard",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",ry:"2",key:"15u882"}],["path",{d:"M6 8h.001",key:"1ej0i3"}],["path",{d:"M10 8h.001",key:"1x2st2"}],["path",{d:"M14 8h.001",key:"1vkmyp"}],["path",{d:"M18 8h.001",key:"kfsenl"}],["path",{d:"M8 12h.001",key:"1sjpby"}],["path",{d:"M12 12h.001",key:"al75ts"}],["path",{d:"M16 12h.001",key:"931bgk"}],["path",{d:"M7 16h10",key:"wp8him"}]]);var z=a.i(641710),A=a.i(660246),B=a.i(111269),C=a.i(238246),D=a.i(864037),E=a.i(703130),F=a.i(917171),G=a.i(280281),H=a.i(497895);let I=g.forwardRef(({value:a=[0],onValueChange:b,min:c=0,max:d=100,step:e=1,disabled:g,className:h},i)=>{let j=a[0]||c;return(0,f.jsx)("div",{className:(0,H.cn)("relative flex w-full touch-none select-none items-center",h),children:(0,f.jsx)("input",{ref:i,type:"range",min:c,max:d,step:e,value:j,disabled:g,onChange:a=>b?.([Number(a.target.value)]),className:"h-2 w-full cursor-pointer appearance-none rounded-lg bg-input",style:{background:`linear-gradient(to right, #335ACF 0%, #335ACF ${(j-c)/(d-c)*100}%, #E5E7EB ${(j-c)/(d-c)*100}%, #E5E7EB 100%)`}})})});I.displayName="Slider";var J=a.i(731626),K=g,L=a.i(935112),M=a.i(487610);function N(a){this.content=a}N.prototype={constructor:N,find:function(a){for(var b=0;b<this.content.length;b+=2)if(this.content[b]===a)return b;return -1},get:function(a){var b=this.find(a);return -1==b?void 0:this.content[b+1]},update:function(a,b,c){var d=c&&c!=a?this.remove(c):this,e=d.find(a),f=d.content.slice();return -1==e?f.push(c||a,b):(f[e+1]=b,c&&(f[e]=c)),new N(f)},remove:function(a){var b=this.find(a);if(-1==b)return this;var c=this.content.slice();return c.splice(b,2),new N(c)},addToStart:function(a,b){return new N([a,b].concat(this.remove(a).content))},addToEnd:function(a,b){var c=this.remove(a).content.slice();return c.push(a,b),new N(c)},addBefore:function(a,b,c){var d=this.remove(b),e=d.content.slice(),f=d.find(a);return e.splice(-1==f?e.length:f,0,b,c),new N(e)},forEach:function(a){for(var b=0;b<this.content.length;b+=2)a(this.content[b],this.content[b+1])},prepend:function(a){return(a=N.from(a)).size?new N(a.content.concat(this.subtract(a).content)):this},append:function(a){return(a=N.from(a)).size?new N(this.subtract(a).content.concat(a.content)):this},subtract:function(a){var b=this;a=N.from(a);for(var c=0;c<a.content.length;c+=2)b=b.remove(a.content[c]);return b},toObject:function(){var a={};return this.forEach(function(b,c){a[b]=c}),a},get size(){return this.content.length>>1}},N.from=function(a){if(a instanceof N)return a;var b=[];if(a)for(var c in a)b.push(c,a[c]);return new N(b)};class O{constructor(a,b){if(this.content=a,this.size=b||0,null==b)for(let b=0;b<a.length;b++)this.size+=a[b].nodeSize}nodesBetween(a,b,c,d=0,e){for(let f=0,g=0;g<b;f++){let h=this.content[f],i=g+h.nodeSize;if(i>a&&!1!==c(h,d+g,e||null,f)&&h.content.size){let e=g+1;h.nodesBetween(Math.max(0,a-e),Math.min(h.content.size,b-e),c,d+e)}g=i}}descendants(a){this.nodesBetween(0,this.size,a)}textBetween(a,b,c,d){let e="",f=!0;return this.nodesBetween(a,b,(g,h)=>{let i=g.isText?g.text.slice(Math.max(a,h)-h,b-h):g.isLeaf?d?"function"==typeof d?d(g):d:g.type.spec.leafText?g.type.spec.leafText(g):"":"";g.isBlock&&(g.isLeaf&&i||g.isTextblock)&&c&&(f?f=!1:e+=c),e+=i},0),e}append(a){if(!a.size)return this;if(!this.size)return a;let b=this.lastChild,c=a.firstChild,d=this.content.slice(),e=0;for(b.isText&&b.sameMarkup(c)&&(d[d.length-1]=b.withText(b.text+c.text),e=1);e<a.content.length;e++)d.push(a.content[e]);return new O(d,this.size+a.size)}cut(a,b=this.size){if(0==a&&b==this.size)return this;let c=[],d=0;if(b>a)for(let e=0,f=0;f<b;e++){let g=this.content[e],h=f+g.nodeSize;h>a&&((f<a||h>b)&&(g=g.isText?g.cut(Math.max(0,a-f),Math.min(g.text.length,b-f)):g.cut(Math.max(0,a-f-1),Math.min(g.content.size,b-f-1))),c.push(g),d+=g.nodeSize),f=h}return new O(c,d)}cutByIndex(a,b){return a==b?O.empty:0==a&&b==this.content.length?this:new O(this.content.slice(a,b))}replaceChild(a,b){let c=this.content[a];if(c==b)return this;let d=this.content.slice(),e=this.size+b.nodeSize-c.nodeSize;return d[a]=b,new O(d,e)}addToStart(a){return new O([a].concat(this.content),this.size+a.nodeSize)}addToEnd(a){return new O(this.content.concat(a),this.size+a.nodeSize)}eq(a){if(this.content.length!=a.content.length)return!1;for(let b=0;b<this.content.length;b++)if(!this.content[b].eq(a.content[b]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(a){let b=this.content[a];if(!b)throw RangeError("Index "+a+" out of range for "+this);return b}maybeChild(a){return this.content[a]||null}forEach(a){for(let b=0,c=0;b<this.content.length;b++){let d=this.content[b];a(d,c,b),c+=d.nodeSize}}findDiffStart(a,b=0){return function a(b,c,d){for(let e=0;;e++){if(e==b.childCount||e==c.childCount)return b.childCount==c.childCount?null:d;let f=b.child(e),g=c.child(e);if(f==g){d+=f.nodeSize;continue}if(!f.sameMarkup(g))return d;if(f.isText&&f.text!=g.text){for(let a=0;f.text[a]==g.text[a];a++)d++;return d}if(f.content.size||g.content.size){let b=a(f.content,g.content,d+1);if(null!=b)return b}d+=f.nodeSize}}(this,a,b)}findDiffEnd(a,b=this.size,c=a.size){return function a(b,c,d,e){for(let f=b.childCount,g=c.childCount;;){if(0==f||0==g)return f==g?null:{a:d,b:e};let h=b.child(--f),i=c.child(--g),j=h.nodeSize;if(h==i){d-=j,e-=j;continue}if(!h.sameMarkup(i))return{a:d,b:e};if(h.isText&&h.text!=i.text){let a=0,b=Math.min(h.text.length,i.text.length);for(;a<b&&h.text[h.text.length-a-1]==i.text[i.text.length-a-1];)a++,d--,e--;return{a:d,b:e}}if(h.content.size||i.content.size){let b=a(h.content,i.content,d-1,e-1);if(b)return b}d-=j,e-=j}}(this,a,b,c)}findIndex(a){if(0==a)return Q(0,a);if(a==this.size)return Q(this.content.length,a);if(a>this.size||a<0)throw RangeError(`Position ${a} outside of fragment (${this})`);for(let b=0,c=0;;b++){let d=c+this.child(b).nodeSize;if(d>=a){if(d==a)return Q(b+1,d);return Q(b,c)}c=d}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(a=>a.toJSON()):null}static fromJSON(a,b){if(!b)return O.empty;if(!Array.isArray(b))throw RangeError("Invalid input for Fragment.fromJSON");return new O(b.map(a.nodeFromJSON))}static fromArray(a){if(!a.length)return O.empty;let b,c=0;for(let d=0;d<a.length;d++){let e=a[d];c+=e.nodeSize,d&&e.isText&&a[d-1].sameMarkup(e)?(b||(b=a.slice(0,d)),b[b.length-1]=e.withText(b[b.length-1].text+e.text)):b&&b.push(e)}return new O(b||a,c)}static from(a){if(!a)return O.empty;if(a instanceof O)return a;if(Array.isArray(a))return this.fromArray(a);if(a.attrs)return new O([a],a.nodeSize);throw RangeError("Can not convert "+a+" to a Fragment"+(a.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}O.empty=new O([],0);let P={index:0,offset:0};function Q(a,b){return P.index=a,P.offset=b,P}function R(a,b){if(a===b)return!0;if(!(a&&"object"==typeof a)||!(b&&"object"==typeof b))return!1;let c=Array.isArray(a);if(Array.isArray(b)!=c)return!1;if(c){if(a.length!=b.length)return!1;for(let c=0;c<a.length;c++)if(!R(a[c],b[c]))return!1}else{for(let c in a)if(!(c in b)||!R(a[c],b[c]))return!1;for(let c in b)if(!(c in a))return!1}return!0}class S{constructor(a,b){this.type=a,this.attrs=b}addToSet(a){let b,c=!1;for(let d=0;d<a.length;d++){let e=a[d];if(this.eq(e))return a;if(this.type.excludes(e.type))b||(b=a.slice(0,d));else{if(e.type.excludes(this.type))return a;!c&&e.type.rank>this.type.rank&&(b||(b=a.slice(0,d)),b.push(this),c=!0),b&&b.push(e)}}return b||(b=a.slice()),c||b.push(this),b}removeFromSet(a){for(let b=0;b<a.length;b++)if(this.eq(a[b]))return a.slice(0,b).concat(a.slice(b+1));return a}isInSet(a){for(let b=0;b<a.length;b++)if(this.eq(a[b]))return!0;return!1}eq(a){return this==a||this.type==a.type&&R(this.attrs,a.attrs)}toJSON(){let a={type:this.type.name};for(let b in this.attrs){a.attrs=this.attrs;break}return a}static fromJSON(a,b){if(!b)throw RangeError("Invalid input for Mark.fromJSON");let c=a.marks[b.type];if(!c)throw RangeError(`There is no mark type ${b.type} in this schema`);let d=c.create(b.attrs);return c.checkAttrs(d.attrs),d}static sameSet(a,b){if(a==b)return!0;if(a.length!=b.length)return!1;for(let c=0;c<a.length;c++)if(!a[c].eq(b[c]))return!1;return!0}static setFrom(a){if(!a||Array.isArray(a)&&0==a.length)return S.none;if(a instanceof S)return[a];let b=a.slice();return b.sort((a,b)=>a.type.rank-b.type.rank),b}}S.none=[];class T extends Error{}class U{constructor(a,b,c){this.content=a,this.openStart=b,this.openEnd=c}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(a,b){let c=function a(b,c,d,e){let{index:f,offset:g}=b.findIndex(c),h=b.maybeChild(f);if(g==c||h.isText)return e&&!e.canReplace(f,f,d)?null:b.cut(0,c).append(d).append(b.cut(c));let i=a(h.content,c-g-1,d,h);return i&&b.replaceChild(f,h.copy(i))}(this.content,a+this.openStart,b);return c&&new U(c,this.openStart,this.openEnd)}removeBetween(a,b){return new U(function a(b,c,d){let{index:e,offset:f}=b.findIndex(c),g=b.maybeChild(e),{index:h,offset:i}=b.findIndex(d);if(f==c||g.isText){if(i!=d&&!b.child(h).isText)throw RangeError("Removing non-flat range");return b.cut(0,c).append(b.cut(d))}if(e!=h)throw RangeError("Removing non-flat range");return b.replaceChild(e,g.copy(a(g.content,c-f-1,d-f-1)))}(this.content,a+this.openStart,b+this.openStart),this.openStart,this.openEnd)}eq(a){return this.content.eq(a.content)&&this.openStart==a.openStart&&this.openEnd==a.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let a={content:this.content.toJSON()};return this.openStart>0&&(a.openStart=this.openStart),this.openEnd>0&&(a.openEnd=this.openEnd),a}static fromJSON(a,b){if(!b)return U.empty;let c=b.openStart||0,d=b.openEnd||0;if("number"!=typeof c||"number"!=typeof d)throw RangeError("Invalid input for Slice.fromJSON");return new U(O.fromJSON(a,b.content),c,d)}static maxOpen(a,b=!0){let c=0,d=0;for(let d=a.firstChild;d&&!d.isLeaf&&(b||!d.type.spec.isolating);d=d.firstChild)c++;for(let c=a.lastChild;c&&!c.isLeaf&&(b||!c.type.spec.isolating);c=c.lastChild)d++;return new U(a,c,d)}}function V(a,b){if(!b.type.compatibleContent(a.type))throw new T("Cannot join "+b.type.name+" onto "+a.type.name)}function W(a,b,c){let d=a.node(c);return V(d,b.node(c)),d}function X(a,b){let c=b.length-1;c>=0&&a.isText&&a.sameMarkup(b[c])?b[c]=a.withText(b[c].text+a.text):b.push(a)}function Y(a,b,c,d){let e=(b||a).node(c),f=0,g=b?b.index(c):e.childCount;a&&(f=a.index(c),a.depth>c?f++:a.textOffset&&(X(a.nodeAfter,d),f++));for(let a=f;a<g;a++)X(e.child(a),d);b&&b.depth==c&&b.textOffset&&X(b.nodeBefore,d)}function Z(a,b){return a.type.checkContent(b),a.copy(b)}function $(a,b,c){let d=[];return Y(null,a,c,d),a.depth>c&&X(Z(W(a,b,c+1),$(a,b,c+1)),d),Y(b,null,c,d),new O(d)}U.empty=new U(O.empty,0,0);class _{constructor(a,b,c){this.pos=a,this.path=b,this.parentOffset=c,this.depth=b.length/3-1}resolveDepth(a){return null==a?this.depth:a<0?this.depth+a:a}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(a){return this.path[3*this.resolveDepth(a)]}index(a){return this.path[3*this.resolveDepth(a)+1]}indexAfter(a){return a=this.resolveDepth(a),this.index(a)+(a!=this.depth||this.textOffset?1:0)}start(a){return 0==(a=this.resolveDepth(a))?0:this.path[3*a-1]+1}end(a){return a=this.resolveDepth(a),this.start(a)+this.node(a).content.size}before(a){if(!(a=this.resolveDepth(a)))throw RangeError("There is no position before the top-level node");return a==this.depth+1?this.pos:this.path[3*a-1]}after(a){if(!(a=this.resolveDepth(a)))throw RangeError("There is no position after the top-level node");return a==this.depth+1?this.pos:this.path[3*a-1]+this.path[3*a].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let a=this.parent,b=this.index(this.depth);if(b==a.childCount)return null;let c=this.pos-this.path[this.path.length-1],d=a.child(b);return c?a.child(b).cut(c):d}get nodeBefore(){let a=this.index(this.depth),b=this.pos-this.path[this.path.length-1];return b?this.parent.child(a).cut(0,b):0==a?null:this.parent.child(a-1)}posAtIndex(a,b){b=this.resolveDepth(b);let c=this.path[3*b],d=0==b?0:this.path[3*b-1]+1;for(let b=0;b<a;b++)d+=c.child(b).nodeSize;return d}marks(){let a=this.parent,b=this.index();if(0==a.content.size)return S.none;if(this.textOffset)return a.child(b).marks;let c=a.maybeChild(b-1),d=a.maybeChild(b);if(!c){let a=c;c=d,d=a}let e=c.marks;for(var f=0;f<e.length;f++)!1!==e[f].type.spec.inclusive||d&&e[f].isInSet(d.marks)||(e=e[f--].removeFromSet(e));return e}marksAcross(a){let b=this.parent.maybeChild(this.index());if(!b||!b.isInline)return null;let c=b.marks,d=a.parent.maybeChild(a.index());for(var e=0;e<c.length;e++)!1!==c[e].type.spec.inclusive||d&&c[e].isInSet(d.marks)||(c=c[e--].removeFromSet(c));return c}sharedDepth(a){for(let b=this.depth;b>0;b--)if(this.start(b)<=a&&this.end(b)>=a)return b;return 0}blockRange(a=this,b){if(a.pos<this.pos)return a.blockRange(this);for(let c=this.depth-(this.parent.inlineContent||this.pos==a.pos?1:0);c>=0;c--)if(a.pos<=this.end(c)&&(!b||b(this.node(c))))return new ad(this,a,c);return null}sameParent(a){return this.pos-this.parentOffset==a.pos-a.parentOffset}max(a){return a.pos>this.pos?a:this}min(a){return a.pos<this.pos?a:this}toString(){let a="";for(let b=1;b<=this.depth;b++)a+=(a?"/":"")+this.node(b).type.name+"_"+this.index(b-1);return a+":"+this.parentOffset}static resolve(a,b){if(!(b>=0&&b<=a.content.size))throw RangeError("Position "+b+" out of range");let c=[],d=0,e=b;for(let b=a;;){let{index:a,offset:f}=b.content.findIndex(e),g=e-f;if(c.push(b,a,d+f),!g||(b=b.child(a)).isText)break;e=g-1,d+=f+1}return new _(b,c,e)}static resolveCached(a,b){let c=ac.get(a);if(c)for(let a=0;a<c.elts.length;a++){let d=c.elts[a];if(d.pos==b)return d}else ac.set(a,c=new aa);let d=c.elts[c.i]=_.resolve(a,b);return c.i=(c.i+1)%ab,d}}class aa{constructor(){this.elts=[],this.i=0}}let ab=12,ac=new WeakMap;class ad{constructor(a,b,c){this.$from=a,this.$to=b,this.depth=c}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}let ae=Object.create(null);class af{constructor(a,b,c,d=S.none){this.type=a,this.attrs=b,this.marks=d,this.content=c||O.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(a){return this.content.child(a)}maybeChild(a){return this.content.maybeChild(a)}forEach(a){this.content.forEach(a)}nodesBetween(a,b,c,d=0){this.content.nodesBetween(a,b,c,d,this)}descendants(a){this.nodesBetween(0,this.content.size,a)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(a,b,c,d){return this.content.textBetween(a,b,c,d)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(a){return this==a||this.sameMarkup(a)&&this.content.eq(a.content)}sameMarkup(a){return this.hasMarkup(a.type,a.attrs,a.marks)}hasMarkup(a,b,c){return this.type==a&&R(this.attrs,b||a.defaultAttrs||ae)&&S.sameSet(this.marks,c||S.none)}copy(a=null){return a==this.content?this:new af(this.type,this.attrs,a,this.marks)}mark(a){return a==this.marks?this:new af(this.type,this.attrs,this.content,a)}cut(a,b=this.content.size){return 0==a&&b==this.content.size?this:this.copy(this.content.cut(a,b))}slice(a,b=this.content.size,c=!1){if(a==b)return U.empty;let d=this.resolve(a),e=this.resolve(b),f=c?0:d.sharedDepth(b),g=d.start(f);return new U(d.node(f).content.cut(d.pos-g,e.pos-g),d.depth-f,e.depth-f)}replace(a,b,c){var d=this.resolve(a),e=this.resolve(b);if(c.openStart>d.depth)throw new T("Inserted content deeper than insertion position");if(d.depth-c.openStart!=e.depth-c.openEnd)throw new T("Inconsistent open depths");return function a(b,c,d,e){let f=b.index(e),g=b.node(e);if(f==c.index(e)&&e<b.depth-d.openStart){let h=a(b,c,d,e+1);return g.copy(g.content.replaceChild(f,h))}if(!d.content.size)return Z(g,$(b,c,e));if(d.openStart||d.openEnd||b.depth!=e||c.depth!=e){let{start:a,end:f}=function(a,b){let c=b.depth-a.openStart,d=b.node(c).copy(a.content);for(let a=c-1;a>=0;a--)d=b.node(a).copy(O.from(d));return{start:d.resolveNoCache(a.openStart+c),end:d.resolveNoCache(d.content.size-a.openEnd-c)}}(d,b);return Z(g,function a(b,c,d,e,f){let g=b.depth>f&&W(b,c,f+1),h=e.depth>f&&W(d,e,f+1),i=[];return Y(null,b,f,i),g&&h&&c.index(f)==d.index(f)?(V(g,h),X(Z(g,a(b,c,d,e,f+1)),i)):(g&&X(Z(g,$(b,c,f+1)),i),Y(c,d,f,i),h&&X(Z(h,$(d,e,f+1)),i)),Y(e,null,f,i),new O(i)}(b,a,f,c,e))}{let a=b.parent,e=a.content;return Z(a,e.cut(0,b.parentOffset).append(d.content).append(e.cut(c.parentOffset)))}}(d,e,c,0)}nodeAt(a){for(let b=this;;){let{index:c,offset:d}=b.content.findIndex(a);if(!(b=b.maybeChild(c)))return null;if(d==a||b.isText)return b;a-=d+1}}childAfter(a){let{index:b,offset:c}=this.content.findIndex(a);return{node:this.content.maybeChild(b),index:b,offset:c}}childBefore(a){if(0==a)return{node:null,index:0,offset:0};let{index:b,offset:c}=this.content.findIndex(a);if(c<a)return{node:this.content.child(b),index:b,offset:c};let d=this.content.child(b-1);return{node:d,index:b-1,offset:c-d.nodeSize}}resolve(a){return _.resolveCached(this,a)}resolveNoCache(a){return _.resolve(this,a)}rangeHasMark(a,b,c){let d=!1;return b>a&&this.nodesBetween(a,b,a=>(c.isInSet(a.marks)&&(d=!0),!d)),d}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let a=this.type.name;return this.content.size&&(a+="("+this.content.toStringInner()+")"),ah(this.marks,a)}contentMatchAt(a){let b=this.type.contentMatch.matchFragment(this.content,0,a);if(!b)throw Error("Called contentMatchAt on a node with invalid content");return b}canReplace(a,b,c=O.empty,d=0,e=c.childCount){let f=this.contentMatchAt(a).matchFragment(c,d,e),g=f&&f.matchFragment(this.content,b);if(!g||!g.validEnd)return!1;for(let a=d;a<e;a++)if(!this.type.allowsMarks(c.child(a).marks))return!1;return!0}canReplaceWith(a,b,c,d){if(d&&!this.type.allowsMarks(d))return!1;let e=this.contentMatchAt(a).matchType(c),f=e&&e.matchFragment(this.content,b);return!!f&&f.validEnd}canAppend(a){return a.content.size?this.canReplace(this.childCount,this.childCount,a.content):this.type.compatibleContent(a.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let a=S.none;for(let b=0;b<this.marks.length;b++){let c=this.marks[b];c.type.checkAttrs(c.attrs),a=c.addToSet(a)}if(!S.sameSet(a,this.marks))throw RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(a=>a.type.name)}`);this.content.forEach(a=>a.check())}toJSON(){let a={type:this.type.name};for(let b in this.attrs){a.attrs=this.attrs;break}return this.content.size&&(a.content=this.content.toJSON()),this.marks.length&&(a.marks=this.marks.map(a=>a.toJSON())),a}static fromJSON(a,b){let c;if(!b)throw RangeError("Invalid input for Node.fromJSON");if(b.marks){if(!Array.isArray(b.marks))throw RangeError("Invalid mark data for Node.fromJSON");c=b.marks.map(a.markFromJSON)}if("text"==b.type){if("string"!=typeof b.text)throw RangeError("Invalid text node in JSON");return a.text(b.text,c)}let d=O.fromJSON(a,b.content),e=a.nodeType(b.type).create(b.attrs,d,c);return e.type.checkAttrs(e.attrs),e}}af.prototype.text=void 0;class ag extends af{constructor(a,b,c,d){if(super(a,b,null,d),!c)throw RangeError("Empty text nodes are not allowed");this.text=c}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):ah(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(a,b){return this.text.slice(a,b)}get nodeSize(){return this.text.length}mark(a){return a==this.marks?this:new ag(this.type,this.attrs,this.text,a)}withText(a){return a==this.text?this:new ag(this.type,this.attrs,a,this.marks)}cut(a=0,b=this.text.length){return 0==a&&b==this.text.length?this:this.withText(this.text.slice(a,b))}eq(a){return this.sameMarkup(a)&&this.text==a.text}toJSON(){let a=super.toJSON();return a.text=this.text,a}}function ah(a,b){for(let c=a.length-1;c>=0;c--)b=a[c].type.name+"("+b+")";return b}class ai{constructor(a){this.validEnd=a,this.next=[],this.wrapCache=[]}static parse(a,b){var c;let d,e=new aj(a,b);if(null==e.next)return ai.empty;let f=function a(b){let c=[];do c.push(function(b){let c=[];do c.push(function(b){let c=function(b){if(b.eat("(")){let c=a(b);return b.eat(")")||b.err("Missing closing paren"),c}if(/\W/.test(b.next))b.err("Unexpected token '"+b.next+"'");else{let a=(function(a,b){let c=a.nodeTypes,d=c[b];if(d)return[d];let e=[];for(let a in c){let d=c[a];d.isInGroup(b)&&e.push(d)}return 0==e.length&&a.err("No node type or group '"+b+"' found"),e})(b,b.next).map(a=>(null==b.inline?b.inline=a.isInline:b.inline!=a.isInline&&b.err("Mixing inline and block content"),{type:"name",value:a}));return b.pos++,1==a.length?a[0]:{type:"choice",exprs:a}}}(b);for(;;)if(b.eat("+"))c={type:"plus",expr:c};else if(b.eat("*"))c={type:"star",expr:c};else if(b.eat("?"))c={type:"opt",expr:c};else if(b.eat("{"))c=function(a,b){let c=ak(a),d=c;return a.eat(",")&&(d="}"!=a.next?ak(a):-1),a.eat("}")||a.err("Unclosed braced range"),{type:"range",min:c,max:d,expr:b}}(b,c);else break;return c}(b));while(b.next&&")"!=b.next&&"|"!=b.next)return 1==c.length?c[0]:{type:"seq",exprs:c}}(b));while(b.eat("|"))return 1==c.length?c[0]:{type:"choice",exprs:c}}(e);e.next&&e.err("Unexpected trailing text");let g=(c=function(a){let b=[[]];return e(function a(b,f){if("choice"==b.type)return b.exprs.reduce((b,c)=>b.concat(a(c,f)),[]);if("seq"==b.type)for(let d=0;;d++){let g=a(b.exprs[d],f);if(d==b.exprs.length-1)return g;e(g,f=c())}else if("star"==b.type){let g=c();return d(f,g),e(a(b.expr,g),g),[d(g)]}else if("plus"==b.type){let g=c();return e(a(b.expr,f),g),e(a(b.expr,g),g),[d(g)]}else if("opt"==b.type)return[d(f)].concat(a(b.expr,f));else if("range"==b.type){let g=f;for(let d=0;d<b.min;d++){let d=c();e(a(b.expr,g),d),g=d}if(-1==b.max)e(a(b.expr,g),g);else for(let f=b.min;f<b.max;f++){let f=c();d(g,f),e(a(b.expr,g),f),g=f}return[d(g)]}else if("name"==b.type)return[d(f,void 0,b.value)];else throw Error("Unknown expr type")}(a,0),c()),b;function c(){return b.push([])-1}function d(a,c,d){let e={term:d,to:c};return b[a].push(e),e}function e(a,b){a.forEach(a=>a.to=b)}}(f),d=Object.create(null),function a(b){let e=[];b.forEach(a=>{c[a].forEach(({term:a,to:b})=>{let d;if(a){for(let b=0;b<e.length;b++)e[b][0]==a&&(d=e[b][1]);am(c,b).forEach(b=>{d||e.push([a,d=[]]),-1==d.indexOf(b)&&d.push(b)})}})});let f=d[b.join(",")]=new ai(b.indexOf(c.length-1)>-1);for(let b=0;b<e.length;b++){let c=e[b][1].sort(al);f.next.push({type:e[b][0],next:d[c.join(",")]||a(c)})}return f}(am(c,0)));return function(a,b){for(let c=0,d=[a];c<d.length;c++){let a=d[c],e=!a.validEnd,f=[];for(let b=0;b<a.next.length;b++){let{type:c,next:g}=a.next[b];f.push(c.name),e&&!(c.isText||c.hasRequiredAttrs())&&(e=!1),-1==d.indexOf(g)&&d.push(g)}e&&b.err("Only non-generatable nodes ("+f.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(g,e),g}matchType(a){for(let b=0;b<this.next.length;b++)if(this.next[b].type==a)return this.next[b].next;return null}matchFragment(a,b=0,c=a.childCount){let d=this;for(let e=b;d&&e<c;e++)d=d.matchType(a.child(e).type);return d}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let a=0;a<this.next.length;a++){let{type:b}=this.next[a];if(!(b.isText||b.hasRequiredAttrs()))return b}return null}compatible(a){for(let b=0;b<this.next.length;b++)for(let c=0;c<a.next.length;c++)if(this.next[b].type==a.next[c].type)return!0;return!1}fillBefore(a,b=!1,c=0){let d=[this];return function e(f,g){let h=f.matchFragment(a,c);if(h&&(!b||h.validEnd))return O.from(g.map(a=>a.createAndFill()));for(let a=0;a<f.next.length;a++){let{type:b,next:c}=f.next[a];if(!(b.isText||b.hasRequiredAttrs())&&-1==d.indexOf(c)){d.push(c);let a=e(c,g.concat(b));if(a)return a}}return null}(this,[])}findWrapping(a){for(let b=0;b<this.wrapCache.length;b+=2)if(this.wrapCache[b]==a)return this.wrapCache[b+1];let b=this.computeWrapping(a);return this.wrapCache.push(a,b),b}computeWrapping(a){let b=Object.create(null),c=[{match:this,type:null,via:null}];for(;c.length;){let d=c.shift(),e=d.match;if(e.matchType(a)){let a=[];for(let b=d;b.type;b=b.via)a.push(b.type);return a.reverse()}for(let a=0;a<e.next.length;a++){let{type:f,next:g}=e.next[a];f.isLeaf||f.hasRequiredAttrs()||f.name in b||d.type&&!g.validEnd||(c.push({match:f.contentMatch,type:f,via:d}),b[f.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(a){if(a>=this.next.length)throw RangeError(`There's no ${a}th edge in this content match`);return this.next[a]}toString(){let a=[];return!function b(c){a.push(c);for(let d=0;d<c.next.length;d++)-1==a.indexOf(c.next[d].next)&&b(c.next[d].next)}(this),a.map((b,c)=>{let d=c+(b.validEnd?"*":" ")+" ";for(let c=0;c<b.next.length;c++)d+=(c?", ":"")+b.next[c].type.name+"->"+a.indexOf(b.next[c].next);return d}).join("\n")}}ai.empty=new ai(!0);class aj{constructor(a,b){this.string=a,this.nodeTypes=b,this.inline=null,this.pos=0,this.tokens=a.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(a){return this.next==a&&(this.pos++||!0)}err(a){throw SyntaxError(a+" (in content expression '"+this.string+"')")}}function ak(a){/\D/.test(a.next)&&a.err("Expected number, got '"+a.next+"'");let b=Number(a.next);return a.pos++,b}function al(a,b){return b-a}function am(a,b){let c=[];return function b(d){let e=a[d];if(1==e.length&&!e[0].term)return b(e[0].to);c.push(d);for(let a=0;a<e.length;a++){let{term:d,to:f}=e[a];d||-1!=c.indexOf(f)||b(f)}}(b),c.sort(al)}function an(a){let b=Object.create(null);for(let c in a){let d=a[c];if(!d.hasDefault)return null;b[c]=d.default}return b}function ao(a,b){let c=Object.create(null);for(let d in a){let e=b&&b[d];if(void 0===e){let b=a[d];if(b.hasDefault)e=b.default;else throw RangeError("No value supplied for attribute "+d)}c[d]=e}return c}function ap(a,b,c,d){for(let d in b)if(!(d in a))throw RangeError(`Unsupported attribute ${d} for ${c} of type ${d}`);for(let c in a){let d=a[c];d.validate&&d.validate(b[c])}}function aq(a,b){let c=Object.create(null);if(b)for(let d in b)c[d]=new as(a,d,b[d]);return c}class ar{constructor(a,b,c){this.name=a,this.schema=b,this.spec=c,this.markSet=null,this.groups=c.group?c.group.split(" "):[],this.attrs=aq(a,c.attrs),this.defaultAttrs=an(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(c.inline||"text"==a),this.isText="text"==a}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ai.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(a){return this.groups.indexOf(a)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let a in this.attrs)if(this.attrs[a].isRequired)return!0;return!1}compatibleContent(a){return this==a||this.contentMatch.compatible(a.contentMatch)}computeAttrs(a){return!a&&this.defaultAttrs?this.defaultAttrs:ao(this.attrs,a)}create(a=null,b,c){if(this.isText)throw Error("NodeType.create can't construct text nodes");return new af(this,this.computeAttrs(a),O.from(b),S.setFrom(c))}createChecked(a=null,b,c){return b=O.from(b),this.checkContent(b),new af(this,this.computeAttrs(a),b,S.setFrom(c))}createAndFill(a=null,b,c){if(a=this.computeAttrs(a),(b=O.from(b)).size){let a=this.contentMatch.fillBefore(b);if(!a)return null;b=a.append(b)}let d=this.contentMatch.matchFragment(b),e=d&&d.fillBefore(O.empty,!0);return e?new af(this,a,b.append(e),S.setFrom(c)):null}validContent(a){let b=this.contentMatch.matchFragment(a);if(!b||!b.validEnd)return!1;for(let b=0;b<a.childCount;b++)if(!this.allowsMarks(a.child(b).marks))return!1;return!0}checkContent(a){if(!this.validContent(a))throw RangeError(`Invalid content for node ${this.name}: ${a.toString().slice(0,50)}`)}checkAttrs(a){ap(this.attrs,a,"node",this.name)}allowsMarkType(a){return null==this.markSet||this.markSet.indexOf(a)>-1}allowsMarks(a){if(null==this.markSet)return!0;for(let b=0;b<a.length;b++)if(!this.allowsMarkType(a[b].type))return!1;return!0}allowedMarks(a){let b;if(null==this.markSet)return a;for(let c=0;c<a.length;c++)this.allowsMarkType(a[c].type)?b&&b.push(a[c]):b||(b=a.slice(0,c));return b?b.length?b:S.none:a}static compile(a,b){let c=Object.create(null);a.forEach((a,d)=>c[a]=new ar(a,b,d));let d=b.spec.topNode||"doc";if(!c[d])throw RangeError("Schema is missing its top node type ('"+d+"')");if(!c.text)throw RangeError("Every schema needs a 'text' type");for(let a in c.text.attrs)throw RangeError("The text node type should not have attributes");return c}}class as{constructor(a,b,c){this.hasDefault=Object.prototype.hasOwnProperty.call(c,"default"),this.default=c.default,this.validate="string"==typeof c.validate?function(a,b,c){let d=c.split("|");return c=>{let e=null===c?"null":typeof c;if(0>d.indexOf(e))throw RangeError(`Expected value of type ${d} for attribute ${b} on type ${a}, got ${e}`)}}(a,b,c.validate):c.validate}get isRequired(){return!this.hasDefault}}class at{constructor(a,b,c,d){this.name=a,this.rank=b,this.schema=c,this.spec=d,this.attrs=aq(a,d.attrs),this.excluded=null;let e=an(this.attrs);this.instance=e?new S(this,e):null}create(a=null){return!a&&this.instance?this.instance:new S(this,ao(this.attrs,a))}static compile(a,b){let c=Object.create(null),d=0;return a.forEach((a,e)=>c[a]=new at(a,d++,b,e)),c}removeFromSet(a){for(var b=0;b<a.length;b++)a[b].type==this&&(a=a.slice(0,b).concat(a.slice(b+1)),b--);return a}isInSet(a){for(let b=0;b<a.length;b++)if(a[b].type==this)return a[b]}checkAttrs(a){ap(this.attrs,a,"mark",this.name)}excludes(a){return this.excluded.indexOf(a)>-1}}class au{constructor(a){this.linebreakReplacement=null,this.cached=Object.create(null);let b=this.spec={};for(let c in a)b[c]=a[c];b.nodes=N.from(a.nodes),b.marks=N.from(a.marks||{}),this.nodes=ar.compile(this.spec.nodes,this),this.marks=at.compile(this.spec.marks,this);let c=Object.create(null);for(let a in this.nodes){if(a in this.marks)throw RangeError(a+" can not be both a node and a mark");let b=this.nodes[a],d=b.spec.content||"",e=b.spec.marks;if(b.contentMatch=c[d]||(c[d]=ai.parse(d,this.nodes)),b.inlineContent=b.contentMatch.inlineContent,b.spec.linebreakReplacement){if(this.linebreakReplacement)throw RangeError("Multiple linebreak nodes defined");if(!b.isInline||!b.isLeaf)throw RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=b}b.markSet="_"==e?null:e?av(this,e.split(" ")):""!=e&&b.inlineContent?null:[]}for(let a in this.marks){let b=this.marks[a],c=b.spec.excludes;b.excluded=null==c?[b]:""==c?[]:av(this,c.split(" "))}this.nodeFromJSON=a=>af.fromJSON(this,a),this.markFromJSON=a=>S.fromJSON(this,a),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(a,b=null,c,d){if("string"==typeof a)a=this.nodeType(a);else if(a instanceof ar){if(a.schema!=this)throw RangeError("Node type from different schema used ("+a.name+")")}else throw RangeError("Invalid node type: "+a);return a.createChecked(b,c,d)}text(a,b){let c=this.nodes.text;return new ag(c,c.defaultAttrs,a,S.setFrom(b))}mark(a,b){return"string"==typeof a&&(a=this.marks[a]),a.create(b)}nodeType(a){let b=this.nodes[a];if(!b)throw RangeError("Unknown node type: "+a);return b}}function av(a,b){let c=[];for(let d=0;d<b.length;d++){let e=b[d],f=a.marks[e],g=f;if(f)c.push(f);else for(let b in a.marks){let d=a.marks[b];("_"==e||d.spec.group&&d.spec.group.split(" ").indexOf(e)>-1)&&c.push(g=d)}if(!g)throw SyntaxError("Unknown mark type: '"+b[d]+"'")}return c}class aw{constructor(a,b){this.schema=a,this.rules=b,this.tags=[],this.styles=[];let c=this.matchedStyles=[];b.forEach(a=>{if(null!=a.tag)this.tags.push(a);else if(null!=a.style){let b=/[^=]*/.exec(a.style)[0];0>c.indexOf(b)&&c.push(b),this.styles.push(a)}}),this.normalizeLists=!this.tags.some(b=>{if(!/^(ul|ol)\b/.test(b.tag)||!b.node)return!1;let c=a.nodes[b.node];return c.contentMatch.matchType(c)})}parse(a,b={}){let c=new aC(this,b,!1);return c.addAll(a,S.none,b.from,b.to),c.finish()}parseSlice(a,b={}){let c=new aC(this,b,!0);return c.addAll(a,S.none,b.from,b.to),U.maxOpen(c.finish())}matchTag(a,b,c){for(let f=c?this.tags.indexOf(c)+1:0;f<this.tags.length;f++){var d,e;let c=this.tags[f];if(d=a,e=c.tag,(d.matches||d.msMatchesSelector||d.webkitMatchesSelector||d.mozMatchesSelector).call(d,e)&&(void 0===c.namespace||a.namespaceURI==c.namespace)&&(!c.context||b.matchesContext(c.context))){if(c.getAttrs){let b=c.getAttrs(a);if(!1===b)continue;c.attrs=b||void 0}return c}}}matchStyle(a,b,c,d){for(let e=d?this.styles.indexOf(d)+1:0;e<this.styles.length;e++){let d=this.styles[e],f=d.style;if(0==f.indexOf(a)&&(!d.context||c.matchesContext(d.context))&&(!(f.length>a.length)||61==f.charCodeAt(a.length)&&f.slice(a.length+1)==b)){if(d.getAttrs){let a=d.getAttrs(b);if(!1===a)continue;d.attrs=a||void 0}return d}}}static schemaRules(a){let b=[];function c(a){let c=null==a.priority?50:a.priority,d=0;for(;d<b.length;d++){let a=b[d];if((null==a.priority?50:a.priority)<c)break}b.splice(d,0,a)}for(let b in a.marks){let d=a.marks[b].spec.parseDOM;d&&d.forEach(a=>{c(a=aD(a)),a.mark||a.ignore||a.clearMark||(a.mark=b)})}for(let b in a.nodes){let d=a.nodes[b].spec.parseDOM;d&&d.forEach(a=>{c(a=aD(a)),a.node||a.ignore||a.mark||(a.node=b)})}return b}static fromSchema(a){return a.cached.domParser||(a.cached.domParser=new aw(a,aw.schemaRules(a)))}}let ax={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ay={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},az={ol:!0,ul:!0};function aA(a,b,c){return null!=b?!!b|2*("full"===b):a&&"pre"==a.whitespace?3:-5&c}class aB{constructor(a,b,c,d,e,f){this.type=a,this.attrs=b,this.marks=c,this.solid=d,this.options=f,this.content=[],this.activeMarks=S.none,this.match=e||(4&f?null:a.contentMatch)}findWrapping(a){if(!this.match){if(!this.type)return[];let b=this.type.contentMatch.fillBefore(O.from(a));if(b)this.match=this.type.contentMatch.matchFragment(b);else{let b=this.type.contentMatch,c;return(c=b.findWrapping(a.type))?(this.match=b,c):null}}return this.match.findWrapping(a.type)}finish(a){if(!(1&this.options)){let a=this.content[this.content.length-1],b;a&&a.isText&&(b=/[ \t\r\n\u000c]+$/.exec(a.text))&&(a.text.length==b[0].length?this.content.pop():this.content[this.content.length-1]=a.withText(a.text.slice(0,a.text.length-b[0].length)))}let b=O.from(this.content);return!a&&this.match&&(b=b.append(this.match.fillBefore(O.empty,!0))),this.type?this.type.create(this.attrs,b,this.marks):b}inlineContext(a){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:a.parentNode&&!ax.hasOwnProperty(a.parentNode.nodeName.toLowerCase())}}class aC{constructor(a,b,c){this.parser=a,this.options=b,this.isOpen=c,this.open=0,this.localPreserveWS=!1;let d=b.topNode,e,f=aA(null,b.preserveWhitespace,0)|4*!!c;e=d?new aB(d.type,d.attrs,S.none,!0,b.topMatch||d.type.contentMatch,f):c?new aB(null,null,S.none,!0,null,f):new aB(a.schema.topNodeType,null,S.none,!0,null,f),this.nodes=[e],this.find=b.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(a,b){3==a.nodeType?this.addTextNode(a,b):1==a.nodeType&&this.addElement(a,b)}addTextNode(a,b){let c=a.nodeValue,d=this.top,e=2&d.options?"full":this.localPreserveWS||(1&d.options)>0,{schema:f}=this.parser;if("full"===e||d.inlineContext(a)||/[^ \t\r\n\u000c]/.test(c)){if(e)if("full"===e)c=c.replace(/\r\n?/g,"\n");else if(f.linebreakReplacement&&/[\r\n]/.test(c)&&this.top.findWrapping(f.linebreakReplacement.create())){let a=c.split(/\r?\n|\r/);for(let c=0;c<a.length;c++)c&&this.insertNode(f.linebreakReplacement.create(),b,!0),a[c]&&this.insertNode(f.text(a[c]),b,!/\S/.test(a[c]));c=""}else c=c.replace(/\r?\n|\r/g," ");else if(c=c.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(c)&&this.open==this.nodes.length-1){let b=d.content[d.content.length-1],e=a.previousSibling;(!b||e&&"BR"==e.nodeName||b.isText&&/[ \t\r\n\u000c]$/.test(b.text))&&(c=c.slice(1))}c&&this.insertNode(f.text(c),b,!/\S/.test(c)),this.findInText(a)}else this.findInside(a)}addElement(a,b,c){let d=this.localPreserveWS,e=this.top;("PRE"==a.tagName||/pre/.test(a.style&&a.style.whiteSpace))&&(this.localPreserveWS=!0);let f=a.nodeName.toLowerCase(),g;az.hasOwnProperty(f)&&this.parser.normalizeLists&&function(a){for(let b=a.firstChild,c=null;b;b=b.nextSibling){let a=1==b.nodeType?b.nodeName.toLowerCase():null;a&&az.hasOwnProperty(a)&&c?(c.appendChild(b),b=c):"li"==a?c=b:a&&(c=null)}}(a);let h=this.options.ruleFromNode&&this.options.ruleFromNode(a)||(g=this.parser.matchTag(a,this,c));a:if(h?h.ignore:ay.hasOwnProperty(f))this.findInside(a),this.ignoreFallback(a,b);else if(!h||h.skip||h.closeParent){h&&h.closeParent?this.open=Math.max(0,this.open-1):h&&h.skip.nodeType&&(a=h.skip);let c,d=this.needsBlock;if(ax.hasOwnProperty(f))e.content.length&&e.content[0].isInline&&this.open&&(this.open--,e=this.top),c=!0,e.type||(this.needsBlock=!0);else if(!a.firstChild){this.leafFallback(a,b);break a}let g=h&&h.skip?b:this.readStyles(a,b);g&&this.addAll(a,g),c&&this.sync(e),this.needsBlock=d}else{let c=this.readStyles(a,b);c&&this.addElementByRule(a,h,c,!1===h.consuming?g:void 0)}this.localPreserveWS=d}leafFallback(a,b){"BR"==a.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(a.ownerDocument.createTextNode("\n"),b)}ignoreFallback(a,b){"BR"!=a.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),b,!0)}readStyles(a,b){let c=a.style;if(c&&c.length)for(let a=0;a<this.parser.matchedStyles.length;a++){let d=this.parser.matchedStyles[a],e=c.getPropertyValue(d);if(e)for(let a;;){let c=this.parser.matchStyle(d,e,this,a);if(!c)break;if(c.ignore)return null;if(b=c.clearMark?b.filter(a=>!c.clearMark(a)):b.concat(this.parser.schema.marks[c.mark].create(c.attrs)),!1===c.consuming)a=c;else break}}return b}addElementByRule(a,b,c,d){let e,f;if(b.node)if((f=this.parser.schema.nodes[b.node]).isLeaf)this.insertNode(f.create(b.attrs),c,"BR"==a.nodeName)||this.leafFallback(a,c);else{let a=this.enter(f,b.attrs||null,c,b.preserveWhitespace);a&&(e=!0,c=a)}else{let a=this.parser.schema.marks[b.mark];c=c.concat(a.create(b.attrs))}let g=this.top;if(f&&f.isLeaf)this.findInside(a);else if(d)this.addElement(a,c,d);else if(b.getContent)this.findInside(a),b.getContent(a,this.parser.schema).forEach(a=>this.insertNode(a,c,!1));else{let d=a;"string"==typeof b.contentElement?d=a.querySelector(b.contentElement):"function"==typeof b.contentElement?d=b.contentElement(a):b.contentElement&&(d=b.contentElement),this.findAround(a,d,!0),this.addAll(d,c),this.findAround(a,d,!1)}e&&this.sync(g)&&this.open--}addAll(a,b,c,d){let e=c||0;for(let f=c?a.childNodes[c]:a.firstChild,g=null==d?null:a.childNodes[d];f!=g;f=f.nextSibling,++e)this.findAtPoint(a,e),this.addDOM(f,b);this.findAtPoint(a,e)}findPlace(a,b,c){let d,e;for(let b=this.open,f=0;b>=0;b--){let g=this.nodes[b],h=g.findWrapping(a);if(h&&(!d||d.length>h.length+f)&&(d=h,e=g,!h.length))break;if(g.solid){if(c)break;f+=2}}if(!d)return null;this.sync(e);for(let a=0;a<d.length;a++)b=this.enterInner(d[a],null,b,!1);return b}insertNode(a,b,c){if(a.isInline&&this.needsBlock&&!this.top.type){let a=this.textblockFromContext();a&&(b=this.enterInner(a,null,b))}let d=this.findPlace(a,b,c);if(d){this.closeExtra();let b=this.top;b.match&&(b.match=b.match.matchType(a.type));let c=S.none;for(let e of d.concat(a.marks))(b.type?b.type.allowsMarkType(e.type):aE(e.type,a.type))&&(c=e.addToSet(c));return b.content.push(a.mark(c)),!0}return!1}enter(a,b,c,d){let e=this.findPlace(a.create(b),c,!1);return e&&(e=this.enterInner(a,b,c,!0,d)),e}enterInner(a,b,c,d=!1,e){this.closeExtra();let f=this.top;f.match=f.match&&f.match.matchType(a);let g=aA(a,e,f.options);4&f.options&&0==f.content.length&&(g|=4);let h=S.none;return c=c.filter(b=>(f.type?!f.type.allowsMarkType(b.type):!aE(b.type,a))||(h=b.addToSet(h),!1)),this.nodes.push(new aB(a,b,h,d,null,g)),this.open++,c}closeExtra(a=!1){let b=this.nodes.length-1;if(b>this.open){for(;b>this.open;b--)this.nodes[b-1].content.push(this.nodes[b].finish(a));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(a){for(let b=this.open;b>=0;b--)if(this.nodes[b]==a)return this.open=b,!0;else this.localPreserveWS&&(this.nodes[b].options|=1);return!1}get currentPos(){this.closeExtra();let a=0;for(let b=this.open;b>=0;b--){let c=this.nodes[b].content;for(let b=c.length-1;b>=0;b--)a+=c[b].nodeSize;b&&a++}return a}findAtPoint(a,b){if(this.find)for(let c=0;c<this.find.length;c++)this.find[c].node==a&&this.find[c].offset==b&&(this.find[c].pos=this.currentPos)}findInside(a){if(this.find)for(let b=0;b<this.find.length;b++)null==this.find[b].pos&&1==a.nodeType&&a.contains(this.find[b].node)&&(this.find[b].pos=this.currentPos)}findAround(a,b,c){if(a!=b&&this.find)for(let d=0;d<this.find.length;d++)null==this.find[d].pos&&1==a.nodeType&&a.contains(this.find[d].node)&&b.compareDocumentPosition(this.find[d].node)&(c?2:4)&&(this.find[d].pos=this.currentPos)}findInText(a){if(this.find)for(let b=0;b<this.find.length;b++)this.find[b].node==a&&(this.find[b].pos=this.currentPos-(a.nodeValue.length-this.find[b].offset))}matchesContext(a){if(a.indexOf("|")>-1)return a.split(/\s*\|\s*/).some(this.matchesContext,this);let b=a.split("/"),c=this.options.context,d=!this.isOpen&&(!c||c.parent.type==this.nodes[0].type),e=-(c?c.depth+1:0)+ +!d,f=(a,g)=>{for(;a>=0;a--){let h=b[a];if(""==h){if(a==b.length-1||0==a)continue;for(;g>=e;g--)if(f(a-1,g))return!0;return!1}{let a=g>0||0==g&&d?this.nodes[g].type:c&&g>=e?c.node(g-e).type:null;if(!a||a.name!=h&&!a.isInGroup(h))return!1;g--}}return!0};return f(b.length-1,this.open)}textblockFromContext(){let a=this.options.context;if(a)for(let b=a.depth;b>=0;b--){let c=a.node(b).contentMatchAt(a.indexAfter(b)).defaultType;if(c&&c.isTextblock&&c.defaultAttrs)return c}for(let a in this.parser.schema.nodes){let b=this.parser.schema.nodes[a];if(b.isTextblock&&b.defaultAttrs)return b}}}function aD(a){let b={};for(let c in a)b[c]=a[c];return b}function aE(a,b){let c=b.schema.nodes;for(let d in c){let e=c[d];if(!e.allowsMarkType(a))continue;let f=[],g=a=>{f.push(a);for(let c=0;c<a.edgeCount;c++){let{type:d,next:e}=a.edge(c);if(d==b||0>f.indexOf(e)&&g(e))return!0}};if(g(e.contentMatch))return!0}}class aF{constructor(a,b){this.nodes=a,this.marks=b}serializeFragment(a,b={},c){c||(c=aH(b).createDocumentFragment());let d=c,e=[];return a.forEach(a=>{if(e.length||a.marks.length){let c=0,f=0;for(;c<e.length&&f<a.marks.length;){let b=a.marks[f];if(!this.marks[b.type.name]){f++;continue}if(!b.eq(e[c][0])||!1===b.type.spec.spanning)break;c++,f++}for(;c<e.length;)d=e.pop()[1];for(;f<a.marks.length;){let c=a.marks[f++],g=this.serializeMark(c,a.isInline,b);g&&(e.push([c,d]),d.appendChild(g.dom),d=g.contentDOM||g.dom)}}d.appendChild(this.serializeNodeInner(a,b))}),c}serializeNodeInner(a,b){let{dom:c,contentDOM:d}=aJ(aH(b),this.nodes[a.type.name](a),null,a.attrs);if(d){if(a.isLeaf)throw RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(a.content,b,d)}return c}serializeNode(a,b={}){let c=this.serializeNodeInner(a,b);for(let d=a.marks.length-1;d>=0;d--){let e=this.serializeMark(a.marks[d],a.isInline,b);e&&((e.contentDOM||e.dom).appendChild(c),c=e.dom)}return c}serializeMark(a,b,c={}){let d=this.marks[a.type.name];return d&&aJ(aH(c),d(a,b),null,a.attrs)}static renderSpec(a,b,c=null,d){return aJ(a,b,c,d)}static fromSchema(a){return a.cached.domSerializer||(a.cached.domSerializer=new aF(this.nodesFromSchema(a),this.marksFromSchema(a)))}static nodesFromSchema(a){let b=aG(a.nodes);return b.text||(b.text=a=>a.text),b}static marksFromSchema(a){return aG(a.marks)}}function aG(a){let b={};for(let c in a){let d=a[c].spec.toDOM;d&&(b[c]=d)}return b}function aH(a){return a.document||window.document}let aI=new WeakMap;function aJ(a,b,c,d){let e,f,g;if("string"==typeof b)return{dom:a.createTextNode(b)};if(null!=b.nodeType)return{dom:b};if(b.dom&&null!=b.dom.nodeType)return b;let h=b[0],i;if("string"!=typeof h)throw RangeError("Invalid array passed to renderSpec");if(d&&(void 0===(f=aI.get(d))&&aI.set(d,(g=null,!function a(b){if(b&&"object"==typeof b)if(Array.isArray(b))if("string"==typeof b[0])g||(g=[]),g.push(b);else for(let c=0;c<b.length;c++)a(b[c]);else for(let c in b)a(b[c])}(d),f=g)),i=f)&&i.indexOf(b)>-1)throw RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let j=h.indexOf(" ");j>0&&(c=h.slice(0,j),h=h.slice(j+1));let k=c?a.createElementNS(c,h):a.createElement(h),l=b[1],m=1;if(l&&"object"==typeof l&&null==l.nodeType&&!Array.isArray(l)){for(let a in m=2,l)if(null!=l[a]){let b=a.indexOf(" ");b>0?k.setAttributeNS(a.slice(0,b),a.slice(b+1),l[a]):"style"==a&&k.style?k.style.cssText=l[a]:k.setAttribute(a,l[a])}}for(let f=m;f<b.length;f++){let g=b[f];if(0===g){if(f<b.length-1||f>m)throw RangeError("Content hole must be the only child of its parent node");return{dom:k,contentDOM:k}}{let{dom:b,contentDOM:f}=aJ(a,g,c,d);if(k.appendChild(b),f){if(e)throw RangeError("Multiple content holes");e=f}}}return{dom:k,contentDOM:e}}class aK{constructor(a,b,c){this.pos=a,this.delInfo=b,this.recover=c}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class aL{constructor(a,b=!1){if(this.ranges=a,this.inverted=b,!a.length&&aL.empty)return aL.empty}recover(a){let b=0,c=65535&a;if(!this.inverted)for(let a=0;a<c;a++)b+=this.ranges[3*a+2]-this.ranges[3*a+1];return this.ranges[3*c]+b+(a-(65535&a))/65536}mapResult(a,b=1){return this._map(a,b,!1)}map(a,b=1){return this._map(a,b,!0)}_map(a,b,c){let d=0,e=this.inverted?2:1,f=this.inverted?1:2;for(let g=0;g<this.ranges.length;g+=3){let h=this.ranges[g]-(this.inverted?d:0);if(h>a)break;let i=this.ranges[g+e],j=this.ranges[g+f],k=h+i;if(a<=k){let e=i?a==h?-1:a==k?1:b:b,f=h+d+(e<0?0:j);if(c)return f;let l=a==(b<0?h:k)?null:g/3+(a-h)*65536,m=a==h?2:a==k?1:4;return(b<0?a!=h:a!=k)&&(m|=8),new aK(f,m,l)}d+=j-i}return c?a+d:new aK(a+d,0,null)}touches(a,b){let c=0,d=65535&b,e=this.inverted?2:1,f=this.inverted?1:2;for(let b=0;b<this.ranges.length;b+=3){let g=this.ranges[b]-(this.inverted?c:0);if(g>a)break;let h=this.ranges[b+e];if(a<=g+h&&b==3*d)return!0;c+=this.ranges[b+f]-h}return!1}forEach(a){let b=this.inverted?2:1,c=this.inverted?1:2;for(let d=0,e=0;d<this.ranges.length;d+=3){let f=this.ranges[d],g=f-(this.inverted?e:0),h=f+(this.inverted?0:e),i=this.ranges[d+b],j=this.ranges[d+c];a(g,g+i,h,h+j),e+=j-i}}invert(){return new aL(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(a){return 0==a?aL.empty:new aL(a<0?[0,-a,0]:[0,0,a])}}aL.empty=new aL([]);class aM{constructor(a,b,c=0,d=a?a.length:0){this.mirror=b,this.from=c,this.to=d,this._maps=a||[],this.ownData=!(a||b)}get maps(){return this._maps}slice(a=0,b=this.maps.length){return new aM(this._maps,this.mirror,a,b)}appendMap(a,b){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(a),null!=b&&this.setMirror(this._maps.length-1,b)}appendMapping(a){for(let b=0,c=this._maps.length;b<a._maps.length;b++){let d=a.getMirror(b);this.appendMap(a._maps[b],null!=d&&d<b?c+d:void 0)}}getMirror(a){if(this.mirror){for(let b=0;b<this.mirror.length;b++)if(this.mirror[b]==a)return this.mirror[b+(b%2?-1:1)]}}setMirror(a,b){this.mirror||(this.mirror=[]),this.mirror.push(a,b)}appendMappingInverted(a){for(let b=a.maps.length-1,c=this._maps.length+a._maps.length;b>=0;b--){let d=a.getMirror(b);this.appendMap(a._maps[b].invert(),null!=d&&d>b?c-d-1:void 0)}}invert(){let a=new aM;return a.appendMappingInverted(this),a}map(a,b=1){if(this.mirror)return this._map(a,b,!0);for(let c=this.from;c<this.to;c++)a=this._maps[c].map(a,b);return a}mapResult(a,b=1){return this._map(a,b,!1)}_map(a,b,c){let d=0;for(let c=this.from;c<this.to;c++){let e=this._maps[c].mapResult(a,b);if(null!=e.recover){let b=this.getMirror(c);if(null!=b&&b>c&&b<this.to){c=b,a=this._maps[b].recover(e.recover);continue}}d|=e.delInfo,a=e.pos}return c?a:new aK(a,d,null)}}let aN=Object.create(null);class aO{getMap(){return aL.empty}merge(a){return null}static fromJSON(a,b){if(!b||!b.stepType)throw RangeError("Invalid input for Step.fromJSON");let c=aN[b.stepType];if(!c)throw RangeError(`No step type ${b.stepType} defined`);return c.fromJSON(a,b)}static jsonID(a,b){if(a in aN)throw RangeError("Duplicate use of step JSON ID "+a);return aN[a]=b,b.prototype.jsonID=a,b}}class aP{constructor(a,b){this.doc=a,this.failed=b}static ok(a){return new aP(a,null)}static fail(a){return new aP(null,a)}static fromReplace(a,b,c,d){try{return aP.ok(a.replace(b,c,d))}catch(a){if(a instanceof T)return aP.fail(a.message);throw a}}}function aQ(a,b,c){let d=[];for(let e=0;e<a.childCount;e++){let f=a.child(e);f.content.size&&(f=f.copy(aQ(f.content,b,f))),f.isInline&&(f=b(f,c,e)),d.push(f)}return O.fromArray(d)}class aR extends aO{constructor(a,b,c){super(),this.from=a,this.to=b,this.mark=c}apply(a){let b=a.slice(this.from,this.to),c=a.resolve(this.from),d=c.node(c.sharedDepth(this.to)),e=new U(aQ(b.content,(a,b)=>a.isAtom&&b.type.allowsMarkType(this.mark.type)?a.mark(this.mark.addToSet(a.marks)):a,d),b.openStart,b.openEnd);return aP.fromReplace(a,this.from,this.to,e)}invert(){return new aS(this.from,this.to,this.mark)}map(a){let b=a.mapResult(this.from,1),c=a.mapResult(this.to,-1);return b.deleted&&c.deleted||b.pos>=c.pos?null:new aR(b.pos,c.pos,this.mark)}merge(a){return a instanceof aR&&a.mark.eq(this.mark)&&this.from<=a.to&&this.to>=a.from?new aR(Math.min(this.from,a.from),Math.max(this.to,a.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(a,b){if("number"!=typeof b.from||"number"!=typeof b.to)throw RangeError("Invalid input for AddMarkStep.fromJSON");return new aR(b.from,b.to,a.markFromJSON(b.mark))}}aO.jsonID("addMark",aR);class aS extends aO{constructor(a,b,c){super(),this.from=a,this.to=b,this.mark=c}apply(a){let b=a.slice(this.from,this.to),c=new U(aQ(b.content,a=>a.mark(this.mark.removeFromSet(a.marks)),a),b.openStart,b.openEnd);return aP.fromReplace(a,this.from,this.to,c)}invert(){return new aR(this.from,this.to,this.mark)}map(a){let b=a.mapResult(this.from,1),c=a.mapResult(this.to,-1);return b.deleted&&c.deleted||b.pos>=c.pos?null:new aS(b.pos,c.pos,this.mark)}merge(a){return a instanceof aS&&a.mark.eq(this.mark)&&this.from<=a.to&&this.to>=a.from?new aS(Math.min(this.from,a.from),Math.max(this.to,a.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(a,b){if("number"!=typeof b.from||"number"!=typeof b.to)throw RangeError("Invalid input for RemoveMarkStep.fromJSON");return new aS(b.from,b.to,a.markFromJSON(b.mark))}}aO.jsonID("removeMark",aS);class aT extends aO{constructor(a,b){super(),this.pos=a,this.mark=b}apply(a){let b=a.nodeAt(this.pos);if(!b)return aP.fail("No node at mark step's position");let c=b.type.create(b.attrs,null,this.mark.addToSet(b.marks));return aP.fromReplace(a,this.pos,this.pos+1,new U(O.from(c),0,+!b.isLeaf))}invert(a){let b=a.nodeAt(this.pos);if(b){let a=this.mark.addToSet(b.marks);if(a.length==b.marks.length){for(let c=0;c<b.marks.length;c++)if(!b.marks[c].isInSet(a))return new aT(this.pos,b.marks[c]);return new aT(this.pos,this.mark)}}return new aU(this.pos,this.mark)}map(a){let b=a.mapResult(this.pos,1);return b.deletedAfter?null:new aT(b.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(a,b){if("number"!=typeof b.pos)throw RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new aT(b.pos,a.markFromJSON(b.mark))}}aO.jsonID("addNodeMark",aT);class aU extends aO{constructor(a,b){super(),this.pos=a,this.mark=b}apply(a){let b=a.nodeAt(this.pos);if(!b)return aP.fail("No node at mark step's position");let c=b.type.create(b.attrs,null,this.mark.removeFromSet(b.marks));return aP.fromReplace(a,this.pos,this.pos+1,new U(O.from(c),0,+!b.isLeaf))}invert(a){let b=a.nodeAt(this.pos);return b&&this.mark.isInSet(b.marks)?new aT(this.pos,this.mark):this}map(a){let b=a.mapResult(this.pos,1);return b.deletedAfter?null:new aU(b.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(a,b){if("number"!=typeof b.pos)throw RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new aU(b.pos,a.markFromJSON(b.mark))}}aO.jsonID("removeNodeMark",aU);class aV extends aO{constructor(a,b,c,d=!1){super(),this.from=a,this.to=b,this.slice=c,this.structure=d}apply(a){return this.structure&&aX(a,this.from,this.to)?aP.fail("Structure replace would overwrite content"):aP.fromReplace(a,this.from,this.to,this.slice)}getMap(){return new aL([this.from,this.to-this.from,this.slice.size])}invert(a){return new aV(this.from,this.from+this.slice.size,a.slice(this.from,this.to))}map(a){let b=a.mapResult(this.from,1),c=a.mapResult(this.to,-1);return b.deletedAcross&&c.deletedAcross?null:new aV(b.pos,Math.max(b.pos,c.pos),this.slice,this.structure)}merge(a){if(!(a instanceof aV)||a.structure||this.structure)return null;if(this.from+this.slice.size!=a.from||this.slice.openEnd||a.slice.openStart)if(a.to!=this.from||this.slice.openStart||a.slice.openEnd)return null;else{let b=this.slice.size+a.slice.size==0?U.empty:new U(a.slice.content.append(this.slice.content),a.slice.openStart,this.slice.openEnd);return new aV(a.from,this.to,b,this.structure)}{let b=this.slice.size+a.slice.size==0?U.empty:new U(this.slice.content.append(a.slice.content),this.slice.openStart,a.slice.openEnd);return new aV(this.from,this.to+(a.to-a.from),b,this.structure)}}toJSON(){let a={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(a.slice=this.slice.toJSON()),this.structure&&(a.structure=!0),a}static fromJSON(a,b){if("number"!=typeof b.from||"number"!=typeof b.to)throw RangeError("Invalid input for ReplaceStep.fromJSON");return new aV(b.from,b.to,U.fromJSON(a,b.slice),!!b.structure)}}aO.jsonID("replace",aV);class aW extends aO{constructor(a,b,c,d,e,f,g=!1){super(),this.from=a,this.to=b,this.gapFrom=c,this.gapTo=d,this.slice=e,this.insert=f,this.structure=g}apply(a){if(this.structure&&(aX(a,this.from,this.gapFrom)||aX(a,this.gapTo,this.to)))return aP.fail("Structure gap-replace would overwrite content");let b=a.slice(this.gapFrom,this.gapTo);if(b.openStart||b.openEnd)return aP.fail("Gap is not a flat range");let c=this.slice.insertAt(this.insert,b.content);return c?aP.fromReplace(a,this.from,this.to,c):aP.fail("Content does not fit in gap")}getMap(){return new aL([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(a){let b=this.gapTo-this.gapFrom;return new aW(this.from,this.from+this.slice.size+b,this.from+this.insert,this.from+this.insert+b,a.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(a){let b=a.mapResult(this.from,1),c=a.mapResult(this.to,-1),d=this.from==this.gapFrom?b.pos:a.map(this.gapFrom,-1),e=this.to==this.gapTo?c.pos:a.map(this.gapTo,1);return b.deletedAcross&&c.deletedAcross||d<b.pos||e>c.pos?null:new aW(b.pos,c.pos,d,e,this.slice,this.insert,this.structure)}toJSON(){let a={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(a.slice=this.slice.toJSON()),this.structure&&(a.structure=!0),a}static fromJSON(a,b){if("number"!=typeof b.from||"number"!=typeof b.to||"number"!=typeof b.gapFrom||"number"!=typeof b.gapTo||"number"!=typeof b.insert)throw RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new aW(b.from,b.to,b.gapFrom,b.gapTo,U.fromJSON(a,b.slice),b.insert,!!b.structure)}}function aX(a,b,c){let d=a.resolve(b),e=c-b,f=d.depth;for(;e>0&&f>0&&d.indexAfter(f)==d.node(f).childCount;)f--,e--;if(e>0){let a=d.node(f).maybeChild(d.indexAfter(f));for(;e>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,e--}}return!1}function aY(a,b,c,d=c.contentMatch,e=!0){let f=a.doc.nodeAt(b),g=[],h=b+1;for(let b=0;b<f.childCount;b++){let i=f.child(b),j=h+i.nodeSize,k=d.matchType(i.type);if(k){d=k;for(let b=0;b<i.marks.length;b++)c.allowsMarkType(i.marks[b].type)||a.step(new aS(h,j,i.marks[b]));if(e&&i.isText&&"pre"!=c.whitespace){let a,b=/\r?\n|\r/g,d;for(;a=b.exec(i.text);)d||(d=new U(O.from(c.schema.text(" ",c.allowedMarks(i.marks))),0,0)),g.push(new aV(h+a.index,h+a.index+a[0].length,d))}}else g.push(new aV(h,j,U.empty));h=j}if(!d.validEnd){let b=d.fillBefore(O.empty,!0);a.replace(h,h,new U(b,0,0))}for(let b=g.length-1;b>=0;b--)a.step(g[b])}function aZ(a){let b=a.parent.content.cutByIndex(a.startIndex,a.endIndex);for(let c=a.depth,d=0,e=0;;--c){let f=a.$from.node(c),g=a.$from.index(c)+d,h=a.$to.indexAfter(c)-e;if(c<a.depth&&f.canReplace(g,h,b))return c;if(0==c||f.type.spec.isolating||!((0==g||f.canReplace(g,f.childCount))&&(h==f.childCount||f.canReplace(0,h))))break;g&&(d=1),h<f.childCount&&(e=1)}return null}function a$(a,b,c=null,d=a){let e=function(a,b){let{parent:c,startIndex:d,endIndex:e}=a,f=c.contentMatchAt(d).findWrapping(b);if(!f)return null;let g=f.length?f[0]:b;return c.canReplaceWith(d,e,g)?f:null}(a,b),f=e&&function(a,b){let{parent:c,startIndex:d,endIndex:e}=a,f=c.child(d),g=b.contentMatch.findWrapping(f.type);if(!g)return null;let h=(g.length?g[g.length-1]:b).contentMatch;for(let a=d;h&&a<e;a++)h=h.matchType(c.child(a).type);return h&&h.validEnd?g:null}(d,b);return f?e.map(a_).concat({type:b,attrs:c}).concat(f.map(a_)):null}function a_(a){return{type:a,attrs:null}}function a0(a,b,c,d){b.forEach((e,f)=>{if(e.isText){let g,h=/\r?\n|\r/g;for(;g=h.exec(e.text);){let e=a.mapping.slice(d).map(c+1+f+g.index);a.replaceWith(e,e+1,b.type.schema.linebreakReplacement.create())}}})}function a1(a,b,c,d){b.forEach((e,f)=>{if(e.type==e.type.schema.linebreakReplacement){let e=a.mapping.slice(d).map(c+1+f);a.replaceWith(e,e+1,b.type.schema.text("\n"))}})}function a2(a,b,c=1,d){let e=a.resolve(b),f=e.depth-c,g=d&&d[d.length-1]||e.parent;if(f<0||e.parent.type.spec.isolating||!e.parent.canReplace(e.index(),e.parent.childCount)||!g.type.validContent(e.parent.content.cutByIndex(e.index(),e.parent.childCount)))return!1;for(let a=e.depth-1,b=c-2;a>f;a--,b--){let c=e.node(a),f=e.index(a);if(c.type.spec.isolating)return!1;let g=c.content.cutByIndex(f,c.childCount),h=d&&d[b+1];h&&(g=g.replaceChild(0,h.type.create(h.attrs)));let i=d&&d[b]||c;if(!c.canReplace(f+1,c.childCount)||!i.type.validContent(g))return!1}let h=e.indexAfter(f),i=d&&d[0];return e.node(f).canReplaceWith(h,h,i?i.type:e.node(f+1).type)}function a3(a,b){let c=a.resolve(b),d=c.index();return a4(c.nodeBefore,c.nodeAfter)&&c.parent.canReplace(d,d+1)}function a4(a,b){return!!(a&&b&&!a.isLeaf&&function(a,b){b.content.size||a.type.compatibleContent(b.type);let c=a.contentMatchAt(a.childCount),{linebreakReplacement:d}=a.type.schema;for(let e=0;e<b.childCount;e++){let f=b.child(e),g=f.type==d?a.type.schema.nodes.text:f.type;if(!(c=c.matchType(g))||!a.type.allowsMarks(f.marks))return!1}return c.validEnd}(a,b))}function a5(a,b,c=-1){let d=a.resolve(b);for(let a=d.depth;;a--){let e,f,g=d.index(a);if(a==d.depth?(e=d.nodeBefore,f=d.nodeAfter):c>0?(e=d.node(a+1),g++,f=d.node(a).maybeChild(g)):(e=d.node(a).maybeChild(g-1),f=d.node(a+1)),e&&!e.isTextblock&&a4(e,f)&&d.node(a).canReplace(g,g+1))return b;if(0==a)break;b=c<0?d.before(a):d.after(a)}}function a6(a,b,c){let d=a.resolve(b);if(!c.content.size)return b;let e=c.content;for(let a=0;a<c.openStart;a++)e=e.firstChild.content;for(let a=1;a<=(0==c.openStart&&c.size?2:1);a++)for(let b=d.depth;b>=0;b--){let c=b==d.depth?0:d.pos<=(d.start(b+1)+d.end(b+1))/2?-1:1,f=d.index(b)+ +(c>0),g=d.node(b),h=!1;if(1==a)h=g.canReplace(f,f,e);else{let a=g.contentMatchAt(f).findWrapping(e.firstChild.type);h=a&&g.canReplaceWith(f,f,a[0])}if(h)return 0==c?d.pos:c<0?d.before(b+1):d.after(b+1)}return null}function a7(a,b,c=b,d=U.empty){if(b==c&&!d.size)return null;let e=a.resolve(b),f=a.resolve(c);return a8(e,f,d)?new aV(b,c,d):new a9(e,f,d).fit()}function a8(a,b,c){return!c.openStart&&!c.openEnd&&a.start()==b.start()&&a.parent.canReplace(a.index(),b.index(),c.content)}aO.jsonID("replaceAround",aW);class a9{constructor(a,b,c){this.$from=a,this.$to=b,this.unplaced=c,this.frontier=[],this.placed=O.empty;for(let b=0;b<=a.depth;b++){let c=a.node(b);this.frontier.push({type:c.type,match:c.contentMatchAt(a.indexAfter(b))})}for(let b=a.depth;b>0;b--)this.placed=O.from(a.node(b).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let a=this.findFittable();a?this.placeNodes(a):this.openMore()||this.dropNode()}let a=this.mustMoveInline(),b=this.placed.size-this.depth-this.$from.depth,c=this.$from,d=this.close(a<0?this.$to:c.doc.resolve(a));if(!d)return null;let e=this.placed,f=c.depth,g=d.depth;for(;f&&g&&1==e.childCount;)e=e.firstChild.content,f--,g--;let h=new U(e,f,g);return a>-1?new aW(c.pos,a,this.$to.pos,this.$to.end(),h,b):h.size||c.pos!=this.$to.pos?new aV(c.pos,d.pos,h):null}findFittable(){let a=this.unplaced.openStart;for(let b=this.unplaced.content,c=0,d=this.unplaced.openEnd;c<a;c++){let e=b.firstChild;if(b.childCount>1&&(d=0),e.type.spec.isolating&&d<=c){a=c;break}b=e.content}for(let b=1;b<=2;b++)for(let c=1==b?a:this.unplaced.openStart;c>=0;c--){let a=null,d=(c?(a=bc(this.unplaced.content,c-1).firstChild).content:this.unplaced.content).firstChild;for(let e=this.depth;e>=0;e--){let{type:f,match:g}=this.frontier[e],h,i=null;if(1==b&&(d?g.matchType(d.type)||(i=g.fillBefore(O.from(d),!1)):a&&f.compatibleContent(a.type)))return{sliceDepth:c,frontierDepth:e,parent:a,inject:i};if(2==b&&d&&(h=g.findWrapping(d.type)))return{sliceDepth:c,frontierDepth:e,parent:a,wrap:h};if(a&&g.matchType(a.type))break}}}openMore(){let{content:a,openStart:b,openEnd:c}=this.unplaced,d=bc(a,b);return!!d.childCount&&!d.firstChild.isLeaf&&(this.unplaced=new U(a,b+1,Math.max(c,d.size+b>=a.size-c?b+1:0)),!0)}dropNode(){let{content:a,openStart:b,openEnd:c}=this.unplaced,d=bc(a,b);if(d.childCount<=1&&b>0){let e=a.size-b<=b+d.size;this.unplaced=new U(ba(a,b-1,1),b-1,e?b-1:c)}else this.unplaced=new U(ba(a,b,1),b,c)}placeNodes({sliceDepth:a,frontierDepth:b,parent:c,inject:d,wrap:e}){for(;this.depth>b;)this.closeFrontierNode();if(e)for(let a=0;a<e.length;a++)this.openFrontierNode(e[a]);let f=this.unplaced,g=c?c.content:f.content,h=f.openStart-a,i=0,j=[],{match:k,type:l}=this.frontier[b];if(d){for(let a=0;a<d.childCount;a++)j.push(d.child(a));k=k.matchFragment(d)}let m=g.size+a-(f.content.size-f.openEnd);for(;i<g.childCount;){let a=g.child(i),b=k.matchType(a.type);if(!b)break;(++i>1||0==h||a.content.size)&&(k=b,j.push(function a(b,c,d){if(c<=0)return b;let e=b.content;return c>1&&(e=e.replaceChild(0,a(e.firstChild,c-1,1==e.childCount?d-1:0))),c>0&&(e=b.type.contentMatch.fillBefore(e).append(e),d<=0&&(e=e.append(b.type.contentMatch.matchFragment(e).fillBefore(O.empty,!0)))),b.copy(e)}(a.mark(l.allowedMarks(a.marks)),1==i?h:0,i==g.childCount?m:-1)))}let n=i==g.childCount;n||(m=-1),this.placed=bb(this.placed,b,O.from(j)),this.frontier[b].match=k,n&&m<0&&c&&c.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let a=0,b=g;a<m;a++){let a=b.lastChild;this.frontier.push({type:a.type,match:a.contentMatchAt(a.childCount)}),b=a.content}this.unplaced=n?0==a?U.empty:new U(ba(f.content,a-1,1),a-1,m<0?f.openEnd:a-1):new U(ba(f.content,a,i),f.openStart,f.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return -1;let a=this.frontier[this.depth],b;if(!a.type.isTextblock||!bd(this.$to,this.$to.depth,a.type,a.match,!1)||this.$to.depth==this.depth&&(b=this.findCloseLevel(this.$to))&&b.depth==this.depth)return -1;let{depth:c}=this.$to,d=this.$to.after(c);for(;c>1&&d==this.$to.end(--c);)++d;return d}findCloseLevel(a){b:for(let b=Math.min(this.depth,a.depth);b>=0;b--){let{match:c,type:d}=this.frontier[b],e=b<a.depth&&a.end(b+1)==a.pos+(a.depth-(b+1)),f=bd(a,b,d,c,e);if(f){for(let c=b-1;c>=0;c--){let{match:b,type:d}=this.frontier[c],e=bd(a,c,d,b,!0);if(!e||e.childCount)continue b}return{depth:b,fit:f,move:e?a.doc.resolve(a.after(b+1)):a}}}}close(a){let b=this.findCloseLevel(a);if(!b)return null;for(;this.depth>b.depth;)this.closeFrontierNode();b.fit.childCount&&(this.placed=bb(this.placed,b.depth,b.fit)),a=b.move;for(let c=b.depth+1;c<=a.depth;c++){let b=a.node(c),d=b.type.contentMatch.fillBefore(b.content,!0,a.index(c));this.openFrontierNode(b.type,b.attrs,d)}return a}openFrontierNode(a,b=null,c){let d=this.frontier[this.depth];d.match=d.match.matchType(a),this.placed=bb(this.placed,this.depth,O.from(a.create(b,c))),this.frontier.push({type:a,match:a.contentMatch})}closeFrontierNode(){let a=this.frontier.pop().match.fillBefore(O.empty,!0);a.childCount&&(this.placed=bb(this.placed,this.frontier.length,a))}}function ba(a,b,c){return 0==b?a.cutByIndex(c,a.childCount):a.replaceChild(0,a.firstChild.copy(ba(a.firstChild.content,b-1,c)))}function bb(a,b,c){return 0==b?a.append(c):a.replaceChild(a.childCount-1,a.lastChild.copy(bb(a.lastChild.content,b-1,c)))}function bc(a,b){for(let c=0;c<b;c++)a=a.firstChild.content;return a}function bd(a,b,c,d,e){let f=a.node(b),g=e?a.indexAfter(b):a.index(b);if(g==f.childCount&&!c.compatibleContent(f.type))return null;let h=d.fillBefore(f.content,!0,g);return h&&!function(a,b,c){for(let d=c;d<b.childCount;d++)if(!a.allowsMarks(b.child(d).marks))return!0;return!1}(c,f.content,g)?h:null}function be(a,b){let c=[],d=Math.min(a.depth,b.depth);for(let e=d;e>=0;e--){let d=a.start(e);if(d<a.pos-(a.depth-e)||b.end(e)>b.pos+(b.depth-e)||a.node(e).type.spec.isolating||b.node(e).type.spec.isolating)break;(d==b.start(e)||e==a.depth&&e==b.depth&&a.parent.inlineContent&&b.parent.inlineContent&&e&&b.start(e-1)==d-1)&&c.push(e)}return c}class bf extends aO{constructor(a,b,c){super(),this.pos=a,this.attr=b,this.value=c}apply(a){let b=a.nodeAt(this.pos);if(!b)return aP.fail("No node at attribute step's position");let c=Object.create(null);for(let a in b.attrs)c[a]=b.attrs[a];c[this.attr]=this.value;let d=b.type.create(c,null,b.marks);return aP.fromReplace(a,this.pos,this.pos+1,new U(O.from(d),0,+!b.isLeaf))}getMap(){return aL.empty}invert(a){return new bf(this.pos,this.attr,a.nodeAt(this.pos).attrs[this.attr])}map(a){let b=a.mapResult(this.pos,1);return b.deletedAfter?null:new bf(b.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(a,b){if("number"!=typeof b.pos||"string"!=typeof b.attr)throw RangeError("Invalid input for AttrStep.fromJSON");return new bf(b.pos,b.attr,b.value)}}aO.jsonID("attr",bf);class bg extends aO{constructor(a,b){super(),this.attr=a,this.value=b}apply(a){let b=Object.create(null);for(let c in a.attrs)b[c]=a.attrs[c];b[this.attr]=this.value;let c=a.type.create(b,a.content,a.marks);return aP.ok(c)}getMap(){return aL.empty}invert(a){return new bg(this.attr,a.attrs[this.attr])}map(a){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(a,b){if("string"!=typeof b.attr)throw RangeError("Invalid input for DocAttrStep.fromJSON");return new bg(b.attr,b.value)}}aO.jsonID("docAttr",bg);let bh=class extends Error{};(bh=function a(b){let c=Error.call(this,b);return c.__proto__=a.prototype,c}).prototype=Object.create(Error.prototype),bh.prototype.constructor=bh,bh.prototype.name="TransformError";class bi{constructor(a){this.doc=a,this.steps=[],this.docs=[],this.mapping=new aM}get before(){return this.docs.length?this.docs[0]:this.doc}step(a){let b=this.maybeStep(a);if(b.failed)throw new bh(b.failed);return this}maybeStep(a){let b=a.apply(this.doc);return b.failed||this.addStep(a,b.doc),b}get docChanged(){return this.steps.length>0}addStep(a,b){this.docs.push(this.doc),this.steps.push(a),this.mapping.appendMap(a.getMap()),this.doc=b}replace(a,b=a,c=U.empty){let d=a7(this.doc,a,b,c);return d&&this.step(d),this}replaceWith(a,b,c){return this.replace(a,b,new U(O.from(c),0,0))}delete(a,b){return this.replace(a,b,U.empty)}insert(a,b){return this.replaceWith(a,a,b)}replaceRange(a,b,c){return!function(a,b,c,d){if(!d.size)return a.deleteRange(b,c);let e=a.doc.resolve(b),f=a.doc.resolve(c);if(a8(e,f,d))return a.step(new aV(b,c,d));let g=be(e,f);0==g[g.length-1]&&g.pop();let h=-(e.depth+1);g.unshift(h);for(let a=e.depth,b=e.pos-1;a>0;a--,b--){let c=e.node(a).type.spec;if(c.defining||c.definingAsContext||c.isolating)break;g.indexOf(a)>-1?h=a:e.before(a)==b&&g.splice(1,0,-a)}let i=g.indexOf(h),j=[],k=d.openStart;for(let a=d.content,b=0;;b++){let c=a.firstChild;if(j.push(c),b==d.openStart)break;a=c.content}for(let a=k-1;a>=0;a--){var l;let b=j[a],c=(l=b.type).spec.defining||l.spec.definingForContent;if(c&&!b.sameMarkup(e.node(Math.abs(h)-1)))k=a;else if(c||!b.type.isTextblock)break}for(let b=d.openStart;b>=0;b--){let h=(b+k+1)%(d.openStart+1),l=j[h];if(l)for(let b=0;b<g.length;b++){let j=g[(b+i)%g.length],k=!0;j<0&&(k=!1,j=-j);let m=e.node(j-1),n=e.index(j-1);if(m.canReplaceWith(n,n,l.type,l.marks))return a.replace(e.before(j),k?f.after(j):c,new U(function a(b,c,d,e,f){if(c<d){let f=b.firstChild;b=b.replaceChild(0,f.copy(a(f.content,c+1,d,e,f)))}if(c>e){let a=f.contentMatchAt(0),c=a.fillBefore(b).append(b);b=c.append(a.matchFragment(c).fillBefore(O.empty,!0))}return b}(d.content,0,d.openStart,h),h,d.openEnd))}}let m=a.steps.length;for(let h=g.length-1;h>=0&&(a.replace(b,c,d),!(a.steps.length>m));h--){let a=g[h];a<0||(b=e.before(a),c=f.after(a))}}(this,a,b,c),this}replaceRangeWith(a,b,c){var d=a,e=b;if(!c.isInline&&d==e&&this.doc.resolve(d).parent.content.size){let a=function(a,b,c){let d=a.resolve(b);if(d.parent.canReplaceWith(d.index(),d.index(),c))return b;if(0==d.parentOffset)for(let a=d.depth-1;a>=0;a--){let b=d.index(a);if(d.node(a).canReplaceWith(b,b,c))return d.before(a+1);if(b>0)return null}if(d.parentOffset==d.parent.content.size)for(let a=d.depth-1;a>=0;a--){let b=d.indexAfter(a);if(d.node(a).canReplaceWith(b,b,c))return d.after(a+1);if(b<d.node(a).childCount)break}return null}(this.doc,d,c.type);null!=a&&(d=e=a)}return this.replaceRange(d,e,new U(O.from(c),0,0)),this}deleteRange(a,b){return!function(a,b,c){let d=a.doc.resolve(b),e=a.doc.resolve(c),f=be(d,e);for(let b=0;b<f.length;b++){let c=f[b],g=b==f.length-1;if(g&&0==c||d.node(c).type.contentMatch.validEnd)return a.delete(d.start(c),e.end(c));if(c>0&&(g||d.node(c-1).canReplace(d.index(c-1),e.indexAfter(c-1))))return a.delete(d.before(c),e.after(c))}for(let f=1;f<=d.depth&&f<=e.depth;f++)if(b-d.start(f)==d.depth-f&&c>d.end(f)&&e.end(f)-c!=e.depth-f&&d.start(f-1)==e.start(f-1)&&d.node(f-1).canReplace(d.index(f-1),e.index(f-1)))return a.delete(d.before(f),c);a.delete(b,c)}(this,a,b),this}lift(a,b){return!function(a,b,c){let{$from:d,$to:e,depth:f}=b,g=d.before(f+1),h=e.after(f+1),i=g,j=h,k=O.empty,l=0;for(let a=f,b=!1;a>c;a--)b||d.index(a)>0?(b=!0,k=O.from(d.node(a).copy(k)),l++):i--;let m=O.empty,n=0;for(let a=f,b=!1;a>c;a--)b||e.after(a+1)<e.end(a)?(b=!0,m=O.from(e.node(a).copy(m)),n++):j++;a.step(new aW(i,j,g,h,new U(k.append(m),l,n),k.size-l,!0))}(this,a,b),this}join(a,b=1){return!function(a,b,c){let d=null,{linebreakReplacement:e}=a.doc.type.schema,f=a.doc.resolve(b-c),g=f.node().type;if(e&&g.inlineContent){let a="pre"==g.whitespace,b=!!g.contentMatch.matchType(e);a&&!b?d=!1:!a&&b&&(d=!0)}let h=a.steps.length;if(!1===d){let d=a.doc.resolve(b+c);a1(a,d.node(),d.before(),h)}g.inlineContent&&aY(a,b+c-1,g,f.node().contentMatchAt(f.index()),null==d);let i=a.mapping.slice(h),j=i.map(b-c);if(a.step(new aV(j,i.map(b+c,-1),U.empty,!0)),!0===d){let b=a.doc.resolve(j);a0(a,b.node(),b.before(),a.steps.length)}}(this,a,b),this}wrap(a,b){return!function(a,b,c){let d=O.empty;for(let a=c.length-1;a>=0;a--){if(d.size){let b=c[a].type.contentMatch.matchFragment(d);if(!b||!b.validEnd)throw RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}d=O.from(c[a].type.create(c[a].attrs,d))}let e=b.start,f=b.end;a.step(new aW(e,f,e,f,new U(d,0,0),c.length,!0))}(this,a,b),this}setBlockType(a,b=a,c,d=null){var e=this;if(!c.isTextblock)throw RangeError("Type given to setBlockType should be a textblock");let f=e.steps.length;return e.doc.nodesBetween(a,b,(a,b)=>{var g,h,i;let j,k,l="function"==typeof d?d(a):d;if(a.isTextblock&&!a.hasMarkup(c,l)&&(g=e.doc,h=e.mapping.slice(f).map(b),i=c,k=(j=g.resolve(h)).index(),j.parent.canReplaceWith(k,k+1,i))){let d=null;if(c.schema.linebreakReplacement){let a="pre"==c.whitespace,b=!!c.contentMatch.matchType(c.schema.linebreakReplacement);a&&!b?d=!1:!a&&b&&(d=!0)}!1===d&&a1(e,a,b,f),aY(e,e.mapping.slice(f).map(b,1),c,void 0,null===d);let g=e.mapping.slice(f),h=g.map(b,1),i=g.map(b+a.nodeSize,1);return e.step(new aW(h,i,h+1,i-1,new U(O.from(c.create(l,null,a.marks)),0,0),1,!0)),!0===d&&a0(e,a,b,f),!1}}),this}setNodeMarkup(a,b,c=null,d){return!function(a,b,c,d,e){let f=a.doc.nodeAt(b);if(!f)throw RangeError("No node at given position");c||(c=f.type);let g=c.create(d,null,e||f.marks);if(f.isLeaf)return a.replaceWith(b,b+f.nodeSize,g);if(!c.validContent(f.content))throw RangeError("Invalid content for node type "+c.name);a.step(new aW(b,b+f.nodeSize,b+1,b+f.nodeSize-1,new U(O.from(g),0,0),1,!0))}(this,a,b,c,d),this}setNodeAttribute(a,b,c){return this.step(new bf(a,b,c)),this}setDocAttribute(a,b){return this.step(new bg(a,b)),this}addNodeMark(a,b){return this.step(new aT(a,b)),this}removeNodeMark(a,b){let c=this.doc.nodeAt(a);if(!c)throw RangeError("No node at position "+a);if(b instanceof S)b.isInSet(c.marks)&&this.step(new aU(a,b));else{let d=c.marks,e,f=[];for(;e=b.isInSet(d);)f.push(new aU(a,e)),d=e.removeFromSet(d);for(let a=f.length-1;a>=0;a--)this.step(f[a])}return this}split(a,b=1,c){return!function(a,b,c=1,d){let e=a.doc.resolve(b),f=O.empty,g=O.empty;for(let a=e.depth,b=e.depth-c,h=c-1;a>b;a--,h--){f=O.from(e.node(a).copy(f));let b=d&&d[h];g=O.from(b?b.type.create(b.attrs,g):e.node(a).copy(g))}a.step(new aV(b,b,new U(f.append(g),c,c),!0))}(this,a,b,c),this}addMark(a,b,c){var d;let e,f,g,h;return d=this,g=[],h=[],d.doc.nodesBetween(a,b,(d,i,j)=>{if(!d.isInline)return;let k=d.marks;if(!c.isInSet(k)&&j.type.allowsMarkType(c.type)){let j=Math.max(i,a),l=Math.min(i+d.nodeSize,b),m=c.addToSet(k);for(let a=0;a<k.length;a++)k[a].isInSet(m)||(e&&e.to==j&&e.mark.eq(k[a])?e.to=l:g.push(e=new aS(j,l,k[a])));f&&f.to==j?f.to=l:h.push(f=new aR(j,l,c))}}),g.forEach(a=>d.step(a)),h.forEach(a=>d.step(a)),this}removeMark(a,b,c){var d;let e,f;return d=this,e=[],f=0,d.doc.nodesBetween(a,b,(d,g)=>{if(!d.isInline)return;f++;let h=null;if(c instanceof at){let a=d.marks,b;for(;b=c.isInSet(a);)(h||(h=[])).push(b),a=b.removeFromSet(a)}else c?c.isInSet(d.marks)&&(h=[c]):h=d.marks;if(h&&h.length){let c=Math.min(g+d.nodeSize,b);for(let b=0;b<h.length;b++){let d=h[b],i;for(let a=0;a<e.length;a++){let b=e[a];b.step==f-1&&d.eq(e[a].style)&&(i=b)}i?(i.to=c,i.step=f):e.push({style:d,from:Math.max(g,a),to:c,step:f})}}}),e.forEach(a=>d.step(new aS(a.from,a.to,a.style))),this}clearIncompatible(a,b,c){return aY(this,a,b,c),this}}let bj=Object.create(null);class bk{constructor(a,b,c){this.$anchor=a,this.$head=b,this.ranges=c||[new bl(a.min(b),a.max(b))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let a=this.ranges;for(let b=0;b<a.length;b++)if(a[b].$from.pos!=a[b].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(a,b=U.empty){let c=b.content.lastChild,d=null;for(let a=0;a<b.openEnd;a++)d=c,c=c.lastChild;let e=a.steps.length,f=this.ranges;for(let g=0;g<f.length;g++){let{$from:h,$to:i}=f[g],j=a.mapping.slice(e);a.replaceRange(j.map(h.pos),j.map(i.pos),g?U.empty:b),0==g&&bv(a,e,(c?c.isInline:d&&d.isTextblock)?-1:1)}}replaceWith(a,b){let c=a.steps.length,d=this.ranges;for(let e=0;e<d.length;e++){let{$from:f,$to:g}=d[e],h=a.mapping.slice(c),i=h.map(f.pos),j=h.map(g.pos);e?a.deleteRange(i,j):(a.replaceRangeWith(i,j,b),bv(a,c,b.isInline?-1:1))}}static findFrom(a,b,c=!1){let d=a.parent.inlineContent?new bo(a):bu(a.node(0),a.parent,a.pos,a.index(),b,c);if(d)return d;for(let d=a.depth-1;d>=0;d--){let e=b<0?bu(a.node(0),a.node(d),a.before(d+1),a.index(d),b,c):bu(a.node(0),a.node(d),a.after(d+1),a.index(d)+1,b,c);if(e)return e}return null}static near(a,b=1){return this.findFrom(a,b)||this.findFrom(a,-b)||new bs(a.node(0))}static atStart(a){return bu(a,a,0,0,1)||new bs(a)}static atEnd(a){return bu(a,a,a.content.size,a.childCount,-1)||new bs(a)}static fromJSON(a,b){if(!b||!b.type)throw RangeError("Invalid input for Selection.fromJSON");let c=bj[b.type];if(!c)throw RangeError(`No selection type ${b.type} defined`);return c.fromJSON(a,b)}static jsonID(a,b){if(a in bj)throw RangeError("Duplicate use of selection JSON ID "+a);return bj[a]=b,b.prototype.jsonID=a,b}getBookmark(){return bo.between(this.$anchor,this.$head).getBookmark()}}bk.prototype.visible=!0;class bl{constructor(a,b){this.$from=a,this.$to=b}}let bm=!1;function bn(a){bm||a.parent.inlineContent||(bm=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+a.parent.type.name+")"))}class bo extends bk{constructor(a,b=a){bn(a),bn(b),super(a,b)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(a,b){let c=a.resolve(b.map(this.head));if(!c.parent.inlineContent)return bk.near(c);let d=a.resolve(b.map(this.anchor));return new bo(d.parent.inlineContent?d:c,c)}replace(a,b=U.empty){if(super.replace(a,b),b==U.empty){let b=this.$from.marksAcross(this.$to);b&&a.ensureMarks(b)}}eq(a){return a instanceof bo&&a.anchor==this.anchor&&a.head==this.head}getBookmark(){return new bp(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(a,b){if("number"!=typeof b.anchor||"number"!=typeof b.head)throw RangeError("Invalid input for TextSelection.fromJSON");return new bo(a.resolve(b.anchor),a.resolve(b.head))}static create(a,b,c=b){let d=a.resolve(b);return new this(d,c==b?d:a.resolve(c))}static between(a,b,c){let d=a.pos-b.pos;if((!c||d)&&(c=d>=0?1:-1),!b.parent.inlineContent){let a=bk.findFrom(b,c,!0)||bk.findFrom(b,-c,!0);if(!a)return bk.near(b,c);b=a.$head}return a.parent.inlineContent||(0==d?a=b:(a=(bk.findFrom(a,-c,!0)||bk.findFrom(a,c,!0)).$anchor).pos<b.pos!=d<0&&(a=b)),new bo(a,b)}}bk.jsonID("text",bo);class bp{constructor(a,b){this.anchor=a,this.head=b}map(a){return new bp(a.map(this.anchor),a.map(this.head))}resolve(a){return bo.between(a.resolve(this.anchor),a.resolve(this.head))}}class bq extends bk{constructor(a){let b=a.nodeAfter;super(a,a.node(0).resolve(a.pos+b.nodeSize)),this.node=b}map(a,b){let{deleted:c,pos:d}=b.mapResult(this.anchor),e=a.resolve(d);return c?bk.near(e):new bq(e)}content(){return new U(O.from(this.node),0,0)}eq(a){return a instanceof bq&&a.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new br(this.anchor)}static fromJSON(a,b){if("number"!=typeof b.anchor)throw RangeError("Invalid input for NodeSelection.fromJSON");return new bq(a.resolve(b.anchor))}static create(a,b){return new bq(a.resolve(b))}static isSelectable(a){return!a.isText&&!1!==a.type.spec.selectable}}bq.prototype.visible=!1,bk.jsonID("node",bq);class br{constructor(a){this.anchor=a}map(a){let{deleted:b,pos:c}=a.mapResult(this.anchor);return b?new bp(c,c):new br(c)}resolve(a){let b=a.resolve(this.anchor),c=b.nodeAfter;return c&&bq.isSelectable(c)?new bq(b):bk.near(b)}}class bs extends bk{constructor(a){super(a.resolve(0),a.resolve(a.content.size))}replace(a,b=U.empty){if(b==U.empty){a.delete(0,a.doc.content.size);let b=bk.atStart(a.doc);b.eq(a.selection)||a.setSelection(b)}else super.replace(a,b)}toJSON(){return{type:"all"}}static fromJSON(a){return new bs(a)}map(a){return new bs(a)}eq(a){return a instanceof bs}getBookmark(){return bt}}bk.jsonID("all",bs);let bt={map(){return this},resolve:a=>new bs(a)};function bu(a,b,c,d,e,f=!1){if(b.inlineContent)return bo.create(a,c);for(let g=d-(e>0?0:1);e>0?g<b.childCount:g>=0;g+=e){let d=b.child(g);if(d.isAtom){if(!f&&bq.isSelectable(d))return bq.create(a,c-(e<0?d.nodeSize:0))}else{let b=bu(a,d,c+e,e<0?d.childCount:0,e,f);if(b)return b}c+=d.nodeSize*e}return null}function bv(a,b,c){let d,e=a.steps.length-1;if(e<b)return;let f=a.steps[e];(f instanceof aV||f instanceof aW)&&(a.mapping.maps[e].forEach((a,b,c,e)=>{null==d&&(d=e)}),a.setSelection(bk.near(a.doc.resolve(d),c)))}class bw extends bi{constructor(a){super(a.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=a.selection,this.storedMarks=a.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(a){if(a.$from.doc!=this.doc)throw RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=a,this.curSelectionFor=this.steps.length,this.updated=(1|this.updated)&-3,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(a){return this.storedMarks=a,this.updated|=2,this}ensureMarks(a){return S.sameSet(this.storedMarks||this.selection.$from.marks(),a)||this.setStoredMarks(a),this}addStoredMark(a){return this.ensureMarks(a.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(a){return this.ensureMarks(a.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(a,b){super.addStep(a,b),this.updated=-3&this.updated,this.storedMarks=null}setTime(a){return this.time=a,this}replaceSelection(a){return this.selection.replace(this,a),this}replaceSelectionWith(a,b=!0){let c=this.selection;return b&&(a=a.mark(this.storedMarks||(c.empty?c.$from.marks():c.$from.marksAcross(c.$to)||S.none))),c.replaceWith(this,a),this}deleteSelection(){return this.selection.replace(this),this}insertText(a,b,c){let d=this.doc.type.schema;if(null==b)return a?this.replaceSelectionWith(d.text(a),!0):this.deleteSelection();{if(null==c&&(c=b),!a)return this.deleteRange(b,c);let e=this.storedMarks;if(!e){let a=this.doc.resolve(b);e=c==b?a.marks():a.marksAcross(this.doc.resolve(c))}return this.replaceRangeWith(b,c,d.text(a,e)),this.selection.empty||this.selection.to!=b+a.length||this.setSelection(bk.near(this.selection.$to)),this}}setMeta(a,b){return this.meta["string"==typeof a?a:a.key]=b,this}getMeta(a){return this.meta["string"==typeof a?a:a.key]}get isGeneric(){for(let a in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function bx(a,b){return b&&a?a.bind(b):a}class by{constructor(a,b,c){this.name=a,this.init=bx(b.init,c),this.apply=bx(b.apply,c)}}let bz=[new by("doc",{init:a=>a.doc||a.schema.topNodeType.createAndFill(),apply:a=>a.doc}),new by("selection",{init:(a,b)=>a.selection||bk.atStart(b.doc),apply:a=>a.selection}),new by("storedMarks",{init:a=>a.storedMarks||null,apply:(a,b,c,d)=>d.selection.$cursor?a.storedMarks:null}),new by("scrollToSelection",{init:()=>0,apply:(a,b)=>a.scrolledIntoView?b+1:b})];class bA{constructor(a,b){this.schema=a,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=bz.slice(),b&&b.forEach(a=>{if(this.pluginsByKey[a.key])throw RangeError("Adding different instances of a keyed plugin ("+a.key+")");this.plugins.push(a),this.pluginsByKey[a.key]=a,a.spec.state&&this.fields.push(new by(a.key,a.spec.state,a))})}}class bB{constructor(a){this.config=a}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(a){return this.applyTransaction(a).state}filterTransaction(a,b=-1){for(let c=0;c<this.config.plugins.length;c++)if(c!=b){let b=this.config.plugins[c];if(b.spec.filterTransaction&&!b.spec.filterTransaction.call(b,a,this))return!1}return!0}applyTransaction(a){if(!this.filterTransaction(a))return{state:this,transactions:[]};let b=[a],c=this.applyInner(a),d=null;for(;;){let e=!1;for(let f=0;f<this.config.plugins.length;f++){let g=this.config.plugins[f];if(g.spec.appendTransaction){let h=d?d[f].n:0,i=d?d[f].state:this,j=h<b.length&&g.spec.appendTransaction.call(g,h?b.slice(h):b,i,c);if(j&&c.filterTransaction(j,f)){if(j.setMeta("appendedTransaction",a),!d){d=[];for(let a=0;a<this.config.plugins.length;a++)d.push(a<f?{state:c,n:b.length}:{state:this,n:0})}b.push(j),c=c.applyInner(j),e=!0}d&&(d[f]={state:c,n:b.length})}}if(!e)return{state:c,transactions:b}}}applyInner(a){if(!a.before.eq(this.doc))throw RangeError("Applying a mismatched transaction");let b=new bB(this.config),c=this.config.fields;for(let d=0;d<c.length;d++){let e=c[d];b[e.name]=e.apply(a,this[e.name],this,b)}return b}get tr(){return new bw(this)}static create(a){let b=new bA(a.doc?a.doc.type.schema:a.schema,a.plugins),c=new bB(b);for(let d=0;d<b.fields.length;d++)c[b.fields[d].name]=b.fields[d].init(a,c);return c}reconfigure(a){let b=new bA(this.schema,a.plugins),c=b.fields,d=new bB(b);for(let b=0;b<c.length;b++){let e=c[b].name;d[e]=this.hasOwnProperty(e)?this[e]:c[b].init(a,d)}return d}toJSON(a){let b={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(b.storedMarks=this.storedMarks.map(a=>a.toJSON())),a&&"object"==typeof a)for(let c in a){if("doc"==c||"selection"==c)throw RangeError("The JSON fields `doc` and `selection` are reserved");let d=a[c],e=d.spec.state;e&&e.toJSON&&(b[c]=e.toJSON.call(d,this[d.key]))}return b}static fromJSON(a,b,c){if(!b)throw RangeError("Invalid input for EditorState.fromJSON");if(!a.schema)throw RangeError("Required config field 'schema' missing");let d=new bA(a.schema,a.plugins),e=new bB(d);return d.fields.forEach(d=>{if("doc"==d.name)e.doc=af.fromJSON(a.schema,b.doc);else if("selection"==d.name)e.selection=bk.fromJSON(e.doc,b.selection);else if("storedMarks"==d.name)b.storedMarks&&(e.storedMarks=b.storedMarks.map(a.schema.markFromJSON));else{if(c)for(let f in c){let g=c[f],h=g.spec.state;if(g.key==d.name&&h&&h.fromJSON&&Object.prototype.hasOwnProperty.call(b,f)){e[d.name]=h.fromJSON.call(g,a,b[f],e);return}}e[d.name]=d.init(a,e)}}),e}}class bC{constructor(a){this.spec=a,this.props={},a.props&&function a(b,c,d){for(let e in b){let f=b[e];f instanceof Function?f=f.bind(c):"handleDOMEvents"==e&&(f=a(f,c,{})),d[e]=f}return d}(a.props,this,this.props),this.key=a.key?a.key.key:bE("plugin")}getState(a){return a[this.key]}}let bD=Object.create(null);function bE(a){return a in bD?a+"$"+ ++bD[a]:(bD[a]=0,a+"$")}class bF{constructor(a="key"){this.key=bE(a)}get(a){return a.config.pluginsByKey[this.key]}getState(a){return a[this.key]}}let bG=(a,b)=>!a.selection.empty&&(b&&b(a.tr.deleteSelection().scrollIntoView()),!0);function bH(a,b){let{$cursor:c}=a.selection;return c&&(b?b.endOfTextblock("backward",a):!(c.parentOffset>0))?c:null}let bI=(a,b,c)=>{let d=bH(a,c);if(!d)return!1;let e=bM(d);if(!e){let c=d.blockRange(),e=c&&aZ(c);return null!=e&&(b&&b(a.tr.lift(c,e).scrollIntoView()),!0)}let f=e.nodeBefore;if(bW(a,e,b,-1))return!0;if(0==d.parent.content.size&&(bK(f,"end")||bq.isSelectable(f)))for(let c=d.depth;;c--){let g=a7(a.doc,d.before(c),d.after(c),U.empty);if(g&&g.slice.size<g.to-g.from){if(b){let c=a.tr.step(g);c.setSelection(bK(f,"end")?bk.findFrom(c.doc.resolve(c.mapping.map(e.pos,-1)),-1):bq.create(c.doc,e.pos-f.nodeSize)),b(c.scrollIntoView())}return!0}if(1==c||d.node(c-1).childCount>1)break}return!!f.isAtom&&e.depth==d.depth-1&&(b&&b(a.tr.delete(e.pos-f.nodeSize,e.pos).scrollIntoView()),!0)};function bJ(a,b,c){let d=b.nodeBefore,e=b.pos-1;for(;!d.isTextblock;e--){if(d.type.spec.isolating)return!1;let a=d.lastChild;if(!a)return!1;d=a}let f=b.nodeAfter,g=b.pos+1;for(;!f.isTextblock;g++){if(f.type.spec.isolating)return!1;let a=f.firstChild;if(!a)return!1;f=a}let h=a7(a.doc,e,g,U.empty);if(!h||h.from!=e||h instanceof aV&&h.slice.size>=g-e)return!1;if(c){let b=a.tr.step(h);b.setSelection(bo.create(b.doc,e)),c(b.scrollIntoView())}return!0}function bK(a,b,c=!1){for(let d=a;d;d="start"==b?d.firstChild:d.lastChild){if(d.isTextblock)return!0;if(c&&1!=d.childCount)break}return!1}let bL=(a,b,c)=>{let{$head:d,empty:e}=a.selection,f=d;if(!e)return!1;if(d.parent.isTextblock){if(c?!c.endOfTextblock("backward",a):d.parentOffset>0)return!1;f=bM(d)}let g=f&&f.nodeBefore;return!!g&&!!bq.isSelectable(g)&&(b&&b(a.tr.setSelection(bq.create(a.doc,f.pos-g.nodeSize)).scrollIntoView()),!0)};function bM(a){if(!a.parent.type.spec.isolating)for(let b=a.depth-1;b>=0;b--){if(a.index(b)>0)return a.doc.resolve(a.before(b+1));if(a.node(b).type.spec.isolating)break}return null}function bN(a,b){let{$cursor:c}=a.selection;return c&&(b?b.endOfTextblock("forward",a):!(c.parentOffset<c.parent.content.size))?c:null}let bO=(a,b,c)=>{let d=bN(a,c);if(!d)return!1;let e=bQ(d);if(!e)return!1;let f=e.nodeAfter;if(bW(a,e,b,1))return!0;if(0==d.parent.content.size&&(bK(f,"start")||bq.isSelectable(f))){let c=a7(a.doc,d.before(),d.after(),U.empty);if(c&&c.slice.size<c.to-c.from){if(b){let d=a.tr.step(c);d.setSelection(bK(f,"start")?bk.findFrom(d.doc.resolve(d.mapping.map(e.pos)),1):bq.create(d.doc,d.mapping.map(e.pos))),b(d.scrollIntoView())}return!0}}return!!f.isAtom&&e.depth==d.depth-1&&(b&&b(a.tr.delete(e.pos,e.pos+f.nodeSize).scrollIntoView()),!0)},bP=(a,b,c)=>{let{$head:d,empty:e}=a.selection,f=d;if(!e)return!1;if(d.parent.isTextblock){if(c?!c.endOfTextblock("forward",a):d.parentOffset<d.parent.content.size)return!1;f=bQ(d)}let g=f&&f.nodeAfter;return!!g&&!!bq.isSelectable(g)&&(b&&b(a.tr.setSelection(bq.create(a.doc,f.pos)).scrollIntoView()),!0)};function bQ(a){if(!a.parent.type.spec.isolating)for(let b=a.depth-1;b>=0;b--){let c=a.node(b);if(a.index(b)+1<c.childCount)return a.doc.resolve(a.after(b+1));if(c.type.spec.isolating)break}return null}let bR=(a,b)=>{let{$head:c,$anchor:d}=a.selection;return!!c.parent.type.spec.code&&!!c.sameParent(d)&&(b&&b(a.tr.insertText("\n").scrollIntoView()),!0)};function bS(a){for(let b=0;b<a.edgeCount;b++){let{type:c}=a.edge(b);if(c.isTextblock&&!c.hasRequiredAttrs())return c}return null}let bT=(a,b)=>{let{$head:c,$anchor:d}=a.selection;if(!c.parent.type.spec.code||!c.sameParent(d))return!1;let e=c.node(-1),f=c.indexAfter(-1),g=bS(e.contentMatchAt(f));if(!g||!e.canReplaceWith(f,f,g))return!1;if(b){let d=c.after(),e=a.tr.replaceWith(d,d,g.createAndFill());e.setSelection(bk.near(e.doc.resolve(d),1)),b(e.scrollIntoView())}return!0},bU=(a,b)=>{let c=a.selection,{$from:d,$to:e}=c;if(c instanceof bs||d.parent.inlineContent||e.parent.inlineContent)return!1;let f=bS(e.parent.contentMatchAt(e.indexAfter()));if(!f||!f.isTextblock)return!1;if(b){let c=(!d.parentOffset&&e.index()<e.parent.childCount?d:e).pos,g=a.tr.insert(c,f.createAndFill());g.setSelection(bo.create(g.doc,c+1)),b(g.scrollIntoView())}return!0},bV=(a,b)=>{let{$cursor:c}=a.selection;if(!c||c.parent.content.size)return!1;if(c.depth>1&&c.after()!=c.end(-1)){let d=c.before();if(a2(a.doc,d))return b&&b(a.tr.split(d).scrollIntoView()),!0}let d=c.blockRange(),e=d&&aZ(d);return null!=e&&(b&&b(a.tr.lift(d,e).scrollIntoView()),!0)};function bW(a,b,c,d){let e,f,g,h=b.nodeBefore,i=b.nodeAfter,j,k,l=h.type.spec.isolating||i.type.spec.isolating;if(!l&&(e=b.nodeBefore,f=b.nodeAfter,g=b.index(),e&&f&&e.type.compatibleContent(f.type)&&(!e.content.size&&b.parent.canReplace(g-1,g)?(c&&c(a.tr.delete(b.pos-e.nodeSize,b.pos).scrollIntoView()),!0):!!b.parent.canReplace(g,g+1)&&!!(f.isTextblock||a3(a.doc,b.pos))&&(c&&c(a.tr.join(b.pos).scrollIntoView()),!0))))return!0;let m=!l&&b.parent.canReplace(b.index(),b.index()+1);if(m&&(j=(k=h.contentMatchAt(h.childCount)).findWrapping(i.type))&&k.matchType(j[0]||i.type).validEnd){if(c){let d=b.pos+i.nodeSize,e=O.empty;for(let a=j.length-1;a>=0;a--)e=O.from(j[a].create(null,e));e=O.from(h.copy(e));let f=a.tr.step(new aW(b.pos-1,d,b.pos,d,new U(e,1,0),j.length,!0)),g=f.doc.resolve(d+2*j.length);g.nodeAfter&&g.nodeAfter.type==h.type&&a3(f.doc,g.pos)&&f.join(g.pos),c(f.scrollIntoView())}return!0}let n=i.type.spec.isolating||d>0&&l?null:bk.findFrom(b,1),o=n&&n.$from.blockRange(n.$to),p=o&&aZ(o);if(null!=p&&p>=b.depth)return c&&c(a.tr.lift(o,p).scrollIntoView()),!0;if(m&&bK(i,"start",!0)&&bK(h,"end")){let d=h,e=[];for(;e.push(d),!d.isTextblock;)d=d.lastChild;let f=i,g=1;for(;!f.isTextblock;f=f.firstChild)g++;if(d.canReplace(d.childCount,d.childCount,f.content)){if(c){let d=O.empty;for(let a=e.length-1;a>=0;a--)d=O.from(e[a].copy(d));c(a.tr.step(new aW(b.pos-e.length,b.pos+i.nodeSize,b.pos+g,b.pos+i.nodeSize-g,new U(d,e.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function bX(a){return function(b,c){let d=b.selection,e=a<0?d.$from:d.$to,f=e.depth;for(;e.node(f).isInline;){if(!f)return!1;f--}return!!e.node(f).isTextblock&&(c&&c(b.tr.setSelection(bo.create(b.doc,a<0?e.start(f):e.end(f)))),!0)}}let bY=bX(-1),bZ=bX(1);function b$(a,b=null){return function(c,d){let e=!1;for(let d=0;d<c.selection.ranges.length&&!e;d++){let{$from:{pos:f},$to:{pos:g}}=c.selection.ranges[d];c.doc.nodesBetween(f,g,(d,f)=>{if(e)return!1;if(!(!d.isTextblock||d.hasMarkup(a,b)))if(d.type==a)e=!0;else{let b=c.doc.resolve(f),d=b.index();e=b.parent.canReplaceWith(d,d+1,a)}})}if(!e)return!1;if(d){let e=c.tr;for(let d=0;d<c.selection.ranges.length;d++){let{$from:{pos:f},$to:{pos:g}}=c.selection.ranges[d];e.setBlockType(f,g,a,b)}d(e.scrollIntoView())}return!0}}function b_(...a){return function(b,c,d){for(let e=0;e<a.length;e++)if(a[e](b,c,d))return!0;return!1}}let b0=b_(bG,bI,bL),b1=b_(bG,bO,bP),b2={Enter:b_(bR,bU,bV,(a,b)=>{let{$from:c,$to:d}=a.selection;if(a.selection instanceof bq&&a.selection.node.isBlock)return!!c.parentOffset&&!!a2(a.doc,c.pos)&&(b&&b(a.tr.split(c.pos).scrollIntoView()),!0);if(!c.depth)return!1;let e=[],f,g,h=!1,i=!1;for(let a=c.depth;;a--){if(c.node(a).isBlock){let b;h=c.end(a)==c.pos+(c.depth-a),i=c.start(a)==c.pos-(c.depth-a),g=bS(c.node(a-1).contentMatchAt(c.indexAfter(a-1)));e.unshift(b||(h&&g?{type:g}:null)),f=a;break}if(1==a)return!1;e.unshift(null)}let j=a.tr;(a.selection instanceof bo||a.selection instanceof bs)&&j.deleteSelection();let k=j.mapping.map(c.pos),l=a2(j.doc,k,e.length,e);if(l||(e[0]=g?{type:g}:null,l=a2(j.doc,k,e.length,e)),!l)return!1;if(j.split(k,e.length,e),!h&&i&&c.node(f).type!=g){let a=j.mapping.map(c.before(f)),b=j.doc.resolve(a);g&&c.node(f-1).canReplaceWith(b.index(),b.index()+1,g)&&j.setNodeMarkup(j.mapping.map(c.before(f)),g)}return b&&b(j.scrollIntoView()),!0}),"Mod-Enter":bT,Backspace:b0,"Mod-Backspace":b0,"Shift-Backspace":b0,Delete:b1,"Mod-Delete":b1,"Mod-a":(a,b)=>(b&&b(a.tr.setSelection(new bs(a.doc))),!0)},b3={"Ctrl-h":b2.Backspace,"Alt-Backspace":b2["Mod-Backspace"],"Ctrl-d":b2.Delete,"Ctrl-Alt-Backspace":b2["Mod-Delete"],"Alt-Delete":b2["Mod-Delete"],"Alt-d":b2["Mod-Delete"],"Ctrl-a":bY,"Ctrl-e":bZ};for(let a in b2)b3[a]=b2[a];"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform();let b4=function(a){for(var b=0;;b++)if(!(a=a.previousSibling))return b},b5=function(a){let b=a.assignedSlot||a.parentNode;return b&&11==b.nodeType?b.host:b},b6=null,b7=function(a,b,c){let d=b6||(b6=document.createRange());return d.setEnd(a,null==c?a.nodeValue.length:c),d.setStart(a,b||0),d},b8=function(){b6=null},b9=function(a,b,c,d){return c&&(cb(a,b,c,d,-1)||cb(a,b,c,d,1))},ca=/^(img|br|input|textarea|hr)$/i;function cb(a,b,c,d,e){for(var f;;){if(a==c&&b==d)return!0;if(b==(e<0?0:cc(a))){let c=a.parentNode;if(!c||1!=c.nodeType||cd(a)||ca.test(a.nodeName)||"false"==a.contentEditable)return!1;b=b4(a)+(e<0?0:1),a=c}else{if(1!=a.nodeType)return!1;let c=a.childNodes[b+(e<0?-1:0)];if(1==c.nodeType&&"false"==c.contentEditable)if(null==(f=c.pmViewDesc)||!f.ignoreForSelection)return!1;else b+=e;else a=c,b=e<0?cc(a):0}}}function cc(a){return 3==a.nodeType?a.nodeValue.length:a.childNodes.length}function cd(a){let b;for(let c=a;c&&!(b=c.pmViewDesc);c=c.parentNode);return b&&b.node&&b.node.isBlock&&(b.dom==a||b.contentDOM==a)}let ce=function(a){return a.focusNode&&b9(a.focusNode,a.focusOffset,a.anchorNode,a.anchorOffset)};function cf(a,b){let c=document.createEvent("Event");return c.initEvent("keydown",!0,!0),c.keyCode=a,c.key=c.code=b,c}let cg="undefined"!=typeof navigator?navigator:null,ch="undefined"!=typeof document?document:null,ci=cg&&cg.userAgent||"",cj=/Edge\/(\d+)/.exec(ci),ck=/MSIE \d/.exec(ci),cl=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ci),cm=!!(ck||cl||cj),cn=ck?document.documentMode:cl?+cl[1]:cj?+cj[1]:0,co=!cm&&/gecko\/(\d+)/i.test(ci);co&&(/Firefox\/(\d+)/.exec(ci)||[0,0])[1];let cp=!cm&&/Chrome\/(\d+)/.exec(ci),cq=!!cp,cr=cp?+cp[1]:0,cs=!cm&&!!cg&&/Apple Computer/.test(cg.vendor),ct=cs&&(/Mobile\/\w+/.test(ci)||!!cg&&cg.maxTouchPoints>2),cu=ct||!!cg&&/Mac/.test(cg.platform),cv=!!cg&&/Win/.test(cg.platform),cw=/Android \d/.test(ci),cx=!!ch&&"webkitFontSmoothing"in ch.documentElement.style,cy=cx?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function cz(a,b){return"number"==typeof a?a:a[b]}function cA(a,b,c){let d=a.someProp("scrollThreshold")||0,e=a.someProp("scrollMargin")||5,f=a.dom.ownerDocument;for(let g=c||a.dom;g;){if(1!=g.nodeType){g=b5(g);continue}let a=g,c=a==f.body,h=c?function(a){let b=a.defaultView&&a.defaultView.visualViewport;return b?{left:0,right:b.width,top:0,bottom:b.height}:{left:0,right:a.documentElement.clientWidth,top:0,bottom:a.documentElement.clientHeight}}(f):function(a){let b=a.getBoundingClientRect(),c=b.width/a.offsetWidth||1,d=b.height/a.offsetHeight||1;return{left:b.left,right:b.left+a.clientWidth*c,top:b.top,bottom:b.top+a.clientHeight*d}}(a),i=0,j=0;if(b.top<h.top+cz(d,"top")?j=-(h.top-b.top+cz(e,"top")):b.bottom>h.bottom-cz(d,"bottom")&&(j=b.bottom-b.top>h.bottom-h.top?b.top+cz(e,"top")-h.top:b.bottom-h.bottom+cz(e,"bottom")),b.left<h.left+cz(d,"left")?i=-(h.left-b.left+cz(e,"left")):b.right>h.right-cz(d,"right")&&(i=b.right-h.right+cz(e,"right")),i||j)if(c)f.defaultView.scrollBy(i,j);else{let c=a.scrollLeft,d=a.scrollTop;j&&(a.scrollTop+=j),i&&(a.scrollLeft+=i);let e=a.scrollLeft-c,f=a.scrollTop-d;b={left:b.left-e,top:b.top-f,right:b.right-e,bottom:b.bottom-f}}let k=c?"fixed":getComputedStyle(g).position;if(/^(fixed|sticky)$/.test(k))break;g="absolute"==k?g.offsetParent:b5(g)}}function cB(a){let b=[],c=a.ownerDocument;for(let d=a;d&&(b.push({dom:d,top:d.scrollTop,left:d.scrollLeft}),a!=c);d=b5(d));return b}function cC(a,b){for(let c=0;c<a.length;c++){let{dom:d,top:e,left:f}=a[c];d.scrollTop!=e+b&&(d.scrollTop=e+b),d.scrollLeft!=f&&(d.scrollLeft=f)}}let cD=null;function cE(a,b){return a.left>=b.left-1&&a.left<=b.right+1&&a.top>=b.top-1&&a.top<=b.bottom+1}function cF(a){return a.top<a.bottom||a.left<a.right}function cG(a,b){let c=a.getClientRects();if(c.length){let a=c[b<0?0:c.length-1];if(cF(a))return a}return Array.prototype.find.call(c,cF)||a.getBoundingClientRect()}let cH=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function cI(a,b,c){let{node:d,offset:e,atom:f}=a.docView.domFromPos(b,c<0?-1:1),g=cx||co;if(3==d.nodeType)if(g&&(cH.test(d.nodeValue)||(c<0?!e:e==d.nodeValue.length))){let a=cG(b7(d,e,e),c);if(co&&e&&/\s/.test(d.nodeValue[e-1])&&e<d.nodeValue.length){let b=cG(b7(d,e-1,e-1),-1);if(b.top==a.top){let c=cG(b7(d,e,e+1),-1);if(c.top!=a.top)return cJ(c,c.left<b.left)}}return a}else{let a=e,b=e,f=c<0?1:-1;return c<0&&!e?(b++,f=-1):c>=0&&e==d.nodeValue.length?(a--,f=1):c<0?a--:b++,cJ(cG(b7(d,a,b),f),f<0)}if(!a.state.doc.resolve(b-(f||0)).parent.inlineContent){if(null==f&&e&&(c<0||e==cc(d))){let a=d.childNodes[e-1];if(1==a.nodeType)return cK(a.getBoundingClientRect(),!1)}if(null==f&&e<cc(d)){let a=d.childNodes[e];if(1==a.nodeType)return cK(a.getBoundingClientRect(),!0)}return cK(d.getBoundingClientRect(),c>=0)}if(null==f&&e&&(c<0||e==cc(d))){let a=d.childNodes[e-1],b=3==a.nodeType?b7(a,cc(a)-!g):1!=a.nodeType||"BR"==a.nodeName&&a.nextSibling?null:a;if(b)return cJ(cG(b,1),!1)}if(null==f&&e<cc(d)){let a=d.childNodes[e];for(;a.pmViewDesc&&a.pmViewDesc.ignoreForCoords;)a=a.nextSibling;let b=a?3==a.nodeType?b7(a,0,+!g):1==a.nodeType?a:null:null;if(b)return cJ(cG(b,-1),!0)}return cJ(cG(3==d.nodeType?b7(d):d,-c),c>=0)}function cJ(a,b){if(0==a.width)return a;let c=b?a.left:a.right;return{top:a.top,bottom:a.bottom,left:c,right:c}}function cK(a,b){if(0==a.height)return a;let c=b?a.top:a.bottom;return{top:c,bottom:c,left:a.left,right:a.right}}function cL(a,b,c){let d=a.state,e=a.root.activeElement;d!=b&&a.updateState(b),e!=a.dom&&a.focus();try{return c()}finally{d!=b&&a.updateState(d),e!=a.dom&&e&&e.focus()}}let cM=/[\u0590-\u08ac]/,cN=null,cO=null,cP=!1;class cQ{constructor(a,b,c,d){this.parent=a,this.children=b,this.dom=c,this.contentDOM=d,this.dirty=0,c.pmViewDesc=this}matchesWidget(a){return!1}matchesMark(a){return!1}matchesNode(a,b,c){return!1}matchesHack(a){return!1}parseRule(){return null}stopEvent(a){return!1}get size(){let a=0;for(let b=0;b<this.children.length;b++)a+=this.children[b].size;return a}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let a=0;a<this.children.length;a++)this.children[a].destroy()}posBeforeChild(a){for(let b=0,c=this.posAtStart;;b++){let d=this.children[b];if(d==a)return c;c+=d.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(a,b,c){let d;if(this.contentDOM&&this.contentDOM.contains(1==a.nodeType?a:a.parentNode))if(c<0){let c,d;if(a==this.contentDOM)c=a.childNodes[b-1];else{for(;a.parentNode!=this.contentDOM;)a=a.parentNode;c=a.previousSibling}for(;c&&!((d=c.pmViewDesc)&&d.parent==this);)c=c.previousSibling;return c?this.posBeforeChild(d)+d.size:this.posAtStart}else{let c,d;if(a==this.contentDOM)c=a.childNodes[b];else{for(;a.parentNode!=this.contentDOM;)a=a.parentNode;c=a.nextSibling}for(;c&&!((d=c.pmViewDesc)&&d.parent==this);)c=c.nextSibling;return c?this.posBeforeChild(d):this.posAtEnd}if(a==this.dom&&this.contentDOM)d=b>b4(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))d=2&a.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==b)for(let b=a;;b=b.parentNode){if(b==this.dom){d=!1;break}if(b.previousSibling)break}if(null==d&&b==a.childNodes.length)for(let b=a;;b=b.parentNode){if(b==this.dom){d=!0;break}if(b.nextSibling)break}}return(null==d?c>0:d)?this.posAtEnd:this.posAtStart}nearestDesc(a,b=!1){for(let c=!0,d=a;d;d=d.parentNode){let e=this.getDesc(d),f;if(e&&(!b||e.node))if(!c||!(f=e.nodeDOM)||(1==f.nodeType?f.contains(1==a.nodeType?a:a.parentNode):f==a))return e;else c=!1}}getDesc(a){let b=a.pmViewDesc;for(let a=b;a;a=a.parent)if(a==this)return b}posFromDOM(a,b,c){for(let d=a;d;d=d.parentNode){let e=this.getDesc(d);if(e)return e.localPosFromDOM(a,b,c)}return -1}descAt(a){for(let b=0,c=0;b<this.children.length;b++){let d=this.children[b],e=c+d.size;if(c==a&&e!=c){for(;!d.border&&d.children.length;)for(let a=0;a<d.children.length;a++){let b=d.children[a];if(b.size){d=b;break}}return d}if(a<e)return d.descAt(a-c-d.border);c=e}}domFromPos(a,b){if(!this.contentDOM)return{node:this.dom,offset:0,atom:a+1};let c=0,d=0;for(let b=0;c<this.children.length;c++){let e=this.children[c],f=b+e.size;if(f>a||e instanceof cX){d=a-b;break}b=f}if(d)return this.children[c].domFromPos(d-this.children[c].border,b);for(let a;c&&!(a=this.children[c-1]).size&&a instanceof cR&&a.side>=0;c--);if(b<=0){let a,d=!0;for(;(a=c?this.children[c-1]:null)&&a.dom.parentNode!=this.contentDOM;c--,d=!1);return a&&b&&d&&!a.border&&!a.domAtom?a.domFromPos(a.size,b):{node:this.contentDOM,offset:a?b4(a.dom)+1:0}}{let a,d=!0;for(;(a=c<this.children.length?this.children[c]:null)&&a.dom.parentNode!=this.contentDOM;c++,d=!1);return a&&d&&!a.border&&!a.domAtom?a.domFromPos(0,b):{node:this.contentDOM,offset:a?b4(a.dom):this.contentDOM.childNodes.length}}}parseRange(a,b,c=0){if(0==this.children.length)return{node:this.contentDOM,from:a,to:b,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let d=-1,e=-1;for(let f=c,g=0;;g++){let c=this.children[g],h=f+c.size;if(-1==d&&a<=h){let e=f+c.border;if(a>=e&&b<=h-c.border&&c.node&&c.contentDOM&&this.contentDOM.contains(c.contentDOM))return c.parseRange(a,b,e);a=f;for(let b=g;b>0;b--){let c=this.children[b-1];if(c.size&&c.dom.parentNode==this.contentDOM&&!c.emptyChildAt(1)){d=b4(c.dom)+1;break}a-=c.size}-1==d&&(d=0)}if(d>-1&&(h>b||g==this.children.length-1)){b=h;for(let a=g+1;a<this.children.length;a++){let c=this.children[a];if(c.size&&c.dom.parentNode==this.contentDOM&&!c.emptyChildAt(-1)){e=b4(c.dom);break}b+=c.size}-1==e&&(e=this.contentDOM.childNodes.length);break}f=h}return{node:this.contentDOM,from:a,to:b,fromOffset:d,toOffset:e}}emptyChildAt(a){if(this.border||!this.contentDOM||!this.children.length)return!1;let b=this.children[a<0?0:this.children.length-1];return 0==b.size||b.emptyChildAt(a)}domAfterPos(a){let{node:b,offset:c}=this.domFromPos(a,0);if(1!=b.nodeType||c==b.childNodes.length)throw RangeError("No node after pos "+a);return b.childNodes[c]}setSelection(a,b,c,d=!1){let e=Math.min(a,b),f=Math.max(a,b);for(let g=0,h=0;g<this.children.length;g++){let i=this.children[g],j=h+i.size;if(e>h&&f<j)return i.setSelection(a-h-i.border,b-h-i.border,c,d);h=j}let g=this.domFromPos(a,a?-1:1),h=b==a?g:this.domFromPos(b,b?-1:1),i=c.root.getSelection(),j=c.domSelectionRange(),k=!1;if((co||cs)&&a==b){let{node:a,offset:b}=g;if(3==a.nodeType){if((k=!!(b&&"\n"==a.nodeValue[b-1]))&&b==a.nodeValue.length)for(let b=a,c;b;b=b.parentNode){if(c=b.nextSibling){"BR"==c.nodeName&&(g=h={node:c.parentNode,offset:b4(c)+1});break}let a=b.pmViewDesc;if(a&&a.node&&a.node.isBlock)break}}else{let c=a.childNodes[b-1];k=c&&("BR"==c.nodeName||"false"==c.contentEditable)}}if(co&&j.focusNode&&j.focusNode!=h.node&&1==j.focusNode.nodeType){let a=j.focusNode.childNodes[j.focusOffset];a&&"false"==a.contentEditable&&(d=!0)}if(!(d||k&&cs)&&b9(g.node,g.offset,j.anchorNode,j.anchorOffset)&&b9(h.node,h.offset,j.focusNode,j.focusOffset))return;let l=!1;if((i.extend||a==b)&&!(k&&co)){i.collapse(g.node,g.offset);try{a!=b&&i.extend(h.node,h.offset),l=!0}catch(a){}}if(!l){if(a>b){let a=g;g=h,h=a}let c=document.createRange();c.setEnd(h.node,h.offset),c.setStart(g.node,g.offset),i.removeAllRanges(),i.addRange(c)}}ignoreMutation(a){return!this.contentDOM&&"selection"!=a.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(a,b){for(let c=0,d=0;d<this.children.length;d++){let e=this.children[d],f=c+e.size;if(c==f?a<=f&&b>=c:a<f&&b>c){let d=c+e.border,g=f-e.border;if(a>=d&&b<=g){this.dirty=a==c||b==f?2:1,a==d&&b==g&&(e.contentLost||e.dom.parentNode!=this.contentDOM)?e.dirty=3:e.markDirty(a-d,b-d);return}e.dirty=e.dom!=e.contentDOM||e.dom.parentNode!=this.contentDOM||e.children.length?3:2}c=f}this.dirty=2}markParentsDirty(){let a=1;for(let b=this.parent;b;b=b.parent,a++){let c=1==a?2:1;b.dirty<c&&(b.dirty=c)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(a){return!1}}class cR extends cQ{constructor(a,b,c,d){let e,f=b.type.toDOM;if("function"==typeof f&&(f=f(c,()=>e?e.parent?e.parent.posBeforeChild(e):void 0:d)),!b.type.spec.raw){if(1!=f.nodeType){let a=document.createElement("span");a.appendChild(f),f=a}f.contentEditable="false",f.classList.add("ProseMirror-widget")}super(a,[],f,null),this.widget=b,this.widget=b,e=this}matchesWidget(a){return 0==this.dirty&&a.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(a){let b=this.widget.spec.stopEvent;return!!b&&b(a)}ignoreMutation(a){return"selection"!=a.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class cS extends cQ{constructor(a,b,c,d){super(a,[],b,null),this.textDOM=c,this.text=d}get size(){return this.text.length}localPosFromDOM(a,b){return a!=this.textDOM?this.posAtStart+(b?this.size:0):this.posAtStart+b}domFromPos(a){return{node:this.textDOM,offset:a}}ignoreMutation(a){return"characterData"===a.type&&a.target.nodeValue==a.oldValue}}class cT extends cQ{constructor(a,b,c,d,e){super(a,[],c,d),this.mark=b,this.spec=e}static create(a,b,c,d){let e=d.nodeViews[b.type.name],f=e&&e(b,d,c);return f&&f.dom||(f=aF.renderSpec(document,b.type.spec.toDOM(b,c),null,b.attrs)),new cT(a,b,f.dom,f.contentDOM||f.dom,f)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(a){return 3!=this.dirty&&this.mark.eq(a)}markDirty(a,b){if(super.markDirty(a,b),0!=this.dirty){let a=this.parent;for(;!a.node;)a=a.parent;a.dirty<this.dirty&&(a.dirty=this.dirty),this.dirty=0}}slice(a,b,c){let d=cT.create(this.parent,this.mark,!0,c),e=this.children,f=this.size;b<f&&(e=c6(e,b,f,c)),a>0&&(e=c6(e,0,a,c));for(let a=0;a<e.length;a++)e[a].parent=d;return d.children=e,d}ignoreMutation(a){return this.spec.ignoreMutation?this.spec.ignoreMutation(a):super.ignoreMutation(a)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class cU extends cQ{constructor(a,b,c,d,e,f,g,h,i){super(a,[],e,f),this.node=b,this.outerDeco=c,this.innerDeco=d,this.nodeDOM=g}static create(a,b,c,d,e,f){let g=e.nodeViews[b.type.name],h,i=g&&g(b,e,()=>h?h.parent?h.parent.posBeforeChild(h):void 0:f,c,d),j=i&&i.dom,k=i&&i.contentDOM;if(b.isText)if(j){if(3!=j.nodeType)throw RangeError("Text must be rendered as a DOM text node")}else j=document.createTextNode(b.text);else if(!j){let a=aF.renderSpec(document,b.type.spec.toDOM(b),null,b.attrs);({dom:j,contentDOM:k}=a)}k||b.isText||"BR"==j.nodeName||(j.hasAttribute("contenteditable")||(j.contentEditable="false"),b.type.spec.draggable&&(j.draggable=!0));let l=j;return(j=c1(j,c,b),i)?h=new cY(a,b,c,d,j,k||null,l,i,e,f+1):b.isText?new cW(a,b,c,d,j,l,e):new cU(a,b,c,d,j,k||null,l,e,f+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let a={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(a.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let b=this.children.length-1;b>=0;b--){let c=this.children[b];if(this.dom.contains(c.dom.parentNode)){a.contentElement=c.dom.parentNode;break}}a.contentElement||(a.getContent=()=>O.empty)}else a.contentElement=this.contentDOM;else a.getContent=()=>this.node.content;return a}matchesNode(a,b,c){return 0==this.dirty&&a.eq(this.node)&&c2(b,this.outerDeco)&&c.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return+!this.node.isLeaf}updateChildren(a,b){let c=this.node.inlineContent,d=b,e=a.composing?this.localCompositionInfo(a,b):null,f=e&&e.pos>-1?e:null,g=e&&e.pos<0,h=new c4(this,f&&f.node,a);(function(a,b,c,d){let e=b.locals(a),f=0;if(0==e.length){for(let c=0;c<a.childCount;c++){let g=a.child(c);d(g,e,b.forChild(f,g),c),f+=g.nodeSize}return}let g=0,h=[],i=null;for(let j=0;;){let k,l,m,n;for(;g<e.length&&e[g].to==f;){let a=e[g++];a.widget&&(k?(l||(l=[k])).push(a):k=a)}if(k)if(l){l.sort(c5);for(let a=0;a<l.length;a++)c(l[a],j,!!i)}else c(k,j,!!i);if(i)n=-1,m=i,i=null;else if(j<a.childCount)n=j,m=a.child(j++);else break;for(let a=0;a<h.length;a++)h[a].to<=f&&h.splice(a--,1);for(;g<e.length&&e[g].from<=f&&e[g].to>f;)h.push(e[g++]);let o=f+m.nodeSize;if(m.isText){let a=o;g<e.length&&e[g].from<a&&(a=e[g].from);for(let b=0;b<h.length;b++)h[b].to<a&&(a=h[b].to);a<o&&(i=m.cut(a-f),m=m.cut(0,a-f),o=a,n=-1)}else for(;g<e.length&&e[g].to<o;)g++;let p=m.isInline&&!m.isLeaf?h.filter(a=>!a.inline):h.slice();d(m,p,b.forChild(f,m),n),f=o}})(this.node,this.innerDeco,(b,e,f)=>{b.spec.marks?h.syncToMarks(b.spec.marks,c,a):b.type.side>=0&&!f&&h.syncToMarks(e==this.node.childCount?S.none:this.node.child(e).marks,c,a),h.placeWidget(b,a,d)},(b,f,i,j)=>{let k;h.syncToMarks(b.marks,c,a),h.findNodeMatch(b,f,i,j)||g&&a.state.selection.from>d&&a.state.selection.to<d+b.nodeSize&&(k=h.findIndexWithChild(e.node))>-1&&h.updateNodeAt(b,f,i,k,a)||h.updateNextNode(b,f,i,a,j,d)||h.addNode(b,f,i,a,d),d+=b.nodeSize}),h.syncToMarks([],c,a),this.node.isTextblock&&h.addTextblockHacks(),h.destroyRest(),(h.changed||2==this.dirty)&&(f&&this.protectLocalComposition(a,f),function a(b,c,d){let e=b.firstChild,f=!1;for(let g=0;g<c.length;g++){let h=c[g],i=h.dom;if(i.parentNode==b){for(;i!=e;)e=c3(e),f=!0;e=e.nextSibling}else f=!0,b.insertBefore(i,e);if(h instanceof cT){let c=e?e.previousSibling:b.lastChild;a(h.contentDOM,h.children,d),e=c?c.nextSibling:b.firstChild}}for(;e;)e=c3(e),f=!0;f&&d.trackWrites==b&&(d.trackWrites=null)}(this.contentDOM,this.children,a),ct&&function(a){if("UL"==a.nodeName||"OL"==a.nodeName){let b=a.style.cssText;a.style.cssText=b+"; list-style: square !important",window.getComputedStyle(a).listStyle,a.style.cssText=b}}(this.dom))}localCompositionInfo(a,b){let{from:c,to:d}=a.state.selection;if(!(a.state.selection instanceof bo)||c<b||d>b+this.node.content.size)return null;let e=a.input.compositionNode;if(!e||!this.dom.contains(e.parentNode))return null;if(!this.node.inlineContent)return{node:e,pos:-1,text:""};{let a=e.nodeValue,f=function(a,b,c,d){for(let e=0,f=0;e<a.childCount&&f<=d;){let g=a.child(e++),h=f;if(f+=g.nodeSize,!g.isText)continue;let i=g.text;for(;e<a.childCount;){let b=a.child(e++);if(f+=b.nodeSize,!b.isText)break;i+=b.text}if(f>=c){if(f>=d&&i.slice(d-b.length-h,d-h)==b)return d-b.length;let a=h<d?i.lastIndexOf(b,d-h-1):-1;if(a>=0&&a+b.length+h>=c)return h+a;if(c==d&&i.length>=d+b.length-h&&i.slice(d-h,d-h+b.length)==b)return d}}return -1}(this.node.content,a,c-b,d-b);return f<0?null:{node:e,pos:f,text:a}}}protectLocalComposition(a,{node:b,pos:c,text:d}){if(this.getDesc(b))return;let e=b;for(;e.parentNode!=this.contentDOM;e=e.parentNode){for(;e.previousSibling;)e.parentNode.removeChild(e.previousSibling);for(;e.nextSibling;)e.parentNode.removeChild(e.nextSibling);e.pmViewDesc&&(e.pmViewDesc=void 0)}let f=new cS(this,e,b,d);a.input.compositionNodes.push(f),this.children=c6(this.children,c,c+d.length,a,f)}update(a,b,c,d){return 3!=this.dirty&&!!a.sameMarkup(this.node)&&(this.updateInner(a,b,c,d),!0)}updateInner(a,b,c,d){this.updateOuterDeco(b),this.node=a,this.innerDeco=c,this.contentDOM&&this.updateChildren(d,this.posAtStart),this.dirty=0}updateOuterDeco(a){if(c2(a,this.outerDeco))return;let b=1!=this.nodeDOM.nodeType,c=this.dom;this.dom=c0(this.dom,this.nodeDOM,c_(this.outerDeco,this.node,b),c_(a,this.node,b)),this.dom!=c&&(c.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=a}selectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function cV(a,b,c,d,e){c1(d,b,a);let f=new cU(void 0,a,b,c,d,d,d,e,0);return f.contentDOM&&f.updateChildren(e,0),f}class cW extends cU{constructor(a,b,c,d,e,f,g){super(a,b,c,d,e,null,f,g,0)}parseRule(){let a=this.nodeDOM.parentNode;for(;a&&a!=this.dom&&!a.pmIsDeco;)a=a.parentNode;return{skip:a||!0}}update(a,b,c,d){return 3!=this.dirty&&(0==this.dirty||!!this.inParent())&&!!a.sameMarkup(this.node)&&(this.updateOuterDeco(b),(0!=this.dirty||a.text!=this.node.text)&&a.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=a.text,d.trackWrites==this.nodeDOM&&(d.trackWrites=null)),this.node=a,this.dirty=0,!0)}inParent(){let a=this.parent.contentDOM;for(let b=this.nodeDOM;b;b=b.parentNode)if(b==a)return!0;return!1}domFromPos(a){return{node:this.nodeDOM,offset:a}}localPosFromDOM(a,b,c){return a==this.nodeDOM?this.posAtStart+Math.min(b,this.node.text.length):super.localPosFromDOM(a,b,c)}ignoreMutation(a){return"characterData"!=a.type&&"selection"!=a.type}slice(a,b,c){let d=this.node.cut(a,b),e=document.createTextNode(d.text);return new cW(this.parent,d,this.outerDeco,this.innerDeco,e,e,c)}markDirty(a,b){super.markDirty(a,b),this.dom!=this.nodeDOM&&(0==a||b==this.nodeDOM.nodeValue.length)&&(this.dirty=3)}get domAtom(){return!1}isText(a){return this.node.text==a}}class cX extends cQ{parseRule(){return{ignore:!0}}matchesHack(a){return 0==this.dirty&&this.dom.nodeName==a}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class cY extends cU{constructor(a,b,c,d,e,f,g,h,i,j){super(a,b,c,d,e,f,g,i,j),this.spec=h}update(a,b,c,d){if(3==this.dirty)return!1;if(this.spec.update&&(this.node.type==a.type||this.spec.multiType)){let e=this.spec.update(a,b,c);return e&&this.updateInner(a,b,c,d),e}return(!!this.contentDOM||!!a.isLeaf)&&super.update(a,b,c,d)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(a,b,c,d){this.spec.setSelection?this.spec.setSelection(a,b,c.root):super.setSelection(a,b,c,d)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(a){return!!this.spec.stopEvent&&this.spec.stopEvent(a)}ignoreMutation(a){return this.spec.ignoreMutation?this.spec.ignoreMutation(a):super.ignoreMutation(a)}}let cZ=function(a){a&&(this.nodeName=a)};cZ.prototype=Object.create(null);let c$=[new cZ];function c_(a,b,c){if(0==a.length)return c$;let d=c?c$[0]:new cZ,e=[d];for(let f=0;f<a.length;f++){let g=a[f].type.attrs;if(g)for(let a in g.nodeName&&e.push(d=new cZ(g.nodeName)),g){let f=g[a];null!=f&&(c&&1==e.length&&e.push(d=new cZ(b.isInline?"span":"div")),"class"==a?d.class=(d.class?d.class+" ":"")+f:"style"==a?d.style=(d.style?d.style+";":"")+f:"nodeName"!=a&&(d[a]=f))}}return e}function c0(a,b,c,d){if(c==c$&&d==c$)return b;let e=b;for(let b=0;b<d.length;b++){let f=d[b],g=c[b];if(b){let b;g&&g.nodeName==f.nodeName&&e!=a&&(b=e.parentNode)&&b.nodeName.toLowerCase()==f.nodeName||((b=document.createElement(f.nodeName)).pmIsDeco=!0,b.appendChild(e),g=c$[0]),e=b}!function(a,b,c){for(let d in b)"class"==d||"style"==d||"nodeName"==d||d in c||a.removeAttribute(d);for(let d in c)"class"!=d&&"style"!=d&&"nodeName"!=d&&c[d]!=b[d]&&a.setAttribute(d,c[d]);if(b.class!=c.class){let d=b.class?b.class.split(" ").filter(Boolean):[],e=c.class?c.class.split(" ").filter(Boolean):[];for(let b=0;b<d.length;b++)-1==e.indexOf(d[b])&&a.classList.remove(d[b]);for(let b=0;b<e.length;b++)-1==d.indexOf(e[b])&&a.classList.add(e[b]);0==a.classList.length&&a.removeAttribute("class")}if(b.style!=c.style){if(b.style){let c=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,d;for(;d=c.exec(b.style);)a.style.removeProperty(d[1])}c.style&&(a.style.cssText+=c.style)}}(e,g||c$[0],f)}return e}function c1(a,b,c){return c0(a,a,c$,c_(b,c,1!=a.nodeType))}function c2(a,b){if(a.length!=b.length)return!1;for(let c=0;c<a.length;c++)if(!a[c].type.eq(b[c].type))return!1;return!0}function c3(a){let b=a.nextSibling;return a.parentNode.removeChild(a),b}class c4{constructor(a,b,c){this.lock=b,this.view=c,this.index=0,this.stack=[],this.changed=!1,this.top=a,this.preMatch=function(a,b){let c=b,d=c.children.length,e=a.childCount,f=new Map,g=[];c:for(;e>0;){let h;for(;;)if(d){let a=c.children[d-1];if(a instanceof cT)c=a,d=a.children.length;else{h=a,d--;break}}else if(c==b)break c;else d=c.parent.children.indexOf(c),c=c.parent;let i=h.node;if(i){if(i!=a.child(e-1))break;--e,f.set(h,e),g.push(h)}}return{index:e,matched:f,matches:g.reverse()}}(a.node.content,a)}destroyBetween(a,b){if(a!=b){for(let c=a;c<b;c++)this.top.children[c].destroy();this.top.children.splice(a,b-a),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(a,b,c){let d=0,e=this.stack.length>>1,f=Math.min(e,a.length);for(;d<f&&(d==e-1?this.top:this.stack[d+1<<1]).matchesMark(a[d])&&!1!==a[d].type.spec.spanning;)d++;for(;d<e;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),e--;for(;e<a.length;){this.stack.push(this.top,this.index+1);let d=-1;for(let b=this.index;b<Math.min(this.index+3,this.top.children.length);b++){let c=this.top.children[b];if(c.matchesMark(a[e])&&!this.isLocked(c.dom)){d=b;break}}if(d>-1)d>this.index&&(this.changed=!0,this.destroyBetween(this.index,d)),this.top=this.top.children[this.index];else{let d=cT.create(this.top,a[e],b,c);this.top.children.splice(this.index,0,d),this.top=d,this.changed=!0}this.index=0,e++}}findNodeMatch(a,b,c,d){let e=-1,f;if(d>=this.preMatch.index&&(f=this.preMatch.matches[d-this.preMatch.index]).parent==this.top&&f.matchesNode(a,b,c))e=this.top.children.indexOf(f,this.index);else for(let d=this.index,f=Math.min(this.top.children.length,d+5);d<f;d++){let f=this.top.children[d];if(f.matchesNode(a,b,c)&&!this.preMatch.matched.has(f)){e=d;break}}return!(e<0)&&(this.destroyBetween(this.index,e),this.index++,!0)}updateNodeAt(a,b,c,d,e){let f=this.top.children[d];return 3==f.dirty&&f.dom==f.contentDOM&&(f.dirty=2),!!f.update(a,b,c,e)&&(this.destroyBetween(this.index,d),this.index++,!0)}findIndexWithChild(a){for(;;){let b=a.parentNode;if(!b)return -1;if(b==this.top.contentDOM){let b=a.pmViewDesc;if(b){for(let a=this.index;a<this.top.children.length;a++)if(this.top.children[a]==b)return a}return -1}a=b}}updateNextNode(a,b,c,d,e,f){for(let g=this.index;g<this.top.children.length;g++){let h=this.top.children[g];if(h instanceof cU){let i=this.preMatch.matched.get(h);if(null!=i&&i!=e)return!1;let j=h.dom,k,l=this.isLocked(j)&&!(a.isText&&h.node&&h.node.isText&&h.nodeDOM.nodeValue==a.text&&3!=h.dirty&&c2(b,h.outerDeco));if(!l&&h.update(a,b,c,d))return this.destroyBetween(this.index,g),h.dom!=j&&(this.changed=!0),this.index++,!0;if(!l&&(k=this.recreateWrapper(h,a,b,c,d,f)))return this.destroyBetween(this.index,g),this.top.children[this.index]=k,k.contentDOM&&(k.dirty=2,k.updateChildren(d,f+1),k.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(a,b,c,d,e,f){if(a.dirty||b.isAtom||!a.children.length||!a.node.content.eq(b.content)||!c2(c,a.outerDeco)||!d.eq(a.innerDeco))return null;let g=cU.create(this.top,b,c,d,e,f);if(g.contentDOM)for(let b of(g.children=a.children,a.children=[],g.children))b.parent=g;return a.destroy(),g}addNode(a,b,c,d,e){let f=cU.create(this.top,a,b,c,d,e);f.contentDOM&&f.updateChildren(d,e+1),this.top.children.splice(this.index++,0,f),this.changed=!0}placeWidget(a,b,c){let d=this.index<this.top.children.length?this.top.children[this.index]:null;if(d&&d.matchesWidget(a)&&(a==d.widget||!d.widget.type.toDOM.parentNode))this.index++;else{let d=new cR(this.top,a,b,c);this.top.children.splice(this.index++,0,d),this.changed=!0}}addTextblockHacks(){let a=this.top.children[this.index-1],b=this.top;for(;a instanceof cT;)a=(b=a).children[b.children.length-1];(!a||!(a instanceof cW)||/\n$/.test(a.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(a.node.text))&&((cs||cq)&&a&&"false"==a.dom.contentEditable&&this.addHackNode("IMG",b),this.addHackNode("BR",this.top))}addHackNode(a,b){if(b==this.top&&this.index<b.children.length&&b.children[this.index].matchesHack(a))this.index++;else{let c=document.createElement(a);"IMG"==a&&(c.className="ProseMirror-separator",c.alt=""),"BR"==a&&(c.className="ProseMirror-trailingBreak");let d=new cX(this.top,[],c,null);b!=this.top?b.children.push(d):b.children.splice(this.index++,0,d),this.changed=!0}}isLocked(a){return this.lock&&(a==this.lock||1==a.nodeType&&a.contains(this.lock.parentNode))}}function c5(a,b){return a.type.side-b.type.side}function c6(a,b,c,d,e){let f=[];for(let g=0,h=0;g<a.length;g++){let i=a[g],j=h,k=h+=i.size;j>=c||k<=b?f.push(i):(j<b&&f.push(i.slice(0,b-j,d)),e&&(f.push(e),e=void 0),k>c&&f.push(i.slice(c-j,i.size,d)))}return f}function c7(a,b=null){let c=a.domSelectionRange(),d=a.state.doc;if(!c.focusNode)return null;let e=a.docView.nearestDesc(c.focusNode),f=e&&0==e.size,g=a.docView.posFromDOM(c.focusNode,c.focusOffset,1);if(g<0)return null;let h=d.resolve(g),i,j;if(ce(c)){for(i=g;e&&!e.node;)e=e.parent;let a=e.node;if(e&&a.isAtom&&bq.isSelectable(a)&&e.parent&&!(a.isInline&&function(a,b,c){for(let d=0==b,e=b==cc(a);d||e;){if(a==c)return!0;let b=b4(a);if(!(a=a.parentNode))return!1;d=d&&0==b,e=e&&b==cc(a)}}(c.focusNode,c.focusOffset,e.dom))){let a=e.posBefore;j=new bq(g==a?h:d.resolve(a))}}else{if(c instanceof a.dom.ownerDocument.defaultView.Selection&&c.rangeCount>1){let b=g,e=g;for(let d=0;d<c.rangeCount;d++){let f=c.getRangeAt(d);b=Math.min(b,a.docView.posFromDOM(f.startContainer,f.startOffset,1)),e=Math.max(e,a.docView.posFromDOM(f.endContainer,f.endOffset,-1))}if(b<0)return null;[i,g]=e==a.state.selection.anchor?[e,b]:[b,e],h=d.resolve(g)}else i=a.docView.posFromDOM(c.anchorNode,c.anchorOffset,1);if(i<0)return null}let k=d.resolve(i);if(!j){let c="pointer"==b||a.state.selection.head<h.pos&&!f?1:-1;j=dg(a,k,h,c)}return j}function c8(a){return a.editable?a.hasFocus():di(a)&&document.activeElement&&document.activeElement.contains(a.dom)}function c9(a,b=!1){let c=a.state.selection;if(de(a,c),c8(a)){if(!b&&a.input.mouseDown&&a.input.mouseDown.allowDefault&&cq){let b=a.domSelectionRange(),c=a.domObserver.currentSelection;if(b.anchorNode&&c.anchorNode&&b9(b.anchorNode,b.anchorOffset,c.anchorNode,c.anchorOffset)){a.input.mouseDown.delayedSelectionSync=!0,a.domObserver.setCurSelection();return}}if(a.domObserver.disconnectSelection(),a.cursorWrapper)!function(a){let b=a.domSelection();if(!b)return;let c=a.cursorWrapper.dom,d="IMG"==c.nodeName;d?b.collapse(c.parentNode,b4(c)+1):b.collapse(c,0),!d&&!a.state.selection.visible&&cm&&cn<=11&&(c.disabled=!0,c.disabled=!1)}(a);else{var d;let e,f,g,h,{anchor:i,head:j}=c,k,l;da&&!(c instanceof bo)&&(c.$from.parent.inlineContent||(k=db(a,c.from)),c.empty||c.$from.parent.inlineContent||(l=db(a,c.to))),a.docView.setSelection(i,j,a,b),da&&(k&&dd(k),l&&dd(l)),c.visible?a.dom.classList.remove("ProseMirror-hideselection"):(a.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&((e=(d=a).dom.ownerDocument).removeEventListener("selectionchange",d.input.hideSelectionGuard),g=(f=d.domSelectionRange()).anchorNode,h=f.anchorOffset,e.addEventListener("selectionchange",d.input.hideSelectionGuard=()=>{(f.anchorNode!=g||f.anchorOffset!=h)&&(e.removeEventListener("selectionchange",d.input.hideSelectionGuard),setTimeout(()=>{(!c8(d)||d.state.selection.visible)&&d.dom.classList.remove("ProseMirror-hideselection")},20))})))}a.domObserver.setCurSelection(),a.domObserver.connectSelection()}}let da=cs||cq&&cr<63;function db(a,b){let{node:c,offset:d}=a.docView.domFromPos(b,0),e=d<c.childNodes.length?c.childNodes[d]:null,f=d?c.childNodes[d-1]:null;if(cs&&e&&"false"==e.contentEditable)return dc(e);if((!e||"false"==e.contentEditable)&&(!f||"false"==f.contentEditable)){if(e)return dc(e);else if(f)return dc(f)}}function dc(a){return a.contentEditable="true",cs&&a.draggable&&(a.draggable=!1,a.wasDraggable=!0),a}function dd(a){a.contentEditable="false",a.wasDraggable&&(a.draggable=!0,a.wasDraggable=null)}function de(a,b){if(b instanceof bq){let c=a.docView.descAt(b.from);c!=a.lastSelectedViewDesc&&(df(a),c&&c.selectNode(),a.lastSelectedViewDesc=c)}else df(a)}function df(a){a.lastSelectedViewDesc&&(a.lastSelectedViewDesc.parent&&a.lastSelectedViewDesc.deselectNode(),a.lastSelectedViewDesc=void 0)}function dg(a,b,c,d){return a.someProp("createSelectionBetween",d=>d(a,b,c))||bo.between(b,c,d)}function dh(a){return(!a.editable||!!a.hasFocus())&&di(a)}function di(a){let b=a.domSelectionRange();if(!b.anchorNode)return!1;try{return a.dom.contains(3==b.anchorNode.nodeType?b.anchorNode.parentNode:b.anchorNode)&&(a.editable||a.dom.contains(3==b.focusNode.nodeType?b.focusNode.parentNode:b.focusNode))}catch(a){return!1}}function dj(a,b){let{$anchor:c,$head:d}=a.selection,e=b>0?c.max(d):c.min(d),f=e.parent.inlineContent?e.depth?a.doc.resolve(b>0?e.after():e.before()):null:e;return f&&bk.findFrom(f,b)}function dk(a,b){return a.dispatch(a.state.tr.setSelection(b).scrollIntoView()),!0}function dl(a,b,c){let d=a.state.selection;if(d instanceof bo){if(c.indexOf("s")>-1){let{$head:c}=d,e=c.textOffset?null:b<0?c.nodeBefore:c.nodeAfter;if(!e||e.isText||!e.isLeaf)return!1;let f=a.state.doc.resolve(c.pos+e.nodeSize*(b<0?-1:1));return dk(a,new bo(d.$anchor,f))}else if(!d.empty)return!1;else if(a.endOfTextblock(b>0?"forward":"backward")){let c=dj(a.state,b);return!!c&&c instanceof bq&&dk(a,c)}else if(!(cu&&c.indexOf("m")>-1)){let c=d.$head,e=c.textOffset?null:b<0?c.nodeBefore:c.nodeAfter,f;if(!e||e.isText)return!1;let g=b<0?c.pos-e.nodeSize:c.pos;return!!(e.isAtom||(f=a.docView.descAt(g))&&!f.contentDOM)&&(bq.isSelectable(e)?dk(a,new bq(b<0?a.state.doc.resolve(c.pos-e.nodeSize):c)):!!cx&&dk(a,new bo(a.state.doc.resolve(b<0?g:g+e.nodeSize))))}}else{if(d instanceof bq&&d.node.isInline)return dk(a,new bo(b>0?d.$to:d.$from));let c=dj(a.state,b);return!!c&&dk(a,c)}}function dm(a){return 3==a.nodeType?a.nodeValue.length:a.childNodes.length}function dn(a,b){let c=a.pmViewDesc;return c&&0==c.size&&(b<0||a.nextSibling||"BR"!=a.nodeName)}function dp(a,b){return b<0?function(a){let b=a.domSelectionRange(),c=b.focusNode,d=b.focusOffset;if(!c)return;let e,f,g=!1;for(co&&1==c.nodeType&&d<dm(c)&&dn(c.childNodes[d],-1)&&(g=!0);;)if(d>0)if(1!=c.nodeType)break;else{let a=c.childNodes[d-1];if(dn(a,-1))e=c,f=--d;else if(3==a.nodeType)d=(c=a).nodeValue.length;else break}else if(dq(c))break;else{let b=c.previousSibling;for(;b&&dn(b,-1);)e=c.parentNode,f=b4(b),b=b.previousSibling;if(b)d=dm(c=b);else{if((c=c.parentNode)==a.dom)break;d=0}}g?dr(a,c,d):e&&dr(a,e,f)}(a):function(a){let b,c,d=a.domSelectionRange(),e=d.focusNode,f=d.focusOffset;if(!e)return;let g=dm(e);for(;;)if(f<g){if(1!=e.nodeType)break;if(dn(e.childNodes[f],1))b=e,c=++f;else break}else if(dq(e))break;else{let d=e.nextSibling;for(;d&&dn(d,1);)b=d.parentNode,c=b4(d)+1,d=d.nextSibling;if(d)f=0,g=dm(e=d);else{if((e=e.parentNode)==a.dom)break;f=g=0}}b&&dr(a,b,c)}(a)}function dq(a){let b=a.pmViewDesc;return b&&b.node&&b.node.isBlock}function dr(a,b,c){if(3!=b.nodeType){let a,d;(d=function(a,b){for(;a&&b==a.childNodes.length&&!cd(a);)b=b4(a)+1,a=a.parentNode;for(;a&&b<a.childNodes.length;){let c=a.childNodes[b];if(3==c.nodeType)return c;if(1==c.nodeType&&"false"==c.contentEditable)break;a=c,b=0}}(b,c))?(b=d,c=0):(a=function(a,b){for(;a&&!b&&!cd(a);)b=b4(a),a=a.parentNode;for(;a&&b;){let c=a.childNodes[b-1];if(3==c.nodeType)return c;if(1==c.nodeType&&"false"==c.contentEditable)break;b=(a=c).childNodes.length}}(b,c))&&(b=a,c=a.nodeValue.length)}let d=a.domSelection();if(!d)return;if(ce(d)){let a=document.createRange();a.setEnd(b,c),a.setStart(b,c),d.removeAllRanges(),d.addRange(a)}else d.extend&&d.extend(b,c);a.domObserver.setCurSelection();let{state:e}=a;setTimeout(()=>{a.state==e&&c9(a)},50)}function ds(a,b){let c=a.state.doc.resolve(b);if(!(cq||cv)&&c.parent.inlineContent){let d=a.coordsAtPos(b);if(b>c.start()){let c=a.coordsAtPos(b-1),e=(c.top+c.bottom)/2;if(e>d.top&&e<d.bottom&&Math.abs(c.left-d.left)>1)return c.left<d.left?"ltr":"rtl"}if(b<c.end()){let c=a.coordsAtPos(b+1),e=(c.top+c.bottom)/2;if(e>d.top&&e<d.bottom&&Math.abs(c.left-d.left)>1)return c.left>d.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(a.dom).direction?"rtl":"ltr"}function dt(a,b,c){let d=a.state.selection;if(d instanceof bo&&!d.empty||c.indexOf("s")>-1||cu&&c.indexOf("m")>-1)return!1;let{$from:e,$to:f}=d;if(!e.parent.inlineContent||a.endOfTextblock(b<0?"up":"down")){let c=dj(a.state,b);if(c&&c instanceof bq)return dk(a,c)}if(!e.parent.inlineContent){let c=b<0?e:f,g=d instanceof bs?bk.near(c,b):bk.findFrom(c,b);return!!g&&dk(a,g)}return!1}function du(a,b){if(!(a.state.selection instanceof bo))return!0;let{$head:c,$anchor:d,empty:e}=a.state.selection;if(!c.sameParent(d))return!0;if(!e)return!1;if(a.endOfTextblock(b>0?"forward":"backward"))return!0;let f=!c.textOffset&&(b<0?c.nodeBefore:c.nodeAfter);if(f&&!f.isText){let d=a.state.tr;return b<0?d.delete(c.pos-f.nodeSize,c.pos):d.delete(c.pos,c.pos+f.nodeSize),a.dispatch(d),!0}return!1}function dv(a,b,c){a.domObserver.stop(),b.contentEditable=c,a.domObserver.start()}function dw(a,b){a.someProp("transformCopied",c=>{b=c(b,a)});let c=[],{content:d,openStart:e,openEnd:f}=b;for(;e>1&&f>1&&1==d.childCount&&1==d.firstChild.childCount;){e--,f--;let a=d.firstChild;c.push(a.type.name,a.attrs!=a.type.defaultAttrs?a.attrs:null),d=a.content}let g=a.someProp("clipboardSerializer")||aF.fromSchema(a.state.schema),h=dE(),i=h.createElement("div");i.appendChild(g.serializeFragment(d,{document:h}));let j=i.firstChild,k,l=0;for(;j&&1==j.nodeType&&(k=dC[j.nodeName.toLowerCase()]);){for(let a=k.length-1;a>=0;a--){let b=h.createElement(k[a]);for(;i.firstChild;)b.appendChild(i.firstChild);i.appendChild(b),l++}j=i.firstChild}return j&&1==j.nodeType&&j.setAttribute("data-pm-slice",`${e} ${f}${l?` -${l}`:""} ${JSON.stringify(c)}`),{dom:i,text:a.someProp("clipboardTextSerializer",c=>c(b,a))||b.content.textBetween(0,b.content.size,"\n\n"),slice:b}}function dx(a,b,c,d,e){let f,g,h=e.parent.type.spec.code;if(!c&&!b)return null;let i=!!b&&(d||h||!c);if(i){if(a.someProp("transformPastedText",c=>{b=c(b,h||d,a)}),h)return g=new U(O.from(a.state.schema.text(b.replace(/\r\n?/g,"\n"))),0,0),a.someProp("transformPasted",b=>{g=b(g,a,!0)}),g;let c=a.someProp("clipboardTextParser",c=>c(b,e,d,a));if(c)g=c;else{let c=e.marks(),{schema:d}=a.state,g=aF.fromSchema(d);f=document.createElement("div"),b.split(/(?:\r\n?|\n)+/).forEach(a=>{let b=f.appendChild(document.createElement("p"));a&&b.appendChild(g.serializeNode(d.text(a,c)))})}}else a.someProp("transformPastedHTML",b=>{c=b(c,a)}),f=function(a){var b;let c,d=/^(\s*<meta [^>]*>)*/.exec(a);d&&(a=a.slice(d[0].length));let e=dE().createElement("div"),f=/<([a-z][^>\s]+)/i.exec(a),g;if((g=f&&dC[f[1].toLowerCase()])&&(a=g.map(a=>"<"+a+">").join("")+a+g.map(a=>"</"+a+">").reverse().join("")),e.innerHTML=(b=a,(c=window.trustedTypes)?(dF||(dF=c.defaultPolicy||c.createPolicy("ProseMirrorClipboard",{createHTML:a=>a})),dF.createHTML(b)):b),g)for(let a=0;a<g.length;a++)e=e.querySelector(g[a])||e;return e}(c),cx&&function(a){let b=a.querySelectorAll(cq?"span:not([class]):not([style])":"span.Apple-converted-space");for(let c=0;c<b.length;c++){let d=b[c];1==d.childNodes.length&&""==d.textContent&&d.parentNode&&d.parentNode.replaceChild(a.ownerDocument.createTextNode(" "),d)}}(f);let j=f&&f.querySelector("[data-pm-slice]"),k=j&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(j.getAttribute("data-pm-slice")||"");if(k&&k[3])for(let a=+k[3];a>0;a--){let a=f.firstChild;for(;a&&1!=a.nodeType;)a=a.nextSibling;if(!a)break;f=a}if(g||(g=(a.someProp("clipboardParser")||a.someProp("domParser")||aw.fromSchema(a.state.schema)).parseSlice(f,{preserveWhitespace:!!(i||k),context:e,ruleFromNode:a=>"BR"!=a.nodeName||a.nextSibling||!a.parentNode||dy.test(a.parentNode.nodeName)?null:{ignore:!0}})),k)g=function(a,b){if(!a.size)return a;let c=a.content.firstChild.type.schema,d;try{d=JSON.parse(b)}catch(b){return a}let{content:e,openStart:f,openEnd:g}=a;for(let a=d.length-2;a>=0;a-=2){let b=c.nodes[d[a]];if(!b||b.hasRequiredAttrs())break;e=O.from(b.create(d[a+1],e)),f++,g++}return new U(e,f,g)}(dB(g,+k[1],+k[2]),k[4]);else if((g=U.maxOpen(function(a,b){if(a.childCount<2)return a;for(let c=b.depth;c>=0;c--){let d=b.node(c).contentMatchAt(b.index(c)),e,f=[];if(a.forEach(a=>{if(!f)return;let b=d.findWrapping(a.type),c;if(!b)return f=null;if(c=f.length&&e.length&&function a(b,c,d,e,f){if(f<b.length&&f<c.length&&b[f]==c[f]){let g=a(b,c,d,e.lastChild,f+1);if(g)return e.copy(e.content.replaceChild(e.childCount-1,g));if(e.contentMatchAt(e.childCount).matchType(f==b.length-1?d.type:b[f+1]))return e.copy(e.content.append(O.from(dz(d,b,f+1))))}}(b,e,a,f[f.length-1],0))f[f.length-1]=c;else{f.length&&(f[f.length-1]=function a(b,c){if(0==c)return b;let d=b.content.replaceChild(b.childCount-1,a(b.lastChild,c-1)),e=b.contentMatchAt(b.childCount).fillBefore(O.empty,!0);return b.copy(d.append(e))}(f[f.length-1],e.length));let c=dz(a,b);f.push(c),d=d.matchType(c.type),e=b}}),f)return O.from(f)}return a}(g.content,e),!0)).openStart||g.openEnd){let a=0,b=0;for(let b=g.content.firstChild;a<g.openStart&&!b.type.spec.isolating;a++,b=b.firstChild);for(let a=g.content.lastChild;b<g.openEnd&&!a.type.spec.isolating;b++,a=a.lastChild);g=dB(g,a,b)}return a.someProp("transformPasted",b=>{g=b(g,a,i)}),g}let dy=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function dz(a,b,c=0){for(let d=b.length-1;d>=c;d--)a=b[d].create(null,O.from(a));return a}function dA(a,b,c,d,e,f){let g=b<0?a.firstChild:a.lastChild,h=g.content;return a.childCount>1&&(f=0),e<d-1&&(h=dA(h,b,c,d,e+1,f)),e>=c&&(h=b<0?g.contentMatchAt(0).fillBefore(h,f<=e).append(h):h.append(g.contentMatchAt(g.childCount).fillBefore(O.empty,!0))),a.replaceChild(b<0?0:a.childCount-1,g.copy(h))}function dB(a,b,c){return b<a.openStart&&(a=new U(dA(a.content,-1,b,a.openStart,0,a.openEnd),b,a.openEnd)),c<a.openEnd&&(a=new U(dA(a.content,1,c,a.openEnd,0,0),a.openStart,c)),a}let dC={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},dD=null;function dE(){return dD||(dD=document.implementation.createHTMLDocument("title"))}let dF=null,dG={},dH={},dI={touchstart:!0,touchmove:!0};class dJ{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function dK(a,b){a.input.lastSelectionOrigin=b,a.input.lastSelectionTime=Date.now()}function dL(a){a.someProp("handleDOMEvents",b=>{for(let c in b)a.input.eventHandlers[c]||a.dom.addEventListener(c,a.input.eventHandlers[c]=b=>dM(a,b))})}function dM(a,b){return a.someProp("handleDOMEvents",c=>{let d=c[b.type];return!!d&&(d(a,b)||b.defaultPrevented)})}function dN(a){return{left:a.clientX,top:a.clientY}}function dO(a,b,c,d,e){if(-1==d)return!1;let f=a.state.doc.resolve(d);for(let d=f.depth+1;d>0;d--)if(a.someProp(b,b=>d>f.depth?b(a,c,f.nodeAfter,f.before(d),e,!0):b(a,c,f.node(d),f.before(d),e,!1)))return!0;return!1}function dP(a,b,c){if(a.focused||a.focus(),a.state.selection.eq(b))return;let d=a.state.tr.setSelection(b);"pointer"==c&&d.setMeta("pointer",!0),a.dispatch(d)}dH.keydown=(a,b)=>{if((a.input.shiftKey=16==b.keyCode||b.shiftKey,!dS(a,b))&&(a.input.lastKeyCode=b.keyCode,a.input.lastKeyCodeTime=Date.now(),!cw||!cq||13!=b.keyCode))if(229!=b.keyCode&&a.domObserver.forceFlush(),!ct||13!=b.keyCode||b.ctrlKey||b.altKey||b.metaKey)a.someProp("handleKeyDown",c=>c(a,b))||function(a,b){let c,d=b.keyCode,e=(c="",b.ctrlKey&&(c+="c"),b.metaKey&&(c+="m"),b.altKey&&(c+="a"),b.shiftKey&&(c+="s"),c);if(8==d||cu&&72==d&&"c"==e)return du(a,-1)||dp(a,-1);if(46==d&&!b.shiftKey||cu&&68==d&&"c"==e)return du(a,1)||dp(a,1);if(13==d||27==d)return!0;if(37==d||cu&&66==d&&"c"==e){let b=37==d?"ltr"==ds(a,a.state.selection.from)?-1:1:-1;return dl(a,b,e)||dp(a,b)}if(39==d||cu&&70==d&&"c"==e){let b=39==d?"ltr"==ds(a,a.state.selection.from)?1:-1:1;return dl(a,b,e)||dp(a,b)}else if(38==d||cu&&80==d&&"c"==e)return dt(a,-1,e)||dp(a,-1);else if(40==d||cu&&78==d&&"c"==e)return function(a){if(!cs||a.state.selection.$head.parentOffset>0)return!1;let{focusNode:b,focusOffset:c}=a.domSelectionRange();if(b&&1==b.nodeType&&0==c&&b.firstChild&&"false"==b.firstChild.contentEditable){let c=b.firstChild;dv(a,c,"true"),setTimeout(()=>dv(a,c,"false"),20)}return!1}(a)||dt(a,1,e)||dp(a,1);else if(e==(cu?"m":"c")&&(66==d||73==d||89==d||90==d))return!0;return!1}(a,b)?b.preventDefault():dK(a,"key");else{let b=Date.now();a.input.lastIOSEnter=b,a.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{a.input.lastIOSEnter==b&&(a.someProp("handleKeyDown",b=>b(a,cf(13,"Enter"))),a.input.lastIOSEnter=0)},200)}},dH.keyup=(a,b)=>{16==b.keyCode&&(a.input.shiftKey=!1)},dH.keypress=(a,b)=>{if(dS(a,b)||!b.charCode||b.ctrlKey&&!b.altKey||cu&&b.metaKey)return;if(a.someProp("handleKeyPress",c=>c(a,b)))return void b.preventDefault();let c=a.state.selection;if(!(c instanceof bo)||!c.$from.sameParent(c.$to)){let d=String.fromCharCode(b.charCode),e=()=>a.state.tr.insertText(d).scrollIntoView();/[\r\n]/.test(d)||a.someProp("handleTextInput",b=>b(a,c.$from.pos,c.$to.pos,d,e))||a.dispatch(e()),b.preventDefault()}};let dQ=cu?"metaKey":"ctrlKey";dG.mousedown=(a,b)=>{var c;let d,e;a.input.shiftKey=b.shiftKey;let f=dW(a),g=Date.now(),h="singleClick";g-a.input.lastClick.time<500&&(d=(c=a.input.lastClick).x-b.clientX)*d+(e=c.y-b.clientY)*e<100&&!b[dQ]&&a.input.lastClick.button==b.button&&("singleClick"==a.input.lastClick.type?h="doubleClick":"doubleClick"==a.input.lastClick.type&&(h="tripleClick")),a.input.lastClick={time:g,x:b.clientX,y:b.clientY,type:h,button:b.button};let i=a.posAtCoords(dN(b));i&&("singleClick"==h?(a.input.mouseDown&&a.input.mouseDown.done(),a.input.mouseDown=new dR(a,i,b,!!f)):("doubleClick"==h?function(a,b,c,d){return dO(a,"handleDoubleClickOn",b,c,d)||a.someProp("handleDoubleClick",c=>c(a,b,d))}:function(a,b,c,d){return dO(a,"handleTripleClickOn",b,c,d)||a.someProp("handleTripleClick",c=>c(a,b,d))||function(a,b,c){if(0!=c.button)return!1;let d=a.state.doc;if(-1==b)return!!d.inlineContent&&(dP(a,bo.create(d,0,d.content.size),"pointer"),!0);let e=d.resolve(b);for(let b=e.depth+1;b>0;b--){let c=b>e.depth?e.nodeAfter:e.node(b),f=e.before(b);if(c.inlineContent)dP(a,bo.create(d,f+1,f+1+c.content.size),"pointer");else{if(!bq.isSelectable(c))continue;dP(a,bq.create(d,f),"pointer")}return!0}}(a,c,d)})(a,i.pos,i.inside,b)?b.preventDefault():dK(a,"pointer"))};class dR{constructor(a,b,c,d){let e,f;if(this.view=a,this.pos=b,this.event=c,this.flushed=d,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=a.state.doc,this.selectNode=!!c[dQ],this.allowDefault=c.shiftKey,b.inside>-1)e=a.state.doc.nodeAt(b.inside),f=b.inside;else{let c=a.state.doc.resolve(b.pos);e=c.parent,f=c.depth?c.before():0}const g=d?null:c.target,h=g?a.docView.nearestDesc(g,!0):null;this.target=h&&1==h.nodeDOM.nodeType?h.nodeDOM:null;let{selection:i}=a.state;(0==c.button&&e.type.spec.draggable&&!1!==e.type.spec.selectable||i instanceof bq&&i.from<=f&&i.to>f)&&(this.mightDrag={node:e,pos:f,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&co&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),a.root.addEventListener("mouseup",this.up=this.up.bind(this)),a.root.addEventListener("mousemove",this.move=this.move.bind(this)),dK(a,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>c9(this.view)),this.view.input.mouseDown=null}up(a){if(this.done(),!this.view.dom.contains(a.target))return;let b=this.pos;if(this.view.state.doc!=this.startDoc&&(b=this.view.posAtCoords(dN(a))),this.updateAllowDefault(a),this.allowDefault||!b)dK(this.view,"pointer");else{var c,d,e,f;(c=this.view,d=b.pos,e=b.inside,f=this.selectNode,dO(c,"handleClickOn",d,e,a)||c.someProp("handleClick",b=>b(c,d,a))||(f?function(a,b){if(-1==b)return!1;let c=a.state.selection,d,e;c instanceof bq&&(d=c.node);let f=a.state.doc.resolve(b);for(let a=f.depth+1;a>0;a--){let b=a>f.depth?f.nodeAfter:f.node(a);if(bq.isSelectable(b)){e=d&&c.$from.depth>0&&a>=c.$from.depth&&f.before(c.$from.depth+1)==c.$from.pos?f.before(c.$from.depth):f.before(a);break}}return null!=e&&(dP(a,bq.create(a.state.doc,e),"pointer"),!0)}(c,e):function(a,b){if(-1==b)return!1;let c=a.state.doc.resolve(b),d=c.nodeAfter;return!!(d&&d.isAtom&&bq.isSelectable(d))&&(dP(a,new bq(c),"pointer"),!0)}(c,e)))?a.preventDefault():0==a.button&&(this.flushed||cs&&this.mightDrag&&!this.mightDrag.node.isAtom||cq&&!this.view.state.selection.visible&&2>=Math.min(Math.abs(b.pos-this.view.state.selection.from),Math.abs(b.pos-this.view.state.selection.to)))?(dP(this.view,bk.near(this.view.state.doc.resolve(b.pos)),"pointer"),a.preventDefault()):dK(this.view,"pointer")}}move(a){this.updateAllowDefault(a),dK(this.view,"pointer"),0==a.buttons&&this.done()}updateAllowDefault(a){!this.allowDefault&&(Math.abs(this.event.x-a.clientX)>4||Math.abs(this.event.y-a.clientY)>4)&&(this.allowDefault=!0)}}function dS(a,b){return!!a.composing||!!(cs&&500>Math.abs(b.timeStamp-a.input.compositionEndedAt))&&(a.input.compositionEndedAt=-2e8,!0)}dG.touchstart=a=>{a.input.lastTouch=Date.now(),dW(a),dK(a,"pointer")},dG.touchmove=a=>{a.input.lastTouch=Date.now(),dK(a,"pointer")},dG.contextmenu=a=>dW(a);let dT=cw?5e3:-1;function dU(a,b){clearTimeout(a.input.composingTimeout),b>-1&&(a.input.composingTimeout=setTimeout(()=>dW(a),b))}function dV(a){let b;for(a.composing&&(a.input.composing=!1,a.input.compositionEndedAt=((b=document.createEvent("Event")).initEvent("event",!0,!0),b.timeStamp));a.input.compositionNodes.length>0;)a.input.compositionNodes.pop().markParentsDirty()}function dW(a,b=!1){if(!cw||!(a.domObserver.flushingSoon>=0)){if(a.domObserver.forceFlush(),dV(a),b||a.docView&&a.docView.dirty){let c=c7(a),d=a.state.selection;return c&&!c.eq(d)?a.dispatch(a.state.tr.setSelection(c)):(a.markCursor||b)&&!d.$from.node(d.$from.sharedDepth(d.to)).inlineContent?a.dispatch(a.state.tr.deleteSelection()):a.updateState(a.state),!0}return!1}}dH.compositionstart=dH.compositionupdate=a=>{if(!a.composing){a.domObserver.flush();let{state:b}=a,c=b.selection.$to;if(b.selection instanceof bo&&(b.storedMarks||!c.textOffset&&c.parentOffset&&c.nodeBefore.marks.some(a=>!1===a.type.spec.inclusive)||cq&&cv&&function(a){let{focusNode:b,focusOffset:c}=a.domSelectionRange();if(!b||1!=b.nodeType||c>=b.childNodes.length)return!1;let d=b.childNodes[c];return 1==d.nodeType&&"false"==d.contentEditable}(a)))a.markCursor=a.state.storedMarks||c.marks(),dW(a,!0),a.markCursor=null;else if(dW(a,!b.selection.empty),co&&b.selection.empty&&c.parentOffset&&!c.textOffset&&c.nodeBefore.marks.length){let b=a.domSelectionRange();for(let c=b.focusNode,d=b.focusOffset;c&&1==c.nodeType&&0!=d;){let b=d<0?c.lastChild:c.childNodes[d-1];if(!b)break;if(3==b.nodeType){let c=a.domSelection();c&&c.collapse(b,b.nodeValue.length);break}c=b,d=-1}}a.input.composing=!0}dU(a,dT)},dH.compositionend=(a,b)=>{a.composing&&(a.input.composing=!1,a.input.compositionEndedAt=b.timeStamp,a.input.compositionPendingChanges=a.domObserver.pendingRecords().length?a.input.compositionID:0,a.input.compositionNode=null,a.input.compositionPendingChanges&&Promise.resolve().then(()=>a.domObserver.flush()),a.input.compositionID++,dU(a,20))};let dX=cm&&cn<15||ct&&cy<604;function dY(a,b,c,d,e){let f=dx(a,b,c,d,a.state.selection.$from);if(a.someProp("handlePaste",b=>b(a,e,f||U.empty)))return!0;if(!f)return!1;let g=0==f.openStart&&0==f.openEnd&&1==f.content.childCount?f.content.firstChild:null,h=g?a.state.tr.replaceSelectionWith(g,d):a.state.tr.replaceSelection(f);return a.dispatch(h.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function dZ(a){let b=a.getData("text/plain")||a.getData("Text");if(b)return b;let c=a.getData("text/uri-list");return c?c.replace(/\r?\n/g," "):""}dG.copy=dH.cut=(a,b)=>{let c=a.state.selection,d="cut"==b.type;if(c.empty)return;let e=dX?null:b.clipboardData,{dom:f,text:g}=dw(a,c.content());e?(b.preventDefault(),e.clearData(),e.setData("text/html",f.innerHTML),e.setData("text/plain",g)):function(a,b){if(!a.dom.parentNode)return;let c=a.dom.parentNode.appendChild(document.createElement("div"));c.appendChild(b),c.style.cssText="position: fixed; left: -10000px; top: 10px";let d=getSelection(),e=document.createRange();e.selectNodeContents(b),a.dom.blur(),d.removeAllRanges(),d.addRange(e),setTimeout(()=>{c.parentNode&&c.parentNode.removeChild(c),a.focus()},50)}(a,f),d&&a.dispatch(a.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},dH.paste=(a,b)=>{if(a.composing&&!cw)return;let c=dX?null:b.clipboardData,d=a.input.shiftKey&&45!=a.input.lastKeyCode;c&&dY(a,dZ(c),c.getData("text/html"),d,b)?b.preventDefault():function(a,b){if(!a.dom.parentNode)return;let c=a.input.shiftKey||a.state.selection.$from.parent.type.spec.code,d=a.dom.parentNode.appendChild(document.createElement(c?"textarea":"div"));c||(d.contentEditable="true"),d.style.cssText="position: fixed; left: -10000px; top: 10px",d.focus();let e=a.input.shiftKey&&45!=a.input.lastKeyCode;setTimeout(()=>{a.focus(),d.parentNode&&d.parentNode.removeChild(d),c?dY(a,d.value,null,e,b):dY(a,d.textContent,d.innerHTML,e,b)},50)}(a,b)};class d${constructor(a,b,c){this.slice=a,this.move=b,this.node=c}}let d_=cu?"altKey":"ctrlKey";function d0(a,b){let c=a.someProp("dragCopies",a=>!a(b));return null!=c?c:!b[d_]}for(let a in dG.dragstart=(a,b)=>{let c,d=a.input.mouseDown;if(d&&d.done(),!b.dataTransfer)return;let e=a.state.selection,f=e.empty?null:a.posAtCoords(dN(b));if(f&&f.pos>=e.from&&f.pos<=(e instanceof bq?e.to-1:e.to));else if(d&&d.mightDrag)c=bq.create(a.state.doc,d.mightDrag.pos);else if(b.target&&1==b.target.nodeType){let d=a.docView.nearestDesc(b.target,!0);d&&d.node.type.spec.draggable&&d!=a.docView&&(c=bq.create(a.state.doc,d.posBefore))}let g=(c||a.state.selection).content(),{dom:h,text:i,slice:j}=dw(a,g);b.dataTransfer.files.length&&cq&&!(cr>120)||b.dataTransfer.clearData(),b.dataTransfer.setData(dX?"Text":"text/html",h.innerHTML),b.dataTransfer.effectAllowed="copyMove",dX||b.dataTransfer.setData("text/plain",i),a.dragging=new d$(j,d0(a,b),c)},dG.dragend=a=>{let b=a.dragging;window.setTimeout(()=>{a.dragging==b&&(a.dragging=null)},50)},dH.dragover=dH.dragenter=(a,b)=>b.preventDefault(),dH.drop=(a,b)=>{try{!function(a,b,c){if(!b.dataTransfer)return;let d=a.posAtCoords(dN(b));if(!d)return;let e=a.state.doc.resolve(d.pos),f=c&&c.slice;f?a.someProp("transformPasted",b=>{f=b(f,a,!1)}):f=dx(a,dZ(b.dataTransfer),dX?null:b.dataTransfer.getData("text/html"),!1,e);let g=!!(c&&d0(a,b));if(a.someProp("handleDrop",c=>c(a,b,f||U.empty,g)))return b.preventDefault();if(!f)return;b.preventDefault();let h=f?a6(a.state.doc,e.pos,f):e.pos;null==h&&(h=e.pos);let i=a.state.tr;if(g){let{node:a}=c;a?a.replace(i):i.deleteSelection()}let j=i.mapping.map(h),k=0==f.openStart&&0==f.openEnd&&1==f.content.childCount,l=i.doc;if(k?i.replaceRangeWith(j,j,f.content.firstChild):i.replaceRange(j,j,f),i.doc.eq(l))return;let m=i.doc.resolve(j);if(k&&bq.isSelectable(f.content.firstChild)&&m.nodeAfter&&m.nodeAfter.sameMarkup(f.content.firstChild))i.setSelection(new bq(m));else{let b=i.mapping.map(h);i.mapping.maps[i.mapping.maps.length-1].forEach((a,c,d,e)=>b=e),i.setSelection(dg(a,m,i.doc.resolve(b)))}a.focus(),a.dispatch(i.setMeta("uiEvent","drop"))}(a,b,a.dragging)}finally{a.dragging=null}},dG.focus=a=>{a.input.lastFocus=Date.now(),a.focused||(a.domObserver.stop(),a.dom.classList.add("ProseMirror-focused"),a.domObserver.start(),a.focused=!0,setTimeout(()=>{a.docView&&a.hasFocus()&&!a.domObserver.currentSelection.eq(a.domSelectionRange())&&c9(a)},20))},dG.blur=(a,b)=>{a.focused&&(a.domObserver.stop(),a.dom.classList.remove("ProseMirror-focused"),a.domObserver.start(),b.relatedTarget&&a.dom.contains(b.relatedTarget)&&a.domObserver.currentSelection.clear(),a.focused=!1)},dG.beforeinput=(a,b)=>{if(cq&&cw&&"deleteContentBackward"==b.inputType){a.domObserver.flushSoon();let{domChangeCount:b}=a.input;setTimeout(()=>{if(a.input.domChangeCount!=b||(a.dom.blur(),a.focus(),a.someProp("handleKeyDown",b=>b(a,cf(8,"Backspace")))))return;let{$cursor:c}=a.state.selection;c&&c.pos>0&&a.dispatch(a.state.tr.delete(c.pos-1,c.pos).scrollIntoView())},50)}},dH)dG[a]=dH[a];function d1(a,b){if(a==b)return!0;for(let c in a)if(a[c]!==b[c])return!1;for(let c in b)if(!(c in a))return!1;return!0}class d2{constructor(a,b){this.toDOM=a,this.spec=b||d7,this.side=this.spec.side||0}map(a,b,c,d){let{pos:e,deleted:f}=a.mapResult(b.from+d,this.side<0?-1:1);return f?null:new d5(e-c,e-c,this)}valid(){return!0}eq(a){return this==a||a instanceof d2&&(this.spec.key&&this.spec.key==a.spec.key||this.toDOM==a.toDOM&&d1(this.spec,a.spec))}destroy(a){this.spec.destroy&&this.spec.destroy(a)}}class d3{constructor(a,b){this.attrs=a,this.spec=b||d7}map(a,b,c,d){let e=a.map(b.from+d,this.spec.inclusiveStart?-1:1)-c,f=a.map(b.to+d,this.spec.inclusiveEnd?1:-1)-c;return e>=f?null:new d5(e,f,this)}valid(a,b){return b.from<b.to}eq(a){return this==a||a instanceof d3&&d1(this.attrs,a.attrs)&&d1(this.spec,a.spec)}static is(a){return a.type instanceof d3}destroy(){}}class d4{constructor(a,b){this.attrs=a,this.spec=b||d7}map(a,b,c,d){let e=a.mapResult(b.from+d,1);if(e.deleted)return null;let f=a.mapResult(b.to+d,-1);return f.deleted||f.pos<=e.pos?null:new d5(e.pos-c,f.pos-c,this)}valid(a,b){let{index:c,offset:d}=a.content.findIndex(b.from),e;return d==b.from&&!(e=a.child(c)).isText&&d+e.nodeSize==b.to}eq(a){return this==a||a instanceof d4&&d1(this.attrs,a.attrs)&&d1(this.spec,a.spec)}destroy(){}}class d5{constructor(a,b,c){this.from=a,this.to=b,this.type=c}copy(a,b){return new d5(a,b,this.type)}eq(a,b=0){return this.type.eq(a.type)&&this.from+b==a.from&&this.to+b==a.to}map(a,b,c){return this.type.map(a,this,b,c)}static widget(a,b,c){return new d5(a,a,new d2(b,c))}static inline(a,b,c,d){return new d5(a,b,new d3(c,d))}static node(a,b,c,d){return new d5(a,b,new d4(c,d))}get spec(){return this.type.spec}get inline(){return this.type instanceof d3}get widget(){return this.type instanceof d2}}let d6=[],d7={};class d8{constructor(a,b){this.local=a.length?a:d6,this.children=b.length?b:d6}static create(a,b){return b.length?ee(b,a,0,d7):d9}find(a,b,c){let d=[];return this.findInner(null==a?0:a,null==b?1e9:b,d,0,c),d}findInner(a,b,c,d,e){for(let f=0;f<this.local.length;f++){let g=this.local[f];g.from<=b&&g.to>=a&&(!e||e(g.spec))&&c.push(g.copy(g.from+d,g.to+d))}for(let f=0;f<this.children.length;f+=3)if(this.children[f]<b&&this.children[f+1]>a){let g=this.children[f]+1;this.children[f+2].findInner(a-g,b-g,c,d+g,e)}}map(a,b,c){return this==d9||0==a.maps.length?this:this.mapInner(a,b,0,0,c||d7)}mapInner(a,b,c,d,e){let f;for(let g=0;g<this.local.length;g++){let h=this.local[g].map(a,c,d);h&&h.type.valid(b,h)?(f||(f=[])).push(h):e.onRemove&&e.onRemove(this.local[g].spec)}return this.children.length?function(a,b,c,d,e,f,g){let h=a.slice();for(let a=0,b=f;a<c.maps.length;a++){let d=0;c.maps[a].forEach((a,c,e,f)=>{let g=f-e-(c-a);for(let e=0;e<h.length;e+=3){let f=h[e+1];if(f<0||a>f+b-d)continue;let i=h[e]+b-d;c>=i?h[e+1]=a<=i?-2:-1:a>=b&&g&&(h[e]+=g,h[e+1]+=g)}d+=g}),b=c.maps[a].map(b,-1)}let i=!1;for(let b=0;b<h.length;b+=3)if(h[b+1]<0){if(-2==h[b+1]){i=!0,h[b+1]=-1;continue}let j=c.map(a[b]+f),k=j-e;if(k<0||k>=d.content.size){i=!0;continue}let l=c.map(a[b+1]+f,-1)-e,{index:m,offset:n}=d.content.findIndex(k),o=d.maybeChild(m);if(o&&n==k&&n+o.nodeSize==l){let d=h[b+2].mapInner(c,o,j+1,a[b]+f+1,g);d!=d9?(h[b]=k,h[b+1]=l,h[b+2]=d):(h[b+1]=-2,i=!0)}else i=!0}if(i){let i=ee(function(a,b,c,d,e,f,g){for(let h=0;h<a.length;h+=3)-1==a[h+1]&&function a(b,f){for(let a=0;a<b.local.length;a++){let h=b.local[a].map(d,e,f);h?c.push(h):g.onRemove&&g.onRemove(b.local[a].spec)}for(let c=0;c<b.children.length;c+=3)a(b.children[c+2],b.children[c]+f+1)}(a[h+2],b[h]+f+1);return c}(h,a,b,c,e,f,g),d,0,g);b=i.local;for(let a=0;a<h.length;a+=3)h[a+1]<0&&(h.splice(a,3),a-=3);for(let a=0,b=0;a<i.children.length;a+=3){let c=i.children[a];for(;b<h.length&&h[b]<c;)b+=3;h.splice(b,0,i.children[a],i.children[a+1],i.children[a+2])}}return new d8(b.sort(ef),h)}(this.children,f||[],a,b,c,d,e):f?new d8(f.sort(ef),d6):d9}add(a,b){return b.length?this==d9?d8.create(a,b):this.addInner(a,b,0):this}addInner(a,b,c){let d,e=0;a.forEach((a,f)=>{let g=f+c,h;if(h=ec(b,a,g)){for(d||(d=this.children.slice());e<d.length&&d[e]<f;)e+=3;d[e]==f?d[e+2]=d[e+2].addInner(a,h,g+1):d.splice(e,0,f,f+a.nodeSize,ee(h,a,g+1,d7)),e+=3}});let f=eb(e?ed(b):b,-c);for(let b=0;b<f.length;b++)f[b].type.valid(a,f[b])||f.splice(b--,1);return new d8(f.length?this.local.concat(f).sort(ef):this.local,d||this.children)}remove(a){return 0==a.length||this==d9?this:this.removeInner(a,0)}removeInner(a,b){let c=this.children,d=this.local;for(let d=0;d<c.length;d+=3){let e,f=c[d]+b,g=c[d+1]+b;for(let b=0,c;b<a.length;b++)(c=a[b])&&c.from>f&&c.to<g&&(a[b]=null,(e||(e=[])).push(c));if(!e)continue;c==this.children&&(c=this.children.slice());let h=c[d+2].removeInner(e,f+1);h!=d9?c[d+2]=h:(c.splice(d,3),d-=3)}if(d.length){for(let c=0,e;c<a.length;c++)if(e=a[c])for(let a=0;a<d.length;a++)d[a].eq(e,b)&&(d==this.local&&(d=this.local.slice()),d.splice(a--,1))}return c==this.children&&d==this.local?this:d.length||c.length?new d8(d,c):d9}forChild(a,b){let c,d;if(this==d9)return this;if(b.isLeaf)return d8.empty;for(let b=0;b<this.children.length;b+=3)if(this.children[b]>=a){this.children[b]==a&&(c=this.children[b+2]);break}let e=a+1,f=e+b.content.size;for(let a=0;a<this.local.length;a++){let b=this.local[a];if(b.from<f&&b.to>e&&b.type instanceof d3){let a=Math.max(e,b.from)-e,c=Math.min(f,b.to)-e;a<c&&(d||(d=[])).push(b.copy(a,c))}}if(d){let a=new d8(d.sort(ef),d6);return c?new ea([a,c]):a}return c||d9}eq(a){if(this==a)return!0;if(!(a instanceof d8)||this.local.length!=a.local.length||this.children.length!=a.children.length)return!1;for(let b=0;b<this.local.length;b++)if(!this.local[b].eq(a.local[b]))return!1;for(let b=0;b<this.children.length;b+=3)if(this.children[b]!=a.children[b]||this.children[b+1]!=a.children[b+1]||!this.children[b+2].eq(a.children[b+2]))return!1;return!0}locals(a){return eg(this.localsInner(a))}localsInner(a){if(this==d9)return d6;if(a.inlineContent||!this.local.some(d3.is))return this.local;let b=[];for(let a=0;a<this.local.length;a++)this.local[a].type instanceof d3||b.push(this.local[a]);return b}forEachSet(a){a(this)}}d8.empty=new d8([],[]),d8.removeOverlap=eg;let d9=d8.empty;class ea{constructor(a){this.members=a}map(a,b){let c=this.members.map(c=>c.map(a,b,d7));return ea.from(c)}forChild(a,b){if(b.isLeaf)return d8.empty;let c=[];for(let d=0;d<this.members.length;d++){let e=this.members[d].forChild(a,b);e!=d9&&(e instanceof ea?c=c.concat(e.members):c.push(e))}return ea.from(c)}eq(a){if(!(a instanceof ea)||a.members.length!=this.members.length)return!1;for(let b=0;b<this.members.length;b++)if(!this.members[b].eq(a.members[b]))return!1;return!0}locals(a){let b,c=!0;for(let d=0;d<this.members.length;d++){let e=this.members[d].localsInner(a);if(e.length)if(b){c&&(b=b.slice(),c=!1);for(let a=0;a<e.length;a++)b.push(e[a])}else b=e}return b?eg(c?b:b.sort(ef)):d6}static from(a){switch(a.length){case 0:return d9;case 1:return a[0];default:return new ea(a.every(a=>a instanceof d8)?a:a.reduce((a,b)=>a.concat(b instanceof d8?b:b.members),[]))}}forEachSet(a){for(let b=0;b<this.members.length;b++)this.members[b].forEachSet(a)}}function eb(a,b){if(!b||!a.length)return a;let c=[];for(let d=0;d<a.length;d++){let e=a[d];c.push(new d5(e.from+b,e.to+b,e.type))}return c}function ec(a,b,c){if(b.isLeaf)return null;let d=c+b.nodeSize,e=null;for(let b=0,f;b<a.length;b++)(f=a[b])&&f.from>c&&f.to<d&&((e||(e=[])).push(f),a[b]=null);return e}function ed(a){let b=[];for(let c=0;c<a.length;c++)null!=a[c]&&b.push(a[c]);return b}function ee(a,b,c,d){let e=[],f=!1;b.forEach((b,g)=>{let h=ec(a,b,g+c);if(h){f=!0;let a=ee(h,b,c+g+1,d);a!=d9&&e.push(g,g+b.nodeSize,a)}});let g=eb(f?ed(a):a,-c).sort(ef);for(let a=0;a<g.length;a++)g[a].type.valid(b,g[a])||(d.onRemove&&d.onRemove(g[a].spec),g.splice(a--,1));return g.length||e.length?new d8(g,e):d9}function ef(a,b){return a.from-b.from||a.to-b.to}function eg(a){let b=a;for(let c=0;c<b.length-1;c++){let d=b[c];if(d.from!=d.to)for(let e=c+1;e<b.length;e++){let f=b[e];if(f.from==d.from){f.to!=d.to&&(b==a&&(b=a.slice()),b[e]=f.copy(f.from,d.to),eh(b,e+1,f.copy(d.to,f.to)));continue}f.from<d.to&&(b==a&&(b=a.slice()),b[c]=d.copy(d.from,f.from),eh(b,e,d.copy(f.from,d.to)));break}}return b}function eh(a,b,c){for(;b<a.length&&ef(c,a[b])>0;)b++;a.splice(b,0,c)}function ei(a){let b=[];return a.someProp("decorations",c=>{let d=c(a.state);d&&d!=d9&&b.push(d)}),a.cursorWrapper&&b.push(d8.create(a.state.doc,[a.cursorWrapper.deco])),ea.from(b)}let ej={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},ek=cm&&cn<=11;class el{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(a){this.anchorNode=a.anchorNode,this.anchorOffset=a.anchorOffset,this.focusNode=a.focusNode,this.focusOffset=a.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(a){return a.anchorNode==this.anchorNode&&a.anchorOffset==this.anchorOffset&&a.focusNode==this.focusNode&&a.focusOffset==this.focusOffset}}class em{constructor(a,b){this.view=a,this.handleDOMChange=b,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new el,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(a=>{for(let b=0;b<a.length;b++)this.queue.push(a[b]);cm&&cn<=11&&a.some(a=>"childList"==a.type&&a.removedNodes.length||"characterData"==a.type&&a.oldValue.length>a.target.nodeValue.length)?this.flushSoon():this.flush()}),ek&&(this.onCharData=a=>{this.queue.push({target:a.target,type:"characterData",oldValue:a.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,ej)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let a=this.observer.takeRecords();if(a.length){for(let b=0;b<a.length;b++)this.queue.push(a[b]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(dh(this.view)){if(this.suppressingSelectionUpdates)return c9(this.view);if(cm&&cn<=11&&!this.view.state.selection.empty){let a=this.view.domSelectionRange();if(a.focusNode&&b9(a.focusNode,a.focusOffset,a.anchorNode,a.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(a){if(!a.focusNode)return!0;let b=new Set,c;for(let c=a.focusNode;c;c=b5(c))b.add(c);for(let d=a.anchorNode;d;d=b5(d))if(b.has(d)){c=d;break}let d=c&&this.view.docView.nearestDesc(c);if(d&&d.ignoreMutation({type:"selection",target:3==c.nodeType?c.parentNode:c}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let a of this.observer.takeRecords())this.queue.push(a);return this.queue}flush(){var a;let{view:b}=this;if(!b.docView||this.flushingSoon>-1)return;let c=this.pendingRecords();c.length&&(this.queue=[]);let d=b.domSelectionRange(),e=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(d)&&dh(b)&&!this.ignoreSelectionChange(d),f=-1,g=-1,h=!1,i=[];if(b.editable)for(let a=0;a<c.length;a++){let b=this.registerMutation(c[a],i);b&&(f=f<0?b.from:Math.min(b.from,f),g=g<0?b.to:Math.max(b.to,g),b.typeOver&&(h=!0))}if(co&&i.length){let a=i.filter(a=>"BR"==a.nodeName);if(2==a.length){let[b,c]=a;b.parentNode&&b.parentNode.parentNode==c.parentNode?c.remove():b.remove()}else{let{focusNode:c}=this.currentSelection;for(let d of a){let a=d.parentNode;a&&"LI"==a.nodeName&&(!c||function(a,b){for(let c=b.parentNode;c&&c!=a.dom;c=c.parentNode){let b=a.docView.nearestDesc(c,!0);if(b&&b.node.isBlock)return c}return null}(b,c)!=a)&&d.remove()}}}else if((cq||cs)&&i.some(a=>"BR"==a.nodeName)&&(8==b.input.lastKeyCode||46==b.input.lastKeyCode)){for(let a of i)if("BR"==a.nodeName&&a.parentNode){let b=a.nextSibling;b&&1==b.nodeType&&"false"==b.contentEditable&&a.parentNode.removeChild(a)}}let j=null;f<0&&e&&b.input.lastFocus>Date.now()-200&&Math.max(b.input.lastTouch,b.input.lastClick.time)<Date.now()-300&&ce(d)&&(j=c7(b))&&j.eq(bk.near(b.state.doc.resolve(0),1))?(b.input.lastFocus=0,c9(b),this.currentSelection.set(d),b.scrollToSelection()):(f>-1||e)&&(f>-1&&(b.docView.markDirty(f,g),a=b,!en.has(a)&&(en.set(a,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(a.dom).whiteSpace))&&(a.requiresGeckoHackNode=co,eo||(console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),eo=!0))),this.handleDOMChange(f,g,h,i),b.docView&&b.docView.dirty?b.updateState(b.state):this.currentSelection.eq(d)||c9(b),this.currentSelection.set(d))}registerMutation(a,b){if(b.indexOf(a.target)>-1)return null;let c=this.view.docView.nearestDesc(a.target);if("attributes"==a.type&&(c==this.view.docView||"contenteditable"==a.attributeName||"style"==a.attributeName&&!a.oldValue&&!a.target.getAttribute("style"))||!c||c.ignoreMutation(a))return null;if("childList"==a.type){for(let c=0;c<a.addedNodes.length;c++){let d=a.addedNodes[c];b.push(d),3==d.nodeType&&(this.lastChangedTextNode=d)}if(c.contentDOM&&c.contentDOM!=c.dom&&!c.contentDOM.contains(a.target))return{from:c.posBefore,to:c.posAfter};let d=a.previousSibling,e=a.nextSibling;if(cm&&cn<=11&&a.addedNodes.length)for(let b=0;b<a.addedNodes.length;b++){let{previousSibling:c,nextSibling:f}=a.addedNodes[b];(!c||0>Array.prototype.indexOf.call(a.addedNodes,c))&&(d=c),(!f||0>Array.prototype.indexOf.call(a.addedNodes,f))&&(e=f)}let f=d&&d.parentNode==a.target?b4(d)+1:0,g=c.localPosFromDOM(a.target,f,-1),h=e&&e.parentNode==a.target?b4(e):a.target.childNodes.length;return{from:g,to:c.localPosFromDOM(a.target,h,1)}}return"attributes"==a.type?{from:c.posAtStart-c.border,to:c.posAtEnd+c.border}:(this.lastChangedTextNode=a.target,{from:c.posAtStart,to:c.posAtEnd,typeOver:a.target.nodeValue==a.oldValue})}}let en=new WeakMap,eo=!1;function ep(a,b){let c=b.startContainer,d=b.startOffset,e=b.endContainer,f=b.endOffset,g=a.domAtPos(a.state.selection.anchor);return b9(g.node,g.offset,e,f)&&([c,d,e,f]=[e,f,c,d]),{anchorNode:c,anchorOffset:d,focusNode:e,focusOffset:f}}function eq(a){let b=a.pmViewDesc;if(b)return b.parseRule();if("BR"==a.nodeName&&a.parentNode){if(cs&&/^(ul|ol)$/i.test(a.parentNode.nodeName)){let a=document.createElement("div");return a.appendChild(document.createElement("li")),{skip:a}}else if(a.parentNode.lastChild==a||cs&&/^(tr|table)$/i.test(a.parentNode.nodeName))return{ignore:!0}}else if("IMG"==a.nodeName&&a.getAttribute("mark-placeholder"))return{ignore:!0};return null}let er=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function es(a,b,c){return Math.max(c.anchor,c.head)>b.content.size?null:dg(a,b.resolve(c.anchor),b.resolve(c.head))}function et(a,b,c){let d=a.depth,e=b?a.end():a.pos;for(;d>0&&(b||a.indexAfter(d)==a.node(d).childCount);)d--,e++,b=!1;if(c){let b=a.node(d).maybeChild(a.indexAfter(d));for(;b&&!b.isLeaf;)b=b.firstChild,e++}return e}function eu(a){if(2!=a.length)return!1;let b=a.charCodeAt(0),c=a.charCodeAt(1);return b>=56320&&b<=57343&&c>=55296&&c<=56319}class ev{constructor(a,b){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new dJ,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=b,this.state=b.state,this.directPlugins=b.plugins||[],this.directPlugins.forEach(eA),this.dispatch=this.dispatch.bind(this),this.dom=a&&a.mount||document.createElement("div"),a&&(a.appendChild?a.appendChild(this.dom):"function"==typeof a?a(this.dom):a.mount&&(this.mounted=!0)),this.editable=ey(this),ex(this),this.nodeViews=ez(this),this.docView=cV(this.state.doc,ew(this),ei(this),this.dom,this),this.domObserver=new em(this,(a,b,c,d)=>(function(a,b,c,d,e){let f,g,h,i=a.input.compositionPendingChanges||(a.composing?a.input.compositionID:0);if(a.input.compositionPendingChanges=0,b<0){let b=a.input.lastSelectionTime>Date.now()-50?a.input.lastSelectionOrigin:null,c=c7(a,b);if(c&&!a.state.selection.eq(c)){if(cq&&cw&&13===a.input.lastKeyCode&&Date.now()-100<a.input.lastKeyCodeTime&&a.someProp("handleKeyDown",b=>b(a,cf(13,"Enter"))))return;let d=a.state.tr.setSelection(c);"pointer"==b?d.setMeta("pointer",!0):"key"==b&&d.scrollIntoView(),i&&d.setMeta("composition",i),a.dispatch(d)}return}let j=a.state.doc.resolve(b),k=j.sharedDepth(c);b=j.before(k+1),c=a.state.doc.resolve(c).after(k+1);let l=a.state.selection,m=function(a,b,c){let d,{node:e,fromOffset:f,toOffset:g,from:h,to:i}=a.docView.parseRange(b,c),j=a.domSelectionRange(),k=j.anchorNode;if(k&&a.dom.contains(1==k.nodeType?k:k.parentNode)&&(d=[{node:k,offset:j.anchorOffset}],ce(j)||d.push({node:j.focusNode,offset:j.focusOffset})),cq&&8===a.input.lastKeyCode)for(let a=g;a>f;a--){let b=e.childNodes[a-1],c=b.pmViewDesc;if("BR"==b.nodeName&&!c){g=a;break}if(!c||c.size)break}let l=a.state.doc,m=a.someProp("domParser")||aw.fromSchema(a.state.schema),n=l.resolve(h),o=null,p=m.parse(e,{topNode:n.parent,topMatch:n.parent.contentMatchAt(n.index()),topOpen:!0,from:f,to:g,preserveWhitespace:"pre"!=n.parent.type.whitespace||"full",findPositions:d,ruleFromNode:eq,context:n});if(d&&null!=d[0].pos){let a=d[0].pos,b=d[1]&&d[1].pos;null==b&&(b=a),o={anchor:a+h,head:b+h}}return{doc:p,sel:o,from:h,to:i}}(a,b,c),n=a.state.doc,o=n.slice(m.from,m.to);8===a.input.lastKeyCode&&Date.now()-100<a.input.lastKeyCodeTime?(f=a.state.selection.to,g="end"):(f=a.state.selection.from,g="start"),a.input.lastKeyCode=null;let p=function(a,b,c,d,e){let f=a.findDiffStart(b,c);if(null==f)return null;let{a:g,b:h}=a.findDiffEnd(b,c+a.size,c+b.size);if("end"==e){let a=Math.max(0,f-Math.min(g,h));d-=g+a-f}if(g<f&&a.size<b.size){let a=d<=f&&d>=g?f-d:0;(f-=a)&&f<b.size&&eu(b.textBetween(f-1,f+1))&&(f+=a?1:-1),h=f+(h-g),g=f}else if(h<f){let b=d<=f&&d>=h?f-d:0;(f-=b)&&f<a.size&&eu(a.textBetween(f-1,f+1))&&(f+=b?1:-1),g=f+(g-h),h=f}return{start:f,endA:g,endB:h}}(o.content,m.doc.content,m.from,f,g);if(p&&a.input.domChangeCount++,(ct&&a.input.lastIOSEnter>Date.now()-225||cw)&&e.some(a=>1==a.nodeType&&!er.test(a.nodeName))&&(!p||p.endA>=p.endB)&&a.someProp("handleKeyDown",b=>b(a,cf(13,"Enter")))){a.input.lastIOSEnter=0;return}if(!p)if(d&&l instanceof bo&&!l.empty&&l.$head.sameParent(l.$anchor)&&!a.composing&&!(m.sel&&m.sel.anchor!=m.sel.head))p={start:l.from,endA:l.to,endB:l.to};else{if(m.sel){let b=es(a,a.state.doc,m.sel);if(b&&!b.eq(a.state.selection)){let c=a.state.tr.setSelection(b);i&&c.setMeta("composition",i),a.dispatch(c)}}return}a.state.selection.from<a.state.selection.to&&p.start==p.endB&&a.state.selection instanceof bo&&(p.start>a.state.selection.from&&p.start<=a.state.selection.from+2&&a.state.selection.from>=m.from?p.start=a.state.selection.from:p.endA<a.state.selection.to&&p.endA>=a.state.selection.to-2&&a.state.selection.to<=m.to&&(p.endB+=a.state.selection.to-p.endA,p.endA=a.state.selection.to)),cm&&cn<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>m.from&&" "==m.doc.textBetween(p.start-m.from-1,p.start-m.from+1)&&(p.start--,p.endA--,p.endB--);let q=m.doc.resolveNoCache(p.start-m.from),r=m.doc.resolveNoCache(p.endB-m.from),s=n.resolve(p.start),t=q.sameParent(r)&&q.parent.inlineContent&&s.end()>=p.endA;if((ct&&a.input.lastIOSEnter>Date.now()-225&&(!t||e.some(a=>"DIV"==a.nodeName||"P"==a.nodeName))||!t&&q.pos<m.doc.content.size&&(!q.sameParent(r)||!q.parent.inlineContent)&&q.pos<r.pos&&!/\S/.test(m.doc.textBetween(q.pos,r.pos,"","")))&&a.someProp("handleKeyDown",b=>b(a,cf(13,"Enter")))){a.input.lastIOSEnter=0;return}if(a.state.selection.anchor>p.start&&function(a,b,c,d,e){if(c-b<=e.pos-d.pos||et(d,!0,!1)<e.pos)return!1;let f=a.resolve(b);if(!d.parent.isTextblock){let a=f.nodeAfter;return null!=a&&c==b+a.nodeSize}if(f.parentOffset<f.parent.content.size||!f.parent.isTextblock)return!1;let g=a.resolve(et(f,!0,!0));return!(!g.parent.isTextblock||g.pos>c||et(g,!0,!1)<c)&&d.parent.content.cut(d.parentOffset).eq(g.parent.content)}(n,p.start,p.endA,q,r)&&a.someProp("handleKeyDown",b=>b(a,cf(8,"Backspace")))){cw&&cq&&a.domObserver.suppressSelectionUpdates();return}cq&&p.endB==p.start&&(a.input.lastChromeDelete=Date.now()),cw&&!t&&q.start()!=r.start()&&0==r.parentOffset&&q.depth==r.depth&&m.sel&&m.sel.anchor==m.sel.head&&m.sel.head==p.endA&&(p.endB-=2,r=m.doc.resolveNoCache(p.endB-m.from),setTimeout(()=>{a.someProp("handleKeyDown",function(b){return b(a,cf(13,"Enter"))})},20));let u=p.start,v=p.endA,w=b=>{let c=b||a.state.tr.replace(u,v,m.doc.slice(p.start-m.from,p.endB-m.from));if(m.sel){let b=es(a,c.doc,m.sel);b&&!(cq&&a.composing&&b.empty&&(p.start!=p.endB||a.input.lastChromeDelete<Date.now()-100)&&(b.head==u||b.head==c.mapping.map(v)-1)||cm&&b.empty&&b.head==u)&&c.setSelection(b)}return i&&c.setMeta("composition",i),c.scrollIntoView()};if(t)if(q.pos==r.pos){cm&&cn<=11&&0==q.parentOffset&&(a.domObserver.suppressSelectionUpdates(),setTimeout(()=>c9(a),20));let b=w(a.state.tr.delete(u,v)),c=n.resolve(p.start).marksAcross(n.resolve(p.endA));c&&b.ensureMarks(c),a.dispatch(b)}else if(p.endA==p.endB&&(h=function(a,b){let c=a.firstChild.marks,d=b.firstChild.marks,e=c,f=d,g,h,i;for(let a=0;a<d.length;a++)e=d[a].removeFromSet(e);for(let a=0;a<c.length;a++)f=c[a].removeFromSet(f);if(1==e.length&&0==f.length)h=e[0],g="add",i=a=>a.mark(h.addToSet(a.marks));else{if(0!=e.length||1!=f.length)return null;h=f[0],g="remove",i=a=>a.mark(h.removeFromSet(a.marks))}let j=[];for(let a=0;a<b.childCount;a++)j.push(i(b.child(a)));if(O.from(j).eq(a))return{mark:h,type:g}}(q.parent.content.cut(q.parentOffset,r.parentOffset),s.parent.content.cut(s.parentOffset,p.endA-s.start())))){let b=w(a.state.tr);"add"==h.type?b.addMark(u,v,h.mark):b.removeMark(u,v,h.mark),a.dispatch(b)}else if(q.parent.child(q.index()).isText&&q.index()==r.index()-!r.textOffset){let b=q.parent.textBetween(q.parentOffset,r.parentOffset),c=()=>w(a.state.tr.insertText(b,u,v));a.someProp("handleTextInput",d=>d(a,u,v,b,c))||a.dispatch(c())}else a.dispatch(w());else a.dispatch(w())})(this,a,b,c,d)),this.domObserver.start(),function(a){for(let b in dG){let c=dG[b];a.dom.addEventListener(b,a.input.eventHandlers[b]=b=>{!function(a,b){if(!b.bubbles)return!0;if(b.defaultPrevented)return!1;for(let c=b.target;c!=a.dom;c=c.parentNode)if(!c||11==c.nodeType||c.pmViewDesc&&c.pmViewDesc.stopEvent(b))return!1;return!0}(a,b)||dM(a,b)||!a.editable&&b.type in dH||c(a,b)},dI[b]?{passive:!0}:void 0)}cs&&a.dom.addEventListener("input",()=>null),dL(a)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let a=this._props;for(let b in this._props={},a)this._props[b]=a[b];this._props.state=this.state}return this._props}update(a){a.handleDOMEvents!=this._props.handleDOMEvents&&dL(this);let b=this._props;this._props=a,a.plugins&&(a.plugins.forEach(eA),this.directPlugins=a.plugins),this.updateStateInner(a.state,b)}setProps(a){let b={};for(let a in this._props)b[a]=this._props[a];for(let c in b.state=this.state,a)b[c]=a[c];this.update(b)}updateState(a){this.updateStateInner(a,this._props)}updateStateInner(a,b){var c,d,e;let f=this.state,g=!1,h=!1;a.storedMarks&&this.composing&&(dV(this),h=!0),this.state=a;let i=f.plugins!=a.plugins||this._props.plugins!=b.plugins;if(i||this._props.plugins!=b.plugins||this._props.nodeViews!=b.nodeViews){let a=ez(this);(function(a,b){let c=0,d=0;for(let d in a){if(a[d]!=b[d])return!0;c++}for(let a in b)d++;return c!=d})(a,this.nodeViews)&&(this.nodeViews=a,g=!0)}(i||b.handleDOMEvents!=this._props.handleDOMEvents)&&dL(this),this.editable=ey(this),ex(this);let j=ei(this),k=ew(this),l=f.plugins==a.plugins||f.doc.eq(a.doc)?a.scrollToSelection>f.scrollToSelection?"to selection":"preserve":"reset",m=g||!this.docView.matchesNode(a.doc,k,j);(m||!a.selection.eq(f.selection))&&(h=!0);let n="preserve"==l&&h&&null==this.dom.style.overflowAnchor&&function(a){let b,c,d=a.dom.getBoundingClientRect(),e=Math.max(0,d.top);for(let f=(d.left+d.right)/2,g=e+1;g<Math.min(innerHeight,d.bottom);g+=5){let d=a.root.elementFromPoint(f,g);if(!d||d==a.dom||!a.dom.contains(d))continue;let h=d.getBoundingClientRect();if(h.top>=e-20){b=d,c=h.top;break}}return{refDOM:b,refTop:c,stack:cB(a.dom)}}(this);if(h){let b,c,h;this.domObserver.stop();let i=m&&(cm||cq)&&!this.composing&&!f.selection.empty&&!a.selection.empty&&(d=f.selection,e=a.selection,h=Math.min(d.$anchor.sharedDepth(d.head),e.$anchor.sharedDepth(e.head)),d.$anchor.start(h)!=e.$anchor.start(h));if(m){let b=cq?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=function(a){let b=a.domSelectionRange();if(!b.focusNode)return null;let c=function(a,b){for(;;){if(3==a.nodeType&&b)return a;if(1==a.nodeType&&b>0){if("false"==a.contentEditable)return null;b=cc(a=a.childNodes[b-1])}else{if(!a.parentNode||cd(a))return null;b=b4(a),a=a.parentNode}}}(b.focusNode,b.focusOffset),d=function(a,b){for(;;){if(3==a.nodeType&&b<a.nodeValue.length)return a;if(1==a.nodeType&&b<a.childNodes.length){if("false"==a.contentEditable)return null;a=a.childNodes[b],b=0}else{if(!a.parentNode||cd(a))return null;b=b4(a)+1,a=a.parentNode}}}(b.focusNode,b.focusOffset);if(c&&d&&c!=d){let b=d.pmViewDesc,e=a.domObserver.lastChangedTextNode;if(c==e||d==e)return e;if(!b||!b.isText(d.nodeValue))return d;if(a.input.compositionNode==d){let a=c.pmViewDesc;if(!(!a||!a.isText(c.nodeValue)))return d}}return c||d}(this)),(g||!this.docView.update(a.doc,k,j,this))&&(this.docView.updateOuterDeco(k),this.docView.destroy(),this.docView=cV(a.doc,k,j,this.dom,this)),b&&!this.trackWrites&&(i=!0)}i||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&(b=this.docView.domFromPos(this.state.selection.anchor,0),c=this.domSelectionRange(),b9(b.node,b.offset,c.anchorNode,c.anchorOffset)))?c9(this,i):(de(this,a.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(f),(null==(c=this.dragging)?void 0:c.node)&&!f.doc.eq(a.doc)&&this.updateDraggedNode(this.dragging,f),"reset"==l?this.dom.scrollTop=0:"to selection"==l?this.scrollToSelection():n&&function({refDOM:a,refTop:b,stack:c}){let d=a?a.getBoundingClientRect().top:0;cC(c,0==d?0:d-b)}(n)}scrollToSelection(){let a=this.domSelectionRange().focusNode;if(a&&this.dom.contains(1==a.nodeType?a:a.parentNode))if(this.someProp("handleScrollToSelection",a=>a(this)));else if(this.state.selection instanceof bq){let b=this.docView.domAfterPos(this.state.selection.from);1==b.nodeType&&cA(this,b.getBoundingClientRect(),a)}else cA(this,this.coordsAtPos(this.state.selection.head,1),a)}destroyPluginViews(){let a;for(;a=this.pluginViews.pop();)a.destroy&&a.destroy()}updatePluginViews(a){if(a&&a.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let b=0;b<this.pluginViews.length;b++){let c=this.pluginViews[b];c.update&&c.update(this,a)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let a=0;a<this.directPlugins.length;a++){let b=this.directPlugins[a];b.spec.view&&this.pluginViews.push(b.spec.view(this))}for(let a=0;a<this.state.plugins.length;a++){let b=this.state.plugins[a];b.spec.view&&this.pluginViews.push(b.spec.view(this))}}}updateDraggedNode(a,b){let c=a.node,d=-1;if(this.state.doc.nodeAt(c.from)==c.node)d=c.from;else{let a=c.from+(this.state.doc.content.size-b.doc.content.size);(a>0&&this.state.doc.nodeAt(a))==c.node&&(d=a)}this.dragging=new d$(a.slice,a.move,d<0?void 0:bq.create(this.state.doc,d))}someProp(a,b){let c=this._props&&this._props[a],d;if(null!=c&&(d=b?b(c):c))return d;for(let c=0;c<this.directPlugins.length;c++){let e=this.directPlugins[c].props[a];if(null!=e&&(d=b?b(e):e))return d}let e=this.state.plugins;if(e)for(let c=0;c<e.length;c++){let f=e[c].props[a];if(null!=f&&(d=b?b(f):f))return d}}hasFocus(){if(cm){let a=this.root.activeElement;if(a==this.dom)return!0;if(!a||!this.dom.contains(a))return!1;for(;a&&this.dom!=a&&this.dom.contains(a);){if("false"==a.contentEditable)return!1;a=a.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(a){if(a.setActive)return a.setActive();if(cD)return a.focus(cD);let b=cB(a);a.focus(null==cD?{get preventScroll(){return cD={preventScroll:!0},!0}}:void 0),cD||(cD=!1,cC(b,0))}(this.dom),c9(this),this.domObserver.start()}get root(){let a=this._root;if(null==a){for(let a=this.dom.parentNode;a;a=a.parentNode)if(9==a.nodeType||11==a.nodeType&&a.host)return a.getSelection||(Object.getPrototypeOf(a).getSelection=()=>a.ownerDocument.getSelection()),this._root=a}return a||document}updateRoot(){this._root=null}posAtCoords(a){return function(a,b){var c;let d,e,f=a.dom.ownerDocument,g,h=0,i=function(a,b,c){if(a.caretPositionFromPoint)try{let d=a.caretPositionFromPoint(b,c);if(d)return{node:d.offsetNode,offset:Math.min(cc(d.offsetNode),d.offset)}}catch(a){}if(a.caretRangeFromPoint){let d=a.caretRangeFromPoint(b,c);if(d)return{node:d.startContainer,offset:Math.min(cc(d.startContainer),d.startOffset)}}}(f,b.left,b.top);i&&({node:g,offset:h}=i);let j=(a.root.elementFromPoint?a.root:f).elementFromPoint(b.left,b.top);if(!j||!a.dom.contains(1!=j.nodeType?j.parentNode:j)){let c=a.dom.getBoundingClientRect();if(!cE(b,c)||!(j=function a(b,c,d){let e=b.childNodes.length;if(e&&d.top<d.bottom)for(let f=Math.max(0,Math.min(e-1,Math.floor(e*(c.top-d.top)/(d.bottom-d.top))-2)),g=f;;){let d=b.childNodes[g];if(1==d.nodeType){let b=d.getClientRects();for(let e=0;e<b.length;e++){let f=b[e];if(cE(c,f))return a(d,c,f)}}if((g=(g+1)%e)==f)break}return b}(a.dom,b,c)))return null}if(cs)for(let a=j;g&&a;a=b5(a))a.draggable&&(g=void 0);if(j=(d=(c=j).parentNode)&&/^li$/i.test(d.nodeName)&&b.left<c.getBoundingClientRect().left?d:c,g){let c;if(co&&1==g.nodeType&&(h=Math.min(h,g.childNodes.length))<g.childNodes.length){let a=g.childNodes[h],c;"IMG"==a.nodeName&&(c=a.getBoundingClientRect()).right<=b.left&&c.bottom>b.top&&h++}cx&&h&&1==g.nodeType&&1==(c=g.childNodes[h-1]).nodeType&&"false"==c.contentEditable&&c.getBoundingClientRect().top>=b.top&&h--,g==a.dom&&h==g.childNodes.length-1&&1==g.lastChild.nodeType&&b.top>g.lastChild.getBoundingClientRect().bottom?e=a.state.doc.content.size:(0==h||1!=g.nodeType||"BR"!=g.childNodes[h-1].nodeName)&&(e=function(a,b,c,d){let e=-1;for(let c=b,f=!1;c!=a.dom;){let b=a.docView.nearestDesc(c,!0),g;if(!b)return null;if(1==b.dom.nodeType&&(b.node.isBlock&&b.parent||!b.contentDOM)&&((g=b.dom.getBoundingClientRect()).width||g.height)&&(b.node.isBlock&&b.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(b.dom.nodeName)&&(!f&&g.left>d.left||g.top>d.top?e=b.posBefore:(!f&&g.right<d.left||g.bottom<d.top)&&(e=b.posAfter),f=!0),!b.contentDOM&&e<0&&!b.node.isText))return(b.node.isBlock?d.top<(g.top+g.bottom)/2:d.left<(g.left+g.right)/2)?b.posBefore:b.posAfter;c=b.dom.parentNode}return e>-1?e:a.docView.posFromDOM(b,c,-1)}(a,g,h,b))}null==e&&(e=function(a,b,c){let{node:d,offset:e}=function a(b,c){let d,e,f,g=2e8,h,i=0,j=c.top,k=c.top;for(let a=b.firstChild,l=0;a;a=a.nextSibling,l++){let b;if(1==a.nodeType)b=a.getClientRects();else{if(3!=a.nodeType)continue;b=b7(a).getClientRects()}for(let m=0;m<b.length;m++){let n=b[m];if(n.top<=j&&n.bottom>=k){j=Math.max(n.bottom,j),k=Math.min(n.top,k);let b=n.left>c.left?n.left-c.left:n.right<c.left?c.left-n.right:0;if(b<g){f=a,g=b,h=b&&3==f.nodeType?{left:n.right<c.left?n.right:n.left,top:c.top}:c,1==a.nodeType&&b&&(i=l+ +(c.left>=(n.left+n.right)/2));continue}}else n.top>c.top&&!d&&n.left<=c.left&&n.right>=c.left&&(d=a,e={left:Math.max(n.left,Math.min(n.right,c.left)),top:n.top});!f&&(c.left>=n.right&&c.top>=n.top||c.left>=n.left&&c.top>=n.bottom)&&(i=l+1)}}return(!f&&d&&(f=d,h=e,g=0),f&&3==f.nodeType)?function(a,b){let c=a.nodeValue.length,d=document.createRange(),e;for(let f=0;f<c;f++){d.setEnd(a,f+1),d.setStart(a,f);let c=cG(d,1);if(c.top!=c.bottom&&cE(b,c)){e={node:a,offset:f+ +(b.left>=(c.left+c.right)/2)};break}}return d.detach(),e||{node:a,offset:0}}(f,h):!f||g&&1==f.nodeType?{node:b,offset:i}:a(f,h)}(b,c),f=-1;if(1==d.nodeType&&!d.firstChild){let a=d.getBoundingClientRect();f=a.left!=a.right&&c.left>(a.left+a.right)/2?1:-1}return a.docView.posFromDOM(d,e,f)}(a,j,b));let k=a.docView.nearestDesc(j,!0);return{pos:e,inside:k?k.posAtStart-k.border:-1}}(this,a)}coordsAtPos(a,b=1){return cI(this,a,b)}domAtPos(a,b=0){return this.docView.domFromPos(a,b)}nodeDOM(a){let b=this.docView.descAt(a);return b?b.nodeDOM:null}posAtDOM(a,b,c=-1){let d=this.docView.posFromDOM(a,b,c);if(null==d)throw RangeError("DOM position not inside the editor");return d}endOfTextblock(a,b){return function(a,b,c){let d,e;return cN==b&&cO==c?cP:(cN=b,cO=c,cP="up"==c||"down"==c?(d=b.selection,e="up"==c?d.$from:d.$to,cL(a,b,()=>{let{node:b}=a.docView.domFromPos(e.pos,"up"==c?-1:1);for(;;){let c=a.docView.nearestDesc(b,!0);if(!c)break;if(c.node.isBlock){b=c.contentDOM||c.dom;break}b=c.dom.parentNode}let d=cI(a,e.pos,1);for(let a=b.firstChild;a;a=a.nextSibling){let b;if(1==a.nodeType)b=a.getClientRects();else{if(3!=a.nodeType)continue;b=b7(a,0,a.nodeValue.length).getClientRects()}for(let a=0;a<b.length;a++){let e=b[a];if(e.bottom>e.top+1&&("up"==c?d.top-e.top>(e.bottom-d.top)*2:e.bottom-d.bottom>(d.bottom-e.top)*2))return!1}}return!0})):function(a,b,c){let{$head:d}=b.selection;if(!d.parent.isTextblock)return!1;let e=d.parentOffset,f=e==d.parent.content.size,g=a.domSelection();return g?cM.test(d.parent.textContent)&&g.modify?cL(a,b,()=>{let{focusNode:b,focusOffset:e,anchorNode:f,anchorOffset:h}=a.domSelectionRange(),i=g.caretBidiLevel;g.modify("move",c,"character");let j=d.depth?a.docView.domAfterPos(d.before()):a.dom,{focusNode:k,focusOffset:l}=a.domSelectionRange(),m=k&&!j.contains(1==k.nodeType?k:k.parentNode)||b==k&&e==l;try{g.collapse(f,h),b&&(b!=f||e!=h)&&g.extend&&g.extend(b,e)}catch(a){}return null!=i&&(g.caretBidiLevel=i),m}):"left"==c||"backward"==c?!e:f:d.pos==d.start()||d.pos==d.end()}(a,b,c))}(this,b||this.state,a)}pasteHTML(a,b){return dY(this,"",a,!1,b||new ClipboardEvent("paste"))}pasteText(a,b){return dY(this,a,null,!0,b||new ClipboardEvent("paste"))}serializeForClipboard(a){return dw(this,a)}destroy(){if(this.docView){for(let a in this.domObserver.stop(),this.input.eventHandlers)this.dom.removeEventListener(a,this.input.eventHandlers[a]);clearTimeout(this.input.composingTimeout),clearTimeout(this.input.lastIOSEnterFallbackTimeout),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],ei(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,b8()}}get isDestroyed(){return null==this.docView}dispatchEvent(a){!dM(this,a)&&dG[a.type]&&(this.editable||!(a.type in dH))&&dG[a.type](this,a)}domSelectionRange(){let a=this.domSelection();return a?cs&&11===this.root.nodeType&&function(a){let b=a.activeElement;for(;b&&b.shadowRoot;)b=b.shadowRoot.activeElement;return b}(this.dom.ownerDocument)==this.dom&&function(a,b){let c;if(b.getComposedRanges){let c=b.getComposedRanges(a.root)[0];if(c)return ep(a,c)}function d(a){a.preventDefault(),a.stopImmediatePropagation(),c=a.getTargetRanges()[0]}return a.dom.addEventListener("beforeinput",d,!0),document.execCommand("indent"),a.dom.removeEventListener("beforeinput",d,!0),c?ep(a,c):null}(this,a)||a:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}function ew(a){let b=Object.create(null);return b.class="ProseMirror",b.contenteditable=String(a.editable),a.someProp("attributes",c=>{if("function"==typeof c&&(c=c(a.state)),c)for(let a in c)"class"==a?b.class+=" "+c[a]:"style"==a?b.style=(b.style?b.style+";":"")+c[a]:b[a]||"contenteditable"==a||"nodeName"==a||(b[a]=String(c[a]))}),b.translate||(b.translate="no"),[d5.node(0,a.state.doc.content.size,b)]}function ex(a){if(a.markCursor){let b=document.createElement("img");b.className="ProseMirror-separator",b.setAttribute("mark-placeholder","true"),b.setAttribute("alt",""),a.cursorWrapper={dom:b,deco:d5.widget(a.state.selection.from,b,{raw:!0,marks:a.markCursor})}}else a.cursorWrapper=null}function ey(a){return!a.someProp("editable",b=>!1===b(a.state))}function ez(a){let b=Object.create(null);function c(a){for(let c in a)Object.prototype.hasOwnProperty.call(b,c)||(b[c]=a[c])}return a.someProp("nodeViews",c),a.someProp("markViews",c),b}function eA(a){if(a.spec.state||a.spec.filterTransaction||a.spec.appendTransaction)throw RangeError("Plugins passed directly to the view must not have a state component")}ev.prototype.dispatch=function(a){let b=this._props.dispatchTransaction;b?b.call(this,a):this.updateState(this.state.apply(a))};for(var eB={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},eC={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},eD="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),eE="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),eF=0;eF<10;eF++)eB[48+eF]=eB[96+eF]=String(eF);for(var eF=1;eF<=24;eF++)eB[eF+111]="F"+eF;for(var eF=65;eF<=90;eF++)eB[eF]=String.fromCharCode(eF+32),eC[eF]=String.fromCharCode(eF);for(var eG in eB)eC.hasOwnProperty(eG)||(eC[eG]=eB[eG]);let eH="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),eI="undefined"!=typeof navigator&&/Win/.test(navigator.platform);function eJ(a,b,c=!0){return b.altKey&&(a="Alt-"+a),b.ctrlKey&&(a="Ctrl-"+a),b.metaKey&&(a="Meta-"+a),c&&b.shiftKey&&(a="Shift-"+a),a}function eK(a){let b=function(a){let b=Object.create(null);for(let c in a)b[function(a){let b,c,d,e,f=a.split(/-(?!$)/),g=f[f.length-1];"Space"==g&&(g=" ");for(let a=0;a<f.length-1;a++){let g=f[a];if(/^(cmd|meta|m)$/i.test(g))e=!0;else if(/^a(lt)?$/i.test(g))b=!0;else if(/^(c|ctrl|control)$/i.test(g))c=!0;else if(/^s(hift)?$/i.test(g))d=!0;else if(/^mod$/i.test(g))eH?e=!0:c=!0;else throw Error("Unrecognized modifier name: "+g)}return b&&(g="Alt-"+g),c&&(g="Ctrl-"+g),e&&(g="Meta-"+g),d&&(g="Shift-"+g),g}(c)]=a[c];return b}(a);return function(a,c){var d;let e=("Esc"==(d=!(eD&&c.metaKey&&c.shiftKey&&!c.ctrlKey&&!c.altKey||eE&&c.shiftKey&&c.key&&1==c.key.length||"Unidentified"==c.key)&&c.key||(c.shiftKey?eC:eB)[c.keyCode]||c.key||"Unidentified")&&(d="Escape"),"Del"==d&&(d="Delete"),"Left"==d&&(d="ArrowLeft"),"Up"==d&&(d="ArrowUp"),"Right"==d&&(d="ArrowRight"),"Down"==d&&(d="ArrowDown"),d),f,g=b[eJ(e,c)];if(g&&g(a.state,a.dispatch,a))return!0;if(1==e.length&&" "!=e){if(c.shiftKey){let d=b[eJ(e,c,!1)];if(d&&d(a.state,a.dispatch,a))return!0}if((c.altKey||c.metaKey||c.ctrlKey)&&!(eI&&c.ctrlKey&&c.altKey)&&(f=eB[c.keyCode])&&f!=e){let d=b[eJ(f,c)];if(d&&d(a.state,a.dispatch,a))return!0}}return!1}}var eL=Object.defineProperty,eM=(a,b)=>{for(var c in b)eL(a,c,{get:b[c],enumerable:!0})};function eN(a){let{state:b,transaction:c}=a,{selection:d}=c,{doc:e}=c,{storedMarks:f}=c;return{...b,apply:b.apply.bind(b),applyTransaction:b.applyTransaction.bind(b),plugins:b.plugins,schema:b.schema,reconfigure:b.reconfigure.bind(b),toJSON:b.toJSON.bind(b),get storedMarks(){return f},get selection(){return d},get doc(){return e},get tr(){return d=c.selection,e=c.doc,f=c.storedMarks,c}}}var eO=class{constructor(a){this.editor=a.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=a.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){let{rawCommands:a,editor:b,state:c}=this,{view:d}=b,{tr:e}=c,f=this.buildProps(e);return Object.fromEntries(Object.entries(a).map(([a,b])=>[a,(...a)=>{let c=b(...a)(f);return e.getMeta("preventDispatch")||this.hasCustomState||d.dispatch(e),c}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(a,b=!0){let{rawCommands:c,editor:d,state:e}=this,{view:f}=d,g=[],h=!!a,i=a||e.tr,j=()=>(h||!b||i.getMeta("preventDispatch")||this.hasCustomState||f.dispatch(i),g.every(a=>!0===a)),k={...Object.fromEntries(Object.entries(c).map(([a,c])=>[a,(...a)=>{let d=this.buildProps(i,b),e=c(...a)(d);return g.push(e),k}])),run:j};return k}createCan(a){let{rawCommands:b,state:c}=this,d=a||c.tr,e=this.buildProps(d,!1);return{...Object.fromEntries(Object.entries(b).map(([a,b])=>[a,(...a)=>b(...a)({...e,dispatch:void 0})])),chain:()=>this.createChain(d,!1)}}buildProps(a,b=!0){let{rawCommands:c,editor:d,state:e}=this,{view:f}=d,g={tr:a,editor:d,view:f,state:eN({state:e,transaction:a}),dispatch:b?()=>void 0:void 0,chain:()=>this.createChain(a,b),can:()=>this.createCan(a),get commands(){return Object.fromEntries(Object.entries(c).map(([a,b])=>[a,(...a)=>b(...a)(g)]))}};return g}},eP={};eM(eP,{blur:()=>eQ,clearContent:()=>eR,clearNodes:()=>eS,command:()=>eT,createParagraphNear:()=>eU,cut:()=>eV,deleteCurrentNode:()=>eW,deleteNode:()=>eY,deleteRange:()=>eZ,deleteSelection:()=>e$,enter:()=>e_,exitCode:()=>e0,extendMarkRange:()=>e7,first:()=>e8,focus:()=>fe,forEach:()=>ff,insertContent:()=>fg,insertContentAt:()=>fj,joinBackward:()=>fm,joinDown:()=>fl,joinForward:()=>fn,joinItemBackward:()=>fo,joinItemForward:()=>fp,joinTextblockBackward:()=>fq,joinTextblockForward:()=>fr,joinUp:()=>fk,keyboardShortcut:()=>ft,lift:()=>fv,liftEmptyBlock:()=>fw,liftListItem:()=>fx,newlineInCode:()=>fy,resetAttributes:()=>fB,scrollIntoView:()=>fC,selectAll:()=>fD,selectNodeBackward:()=>fE,selectNodeForward:()=>fF,selectParentNode:()=>fG,selectTextblockEnd:()=>fH,selectTextblockStart:()=>fI,setContent:()=>fK,setMark:()=>gg,setMeta:()=>gh,setNode:()=>gi,setNodeSelection:()=>gj,setTextDirection:()=>gk,setTextSelection:()=>gl,sinkListItem:()=>gm,splitBlock:()=>go,splitListItem:()=>gp,toggleList:()=>gs,toggleMark:()=>gt,toggleNode:()=>gu,toggleWrap:()=>gv,undoInputRule:()=>gw,unsetAllMarks:()=>gx,unsetMark:()=>gy,unsetTextDirection:()=>gz,updateAttributes:()=>gA,wrapIn:()=>gB,wrapInList:()=>gC});var eQ=()=>({editor:a,view:b})=>(requestAnimationFrame(()=>{var c;a.isDestroyed||(b.dom.blur(),null==(c=null==window?void 0:window.getSelection())||c.removeAllRanges())}),!0),eR=(a=!0)=>({commands:b})=>b.setContent("",{emitUpdate:a}),eS=()=>({state:a,tr:b,dispatch:c})=>{let{selection:d}=b,{ranges:e}=d;return!c||(e.forEach(({$from:c,$to:d})=>{a.doc.nodesBetween(c.pos,d.pos,(a,c)=>{if(a.type.isText)return;let{doc:d,mapping:e}=b,f=d.resolve(e.map(c)),g=d.resolve(e.map(c+a.nodeSize)),h=f.blockRange(g);if(!h)return;let i=aZ(h);if(a.type.isTextblock){let{defaultType:a}=f.parent.contentMatchAt(f.index());b.setNodeMarkup(h.start,a)}(i||0===i)&&b.lift(h,i)})}),!0)},eT=a=>b=>a(b),eU=()=>({state:a,dispatch:b})=>bU(a,b),eV=(a,b)=>({editor:c,tr:d})=>{let{state:e}=c,f=e.doc.slice(a.from,a.to);d.deleteRange(a.from,a.to);let g=d.mapping.map(b);return d.insert(g,f.content),d.setSelection(new bo(d.doc.resolve(Math.max(g-1,0)))),!0},eW=()=>({tr:a,dispatch:b})=>{let{selection:c}=a,d=c.$anchor.node();if(d.content.size>0)return!1;let e=a.selection.$anchor;for(let c=e.depth;c>0;c-=1)if(e.node(c).type===d.type){if(b){let b=e.before(c),d=e.after(c);a.delete(b,d).scrollIntoView()}return!0}return!1};function eX(a,b){if("string"==typeof a){if(!b.nodes[a])throw Error(`There is no node type named '${a}'. Maybe you forgot to add the extension?`);return b.nodes[a]}return a}var eY=a=>({tr:b,state:c,dispatch:d})=>{let e=eX(a,c.schema),f=b.selection.$anchor;for(let a=f.depth;a>0;a-=1)if(f.node(a).type===e){if(d){let c=f.before(a),d=f.after(a);b.delete(c,d).scrollIntoView()}return!0}return!1},eZ=a=>({tr:b,dispatch:c})=>{let{from:d,to:e}=a;return c&&b.delete(d,e),!0},e$=()=>({state:a,dispatch:b})=>bG(a,b),e_=()=>({commands:a})=>a.keyboardShortcut("Enter"),e0=()=>({state:a,dispatch:b})=>bT(a,b);function e1(a){return"[object RegExp]"===Object.prototype.toString.call(a)}function e2(a,b,c={strict:!0}){let d=Object.keys(b);return!d.length||d.every(d=>c.strict?b[d]===a[d]:e1(b[d])?b[d].test(a[d]):b[d]===a[d])}function e3(a,b,c={}){return a.find(a=>a.type===b&&e2(Object.fromEntries(Object.keys(c).map(b=>[b,a.attrs[b]])),c))}function e4(a,b,c={}){return!!e3(a,b,c)}function e5(a,b,c){var d;if(!a||!b)return;let e=a.parent.childAfter(a.parentOffset);if(e.node&&e.node.marks.some(a=>a.type===b)||(e=a.parent.childBefore(a.parentOffset)),!e.node||!e.node.marks.some(a=>a.type===b)||(c=c||(null==(d=e.node.marks[0])?void 0:d.attrs),!e3([...e.node.marks],b,c)))return;let f=e.index,g=a.start()+e.offset,h=f+1,i=g+e.node.nodeSize;for(;f>0&&e4([...a.parent.child(f-1).marks],b,c);)f-=1,g-=a.parent.child(f).nodeSize;for(;h<a.parent.childCount&&e4([...a.parent.child(h).marks],b,c);)i+=a.parent.child(h).nodeSize,h+=1;return{from:g,to:i}}function e6(a,b){if("string"==typeof a){if(!b.marks[a])throw Error(`There is no mark type named '${a}'. Maybe you forgot to add the extension?`);return b.marks[a]}return a}var e7=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let f=e6(a,d.schema),{doc:g,selection:h}=c,{$from:i,from:j,to:k}=h;if(e){let a=e5(i,f,b);if(a&&a.from<=j&&a.to>=k){let b=bo.create(g,a.from,a.to);c.setSelection(b)}}return!0},e8=a=>b=>{let c="function"==typeof a?a(b):a;for(let a=0;a<c.length;a+=1)if(c[a](b))return!0;return!1};function e9(a){return a instanceof bo}function fa(a=0,b=0,c=0){return Math.min(Math.max(a,b),c)}function fb(a,b=null){if(!b)return null;let c=bk.atStart(a),d=bk.atEnd(a);if("start"===b||!0===b)return c;if("end"===b)return d;let e=c.from,f=d.to;return"all"===b?bo.create(a,fa(0,e,f),fa(a.content.size,e,f)):bo.create(a,fa(b,e,f),fa(b,e,f))}function fc(){return"Android"===navigator.platform||/android/i.test(navigator.userAgent)}function fd(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var fe=(a=null,b={})=>({editor:c,view:d,tr:e,dispatch:f})=>{b={scrollIntoView:!0,...b};let g=()=>{(fd()||fc())&&d.dom.focus(),requestAnimationFrame(()=>{!c.isDestroyed&&(d.focus(),(null==b?void 0:b.scrollIntoView)&&c.commands.scrollIntoView())})};if(d.hasFocus()&&null===a||!1===a)return!0;if(f&&null===a&&!e9(c.state.selection))return g(),!0;let h=fb(e.doc,a)||c.state.selection,i=c.state.selection.eq(h);return f&&(i||e.setSelection(h),i&&e.storedMarks&&e.setStoredMarks(e.storedMarks),g()),!0},ff=(a,b)=>c=>a.every((a,d)=>b(a,{...c,index:d})),fg=(a,b)=>({tr:c,commands:d})=>d.insertContentAt({from:c.selection.from,to:c.selection.to},a,b);function fh(a){throw Error("[tiptap error]: there is no window object available, so this function cannot be used")}function fi(a,b,c){if(a instanceof af||a instanceof O)return a;c={slice:!0,parseOptions:{},...c};let d="object"==typeof a&&null!==a,e="string"==typeof a;if(d)try{if(Array.isArray(a)&&a.length>0)return O.fromArray(a.map(a=>b.nodeFromJSON(a)));let d=b.nodeFromJSON(a);return c.errorOnInvalidContent&&d.check(),d}catch(d){if(c.errorOnInvalidContent)throw Error("[tiptap error]: Invalid JSON content",{cause:d});return console.warn("[tiptap warn]: Invalid content.","Passed value:",a,"Error:",d),fi("",b,c)}if(e){if(c.errorOnInvalidContent){let d=!1,e="",f=new au({topNode:b.spec.topNode,marks:b.spec.marks,nodes:b.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:a=>(d=!0,e="string"==typeof a?a:a.outerHTML,null)}]}})});if(c.slice?aw.fromSchema(f).parseSlice(fh(a),c.parseOptions):aw.fromSchema(f).parse(fh(a),c.parseOptions),c.errorOnInvalidContent&&d)throw Error("[tiptap error]: Invalid HTML content",{cause:Error(`Invalid element found: ${e}`)})}let d=aw.fromSchema(b);return c.slice?d.parseSlice(fh(a),c.parseOptions).content:d.parse(fh(a),c.parseOptions)}return fi("",b,c)}var fj=(a,b,c)=>({tr:d,dispatch:e,editor:f})=>{var g;if(e){let e,h;c={parseOptions:f.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...c};let i=a=>{f.emit("contentError",{editor:f,error:a,disableCollaboration:()=>{"collaboration"in f.storage&&"object"==typeof f.storage.collaboration&&f.storage.collaboration&&(f.storage.collaboration.isDisabled=!0)}})},j={preserveWhitespace:"full",...c.parseOptions};if(!c.errorOnInvalidContent&&!f.options.enableContentCheck&&f.options.emitContentError)try{fi(b,f.schema,{parseOptions:j,errorOnInvalidContent:!0})}catch(a){i(a)}try{e=fi(b,f.schema,{parseOptions:j,errorOnInvalidContent:null!=(g=c.errorOnInvalidContent)?g:f.options.enableContentCheck})}catch(a){return i(a),!1}let{from:k,to:l}="number"==typeof a?{from:a,to:a}:{from:a.from,to:a.to},m=!0,n=!0;if((!("type"in e)?e:[e]).forEach(a=>{a.check(),m=!!m&&a.isText&&0===a.marks.length,n=!!n&&a.isBlock}),k===l&&n){let{parent:a}=d.doc.resolve(k);!a.isTextblock||a.type.spec.code||a.childCount||(k-=1,l+=1)}if(m){if(Array.isArray(b))h=b.map(a=>a.text||"").join("");else if(b instanceof O){let a="";b.forEach(b=>{b.text&&(a+=b.text)}),h=a}else h="object"==typeof b&&b&&b.text?b.text:b;d.insertText(h,k,l)}else{h=e;let a=d.doc.resolve(k),b=a.node(),c=0===a.parentOffset,f=b.isText||b.isTextblock,g=b.content.size>0;c&&f&&g&&(k=Math.max(0,k-1)),d.replaceWith(k,l,h)}c.updateSelection&&function(a,b,c){let d=a.steps.length-1;if(d<b)return;let e=a.steps[d];if(!(e instanceof aV||e instanceof aW))return;let f=a.mapping.maps[d],g=0;f.forEach((a,b,c,d)=>{0===g&&(g=d)}),a.setSelection(bk.near(a.doc.resolve(g),-1))}(d,d.steps.length-1,0),c.applyInputRules&&d.setMeta("applyInputRules",{from:k,text:h}),c.applyPasteRules&&d.setMeta("applyPasteRules",{from:k,text:h})}return!0},fk=()=>({state:a,dispatch:b})=>((a,b)=>{let c=a.selection,d=c instanceof bq,e;if(d){if(c.node.isTextblock||!a3(a.doc,c.from))return!1;e=c.from}else if(null==(e=a5(a.doc,c.from,-1)))return!1;if(b){let c=a.tr.join(e);d&&c.setSelection(bq.create(c.doc,e-a.doc.resolve(e).nodeBefore.nodeSize)),b(c.scrollIntoView())}return!0})(a,b),fl=()=>({state:a,dispatch:b})=>((a,b)=>{let c=a.selection,d;if(c instanceof bq){if(c.node.isTextblock||!a3(a.doc,c.to))return!1;d=c.to}else if(null==(d=a5(a.doc,c.to,1)))return!1;return b&&b(a.tr.join(d).scrollIntoView()),!0})(a,b),fm=()=>({state:a,dispatch:b})=>bI(a,b),fn=()=>({state:a,dispatch:b})=>bO(a,b),fo=()=>({state:a,dispatch:b,tr:c})=>{try{let d=a5(a.doc,a.selection.$from.pos,-1);if(null==d)return!1;return c.join(d,2),b&&b(c),!0}catch{return!1}},fp=()=>({state:a,dispatch:b,tr:c})=>{try{let d=a5(a.doc,a.selection.$from.pos,1);if(null==d)return!1;return c.join(d,2),b&&b(c),!0}catch{return!1}},fq=()=>({state:a,dispatch:b})=>((a,b,c)=>{let d=bH(a,c);if(!d)return!1;let e=bM(d);return!!e&&bJ(a,e,b)})(a,b),fr=()=>({state:a,dispatch:b})=>((a,b,c)=>{let d=bN(a,c);if(!d)return!1;let e=bQ(d);return!!e&&bJ(a,e,b)})(a,b);function fs(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}var ft=a=>({editor:b,view:c,tr:d,dispatch:e})=>{let f=(function(a){let b,c,d,e,f=a.split(/-(?!$)/),g=f[f.length-1];"Space"===g&&(g=" ");for(let a=0;a<f.length-1;a+=1){let g=f[a];if(/^(cmd|meta|m)$/i.test(g))e=!0;else if(/^a(lt)?$/i.test(g))b=!0;else if(/^(c|ctrl|control)$/i.test(g))c=!0;else if(/^s(hift)?$/i.test(g))d=!0;else if(/^mod$/i.test(g))fd()||fs()?e=!0:c=!0;else throw Error(`Unrecognized modifier name: ${g}`)}return b&&(g=`Alt-${g}`),c&&(g=`Ctrl-${g}`),e&&(g=`Meta-${g}`),d&&(g=`Shift-${g}`),g})(a).split(/-(?!$)/),g=f.find(a=>!["Alt","Ctrl","Meta","Shift"].includes(a)),h=new KeyboardEvent("keydown",{key:"Space"===g?" ":g,altKey:f.includes("Alt"),ctrlKey:f.includes("Ctrl"),metaKey:f.includes("Meta"),shiftKey:f.includes("Shift"),bubbles:!0,cancelable:!0}),i=b.captureTransaction(()=>{c.someProp("handleKeyDown",a=>a(c,h))});return null==i||i.steps.forEach(a=>{let b=a.map(d.mapping);b&&e&&d.maybeStep(b)}),!0};function fu(a,b,c={}){let{from:d,to:e,empty:f}=a.selection,g=b?eX(b,a.schema):null,h=[];a.doc.nodesBetween(d,e,(a,b)=>{if(a.isText)return;let c=Math.max(d,b),f=Math.min(e,b+a.nodeSize);h.push({node:a,from:c,to:f})});let i=e-d,j=h.filter(a=>!g||g.name===a.node.type.name).filter(a=>e2(a.node.attrs,c,{strict:!1}));return f?!!j.length:j.reduce((a,b)=>a+b.to-b.from,0)>=i}var fv=(a,b={})=>({state:c,dispatch:d})=>{let e=eX(a,c.schema);return!!fu(c,e,b)&&((a,b)=>{let{$from:c,$to:d}=a.selection,e=c.blockRange(d),f=e&&aZ(e);return null!=f&&(b&&b(a.tr.lift(e,f).scrollIntoView()),!0)})(c,d)},fw=()=>({state:a,dispatch:b})=>bV(a,b),fx=a=>({state:b,dispatch:c})=>{var d;return(d=eX(a,b.schema),function(a,b){let{$from:c,$to:e}=a.selection,f=c.blockRange(e,a=>a.childCount>0&&a.firstChild.type==d);return!!f&&(!b||(c.node(f.depth-1).type==d?function(a,b,c,d){let e=a.tr,f=d.end,g=d.$to.end(d.depth);f<g&&(e.step(new aW(f-1,g,f,g,new U(O.from(c.create(null,d.parent.copy())),1,0),1,!0)),d=new ad(e.doc.resolve(d.$from.pos),e.doc.resolve(g),d.depth));let h=aZ(d);if(null==h)return!1;e.lift(d,h);let i=e.doc.resolve(e.mapping.map(f,-1)-1);return a3(e.doc,i.pos)&&i.nodeBefore.type==i.nodeAfter.type&&e.join(i.pos),b(e.scrollIntoView()),!0}(a,b,d,f):function(a,b,c){let d=a.tr,e=c.parent;for(let a=c.end,b=c.endIndex-1,f=c.startIndex;b>f;b--)a-=e.child(b).nodeSize,d.delete(a-1,a+1);let f=d.doc.resolve(c.start),g=f.nodeAfter;if(d.mapping.map(c.end)!=c.start+f.nodeAfter.nodeSize)return!1;let h=0==c.startIndex,i=c.endIndex==e.childCount,j=f.node(-1),k=f.index(-1);if(!j.canReplace(k+ +!h,k+1,g.content.append(i?O.empty:O.from(e))))return!1;let l=f.pos,m=l+g.nodeSize;return d.step(new aW(l-!!h,m+ +!!i,l+1,m-1,new U((h?O.empty:O.from(e.copy(O.empty))).append(i?O.empty:O.from(e.copy(O.empty))),+!h,+!i),+!h)),b(d.scrollIntoView()),!0}(a,b,f)))})(b,c)},fy=()=>({state:a,dispatch:b})=>bR(a,b);function fz(a,b){return b.nodes[a]?"node":b.marks[a]?"mark":null}function fA(a,b){let c="string"==typeof b?[b]:b;return Object.keys(a).reduce((b,d)=>(c.includes(d)||(b[d]=a[d]),b),{})}var fB=(a,b)=>({tr:c,state:d,dispatch:e})=>{let f=null,g=null,h=fz("string"==typeof a?a:a.name,d.schema);if(!h)return!1;"node"===h&&(f=eX(a,d.schema)),"mark"===h&&(g=e6(a,d.schema));let i=!1;return c.selection.ranges.forEach(a=>{d.doc.nodesBetween(a.$from.pos,a.$to.pos,(a,d)=>{f&&f===a.type&&(i=!0,e&&c.setNodeMarkup(d,void 0,fA(a.attrs,b))),g&&a.marks.length&&a.marks.forEach(f=>{g===f.type&&(i=!0,e&&c.addMark(d,d+a.nodeSize,g.create(fA(f.attrs,b))))})})}),i},fC=()=>({tr:a,dispatch:b})=>(b&&a.scrollIntoView(),!0),fD=()=>({tr:a,dispatch:b})=>{if(b){let b=new bs(a.doc);a.setSelection(b)}return!0},fE=()=>({state:a,dispatch:b})=>bL(a,b),fF=()=>({state:a,dispatch:b})=>bP(a,b),fG=()=>({state:a,dispatch:b})=>((a,b)=>{let{$from:c,to:d}=a.selection,e,f=c.sharedDepth(d);return 0!=f&&(e=c.before(f),b&&b(a.tr.setSelection(bq.create(a.doc,e))),!0)})(a,b),fH=()=>({state:a,dispatch:b})=>bZ(a,b),fI=()=>({state:a,dispatch:b})=>bY(a,b);function fJ(a,b,c={},d={}){return fi(a,b,{slice:!1,parseOptions:c,errorOnInvalidContent:d.errorOnInvalidContent})}var fK=(a,{errorOnInvalidContent:b,emitUpdate:c=!0,parseOptions:d={}}={})=>({editor:e,tr:f,dispatch:g,commands:h})=>{let{doc:i}=f;if("full"!==d.preserveWhitespace){let h=fJ(a,e.schema,d,{errorOnInvalidContent:null!=b?b:e.options.enableContentCheck});return g&&f.replaceWith(0,i.content.size,h).setMeta("preventUpdate",!c),!0}return g&&f.setMeta("preventUpdate",!c),h.insertContentAt({from:0,to:i.content.size},a,{parseOptions:d,errorOnInvalidContent:null!=b?b:e.options.enableContentCheck})};function fL(a,b){let c=e6(b,a.schema),{from:d,to:e,empty:f}=a.selection,g=[];f?(a.storedMarks&&g.push(...a.storedMarks),g.push(...a.selection.$head.marks())):a.doc.nodesBetween(d,e,a=>{g.push(...a.marks)});let h=g.find(a=>a.type.name===c.name);return h?{...h.attrs}:{}}function fM(a,b){let c=new bi(a);return b.forEach(a=>{a.steps.forEach(a=>{c.step(a)})}),c}function fN(a,b){for(let c=a.depth;c>0;c-=1){let d=a.node(c);if(b(d))return{pos:c>0?a.before(c):0,start:a.start(c),depth:c,node:d}}}function fO(a){return b=>fN(b.$from,a)}function fP(a,b,c){return void 0===a.config[b]&&a.parent?fP(a.parent,b,c):"function"==typeof a.config[b]?a.config[b].bind({...c,parent:a.parent?fP(a.parent,b,c):null}):a.config[b]}function fQ(a){return a.map(a=>{let b={name:a.name,options:a.options,storage:a.storage},c=fP(a,"addExtensions",b);return c?[a,...fQ(c())]:a}).flat(10)}function fR(a,b){let c=aF.fromSchema(b).serializeFragment(a),d=document.implementation.createHTMLDocument().createElement("div");return d.appendChild(c),d.innerHTML}function fS(a){return"function"==typeof a}function fT(a,b,...c){return fS(a)?b?a.bind(b)(...c):a(...c):a}function fU(a){let b=a.filter(a=>"extension"===a.type);return{baseExtensions:b,nodeExtensions:a.filter(a=>"node"===a.type),markExtensions:a.filter(a=>"mark"===a.type)}}function fV(a){let b=[],{nodeExtensions:c,markExtensions:d}=fU(a),e=[...c,...d],f={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return a.forEach(a=>{let c={name:a.name,options:a.options,storage:a.storage,extensions:e},d=fP(a,"addGlobalAttributes",c);d&&d().forEach(a=>{a.types.forEach(c=>{Object.entries(a.attributes).forEach(([a,d])=>{b.push({type:c,name:a,attribute:{...f,...d}})})})})}),e.forEach(a=>{let c={name:a.name,options:a.options,storage:a.storage},d=fP(a,"addAttributes",c);d&&Object.entries(d()).forEach(([c,d])=>{let e={...f,...d};"function"==typeof(null==e?void 0:e.default)&&(e.default=e.default()),(null==e?void 0:e.isRequired)&&(null==e?void 0:e.default)===void 0&&delete e.default,b.push({type:a.name,name:c,attribute:e})})}),b}function fW(...a){return a.filter(a=>!!a).reduce((a,b)=>{let c={...a};return Object.entries(b).forEach(([a,b])=>{if(!c[a]){c[a]=b;return}if("class"===a){let d=b?String(b).split(" "):[],e=c[a]?c[a].split(" "):[],f=d.filter(a=>!e.includes(a));c[a]=[...e,...f].join(" ")}else if("style"===a){let d=b?b.split(";").map(a=>a.trim()).filter(Boolean):[],e=c[a]?c[a].split(";").map(a=>a.trim()).filter(Boolean):[],f=new Map;e.forEach(a=>{let[b,c]=a.split(":").map(a=>a.trim());f.set(b,c)}),d.forEach(a=>{let[b,c]=a.split(":").map(a=>a.trim());f.set(b,c)}),c[a]=Array.from(f.entries()).map(([a,b])=>`${a}: ${b}`).join("; ")}else c[a]=b}),c},{})}function fX(a,b){return b.filter(b=>b.type===a.type.name).filter(a=>a.attribute.rendered).map(b=>b.attribute.renderHTML?b.attribute.renderHTML(a.attrs)||{}:{[b.name]:a.attrs[b.name]}).reduce((a,b)=>fW(a,b),{})}function fY(a,b){return"style"in a?a:{...a,getAttrs:c=>{let d=a.getAttrs?a.getAttrs(c):a.attrs;if(!1===d)return!1;let e=b.reduce((a,b)=>{var d;let e=b.attribute.parseHTML?b.attribute.parseHTML(c):"string"!=typeof(d=c.getAttribute(b.name))?d:d.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(d):"true"===d||"false"!==d&&d;return null==e?a:{...a,[b.name]:e}},{});return{...d,...e}}}}function fZ(a){return Object.fromEntries(Object.entries(a).filter(([a,b])=>!("attrs"===a&&function(a={}){return 0===Object.keys(a).length&&a.constructor===Object}(b))&&null!=b))}function f$(a){var b,c;let d={};return!(null==(b=null==a?void 0:a.attribute)?void 0:b.isRequired)&&"default"in((null==a?void 0:a.attribute)||{})&&(d.default=a.attribute.default),(null==(c=null==a?void 0:a.attribute)?void 0:c.validate)!==void 0&&(d.validate=a.attribute.validate),[a.name,d]}function f_(a){return a.sort((a,b)=>{let c=fP(a,"priority")||100,d=fP(b,"priority")||100;return c>d?-1:+(c<d)})}function f0(a){var b;let c=f_(fQ(a)),d=Array.from(new Set((b=c.map(a=>a.name)).filter((a,c)=>b.indexOf(a)!==c)));return d.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${d.map(a=>`'${a}'`).join(", ")}]. This can lead to issues.`),c}function f1(a,b,c){let{from:d,to:e}=b,{blockSeparator:f="\n\n",textSerializers:g={}}=c||{},h="";return a.nodesBetween(d,e,(a,c,i,j)=>{var k;a.isBlock&&c>d&&(h+=f);let l=null==g?void 0:g[a.type.name];if(l)return i&&(h+=l({node:a,pos:c,parent:i,index:j,range:b})),!1;a.isText&&(h+=null==(k=null==a?void 0:a.text)?void 0:k.slice(Math.max(d,c)-c,e-c))}),h}function f2(a){return Object.fromEntries(Object.entries(a.nodes).filter(([,a])=>a.spec.toText).map(([a,b])=>[a,b.spec.toText]))}function f3(a,b){let c=fz("string"==typeof b?b:b.name,a.schema);return"node"===c?function(a,b){let c=eX(b,a.schema),{from:d,to:e}=a.selection,f=[];a.doc.nodesBetween(d,e,a=>{f.push(a)});let g=f.reverse().find(a=>a.type.name===c.name);return g?{...g.attrs}:{}}(a,b):"mark"===c?fL(a,b):{}}function f4(a){let b,{mapping:c,steps:d}=a,e=[];return c.maps.forEach((a,b)=>{let f=[];if(a.ranges.length)a.forEach((a,b)=>{f.push({from:a,to:b})});else{let{from:a,to:c}=d[b];if(void 0===a||void 0===c)return;f.push({from:a,to:c})}f.forEach(({from:a,to:d})=>{let f=c.slice(b).map(a,-1),g=c.slice(b).map(d),h=c.invert().map(f,-1),i=c.invert().map(g);e.push({oldRange:{from:h,to:i},newRange:{from:f,to:g}})})}),1===(b=function(a,b=JSON.stringify){let c={};return a.filter(a=>{let d=b(a);return!Object.prototype.hasOwnProperty.call(c,d)&&(c[d]=!0)})}(e)).length?b:b.filter((a,c)=>!b.filter((a,b)=>b!==c).some(b=>a.oldRange.from>=b.oldRange.from&&a.oldRange.to<=b.oldRange.to&&a.newRange.from>=b.newRange.from&&a.newRange.to<=b.newRange.to))}function f5(a,b,c){let d=[];return a===b?c.resolve(a).marks().forEach(b=>{let e=e5(c.resolve(a),b.type);e&&d.push({mark:b,...e})}):c.nodesBetween(a,b,(a,b)=>{a&&(null==a?void 0:a.nodeSize)!==void 0&&d.push(...a.marks.map(c=>({from:b,to:b+a.nodeSize,mark:c})))}),d}function f6(a,b){return b.nodes[a]||b.marks[a]||null}function f7(a,b,c){return Object.fromEntries(Object.entries(c).filter(([c])=>{let d=a.find(a=>a.type===b&&a.name===c);return!!d&&d.attribute.keepOnSplit}))}function f8(a,b,c={}){let{empty:d,ranges:e}=a.selection,f=b?e6(b,a.schema):null;if(d)return!!(a.storedMarks||a.selection.$from.marks()).filter(a=>!f||f.name===a.type.name).find(a=>e2(a.attrs,c,{strict:!1}));let g=0,h=[];if(e.forEach(({$from:b,$to:c})=>{let d=b.pos,e=c.pos;a.doc.nodesBetween(d,e,(a,b)=>{if(!a.isText&&!a.marks.length)return;let c=Math.max(d,b),f=Math.min(e,b+a.nodeSize);g+=f-c,h.push(...a.marks.map(a=>({mark:a,from:c,to:f})))})}),0===g)return!1;let i=h.filter(a=>!f||f.name===a.mark.type.name).filter(a=>e2(a.mark.attrs,c,{strict:!1})).reduce((a,b)=>a+b.to-b.from,0),j=h.filter(a=>!f||a.mark.type!==f&&a.mark.type.excludes(f)).reduce((a,b)=>a+b.to-b.from,0);return(i>0?i+j:i)>=g}function f9(a,b){return Array.isArray(b)?b.some(b=>("string"==typeof b?b:b.name)===a.name):b}function ga(a,b){let{nodeExtensions:c}=fU(b),d=c.find(b=>b.name===a);if(!d)return!1;let e={name:d.name,options:d.options,storage:d.storage},f=fT(fP(d,"group",e));return"string"==typeof f&&f.split(" ").includes("list")}function gb(a,{checkChildren:b=!0,ignoreWhitespace:c=!1}={}){var d;if(c){if("hardBreak"===a.type.name)return!0;if(a.isText)return/^\s*$/m.test(null!=(d=a.text)?d:"")}if(a.isText)return!a.text;if(a.isAtom||a.isLeaf)return!1;if(0===a.content.childCount)return!0;if(b){let d=!0;return a.content.forEach(a=>{!1!==d&&(gb(a,{ignoreWhitespace:c,checkChildren:b})||(d=!1))}),d}return!1}function gc(a){return a instanceof bq}var gd=class a{constructor(a){this.position=a}static fromJSON(b){return new a(b.position)}toJSON(){return{position:this.position}}};function ge(a,b){let c=b.mapping.mapResult(a.position);return{position:new gd(c.pos),mapResult:c}}function gf(a){return new gd(a)}var gg=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let{selection:f}=c,{empty:g,ranges:h}=f,i=e6(a,d.schema);if(e)if(g){let a=fL(d,i);c.addStoredMark(i.create({...a,...b}))}else h.forEach(a=>{let e=a.$from.pos,f=a.$to.pos;d.doc.nodesBetween(e,f,(a,d)=>{let g=Math.max(d,e),h=Math.min(d+a.nodeSize,f);a.marks.find(a=>a.type===i)?a.marks.forEach(a=>{i===a.type&&c.addMark(g,h,i.create({...a.attrs,...b}))}):c.addMark(g,h,i.create(b))})});return function(a,b,c){var d;let{selection:e}=b,f=null;if(e9(e)&&(f=e.$cursor),f){let b=null!=(d=a.storedMarks)?d:f.marks();return f.parent.type.allowsMarkType(c)&&(!!c.isInSet(b)||!b.some(a=>a.type.excludes(c)))}let{ranges:g}=e;return g.some(({$from:b,$to:d})=>{let e=0===b.depth&&a.doc.inlineContent&&a.doc.type.allowsMarkType(c);return a.doc.nodesBetween(b.pos,d.pos,(a,b,d)=>{if(e)return!1;if(a.isInline){let b=!d||d.type.allowsMarkType(c),f=!!c.isInSet(a.marks)||!a.marks.some(a=>a.type.excludes(c));e=b&&f}return!e}),e})}(d,c,i)},gh=(a,b)=>({tr:c})=>(c.setMeta(a,b),!0),gi=(a,b={})=>({state:c,dispatch:d,chain:e})=>{let f,g=eX(a,c.schema);return(c.selection.$anchor.sameParent(c.selection.$head)&&(f=c.selection.$anchor.parent.attrs),g.isTextblock)?e().command(({commands:a})=>!!b$(g,{...f,...b})(c)||a.clearNodes()).command(({state:a})=>b$(g,{...f,...b})(a,d)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},gj=a=>({tr:b,dispatch:c})=>{if(c){let{doc:c}=b,d=fa(a,0,c.content.size),e=bq.create(c,d);b.setSelection(e)}return!0},gk=(a,b)=>({tr:c,state:d,dispatch:e})=>{let f,g,{selection:h}=d;return"number"==typeof b?(f=b,g=b):b&&"from"in b&&"to"in b?(f=b.from,g=b.to):(f=h.from,g=h.to),e&&c.doc.nodesBetween(f,g,(b,d)=>{b.isText||c.setNodeMarkup(d,void 0,{...b.attrs,dir:a})}),!0},gl=a=>({tr:b,dispatch:c})=>{if(c){let{doc:c}=b,{from:d,to:e}="number"==typeof a?{from:a,to:a}:a,f=bo.atStart(c).from,g=bo.atEnd(c).to,h=fa(d,f,g),i=fa(e,f,g),j=bo.create(c,h,i);b.setSelection(j)}return!0},gm=a=>({state:b,dispatch:c})=>{var d;return(d=eX(a,b.schema),function(a,b){let{$from:c,$to:e}=a.selection,f=c.blockRange(e,a=>a.childCount>0&&a.firstChild.type==d);if(!f)return!1;let g=f.startIndex;if(0==g)return!1;let h=f.parent,i=h.child(g-1);if(i.type!=d)return!1;if(b){let c=i.lastChild&&i.lastChild.type==h.type,e=O.from(c?d.create():null),g=new U(O.from(d.create(null,O.from(h.type.create(null,e)))),c?3:1,0),j=f.start,k=f.end;b(a.tr.step(new aW(j-(c?3:1),k,j,k,g,1,!0)).scrollIntoView())}return!0})(b,c)};function gn(a,b){let c=a.storedMarks||a.selection.$to.parentOffset&&a.selection.$from.marks();if(c){let d=c.filter(a=>null==b?void 0:b.includes(a.type.name));a.tr.ensureMarks(d)}}var go=({keepMarks:a=!0}={})=>({tr:b,state:c,dispatch:d,editor:e})=>{let{selection:f,doc:g}=b,{$from:h,$to:i}=f,j=f7(e.extensionManager.attributes,h.node().type.name,h.node().attrs);if(f instanceof bq&&f.node.isBlock)return!!h.parentOffset&&!!a2(g,h.pos)&&(d&&(a&&gn(c,e.extensionManager.splittableMarks),b.split(h.pos).scrollIntoView()),!0);if(!h.parent.isBlock)return!1;let k=i.parentOffset===i.parent.content.size,l=0===h.depth?void 0:function(a){for(let b=0;b<a.edgeCount;b+=1){let{type:c}=a.edge(b);if(c.isTextblock&&!c.hasRequiredAttrs())return c}return null}(h.node(-1).contentMatchAt(h.indexAfter(-1))),m=k&&l?[{type:l,attrs:j}]:void 0,n=a2(b.doc,b.mapping.map(h.pos),1,m);if(!m&&!n&&a2(b.doc,b.mapping.map(h.pos),1,l?[{type:l}]:void 0)&&(n=!0,m=l?[{type:l,attrs:j}]:void 0),d){if(n&&(f instanceof bo&&b.deleteSelection(),b.split(b.mapping.map(h.pos),1,m),l&&!k&&!h.parentOffset&&h.parent.type!==l)){let a=b.mapping.map(h.before()),c=b.doc.resolve(a);h.node(-1).canReplaceWith(c.index(),c.index()+1,l)&&b.setNodeMarkup(b.mapping.map(h.before()),l)}a&&gn(c,e.extensionManager.splittableMarks),b.scrollIntoView()}return n},gp=(a,b={})=>({tr:c,state:d,dispatch:e,editor:f})=>{var g;let h=eX(a,d.schema),{$from:i,$to:j}=d.selection,k=d.selection.node;if(k&&k.isBlock||i.depth<2||!i.sameParent(j))return!1;let l=i.node(-1);if(l.type!==h)return!1;let m=f.extensionManager.attributes;if(0===i.parent.content.size&&i.node(-1).childCount===i.indexAfter(-1)){if(2===i.depth||i.node(-3).type!==h||i.index(-2)!==i.node(-2).childCount-1)return!1;if(e){let a=O.empty,d=i.index(-1)?1:i.index(-2)?2:3;for(let b=i.depth-d;b>=i.depth-3;b-=1)a=O.from(i.node(b).copy(a));let e=i.indexAfter(-1)<i.node(-2).childCount?1:i.indexAfter(-2)<i.node(-3).childCount?2:3,f={...f7(m,i.node().type.name,i.node().attrs),...b},j=(null==(g=h.contentMatch.defaultType)?void 0:g.createAndFill(f))||void 0;a=a.append(O.from(h.createAndFill(null,j)||void 0));let k=i.before(i.depth-(d-1));c.replace(k,i.after(-e),new U(a,4-d,0));let l=-1;c.doc.nodesBetween(k,c.doc.content.size,(a,b)=>{if(l>-1)return!1;a.isTextblock&&0===a.content.size&&(l=b+1)}),l>-1&&c.setSelection(bo.near(c.doc.resolve(l))),c.scrollIntoView()}return!0}let n=j.pos===i.end()?l.contentMatchAt(0).defaultType:null,o={...f7(m,l.type.name,l.attrs),...b},p={...f7(m,i.node().type.name,i.node().attrs),...b};c.delete(i.pos,j.pos);let q=n?[{type:h,attrs:o},{type:n,attrs:p}]:[{type:h,attrs:o}];if(!a2(c.doc,i.pos,2))return!1;if(e){let{selection:a,storedMarks:b}=d,{splittableMarks:g}=f.extensionManager,h=b||a.$to.parentOffset&&a.$from.marks();if(c.split(i.pos,2,q).scrollIntoView(),!h||!e)return!0;let j=h.filter(a=>g.includes(a.type.name));c.ensureMarks(j)}return!0},gq=(a,b)=>{let c=fO(a=>a.type===b)(a.selection);if(!c)return!0;let d=a.doc.resolve(Math.max(0,c.pos-1)).before(c.depth);if(void 0===d)return!0;let e=a.doc.nodeAt(d);return!(c.node.type===(null==e?void 0:e.type)&&a3(a.doc,c.pos))||(a.join(c.pos),!0)},gr=(a,b)=>{let c=fO(a=>a.type===b)(a.selection);if(!c)return!0;let d=a.doc.resolve(c.start).after(c.depth);if(void 0===d)return!0;let e=a.doc.nodeAt(d);return!(c.node.type===(null==e?void 0:e.type)&&a3(a.doc,d))||(a.join(d),!0)},gs=(a,b,c,d={})=>({editor:e,tr:f,state:g,dispatch:h,chain:i,commands:j,can:k})=>{let{extensions:l,splittableMarks:m}=e.extensionManager,n=eX(a,g.schema),o=eX(b,g.schema),{selection:p,storedMarks:q}=g,{$from:r,$to:s}=p,t=r.blockRange(s),u=q||p.$to.parentOffset&&p.$from.marks();if(!t)return!1;let v=fO(a=>ga(a.type.name,l))(p);if(t.depth>=1&&v&&t.depth-v.depth<=1){if(v.node.type===n)return j.liftListItem(o);if(ga(v.node.type.name,l)&&n.validContent(v.node.content)&&h)return i().command(()=>(f.setNodeMarkup(v.pos,n),!0)).command(()=>gq(f,n)).command(()=>gr(f,n)).run()}return c&&u&&h?i().command(()=>{let a=k().wrapInList(n,d),b=u.filter(a=>m.includes(a.type.name));return f.ensureMarks(b),!!a||j.clearNodes()}).wrapInList(n,d).command(()=>gq(f,n)).command(()=>gr(f,n)).run():i().command(()=>!!k().wrapInList(n,d)||j.clearNodes()).wrapInList(n,d).command(()=>gq(f,n)).command(()=>gr(f,n)).run()},gt=(a,b={},c={})=>({state:d,commands:e})=>{let{extendEmptyMarkRange:f=!1}=c,g=e6(a,d.schema);return f8(d,g,b)?e.unsetMark(g,{extendEmptyMarkRange:f}):e.setMark(g,b)},gu=(a,b,c={})=>({state:d,commands:e})=>{let f,g=eX(a,d.schema),h=eX(b,d.schema),i=fu(d,g,c);return(d.selection.$anchor.sameParent(d.selection.$head)&&(f=d.selection.$anchor.parent.attrs),i)?e.setNode(h,f):e.setNode(g,{...f,...c})},gv=(a,b={})=>({state:c,commands:d})=>{let e=eX(a,c.schema);return fu(c,e,b)?d.lift(e):d.wrapIn(e,b)},gw=()=>({state:a,dispatch:b})=>{let c=a.plugins;for(let d=0;d<c.length;d+=1){let e,f=c[d];if(f.spec.isInputRules&&(e=f.getState(a))){if(b){let b=a.tr,c=e.transform;for(let a=c.steps.length-1;a>=0;a-=1)b.step(c.steps[a].invert(c.docs[a]));if(e.text){let c=b.doc.resolve(e.from).marks();b.replaceWith(e.from,e.to,a.schema.text(e.text,c))}else b.delete(e.from,e.to)}return!0}}return!1},gx=()=>({tr:a,dispatch:b})=>{let{selection:c}=a,{empty:d,ranges:e}=c;return!!d||(b&&e.forEach(b=>{a.removeMark(b.$from.pos,b.$to.pos)}),!0)},gy=(a,b={})=>({tr:c,state:d,dispatch:e})=>{var f;let{extendEmptyMarkRange:g=!1}=b,{selection:h}=c,i=e6(a,d.schema),{$from:j,empty:k,ranges:l}=h;if(!e)return!0;if(k&&g){let{from:a,to:b}=h,d=null==(f=j.marks().find(a=>a.type===i))?void 0:f.attrs,e=e5(j,i,d);e&&(a=e.from,b=e.to),c.removeMark(a,b,i)}else l.forEach(a=>{c.removeMark(a.$from.pos,a.$to.pos,i)});return c.removeStoredMark(i),!0},gz=a=>({tr:b,state:c,dispatch:d})=>{let e,f,{selection:g}=c;return"number"==typeof a?(e=a,f=a):a&&"from"in a&&"to"in a?(e=a.from,f=a.to):(e=g.from,f=g.to),d&&b.doc.nodesBetween(e,f,(a,c)=>{if(a.isText)return;let d={...a.attrs};delete d.dir,b.setNodeMarkup(c,void 0,d)}),!0},gA=(a,b={})=>({tr:c,state:d,dispatch:e})=>{let f=null,g=null,h=fz("string"==typeof a?a:a.name,d.schema);if(!h)return!1;"node"===h&&(f=eX(a,d.schema)),"mark"===h&&(g=e6(a,d.schema));let i=!1;return c.selection.ranges.forEach(a=>{let h,j,k,l,m=a.$from.pos,n=a.$to.pos;c.selection.empty?d.doc.nodesBetween(m,n,(a,b)=>{f&&f===a.type&&(i=!0,k=Math.max(b,m),l=Math.min(b+a.nodeSize,n),h=b,j=a)}):d.doc.nodesBetween(m,n,(a,d)=>{d<m&&f&&f===a.type&&(i=!0,k=Math.max(d,m),l=Math.min(d+a.nodeSize,n),h=d,j=a),d>=m&&d<=n&&(f&&f===a.type&&(i=!0,e&&c.setNodeMarkup(d,void 0,{...a.attrs,...b})),g&&a.marks.length&&a.marks.forEach(f=>{if(g===f.type&&(i=!0,e)){let e=Math.max(d,m),h=Math.min(d+a.nodeSize,n);c.addMark(e,h,g.create({...f.attrs,...b}))}}))}),j&&(void 0!==h&&e&&c.setNodeMarkup(h,void 0,{...j.attrs,...b}),g&&j.marks.length&&j.marks.forEach(a=>{g===a.type&&e&&c.addMark(k,l,g.create({...a.attrs,...b}))}))}),i},gB=(a,b={})=>({state:c,dispatch:d})=>(function(a,b=null){return function(c,d){let{$from:e,$to:f}=c.selection,g=e.blockRange(f),h=g&&a$(g,a,b);return!!h&&(d&&d(c.tr.wrap(g,h).scrollIntoView()),!0)}})(eX(a,c.schema),b)(c,d),gC=(a,b={})=>({state:c,dispatch:d})=>(function(a,b=null){return function(c,d){let{$from:e,$to:f}=c.selection,g=e.blockRange(f);if(!g)return!1;let h=d?c.tr:null;return!!function(a,b,c,d=null){let e=!1,f=b,g=b.$from.doc;if(b.depth>=2&&b.$from.node(b.depth-1).type.compatibleContent(c)&&0==b.startIndex){if(0==b.$from.index(b.depth-1))return!1;let a=g.resolve(b.start-2);f=new ad(a,a,b.depth),b.endIndex<b.parent.childCount&&(b=new ad(b.$from,g.resolve(b.$to.end(b.depth)),b.depth)),e=!0}let h=a$(f,c,d,b);return!!h&&(a&&function(a,b,c,d,e){let f=O.empty;for(let a=c.length-1;a>=0;a--)f=O.from(c[a].type.create(c[a].attrs,f));a.step(new aW(b.start-2*!!d,b.end,b.start,b.end,new U(f,0,0),c.length,!0));let g=0;for(let a=0;a<c.length;a++)c[a].type==e&&(g=a+1);let h=c.length-g,i=b.start+c.length-2*!!d,j=b.parent;for(let c=b.startIndex,d=b.endIndex,e=!0;c<d;c++,e=!1)!e&&a2(a.doc,i,h)&&(a.split(i,h),i+=2*h),i+=j.child(c).nodeSize}(a,b,h,e,c),!0)}(h,g,a,b)&&(d&&d(h.scrollIntoView()),!0)}})(eX(a,c.schema),b)(c,d),gD=class{constructor(){this.callbacks={}}on(a,b){return this.callbacks[a]||(this.callbacks[a]=[]),this.callbacks[a].push(b),this}emit(a,...b){let c=this.callbacks[a];return c&&c.forEach(a=>a.apply(this,b)),this}off(a,b){let c=this.callbacks[a];return c&&(b?this.callbacks[a]=c.filter(a=>a!==b):delete this.callbacks[a]),this}once(a,b){let c=(...d)=>{this.off(a,c),b.apply(this,d)};return this.on(a,c)}removeAllListeners(){this.callbacks={}}},gE=class{constructor(a){var b;this.find=a.find,this.handler=a.handler,this.undoable=null==(b=a.undoable)||b}};function gF(a){var b;let{editor:c,from:d,to:e,text:f,rules:g,plugin:h}=a,{view:i}=c;if(i.composing)return!1;let j=i.state.doc.resolve(d);if(j.parent.type.spec.code||(null==(b=j.nodeBefore||j.nodeAfter)?void 0:b.marks.find(a=>a.type.spec.code)))return!1;let k=!1,l=((a,b=500)=>{let c="",d=a.parentOffset;return a.parent.nodesBetween(Math.max(0,d-b),d,(a,b,e,f)=>{var g,h;let i=(null==(h=(g=a.type.spec).toText)?void 0:h.call(g,{node:a,pos:b,parent:e,index:f}))||a.textContent||"%leaf%";c+=a.isAtom&&!a.isText?i:i.slice(0,Math.max(0,d-b))}),c})(j)+f;return g.forEach(a=>{if(k)return;let b=((a,b)=>{if(e1(b))return b.exec(a);let c=b(a);if(!c)return null;let d=[c.text];return d.index=c.index,d.input=a,d.data=c.data,c.replaceWith&&(c.text.includes(c.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),d.push(c.replaceWith)),d})(l,a.find);if(!b)return;let g=i.state.tr,j=eN({state:i.state,transaction:g}),m={from:d-(b[0].length-f.length),to:e},{commands:n,chain:o,can:p}=new eO({editor:c,state:j});null!==a.handler({state:j,range:m,match:b,commands:n,chain:o,can:p})&&g.steps.length&&(a.undoable&&g.setMeta(h,{transform:g,from:d,to:e,text:f}),i.dispatch(g),k=!0)}),k}function gG(a){return"Object"===Object.prototype.toString.call(a).slice(8,-1)&&a.constructor===Object&&Object.getPrototypeOf(a)===Object.prototype}var gH=class{constructor(a={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...a},this.name=this.config.name}get options(){return{...fT(fP(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...fT(fP(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(a={}){let b=this.extend({...this.config,addOptions:()=>(function a(b,c){let d={...b};return gG(b)&&gG(c)&&Object.keys(c).forEach(e=>{gG(c[e])&&gG(b[e])?d[e]=a(b[e],c[e]):d[e]=c[e]}),d})(this.options,a)});return b.name=this.name,b.parent=this.parent,b}extend(a={}){let b=new this.constructor({...this.config,...a});return b.parent=this,this.child=b,b.name="name"in a?a.name:b.parent.name,b}},gI=class a extends gH{constructor(){super(...arguments),this.type="mark"}static create(b={}){return new a("function"==typeof b?b():b)}static handleExit({editor:a,mark:b}){let{tr:c}=a.state,d=a.state.selection.$from;if(d.pos===d.end()){let e=d.marks();if(!e.find(a=>(null==a?void 0:a.type.name)===b.name))return!1;let f=e.find(a=>(null==a?void 0:a.type.name)===b.name);return f&&c.removeStoredMark(f),c.insertText(" ",d.pos),a.view.dispatch(c),!0}return!1}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}},gJ=class{constructor(a){this.find=a.find,this.handler=a.handler}},gK=null,gL=class{constructor(a,b){this.splittableMarks=[],this.editor=b,this.baseExtensions=a,this.extensions=f0(a),this.schema=function(a,b){var c;let d=fV(a),{nodeExtensions:e,markExtensions:f}=fU(a),g=null==(c=e.find(a=>fP(a,"topNode")))?void 0:c.name;return new au({topNode:g,nodes:Object.fromEntries(e.map(c=>{let e=d.filter(a=>a.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:b},g=fZ({...a.reduce((a,b)=>{let d=fP(b,"extendNodeSchema",f);return{...a,...d?d(c):{}}},{}),content:fT(fP(c,"content",f)),marks:fT(fP(c,"marks",f)),group:fT(fP(c,"group",f)),inline:fT(fP(c,"inline",f)),atom:fT(fP(c,"atom",f)),selectable:fT(fP(c,"selectable",f)),draggable:fT(fP(c,"draggable",f)),code:fT(fP(c,"code",f)),whitespace:fT(fP(c,"whitespace",f)),linebreakReplacement:fT(fP(c,"linebreakReplacement",f)),defining:fT(fP(c,"defining",f)),isolating:fT(fP(c,"isolating",f)),attrs:Object.fromEntries(e.map(f$))}),h=fT(fP(c,"parseHTML",f));h&&(g.parseDOM=h.map(a=>fY(a,e)));let i=fP(c,"renderHTML",f);i&&(g.toDOM=a=>i({node:a,HTMLAttributes:fX(a,e)}));let j=fP(c,"renderText",f);return j&&(g.toText=j),[c.name,g]})),marks:Object.fromEntries(f.map(c=>{let e=d.filter(a=>a.type===c.name),f={name:c.name,options:c.options,storage:c.storage,editor:b},g=fZ({...a.reduce((a,b)=>{let d=fP(b,"extendMarkSchema",f);return{...a,...d?d(c):{}}},{}),inclusive:fT(fP(c,"inclusive",f)),excludes:fT(fP(c,"excludes",f)),group:fT(fP(c,"group",f)),spanning:fT(fP(c,"spanning",f)),code:fT(fP(c,"code",f)),attrs:Object.fromEntries(e.map(f$))}),h=fT(fP(c,"parseHTML",f));h&&(g.parseDOM=h.map(a=>fY(a,e)));let i=fP(c,"renderHTML",f);return i&&(g.toDOM=a=>i({mark:a,HTMLAttributes:fX(a,e)})),[c.name,g]}))})}(this.extensions,b),this.setupExtensions()}get commands(){return this.extensions.reduce((a,b)=>{let c={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:this.editor,type:f6(b.name,this.schema)},d=fP(b,"addCommands",c);return d?{...a,...d()}:a},{})}get plugins(){let{editor:a}=this;return f_([...this.extensions].reverse()).flatMap(b=>{let c={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:f6(b.name,this.schema)},d=[],e=fP(b,"addKeyboardShortcuts",c),f={};if("mark"===b.type&&fP(b,"exitable",c)&&(f.ArrowRight=()=>gI.handleExit({editor:a,mark:b})),e){let b=Object.fromEntries(Object.entries(e()).map(([b,c])=>[b,()=>c({editor:a})]));f={...f,...b}}let g=new bC({props:{handleKeyDown:eK(f)}});d.push(g);let h=fP(b,"addInputRules",c);if(f9(b,a.options.enableInputRules)&&h){let b=h();if(b&&b.length){let c=function(a){let{editor:b,rules:c}=a,d=new bC({state:{init:()=>null,apply(a,e,f){let g=a.getMeta(d);if(g)return g;let h=a.getMeta("applyInputRules");return h&&setTimeout(()=>{let{text:a}=h;"string"==typeof a||(a=fR(O.from(a),f.schema));let{from:e}=h,g=e+a.length;gF({editor:b,from:e,to:g,text:a,rules:c,plugin:d})}),a.selectionSet||a.docChanged?null:e}},props:{handleTextInput:(a,e,f,g)=>gF({editor:b,from:e,to:f,text:g,rules:c,plugin:d}),handleDOMEvents:{compositionend:a=>(setTimeout(()=>{let{$cursor:e}=a.state.selection;e&&gF({editor:b,from:e.pos,to:e.pos,text:"",rules:c,plugin:d})}),!1)},handleKeyDown(a,e){if("Enter"!==e.key)return!1;let{$cursor:f}=a.state.selection;return!!f&&gF({editor:b,from:f.pos,to:f.pos,text:"\n",rules:c,plugin:d})}},isInputRules:!0});return d}({editor:a,rules:b}),e=Array.isArray(c)?c:[c];d.push(...e)}}let i=fP(b,"addPasteRules",c);if(f9(b,a.options.enablePasteRules)&&i){let b=i();if(b&&b.length){let c=function(a){let b,{editor:c,rules:d}=a,e=null,f=!1,g=!1,h="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null;try{b="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{b=null}let i=({state:a,from:d,to:e,rule:f,pasteEvt:g})=>{let i=a.tr;if(function(a){let{editor:b,state:c,from:d,to:e,rule:f,pasteEvent:g,dropEvent:h}=a,{commands:i,chain:j,can:k}=new eO({editor:b,state:c}),l=[];return c.doc.nodesBetween(d,e,(a,b)=>{var m,n,o,p,q;if((null==(n=null==(m=a.type)?void 0:m.spec)?void 0:n.code)||!(a.isText||a.isTextblock||a.isInline))return;let r=null!=(q=null!=(p=null==(o=a.content)?void 0:o.size)?p:a.nodeSize)?q:0,s=Math.max(d,b),t=Math.min(e,b+r);s>=t||((a,b,c)=>{if(e1(b))return[...a.matchAll(b)];let d=b(a,c);return d?d.map(b=>{let c=[b.text];return c.index=b.index,c.input=a,c.data=b.data,b.replaceWith&&(b.text.includes(b.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),c.push(b.replaceWith)),c}):[]})(a.isText?a.text||"":a.textBetween(s-b,t-b,void 0,""),f.find,g).forEach(a=>{if(void 0===a.index)return;let b=s+a.index+1,d=b+a[0].length,e={from:c.tr.mapping.map(b),to:c.tr.mapping.map(d)},m=f.handler({state:c,range:e,match:a,commands:i,chain:j,can:k,pasteEvent:g,dropEvent:h});l.push(m)})}),l.every(a=>null!==a)}({editor:c,state:eN({state:a,transaction:i}),from:Math.max(d-1,0),to:e.b-1,rule:f,pasteEvent:g,dropEvent:b})&&i.steps.length){try{b="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch{b=null}return h="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,i}};return d.map(a=>new bC({view(a){let b=b=>{var d;(e=(null==(d=a.dom.parentElement)?void 0:d.contains(b.target))?a.dom.parentElement:null)&&(gK=c)},d=()=>{gK&&(gK=null)};return window.addEventListener("dragstart",b),window.addEventListener("dragend",d),{destroy(){window.removeEventListener("dragstart",b),window.removeEventListener("dragend",d)}}},props:{handleDOMEvents:{drop:(a,c)=>{if(g=e===a.dom.parentElement,b=c,!g){let a=gK;(null==a?void 0:a.isEditable)&&setTimeout(()=>{let b=a.state.selection;b&&a.commands.deleteRange({from:b.from,to:b.to})},10)}return!1},paste:(a,b)=>{var c;let d=null==(c=b.clipboardData)?void 0:c.getData("text/html");return h=b,f=!!(null==d?void 0:d.includes("data-pm-slice")),!1}}},appendTransaction:(b,c,d)=>{let e=b[0],j="paste"===e.getMeta("uiEvent")&&!f,k="drop"===e.getMeta("uiEvent")&&!g,l=e.getMeta("applyPasteRules"),m=!!l;if(!j&&!k&&!m)return;if(m){var n,o;let b,{text:c}=l;"string"==typeof c||(c=fR(O.from(c),d.schema));let{from:e}=l,f=e+c.length;return i({rule:a,state:d,from:e,to:{b:f},pasteEvt:(n=c,null==(o=(b=new ClipboardEvent("paste",{clipboardData:new DataTransfer})).clipboardData)||o.setData("text/html",n),b)})}let p=c.doc.content.findDiffStart(d.doc.content),q=c.doc.content.findDiffEnd(d.doc.content);if("number"==typeof p&&q&&p!==q.b)return i({rule:a,state:d,from:p,to:q,pasteEvt:h})}}))}({editor:a,rules:b});d.push(...c)}}let j=fP(b,"addProseMirrorPlugins",c);if(j){let a=j();d.push(...a)}return d})}get attributes(){return fV(this.extensions)}get nodeViews(){let{editor:a}=this,{nodeExtensions:b}=fU(this.extensions);return Object.fromEntries(b.filter(a=>!!fP(a,"addNodeView")).map(b=>{let c=this.attributes.filter(a=>a.type===b.name),d={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:eX(b.name,this.schema)},e=fP(b,"addNodeView",d);if(!e)return[];let f=e();return f?[b.name,(d,e,g,h,i)=>{let j=fX(d,c);return f({node:d,view:e,getPos:g,decorations:h,innerDecorations:i,editor:a,extension:b,HTMLAttributes:j})}]:[]}))}get markViews(){let{editor:a}=this,{markExtensions:b}=fU(this.extensions);return Object.fromEntries(b.filter(a=>!!fP(a,"addMarkView")).map(b=>{let c=this.attributes.filter(a=>a.type===b.name),d={name:b.name,options:b.options,storage:this.editor.extensionStorage[b.name],editor:a,type:e6(b.name,this.schema)},e=fP(b,"addMarkView",d);return e?[b.name,(d,f,g)=>{let h=fX(d,c);return e()({mark:d,view:f,inline:g,editor:a,extension:b,HTMLAttributes:h,updateAttributes:b=>{!function(a,b,c={}){let{state:d}=b,{doc:e,tr:f}=d;e.descendants((b,d)=>{let e=f.mapping.map(d),g=f.mapping.map(d)+b.nodeSize,h=null;if(b.marks.forEach(b=>{if(b!==a)return!1;h=b}),!h)return;let i=!1;if(Object.keys(c).forEach(a=>{c[a]!==h.attrs[a]&&(i=!0)}),i){let b=a.type.create({...a.attrs,...c});f.removeMark(e,g,a.type),f.addMark(e,g,b)}}),f.docChanged&&b.view.dispatch(f)}(d,a,b)}})}]:[]}))}setupExtensions(){let a=this.extensions;this.editor.extensionStorage=Object.fromEntries(a.map(a=>[a.name,a.storage])),a.forEach(a=>{var b;let c={name:a.name,options:a.options,storage:this.editor.extensionStorage[a.name],editor:this.editor,type:f6(a.name,this.schema)};"mark"===a.type&&(null==(b=fT(fP(a,"keepOnSplit",c)))||b)&&this.splittableMarks.push(a.name);let d=fP(a,"onBeforeCreate",c),e=fP(a,"onCreate",c),f=fP(a,"onUpdate",c),g=fP(a,"onSelectionUpdate",c),h=fP(a,"onTransaction",c),i=fP(a,"onFocus",c),j=fP(a,"onBlur",c),k=fP(a,"onDestroy",c);d&&this.editor.on("beforeCreate",d),e&&this.editor.on("create",e),f&&this.editor.on("update",f),g&&this.editor.on("selectionUpdate",g),h&&this.editor.on("transaction",h),i&&this.editor.on("focus",i),j&&this.editor.on("blur",j),k&&this.editor.on("destroy",k)})}};gL.resolve=f0,gL.sort=f_,gL.flatten=fQ,eM({},{ClipboardTextSerializer:()=>gN,Commands:()=>gO,Delete:()=>gP,Drop:()=>gQ,Editable:()=>gR,FocusEvents:()=>gT,Keymap:()=>gU,Paste:()=>gV,Tabindex:()=>gW,TextDirection:()=>gX,focusEventsPluginKey:()=>gS});var gM=class a extends gH{constructor(){super(...arguments),this.type="extension"}static create(b={}){return new a("function"==typeof b?b():b)}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}},gN=gM.create({name:"clipboardTextSerializer",addOptions:()=>({blockSeparator:void 0}),addProseMirrorPlugins(){return[new bC({key:new bF("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{let{editor:a}=this,{state:b,schema:c}=a,{doc:d,selection:e}=b,{ranges:f}=e,g=Math.min(...f.map(a=>a.$from.pos)),h=Math.max(...f.map(a=>a.$to.pos)),i=f2(c);return f1(d,{from:g,to:h},{...void 0!==this.options.blockSeparator?{blockSeparator:this.options.blockSeparator}:{},textSerializers:i})}}})]}}),gO=gM.create({name:"commands",addCommands:()=>({...eP})}),gP=gM.create({name:"delete",onUpdate({transaction:a,appendedTransactions:b}){var c,d,e;let f=()=>{var c,d,e,f;if(null!=(f=null==(e=null==(d=null==(c=this.editor.options.coreExtensionOptions)?void 0:c.delete)?void 0:d.filterTransaction)?void 0:e.call(d,a))?f:a.getMeta("y-sync$"))return;let g=fM(a.before,[a,...b]);f4(g).forEach(b=>{g.mapping.mapResult(b.oldRange.from).deletedAfter&&g.mapping.mapResult(b.oldRange.to).deletedBefore&&g.before.nodesBetween(b.oldRange.from,b.oldRange.to,(c,d)=>{let e=d+c.nodeSize-2,f=b.oldRange.from<=d&&e<=b.oldRange.to;this.editor.emit("delete",{type:"node",node:c,from:d,to:e,newFrom:g.mapping.map(d),newTo:g.mapping.map(e),deletedRange:b.oldRange,newRange:b.newRange,partial:!f,editor:this.editor,transaction:a,combinedTransform:g})})});let h=g.mapping;g.steps.forEach((b,c)=>{var d,e;if(b instanceof aS){let f=h.slice(c).map(b.from,-1),i=h.slice(c).map(b.to),j=h.invert().map(f,-1),k=h.invert().map(i),l=null==(d=g.doc.nodeAt(f-1))?void 0:d.marks.some(a=>a.eq(b.mark)),m=null==(e=g.doc.nodeAt(i))?void 0:e.marks.some(a=>a.eq(b.mark));this.editor.emit("delete",{type:"mark",mark:b.mark,from:b.from,to:b.to,deletedRange:{from:j,to:k},newRange:{from:f,to:i},partial:!!(m||l),editor:this.editor,transaction:a,combinedTransform:g})}})};null==(e=null==(d=null==(c=this.editor.options.coreExtensionOptions)?void 0:c.delete)?void 0:d.async)||e?setTimeout(f,0):f()}}),gQ=gM.create({name:"drop",addProseMirrorPlugins(){return[new bC({key:new bF("tiptapDrop"),props:{handleDrop:(a,b,c,d)=>{this.editor.emit("drop",{editor:this.editor,event:b,slice:c,moved:d})}}})]}}),gR=gM.create({name:"editable",addProseMirrorPlugins(){return[new bC({key:new bF("editable"),props:{editable:()=>this.editor.options.editable}})]}}),gS=new bF("focusEvents"),gT=gM.create({name:"focusEvents",addProseMirrorPlugins(){let{editor:a}=this;return[new bC({key:gS,props:{handleDOMEvents:{focus:(b,c)=>{a.isFocused=!0;let d=a.state.tr.setMeta("focus",{event:c}).setMeta("addToHistory",!1);return b.dispatch(d),!1},blur:(b,c)=>{a.isFocused=!1;let d=a.state.tr.setMeta("blur",{event:c}).setMeta("addToHistory",!1);return b.dispatch(d),!1}}}})]}}),gU=gM.create({name:"keymap",addKeyboardShortcuts(){let a=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:b})=>{let{selection:c,doc:d}=b,{empty:e,$anchor:f}=c,{pos:g,parent:h}=f,i=f.parent.isTextblock&&g>0?b.doc.resolve(g-1):f,j=i.parent.type.spec.isolating,k=f.pos-f.parentOffset,l=j&&1===i.parent.childCount?k===f.pos:bk.atStart(d).from===g;return!!e&&!!h.type.isTextblock&&!h.textContent.length&&!!l&&(!l||"paragraph"!==f.parent.type.name)&&a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),b=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),c={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:a,"Mod-Backspace":a,"Shift-Backspace":a,Delete:b,"Mod-Delete":b,"Mod-a":()=>this.editor.commands.selectAll()},d={...c},e={...c,"Ctrl-h":a,"Alt-Backspace":a,"Ctrl-d":b,"Ctrl-Alt-Backspace":b,"Alt-Delete":b,"Alt-d":b,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return fd()||fs()?e:d},addProseMirrorPlugins(){return[new bC({key:new bF("clearDocument"),appendTransaction:(a,b,c)=>{if(a.some(a=>a.getMeta("composition")))return;let d=a.some(a=>a.docChanged)&&!b.doc.eq(c.doc),e=a.some(a=>a.getMeta("preventClearDocument"));if(!d||e)return;let{empty:f,from:g,to:h}=b.selection,i=bk.atStart(b.doc).from,j=bk.atEnd(b.doc).to;if(f||g!==i||h!==j||!gb(c.doc))return;let k=c.tr,l=eN({state:c,transaction:k}),{commands:m}=new eO({editor:this.editor,state:l});if(m.clearNodes(),k.steps.length)return k}})]}}),gV=gM.create({name:"paste",addProseMirrorPlugins(){return[new bC({key:new bF("tiptapPaste"),props:{handlePaste:(a,b,c)=>{this.editor.emit("paste",{editor:this.editor,event:b,slice:c})}}})]}}),gW=gM.create({name:"tabindex",addProseMirrorPlugins(){return[new bC({key:new bF("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),gX=gM.create({name:"textDirection",addOptions:()=>({direction:void 0}),addGlobalAttributes(){if(!this.options.direction)return[];let{nodeExtensions:a}=fU(this.extensions);return[{types:a.filter(a=>"text"!==a.name).map(a=>a.name),attributes:{dir:{default:this.options.direction,parseHTML:a=>{let b=a.getAttribute("dir");return b&&("ltr"===b||"rtl"===b||"auto"===b)?b:this.options.direction},renderHTML:a=>a.dir?{dir:a.dir}:{}}}}]},addProseMirrorPlugins(){return[new bC({key:new bF("textDirection"),props:{attributes:()=>{let a=this.options.direction;return a?{dir:a}:{}}}})]}}),gY=class a{constructor(a,b,c=!1,d=null){this.currentNode=null,this.actualDepth=null,this.isBlock=c,this.resolvedPos=a,this.editor=b,this.currentNode=d}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var a;return null!=(a=this.actualDepth)?a:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(a){let b=this.from,c=this.to;if(this.isBlock){if(0===this.content.size)return void console.error(`You can\u2019t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);b=this.from+1,c=this.to-1}this.editor.commands.insertContentAt({from:b,to:c},a)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+ +!this.node.isText}get parent(){if(0===this.depth)return null;let b=this.resolvedPos.start(this.resolvedPos.depth-1);return new a(this.resolvedPos.doc.resolve(b),this.editor)}get before(){let b=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return b.depth!==this.depth&&(b=this.resolvedPos.doc.resolve(this.from-3)),new a(b,this.editor)}get after(){let b=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return b.depth!==this.depth&&(b=this.resolvedPos.doc.resolve(this.to+3)),new a(b,this.editor)}get children(){let b=[];return this.node.content.forEach((c,d)=>{let e=c.isBlock&&!c.isTextblock,f=c.isAtom&&!c.isText,g=this.pos+d+ +!f;if(g<0||g>this.resolvedPos.doc.nodeSize-2)return;let h=this.resolvedPos.doc.resolve(g);if(!e&&h.depth<=this.depth)return;let i=new a(h,this.editor,e,e?c:null);e&&(i.actualDepth=this.depth+1),b.push(new a(h,this.editor,e,e?c:null))}),b}get firstChild(){return this.children[0]||null}get lastChild(){let a=this.children;return a[a.length-1]||null}closest(a,b={}){let c=null,d=this.parent;for(;d&&!c;){if(d.node.type.name===a)if(Object.keys(b).length>0){let a=d.node.attrs,c=Object.keys(b);for(let d=0;d<c.length;d+=1){let e=c[d];if(a[e]!==b[e])break}}else c=d;d=d.parent}return c}querySelector(a,b={}){return this.querySelectorAll(a,b,!0)[0]||null}querySelectorAll(a,b={},c=!1){let d=[];if(!this.children||0===this.children.length)return d;let e=Object.keys(b);return this.children.forEach(f=>{c&&d.length>0||(f.node.type.name===a&&e.every(a=>b[a]===f.node.attrs[a])&&d.push(f),c&&d.length>0||(d=d.concat(f.querySelectorAll(a,b,c))))}),d}setAttribute(a){let{tr:b}=this.editor.state;b.setNodeMarkup(this.from,void 0,{...this.node.attrs,...a}),this.editor.view.dispatch(b)}},gZ=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`,g$=class extends gD{constructor(a={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:"undefined"!=typeof document?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:a})=>{throw a},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:ge,createMappablePosition:gf},this.setOptions(a),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:a,slice:b,moved:c})=>this.options.onDrop(a,b,c)),this.on("paste",({event:a,slice:b})=>this.options.onPaste(a,b)),this.on("delete",this.options.onDelete);const b=this.createDoc(),c=fb(b,this.options.autofocus);this.editorState=bB.create({doc:b,schema:this.schema,selection:c||void 0}),this.options.element&&this.mount(this.options.element)}mount(a){if("undefined"==typeof document)throw Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(a),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(!1!==this.options.autofocus&&null!==this.options.autofocus&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){let a=this.editorView.dom;(null==a?void 0:a.editor)&&delete a.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{"function"==typeof this.css.remove?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(a){console.warn("Failed to remove CSS element:",a)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&"undefined"!=typeof document&&(this.css=function(a,b,c){let d=document.querySelector("style[data-tiptap-style]");if(null!==d)return d;let e=document.createElement("style");return b&&e.setAttribute("nonce",b),e.setAttribute("data-tiptap-style",""),e.innerHTML=a,document.getElementsByTagName("head")[0].appendChild(e),e}(gZ,this.options.injectNonce))}setOptions(a={}){this.options={...this.options,...a},this.editorView&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(a,b=!0){this.setOptions({editable:a}),b&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:a=>{this.editorState=a},dispatch:a=>{this.dispatchTransaction(a)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(a,b)=>{if(this.editorView)return this.editorView[b];if("state"===b)return this.editorState;if(b in a)return Reflect.get(a,b);throw Error(`[tiptap error]: The editor view is not available. Cannot access view['${b}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(a,b){let c=fS(b)?b(a,[...this.state.plugins]):[...this.state.plugins,a],d=this.state.reconfigure({plugins:c});return this.view.updateState(d),d}unregisterPlugin(a){if(this.isDestroyed)return;let b=this.state.plugins,c=b;if([].concat(a).forEach(a=>{let b="string"==typeof a?`${a}$`:a.key;c=c.filter(a=>!a.key.startsWith(b))}),b.length===c.length)return;let d=this.state.reconfigure({plugins:c});return this.view.updateState(d),d}createExtensionManager(){var a,b;let c=[...this.options.enableCoreExtensions?[gR,gN.configure({blockSeparator:null==(b=null==(a=this.options.coreExtensionOptions)?void 0:a.clipboardTextSerializer)?void 0:b.blockSeparator}),gO,gT,gU,gW,gQ,gV,gP,gX.configure({direction:this.options.textDirection})].filter(a=>"object"!=typeof this.options.enableCoreExtensions||!1!==this.options.enableCoreExtensions[a.name]):[],...this.options.extensions].filter(a=>["extension","node","mark"].includes(null==a?void 0:a.type));this.extensionManager=new gL(c,this)}createCommandManager(){this.commandManager=new eO({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let a;try{a=fJ(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(b){if(!(b instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(b.message))throw b;this.emit("contentError",{editor:this,error:b,disableCollaboration:()=>{"collaboration"in this.storage&&"object"==typeof this.storage.collaboration&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(a=>"collaboration"!==a.name),this.createExtensionManager()}}),a=fJ(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return a}createView(a){var b;this.editorView=new ev(a,{...this.options.editorProps,attributes:{role:"textbox",...null==(b=this.options.editorProps)?void 0:b.attributes},dispatchTransaction:this.dispatchTransaction.bind(this),state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});let c=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(c),this.prependClass(),this.injectCSS(),this.view.dom.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(a){this.isCapturingTransaction=!0,a(),this.isCapturingTransaction=!1;let b=this.capturedTransaction;return this.capturedTransaction=null,b}dispatchTransaction(a){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=a;return}a.steps.forEach(a=>{var b;return null==(b=this.capturedTransaction)?void 0:b.step(a)});return}let{state:b,transactions:c}=this.state.applyTransaction(a),d=!this.state.selection.eq(b.selection),e=c.includes(a),f=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:a,nextState:b}),!e)return;this.view.updateState(b),this.emit("transaction",{editor:this,transaction:a,appendedTransactions:c.slice(1)}),d&&this.emit("selectionUpdate",{editor:this,transaction:a});let g=c.findLast(a=>a.getMeta("focus")||a.getMeta("blur")),h=null==g?void 0:g.getMeta("focus"),i=null==g?void 0:g.getMeta("blur");h&&this.emit("focus",{editor:this,event:h.event,transaction:g}),i&&this.emit("blur",{editor:this,event:i.event,transaction:g}),a.getMeta("preventUpdate")||!c.some(a=>a.docChanged)||f.doc.eq(b.doc)||this.emit("update",{editor:this,transaction:a,appendedTransactions:c.slice(1)})}getAttributes(a){return f3(this.state,a)}isActive(a,b){let c="string"==typeof a?a:null,d="string"==typeof a?b:a;return function(a,b,c={}){if(!b)return fu(a,null,c)||f8(a,null,c);let d=fz(b,a.schema);return"node"===d?fu(a,b,c):"mark"===d&&f8(a,b,c)}(this.state,c,d)}getJSON(){return this.state.doc.toJSON()}getHTML(){return fR(this.state.doc.content,this.schema)}getText(a){var b,c;let d,{blockSeparator:e="\n\n",textSerializers:f={}}=a||{};return b=this.state.doc,c={blockSeparator:e,textSerializers:{...f2(this.schema),...f}},d={from:0,to:b.content.size},f1(b,d,c)}get isEmpty(){return gb(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var a,b;return null==(b=null==(a=this.editorView)?void 0:a.isDestroyed)||b}$node(a,b){var c;return(null==(c=this.$doc)?void 0:c.querySelector(a,b))||null}$nodes(a,b){var c;return(null==(c=this.$doc)?void 0:c.querySelectorAll(a,b))||null}$pos(a){return new gY(this.state.doc.resolve(a),this)}get $doc(){return this.$pos(0)}};function g_(a){return new gE({find:a.find,handler:({state:b,range:c,match:d})=>{let e=fT(a.getAttributes,void 0,d);if(!1===e||null===e)return null;let{tr:f}=b,g=d[d.length-1],h=d[0];if(g){let d=h.search(/\S/),i=c.from+h.indexOf(g),j=i+g.length;if(f5(c.from,c.to,b.doc).filter(b=>b.mark.type.excluded.find(c=>c===a.type&&c!==b.mark.type)).filter(a=>a.to>i).length)return null;j<c.to&&f.delete(j,c.to),i>c.from&&f.delete(c.from+d,i);let k=c.from+d+g.length;f.addMark(c.from+d,k,a.type.create(e||{})),f.removeStoredMark(a.type)}},undoable:a.undoable})}function g0(a){return new gE({find:a.find,handler:({state:b,range:c,match:d})=>{let e=fT(a.getAttributes,void 0,d)||{},{tr:f}=b,g=c.from,h=c.to,i=a.type.create(e);if(d[1]){let a=g+d[0].lastIndexOf(d[1]);a>h?a=h:h=a+d[1].length;let b=d[0][d[0].length-1];f.insertText(b,g+d[0].length-1),f.replaceWith(a,h,i)}else if(d[0]){let b=a.type.isInline?g:g-1;f.insert(b,a.type.create(e)).delete(f.mapping.map(g),f.mapping.map(h))}f.scrollIntoView()},undoable:a.undoable})}function g1(a){return new gE({find:a.find,handler:({state:b,range:c,match:d})=>{let e=b.doc.resolve(c.from),f=fT(a.getAttributes,void 0,d)||{};if(!e.node(-1).canReplaceWith(e.index(-1),e.indexAfter(-1),a.type))return null;b.tr.delete(c.from,c.to).setBlockType(c.from,c.from,a.type,f)},undoable:a.undoable})}function g2(a){return new gE({find:a.find,handler:({state:b,range:c,match:d,chain:e})=>{let f=fT(a.getAttributes,void 0,d)||{},g=b.tr.delete(c.from,c.to),h=g.doc.resolve(c.from).blockRange(),i=h&&a$(h,a.type,f);if(!i)return null;if(g.wrap(h,i),a.keepMarks&&a.editor){let{selection:c,storedMarks:d}=b,{splittableMarks:e}=a.editor.extensionManager,f=d||c.$to.parentOffset&&c.$from.marks();if(f){let a=f.filter(a=>e.includes(a.type.name));g.ensureMarks(a)}}if(a.keepAttributes){let b="bulletList"===a.type.name||"orderedList"===a.type.name?"listItem":"taskList";e().updateAttributes(b,f).run()}let j=g.doc.resolve(c.from-1).nodeBefore;j&&j.type===a.type&&a3(g.doc,c.from-1)&&(!a.joinPredicate||a.joinPredicate(d,j))&&g.join(c.from-1)},undoable:a.undoable})}var g3=class{constructor(a){var b,c,d,e,f,g;this.directions=["bottom-left","bottom-right","top-left","top-right"],this.minSize={height:8,width:8},this.preserveAspectRatio=!1,this.classNames={container:"",wrapper:"",handle:"",resizing:""},this.initialWidth=0,this.initialHeight=0,this.aspectRatio=1,this.isResizing=!1,this.activeHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.isShiftKeyPressed=!1,this.lastEditableState=void 0,this.handleMap=new Map,this.handleMouseMove=a=>{if(!this.isResizing||!this.activeHandle)return;let b=a.clientX-this.startX,c=a.clientY-this.startY;this.handleResize(b,c)},this.handleTouchMove=a=>{if(!this.isResizing||!this.activeHandle)return;let b=a.touches[0];if(!b)return;let c=b.clientX-this.startX,d=b.clientY-this.startY;this.handleResize(c,d)},this.handleMouseUp=()=>{if(!this.isResizing)return;let a=this.element.offsetWidth,b=this.element.offsetHeight;this.onCommit(a,b),this.isResizing=!1,this.activeHandle=null,this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},this.handleKeyDown=a=>{"Shift"===a.key&&(this.isShiftKeyPressed=!0)},this.handleKeyUp=a=>{"Shift"===a.key&&(this.isShiftKeyPressed=!1)},this.node=a.node,this.editor=a.editor,this.element=a.element,this.contentElement=a.contentElement,this.getPos=a.getPos,this.onResize=a.onResize,this.onCommit=a.onCommit,this.onUpdate=a.onUpdate,(null==(b=a.options)?void 0:b.min)&&(this.minSize={...this.minSize,...a.options.min}),(null==(c=a.options)?void 0:c.max)&&(this.maxSize=a.options.max),(null==(d=null==a?void 0:a.options)?void 0:d.directions)&&(this.directions=a.options.directions),(null==(e=a.options)?void 0:e.preserveAspectRatio)&&(this.preserveAspectRatio=a.options.preserveAspectRatio),(null==(f=a.options)?void 0:f.className)&&(this.classNames={container:a.options.className.container||"",wrapper:a.options.className.wrapper||"",handle:a.options.className.handle||"",resizing:a.options.className.resizing||""}),(null==(g=a.options)?void 0:g.createCustomHandle)&&(this.createCustomHandle=a.options.createCustomHandle),this.wrapper=this.createWrapper(),this.container=this.createContainer(),this.applyInitialSize(),this.attachHandles(),this.editor.on("update",this.handleEditorUpdate.bind(this))}get dom(){return this.container}get contentDOM(){return this.contentElement}handleEditorUpdate(){let a=this.editor.isEditable;a!==this.lastEditableState&&(this.lastEditableState=a,a?a&&0===this.handleMap.size&&this.attachHandles():this.removeHandles())}update(a,b,c){return a.type===this.node.type&&(this.node=a,!this.onUpdate||this.onUpdate(a,b,c))}destroy(){this.isResizing&&(this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.isResizing=!1,this.activeHandle=null),this.editor.off("update",this.handleEditorUpdate.bind(this)),this.container.remove()}createContainer(){let a=document.createElement("div");return a.dataset.resizeContainer="",a.dataset.node=this.node.type.name,a.style.display="flex",this.classNames.container&&(a.className=this.classNames.container),a.appendChild(this.wrapper),a}createWrapper(){let a=document.createElement("div");return a.style.position="relative",a.style.display="block",a.dataset.resizeWrapper="",this.classNames.wrapper&&(a.className=this.classNames.wrapper),a.appendChild(this.element),a}createHandle(a){let b=document.createElement("div");return b.dataset.resizeHandle=a,b.style.position="absolute",this.classNames.handle&&(b.className=this.classNames.handle),b}positionHandle(a,b){let c=b.includes("top"),d=b.includes("bottom"),e=b.includes("left"),f=b.includes("right");c&&(a.style.top="0"),d&&(a.style.bottom="0"),e&&(a.style.left="0"),f&&(a.style.right="0"),("top"===b||"bottom"===b)&&(a.style.left="0",a.style.right="0"),("left"===b||"right"===b)&&(a.style.top="0",a.style.bottom="0")}attachHandles(){this.directions.forEach(a=>{let b;(b=this.createCustomHandle?this.createCustomHandle(a):this.createHandle(a))instanceof HTMLElement||(console.warn(`[ResizableNodeView] createCustomHandle("${a}") did not return an HTMLElement. Falling back to default handle.`),b=this.createHandle(a)),this.createCustomHandle||this.positionHandle(b,a),b.addEventListener("mousedown",b=>this.handleResizeStart(b,a)),b.addEventListener("touchstart",b=>this.handleResizeStart(b,a)),this.handleMap.set(a,b),this.wrapper.appendChild(b)})}removeHandles(){this.handleMap.forEach(a=>a.remove()),this.handleMap.clear()}applyInitialSize(){let a=this.node.attrs.width,b=this.node.attrs.height;a?(this.element.style.width=`${a}px`,this.initialWidth=a):this.initialWidth=this.element.offsetWidth,b?(this.element.style.height=`${b}px`,this.initialHeight=b):this.initialHeight=this.element.offsetHeight,this.initialWidth>0&&this.initialHeight>0&&(this.aspectRatio=this.initialWidth/this.initialHeight)}handleResizeStart(a,b){a.preventDefault(),a.stopPropagation(),this.isResizing=!0,this.activeHandle=b,"touches"in a?(this.startX=a.touches[0].clientX,this.startY=a.touches[0].clientY):(this.startX=a.clientX,this.startY=a.clientY),this.startWidth=this.element.offsetWidth,this.startHeight=this.element.offsetHeight,this.startWidth>0&&this.startHeight>0&&(this.aspectRatio=this.startWidth/this.startHeight),this.getPos(),this.container.dataset.resizeState="true",this.classNames.resizing&&this.container.classList.add(this.classNames.resizing),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}handleResize(a,b){if(!this.activeHandle)return;let c=this.preserveAspectRatio||this.isShiftKeyPressed,{width:d,height:e}=this.calculateNewDimensions(this.activeHandle,a,b),f=this.applyConstraints(d,e,c);this.element.style.width=`${f.width}px`,this.element.style.height=`${f.height}px`,this.onResize&&this.onResize(f.width,f.height)}calculateNewDimensions(a,b,c){let d=this.startWidth,e=this.startHeight,f=a.includes("right"),g=a.includes("left"),h=a.includes("bottom"),i=a.includes("top");return(f?d=this.startWidth+b:g&&(d=this.startWidth-b),h?e=this.startHeight+c:i&&(e=this.startHeight-c),("right"===a||"left"===a)&&(d=this.startWidth+(f?b:-b)),("top"===a||"bottom"===a)&&(e=this.startHeight+(h?c:-c)),this.preserveAspectRatio||this.isShiftKeyPressed)?this.applyAspectRatio(d,e,a):{width:d,height:e}}applyConstraints(a,b,c){var d,e,f,g;if(!c){let c=Math.max(this.minSize.width,a),f=Math.max(this.minSize.height,b);return(null==(d=this.maxSize)?void 0:d.width)&&(c=Math.min(this.maxSize.width,c)),(null==(e=this.maxSize)?void 0:e.height)&&(f=Math.min(this.maxSize.height,f)),{width:c,height:f}}let h=a,i=b;return h<this.minSize.width&&(i=(h=this.minSize.width)/this.aspectRatio),i<this.minSize.height&&(h=(i=this.minSize.height)*this.aspectRatio),(null==(f=this.maxSize)?void 0:f.width)&&h>this.maxSize.width&&(i=(h=this.maxSize.width)/this.aspectRatio),(null==(g=this.maxSize)?void 0:g.height)&&i>this.maxSize.height&&(h=(i=this.maxSize.height)*this.aspectRatio),{width:h,height:i}}applyAspectRatio(a,b,c){return"left"===c||"right"===c?{width:a,height:a/this.aspectRatio}:"top"===c||"bottom"===c?{width:b*this.aspectRatio,height:b}:{width:a,height:a/this.aspectRatio}}};function g4(a){if(!(null==a?void 0:a.trim()))return{};let b={},c=[],d=a.replace(/["']([^"']*)["']/g,a=>(c.push(a),`__QUOTED_${c.length-1}__`)),e=d.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);e&&(b.class=e.map(a=>a.trim().slice(1)).join(" "));let f=d.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);f&&(b.id=f[1]),Array.from(d.matchAll(/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g)).forEach(([,a,d])=>{var e;let f=c[parseInt((null==(e=d.match(/__QUOTED_(\d+)__/))?void 0:e[1])||"0",10)];f&&(b[a]=f.slice(1,-1))});let g=d.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return g&&g.split(/\s+/).filter(Boolean).forEach(a=>{a.match(/^[a-zA-Z][\w-]*$/)&&(b[a]=!0)}),b}function g5(a){if(!a||0===Object.keys(a).length)return"";let b=[];return a.class&&String(a.class).split(/\s+/).filter(Boolean).forEach(a=>b.push(`.${a}`)),a.id&&b.push(`#${a.id}`),Object.entries(a).forEach(([a,c])=>{"class"!==a&&"id"!==a&&(!0===c?b.push(a):!1!==c&&null!=c&&b.push(`${a}="${String(c)}"`))}),b.join(" ")}function g6(a){let{nodeName:b,name:c,parseAttributes:d=g4,serializeAttributes:e=g5,defaultAttributes:f={},requiredAttributes:g=[],allowedAttributes:h}=a,i=c||b;return{parseMarkdown:(a,c)=>{let d={...f,...a.attributes};return c.createNode(b,d,[])},markdownTokenizer:{name:b,level:"block",start(a){var b;let c=RegExp(`^:::${i}(?:\\s|$)`,"m"),d=null==(b=a.match(c))?void 0:b.index;return void 0!==d?d:-1},tokenize(a,c,e){let f=RegExp(`^:::${i}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),h=a.match(f);if(!h)return;let j=d(h[1]||"");if(!g.find(a=>!(a in j)))return{type:b,raw:h[0],attributes:j}}},renderMarkdown:a=>{let b=e((a=>{if(!h)return a;let b={};return h.forEach(c=>{c in a&&(b[c]=a[c])}),b})(a.attrs||{})),c=b?` {${b}}`:"";return`:::${i}${c} :::`}}}function g7(a){let{nodeName:b,name:c,getContent:d,parseAttributes:e=g4,serializeAttributes:f=g5,defaultAttributes:g={},content:h="block",allowedAttributes:i}=a,j=c||b;return{parseMarkdown:(a,c)=>{let e;if(d){let b=d(a);e="string"==typeof b?[{type:"text",text:b}]:b}else e="block"===h?c.parseChildren(a.tokens||[]):c.parseInline(a.tokens||[]);let f={...g,...a.attributes};return c.createNode(b,f,e)},markdownTokenizer:{name:b,level:"block",start(a){var b;let c=RegExp(`^:::${j}`,"m"),d=null==(b=a.match(c))?void 0:b.index;return void 0!==d?d:-1},tokenize(a,c,d){var f;let g=RegExp(`^:::${j}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),i=a.match(g);if(!i)return;let[k,l=""]=i,m=e(l),n=1,o=k.length,p="",q=/^:::([\w-]*)(\s.*)?/gm,r=a.slice(o);for(q.lastIndex=0;;){let c=q.exec(r);if(null===c)break;let e=c.index,g=c[1];if(null==(f=c[2])||!f.endsWith(":::")){if(g)n+=1;else if(0==(n-=1)){let f=r.slice(0,e);p=f.trim();let g=a.slice(0,o+e+c[0].length),i=[];if(p)if("block"===h)for((i=d.blockTokens(f)).forEach(a=>{a.text&&(!a.tokens||0===a.tokens.length)&&(a.tokens=d.inlineTokens(a.text))});i.length>0;){let a=i[i.length-1];if("paragraph"!==a.type||a.text&&""!==a.text.trim())break;i.pop()}else i=d.inlineTokens(p);return{type:b,raw:g,attributes:m,content:p,tokens:i}}}}}},renderMarkdown:(a,b)=>{let c=f((a=>{if(!i)return a;let b={};return i.forEach(c=>{c in a&&(b[c]=a[c])}),b})(a.attrs||{})),d=c?` {${c}}`:"",e=b.renderChildren(a.content||[],"\n\n");return`:::${j}${d}

${e}

:::`}}}function g8(a){if(!a.trim())return{};let b={},c=/(\w+)=(?:"([^"]*)"|'([^']*)')/g,d=c.exec(a);for(;null!==d;){let[,e,f,g]=d;b[e]=f||g,d=c.exec(a)}return b}function g9(a){return Object.entries(a).filter(([,a])=>null!=a).map(([a,b])=>`${a}="${b}"`).join(" ")}function ha(a){let{nodeName:b,name:c,getContent:d,parseAttributes:e=g8,serializeAttributes:f=g9,defaultAttributes:g={},selfClosing:h=!1,allowedAttributes:i}=a,j=c||b,k=j.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(a,c)=>{let e={...g,...a.attributes};if(h)return c.createNode(b,e);let f=d?d(a):a.content||"";return f?c.createNode(b,e,[c.createTextNode(f)]):c.createNode(b,e,[])},markdownTokenizer:{name:b,level:"inline",start(a){let b=h?RegExp(`\\[${k}\\s*[^\\]]*\\]`):RegExp(`\\[${k}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${k}\\]`),c=a.match(b),d=null==c?void 0:c.index;return void 0!==d?d:-1},tokenize(a,c,d){let f=h?RegExp(`^\\[${k}\\s*([^\\]]*)\\]`):RegExp(`^\\[${k}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${k}\\]`),g=a.match(f);if(!g)return;let i="",j="";if(h){let[,a]=g;j=a}else{let[,a,b]=g;j=a,i=b||""}let l=e(j.trim());return{type:b,raw:g[0],content:i.trim(),attributes:l}}},renderMarkdown:a=>{let b="";d?b=d(a):a.content&&a.content.length>0&&(b=a.content.filter(a=>"text"===a.type).map(a=>a.text).join(""));let c=f((a=>{if(!i)return a;let b={};return i.forEach(c=>{let d="string"==typeof c?c:c.name,e="string"==typeof c?void 0:c.skipIfDefault;if(d in a){let c=a[d];if(void 0!==e&&c===e)return;b[d]=c}}),b})(a.attrs||{})),e=c?` ${c}`:"";return h?`[${j}${e}]`:`[${j}${e}]${b}[/${j}]`}}}function hb(a,b,c){var d,e,f,g;let h=a.split("\n"),i=[],j="",k=0,l=b.baseIndentSize||2;for(;k<h.length;){let a,m=h[k],n=m.match(b.itemPattern);if(!n)if(i.length>0)break;else{if(""!==m.trim())return;k+=1,j=`${j}${m}
`;continue}let o=b.extractItemData(n),{indentLevel:p,mainContent:q}=o;j=`${j}${m}
`;let r=[q];for(k+=1;k<h.length;){let a=h[k];if(""===a.trim()){let b=h.slice(k+1).findIndex(a=>""!==a.trim());if(-1===b)break;if(((null==(e=null==(d=h[k+1+b].match(/^(\s*)/))?void 0:d[1])?void 0:e.length)||0)>p){r.push(a),j=`${j}${a}
`,k+=1;continue}break}if(((null==(g=null==(f=a.match(/^(\s*)/))?void 0:f[1])?void 0:g.length)||0)>p)r.push(a),j=`${j}${a}
`,k+=1;else break}let s=r.slice(1);if(s.length>0){let d=s.map(a=>a.slice(p+l)).join("\n");d.trim()&&(a=b.customNestedParser?b.customNestedParser(d):c.blockTokens(d))}let t=b.createToken(o,a);i.push(t)}if(0!==i.length)return{items:i,raw:j}}function hc(a,b,c,d){if(!a||!Array.isArray(a.content))return"";let e="function"==typeof c?c(d):c,[f,...g]=a.content,h=b.renderChildren([f]),i=[`${e}${h}`];return g&&g.length>0&&g.forEach(a=>{let c=b.renderChildren([a]);if(c){let a=c.split("\n").map(a=>a?b.indent(a):"").join("\n");i.push(a)}}),i.join("\n")}eM({},{createAtomBlockMarkdownSpec:()=>g6,createBlockMarkdownSpec:()=>g7,createInlineMarkdownSpec:()=>ha,parseAttributes:()=>g4,parseIndentedBlocks:()=>hb,renderNestedMarkdownContent:()=>hc,serializeAttributes:()=>g5});var hd=class a extends gH{constructor(){super(...arguments),this.type="node"}static create(b={}){return new a("function"==typeof b?b():b)}configure(a){return super.configure(a)}extend(a){let b="function"==typeof a?a():a;return super.extend(b)}},he=class{constructor(a,b,c){this.isDragging=!1,this.component=a,this.editor=b.editor,this.options={stopEvent:null,ignoreMutation:null,...c},this.extension=b.extension,this.node=b.node,this.decorations=b.decorations,this.innerDecorations=b.innerDecorations,this.view=b.view,this.HTMLAttributes=b.HTMLAttributes,this.getPos=b.getPos,this.mount()}mount(){}get dom(){return this.editor.view.dom}get contentDOM(){return null}onDragStart(a){var b,c,d,e,f,g,h;let{view:i}=this.editor,j=a.target,k=3===j.nodeType?null==(b=j.parentElement)?void 0:b.closest("[data-drag-handle]"):j.closest("[data-drag-handle]");if(!this.dom||(null==(c=this.contentDOM)?void 0:c.contains(j))||!k)return;let l=0,m=0;if(this.dom!==k){let b=this.dom.getBoundingClientRect(),c=k.getBoundingClientRect(),h=null!=(e=a.offsetX)?e:null==(d=a.nativeEvent)?void 0:d.offsetX,i=null!=(g=a.offsetY)?g:null==(f=a.nativeEvent)?void 0:f.offsetY;l=c.x-b.x+h,m=c.y-b.y+i}let n=this.dom.cloneNode(!0);try{let a=this.dom.getBoundingClientRect();n.style.width=`${Math.round(a.width)}px`,n.style.height=`${Math.round(a.height)}px`,n.style.boxSizing="border-box",n.style.pointerEvents="none"}catch{}let o=null;try{(o=document.createElement("div")).style.position="absolute",o.style.top="-9999px",o.style.left="-9999px",o.style.pointerEvents="none",o.appendChild(n),document.body.appendChild(o),null==(h=a.dataTransfer)||h.setDragImage(n,l,m)}finally{o&&setTimeout(()=>{try{null==o||o.remove()}catch{}},0)}let p=this.getPos();if("number"!=typeof p)return;let q=bq.create(i.state.doc,p),r=i.state.tr.setSelection(q);i.dispatch(r)}stopEvent(a){var b;if(!this.dom)return!1;if("function"==typeof this.options.stopEvent)return this.options.stopEvent({event:a});let c=a.target;if(!(this.dom.contains(c)&&!(null==(b=this.contentDOM)?void 0:b.contains(c))))return!1;let d=a.type.startsWith("drag"),e="drop"===a.type;if((["INPUT","BUTTON","SELECT","TEXTAREA"].includes(c.tagName)||c.isContentEditable)&&!e&&!d)return!0;let{isEditable:f}=this.editor,{isDragging:g}=this,h=!!this.node.type.spec.draggable,i=bq.isSelectable(this.node),j="copy"===a.type,k="paste"===a.type,l="cut"===a.type,m="mousedown"===a.type;if(!h&&i&&d&&a.target===this.dom&&a.preventDefault(),h&&d&&!g&&a.target===this.dom)return a.preventDefault(),!1;if(h&&f&&!g&&m){let a=c.closest("[data-drag-handle]");a&&(this.dom===a||this.dom.contains(a))&&(this.isDragging=!0,document.addEventListener("dragend",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("drop",()=>{this.isDragging=!1},{once:!0}),document.addEventListener("mouseup",()=>{this.isDragging=!1},{once:!0}))}return!g&&!e&&!j&&!k&&!l&&(!m||!i)}ignoreMutation(a){return!this.dom||!this.contentDOM||("function"==typeof this.options.ignoreMutation?this.options.ignoreMutation({mutation:a}):!!this.node.isLeaf||!!this.node.isAtom||!("selection"===a.type||this.dom.contains(a.target)&&"childList"===a.type&&(fd()||fc())&&this.editor.isFocused&&[...Array.from(a.addedNodes),...Array.from(a.removedNodes)].every(a=>a.isContentEditable))&&(this.contentDOM===a.target&&"attributes"===a.type||!this.contentDOM.contains(a.target)))}updateAttributes(a){this.editor.commands.command(({tr:b})=>{let c=this.getPos();return"number"==typeof c&&(b.setNodeMarkup(c,void 0,{...this.node.attrs,...a}),!0)})}deleteNode(){let a=this.getPos();if("number"!=typeof a)return;let b=a+this.node.nodeSize;this.editor.commands.deleteRange({from:a,to:b})}};function hf(a){return new gJ({find:a.find,handler:({state:b,range:c,match:d,pasteEvent:e})=>{let f=fT(a.getAttributes,void 0,d,e);if(!1===f||null===f)return null;let{tr:g}=b,h=d[d.length-1],i=d[0],j=c.to;if(h){let d=i.search(/\S/),e=c.from+i.indexOf(h),k=e+h.length;if(f5(c.from,c.to,b.doc).filter(b=>b.mark.type.excluded.find(c=>c===a.type&&c!==b.mark.type)).filter(a=>a.to>e).length)return null;k<c.to&&g.delete(k,c.to),e>c.from&&g.delete(c.from+d,e),j=c.from+d+h.length,g.addMark(c.from+d,j,a.type.create(f||{})),g.removeStoredMark(a.type)}}})}var hg=a.i(651442),hh=a.i(864442),hi=({contentComponent:a})=>{let b=(0,M.useSyncExternalStore)(a.subscribe,a.getSnapshot,a.getServerSnapshot);return(0,f.jsx)(f.Fragment,{children:Object.values(b)})},hj=class extends K.default.Component{constructor(a){var b;super(a),this.editorContentRef=K.default.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!(null==(b=a.editor)?void 0:b.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){var a;let b=this.props.editor;if(b&&!b.isDestroyed&&(null==(a=b.view.dom)?void 0:a.parentNode)){let a,c;if(b.contentComponent)return;let d=this.editorContentRef.current;d.append(...b.view.dom.parentNode.childNodes),b.setOptions({element:d}),a=new Set,c={},b.contentComponent={subscribe:b=>(a.add(b),()=>{a.delete(b)}),getSnapshot:()=>c,getServerSnapshot:()=>c,setRenderer(b,d){c={...c,[b]:L.default.createPortal(d.reactElement,d.element,b)},a.forEach(a=>a())},removeRenderer(b){let d={...c};delete d[b],c=d,a.forEach(a=>a())}},this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=b.contentComponent.subscribe(()=>{this.setState(a=>a.hasContentComponentInitialized?a:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),b.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var a;let b=this.props.editor;if(b){this.initialized=!1,b.isDestroyed||b.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),b.contentComponent=null;try{if(!(null==(a=b.view.dom)?void 0:a.parentNode))return;let c=document.createElement("div");c.append(...b.view.dom.parentNode.childNodes),b.setOptions({element:c})}catch{}}}render(){let{editor:a,innerRef:b,...c}=this.props;return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("div",{ref:((...a)=>b=>{a.forEach(a=>{"function"==typeof a?a(b):a&&(a.current=b)})})(b,this.editorContentRef),...c}),(null==a?void 0:a.contentComponent)&&(0,f.jsx)(hi,{contentComponent:a.contentComponent})]})}},hk=(0,K.forwardRef)((a,b)=>{let c=K.default.useMemo(()=>Math.floor(0xffffffff*Math.random()).toString(),[a.editor]);return K.default.createElement(hj,{key:c,innerRef:b,...a})}),hl=K.default.memo(hk),hm=K.useEffect,hn=class{constructor(a){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=a,this.lastSnapshot={editor:a,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber||(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber}),this.lastSnapshot}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(a){return this.subscribers.add(a),()=>{this.subscribers.delete(a)}}watch(a){if(this.editor=a,this.editor){let a=()=>{this.transactionNumber+=1,this.subscribers.forEach(a=>a())},b=this.editor;return b.on("transaction",a),()=>{b.off("transaction",a)}}}},ho=class a{constructor(a){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=a,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(a){this.editor=a,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(a=>a())}getInitialEditor(){return void 0===this.options.current.immediatelyRender?null:(this.options.current.immediatelyRender,this.options.current.immediatelyRender)?this.createEditor():null}createEditor(){return new g$({...this.options.current,onBeforeCreate:(...a)=>{var b,c;return null==(c=(b=this.options.current).onBeforeCreate)?void 0:c.call(b,...a)},onBlur:(...a)=>{var b,c;return null==(c=(b=this.options.current).onBlur)?void 0:c.call(b,...a)},onCreate:(...a)=>{var b,c;return null==(c=(b=this.options.current).onCreate)?void 0:c.call(b,...a)},onDestroy:(...a)=>{var b,c;return null==(c=(b=this.options.current).onDestroy)?void 0:c.call(b,...a)},onFocus:(...a)=>{var b,c;return null==(c=(b=this.options.current).onFocus)?void 0:c.call(b,...a)},onSelectionUpdate:(...a)=>{var b,c;return null==(c=(b=this.options.current).onSelectionUpdate)?void 0:c.call(b,...a)},onTransaction:(...a)=>{var b,c;return null==(c=(b=this.options.current).onTransaction)?void 0:c.call(b,...a)},onUpdate:(...a)=>{var b,c;return null==(c=(b=this.options.current).onUpdate)?void 0:c.call(b,...a)},onContentError:(...a)=>{var b,c;return null==(c=(b=this.options.current).onContentError)?void 0:c.call(b,...a)},onDrop:(...a)=>{var b,c;return null==(c=(b=this.options.current).onDrop)?void 0:c.call(b,...a)},onPaste:(...a)=>{var b,c;return null==(c=(b=this.options.current).onPaste)?void 0:c.call(b,...a)},onDelete:(...a)=>{var b,c;return null==(c=(b=this.options.current).onDelete)?void 0:c.call(b,...a)}})}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(a){return this.subscriptions.add(a),()=>{this.subscriptions.delete(a)}}static compareOptions(a,b){return Object.keys(a).every(c=>!!["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(c)||("extensions"===c&&a.extensions&&b.extensions?a.extensions.length===b.extensions.length&&a.extensions.every((a,c)=>{var d;return a===(null==(d=b.extensions)?void 0:d[c])}):a[c]===b[c]))}onRender(b){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&0===b.length?a.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(b),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(a){if(this.editor&&!this.editor.isDestroyed){if(null===this.previousDeps){this.previousDeps=a;return}if(this.previousDeps.length===a.length&&this.previousDeps.every((b,c)=>b===a[c]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=a}scheduleDestroy(){let a=this.instanceId,b=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===a){b&&b.setOptions(this.options.current);return}b&&!b.isDestroyed&&(b.destroy(),this.instanceId===a&&this.setEditor(null))},1)}};(0,K.createContext)({editor:null}).Consumer;var hp=(0,K.createContext)({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),hq=()=>(0,K.useContext)(hp);function hr({as:a="div",...b}){let{nodeViewContentRef:c,nodeViewContentChildren:d}=hq();return(0,f.jsx)(a,{...b,ref:c,"data-node-view-content":"",style:{whiteSpace:"pre-wrap",...b.style},children:d})}var hs=K.default.forwardRef((a,b)=>{let{onDragStart:c}=hq(),d=a.as||"div";return(0,f.jsx)(d,{...a,ref:b,"data-node-view-wrapper":"",onDragStart:c,style:{whiteSpace:"normal",...a.style}})});function ht(a){return!!("function"==typeof a&&a.prototype&&a.prototype.isReactComponent)}function hu(a){return!!("object"==typeof a&&a.$$typeof&&("Symbol(react.forward_ref)"===a.$$typeof.toString()||"react.forward_ref"===a.$$typeof.description))}var hv=class{constructor(a,{editor:b,props:c={},as:d="div",className:e=""}){this.ref=null,this.id=Math.floor(0xffffffff*Math.random()).toString(),this.component=a,this.editor=b,this.props=c,this.element=document.createElement(d),this.element.classList.add("react-renderer"),e&&this.element.classList.add(...e.split(" ")),this.editor.isInitialized?(0,L.flushSync)(()=>{this.render()}):queueMicrotask(()=>{this.render()})}render(){var a;let b=this.component,c=this.props,d=this.editor,e=function(){try{if(K.version)return parseInt(K.version.split(".")[0],10)>=19}catch{}return!1}(),g=function(a){if(ht(a)||hu(a))return!0;if("object"==typeof a&&a.$$typeof&&("Symbol(react.memo)"===a.$$typeof.toString()||"react.memo"===a.$$typeof.description)){let b=a.type;if(b)return ht(b)||hu(b)}return!1}(b),h={...c};h.ref&&!(e||g)&&delete h.ref,!h.ref&&(e||g)&&(h.ref=a=>{this.ref=a}),this.reactElement=(0,f.jsx)(b,{...h}),null==(a=null==d?void 0:d.contentComponent)||a.setRenderer(this.id,this)}updateProps(a={}){this.props={...this.props,...a},this.render()}destroy(){var a;let b=this.editor;null==(a=null==b?void 0:b.contentComponent)||a.removeRenderer(this.id);try{this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}catch{}}updateAttributes(a){Object.keys(a).forEach(b=>{this.element.setAttribute(b,a[b])})}};K.default.createContext({markViewContentRef:()=>{}});var hw=class extends he{constructor(a,b,c){if(super(a,b,c),this.selectionRafId=null,!this.node.isLeaf){this.options.contentDOMElementTag?this.contentDOMElement=document.createElement(this.options.contentDOMElementTag):this.contentDOMElement=document.createElement(this.node.isInline?"span":"div"),this.contentDOMElement.dataset.nodeViewContentReact="",this.contentDOMElement.dataset.nodeViewWrapper="",this.contentDOMElement.style.whiteSpace="inherit";const a=this.dom.querySelector("[data-node-view-content]");if(!a)return;a.appendChild(this.contentDOMElement)}}mount(){let a={editor:this.editor,node:this.node,decorations:this.decorations,innerDecorations:this.innerDecorations,view:this.view,selected:!1,extension:this.extension,HTMLAttributes:this.HTMLAttributes,getPos:()=>this.getPos(),updateAttributes:(a={})=>this.updateAttributes(a),deleteNode:()=>this.deleteNode(),ref:(0,K.createRef)()};if(!this.component.displayName){let a;this.component.displayName=(a=this.extension.name).charAt(0).toUpperCase()+a.substring(1)}let b={onDragStart:this.onDragStart.bind(this),nodeViewContentRef:a=>{a&&this.contentDOMElement&&a.firstChild!==this.contentDOMElement&&(a.hasAttribute("data-node-view-wrapper")&&a.removeAttribute("data-node-view-wrapper"),a.appendChild(this.contentDOMElement))}},c=this.component,d=(0,K.memo)(a=>(0,f.jsx)(hp.Provider,{value:b,children:(0,K.createElement)(c,a)}));d.displayName="ReactNodeView";let e=this.node.isInline?"span":"div";this.options.as&&(e=this.options.as);let{className:g=""}=this.options;this.handleSelectionUpdate=this.handleSelectionUpdate.bind(this),this.renderer=new hv(d,{editor:this.editor,props:a,as:e,className:`node-${this.node.type.name} ${g}`.trim()}),this.editor.on("selectionUpdate",this.handleSelectionUpdate),this.updateElementAttributes()}get dom(){var a;if(this.renderer.element.firstElementChild&&!(null==(a=this.renderer.element.firstElementChild)?void 0:a.hasAttribute("data-node-view-wrapper")))throw Error("Please use the NodeViewWrapper component for your node view.");return this.renderer.element}get contentDOM(){return this.node.isLeaf?null:this.contentDOMElement}handleSelectionUpdate(){this.selectionRafId&&(cancelAnimationFrame(this.selectionRafId),this.selectionRafId=null),this.selectionRafId=requestAnimationFrame(()=>{this.selectionRafId=null;let{from:a,to:b}=this.editor.state.selection,c=this.getPos();if("number"==typeof c)if(a<=c&&b>=c+this.node.nodeSize){if(this.renderer.props.selected)return;this.selectNode()}else{if(!this.renderer.props.selected)return;this.deselectNode()}})}update(a,b,c){let d=a=>{this.renderer.updateProps(a),"function"==typeof this.options.attrs&&this.updateElementAttributes()};if(a.type!==this.node.type)return!1;if("function"==typeof this.options.update){let e=this.node,f=this.decorations,g=this.innerDecorations;return this.node=a,this.decorations=b,this.innerDecorations=c,this.options.update({oldNode:e,oldDecorations:f,newNode:a,newDecorations:b,oldInnerDecorations:g,innerDecorations:c,updateProps:()=>d({node:a,decorations:b,innerDecorations:c})})}return a===this.node&&this.decorations===b&&this.innerDecorations===c||(this.node=a,this.decorations=b,this.innerDecorations=c,d({node:a,decorations:b,innerDecorations:c}),!0)}selectNode(){this.renderer.updateProps({selected:!0}),this.renderer.element.classList.add("ProseMirror-selectednode")}deselectNode(){this.renderer.updateProps({selected:!1}),this.renderer.element.classList.remove("ProseMirror-selectednode")}destroy(){this.renderer.destroy(),this.editor.off("selectionUpdate",this.handleSelectionUpdate),this.contentDOMElement=null,this.selectionRafId&&(cancelAnimationFrame(this.selectionRafId),this.selectionRafId=null)}updateElementAttributes(){if(this.options.attrs){let a={};if("function"==typeof this.options.attrs){let b=this.editor.extensionManager.attributes,c=fX(this.node,b);a=this.options.attrs({node:this.node,HTMLAttributes:c})}else a=this.options.attrs;this.renderer.updateAttributes(a)}}};function hx(a,b){return c=>c.editor.contentComponent?new hw(a,c,b):{}}var hy=(a,b)=>{if("slot"===a)return 0;if(a instanceof Function)return a(b);let{children:c,...d}=null!=b?b:{};if("svg"===a)throw Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[a,d,c]},hz=/^\s*>\s$/,hA=hd.create({name:"blockquote",addOptions:()=>({HTMLAttributes:{}}),content:"block+",group:"block",defining:!0,parseHTML:()=>[{tag:"blockquote"}],renderHTML({HTMLAttributes:a}){return hy("blockquote",{...fW(this.options.HTMLAttributes,a),children:hy("slot",{})})},parseMarkdown:(a,b)=>b.createNode("blockquote",void 0,b.parseChildren(a.tokens||[])),renderMarkdown:(a,b)=>{if(!a.content)return"";let c=[];return a.content.forEach(a=>{let d=b.renderChildren([a]).split("\n").map(a=>""===a.trim()?">":`> ${a}`);c.push(d.join("\n"))}),c.join(`
>
`)},addCommands(){return{setBlockquote:()=>({commands:a})=>a.wrapIn(this.name),toggleBlockquote:()=>({commands:a})=>a.toggleWrap(this.name),unsetBlockquote:()=>({commands:a})=>a.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[g2({find:hz,type:this.type})]}}),hB=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,hC=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,hD=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,hE=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,hF=gI.create({name:"bold",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:a=>"normal"!==a.style.fontWeight&&null},{style:"font-weight=400",clearMark:a=>a.type.name===this.name},{style:"font-weight",getAttrs:a=>/^(bold(er)?|[5-9]\d{2,})$/.test(a)&&null}]},renderHTML({HTMLAttributes:a}){return hy("strong",{...fW(this.options.HTMLAttributes,a),children:hy("slot",{})})},markdownTokenName:"strong",parseMarkdown:(a,b)=>b.applyMark("bold",b.parseInline(a.tokens||[])),renderMarkdown:(a,b)=>`**${b.renderChildren(a)}**`,addCommands(){return{setBold:()=>({commands:a})=>a.setMark(this.name),toggleBold:()=>({commands:a})=>a.toggleMark(this.name),unsetBold:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[g_({find:hB,type:this.type}),g_({find:hD,type:this.type})]},addPasteRules(){return[hf({find:hC,type:this.type}),hf({find:hE,type:this.type})]}}),hG=/(^|[^`])`([^`]+)`(?!`)$/,hH=/(^|[^`])`([^`]+)`(?!`)/g,hI=gI.create({name:"code",addOptions:()=>({HTMLAttributes:{}}),excludes:"_",code:!0,exitable:!0,parseHTML:()=>[{tag:"code"}],renderHTML({HTMLAttributes:a}){return["code",fW(this.options.HTMLAttributes,a),0]},markdownTokenName:"codespan",parseMarkdown:(a,b)=>b.applyMark("code",[{type:"text",text:a.text||""}]),renderMarkdown:(a,b)=>a.content?`\`${b.renderChildren(a.content)}\``:"",addCommands(){return{setCode:()=>({commands:a})=>a.setMark(this.name),toggleCode:()=>({commands:a})=>a.toggleMark(this.name),unsetCode:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[g_({find:hG,type:this.type})]},addPasteRules(){return[hf({find:hH,type:this.type})]}}),hJ=/^```([a-z]+)?[\s\n]$/,hK=/^~~~([a-z]+)?[\s\n]$/,hL=hd.create({name:"codeBlock",addOptions:()=>({languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:4,HTMLAttributes:{}}),content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:a=>{var b;let{languageClassPrefix:c}=this.options;if(!c)return null;let d=[...(null==(b=a.firstElementChild)?void 0:b.classList)||[]].filter(a=>a.startsWith(c)).map(a=>a.replace(c,""))[0];return d||null},rendered:!1}}},parseHTML:()=>[{tag:"pre",preserveWhitespace:"full"}],renderHTML({node:a,HTMLAttributes:b}){return["pre",fW(this.options.HTMLAttributes,b),["code",{class:a.attrs.language?this.options.languageClassPrefix+a.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(a,b)=>{var c;return(null==(c=a.raw)?void 0:c.startsWith("```"))===!1&&"indented"!==a.codeBlockStyle?[]:b.createNode("codeBlock",{language:a.lang||null},a.text?[b.createTextNode(a.text)]:[])},renderMarkdown:(a,b)=>{var c;let d=(null==(c=a.attrs)?void 0:c.language)||"";return a.content?[`\`\`\`${d}`,b.renderChildren(a.content),"```"].join("\n"):`\`\`\`${d}

\`\`\``},addCommands(){return{setCodeBlock:a=>({commands:b})=>b.setNode(this.name,a),toggleCodeBlock:a=>({commands:b})=>b.toggleNode(this.name,"paragraph",a)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{let{empty:a,$anchor:b}=this.editor.state.selection,c=1===b.pos;return!!a&&b.parent.type.name===this.name&&(!!c||!b.parent.textContent.length)&&this.editor.commands.clearNodes()},Tab:({editor:a})=>{var b;if(!this.options.enableTabIndentation)return!1;let c=null!=(b=this.options.tabSize)?b:4,{state:d}=a,{selection:e}=d,{$from:f,empty:g}=e;if(f.parent.type!==this.type)return!1;let h=" ".repeat(c);return g?a.commands.insertContent(h):a.commands.command(({tr:a})=>{let{from:b,to:c}=e,f=d.doc.textBetween(b,c,"\n","\n").split("\n").map(a=>h+a).join("\n");return a.replaceWith(b,c,d.schema.text(f)),!0})},"Shift-Tab":({editor:a})=>{var b;if(!this.options.enableTabIndentation)return!1;let c=null!=(b=this.options.tabSize)?b:4,{state:d}=a,{selection:e}=d,{$from:f,empty:g}=e;return f.parent.type===this.type&&(g?a.commands.command(({tr:a})=>{var b;let{pos:e}=f,g=f.start(),h=f.end(),i=d.doc.textBetween(g,h,"\n","\n").split("\n"),j=0,k=0,l=e-g;for(let a=0;a<i.length;a+=1){if(k+i[a].length>=l){j=a;break}k+=i[a].length+1}let m=Math.min(((null==(b=i[j].match(/^ */))?void 0:b[0])||"").length,c);if(0===m)return!0;let n=g;for(let a=0;a<j;a+=1)n+=i[a].length+1;return a.delete(n,n+m),e-n<=m&&a.setSelection(bo.create(a.doc,n)),!0}):a.commands.command(({tr:a})=>{let{from:b,to:f}=e,g=d.doc.textBetween(b,f,"\n","\n").split("\n").map(a=>{var b;let d=Math.min(((null==(b=a.match(/^ */))?void 0:b[0])||"").length,c);return a.slice(d)}).join("\n");return a.replaceWith(b,f,d.schema.text(g)),!0}))},Enter:({editor:a})=>{if(!this.options.exitOnTripleEnter)return!1;let{state:b}=a,{selection:c}=b,{$from:d,empty:e}=c;if(!e||d.parent.type!==this.type)return!1;let f=d.parentOffset===d.parent.nodeSize-2,g=d.parent.textContent.endsWith("\n\n");return!!f&&!!g&&a.chain().command(({tr:a})=>(a.delete(d.pos-2,d.pos),!0)).exitCode().run()},ArrowDown:({editor:a})=>{if(!this.options.exitOnArrowDown)return!1;let{state:b}=a,{selection:c,doc:d}=b,{$from:e,empty:f}=c;if(!f||e.parent.type!==this.type||e.parentOffset!==e.parent.nodeSize-2)return!1;let g=e.after();return void 0!==g&&(d.nodeAt(g)?a.commands.command(({tr:a})=>(a.setSelection(bk.near(d.resolve(g))),!0)):a.commands.exitCode())}}},addInputRules(){return[g1({find:hJ,type:this.type,getAttributes:a=>({language:a[1]})}),g1({find:hK,type:this.type,getAttributes:a=>({language:a[1]})})]},addProseMirrorPlugins(){return[new bC({key:new bF("codeBlockVSCodeHandler"),props:{handlePaste:(a,b)=>{if(!b.clipboardData||this.editor.isActive(this.type.name))return!1;let c=b.clipboardData.getData("text/plain"),d=b.clipboardData.getData("vscode-editor-data"),e=d?JSON.parse(d):void 0,f=null==e?void 0:e.mode;if(!c||!f)return!1;let{tr:g,schema:h}=a.state,i=h.text(c.replace(/\r\n?/g,"\n"));return g.replaceSelectionWith(this.type.create({language:f},i)),g.selection.$from.parent.type!==this.type&&g.setSelection(bo.near(g.doc.resolve(Math.max(0,g.selection.from-2)))),g.setMeta("paste",!0),a.dispatch(g),!0}}})]}}),hM=hd.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(a,b)=>a.content?b.renderChildren(a.content,"\n\n"):""}),hN=hd.create({name:"hardBreak",markdownTokenName:"br",addOptions:()=>({keepMarks:!0,HTMLAttributes:{}}),inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML:()=>[{tag:"br"}],renderHTML({HTMLAttributes:a}){return["br",fW(this.options.HTMLAttributes,a)]},renderText:()=>"\n",renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:a,chain:b,state:c,editor:d})=>a.first([()=>a.exitCode(),()=>a.command(()=>{let{selection:a,storedMarks:e}=c;if(a.$from.parent.type.spec.isolating)return!1;let{keepMarks:f}=this.options,{splittableMarks:g}=d.extensionManager,h=e||a.$to.parentOffset&&a.$from.marks();return b().insertContent({type:this.name}).command(({tr:a,dispatch:b})=>{if(b&&h&&f){let b=h.filter(a=>g.includes(a.type.name));a.ensureMarks(b)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),hO=hd.create({name:"heading",addOptions:()=>({levels:[1,2,3,4,5,6],HTMLAttributes:{}}),content:"inline*",group:"block",defining:!0,addAttributes:()=>({level:{default:1,rendered:!1}}),parseHTML(){return this.options.levels.map(a=>({tag:`h${a}`,attrs:{level:a}}))},renderHTML({node:a,HTMLAttributes:b}){let c=this.options.levels.includes(a.attrs.level)?a.attrs.level:this.options.levels[0];return[`h${c}`,fW(this.options.HTMLAttributes,b),0]},parseMarkdown:(a,b)=>b.createNode("heading",{level:a.depth||1},b.parseInline(a.tokens||[])),renderMarkdown:(a,b)=>{var c;let d=(null==(c=a.attrs)?void 0:c.level)?parseInt(a.attrs.level,10):1,e="#".repeat(d);return a.content?`${e} ${b.renderChildren(a.content)}`:""},addCommands(){return{setHeading:a=>({commands:b})=>!!this.options.levels.includes(a.level)&&b.setNode(this.name,a),toggleHeading:a=>({commands:b})=>!!this.options.levels.includes(a.level)&&b.toggleNode(this.name,"paragraph",a)}},addKeyboardShortcuts(){return this.options.levels.reduce((a,b)=>({...a,...{[`Mod-Alt-${b}`]:()=>this.editor.commands.toggleHeading({level:b})}}),{})},addInputRules(){return this.options.levels.map(a=>g1({find:RegExp(`^(#{${Math.min(...this.options.levels)},${a}})\\s$`),type:this.type,getAttributes:{level:a}}))}}),hP=hd.create({name:"horizontalRule",addOptions:()=>({HTMLAttributes:{},nextNodeType:"paragraph"}),group:"block",parseHTML:()=>[{tag:"hr"}],renderHTML({HTMLAttributes:a}){return["hr",fW(this.options.HTMLAttributes,a)]},markdownTokenName:"hr",parseMarkdown:(a,b)=>b.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:a,state:b})=>{if(!function(a,b){let{selection:c}=a,{$from:d}=c;if(c instanceof bq){let a=d.index();return d.parent.canReplaceWith(a,a+1,b)}let e=d.depth;for(;e>=0;){let a=d.index(e);if(d.node(e).contentMatchAt(a).matchType(b))return!0;e-=1}return!1}(b,b.schema.nodes[this.name]))return!1;let{selection:c}=b,{$to:d}=c,e=a();return gc(c)?e.insertContentAt(d.pos,{type:this.name}):e.insertContent({type:this.name}),e.command(({state:a,tr:b,dispatch:c})=>{if(c){let{$to:c}=b.selection,d=c.end();if(c.nodeAfter)c.nodeAfter.isTextblock?b.setSelection(bo.create(b.doc,c.pos+1)):c.nodeAfter.isBlock?b.setSelection(bq.create(b.doc,c.pos)):b.setSelection(bo.create(b.doc,c.pos));else{let e=a.schema.nodes[this.options.nextNodeType]||c.parent.type.contentMatch.defaultType,f=null==e?void 0:e.create();f&&(b.insert(d,f),b.setSelection(bo.create(b.doc,d+1)))}b.scrollIntoView()}return!0}).run()}}},addInputRules(){return[g0({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),hQ=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,hR=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,hS=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,hT=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,hU=gI.create({name:"italic",addOptions:()=>({HTMLAttributes:{}}),parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:a=>"normal"!==a.style.fontStyle&&null},{style:"font-style=normal",clearMark:a=>a.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:a}){return["em",fW(this.options.HTMLAttributes,a),0]},addCommands(){return{setItalic:()=>({commands:a})=>a.setMark(this.name),toggleItalic:()=>({commands:a})=>a.toggleMark(this.name),unsetItalic:()=>({commands:a})=>a.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(a,b)=>b.applyMark("italic",b.parseInline(a.tokens||[])),renderMarkdown:(a,b)=>`*${b.renderChildren(a)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[g_({find:hQ,type:this.type}),g_({find:hS,type:this.type})]},addPasteRules(){return[hf({find:hR,type:this.type}),hf({find:hT,type:this.type})]}});let hV="numeric",hW="ascii",hX="alpha",hY="asciinumeric",hZ="alphanumeric",h$="domain",h_="emoji",h0="whitespace";function h1(a,b,c){for(let d in b[hV]&&(b[hY]=!0,b[hZ]=!0),b[hW]&&(b[hY]=!0,b[hX]=!0),b[hY]&&(b[hZ]=!0),b[hX]&&(b[hZ]=!0),b[hZ]&&(b[h$]=!0),b[h_]&&(b[h$]=!0),b){let b=(d in c||(c[d]=[]),c[d]);0>b.indexOf(a)&&b.push(a)}}function h2(a=null){this.j={},this.jr=[],this.jd=null,this.t=a}h2.groups={},h2.prototype={accepts(){return!!this.t},go(a){let b=this.j[a];if(b)return b;for(let b=0;b<this.jr.length;b++){let c=this.jr[b][0],d=this.jr[b][1];if(d&&c.test(a))return d}return this.jd},has(a,b=!1){return b?a in this.j:!!this.go(a)},ta(a,b,c,d){for(let e=0;e<a.length;e++)this.tt(a[e],b,c,d)},tr(a,b,c,d){let e;return d=d||h2.groups,b&&b.j?e=b:(e=new h2(b),c&&d&&h1(b,c,d)),this.jr.push([a,e]),e},ts(a,b,c,d){let e=this,f=a.length;if(!f)return e;for(let b=0;b<f-1;b++)e=e.tt(a[b]);return e.tt(a[f-1],b,c,d)},tt(a,b,c,d){if(d=d||h2.groups,b&&b.j)return this.j[a]=b,b;let e,f=this.go(a);return f?(Object.assign((e=new h2).j,f.j),e.jr.push.apply(e.jr,f.jr),e.jd=f.jd,e.t=f.t):e=new h2,b&&(d&&(e.t&&"string"==typeof e.t?h1(b,Object.assign(function(a,b){let c={};for(let d in b)b[d].indexOf(a)>=0&&(c[d]=!0);return c}(e.t,d),c),d):c&&h1(b,c,d)),e.t=b),this.j[a]=e,e}};let h3=(a,b,c,d,e)=>a.ta(b,c,d,e),h4=(a,b,c,d,e)=>a.tr(b,c,d,e),h5=(a,b,c,d,e)=>a.ts(b,c,d,e),h6=(a,b,c,d,e)=>a.tt(b,c,d,e),h7="WORD",h8="UWORD",h9="ASCIINUMERICAL",ia="ALPHANUMERICAL",ib="LOCALHOST",ic="UTLD",id="SCHEME",ie="SLASH_SCHEME",ig="OPENBRACE",ih="CLOSEBRACE",ii="OPENBRACKET",ij="CLOSEBRACKET",ik="OPENPAREN",il="CLOSEPAREN",im="OPENANGLEBRACKET",io="CLOSEANGLEBRACKET",ip="FULLWIDTHLEFTPAREN",iq="FULLWIDTHRIGHTPAREN",ir="LEFTCORNERBRACKET",is="RIGHTCORNERBRACKET",it="LEFTWHITECORNERBRACKET",iu="RIGHTWHITECORNERBRACKET",iv="FULLWIDTHLESSTHAN",iw="FULLWIDTHGREATERTHAN",ix="AMPERSAND",iy="APOSTROPHE",iz="ASTERISK",iA="BACKSLASH",iB="BACKTICK",iC="CARET",iD="COLON",iE="COMMA",iF="DOLLAR",iG="EQUALS",iH="EXCLAMATION",iI="HYPHEN",iJ="PERCENT",iK="PIPE",iL="PLUS",iM="POUND",iN="QUERY",iO="QUOTE",iP="FULLWIDTHMIDDLEDOT",iQ="SEMI",iR="SLASH",iS="TILDE",iT="UNDERSCORE",iU="EMOJI";var iV=Object.freeze({__proto__:null,ALPHANUMERICAL:ia,AMPERSAND:ix,APOSTROPHE:iy,ASCIINUMERICAL:h9,ASTERISK:iz,AT:"AT",BACKSLASH:iA,BACKTICK:iB,CARET:iC,CLOSEANGLEBRACKET:io,CLOSEBRACE:ih,CLOSEBRACKET:ij,CLOSEPAREN:il,COLON:iD,COMMA:iE,DOLLAR:iF,DOT:"DOT",EMOJI:iU,EQUALS:iG,EXCLAMATION:iH,FULLWIDTHGREATERTHAN:iw,FULLWIDTHLEFTPAREN:ip,FULLWIDTHLESSTHAN:iv,FULLWIDTHMIDDLEDOT:iP,FULLWIDTHRIGHTPAREN:iq,HYPHEN:iI,LEFTCORNERBRACKET:ir,LEFTWHITECORNERBRACKET:it,LOCALHOST:ib,NL:"NL",NUM:"NUM",OPENANGLEBRACKET:im,OPENBRACE:ig,OPENBRACKET:ii,OPENPAREN:ik,PERCENT:iJ,PIPE:iK,PLUS:iL,POUND:iM,QUERY:iN,QUOTE:iO,RIGHTCORNERBRACKET:is,RIGHTWHITECORNERBRACKET:iu,SCHEME:id,SEMI:iQ,SLASH:iR,SLASH_SCHEME:ie,SYM:"SYM",TILDE:iS,TLD:"TLD",UNDERSCORE:iT,UTLD:ic,UWORD:h8,WORD:h7,WS:"WS"});let iW=/[a-z]/,iX=/\p{L}/u,iY=/\p{Emoji}/u,iZ=/\d/,i$=/\s/,i_=null,i0=null;function i1(a,b){let c=function(a){let b=[],c=a.length,d=0;for(;d<c;){let e,f=a.charCodeAt(d),g=f<55296||f>56319||d+1===c||(e=a.charCodeAt(d+1))<56320||e>57343?a[d]:a.slice(d,d+2);b.push(g),d+=g.length}return b}(b.replace(/[A-Z]/g,a=>a.toLowerCase())),d=c.length,e=[],f=0,g=0;for(;g<d;){let h=a,i=null,j=0,k=null,l=-1,m=-1;for(;g<d&&(i=h.go(c[g]));)(h=i).accepts()?(l=0,m=0,k=h):l>=0&&(l+=c[g].length,m++),j+=c[g].length,f+=c[g].length,g++;f-=l,g-=m,j-=l,e.push({t:k.t,v:b.slice(f-j,f),s:f-j,e:f})}return e}function i2(a,b,c,d,e){let f,g=b.length;for(let c=0;c<g-1;c++){let g=b[c];a.j[g]?f=a.j[g]:((f=new h2(d)).jr=e.slice(),a.j[g]=f),a=f}return(f=new h2(c)).jr=e.slice(),a.j[b[g-1]]=f,f}function i3(a){let b=[],c=[],d=0;for(;d<a.length;){let e=0;for(;"0123456789".indexOf(a[d+e])>=0;)e++;if(e>0){b.push(c.join(""));for(let b=parseInt(a.substring(d,d+e),10);b>0;b--)c.pop();d+=e}else c.push(a[d]),d++}return b}let i4={defaultProtocol:"http",events:null,format:i6,formatHref:i6,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function i5(a,b=null){let c=Object.assign({},i4);a&&(c=Object.assign(c,a instanceof i5?a.o:a));let d=c.ignoreTags,e=[];for(let a=0;a<d.length;a++)e.push(d[a].toUpperCase());this.o=c,b&&(this.defaultRender=b),this.ignoreTags=e}function i6(a){return a}function i7(a,b){this.t="token",this.v=a,this.tk=b}function i8(a,b){class c extends i7{constructor(b,c){super(b,c),this.t=a}}for(let a in b)c.prototype[a]=b[a];return c.t=a,c}i5.prototype={o:i4,ignoreTags:[],defaultRender:a=>a,check(a){return this.get("validate",a.toString(),a)},get(a,b,c){let d=null!=b,e=this.o[a];return e&&("object"==typeof e?"function"==typeof(e=c.t in e?e[c.t]:i4[a])&&d&&(e=e(b,c)):"function"==typeof e&&d&&(e=e(b,c.t,c))),e},getObj(a,b,c){let d=this.o[a];return"function"==typeof d&&null!=b&&(d=d(b,c.t,c)),d},render(a){let b=a.render(this);return(this.get("render",null,a)||this.defaultRender)(b,a.t,a)}},i7.prototype={isLink:!1,toString(){return this.v},toHref(a){return this.toString()},toFormattedString(a){let b=this.toString(),c=a.get("truncate",b,this),d=a.get("format",b,this);return c&&d.length>c?d.substring(0,c)+"":d},toFormattedHref(a){return a.get("formatHref",this.toHref(a.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(a=i4.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(a),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(a){return{type:this.t,value:this.toFormattedString(a),isLink:this.isLink,href:this.toFormattedHref(a),start:this.startIndex(),end:this.endIndex()}},validate(a){return a.get("validate",this.toString(),this)},render(a){let b=this.toHref(a.get("defaultProtocol")),c=a.get("formatHref",b,this),d=a.get("tagName",b,this),e=this.toFormattedString(a),f={},g=a.get("className",b,this),h=a.get("target",b,this),i=a.get("rel",b,this),j=a.getObj("attributes",b,this),k=a.getObj("events",b,this);return f.href=c,g&&(f.class=g),h&&(f.target=h),i&&(f.rel=i),j&&Object.assign(f,j),{tagName:d,attributes:f,content:e,eventListeners:k}}};let i9=i8("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),ja=i8("text"),jb=i8("nl"),jc=i8("url",{isLink:!0,toHref(a=i4.defaultProtocol){return this.hasProtocol()?this.v:`${a}://${this.v}`},hasProtocol(){let a=this.tk;return a.length>=2&&a[0].t!==ib&&a[1].t===iD}}),jd=a=>new h2(a);function je(a,b,c){let d=c[0].s,e=c[c.length-1].e;return new a(b.slice(d,e),c)}let jf="undefined"!=typeof console&&console&&console.warn||(()=>{}),jg={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function jh(a,b=!1){if(jg.initialized&&jf(`linkifyjs: already initialized - will not register custom scheme "${a}" until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(a))throw Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);jg.customSchemes.push([a,b])}function ji(a){return jg.initialized||function(){jg.scanner=function(a=[]){let b={};h2.groups=b;let c=new h2;null==i_&&(i_=i3("aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2")),null==i0&&(i0=i3("121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222")),h6(c,"'",iy),h6(c,"{",ig),h6(c,"}",ih),h6(c,"[",ii),h6(c,"]",ij),h6(c,"(",ik),h6(c,")",il),h6(c,"<",im),h6(c,">",io),h6(c,"",ip),h6(c,"",iq),h6(c,"",ir),h6(c,"",is),h6(c,"",it),h6(c,"",iu),h6(c,"",iv),h6(c,"",iw),h6(c,"&",ix),h6(c,"*",iz),h6(c,"@","AT"),h6(c,"`",iB),h6(c,"^",iC),h6(c,":",iD),h6(c,",",iE),h6(c,"$",iF),h6(c,".","DOT"),h6(c,"=",iG),h6(c,"!",iH),h6(c,"-",iI),h6(c,"%",iJ),h6(c,"|",iK),h6(c,"+",iL),h6(c,"#",iM),h6(c,"?",iN),h6(c,'"',iO),h6(c,"/",iR),h6(c,";",iQ),h6(c,"~",iS),h6(c,"_",iT),h6(c,"\\",iA),h6(c,"",iP);let d=h4(c,iZ,"NUM",{[hV]:!0});h4(d,iZ,d);let e=h4(d,iW,h9,{[hY]:!0}),f=h4(d,iX,ia,{[hZ]:!0}),g=h4(c,iW,h7,{[hW]:!0});h4(g,iZ,e),h4(g,iW,g),h4(e,iZ,e),h4(e,iW,e);let h=h4(c,iX,h8,{[hX]:!0});h4(h,iW),h4(h,iZ,f),h4(h,iX,h),h4(f,iZ,f),h4(f,iW),h4(f,iX,f);let i=h6(c,"\n","NL",{[h0]:!0}),j=h6(c,"\r","WS",{[h0]:!0}),k=h4(c,i$,"WS",{[h0]:!0});h6(c,"",k),h6(j,"\n",i),h6(j,"",k),h4(j,i$,k),h6(k,"\r"),h6(k,"\n"),h4(k,i$,k),h6(k,"",k);let l=h4(c,iY,iU,{[h_]:!0});h6(l,"#"),h4(l,iY,l),h6(l,"",l);let m=h6(l,"");h6(m,"#"),h4(m,iY,l);let n=[[iW,g],[iZ,e]],o=[[iW,null],[iX,h],[iZ,f]];for(let a=0;a<i_.length;a++)i2(c,i_[a],"TLD",h7,n);for(let a=0;a<i0.length;a++)i2(c,i0[a],ic,h8,o);h1("TLD",{tld:!0,ascii:!0},b),h1(ic,{utld:!0,alpha:!0},b),i2(c,"file",id,h7,n),i2(c,"mailto",id,h7,n),i2(c,"http",ie,h7,n),i2(c,"https",ie,h7,n),i2(c,"ftp",ie,h7,n),i2(c,"ftps",ie,h7,n),h1(id,{scheme:!0,ascii:!0},b),h1(ie,{slashscheme:!0,ascii:!0},b),a=a.sort((a,b)=>a[0]>b[0]?1:-1);for(let b=0;b<a.length;b++){let d=a[b][0],e=a[b][1]?{scheme:!0}:{slashscheme:!0};d.indexOf("-")>=0?e[h$]=!0:iW.test(d)?iZ.test(d)?e[hY]=!0:e[hW]=!0:e[hV]=!0,h5(c,d,d,e)}return h5(c,"localhost",ib,{ascii:!0}),c.jd=new h2("SYM"),{start:c,tokens:Object.assign({groups:b},iV)}}(jg.customSchemes);for(let a=0;a<jg.tokenQueue.length;a++)jg.tokenQueue[a][1]({scanner:jg.scanner});jg.parser=function({groups:a}){let b=a.domain.concat([ix,iz,"AT",iA,iB,iC,iF,iG,iI,"NUM",iJ,iK,iL,iM,iR,"SYM",iS,iT]),c=[iy,iD,iE,"DOT",iH,iJ,iN,iO,iQ,im,io,ig,ih,ij,ii,ik,il,ip,iq,ir,is,it,iu,iv,iw],d=[ix,iy,iz,iA,iB,iC,iF,iG,iI,ig,ih,iJ,iK,iL,iM,iN,iR,"SYM",iS,iT],e=jd(),f=h6(e,iS);h3(f,d,f),h3(f,a.domain,f);let g=jd(),h=jd(),i=jd();h3(e,a.domain,g),h3(e,a.scheme,h),h3(e,a.slashscheme,i),h3(g,d,f),h3(g,a.domain,g);let j=h6(g,"AT");h6(f,"AT",j),h6(h,"AT",j),h6(i,"AT",j);let k=h6(f,"DOT");h3(k,d,f),h3(k,a.domain,f);let l=jd();h3(j,a.domain,l),h3(l,a.domain,l);let m=h6(l,"DOT");h3(m,a.domain,l);let n=jd(i9);h3(m,a.tld,n),h3(m,a.utld,n),h6(j,ib,n);let o=h6(l,iI);h6(o,iI,o),h3(o,a.domain,l),h3(n,a.domain,l),h6(n,"DOT",m),h6(n,iI,o),h3(h6(n,iD),a.numeric,i9);let p=h6(g,iI),q=h6(g,"DOT");h6(p,iI,p),h3(p,a.domain,g),h3(q,d,f),h3(q,a.domain,g);let r=jd(jc);h3(q,a.tld,r),h3(q,a.utld,r),h3(r,a.domain,g),h3(r,d,f),h6(r,"DOT",q),h6(r,iI,p),h6(r,"AT",j);let s=h6(r,iD),t=jd(jc);h3(s,a.numeric,t);let u=jd(jc),v=jd();h3(u,b,u),h3(u,c,v),h3(v,b,u),h3(v,c,v),h6(r,iR,u),h6(t,iR,u);let w=h6(h,iD),x=h6(i,iD),y=h6(x,iR),z=h6(y,iR);h3(h,a.domain,g),h6(h,"DOT",q),h6(h,iI,p),h3(i,a.domain,g),h6(i,"DOT",q),h6(i,iI,p),h3(w,a.domain,u),h6(w,iR,u),h6(w,iN,u),h3(z,a.domain,u),h3(z,b,u),h6(z,iR,u);let A=[[ig,ih],[ii,ij],[ik,il],[im,io],[ip,iq],[ir,is],[it,iu],[iv,iw]];for(let a=0;a<A.length;a++){let[d,e]=A[a],f=h6(u,d);h6(v,d,f),h6(f,e,u);let g=jd(jc);h3(f,b,g);let h=jd();h3(f,c),h3(g,b,g),h3(g,c,h),h3(h,b,g),h3(h,c,h),h6(g,e,u),h6(h,e,u)}return h6(e,ib,r),h6(e,"NL",jb),{start:e,tokens:iV}}(jg.scanner.tokens);for(let a=0;a<jg.pluginQueue.length;a++)jg.pluginQueue[a][1]({scanner:jg.scanner,parser:jg.parser});jg.initialized=!0}(),function(a,b,c){let d=c.length,e=0,f=[],g=[];for(;e<d;){let h=a,i=null,j=null,k=0,l=null,m=-1;for(;e<d&&!(i=h.go(c[e].t));)g.push(c[e++]);for(;e<d&&(j=i||h.go(c[e].t));)i=null,(h=j).accepts()?(m=0,l=h):m>=0&&m++,e++,k++;if(m<0)(e-=k)<d&&(g.push(c[e]),e++);else{g.length>0&&(f.push(je(ja,b,g)),g=[]),e-=m,k-=m;let a=l.t,d=c.slice(e-k,e);f.push(je(a,b,d))}}return g.length>0&&f.push(je(ja,b,g)),f}(jg.parser.start,a,i1(jg.scanner.start,a))}function jj(a,b=null,c=null){if(b&&"object"==typeof b){if(c)throw Error(`linkifyjs: Invalid link type ${b}; must be a string`);c=b,b=null}let d=new i5(c),e=ji(a),f=[];for(let a=0;a<e.length;a++){let c=e[a];c.isLink&&(!b||c.t===b)&&d.check(c)&&f.push(c.toFormattedObject(d))}return f}ji.scan=i1;var jk="[\0- -\u2029]",jl=new RegExp(jk),jm=RegExp(`${jk}$`),jn=RegExp(jk,"g");function jo(a,b){let c=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return b&&b.forEach(a=>{let b="string"==typeof a?a:a.scheme;b&&c.push(b)}),!a||a.replace(jn,"").match(RegExp(`^(?:(?:${c.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var jp=gI.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(a=>{"string"==typeof a?jh(a):jh(a.scheme,a.optionalSlashes)})},onDestroy(){h2.groups={},jg.scanner=null,jg.parser=null,jg.tokenQueue=[],jg.pluginQueue=[],jg.customSchemes=[],jg.initialized=!1},inclusive(){return this.options.autolink},addOptions:()=>({openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(a,b)=>!!jo(a,b.protocols),validate:a=>!!a,shouldAutoLink:a=>!!a}),addAttributes(){return{href:{default:null,parseHTML:a=>a.getAttribute("href")},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:a=>{let b=a.getAttribute("href");return!!b&&!!this.options.isAllowedUri(b,{defaultValidate:a=>!!jo(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&null}}]},renderHTML({HTMLAttributes:a}){return this.options.isAllowedUri(a.href,{defaultValidate:a=>!!jo(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",fW(this.options.HTMLAttributes,a),0]:["a",fW(this.options.HTMLAttributes,{...a,href:""}),0]},markdownTokenName:"link",parseMarkdown:(a,b)=>b.applyMark("link",b.parseInline(a.tokens||[]),{href:a.href,title:a.title||null}),renderMarkdown:(a,b)=>{var c;let d=(null==(c=a.attrs)?void 0:c.href)||"",e=b.renderChildren(a);return`[${e}](${d})`},addCommands(){return{setLink:a=>({chain:b})=>{let{href:c}=a;return!!this.options.isAllowedUri(c,{defaultValidate:a=>!!jo(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})&&b().setMark(this.name,a).setMeta("preventAutolink",!0).run()},toggleLink:a=>({chain:b})=>{let{href:c}=a||{};return(!c||!!this.options.isAllowedUri(c,{defaultValidate:a=>!!jo(a,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol}))&&b().toggleMark(this.name,a,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:a})=>a().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[hf({find:a=>{let b=[];if(a){let{protocols:c,defaultProtocol:d}=this.options,e=jj(a).filter(a=>a.isLink&&this.options.isAllowedUri(a.value,{defaultValidate:a=>!!jo(a,c),protocols:c,defaultProtocol:d}));e.length&&e.forEach(a=>{this.options.shouldAutoLink(a.value)&&b.push({text:a.value,data:{href:a.href},index:a.start})})}return b},type:this.type,getAttributes:a=>{var b;return{href:null==(b=a.data)?void 0:b.href}}})]},addProseMirrorPlugins(){var a,b,c;let d=[],{protocols:e,defaultProtocol:f}=this.options;return this.options.autolink&&d.push((a={type:this.type,defaultProtocol:this.options.defaultProtocol,validate:a=>this.options.isAllowedUri(a,{defaultValidate:a=>!!jo(a,e),protocols:e,defaultProtocol:f}),shouldAutoLink:this.options.shouldAutoLink},new bC({key:new bF("autolink"),appendTransaction:(b,c,d)=>{let e=b.some(a=>a.docChanged)&&!c.doc.eq(d.doc),f=b.some(a=>a.getMeta("preventAutolink"));if(!e||f)return;let{tr:g}=d;if(f4(fM(c.doc,[...b])).forEach(({newRange:b})=>{var c,e;let f,h,i,j=(c=d.doc,e=a=>a.isTextblock,i=[],c.nodesBetween(b.from,b.to,(a,b)=>{e(a)&&i.push({node:a,pos:b})}),i);if(j.length>1)f=j[0],h=d.doc.textBetween(f.pos,f.pos+f.node.nodeSize,void 0," ");else if(j.length){let a=d.doc.textBetween(b.from,b.to," "," ");if(!jm.test(a))return;f=j[0],h=d.doc.textBetween(f.pos,b.to,void 0," ")}if(f&&h){let b=h.split(jl).filter(Boolean);if(b.length<=0)return!1;let c=b[b.length-1],e=f.pos+h.lastIndexOf(c);if(!c)return!1;let i=ji(c).map(b=>b.toObject(a.defaultProtocol));if(!(1===i.length?i[0].isLink:3===i.length&&!!i[1].isLink&&["()","[]"].includes(i[0].value+i[2].value)))return!1;i.filter(a=>a.isLink).map(a=>({...a,from:e+a.start+1,to:e+a.end+1})).filter(a=>!d.schema.marks.code||!d.doc.rangeHasMark(a.from,a.to,d.schema.marks.code)).filter(b=>a.validate(b.value)).filter(b=>a.shouldAutoLink(b.value)).forEach(b=>{f5(b.from,b.to,d.doc).some(b=>b.mark.type===a.type)||g.addMark(b.from,b.to,a.type.create({href:b.href}))})}}),g.steps.length)return g}}))),d.push((b={type:this.type,editor:this.editor,openOnClick:"whenNotEditable"===this.options.openOnClick||this.options.openOnClick,enableClickSelection:this.options.enableClickSelection},new bC({key:new bF("handleClickLink"),props:{handleClick:(a,c,d)=>{var e,f;if(0!==d.button||!a.editable)return!1;let g=!1;if(b.enableClickSelection&&(g=b.editor.commands.extendMarkRange(b.type.name)),b.openOnClick){let c=null;if(d.target instanceof HTMLAnchorElement)c=d.target;else{let a=d.target,b=[];for(;"DIV"!==a.nodeName;)b.push(a),a=a.parentNode;c=b.find(a=>"A"===a.nodeName)}if(!c)return g;let h=f3(a.state,b.type.name),i=null!=(e=null==c?void 0:c.href)?e:h.href,j=null!=(f=null==c?void 0:c.target)?f:h.target;c&&i&&(window.open(i,j),g=!0)}return g}}}))),this.options.linkOnPaste&&d.push((c={editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink},new bC({key:new bF("handlePasteLink"),props:{handlePaste:(a,b,d)=>{let{shouldAutoLink:e}=c,{state:f}=a,{selection:g}=f,{empty:h}=g;if(h)return!1;let i="";d.content.forEach(a=>{i+=a.textContent});let j=jj(i,{defaultProtocol:c.defaultProtocol}).find(a=>a.isLink&&a.value===i);return!!i&&!!j&&(void 0===e||!!e(j.href))&&c.editor.commands.setMark(c.type,{href:j.href})}}}))),d}}),jq=Object.defineProperty,jr="textStyle",js=/^\s*([-+*])\s$/,jt=hd.create({name:"bulletList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML:()=>[{tag:"ul"}],renderHTML({HTMLAttributes:a}){return["ul",fW(this.options.HTMLAttributes,a),0]},markdownTokenName:"list",parseMarkdown:(a,b)=>"list"!==a.type||a.ordered?[]:{type:"bulletList",content:a.items?b.parseChildren(a.items):[]},renderMarkdown:(a,b)=>a.content?b.renderChildren(a.content,"\n"):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:a,chain:b})=>this.options.keepAttributes?b().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(jr)).run():a.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let a=g2({find:js,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(a=g2({find:js,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(jr),editor:this.editor})),[a]}}),ju=hd.create({name:"listItem",addOptions:()=>({HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}),content:"paragraph block*",defining:!0,parseHTML:()=>[{tag:"li"}],renderHTML({HTMLAttributes:a}){return["li",fW(this.options.HTMLAttributes,a),0]},markdownTokenName:"list_item",parseMarkdown:(a,b)=>{if("list_item"!==a.type)return[];let c=[];if(a.tokens&&a.tokens.length>0)if(a.tokens.some(a=>"paragraph"===a.type))c=b.parseChildren(a.tokens);else{let d=a.tokens[0];if(d&&"text"===d.type&&d.tokens&&d.tokens.length>0){if(c=[{type:"paragraph",content:b.parseInline(d.tokens)}],a.tokens.length>1){let d=a.tokens.slice(1),e=b.parseChildren(d);c.push(...e)}}else c=b.parseChildren(a.tokens)}return 0===c.length&&(c=[{type:"paragraph",content:[]}]),{type:"listItem",content:c}},renderMarkdown:(a,b,c)=>hc(a,b,a=>"bulletList"===a.parentType?"- ":"orderedList"===a.parentType?`${a.index+1}. `:"- ",c),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),jv={},jw={findListItemPos:()=>jy,getNextListDepth:()=>jz,handleBackspace:()=>jD,handleDelete:()=>jG,hasListBefore:()=>jA,hasListItemAfter:()=>jH,hasListItemBefore:()=>jB,listItemHasSubList:()=>jC,nextListIsDeeper:()=>jE,nextListIsHigher:()=>jF};for(var jx in jw)jq(jv,jx,{get:jw[jx],enumerable:!0});var jy=(a,b)=>{let{$from:c}=b.selection,d=eX(a,b.schema),e=c.depth,f=c.pos,g=null;for(;e>0&&null===g;)c.node(e).type===d?g=e:(e-=1,f-=1);return null===g?null:{$pos:b.doc.resolve(f),depth:g}},jz=(a,b)=>{let c=jy(a,b);if(!c)return!1;let[,d]=((a,b,c,d=20)=>{let e=a.doc.resolve(c),f=d,g=null;for(;f>0&&null===g;){let a=e.node(f);(null==a?void 0:a.type.name)===b?g=a:f-=1}return[g,f]})(b,a,c.$pos.pos+4);return d},jA=(a,b,c)=>{let{$anchor:d}=a.selection,e=Math.max(0,d.pos-2),f=a.doc.resolve(e).node();return!!f&&!!c.includes(f.type.name)},jB=(a,b)=>{var c;let{$anchor:d}=b.selection,e=b.doc.resolve(d.pos-2);return 0!==e.index()&&(null==(c=e.nodeBefore)?void 0:c.type.name)===a},jC=(a,b,c)=>{if(!c)return!1;let d=eX(a,b.schema),e=!1;return c.descendants(a=>{a.type===d&&(e=!0)}),e},jD=(a,b,c)=>{if(a.commands.undoInputRule())return!0;if(a.state.selection.from!==a.state.selection.to)return!1;if(!fu(a.state,b)&&jA(a.state,b,c)){let{$anchor:c}=a.state.selection,d=a.state.doc.resolve(c.before()-1),e=[];d.node().descendants((a,c)=>{a.type.name===b&&e.push({node:a,pos:c})});let f=e.at(-1);if(!f)return!1;let g=a.state.doc.resolve(d.start()+f.pos+1);return a.chain().cut({from:c.start()-1,to:c.end()+1},g.end()).joinForward().run()}if(!fu(a.state,b)||!(a=>{let{$from:b,$to:c}=a.selection;return!(b.parentOffset>0)&&b.pos===c.pos})(a.state))return!1;let d=jy(b,a.state);if(!d)return!1;let e=a.state.doc.resolve(d.$pos.pos-2).node(d.depth),f=jC(b,a.state,e);return jB(b,a.state)&&!f?a.commands.joinItemBackward():a.chain().liftListItem(b).run()},jE=(a,b)=>{let c=jz(a,b),d=jy(a,b);return!!d&&!!c&&c>d.depth},jF=(a,b)=>{let c=jz(a,b),d=jy(a,b);return!!d&&!!c&&c<d.depth},jG=(a,b)=>{if(!fu(a.state,b)||!((a,b)=>{let{$from:c,$to:d,$anchor:e}=a.selection;if(b){let c=fO(a=>a.type.name===b)(a.selection);if(!c)return!1;let d=a.doc.resolve(c.pos+1);return e.pos+1===d.end()}return!(d.parentOffset<d.parent.nodeSize-2)&&c.pos===d.pos})(a.state,b))return!1;let{selection:c}=a.state,{$from:d,$to:e}=c;return!(!c.empty&&d.sameParent(e))&&(jE(b,a.state)?a.chain().focus(a.state.selection.from+4).lift(b).joinBackward().run():jF(b,a.state)?a.chain().joinForward().joinBackward().run():a.commands.joinItemForward())},jH=(a,b)=>{var c;let{$anchor:d}=b.selection,e=b.doc.resolve(d.pos-d.parentOffset-2);return e.index()!==e.parent.childCount-1&&(null==(c=e.nodeAfter)?void 0:c.type.name)===a},jI=gM.create({name:"listKeymap",addOptions:()=>({listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}),addKeyboardShortcuts(){return{Delete:({editor:a})=>{let b=!1;return this.options.listTypes.forEach(({itemName:c})=>{void 0!==a.state.schema.nodes[c]&&jG(a,c)&&(b=!0)}),b},"Mod-Delete":({editor:a})=>{let b=!1;return this.options.listTypes.forEach(({itemName:c})=>{void 0!==a.state.schema.nodes[c]&&jG(a,c)&&(b=!0)}),b},Backspace:({editor:a})=>{let b=!1;return this.options.listTypes.forEach(({itemName:c,wrapperNames:d})=>{void 0!==a.state.schema.nodes[c]&&jD(a,c,d)&&(b=!0)}),b},"Mod-Backspace":({editor:a})=>{let b=!1;return this.options.listTypes.forEach(({itemName:c,wrapperNames:d})=>{void 0!==a.state.schema.nodes[c]&&jD(a,c,d)&&(b=!0)}),b}}}}),jJ=/^(\s*)(\d+)\.\s+(.*)$/,jK=/^\s/,jL="textStyle",jM=/^(\d+)\.\s$/,jN=hd.create({name:"orderedList",addOptions:()=>({itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}),group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes:()=>({start:{default:1,parseHTML:a=>a.hasAttribute("start")?parseInt(a.getAttribute("start")||"",10):1},type:{default:null,parseHTML:a=>a.getAttribute("type")}}),parseHTML:()=>[{tag:"ol"}],renderHTML({HTMLAttributes:a}){let{start:b,...c}=a;return 1===b?["ol",fW(this.options.HTMLAttributes,c),0]:["ol",fW(this.options.HTMLAttributes,a),0]},markdownTokenName:"list",parseMarkdown:(a,b)=>{var c;if("list"!==a.type||!a.ordered)return[];let d=a.start||1,e=a.items?(c=a.items,c.map(a=>{if("list_item"!==a.type)return b.parseChildren([a])[0];let c=[];return a.tokens&&a.tokens.length>0&&a.tokens.forEach(a=>{if("paragraph"===a.type||"list"===a.type||"blockquote"===a.type||"code"===a.type)c.push(...b.parseChildren([a]));else if("text"===a.type&&a.tokens){let d=b.parseChildren([a]);c.push({type:"paragraph",content:d})}else{let d=b.parseChildren([a]);d.length>0&&c.push(...d)}}),{type:"listItem",content:c}})):[];return 1!==d?{type:"orderedList",attrs:{start:d},content:e}:{type:"orderedList",content:e}},renderMarkdown:(a,b)=>a.content?b.renderChildren(a.content,"\n"):"",markdownTokenizer:{name:"orderedList",level:"block",start:a=>{let b=a.match(/^(\s*)(\d+)\.\s+/),c=null==b?void 0:b.index;return void 0!==c?c:-1},tokenize:(a,b,c)=>{var d;let e=a.split("\n"),[f,g]=function(a){let b=[],c=0,d=0;for(;c<a.length;){let e=a[c],f=e.match(jJ);if(!f)break;let[,g,h,i]=f,j=g.length,k=i,l=c+1,m=[e];for(;l<a.length;){let b=a[l];if(b.match(jJ))break;if(""===b.trim())m.push(b),k+="\n",l+=1;else if(b.match(jK))m.push(b),k+=`
${b.slice(j+2)}`,l+=1;else break}b.push({indent:j,number:parseInt(h,10),content:k.trim(),raw:m.join("\n")}),d=l,c=l}return[b,d]}(e);if(0===f.length)return;let h=function a(b,c,d){var e;let f=[],g=0;for(;g<b.length;){let h=b[g];if(h.indent===c){let i=h.content.split("\n"),j=(null==(e=i[0])?void 0:e.trim())||"",k=[];j&&k.push({type:"paragraph",raw:j,tokens:d.inlineTokens(j)});let l=i.slice(1).join("\n").trim();if(l){let a=d.blockTokens(l);k.push(...a)}let m=g+1,n=[];for(;m<b.length&&b[m].indent>c;)n.push(b[m]),m+=1;if(n.length>0){let b=Math.min(...n.map(a=>a.indent)),c=a(n,b,d);k.push({type:"list",ordered:!0,start:n[0].number,items:c,raw:n.map(a=>a.raw).join("\n")})}f.push({type:"list_item",raw:h.raw,tokens:k}),g=m}else g+=1}return f}(f,0,c);if(0!==h.length)return{type:"list",ordered:!0,start:(null==(d=f[0])?void 0:d.number)||1,items:h,raw:e.slice(0,g).join("\n")}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:a,chain:b})=>this.options.keepAttributes?b().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes("listItem",this.editor.getAttributes(jL)).run():a.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let a=g2({find:jM,type:this.type,getAttributes:a=>({start:+a[1]}),joinPredicate:(a,b)=>b.childCount+b.attrs.start===+a[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(a=g2({find:jM,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:a=>({start:+a[1],...this.editor.getAttributes(jL)}),joinPredicate:(a,b)=>b.childCount+b.attrs.start===+a[1],editor:this.editor})),[a]}}),jO=/^\s*(\[([( |x])?\])\s$/,jP=hd.create({name:"taskItem",addOptions:()=>({nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}),content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes:()=>({checked:{default:!1,keepOnSplit:!1,parseHTML:a=>{let b=a.getAttribute("data-checked");return""===b||"true"===b},renderHTML:a=>({"data-checked":a.checked})}}),parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:a,HTMLAttributes:b}){return["li",fW(this.options.HTMLAttributes,b,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:a.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(a,b)=>{let c=[];if(a.tokens&&a.tokens.length>0?c.push(b.createNode("paragraph",{},b.parseInline(a.tokens))):a.text?c.push(b.createNode("paragraph",{},[b.createNode("text",{text:a.text})])):c.push(b.createNode("paragraph",{},[])),a.nestedTokens&&a.nestedTokens.length>0){let d=b.parseChildren(a.nestedTokens);c.push(...d)}return b.createNode("taskItem",{checked:a.checked||!1},c)},renderMarkdown:(a,b)=>{var c;let d=(null==(c=a.attrs)?void 0:c.checked)?"x":" ";return hc(a,b,`- [${d}] `)},addKeyboardShortcuts(){let a={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...a,Tab:()=>this.editor.commands.sinkListItem(this.name)}:a},addNodeView(){return({node:a,HTMLAttributes:b,getPos:c,editor:d})=>{let e=document.createElement("li"),f=document.createElement("label"),g=document.createElement("span"),h=document.createElement("input"),i=document.createElement("div"),j=a=>{var b,c;h.ariaLabel=(null==(c=null==(b=this.options.a11y)?void 0:b.checkboxLabel)?void 0:c.call(b,a,h.checked))||`Task item checkbox for ${a.textContent||"empty task item"}`};return j(a),f.contentEditable="false",h.type="checkbox",h.addEventListener("mousedown",a=>a.preventDefault()),h.addEventListener("change",b=>{if(!d.isEditable&&!this.options.onReadOnlyChecked){h.checked=!h.checked;return}let{checked:e}=b.target;d.isEditable&&"function"==typeof c&&d.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:a})=>{let b=c();if("number"!=typeof b)return!1;let d=a.doc.nodeAt(b);return a.setNodeMarkup(b,void 0,{...null==d?void 0:d.attrs,checked:e}),!0}).run(),d.isEditable||!this.options.onReadOnlyChecked||this.options.onReadOnlyChecked(a,e)||(h.checked=!h.checked)}),Object.entries(this.options.HTMLAttributes).forEach(([a,b])=>{e.setAttribute(a,b)}),e.dataset.checked=a.attrs.checked,h.checked=a.attrs.checked,f.append(h,g),e.append(f,i),Object.entries(b).forEach(([a,b])=>{e.setAttribute(a,b)}),{dom:e,contentDOM:i,update:a=>a.type===this.type&&(e.dataset.checked=a.attrs.checked,h.checked=a.attrs.checked,j(a),!0)}}},addInputRules(){return[g2({find:jO,type:this.type,getAttributes:a=>({checked:"x"===a[a.length-1]})})]}}),jQ=hd.create({name:"taskList",addOptions:()=>({itemTypeName:"taskItem",HTMLAttributes:{}}),group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:a}){return["ul",fW(this.options.HTMLAttributes,a,{"data-type":this.name}),0]},parseMarkdown:(a,b)=>b.createNode("taskList",{},b.parseChildren(a.items||[])),renderMarkdown:(a,b)=>a.content?b.renderChildren(a.content,"\n"):"",markdownTokenizer:{name:"taskList",level:"block",start(a){var b;let c=null==(b=a.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))?void 0:b.index;return void 0!==c?c:-1},tokenize(a,b,c){let d=a=>{let b=hb(a,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:"x"===a[3].toLowerCase()}),createToken:(a,b)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:c.inlineTokens(a.mainContent),nestedTokens:b}),customNestedParser:d},c);return b?[{type:"taskList",raw:b.raw,items:b.items}]:c.blockTokens(a)},e=hb(a,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:"x"===a[3].toLowerCase()}),createToken:(a,b)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:c.inlineTokens(a.mainContent),nestedTokens:b}),customNestedParser:d},c);if(e)return{type:"taskList",raw:e.raw,items:e.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:a})=>a.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});gM.create({name:"listKit",addExtensions(){let a=[];return!1!==this.options.bulletList&&a.push(jt.configure(this.options.bulletList)),!1!==this.options.listItem&&a.push(ju.configure(this.options.listItem)),!1!==this.options.listKeymap&&a.push(jI.configure(this.options.listKeymap)),!1!==this.options.orderedList&&a.push(jN.configure(this.options.orderedList)),!1!==this.options.taskItem&&a.push(jP.configure(this.options.taskItem)),!1!==this.options.taskList&&a.push(jQ.configure(this.options.taskList)),a}});var jR=hd.create({name:"paragraph",priority:1e3,addOptions:()=>({HTMLAttributes:{}}),group:"block",content:"inline*",parseHTML:()=>[{tag:"p"}],renderHTML({HTMLAttributes:a}){return["p",fW(this.options.HTMLAttributes,a),0]},parseMarkdown:(a,b)=>{let c=a.tokens||[];return 1===c.length&&"image"===c[0].type?b.parseChildren([c[0]]):b.createNode("paragraph",void 0,b.parseInline(c))},renderMarkdown:(a,b)=>a&&Array.isArray(a.content)?b.renderChildren(a.content):"",addCommands(){return{setParagraph:()=>({commands:a})=>a.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),jS=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,jT=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,jU=gI.create({name:"strike",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:a=>!!a.includes("line-through")&&{}}],renderHTML({HTMLAttributes:a}){return["s",fW(this.options.HTMLAttributes,a),0]},markdownTokenName:"del",parseMarkdown:(a,b)=>b.applyMark("strike",b.parseInline(a.tokens||[])),renderMarkdown:(a,b)=>`~~${b.renderChildren(a)}~~`,addCommands(){return{setStrike:()=>({commands:a})=>a.setMark(this.name),toggleStrike:()=>({commands:a})=>a.toggleMark(this.name),unsetStrike:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[g_({find:jS,type:this.type})]},addPasteRules(){return[hf({find:jT,type:this.type})]}}),jV=hd.create({name:"text",group:"inline",parseMarkdown:a=>({type:"text",text:a.text||""}),renderMarkdown:a=>a.text||""}),jW=gI.create({name:"underline",addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:a=>!!a.includes("underline")&&{}}],renderHTML({HTMLAttributes:a}){return["u",fW(this.options.HTMLAttributes,a),0]},parseMarkdown(a,b){return b.applyMark(this.name||"underline",b.parseInline(a.tokens||[]))},renderMarkdown:(a,b)=>`++${b.renderChildren(a)}++`,markdownTokenizer:{name:"underline",level:"inline",start:a=>a.indexOf("++"),tokenize(a,b,c){let d=/^(\+\+)([\s\S]+?)(\+\+)/.exec(a);if(!d)return;let e=d[2].trim();return{type:"underline",raw:d[0],text:e,tokens:c.inlineTokens(e)}}},addCommands(){return{setUnderline:()=>({commands:a})=>a.setMark(this.name),toggleUnderline:()=>({commands:a})=>a.toggleMark(this.name),unsetUnderline:()=>({commands:a})=>a.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});class jX{constructor(a,b){var c;this.editorView=a,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!=(c=b.width)?c:1,this.color=!1===b.color?void 0:b.color||"black",this.class=b.class,this.handlers=["dragover","dragend","drop","dragleave"].map(b=>{let c=a=>{this[b](a)};return a.dom.addEventListener(b,c),{name:b,handler:c}})}destroy(){this.handlers.forEach(({name:a,handler:b})=>this.editorView.dom.removeEventListener(a,b))}update(a,b){null!=this.cursorPos&&b.doc!=a.state.doc&&(this.cursorPos>a.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(a){a!=this.cursorPos&&(this.cursorPos=a,null==a?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let a,b,c=this.editorView.state.doc.resolve(this.cursorPos),d=!c.parent.inlineContent,e,f=this.editorView.dom,g=f.getBoundingClientRect(),h=g.width/f.offsetWidth,i=g.height/f.offsetHeight;if(d){let a=c.nodeBefore,b=c.nodeAfter;if(a||b){let c=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0));if(c){let d=c.getBoundingClientRect(),f=a?d.bottom:d.top;a&&b&&(f=(f+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let g=this.width/2*i;e={left:d.left,right:d.right,top:f-g,bottom:f+g}}}}if(!e){let a=this.editorView.coordsAtPos(this.cursorPos),b=this.width/2*h;e={left:a.left-b,right:a.left+b,top:a.top,bottom:a.bottom}}let j=this.editorView.dom.offsetParent;if(!this.element&&(this.element=j.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",d),this.element.classList.toggle("prosemirror-dropcursor-inline",!d),j&&(j!=document.body||"static"!=getComputedStyle(j).position)){let c=j.getBoundingClientRect(),d=c.width/j.offsetWidth,e=c.height/j.offsetHeight;a=c.left-j.scrollLeft*d,b=c.top-j.scrollTop*e}else a=-pageXOffset,b=-pageYOffset;this.element.style.left=(e.left-a)/h+"px",this.element.style.top=(e.top-b)/i+"px",this.element.style.width=(e.right-e.left)/h+"px",this.element.style.height=(e.bottom-e.top)/i+"px"}scheduleRemoval(a){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),a)}dragover(a){if(!this.editorView.editable)return;let b=this.editorView.posAtCoords({left:a.clientX,top:a.clientY}),c=b&&b.inside>=0&&this.editorView.state.doc.nodeAt(b.inside),d=c&&c.type.spec.disableDropCursor,e="function"==typeof d?d(this.editorView,b,a):d;if(b&&!e){let a=b.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let b=a6(this.editorView.state.doc,a,this.editorView.dragging.slice);null!=b&&(a=b)}this.setCursor(a),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(a){this.editorView.dom.contains(a.relatedTarget)||this.setCursor(null)}}class jY extends bk{constructor(a){super(a,a)}map(a,b){let c=a.resolve(b.map(this.head));return jY.valid(c)?new jY(c):bk.near(c)}content(){return U.empty}eq(a){return a instanceof jY&&a.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(a,b){if("number"!=typeof b.pos)throw RangeError("Invalid input for GapCursor.fromJSON");return new jY(a.resolve(b.pos))}getBookmark(){return new jZ(this.anchor)}static valid(a){let b=a.parent;if(b.isTextblock||!function(a){for(let b=a.depth;b>=0;b--){let c=a.index(b),d=a.node(b);if(0==c){if(d.type.spec.isolating)return!0;continue}for(let a=d.child(c-1);;a=a.lastChild){if(0==a.childCount&&!a.inlineContent||j$(a.type))return!0;if(a.inlineContent)return!1}}return!0}(a)||!function(a){for(let b=a.depth;b>=0;b--){let c=a.indexAfter(b),d=a.node(b);if(c==d.childCount){if(d.type.spec.isolating)return!0;continue}for(let a=d.child(c);;a=a.firstChild){if(0==a.childCount&&!a.inlineContent||j$(a.type))return!0;if(a.inlineContent)return!1}}return!0}(a))return!1;let c=b.type.spec.allowGapCursor;if(null!=c)return c;let d=b.contentMatchAt(a.index()).defaultType;return d&&d.isTextblock}static findGapCursorFrom(a,b,c=!1){d:for(;;){if(!c&&jY.valid(a))return a;let d=a.pos,e=null;for(let c=a.depth;;c--){let f=a.node(c);if(b>0?a.indexAfter(c)<f.childCount:a.index(c)>0){e=f.child(b>0?a.indexAfter(c):a.index(c)-1);break}if(0==c)return null;d+=b;let g=a.doc.resolve(d);if(jY.valid(g))return g}for(;;){let f=b>0?e.firstChild:e.lastChild;if(!f){if(e.isAtom&&!e.isText&&!bq.isSelectable(e)){a=a.doc.resolve(d+e.nodeSize*b),c=!1;continue d}break}e=f,d+=b;let g=a.doc.resolve(d);if(jY.valid(g))return g}return null}}}jY.prototype.visible=!1,jY.findFrom=jY.findGapCursorFrom,bk.jsonID("gapcursor",jY);class jZ{constructor(a){this.pos=a}map(a){return new jZ(a.map(this.pos))}resolve(a){let b=a.resolve(this.pos);return jY.valid(b)?new jY(b):bk.near(b)}}function j$(a){return a.isAtom||a.spec.isolating||a.spec.createGapCursor}let j_=eK({ArrowLeft:j0("horiz",-1),ArrowRight:j0("horiz",1),ArrowUp:j0("vert",-1),ArrowDown:j0("vert",1)});function j0(a,b){let c="vert"==a?b>0?"down":"up":b>0?"right":"left";return function(a,d,e){let f=a.selection,g=b>0?f.$to:f.$from,h=f.empty;if(f instanceof bo){if(!e.endOfTextblock(c)||0==g.depth)return!1;h=!1,g=a.doc.resolve(b>0?g.after():g.before())}let i=jY.findGapCursorFrom(g,b,h);return!!i&&(d&&d(a.tr.setSelection(new jY(i))),!0)}}function j1(a,b,c){if(!a||!a.editable)return!1;let d=a.state.doc.resolve(b);if(!jY.valid(d))return!1;let e=a.posAtCoords({left:c.clientX,top:c.clientY});return!(e&&e.inside>-1&&bq.isSelectable(a.state.doc.nodeAt(e.inside)))&&(a.dispatch(a.state.tr.setSelection(new jY(d))),!0)}function j2(a,b){if("insertCompositionText"!=b.inputType||!(a.state.selection instanceof jY))return!1;let{$from:c}=a.state.selection,d=c.parent.contentMatchAt(c.index()).findWrapping(a.state.schema.nodes.text);if(!d)return!1;let e=O.empty;for(let a=d.length-1;a>=0;a--)e=O.from(d[a].createAndFill(null,e));let f=a.state.tr.replace(c.pos,c.pos,new U(e,0,0));return f.setSelection(bo.near(f.doc.resolve(c.pos+1))),a.dispatch(f),!1}function j3(a){if(!(a.selection instanceof jY))return null;let b=document.createElement("div");return b.className="ProseMirror-gapcursor",d8.create(a.doc,[d5.widget(a.selection.head,b,{key:"gapcursor"})])}var j4=function(){};j4.prototype.append=function(a){return a.length?(a=j4.from(a),!this.length&&a||a.length<200&&this.leafAppend(a)||this.length<200&&a.leafPrepend(this)||this.appendInner(a)):this},j4.prototype.prepend=function(a){return a.length?j4.from(a).append(this):this},j4.prototype.appendInner=function(a){return new j6(this,a)},j4.prototype.slice=function(a,b){return(void 0===a&&(a=0),void 0===b&&(b=this.length),a>=b)?j4.empty:this.sliceInner(Math.max(0,a),Math.min(this.length,b))},j4.prototype.get=function(a){if(!(a<0)&&!(a>=this.length))return this.getInner(a)},j4.prototype.forEach=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=this.length),b<=c?this.forEachInner(a,b,c,0):this.forEachInvertedInner(a,b,c,0)},j4.prototype.map=function(a,b,c){void 0===b&&(b=0),void 0===c&&(c=this.length);var d=[];return this.forEach(function(b,c){return d.push(a(b,c))},b,c),d},j4.from=function(a){return a instanceof j4?a:a&&a.length?new j5(a):j4.empty};var j5=function(a){function b(b){a.call(this),this.values=b}b.__proto__=a,b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b;var c={length:{configurable:!0},depth:{configurable:!0}};return b.prototype.flatten=function(){return this.values},b.prototype.sliceInner=function(a,c){return 0==a&&c==this.length?this:new b(this.values.slice(a,c))},b.prototype.getInner=function(a){return this.values[a]},b.prototype.forEachInner=function(a,b,c,d){for(var e=b;e<c;e++)if(!1===a(this.values[e],d+e))return!1},b.prototype.forEachInvertedInner=function(a,b,c,d){for(var e=b-1;e>=c;e--)if(!1===a(this.values[e],d+e))return!1},b.prototype.leafAppend=function(a){if(this.length+a.length<=200)return new b(this.values.concat(a.flatten()))},b.prototype.leafPrepend=function(a){if(this.length+a.length<=200)return new b(a.flatten().concat(this.values))},c.length.get=function(){return this.values.length},c.depth.get=function(){return 0},Object.defineProperties(b.prototype,c),b}(j4);j4.empty=new j5([]);var j6=function(a){function b(b,c){a.call(this),this.left=b,this.right=c,this.length=b.length+c.length,this.depth=Math.max(b.depth,c.depth)+1}return b.__proto__=a,b.prototype=Object.create(a&&a.prototype),b.prototype.constructor=b,b.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},b.prototype.getInner=function(a){return a<this.left.length?this.left.get(a):this.right.get(a-this.left.length)},b.prototype.forEachInner=function(a,b,c,d){var e=this.left.length;if(b<e&&!1===this.left.forEachInner(a,b,Math.min(c,e),d)||c>e&&!1===this.right.forEachInner(a,Math.max(b-e,0),Math.min(this.length,c)-e,d+e))return!1},b.prototype.forEachInvertedInner=function(a,b,c,d){var e=this.left.length;if(b>e&&!1===this.right.forEachInvertedInner(a,b-e,Math.max(c,e)-e,d+e)||c<e&&!1===this.left.forEachInvertedInner(a,Math.min(b,e),c,d))return!1},b.prototype.sliceInner=function(a,b){if(0==a&&b==this.length)return this;var c=this.left.length;return b<=c?this.left.slice(a,b):a>=c?this.right.slice(a-c,b-c):this.left.slice(a,c).append(this.right.slice(0,b-c))},b.prototype.leafAppend=function(a){var c=this.right.leafAppend(a);if(c)return new b(this.left,c)},b.prototype.leafPrepend=function(a){var c=this.left.leafPrepend(a);if(c)return new b(c,this.right)},b.prototype.appendInner=function(a){return this.left.depth>=Math.max(this.right.depth,a.depth)+1?new b(this.left,new b(this.right,a)):new b(this,a)},b}(j4);class j7{constructor(a,b){this.items=a,this.eventCount=b}popEvent(a,b){let c,d,e,f;if(0==this.eventCount)return null;let g=this.items.length;for(;;g--)if(this.items.get(g-1).selection){--g;break}b&&(d=(c=this.remapping(g,this.items.length)).maps.length);let h=a.tr,i=[],j=[];return this.items.forEach((a,b)=>{if(!a.step){c||(d=(c=this.remapping(g,b+1)).maps.length),d--,j.push(a);return}if(c){j.push(new j8(a.map));let b=a.step.map(c.slice(d)),e;b&&h.maybeStep(b).doc&&(e=h.mapping.maps[h.mapping.maps.length-1],i.push(new j8(e,void 0,void 0,i.length+j.length))),d--,e&&c.appendMap(e,d)}else h.maybeStep(a.step);if(a.selection)return e=c?a.selection.map(c.slice(d)):a.selection,f=new j7(this.items.slice(0,g).append(j.reverse().concat(i)),this.eventCount-1),!1},this.items.length,0),{remaining:f,transform:h,selection:e}}addTransform(a,b,c,d){var e,f;let g,h=[],i=this.eventCount,j=this.items,k=!d&&j.length?j.get(j.length-1):null;for(let c=0;c<a.steps.length;c++){let e=a.steps[c].invert(a.docs[c]),f=new j8(a.mapping.maps[c],e,b),g;(g=k&&k.merge(f))&&(f=g,c?h.pop():j=j.slice(0,j.length-1)),h.push(f),b&&(i++,b=void 0),d||(k=f)}let l=i-c.depth;return l>ka&&(e=j,f=l,e.forEach((a,b)=>{if(a.selection&&0==f--)return g=b,!1}),j=e.slice(g),i-=l),new j7(j.append(h),i)}remapping(a,b){let c=new aM;return this.items.forEach((b,d)=>{let e=null!=b.mirrorOffset&&d-b.mirrorOffset>=a?c.maps.length-b.mirrorOffset:void 0;c.appendMap(b.map,e)},a,b),c}addMaps(a){return 0==this.eventCount?this:new j7(this.items.append(a.map(a=>new j8(a))),this.eventCount)}rebased(a,b){if(!this.eventCount)return this;let c=[],d=Math.max(0,this.items.length-b),e=a.mapping,f=a.steps.length,g=this.eventCount;this.items.forEach(a=>{a.selection&&g--},d);let h=b;this.items.forEach(b=>{let d=e.getMirror(--h);if(null==d)return;f=Math.min(f,d);let i=e.maps[d];if(b.step){let f=a.steps[d].invert(a.docs[d]),j=b.selection&&b.selection.map(e.slice(h+1,d));j&&g++,c.push(new j8(i,f,j))}else c.push(new j8(i))},d);let i=[];for(let a=b;a<f;a++)i.push(new j8(e.maps[a]));let j=new j7(this.items.slice(0,d).append(i).append(c),g);return j.emptyItemCount()>500&&(j=j.compress(this.items.length-c.length)),j}emptyItemCount(){let a=0;return this.items.forEach(b=>{!b.step&&a++}),a}compress(a=this.items.length){let b=this.remapping(0,a),c=b.maps.length,d=[],e=0;return this.items.forEach((f,g)=>{if(g>=a)d.push(f),f.selection&&e++;else if(f.step){let a=f.step.map(b.slice(c)),g=a&&a.getMap();if(c--,g&&b.appendMap(g,c),a){let h=f.selection&&f.selection.map(b.slice(c));h&&e++;let i=new j8(g.invert(),a,h),j,k=d.length-1;(j=d.length&&d[k].merge(i))?d[k]=j:d.push(i)}}else f.map&&c--},this.items.length,0),new j7(j4.from(d.reverse()),e)}}j7.empty=new j7(j4.empty,0);class j8{constructor(a,b,c,d){this.map=a,this.step=b,this.selection=c,this.mirrorOffset=d}merge(a){if(this.step&&a.step&&!a.selection){let b=a.step.merge(this.step);if(b)return new j8(b.getMap().invert(),b,this.selection)}}}class j9{constructor(a,b,c,d,e){this.done=a,this.undone=b,this.prevRanges=c,this.prevTime=d,this.prevComposition=e}}let ka=20;function kb(a){let b=[];for(let c=a.length-1;c>=0&&0==b.length;c--)a[c].forEach((a,c,d,e)=>b.push(d,e));return b}function kc(a,b){if(!a)return null;let c=[];for(let d=0;d<a.length;d+=2){let e=b.map(a[d],1),f=b.map(a[d+1],-1);e<=f&&c.push(e,f)}return c}let kd=!1,ke=null;function kf(a){let b=a.plugins;if(ke!=b){kd=!1,ke=b;for(let a=0;a<b.length;a++)if(b[a].spec.historyPreserveItems){kd=!0;break}}return kd}let kg=new bF("history"),kh=new bF("closeHistory");function ki(a,b){return(c,d)=>{let e=kg.getState(c);if(!e||0==(a?e.undone:e.done).eventCount)return!1;if(d){let f=function(a,b,c){let d=kf(b),e=kg.get(b).spec.config,f=(c?a.undone:a.done).popEvent(b,d);if(!f)return null;let g=f.selection.resolve(f.transform.doc),h=(c?a.done:a.undone).addTransform(f.transform,b.selection.getBookmark(),e,d),i=new j9(c?h:f.remaining,c?f.remaining:h,null,0,-1);return f.transform.setSelection(g).setMeta(kg,{redo:c,historyState:i})}(e,c,a);f&&d(b?f.scrollIntoView():f)}return!0}}let kj=ki(!1,!0),kk=ki(!0,!0);ki(!1,!1),ki(!0,!1),gM.create({name:"characterCount",addOptions:()=>({limit:null,mode:"textSize",textCounter:a=>a.length,wordCounter:a=>a.split(" ").filter(a=>""!==a).length}),addStorage:()=>({characters:()=>0,words:()=>0}),onBeforeCreate(){this.storage.characters=a=>{let b=(null==a?void 0:a.node)||this.editor.state.doc;if("textSize"===((null==a?void 0:a.mode)||this.options.mode)){let a=b.textBetween(0,b.content.size,void 0," ");return this.options.textCounter(a)}return b.nodeSize},this.storage.words=a=>{let b=(null==a?void 0:a.node)||this.editor.state.doc,c=b.textBetween(0,b.content.size," "," ");return this.options.wordCounter(c)}},addProseMirrorPlugins(){let a=!1;return[new bC({key:new bF("characterCount"),appendTransaction:(b,c,d)=>{if(a)return;let e=this.options.limit;if(null==e||0===e){a=!0;return}let f=this.storage.characters({node:d.doc});if(f>e){console.warn(`[CharacterCount] Initial content exceeded limit of ${e} characters. Content was automatically trimmed.`);let b=d.tr.deleteRange(0,f-e);return a=!0,b}a=!0},filterTransaction:(a,b)=>{let c=this.options.limit;if(!a.docChanged||0===c||null==c)return!0;let d=this.storage.characters({node:b.doc}),e=this.storage.characters({node:a.doc});if(e<=c||d>c&&e>c&&e<=d)return!0;if(d>c&&e>c&&e>d||!a.getMeta("paste"))return!1;let f=a.selection.$head.pos;return a.deleteRange(f-(e-c),f),!(this.storage.characters({node:a.doc})>c)}})]}});var kl=gM.create({name:"dropCursor",addOptions:()=>({color:"currentColor",width:1,class:void 0}),addProseMirrorPlugins(){return[function(a={}){return new bC({view:b=>new jX(b,a)})}(this.options)]}});gM.create({name:"focus",addOptions:()=>({className:"has-focus",mode:"all"}),addProseMirrorPlugins(){return[new bC({key:new bF("focus"),props:{decorations:({doc:a,selection:b})=>{let{isEditable:c,isFocused:d}=this.editor,{anchor:e}=b,f=[];if(!c||!d)return d8.create(a,[]);let g=0;"deepest"===this.options.mode&&a.descendants((a,b)=>{if(!a.isText){if(!(e>=b&&e<=b+a.nodeSize-1))return!1;g+=1}});let h=0;return a.descendants((a,b)=>!a.isText&&!!(e>=b&&e<=b+a.nodeSize-1)&&((h+=1,"deepest"===this.options.mode&&g-h>0||"shallowest"===this.options.mode&&h>1)?"deepest"===this.options.mode:void f.push(d5.node(b,b+a.nodeSize,{class:this.options.className})))),d8.create(a,f)}}})]}});var km=gM.create({name:"gapCursor",addProseMirrorPlugins:()=>[new bC({props:{decorations:j3,createSelectionBetween:(a,b,c)=>b.pos==c.pos&&jY.valid(c)?new jY(c):null,handleClick:j1,handleKeyDown:j_,handleDOMEvents:{beforeinput:j2}}})],extendNodeSchema(a){var b;let c={name:a.name,options:a.options,storage:a.storage};return{allowGapCursor:null!=(b=fT(fP(a,"allowGapCursor",c)))?b:null}}});function kn({types:a,node:b}){return b&&Array.isArray(a)&&a.includes(b.type)||(null==b?void 0:b.type)===a}gM.create({name:"placeholder",addOptions:()=>({emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}),addProseMirrorPlugins(){return[new bC({key:new bF("placeholder"),props:{decorations:({doc:a,selection:b})=>{let c=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:d}=b,e=[];if(!c)return null;let f=this.editor.isEmpty;return a.descendants((a,b)=>{let c=d>=b&&d<=b+a.nodeSize,g=!a.isLeaf&&gb(a);if((c||!this.options.showOnlyCurrent)&&g){let d=[this.options.emptyNodeClass];f&&d.push(this.options.emptyEditorClass);let g=d5.node(b,b+a.nodeSize,{class:d.join(" "),"data-placeholder":"function"==typeof this.options.placeholder?this.options.placeholder({editor:this.editor,node:a,pos:b,hasAnchor:c}):this.options.placeholder});e.push(g)}return this.options.includeChildren}),d8.create(a,e)}}})]}}),gM.create({name:"selection",addOptions:()=>({className:"selection"}),addProseMirrorPlugins(){let{editor:a,options:b}=this;return[new bC({key:new bF("selection"),props:{decorations:c=>c.selection.empty||a.isFocused||!a.isEditable||gc(c.selection)||a.view.dragging?null:d8.create(c.doc,[d5.inline(c.selection.from,c.selection.to,{class:b.className})])}})]}});var ko=gM.create({name:"trailingNode",addOptions:()=>({node:void 0,notAfter:[]}),addProseMirrorPlugins(){var a;let b=new bF(this.name),c=this.options.node||(null==(a=this.editor.schema.topNodeType.contentMatch.defaultType)?void 0:a.name)||"paragraph",d=Object.entries(this.editor.schema.nodes).map(([,a])=>a).filter(a=>(this.options.notAfter||[]).concat(c).includes(a.name));return[new bC({key:b,appendTransaction:(a,d,e)=>{let{doc:f,tr:g,schema:h}=e,i=b.getState(e),j=f.content.size,k=h.nodes[c];if(i)return g.insert(j,k.create())},state:{init:(a,b)=>!kn({node:b.tr.doc.lastChild,types:d}),apply:(a,b)=>!a.docChanged||a.getMeta("__uniqueIDTransaction")?b:!kn({node:a.doc.lastChild,types:d})}})]}}),kp=gM.create({name:"undoRedo",addOptions:()=>({depth:100,newGroupDelay:500}),addCommands:()=>({undo:()=>({state:a,dispatch:b})=>kj(a,b),redo:()=>({state:a,dispatch:b})=>kk(a,b)}),addProseMirrorPlugins(){return[function(a={}){return new bC({key:kg,state:{init:()=>new j9(j7.empty,j7.empty,null,0,-1),apply:(b,c,d)=>(function(a,b,c,d){let e=c.getMeta(kg),f;if(e)return e.historyState;c.getMeta(kh)&&(a=new j9(a.done,a.undone,null,0,-1));let g=c.getMeta("appendedTransaction");if(0==c.steps.length)return a;if(g&&g.getMeta(kg))if(g.getMeta(kg).redo)return new j9(a.done.addTransform(c,void 0,d,kf(b)),a.undone,kb(c.mapping.maps),a.prevTime,a.prevComposition);else return new j9(a.done,a.undone.addTransform(c,void 0,d,kf(b)),null,a.prevTime,a.prevComposition);if(!1===c.getMeta("addToHistory")||g&&!1===g.getMeta("addToHistory"))if(f=c.getMeta("rebased"))return new j9(a.done.rebased(c,f),a.undone.rebased(c,f),kc(a.prevRanges,c.mapping),a.prevTime,a.prevComposition);else return new j9(a.done.addMaps(c.mapping.maps),a.undone.addMaps(c.mapping.maps),kc(a.prevRanges,c.mapping),a.prevTime,a.prevComposition);{let e=c.getMeta("composition"),f=0==a.prevTime||!g&&a.prevComposition!=e&&(a.prevTime<(c.time||0)-d.newGroupDelay||!function(a,b){if(!b)return!1;if(!a.docChanged)return!0;let c=!1;return a.mapping.maps[0].forEach((a,d)=>{for(let e=0;e<b.length;e+=2)a<=b[e+1]&&d>=b[e]&&(c=!0)}),c}(c,a.prevRanges)),h=g?kc(a.prevRanges,c.mapping):kb(c.mapping.maps);return new j9(a.done.addTransform(c,f?b.selection.getBookmark():void 0,d,kf(b)),j7.empty,h,c.time,null==e?a.prevComposition:e)}})(c,d,b,a)},config:a={depth:a.depth||100,newGroupDelay:a.newGroupDelay||500},props:{handleDOMEvents:{beforeinput(a,b){let c=b.inputType,d="historyUndo"==c?kj:"historyRedo"==c?kk:null;return!!d&&!!a.editable&&(b.preventDefault(),d(a.state,a.dispatch))}}}})}(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),kq=gM.create({name:"starterKit",addExtensions(){var a,b,c,d;let e=[];return!1!==this.options.bold&&e.push(hF.configure(this.options.bold)),!1!==this.options.blockquote&&e.push(hA.configure(this.options.blockquote)),!1!==this.options.bulletList&&e.push(jt.configure(this.options.bulletList)),!1!==this.options.code&&e.push(hI.configure(this.options.code)),!1!==this.options.codeBlock&&e.push(hL.configure(this.options.codeBlock)),!1!==this.options.document&&e.push(hM.configure(this.options.document)),!1!==this.options.dropcursor&&e.push(kl.configure(this.options.dropcursor)),!1!==this.options.gapcursor&&e.push(km.configure(this.options.gapcursor)),!1!==this.options.hardBreak&&e.push(hN.configure(this.options.hardBreak)),!1!==this.options.heading&&e.push(hO.configure(this.options.heading)),!1!==this.options.undoRedo&&e.push(kp.configure(this.options.undoRedo)),!1!==this.options.horizontalRule&&e.push(hP.configure(this.options.horizontalRule)),!1!==this.options.italic&&e.push(hU.configure(this.options.italic)),!1!==this.options.listItem&&e.push(ju.configure(this.options.listItem)),!1!==this.options.listKeymap&&e.push(jI.configure(null==(a=this.options)?void 0:a.listKeymap)),!1!==this.options.link&&e.push(jp.configure(null==(b=this.options)?void 0:b.link)),!1!==this.options.orderedList&&e.push(jN.configure(this.options.orderedList)),!1!==this.options.paragraph&&e.push(jR.configure(this.options.paragraph)),!1!==this.options.strike&&e.push(jU.configure(this.options.strike)),!1!==this.options.text&&e.push(jV.configure(this.options.text)),!1!==this.options.underline&&e.push(jW.configure(null==(c=this.options)?void 0:c.underline)),!1!==this.options.trailingNode&&e.push(ko.configure(null==(d=this.options)?void 0:d.trailingNode)),e}});if("undefined"!=typeof WeakMap){let a=new WeakMap;b=b=>a.get(b),c=(b,c)=>(a.set(b,c),c)}else{let a=[],d=0;b=b=>{for(let c=0;c<a.length;c+=2)if(a[c]==b)return a[c+1]},c=(b,c)=>(10==d&&(d=0),a[d++]=b,a[d++]=c)}var kr=class{constructor(a,b,c,d){this.width=a,this.height=b,this.map=c,this.problems=d}findCell(a){for(let b=0;b<this.map.length;b++){let c=this.map[b];if(c!=a)continue;let d=b%this.width,e=b/this.width|0,f=d+1,g=e+1;for(let a=1;f<this.width&&this.map[b+a]==c;a++)f++;for(let a=1;g<this.height&&this.map[b+this.width*a]==c;a++)g++;return{left:d,top:e,right:f,bottom:g}}throw RangeError(`No cell with offset ${a} found`)}colCount(a){for(let b=0;b<this.map.length;b++)if(this.map[b]==a)return b%this.width;throw RangeError(`No cell with offset ${a} found`)}nextCell(a,b,c){let{left:d,right:e,top:f,bottom:g}=this.findCell(a);return"horiz"==b?(c<0?0==d:e==this.width)?null:this.map[f*this.width+(c<0?d-1:e)]:(c<0?0==f:g==this.height)?null:this.map[d+this.width*(c<0?f-1:g)]}rectBetween(a,b){let{left:c,right:d,top:e,bottom:f}=this.findCell(a),{left:g,right:h,top:i,bottom:j}=this.findCell(b);return{left:Math.min(c,g),top:Math.min(e,i),right:Math.max(d,h),bottom:Math.max(f,j)}}cellsInRect(a){let b=[],c={};for(let d=a.top;d<a.bottom;d++)for(let e=a.left;e<a.right;e++){let f=d*this.width+e,g=this.map[f];!c[g]&&(c[g]=!0,e==a.left&&e&&this.map[f-1]==g||d==a.top&&d&&this.map[f-this.width]==g||b.push(g))}return b}positionAt(a,b,c){for(let d=0,e=0;;d++){let f=e+c.child(d).nodeSize;if(d==a){let c=b+a*this.width,d=(a+1)*this.width;for(;c<d&&this.map[c]<e;)c++;return c==d?f-1:this.map[c]}e=f}}static get(a){return b(a)||c(a,function(a){if("table"!=a.type.spec.tableRole)throw RangeError("Not a table node: "+a.type.name);let b=function(a){let b=-1,c=!1;for(let d=0;d<a.childCount;d++){let e=a.child(d),f=0;if(c)for(let b=0;b<d;b++){let c=a.child(b);for(let a=0;a<c.childCount;a++){let e=c.child(a);b+e.attrs.rowspan>d&&(f+=e.attrs.colspan)}}for(let a=0;a<e.childCount;a++){let b=e.child(a);f+=b.attrs.colspan,b.attrs.rowspan>1&&(c=!0)}-1==b?b=f:b!=f&&(b=Math.max(b,f))}return b}(a),c=a.childCount,d=[],e=0,f=null,g=[];for(let a=0,e=b*c;a<e;a++)d[a]=0;for(let h=0,i=0;h<c;h++){let j=a.child(h);i++;for(let a=0;;a++){for(;e<d.length&&0!=d[e];)e++;if(a==j.childCount)break;let k=j.child(a),{colspan:l,rowspan:m,colwidth:n}=k.attrs;for(let a=0;a<m;a++){if(a+h>=c){(f||(f=[])).push({type:"overlong_rowspan",pos:i,n:m-a});break}let j=e+a*b;for(let a=0;a<l;a++){0==d[j+a]?d[j+a]=i:(f||(f=[])).push({type:"collision",row:h,pos:i,n:l-a});let c=n&&n[a];if(c){let d=(j+a)%b*2,e=g[d];null==e||e!=c&&1==g[d+1]?(g[d]=c,g[d+1]=1):e==c&&g[d+1]++}}}e+=l,i+=k.nodeSize}let k=(h+1)*b,l=0;for(;e<k;)0==d[e++]&&l++;l&&(f||(f=[])).push({type:"missing",row:h,n:l}),i++}(0===b||0===c)&&(f||(f=[])).push({type:"zero_sized"});let h=new kr(b,c,d,f),i=!1;for(let a=0;!i&&a<g.length;a+=2)null!=g[a]&&g[a+1]<c&&(i=!0);return i&&function(a,b,c){a.problems||(a.problems=[]);let d={};for(let e=0;e<a.map.length;e++){let f=a.map[e];if(d[f])continue;d[f]=!0;let g=c.nodeAt(f);if(!g)throw RangeError(`No cell with offset ${f} found`);let h=null,i=g.attrs;for(let c=0;c<i.colspan;c++){let d=b[(e+c)%a.width*2];null==d||i.colwidth&&i.colwidth[c]==d||((h||(h=function(a){if(a.colwidth)return a.colwidth.slice();let b=[];for(let c=0;c<a.colspan;c++)b.push(0);return b}(i)))[c]=d)}h&&a.problems.unshift({type:"colwidth mismatch",pos:f,colwidth:h})}}(h,g,a),h}(a))}};function ks(a){let b=a.cached.tableNodeTypes;if(!b)for(let c in b=a.cached.tableNodeTypes={},a.nodes){let d=a.nodes[c],e=d.spec.tableRole;e&&(b[e]=d)}return b}let kt=new bF("selectingCells");function ku(a){for(let b=a.depth-1;b>0;b--)if("row"==a.node(b).type.spec.tableRole)return a.node(0).resolve(a.before(b+1));return null}function kv(a){let b=a.selection.$head;for(let a=b.depth;a>0;a--)if("row"==b.node(a).type.spec.tableRole)return!0;return!1}function kw(a){let b=a.selection;if("$anchorCell"in b&&b.$anchorCell)return b.$anchorCell.pos>b.$headCell.pos?b.$anchorCell:b.$headCell;if("node"in b&&b.node&&"cell"==b.node.type.spec.tableRole)return b.$anchor;let c=ku(b.$head)||function(a){for(let b=a.nodeAfter,c=a.pos;b;b=b.firstChild,c++){let d=b.type.spec.tableRole;if("cell"==d||"header_cell"==d)return a.doc.resolve(c)}for(let b=a.nodeBefore,c=a.pos;b;b=b.lastChild,c--){let d=b.type.spec.tableRole;if("cell"==d||"header_cell"==d)return a.doc.resolve(c-b.nodeSize)}}(b.$head);if(c)return c;throw RangeError(`No cell found around position ${b.head}`)}function kx(a){return"row"==a.parent.type.spec.tableRole&&!!a.nodeAfter}function ky(a,b){return a.depth==b.depth&&a.pos>=b.start(-1)&&a.pos<=b.end(-1)}function kz(a,b,c){let d=a.node(-1),e=kr.get(d),f=a.start(-1),g=e.nextCell(a.pos-f,b,c);return null==g?null:a.node(0).resolve(f+g)}function kA(a,b,c=1){let d={...a,colspan:a.colspan-c};return d.colwidth&&(d.colwidth=d.colwidth.slice(),d.colwidth.splice(b,c),d.colwidth.some(a=>a>0)||(d.colwidth=null)),d}function kB(a,b,c=1){let d={...a,colspan:a.colspan+c};if(d.colwidth){d.colwidth=d.colwidth.slice();for(let a=0;a<c;a++)d.colwidth.splice(b,0,0)}return d}var kC=class a extends bk{constructor(a,b=a){const c=a.node(-1),d=kr.get(c),e=a.start(-1),f=d.rectBetween(a.pos-e,b.pos-e),g=a.node(0),h=d.cellsInRect(f).filter(a=>a!=b.pos-e);h.unshift(b.pos-e);const i=h.map(a=>{let b=c.nodeAt(a);if(!b)throw RangeError(`No cell with offset ${a} found`);let d=e+a+1;return new bl(g.resolve(d),g.resolve(d+b.content.size))});super(i[0].$from,i[0].$to,i),this.$anchorCell=a,this.$headCell=b}map(b,c){let d=b.resolve(c.map(this.$anchorCell.pos)),e=b.resolve(c.map(this.$headCell.pos));if(kx(d)&&kx(e)&&ky(d,e)){let b=this.$anchorCell.node(-1)!=d.node(-1);return b&&this.isRowSelection()?a.rowSelection(d,e):b&&this.isColSelection()?a.colSelection(d,e):new a(d,e)}return bo.between(d,e)}content(){let a=this.$anchorCell.node(-1),b=kr.get(a),c=this.$anchorCell.start(-1),d=b.rectBetween(this.$anchorCell.pos-c,this.$headCell.pos-c),e={},f=[];for(let c=d.top;c<d.bottom;c++){let g=[];for(let f=c*b.width+d.left,h=d.left;h<d.right;h++,f++){let c=b.map[f];if(e[c])continue;e[c]=!0;let h=b.findCell(c),i=a.nodeAt(c);if(!i)throw RangeError(`No cell with offset ${c} found`);let j=d.left-h.left,k=h.right-d.right;if(j>0||k>0){let a=i.attrs;if(j>0&&(a=kA(a,0,j)),k>0&&(a=kA(a,a.colspan-k,k)),h.left<d.left){if(!(i=i.type.createAndFill(a)))throw RangeError(`Could not create cell with attrs ${JSON.stringify(a)}`)}else i=i.type.create(a,i.content)}if(h.top<d.top||h.bottom>d.bottom){let a={...i.attrs,rowspan:Math.min(h.bottom,d.bottom)-Math.max(h.top,d.top)};i=h.top<d.top?i.type.createAndFill(a):i.type.create(a,i.content)}g.push(i)}f.push(a.child(c).copy(O.from(g)))}let g=this.isColSelection()&&this.isRowSelection()?a:f;return new U(O.from(g),1,1)}replace(a,b=U.empty){let c=a.steps.length,d=this.ranges;for(let e=0;e<d.length;e++){let{$from:f,$to:g}=d[e],h=a.mapping.slice(c);a.replace(h.map(f.pos),h.map(g.pos),e?U.empty:b)}let e=bk.findFrom(a.doc.resolve(a.mapping.slice(c).map(this.to)),-1);e&&a.setSelection(e)}replaceWith(a,b){this.replace(a,new U(O.from(b),0,0))}forEachCell(a){let b=this.$anchorCell.node(-1),c=kr.get(b),d=this.$anchorCell.start(-1),e=c.cellsInRect(c.rectBetween(this.$anchorCell.pos-d,this.$headCell.pos-d));for(let c=0;c<e.length;c++)a(b.nodeAt(e[c]),d+e[c])}isColSelection(){let a=this.$anchorCell.index(-1),b=this.$headCell.index(-1);return!(Math.min(a,b)>0)&&Math.max(a+this.$anchorCell.nodeAfter.attrs.rowspan,b+this.$headCell.nodeAfter.attrs.rowspan)==this.$headCell.node(-1).childCount}static colSelection(b,c=b){let d=b.node(-1),e=kr.get(d),f=b.start(-1),g=e.findCell(b.pos-f),h=e.findCell(c.pos-f),i=b.node(0);return g.top<=h.top?(g.top>0&&(b=i.resolve(f+e.map[g.left])),h.bottom<e.height&&(c=i.resolve(f+e.map[e.width*(e.height-1)+h.right-1]))):(h.top>0&&(c=i.resolve(f+e.map[h.left])),g.bottom<e.height&&(b=i.resolve(f+e.map[e.width*(e.height-1)+g.right-1]))),new a(b,c)}isRowSelection(){let a=this.$anchorCell.node(-1),b=kr.get(a),c=this.$anchorCell.start(-1),d=b.colCount(this.$anchorCell.pos-c),e=b.colCount(this.$headCell.pos-c);return!(Math.min(d,e)>0)&&Math.max(d+this.$anchorCell.nodeAfter.attrs.colspan,e+this.$headCell.nodeAfter.attrs.colspan)==b.width}eq(b){return b instanceof a&&b.$anchorCell.pos==this.$anchorCell.pos&&b.$headCell.pos==this.$headCell.pos}static rowSelection(b,c=b){let d=b.node(-1),e=kr.get(d),f=b.start(-1),g=e.findCell(b.pos-f),h=e.findCell(c.pos-f),i=b.node(0);return g.left<=h.left?(g.left>0&&(b=i.resolve(f+e.map[g.top*e.width])),h.right<e.width&&(c=i.resolve(f+e.map[e.width*(h.top+1)-1]))):(h.left>0&&(c=i.resolve(f+e.map[h.top*e.width])),g.right<e.width&&(b=i.resolve(f+e.map[e.width*(g.top+1)-1]))),new a(b,c)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(b,c){return new a(b.resolve(c.anchor),b.resolve(c.head))}static create(b,c,d=c){return new a(b.resolve(c),b.resolve(d))}getBookmark(){return new kD(this.$anchorCell.pos,this.$headCell.pos)}};kC.prototype.visible=!1,bk.jsonID("cell",kC);var kD=class a{constructor(a,b){this.anchor=a,this.head=b}map(b){return new a(b.map(this.anchor),b.map(this.head))}resolve(a){let b=a.resolve(this.anchor),c=a.resolve(this.head);return"row"==b.parent.type.spec.tableRole&&"row"==c.parent.type.spec.tableRole&&b.index()<b.parent.childCount&&c.index()<c.parent.childCount&&ky(b,c)?new kC(b,c):bk.near(c,1)}};function kE(a){if(!(a.selection instanceof kC))return null;let b=[];return a.selection.forEachCell((a,c)=>{b.push(d5.node(c,c+a.nodeSize,{class:"selectedCell"}))}),d8.create(a.doc,b)}let kF=new bF("fix-tables");function kG(a,b){let c,d=(b,d)=>{"table"==b.type.spec.tableRole&&(c=function(a,b,c,d){let e,f,g=kr.get(b);if(!g.problems)return d;d||(d=a.tr);let h=[];for(let a=0;a<g.height;a++)h.push(0);for(let a=0;a<g.problems.length;a++){let e=g.problems[a];if("collision"==e.type){let a=b.nodeAt(e.pos);if(!a)continue;let f=a.attrs;for(let a=0;a<f.rowspan;a++)h[e.row+a]+=e.n;d.setNodeMarkup(d.mapping.map(c+1+e.pos),null,kA(f,f.colspan-e.n,e.n))}else if("missing"==e.type)h[e.row]+=e.n;else if("overlong_rowspan"==e.type){let a=b.nodeAt(e.pos);if(!a)continue;d.setNodeMarkup(d.mapping.map(c+1+e.pos),null,{...a.attrs,rowspan:a.attrs.rowspan-e.n})}else if("colwidth mismatch"==e.type){let a=b.nodeAt(e.pos);if(!a)continue;d.setNodeMarkup(d.mapping.map(c+1+e.pos),null,{...a.attrs,colwidth:e.colwidth})}else if("zero_sized"==e.type){let a=d.mapping.map(c);d.delete(a,a+b.nodeSize)}}for(let a=0;a<h.length;a++)h[a]&&(null==e&&(e=a),f=a);for(let i=0,j=c+1;i<g.height;i++){let c=b.child(i),g=j+c.nodeSize,k=h[i];if(k>0){let b="cell";c.firstChild&&(b=c.firstChild.type.spec.tableRole);let h=[];for(let c=0;c<k;c++){let c=ks(a.schema)[b].createAndFill();c&&h.push(c)}let l=(0==i||e==i-1)&&f==i?j+1:g-1;d.insert(d.mapping.map(l),h)}j=g}return d.setMeta(kF,{fixTables:!0})}(a,b,d,c))};return b?b.doc!=a.doc&&function a(b,c,d,e){let f=b.childCount,g=c.childCount;c:for(let h=0,i=0;h<g;h++){let g=c.child(h);for(let a=i,c=Math.min(f,h+3);a<c;a++)if(b.child(a)==g){i=a+1,d+=g.nodeSize;continue c}e(g,d),i<f&&b.child(i).sameMarkup(g)?a(b.child(i),g,d+1,e):g.nodesBetween(0,g.content.size,e,d+1),d+=g.nodeSize}}(b.doc,a.doc,0,d):a.doc.descendants(d),c}function kH(a){let b=a.selection,c=kw(a),d=c.node(-1),e=c.start(-1),f=kr.get(d);return{...b instanceof kC?f.rectBetween(b.$anchorCell.pos-e,b.$headCell.pos-e):f.findCell(c.pos-e),tableStart:e,map:f,table:d}}function kI(a,{map:b,tableStart:c,table:d},e){let f=e>0?-1:0;(function(a,b,c){let d=ks(b.type.schema).header_cell;for(let e=0;e<a.height;e++)if(b.nodeAt(a.map[c+e*a.width]).type!=d)return!1;return!0})(b,d,e+f)&&(f=0==e||e==b.width?null:0);for(let g=0;g<b.height;g++){let h=g*b.width+e;if(e>0&&e<b.width&&b.map[h-1]==b.map[h]){let f=b.map[h],i=d.nodeAt(f);a.setNodeMarkup(a.mapping.map(c+f),null,kB(i.attrs,e-b.colCount(f))),g+=i.attrs.rowspan-1}else{let i=null==f?ks(d.type.schema).cell:d.nodeAt(b.map[h+f]).type,j=b.positionAt(g,e,d);a.insert(a.mapping.map(c+j),i.createAndFill())}}return a}function kJ(a,{map:b,tableStart:c,table:d},e){let f=c;for(let a=0;a<e;a++)f+=d.child(a).nodeSize;let g=[],h=e>0?-1:0;(function(a,b,c){var d;let e=ks(b.type.schema).header_cell;for(let f=0;f<a.width;f++)if((null==(d=b.nodeAt(a.map[f+c*a.width]))?void 0:d.type)!=e)return!1;return!0})(b,d,e+h)&&(h=0==e||e==b.height?null:0);for(let f=0,j=b.width*e;f<b.width;f++,j++)if(e>0&&e<b.height&&b.map[j]==b.map[j-b.width]){let e=b.map[j],g=d.nodeAt(e).attrs;a.setNodeMarkup(c+e,null,{...g,rowspan:g.rowspan+1}),f+=g.colspan-1}else{var i;let a=null==h?ks(d.type.schema).cell:null==(i=d.nodeAt(b.map[j+h*b.width]))?void 0:i.type,c=null==a?void 0:a.createAndFill();c&&g.push(c)}return a.insert(f,ks(d.type.schema).row.create(null,g)),a}function kK(a){let b=a.content;return 1==b.childCount&&b.child(0).isTextblock&&0==b.child(0).childCount}function kL(a,b){let c=a.selection;if(!(c instanceof kC)||c.$anchorCell.pos==c.$headCell.pos)return!1;let d=kH(a),{map:e}=d;if(function({width:a,height:b,map:c},d){let e=d.top*a+d.left,f=e,g=(d.bottom-1)*a+d.left,h=e+(d.right-d.left-1);for(let b=d.top;b<d.bottom;b++){if(d.left>0&&c[f]==c[f-1]||d.right<a&&c[h]==c[h+1])return!0;f+=a,h+=a}for(let f=d.left;f<d.right;f++){if(d.top>0&&c[e]==c[e-a]||d.bottom<b&&c[g]==c[g+a])return!0;e++,g++}return!1}(e,d))return!1;if(b){let c,f,g=a.tr,h={},i=O.empty;for(let a=d.top;a<d.bottom;a++)for(let b=d.left;b<d.right;b++){let j=e.map[a*e.width+b],k=d.table.nodeAt(j);if(!h[j]&&k)if(h[j]=!0,null==c)c=j,f=k;else{kK(k)||(i=i.append(k.content));let a=g.mapping.map(j+d.tableStart);g.delete(a,a+k.nodeSize)}}if(null==c||null==f)return!0;if(g.setNodeMarkup(c+d.tableStart,null,{...kB(f.attrs,f.attrs.colspan,d.right-d.left-f.attrs.colspan),rowspan:d.bottom-d.top}),i.size>0){let a=c+1+f.content.size,b=kK(f)?c+1:a;g.replaceWith(b+d.tableStart,a+d.tableStart,i)}g.setSelection(new kC(g.doc.resolve(c+d.tableStart))),b(g)}return!0}function kM(a,b){var c;let d=ks(a.schema);return(c=({node:a})=>d[a.type.spec.tableRole],(a,b)=>{let d,e,f=a.selection;if(f instanceof kC){if(f.$anchorCell.pos!=f.$headCell.pos)return!1;d=f.$anchorCell.nodeAfter,e=f.$anchorCell.pos}else{var g;if(!(d=function(a){for(let b=a.depth;b>0;b--){let c=a.node(b).type.spec.tableRole;if("cell"===c||"header_cell"===c)return a.node(b)}return null}(f.$from)))return!1;e=null==(g=ku(f.$from))?void 0:g.pos}if(null==d||null==e||1==d.attrs.colspan&&1==d.attrs.rowspan)return!1;if(b){let g,h=d.attrs,i=[],j=h.colwidth;h.rowspan>1&&(h={...h,rowspan:1}),h.colspan>1&&(h={...h,colspan:1});let k=kH(a),l=a.tr;for(let a=0;a<k.right-k.left;a++)i.push(j?{...h,colwidth:j&&j[a]?[j[a]]:null}:h);for(let a=k.top;a<k.bottom;a++){let b=k.map.positionAt(a,k.left,k.table);a==k.top&&(b+=d.nodeSize);for(let e=k.left,f=0;e<k.right;e++,f++)(e!=k.left||a!=k.top)&&l.insert(g=l.mapping.map(b+k.tableStart,1),c({node:d,row:a,col:e}).createAndFill(i[f]))}l.setNodeMarkup(e,c({node:d,row:k.top,col:k.left}),i[0]),f instanceof kC&&l.setSelection(new kC(l.doc.resolve(f.$anchorCell.pos),g?l.doc.resolve(g):void 0)),b(l)}return!0})(a,b)}function kN(a,b,c){let d=b.map.cellsInRect({left:0,top:0,right:"row"==a?b.map.width:1,bottom:"column"==a?b.map.height:1});for(let a=0;a<d.length;a++){let e=b.table.nodeAt(d[a]);if(e&&e.type!==c.header_cell)return!1}return!0}function kO(a,b){if((b=b||{useDeprecatedLogic:!1}).useDeprecatedLogic)return function(b,c){if(!kv(b))return!1;if(c){let d=ks(b.schema),e=kH(b),f=b.tr,g=e.map.cellsInRect("column"==a?{left:e.left,top:0,right:e.right,bottom:e.map.height}:"row"==a?{left:0,top:e.top,right:e.map.width,bottom:e.bottom}:e),h=g.map(a=>e.table.nodeAt(a));for(let a=0;a<g.length;a++)h[a].type==d.header_cell&&f.setNodeMarkup(e.tableStart+g[a],d.cell,h[a].attrs);if(0===f.steps.length)for(let a=0;a<g.length;a++)f.setNodeMarkup(e.tableStart+g[a],d.header_cell,h[a].attrs);c(f)}return!0};return function(b,c){if(!kv(b))return!1;if(c){let d=ks(b.schema),e=kH(b),f=b.tr,g=kN("row",e,d),h=kN("column",e,d),i=+("column"===a?!!g:"row"===a&&!!h),j="column"==a?{left:0,top:i,right:1,bottom:e.map.height}:"row"==a?{left:i,top:0,right:e.map.width,bottom:1}:e,k="column"==a?h?d.cell:d.header_cell:"row"==a?g?d.cell:d.header_cell:d.cell;e.map.cellsInRect(j).forEach(a=>{let b=a+e.tableStart,c=f.doc.nodeAt(b);c&&f.setNodeMarkup(b,k,c.attrs)}),c(f)}return!0}}kO("row",{useDeprecatedLogic:!0}),kO("column",{useDeprecatedLogic:!0});let kP=kO("cell",{useDeprecatedLogic:!0});function kQ(a){return function(b,c){if(!kv(b))return!1;let d=function(a,b){if(b<0){let b=a.nodeBefore;if(b)return a.pos-b.nodeSize;for(let b=a.index(-1)-1,c=a.before();b>=0;b--){let d=a.node(-1).child(b),e=d.lastChild;if(e)return c-1-e.nodeSize;c-=d.nodeSize}}else{if(a.index()<a.parent.childCount-1)return a.pos+a.nodeAfter.nodeSize;let b=a.node(-1);for(let c=a.indexAfter(-1),d=a.after();c<b.childCount;c++){let a=b.child(c);if(a.childCount)return d+1;d+=a.nodeSize}}return null}(kw(b),a);if(null==d)return!1;if(c){let a=b.doc.resolve(d);c(b.tr.setSelection(bo.between(a,a.node(0).resolve(a.pos+a.nodeAfter.nodeSize))).scrollIntoView())}return!0}}function kR(a,b){let c=a.selection;if(!(c instanceof kC))return!1;if(b){let d=a.tr,e=ks(a.schema).cell.createAndFill().content;c.forEachCell((a,b)=>{a.content.eq(e)||d.replace(d.mapping.map(b+1),d.mapping.map(b+a.nodeSize-1),new U(e,0,0))}),d.docChanged&&b(d)}return!0}function kS(a,b){let c=a.createAndFill();return new bi(c).replace(0,c.content.size,b).doc}function kT(a,b,c,d,e,f,g,h){if(0==g||g==b.height)return!1;let i=!1;for(let j=e;j<f;j++){let e=g*b.width+j,f=b.map[e];if(b.map[e-b.width]==f){i=!0;let e=c.nodeAt(f),{top:k,left:l}=b.findCell(f);a.setNodeMarkup(a.mapping.slice(h).map(f+d),null,{...e.attrs,rowspan:g-k}),a.insert(a.mapping.slice(h).map(b.positionAt(g,l,c)),e.type.createAndFill({...e.attrs,rowspan:k+e.attrs.rowspan-g})),j+=e.attrs.colspan-1}}return i}function kU(a,b,c,d,e,f,g,h){if(0==g||g==b.width)return!1;let i=!1;for(let j=e;j<f;j++){let e=j*b.width+g,f=b.map[e];if(b.map[e-1]==f){i=!0;let e=c.nodeAt(f),k=b.colCount(f),l=a.mapping.slice(h).map(f+d);a.setNodeMarkup(l,null,kA(e.attrs,g-k,e.attrs.colspan-(g-k))),a.insert(l+e.nodeSize,e.type.createAndFill(kA(e.attrs,0,g-k))),j+=e.attrs.rowspan-1}}return i}function kV(a,b,c,d,e){let f=c?a.doc.nodeAt(c-1):a.doc;if(!f)throw Error("No table found");let g=kr.get(f),{top:h,left:i}=d,j=i+e.width,k=h+e.height,l=a.tr,m=0;function n(){if(!(f=c?l.doc.nodeAt(c-1):l.doc))throw Error("No table found");g=kr.get(f),m=l.mapping.maps.length}(function(a,b,c,d,e,f,g){let h,i,j=ks(a.doc.type.schema);if(e>b.width)for(let f=0,g=0;f<b.height;f++){let k,l=c.child(f);g+=l.nodeSize;let m=[];k=null==l.lastChild||l.lastChild.type==j.cell?h||(h=j.cell.createAndFill()):i||(i=j.header_cell.createAndFill());for(let a=b.width;a<e;a++)m.push(k);a.insert(a.mapping.slice(0).map(g-1+d),m)}if(f>b.height){let g=[];for(let a=0,d=(b.height-1)*b.width;a<Math.max(b.width,e);a++){let e=!(a>=b.width)&&c.nodeAt(b.map[d+a]).type==j.header_cell;g.push(e?i||(i=j.header_cell.createAndFill()):h||(h=j.cell.createAndFill()))}let k=j.row.create(null,O.from(g)),l=[];for(let a=b.height;a<f;a++)l.push(k);a.insert(a.mapping.slice(0).map(d+c.nodeSize-2),l)}return!!(h||i)})(l,g,f,c,j,k,0)&&n(),kT(l,g,f,c,i,j,h,m)&&n(),kT(l,g,f,c,i,j,k,m)&&n(),kU(l,g,f,c,h,k,i,m)&&n(),kU(l,g,f,c,h,k,j,m)&&n();for(let a=h;a<k;a++){let b=g.positionAt(a,i,f),d=g.positionAt(a,j,f);l.replace(l.mapping.slice(m).map(b+c),l.mapping.slice(m).map(d+c),new U(e.rows[a-h],0,0))}n(),l.setSelection(new kC(l.doc.resolve(c+g.positionAt(h,i,f)),l.doc.resolve(c+g.positionAt(k-1,j-1,f)))),b(l)}let kW=eK({ArrowLeft:kY("horiz",-1),ArrowRight:kY("horiz",1),ArrowUp:kY("vert",-1),ArrowDown:kY("vert",1),"Shift-ArrowLeft":kZ("horiz",-1),"Shift-ArrowRight":kZ("horiz",1),"Shift-ArrowUp":kZ("vert",-1),"Shift-ArrowDown":kZ("vert",1),Backspace:kR,"Mod-Backspace":kR,Delete:kR,"Mod-Delete":kR});function kX(a,b,c){return!c.eq(a.selection)&&(b&&b(a.tr.setSelection(c).scrollIntoView()),!0)}function kY(a,b){return(c,d,e)=>{if(!e)return!1;let f=c.selection;if(f instanceof kC)return kX(c,d,bk.near(f.$headCell,b));if("horiz"!=a&&!f.empty)return!1;let g=k1(e,a,b);if(null==g)return!1;if("horiz"==a)return kX(c,d,bk.near(c.doc.resolve(f.head+b),b));{let e,f=c.doc.resolve(g),h=kz(f,a,b);return e=h?bk.near(h,1):b<0?bk.near(c.doc.resolve(f.before(-1)),-1):bk.near(c.doc.resolve(f.after(-1)),1),kX(c,d,e)}}}function kZ(a,b){return(c,d,e)=>{let f;if(!e)return!1;let g=c.selection;if(g instanceof kC)f=g;else{let d=k1(e,a,b);if(null==d)return!1;f=new kC(c.doc.resolve(d))}let h=kz(f.$headCell,a,b);return!!h&&kX(c,d,new kC(f.$anchorCell,h))}}function k$(a,b){let c=ku(a.state.doc.resolve(b));return!!c&&(a.dispatch(a.state.tr.setSelection(new kC(c))),!0)}function k_(a,b,c){if(!kv(a.state))return!1;let d=function(a){if(0===a.size)return null;let{content:b,openStart:c,openEnd:d}=a;for(;1==b.childCount&&(c>0&&d>0||"table"==b.child(0).type.spec.tableRole);)c--,d--,b=b.child(0).content;let e=b.child(0),f=e.type.spec.tableRole,g=e.type.schema,h=[];if("row"==f)for(let a=0;a<b.childCount;a++){let e=b.child(a).content,f=a?0:Math.max(0,c-1),i=a<b.childCount-1?0:Math.max(0,d-1);(f||i)&&(e=kS(ks(g).row,new U(e,f,i)).content),h.push(e)}else{if("cell"!=f&&"header_cell"!=f)return null;h.push(c||d?kS(ks(g).row,new U(b,c,d)).content:b)}return function(a,b){let c=[];for(let a=0;a<b.length;a++){let d=b[a];for(let b=d.childCount-1;b>=0;b--){let{rowspan:e,colspan:f}=d.child(b).attrs;for(let b=a;b<a+e;b++)c[b]=(c[b]||0)+f}}let d=0;for(let a=0;a<c.length;a++)d=Math.max(d,c[a]);for(let e=0;e<c.length;e++)if(e>=b.length&&b.push(O.empty),c[e]<d){let f=ks(a).cell.createAndFill(),g=[];for(let a=c[e];a<d;a++)g.push(f);b[e]=b[e].append(O.from(g))}return{height:b.length,width:d,rows:b}}(g,h)}(c),e=a.state.selection;if(e instanceof kC){d||(d={width:1,height:1,rows:[O.from(kS(ks(a.state.schema).cell,c))]});let b=e.$anchorCell.node(-1),f=e.$anchorCell.start(-1),g=kr.get(b).rectBetween(e.$anchorCell.pos-f,e.$headCell.pos-f);return d=function({width:a,height:b,rows:c},d,e){if(a!=d){let b=[],e=[];for(let a=0;a<c.length;a++){let f=c[a],g=[];for(let c=b[a]||0,e=0;c<d;e++){let h=f.child(e%f.childCount);c+h.attrs.colspan>d&&(h=h.type.createChecked(kA(h.attrs,h.attrs.colspan,c+h.attrs.colspan-d),h.content)),g.push(h),c+=h.attrs.colspan;for(let c=1;c<h.attrs.rowspan;c++)b[a+c]=(b[a+c]||0)+h.attrs.colspan}e.push(O.from(g))}c=e,a=d}if(b!=e){let a=[];for(let d=0,f=0;d<e;d++,f++){let g=[],h=c[f%b];for(let a=0;a<h.childCount;a++){let b=h.child(a);d+b.attrs.rowspan>e&&(b=b.type.create({...b.attrs,rowspan:Math.max(1,e-b.attrs.rowspan)},b.content)),g.push(b)}a.push(O.from(g))}c=a,b=e}return{width:a,height:b,rows:c}}(d,g.right-g.left,g.bottom-g.top),kV(a.state,a.dispatch,f,g,d),!0}if(!d)return!1;{let b=kw(a.state),c=b.start(-1);return kV(a.state,a.dispatch,c,kr.get(b.node(-1)).findCell(b.pos-c),d),!0}}function k0(a,b){var c;let d;if(0!=b.button||b.ctrlKey||b.metaKey)return;let e=k2(a,b.target);if(b.shiftKey&&a.state.selection instanceof kC)f(a.state.selection.$anchorCell,b),b.preventDefault();else if(b.shiftKey&&e&&null!=(d=ku(a.state.selection.$anchor))&&(null==(c=k3(a,b))?void 0:c.pos)!=d.pos)f(d,b),b.preventDefault();else if(!e)return;function f(b,c){let d=k3(a,c),e=null==kt.getState(a.state);if(!d||!ky(b,d))if(!e)return;else d=b;let f=new kC(b,d);if(e||!a.state.selection.eq(f)){let c=a.state.tr.setSelection(f);e&&c.setMeta(kt,b.pos),a.dispatch(c)}}function g(){a.root.removeEventListener("mouseup",g),a.root.removeEventListener("dragstart",g),a.root.removeEventListener("mousemove",h),null!=kt.getState(a.state)&&a.dispatch(a.state.tr.setMeta(kt,-1))}function h(c){let d,h=kt.getState(a.state);if(null!=h)d=a.state.doc.resolve(h);else if(k2(a,c.target)!=e&&!(d=k3(a,b)))return g();d&&f(d,c)}a.root.addEventListener("mouseup",g),a.root.addEventListener("dragstart",g),a.root.addEventListener("mousemove",h)}function k1(a,b,c){if(!(a.state.selection instanceof bo))return null;let{$head:d}=a.state.selection;for(let e=d.depth-1;e>=0;e--){let f=d.node(e);if((c<0?d.index(e):d.indexAfter(e))!=(c<0?0:f.childCount))break;if("cell"==f.type.spec.tableRole||"header_cell"==f.type.spec.tableRole){let f=d.before(e),g="vert"==b?c>0?"down":"up":c>0?"right":"left";return a.endOfTextblock(g)?f:null}}return null}function k2(a,b){for(;b&&b!=a.dom;b=b.parentNode)if("TD"==b.nodeName||"TH"==b.nodeName)return b;return null}function k3(a,b){let c=a.posAtCoords({left:b.clientX,top:b.clientY});if(!c)return null;let{inside:d,pos:e}=c;return d>=0&&ku(a.state.doc.resolve(d))||ku(a.state.doc.resolve(e))}var k4=class{constructor(a,b){this.node=a,this.defaultCellMinWidth=b,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${b}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),k5(a,this.colgroup,this.table,b),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(a){return a.type==this.node.type&&(this.node=a,k5(a,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(a){return"attributes"==a.type&&(a.target==this.table||this.colgroup.contains(a.target))}};function k5(a,b,c,d,e,f){let g=0,h=!0,i=b.firstChild,j=a.firstChild;if(j){for(let a=0,c=0;a<j.childCount;a++){let{colspan:k,colwidth:l}=j.child(a).attrs;for(let a=0;a<k;a++,c++){let j=e==c?f:l&&l[a],k=j?j+"px":"";if(g+=j||d,j||(h=!1),i)i.style.width!=k&&(i.style.width=k),i=i.nextSibling;else{let a=document.createElement("col");a.style.width=k,b.appendChild(a)}}}for(;i;){var k;let a=i.nextSibling;null==(k=i.parentNode)||k.removeChild(i),i=a}h?(c.style.width=g+"px",c.style.minWidth=""):(c.style.width="",c.style.minWidth=g+"px")}}let k6=new bF("tableColumnResizing");var k7=class a{constructor(a,b){this.activeHandle=a,this.dragging=b}apply(b){let c=b.getMeta(k6);if(c&&null!=c.setHandle)return new a(c.setHandle,!1);if(c&&void 0!==c.setDragging)return new a(this.activeHandle,c.setDragging);if(this.activeHandle>-1&&b.docChanged){let c=b.mapping.map(this.activeHandle,-1);return kx(b.doc.resolve(c))||(c=-1),new a(c,this.dragging)}return this}};function k8(a,b,c,d){let e=a.posAtCoords({left:b.clientX+("right"==c?-d:d),top:b.clientY});if(!e)return -1;let{pos:f}=e,g=ku(a.state.doc.resolve(f));if(!g)return -1;if("right"==c)return g.pos;let h=kr.get(g.node(-1)),i=g.start(-1),j=h.map.indexOf(g.pos-i);return j%h.width==0?-1:i+h.map[j-1]}function k9(a,b,c){let d=b.clientX-a.startX;return Math.max(c,a.startWidth+d)}function la(a,b){a.dispatch(a.state.tr.setMeta(k6,{setHandle:b}))}function lb(a,b,c,d){let e=a.state.doc.resolve(b),f=e.node(-1),g=e.start(-1),h=kr.get(f).colCount(e.pos-g)+e.nodeAfter.attrs.colspan-1,i=a.domAtPos(e.start(-1)).node;for(;i&&"TABLE"!=i.nodeName;)i=i.parentNode;i&&k5(f,i.firstChild,i,d,h,c)}var lc=hd.create({name:"tableCell",addOptions:()=>({HTMLAttributes:{}}),content:"block+",addAttributes:()=>({colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:a=>{var b,c;let d=a.getAttribute("colwidth"),e=d?d.split(",").map(a=>parseInt(a,10)):null;if(!e){let d=null==(b=a.closest("table"))?void 0:b.querySelectorAll("colgroup > col"),e=Array.from((null==(c=a.parentElement)?void 0:c.children)||[]).indexOf(a);if(e&&e>-1&&d&&d[e]){let a=d[e].getAttribute("width");return a?[parseInt(a,10)]:null}}return e}}}),tableRole:"cell",isolating:!0,parseHTML:()=>[{tag:"td"}],renderHTML({HTMLAttributes:a}){return["td",fW(this.options.HTMLAttributes,a),0]}}),ld=hd.create({name:"tableHeader",addOptions:()=>({HTMLAttributes:{}}),content:"block+",addAttributes:()=>({colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:a=>{let b=a.getAttribute("colwidth");return b?b.split(",").map(a=>parseInt(a,10)):null}}}),tableRole:"header_cell",isolating:!0,parseHTML:()=>[{tag:"th"}],renderHTML({HTMLAttributes:a}){return["th",fW(this.options.HTMLAttributes,a),0]}}),le=hd.create({name:"tableRow",addOptions:()=>({HTMLAttributes:{}}),content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML:()=>[{tag:"tr"}],renderHTML({HTMLAttributes:a}){return["tr",fW(this.options.HTMLAttributes,a),0]}});function lf(a,b){return b?["width",`${Math.max(b,a)}px`]:["min-width",`${a}px`]}function lg(a,b,c,d,e,f){var g;let h=0,i=!0,j=b.firstChild,k=a.firstChild;if(null!==k)for(let a=0,c=0;a<k.childCount;a+=1){let{colspan:g,colwidth:l}=k.child(a).attrs;for(let a=0;a<g;a+=1,c+=1){let g=e===c?f:l&&l[a],k=g?`${g}px`:"";if(h+=g||d,g||(i=!1),j){if(j.style.width!==k){let[a,b]=lf(d,g);j.style.setProperty(a,b)}j=j.nextSibling}else{let a=document.createElement("col"),[c,e]=lf(d,g);a.style.setProperty(c,e),b.appendChild(a)}}}for(;j;){let a=j.nextSibling;null==(g=j.parentNode)||g.removeChild(j),j=a}let l=a.attrs.style&&"string"==typeof a.attrs.style&&/\bwidth\s*:/i.test(a.attrs.style);i&&!l?(c.style.width=`${h}px`,c.style.minWidth=""):(c.style.width="",c.style.minWidth=`${h}px`)}var lh=class{constructor(a,b){this.node=a,this.cellMinWidth=b,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),a.attrs.style&&(this.table.style.cssText=a.attrs.style),this.colgroup=this.table.appendChild(document.createElement("colgroup")),lg(a,this.colgroup,this.table,b),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(a){return a.type===this.node.type&&(this.node=a,lg(a,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(a){let b=a.target,c=this.dom.contains(b),d=this.contentDOM.contains(b);return!!c&&!d&&("attributes"===a.type||"childList"===a.type||"characterData"===a.type)}};function li(a,b){return b?a.createChecked(null,b):a.createAndFill()}var lj=({editor:a})=>{let{selection:b}=a.state;if(!(b instanceof kC))return!1;let c=0,d=fN(b.ranges[0].$from,a=>"table"===a.type.name);return null==d||d.node.descendants(a=>{if("table"===a.type.name)return!1;["tableCell","tableHeader"].includes(a.type.name)&&(c+=1)}),c===b.ranges.length&&(a.commands.deleteTable(),!0)},lk=function(a,b,c={}){var d;let e=null!=(d=c.cellLineSeparator)?d:"\x1f";if(!a||!a.content||0===a.content.length)return"";let f=[];a.content.forEach(a=>{let c=[];a.content&&a.content.forEach(a=>{let d=((a.content&&Array.isArray(a.content)&&a.content.length>1?a.content.map(a=>b.renderChildren(a)).join(e):a.content?b.renderChildren(a.content):"")||"").replace(/\s+/g," ").trim(),f="tableHeader"===a.type;c.push({text:d,isHeader:f})}),f.push(c)});let g=f.reduce((a,b)=>Math.max(a,b.length),0);if(0===g)return"";let h=Array(g).fill(0);f.forEach(a=>{var b;for(let c=0;c<g;c+=1){let d=((null==(b=a[c])?void 0:b.text)||"").length;d>h[c]&&(h[c]=d),h[c]<3&&(h[c]=3)}});let i=(a,b)=>a+" ".repeat(Math.max(0,b-a.length)),j=f[0],k=j.some(a=>a.isHeader),l="\n",m=Array(g).fill(0).map((a,b)=>k&&j[b]&&j[b].text||"");return l+=`| ${m.map((a,b)=>i(a,h[b])).join(" | ")} |
| ${h.map(a=>"-".repeat(Math.max(3,a))).join(" | ")} |
`,(k?f.slice(1):f).forEach(a=>{l+=`| ${Array(g).fill(0).map((b,c)=>i(a[c]&&a[c].text||"",h[c])).join(" | ")} |
`}),l},ll=hd.create({name:"table",addOptions:()=>({HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:lh,lastColumnResizable:!0,allowTableNodeSelection:!1}),content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML:()=>[{tag:"table"}],renderHTML({node:a,HTMLAttributes:b}){let{colgroup:c,tableWidth:d,tableMinWidth:e}=function(a,b,c,d){let e=0,f=!0,g=[],h=a.firstChild;if(!h)return{};for(let a=0,c=0;a<h.childCount;a+=1){let{colspan:d,colwidth:i}=h.child(a).attrs;for(let a=0;a<d;a+=1,c+=1){let d=void 0===c?void 0:i&&i[a];e+=d||b,d||(f=!1);let[h,j]=lf(b,d);g.push(["col",{style:`${h}: ${j}`}])}}return{colgroup:["colgroup",{},...g],tableWidth:f?`${e}px`:"",tableMinWidth:f?"":`${e}px`}}(a,this.options.cellMinWidth),f=b.style,g=["table",fW(this.options.HTMLAttributes,b,{style:f||(d?`width: ${d}`:`min-width: ${e}`)}),c,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},g]:g},parseMarkdown:(a,b)=>{let c=[];if(a.header){let d=[];a.header.forEach(a=>{d.push(b.createNode("tableHeader",{},[{type:"paragraph",content:b.parseInline(a.tokens)}]))}),c.push(b.createNode("tableRow",{},d))}return a.rows&&a.rows.forEach(a=>{let d=[];a.forEach(a=>{d.push(b.createNode("tableCell",{},[{type:"paragraph",content:b.parseInline(a.tokens)}]))}),c.push(b.createNode("tableRow",{},d))}),b.createNode("table",void 0,c)},renderMarkdown:(a,b)=>lk(a,b),addCommands:()=>({insertTable:({rows:a=3,cols:b=3,withHeaderRow:c=!0}={})=>({tr:d,dispatch:e,editor:f})=>{let g=function(a,b,c,d,e){let f=function(a){if(a.cached.tableNodeTypes)return a.cached.tableNodeTypes;let b={};return Object.keys(a.nodes).forEach(c=>{let d=a.nodes[c];d.spec.tableRole&&(b[d.spec.tableRole]=d)}),a.cached.tableNodeTypes=b,b}(a),g=[],h=[];for(let a=0;a<c;a+=1){let a=li(f.cell,void 0);if(a&&h.push(a),d){let a=li(f.header_cell,void 0);a&&g.push(a)}}let i=[];for(let a=0;a<b;a+=1)i.push(f.row.createChecked(null,d&&0===a?g:h));return f.table.createChecked(null,i)}(f.schema,a,b,c);if(e){let a=d.selection.from+1;d.replaceSelectionWith(g).scrollIntoView().setSelection(bo.near(d.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:a,dispatch:b})=>(function(a,b){if(!kv(a))return!1;if(b){let c=kH(a);b(kI(a.tr,c,c.left))}return!0})(a,b),addColumnAfter:()=>({state:a,dispatch:b})=>(function(a,b){if(!kv(a))return!1;if(b){let c=kH(a);b(kI(a.tr,c,c.right))}return!0})(a,b),deleteColumn:()=>({state:a,dispatch:b})=>(function(a,b){if(!kv(a))return!1;if(b){let c=kH(a),d=a.tr;if(0==c.left&&c.right==c.map.width)return!1;for(let a=c.right-1;!function(a,{map:b,table:c,tableStart:d},e){let f=a.mapping.maps.length;for(let g=0;g<b.height;){let h=g*b.width+e,i=b.map[h],j=c.nodeAt(i),k=j.attrs;if(e>0&&b.map[h-1]==i||e<b.width-1&&b.map[h+1]==i)a.setNodeMarkup(a.mapping.slice(f).map(d+i),null,kA(k,e-b.colCount(i)));else{let b=a.mapping.slice(f).map(d+i);a.delete(b,b+j.nodeSize)}g+=k.rowspan}}(d,c,a),a!=c.left;a--){let a=c.tableStart?d.doc.nodeAt(c.tableStart-1):d.doc;if(!a)throw RangeError("No table found");c.table=a,c.map=kr.get(a)}b(d)}return!0})(a,b),addRowBefore:()=>({state:a,dispatch:b})=>(function(a,b){if(!kv(a))return!1;if(b){let c=kH(a);b(kJ(a.tr,c,c.top))}return!0})(a,b),addRowAfter:()=>({state:a,dispatch:b})=>(function(a,b){if(!kv(a))return!1;if(b){let c=kH(a);b(kJ(a.tr,c,c.bottom))}return!0})(a,b),deleteRow:()=>({state:a,dispatch:b})=>(function(a,b){if(!kv(a))return!1;if(b){let c=kH(a),d=a.tr;if(0==c.top&&c.bottom==c.map.height)return!1;for(let a=c.bottom-1;!function(a,{map:b,table:c,tableStart:d},e){let f=0;for(let a=0;a<e;a++)f+=c.child(a).nodeSize;let g=f+c.child(e).nodeSize,h=a.mapping.maps.length;a.delete(f+d,g+d);let i=new Set;for(let f=0,g=e*b.width;f<b.width;f++,g++){let j=b.map[g];if(!i.has(j)){if(i.add(j),e>0&&j==b.map[g-b.width]){let b=c.nodeAt(j).attrs;a.setNodeMarkup(a.mapping.slice(h).map(j+d),null,{...b,rowspan:b.rowspan-1}),f+=b.colspan-1}else if(e<b.height&&j==b.map[g+b.width]){let g=c.nodeAt(j),i=g.attrs,k=g.type.create({...i,rowspan:g.attrs.rowspan-1},g.content),l=b.positionAt(e+1,f,c);a.insert(a.mapping.slice(h).map(d+l),k),f+=i.colspan-1}}}}(d,c,a),a!=c.top;a--){let a=c.tableStart?d.doc.nodeAt(c.tableStart-1):d.doc;if(!a)throw RangeError("No table found");c.table=a,c.map=kr.get(c.table)}b(d)}return!0})(a,b),deleteTable:()=>({state:a,dispatch:b})=>(function(a,b){let c=a.selection.$anchor;for(let d=c.depth;d>0;d--)if("table"==c.node(d).type.spec.tableRole)return b&&b(a.tr.delete(c.before(d),c.after(d)).scrollIntoView()),!0;return!1})(a,b),mergeCells:()=>({state:a,dispatch:b})=>kL(a,b),splitCell:()=>({state:a,dispatch:b})=>kM(a,b),toggleHeaderColumn:()=>({state:a,dispatch:b})=>kO("column")(a,b),toggleHeaderRow:()=>({state:a,dispatch:b})=>kO("row")(a,b),toggleHeaderCell:()=>({state:a,dispatch:b})=>kP(a,b),mergeOrSplit:()=>({state:a,dispatch:b})=>!!kL(a,b)||kM(a,b),setCellAttribute:(a,b)=>({state:c,dispatch:d})=>(function(c,d){if(!kv(c))return!1;let e=kw(c);if(e.nodeAfter.attrs[a]===b)return!1;if(d){let f=c.tr;c.selection instanceof kC?c.selection.forEachCell((c,d)=>{c.attrs[a]!==b&&f.setNodeMarkup(d,null,{...c.attrs,[a]:b})}):f.setNodeMarkup(e.pos,null,{...e.nodeAfter.attrs,[a]:b}),d(f)}return!0})(c,d),goToNextCell:()=>({state:a,dispatch:b})=>kQ(1)(a,b),goToPreviousCell:()=>({state:a,dispatch:b})=>kQ(-1)(a,b),fixTables:()=>({state:a,dispatch:b})=>(b&&kG(a),!0),setCellSelection:a=>({tr:b,dispatch:c})=>{if(c){let c=kC.create(b.doc,a.anchorCell,a.headCell);b.setSelection(c)}return!0}}),addKeyboardShortcuts(){return{Tab:()=>!!this.editor.commands.goToNextCell()||!!this.editor.can().addRowAfter()&&this.editor.chain().addRowAfter().goToNextCell().run(),"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:lj,"Mod-Backspace":lj,Delete:lj,"Mod-Delete":lj}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[function({handleWidth:a=5,cellMinWidth:b=25,defaultCellMinWidth:c=100,View:d=k4,lastColumnResizable:e=!0}={}){let f=new bC({key:k6,state:{init(a,b){var e;let g=null==(e=f.spec)||null==(e=e.props)?void 0:e.nodeViews,h=ks(b.schema).table.name;return d&&g&&(g[h]=(a,b)=>new d(a,c,b)),new k7(-1,!1)},apply:(a,b)=>b.apply(a)},props:{attributes:a=>{let b=k6.getState(a);return b&&b.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(b,c)=>{!function(a,b,c,d){if(!a.editable)return;let e=k6.getState(a.state);if(e&&!e.dragging){let f=function(a){for(;a&&"TD"!=a.nodeName&&"TH"!=a.nodeName;)a=a.classList&&a.classList.contains("ProseMirror")?null:a.parentNode;return a}(b.target),g=-1;if(f){let{left:d,right:e}=f.getBoundingClientRect();b.clientX-d<=c?g=k8(a,b,"left",c):e-b.clientX<=c&&(g=k8(a,b,"right",c))}if(g!=e.activeHandle){if(!d&&-1!==g){let b=a.state.doc.resolve(g),c=b.node(-1),d=kr.get(c),e=b.start(-1);if(d.colCount(b.pos-e)+b.nodeAfter.attrs.colspan-1==d.width-1)return}la(a,g)}}}(b,c,a,e)},mouseleave:a=>{!function(a){if(!a.editable)return;let b=k6.getState(a.state);b&&b.activeHandle>-1&&!b.dragging&&la(a,-1)}(a)},mousedown:(a,d)=>{!function(a,b,c,d){var e;if(!a.editable)return;let f=null!=(e=a.dom.ownerDocument.defaultView)?e:window,g=k6.getState(a.state);if(!g||-1==g.activeHandle||g.dragging)return;let h=a.state.doc.nodeAt(g.activeHandle),i=function(a,b,{colspan:c,colwidth:d}){let e=d&&d[d.length-1];if(e)return e;let f=a.domAtPos(b),g=f.node.childNodes[f.offset].offsetWidth,h=c;if(d)for(let a=0;a<c;a++)d[a]&&(g-=d[a],h--);return g/h}(a,g.activeHandle,h.attrs);function j(b){f.removeEventListener("mouseup",j),f.removeEventListener("mousemove",k);let d=k6.getState(a.state);(null==d?void 0:d.dragging)&&(function(a,b,c){let d=a.state.doc.resolve(b),e=d.node(-1),f=kr.get(e),g=d.start(-1),h=f.colCount(d.pos-g)+d.nodeAfter.attrs.colspan-1,i=a.state.tr;for(let a=0;a<f.height;a++){let b=a*f.width+h;if(a&&f.map[b]==f.map[b-f.width])continue;let d=f.map[b],j=e.nodeAt(d).attrs,k=1==j.colspan?0:h-f.colCount(d);if(j.colwidth&&j.colwidth[k]==c)continue;let l=j.colwidth?j.colwidth.slice():Array(j.colspan).fill(0);l[k]=c,i.setNodeMarkup(g+d,null,{...j,colwidth:l})}i.docChanged&&a.dispatch(i)}(a,d.activeHandle,k9(d.dragging,b,c)),a.dispatch(a.state.tr.setMeta(k6,{setDragging:null})))}function k(b){if(!b.which)return j(b);let e=k6.getState(a.state);if(e&&e.dragging){let f=k9(e.dragging,b,c);lb(a,e.activeHandle,f,d)}}a.dispatch(a.state.tr.setMeta(k6,{setDragging:{startX:b.clientX,startWidth:i}})),lb(a,g.activeHandle,i,d),f.addEventListener("mouseup",j),f.addEventListener("mousemove",k),b.preventDefault()}(a,d,b,c)}},decorations:a=>{let b=k6.getState(a);if(b&&b.activeHandle>-1)return function(a,b){let c=[],d=a.doc.resolve(b),e=d.node(-1);if(!e)return d8.empty;let f=kr.get(e),g=d.start(-1),h=f.colCount(d.pos-g)+d.nodeAfter.attrs.colspan-1;for(let b=0;b<f.height;b++){let d=h+b*f.width;if((h==f.width-1||f.map[d]!=f.map[d+1])&&(0==b||f.map[d]!=f.map[d-f.width])){var i;let b=f.map[d],h=g+b+e.nodeAt(b).nodeSize-1,j=document.createElement("div");j.className="column-resize-handle",(null==(i=k6.getState(a))?void 0:i.dragging)&&c.push(d5.node(g+b,g+b+e.nodeAt(b).nodeSize,{class:"column-resize-dragging"})),c.push(d5.widget(h,j))}}return d8.create(a.doc,c)}(a,b.activeHandle)},nodeViews:{}}});return f}({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],function({allowTableNodeSelection:a=!1}={}){return new bC({key:kt,state:{init:()=>null,apply(a,b){let c=a.getMeta(kt);if(null!=c)return -1==c?null:c;if(null==b||!a.docChanged)return b;let{deleted:d,pos:e}=a.mapping.mapResult(b);return d?null:e}},props:{decorations:kE,handleDOMEvents:{mousedown:k0},createSelectionBetween:a=>null!=kt.getState(a.state)?a.state.selection:null,handleTripleClick:k$,handleKeyDown:kW,handlePaste:k_},appendTransaction:(b,c,d)=>(function(a,b,c){let d,e,f=(b||a).selection,g=(b||a).doc;if(f instanceof bq&&(e=f.node.type.spec.tableRole)){if("cell"==e||"header_cell"==e)d=kC.create(g,f.from);else if("row"==e){let a=g.resolve(f.from+1);d=kC.rowSelection(a,a)}else if(!c){let a=kr.get(f.node),b=f.from+1,c=b+a.map[a.width*a.height-1];d=kC.create(g,b+1,c)}}else f instanceof bo&&function({$from:a,$to:b}){if(a.pos==b.pos||a.pos<b.pos-6)return!1;let c=a.pos,d=b.pos,e=a.depth;for(;e>=0&&!(a.after(e+1)<a.end(e));e--,c++);for(let a=b.depth;a>=0&&!(b.before(a+1)>b.start(a));a--,d--);return c==d&&/row|table/.test(a.node(e).type.spec.tableRole)}(f)?d=bo.create(g,f.from):f instanceof bo&&function({$from:a,$to:b}){let c,d;for(let b=a.depth;b>0;b--){let d=a.node(b);if("cell"===d.type.spec.tableRole||"header_cell"===d.type.spec.tableRole){c=d;break}}for(let a=b.depth;a>0;a--){let c=b.node(a);if("cell"===c.type.spec.tableRole||"header_cell"===c.type.spec.tableRole){d=c;break}}return c!==d&&0===b.parentOffset}(f)&&(d=bo.create(g,f.$from.start(),f.$from.end()));return d&&(b||(b=a.tr)).setSelection(d),b})(d,kG(d,c),a)})}({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(a){let b={name:a.name,options:a.options,storage:a.storage};return{tableRole:fT(fP(a,"tableRole",b))}}});gM.create({name:"tableKit",addExtensions(){let a=[];return!1!==this.options.table&&a.push(ll.configure(this.options.table)),!1!==this.options.tableCell&&a.push(lc.configure(this.options.tableCell)),!1!==this.options.tableHeader&&a.push(ld.configure(this.options.tableHeader)),!1!==this.options.tableRow&&a.push(le.configure(this.options.tableRow)),a}});var lm=gM.create({name:"textAlign",addOptions:()=>({types:[],alignments:["left","center","right","justify"],defaultAlignment:null}),addGlobalAttributes(){return[{types:this.options.types,attributes:{textAlign:{default:this.options.defaultAlignment,parseHTML:a=>{let b=a.style.textAlign;return this.options.alignments.includes(b)?b:this.options.defaultAlignment},renderHTML:a=>a.textAlign?{style:`text-align: ${a.textAlign}`}:{}}}}]},addCommands(){return{setTextAlign:a=>({commands:b})=>!!this.options.alignments.includes(a)&&this.options.types.map(c=>b.updateAttributes(c,{textAlign:a})).some(a=>a),unsetTextAlign:()=>({commands:a})=>this.options.types.map(b=>a.resetAttributes(b,"textAlign")).some(a=>a),toggleTextAlign:a=>({editor:b,commands:c})=>!!this.options.alignments.includes(a)&&(b.isActive({textAlign:a})?c.unsetTextAlign():c.setTextAlign(a))}},addKeyboardShortcuts(){return{"Mod-Shift-l":()=>this.editor.commands.setTextAlign("left"),"Mod-Shift-e":()=>this.editor.commands.setTextAlign("center"),"Mod-Shift-r":()=>this.editor.commands.setTextAlign("right"),"Mod-Shift-j":()=>this.editor.commands.setTextAlign("justify")}}}),ln=(a,b=0)=>{let c=[];return!a.children.length||b>20||Array.from(a.children).forEach(a=>{"SPAN"===a.tagName?c.push(a):a.children.length&&c.push(...ln(a,b+1))}),c},lo=gI.create({name:"textStyle",priority:101,addOptions:()=>({HTMLAttributes:{},mergeNestedSpanStyles:!0}),parseHTML(){return[{tag:"span",consuming:!1,getAttrs:a=>{var b;return!!a.hasAttribute("style")&&(this.options.mergeNestedSpanStyles&&(b=a).children.length&&ln(b).forEach(a=>{var b,c;let d=a.getAttribute("style"),e=null==(c=null==(b=a.parentElement)?void 0:b.closest("span"))?void 0:c.getAttribute("style");a.setAttribute("style",`${e};${d}`)}),{})}}]},renderHTML({HTMLAttributes:a}){return["span",fW(this.options.HTMLAttributes,a),0]},addCommands(){return{toggleTextStyle:a=>({commands:b})=>b.toggleMark(this.name,a),removeEmptyTextStyle:()=>({tr:a})=>{let{selection:b}=a;return a.doc.nodesBetween(b.from,b.to,(b,c)=>{if(b.isTextblock)return!0;b.marks.filter(a=>a.type===this.type).some(a=>Object.values(a.attrs).some(a=>!!a))||a.removeMark(c,c+b.nodeSize,this.type)}),!0}}}}),lp=gM.create({name:"backgroundColor",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{backgroundColor:{default:null,parseHTML:a=>{var b;let c=a.getAttribute("style");if(c){let a=c.split(";").map(a=>a.trim()).filter(Boolean);for(let b=a.length-1;b>=0;b-=1){let c=a[b].split(":");if(c.length>=2){let a=c[0].trim().toLowerCase(),b=c.slice(1).join(":").trim();if("background-color"===a)return b.replace(/['"]+/g,"")}}}return null==(b=a.style.backgroundColor)?void 0:b.replace(/['"]+/g,"")},renderHTML:a=>a.backgroundColor?{style:`background-color: ${a.backgroundColor}`}:{}}}}]},addCommands:()=>({setBackgroundColor:a=>({chain:b})=>b().setMark("textStyle",{backgroundColor:a}).run(),unsetBackgroundColor:()=>({chain:a})=>a().setMark("textStyle",{backgroundColor:null}).removeEmptyTextStyle().run()})}),lq=gM.create({name:"color",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:a=>{var b;let c=a.getAttribute("style");if(c){let a=c.split(";").map(a=>a.trim()).filter(Boolean);for(let b=a.length-1;b>=0;b-=1){let c=a[b].split(":");if(c.length>=2){let a=c[0].trim().toLowerCase(),b=c.slice(1).join(":").trim();if("color"===a)return b.replace(/['"]+/g,"")}}}return null==(b=a.style.color)?void 0:b.replace(/['"]+/g,"")},renderHTML:a=>a.color?{style:`color: ${a.color}`}:{}}}}]},addCommands:()=>({setColor:a=>({chain:b})=>b().setMark("textStyle",{color:a}).run(),unsetColor:()=>({chain:a})=>a().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()})}),lr=gM.create({name:"fontFamily",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:a=>a.style.fontFamily,renderHTML:a=>a.fontFamily?{style:`font-family: ${a.fontFamily}`}:{}}}}]},addCommands:()=>({setFontFamily:a=>({chain:b})=>b().setMark("textStyle",{fontFamily:a}).run(),unsetFontFamily:()=>({chain:a})=>a().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()})}),ls=gM.create({name:"fontSize",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:a=>a.style.fontSize,renderHTML:a=>a.fontSize?{style:`font-size: ${a.fontSize}`}:{}}}}]},addCommands:()=>({setFontSize:a=>({chain:b})=>b().setMark("textStyle",{fontSize:a}).run(),unsetFontSize:()=>({chain:a})=>a().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()})}),lt=gM.create({name:"lineHeight",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{lineHeight:{default:null,parseHTML:a=>a.style.lineHeight,renderHTML:a=>a.lineHeight?{style:`line-height: ${a.lineHeight}`}:{}}}}]},addCommands:()=>({setLineHeight:a=>({chain:b})=>b().setMark("textStyle",{lineHeight:a}).run(),unsetLineHeight:()=>({chain:a})=>a().setMark("textStyle",{lineHeight:null}).removeEmptyTextStyle().run()})});gM.create({name:"textStyleKit",addExtensions(){let a=[];return!1!==this.options.backgroundColor&&a.push(lp.configure(this.options.backgroundColor)),!1!==this.options.color&&a.push(lq.configure(this.options.color)),!1!==this.options.fontFamily&&a.push(lr.configure(this.options.fontFamily)),!1!==this.options.fontSize&&a.push(ls.configure(this.options.fontSize)),!1!==this.options.lineHeight&&a.push(lt.configure(this.options.lineHeight)),!1!==this.options.textStyle&&a.push(lo.configure(this.options.textStyle)),a}});var lu=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,lv=hd.create({name:"image",addOptions:()=>({inline:!1,allowBase64:!1,HTMLAttributes:{},resize:!1}),inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes:()=>({src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}),parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:a}){return["img",fW(this.options.HTMLAttributes,a)]},parseMarkdown:(a,b)=>b.createNode("image",{src:a.href,title:a.title,alt:a.text}),renderMarkdown:a=>{var b,c,d,e,f,g;let h=null!=(c=null==(b=a.attrs)?void 0:b.src)?c:"",i=null!=(e=null==(d=a.attrs)?void 0:d.alt)?e:"",j=null!=(g=null==(f=a.attrs)?void 0:f.title)?g:"";return j?`![${i}](${h} "${j}")`:`![${i}](${h})`},addNodeView(){if(!this.options.resize||!this.options.resize.enabled||"undefined"==typeof document)return null;let{directions:a,minWidth:b,minHeight:c,alwaysPreserveAspectRatio:d}=this.options.resize;return({node:e,getPos:f,HTMLAttributes:g,editor:h})=>{let i=document.createElement("img");Object.entries(g).forEach(([a,b])=>{if(null!=b)switch(a){case"width":case"height":break;default:i.setAttribute(a,b)}}),i.src=g.src;let j=new g3({element:i,editor:h,node:e,getPos:f,onResize:(a,b)=>{i.style.width=`${a}px`,i.style.height=`${b}px`},onCommit:(a,b)=>{let c=f();void 0!==c&&this.editor.chain().setNodeSelection(c).updateAttributes(this.name,{width:a,height:b}).run()},onUpdate:(a,b,c)=>a.type===e.type,options:{directions:a,min:{width:b,height:c},preserveAspectRatio:!0===d}}),k=j.dom;return k.style.visibility="hidden",k.style.pointerEvents="none",i.onload=()=>{k.style.visibility="",k.style.pointerEvents=""},j}},addCommands(){return{setImage:a=>({commands:b})=>b.insertContent({type:this.name,attrs:a})}},addInputRules(){return[g0({find:lu,type:this.type,getAttributes:a=>{let[,,b,c,d]=a;return{src:c,alt:b,title:d}}})]}}),lw=a.i(633508);function lx({node:a,deleteNode:b,selected:c}){let{label:d,value:e}=a.attrs;return(0,f.jsx)(hs,{as:"span",className:"variable-node-wrapper",contentEditable:!1,"data-drag-handle":!0,children:(0,f.jsxs)("span",{className:`
          inline-flex items-center gap-1 px-2 py-0.5 mx-0.5
          rounded-md text-sm font-medium
          bg-blue-100 text-blue-800 border border-blue-300
          select-none cursor-default
          transition-all duration-150
          ${c?"ring-2 ring-blue-500 ring-offset-1 bg-blue-200":""}
          hover:bg-blue-200
        `,title:`Variable: ${e}`,children:[(0,f.jsx)("span",{className:"text-blue-500 text-xs",children:"{"}),(0,f.jsx)("span",{className:"whitespace-nowrap",children:d}),(0,f.jsx)("span",{className:"text-blue-500 text-xs",children:"}"}),(0,f.jsx)("button",{type:"button",onClick:a=>{a.preventDefault(),a.stopPropagation(),b()},className:" ml-0.5 p-0.5 rounded-full opacity-0 hover:opacity-100 focus:opacity-100 hover:bg-blue-300 transition-opacity group-hover:opacity-70 ",title:"Supprimer cette variable",children:(0,f.jsx)(lw.X,{className:"w-3 h-3"})})]})})}let ly=hd.create({name:"variable",group:"inline",inline:!0,atom:!0,content:"",addAttributes:()=>({id:{default:null,parseHTML:a=>a.getAttribute("data-id"),renderHTML:a=>({"data-id":a.id})},label:{default:null,parseHTML:a=>a.getAttribute("data-label"),renderHTML:a=>({"data-label":a.label})},value:{default:null,parseHTML:a=>a.getAttribute("data-value"),renderHTML:a=>({"data-value":a.value})}}),addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:'span[data-type="variable"]'}],renderHTML({HTMLAttributes:a}){return["span",fW({"data-type":"variable"},this.options.HTMLAttributes,a),a["data-label"]||a["data-value"]||""]},addNodeView:()=>hx(lx),addCommands(){return{insertVariable:a=>({commands:b})=>b.insertContent({type:this.name,attrs:a})}},addKeyboardShortcuts(){return{Backspace:()=>{let{selection:a}=this.editor.state,b=this.editor.state.doc.nodeAt(a.from-1);return b?.type.name==="variable"&&this.editor.commands.deleteRange({from:a.from-1,to:a.from})}}}});var lz=a.i(510948),lA=a.i(405784),lB=a.i(50522),lC=a.i(321161),lD=a.i(781560),lE=a.i(705151);let lF={exists:"existe",not_exists:"n'existe pas",equals:"est gal ",not_equals:"est diffrent de",contains:"contient",greater_than:"est suprieur ",less_than:"est infrieur "},lG=[{id:"eleve_nom",label:"Nom de l'lve"},{id:"eleve_prenom",label:"Prnom de l'lve"},{id:"formation_nom",label:"Nom de la formation"},{id:"montant_ttc",label:"Montant TTC"},{id:"mode_paiement",label:"Mode de paiement"},{id:"session_lieu",label:"Lieu de session"},{id:"ecole_siret",label:"SIRET"}];function lH({node:a,updateAttributes:b,deleteNode:c,selected:d,editor:e}){let{condition:h,type:i,variableId:j,operator:k,compareValue:l}=a.attrs,[m,n]=(0,g.useState)(!1),[o,p]=(0,g.useState)(!1),[q,r]=(0,g.useState)(h||""),[s,t]=(0,g.useState)(j||""),[u,v]=(0,g.useState)(k||"exists"),[w,x]=(0,g.useState)(l||""),y={if:{border:"border-teal-400",bg:"bg-teal-50",header:"bg-teal-100",text:"text-teal-700",icon:"text-teal-600",label:"SI"},elseif:{border:"border-amber-400",bg:"bg-amber-50",header:"bg-amber-100",text:"text-amber-700",icon:"text-amber-600",label:"SINON SI"},else:{border:"border-blue-400",bg:"bg-blue-50",header:"bg-blue-100",text:"text-blue-700",icon:"text-blue-600",label:"SINON"}},z=y[i]||y.if,A=(0,g.useCallback)(()=>{if("else"===i)return"";if(s){let a=lG.find(a=>a.id===s),b=a?.label||s,c=lF[u];return["exists","not_exists"].includes(u)?`${b} ${c}`:`${b} ${c} "${w}"`}return q||"Dfinir la condition..."},[i,s,u,w,q]),B=(0,g.useCallback)(()=>{b({condition:q,variableId:s,operator:u,compareValue:w}),p(!1)},[b,q,s,u,w]),C=(0,g.useCallback)(()=>{let{state:a,dispatch:b}=e.view,{tr:c}=a;e.view.posAtDOM(e.view.dom,0),e.chain().focus().insertConditionalBlock({condition:q,type:i}).run()},[e,q,i]);return(0,f.jsxs)(hs,{className:(0,H.cn)("conditional-block my-4 rounded-lg border-2 overflow-hidden",z.border,z.bg,d&&"ring-2 ring-offset-2 ring-teal-500"),"data-type":"conditional-block",children:[(0,f.jsxs)("div",{className:(0,H.cn)("flex items-center justify-between px-3 py-2",z.header),contentEditable:!1,children:[(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)("button",{type:"button",onClick:()=>n(!m),className:(0,H.cn)("p-1 rounded hover:bg-white/50 transition-colors",z.icon),children:m?(0,f.jsx)(lB.ChevronRight,{className:"w-4 h-4"}):(0,f.jsx)(lA.ChevronDown,{className:"w-4 h-4"})}),(0,f.jsx)(lz.GitBranch,{className:(0,H.cn)("w-4 h-4",z.icon)}),(0,f.jsx)("span",{className:(0,H.cn)("font-semibold text-sm",z.text),children:z.label}),"else"!==i&&(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)("span",{className:(0,H.cn)("text-sm",z.text),children:":"}),(0,f.jsx)("button",{type:"button",onClick:()=>p(!o),className:(0,H.cn)("text-sm px-2 py-0.5 rounded border border-dashed","hover:bg-white/50 transition-colors",z.border,z.text,!s&&!q&&"italic opacity-70"),children:A()})]})]}),(0,f.jsxs)("div",{className:"flex items-center gap-1",children:["else"!==i&&(0,f.jsx)("button",{type:"button",onClick:()=>p(!o),title:"Configurer la condition",className:(0,H.cn)("p-1.5 rounded hover:bg-white/50 transition-colors",z.icon),children:(0,f.jsx)(lC.Settings,{className:"w-3.5 h-3.5"})}),(0,f.jsx)("button",{type:"button",onClick:C,title:"Dupliquer le bloc",className:(0,H.cn)("p-1.5 rounded hover:bg-white/50 transition-colors",z.icon),children:(0,f.jsx)(lE.Copy,{className:"w-3.5 h-3.5"})}),(0,f.jsx)("button",{type:"button",onClick:c,title:"Supprimer le bloc",className:"p-1.5 rounded hover:bg-red-100 text-red-500 transition-colors",children:(0,f.jsx)(lD.Trash2,{className:"w-3.5 h-3.5"})})]})]}),o&&"else"!==i&&(0,f.jsx)("div",{className:"px-4 py-3 bg-white border-b border-gray-200",contentEditable:!1,children:(0,f.jsxs)("div",{className:"space-y-3",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Variable"}),(0,f.jsxs)("select",{value:s,onChange:a=>t(a.target.value),className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-teal-500",children:[(0,f.jsx)("option",{value:"",children:"-- Slectionner une variable --"}),lG.map(a=>(0,f.jsx)("option",{value:a.id,children:a.label},a.id))]})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Oprateur"}),(0,f.jsx)("select",{value:u,onChange:a=>v(a.target.value),className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-teal-500",children:Object.entries(lF).map(([a,b])=>(0,f.jsx)("option",{value:a,children:b},a))})]}),!["exists","not_exists"].includes(u)&&(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Valeur"}),(0,f.jsx)("input",{type:"text",value:w,onChange:a=>x(a.target.value),placeholder:"Entrez la valeur...",className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-teal-500"})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:"Ou condition personnalise"}),(0,f.jsx)("input",{type:"text",value:q,onChange:a=>r(a.target.value),placeholder:"Ex: montant > 1000",className:"w-full px-3 py-1.5 text-sm border border-gray-300 rounded-md focus:ring-2 focus:ring-teal-500 focus:border-teal-500"})]}),(0,f.jsxs)("div",{className:"flex justify-end gap-2 pt-2",children:[(0,f.jsx)("button",{type:"button",onClick:()=>p(!1),className:"px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded-md transition-colors",children:"Annuler"}),(0,f.jsx)("button",{type:"button",onClick:B,className:"px-3 py-1.5 text-sm bg-teal-600 text-white hover:bg-teal-700 rounded-md transition-colors",children:"Appliquer"})]})]})}),!m&&(0,f.jsx)("div",{className:"p-4",children:(0,f.jsx)(hr,{className:"prose prose-sm max-w-none min-h-[40px]"})}),m&&(0,f.jsx)("div",{className:"px-4 py-2 text-xs text-gray-400 italic",contentEditable:!1,children:"Contenu masqu..."})]})}let lI=hd.create({name:"conditionalBlock",group:"block",content:"block+",defining:!0,addAttributes:()=>({condition:{default:"",parseHTML:a=>a.getAttribute("data-condition")||"",renderHTML:a=>({"data-condition":a.condition})},type:{default:"if",parseHTML:a=>a.getAttribute("data-type")||"if",renderHTML:a=>({"data-type":a.type})},variableId:{default:null,parseHTML:a=>a.getAttribute("data-variable-id"),renderHTML:a=>a.variableId?{"data-variable-id":a.variableId}:{}},operator:{default:"exists",parseHTML:a=>a.getAttribute("data-operator")||"exists",renderHTML:a=>({"data-operator":a.operator})},compareValue:{default:"",parseHTML:a=>a.getAttribute("data-compare-value")||"",renderHTML:a=>({"data-compare-value":a.compareValue})}}),addOptions:()=>({HTMLAttributes:{}}),parseHTML:()=>[{tag:'div[data-type="conditional-block"]'}],renderHTML({HTMLAttributes:a}){return["div",fW({"data-type":"conditional-block"},this.options.HTMLAttributes,a),0]},addNodeView:()=>hx(lH),addCommands(){return{insertConditionalBlock:(a={})=>({commands:b})=>b.insertContent({type:this.name,attrs:{condition:a.condition||"",type:a.type||"if"},content:[{type:"paragraph",content:[{type:"text",text:"Contenu conditionnel..."}]}]}),updateConditionalBlockCondition:a=>({commands:b})=>b.updateAttributes(this.name,{condition:a})}},addKeyboardShortcuts(){return{"Mod-Shift-c":()=>this.editor.commands.insertConditionalBlock()}}});var lJ=a.i(507554),lK=a.i(470121),lL=a.i(750104),lM=a.i(596743),lN=a.i(392843),lO=a.i(704691),lP=a.i(692616),lQ=a.i(777192),lR=a.i(30553),lS=a.i(811011),lT=a.i(225152),lU=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),lV=g.forwardRef((a,b)=>(0,f.jsx)(lR.Primitive.span,{...a,ref:b,style:{...lU,...a.style}}));lV.displayName="VisuallyHidden";var[lW,lX]=(0,lL.createContextScope)("Tooltip",[lO.createPopperScope]),lY=(0,lO.createPopperScope)(),lZ="TooltipProvider",l$="tooltip.open",[l_,l0]=lW(lZ),l1=a=>{let{__scopeTooltip:b,delayDuration:c=700,skipDelayDuration:d=300,disableHoverableContent:e=!1,children:h}=a,i=g.useRef(!0),j=g.useRef(!1),k=g.useRef(0);return g.useEffect(()=>{let a=k.current;return()=>window.clearTimeout(a)},[]),(0,f.jsx)(l_,{scope:b,isOpenDelayedRef:i,delayDuration:c,onOpen:g.useCallback(()=>{window.clearTimeout(k.current),i.current=!1},[]),onClose:g.useCallback(()=>{window.clearTimeout(k.current),k.current=window.setTimeout(()=>i.current=!0,d)},[d]),isPointerInTransitRef:j,onPointerInTransitChange:g.useCallback(a=>{j.current=a},[]),disableHoverableContent:e,children:h})};l1.displayName=lZ;var l2="Tooltip",[l3,l4]=lW(l2),l5=a=>{let{__scopeTooltip:b,children:c,open:d,defaultOpen:e,onOpenChange:h,disableHoverableContent:i,delayDuration:j}=a,k=l0(l2,a.__scopeTooltip),l=lY(b),[m,n]=g.useState(null),o=(0,lN.useId)(),p=g.useRef(0),q=i??k.disableHoverableContent,r=j??k.delayDuration,s=g.useRef(!1),[t,u]=(0,lT.useControllableState)({prop:d,defaultProp:e??!1,onChange:a=>{a?(k.onOpen(),document.dispatchEvent(new CustomEvent(l$))):k.onClose(),h?.(a)},caller:l2}),v=g.useMemo(()=>t?s.current?"delayed-open":"instant-open":"closed",[t]),w=g.useCallback(()=>{window.clearTimeout(p.current),p.current=0,s.current=!1,u(!0)},[u]),x=g.useCallback(()=>{window.clearTimeout(p.current),p.current=0,u(!1)},[u]),y=g.useCallback(()=>{window.clearTimeout(p.current),p.current=window.setTimeout(()=>{s.current=!0,u(!0),p.current=0},r)},[r,u]);return g.useEffect(()=>()=>{p.current&&(window.clearTimeout(p.current),p.current=0)},[]),(0,f.jsx)(lO.Root,{...l,children:(0,f.jsx)(l3,{scope:b,contentId:o,open:t,stateAttribute:v,trigger:m,onTriggerChange:n,onTriggerEnter:g.useCallback(()=>{k.isOpenDelayedRef.current?y():w()},[k.isOpenDelayedRef,y,w]),onTriggerLeave:g.useCallback(()=>{q?x():(window.clearTimeout(p.current),p.current=0)},[x,q]),onOpen:w,onClose:x,disableHoverableContent:q,children:c})})};l5.displayName=l2;var l6="TooltipTrigger",l7=g.forwardRef((a,b)=>{let{__scopeTooltip:c,...d}=a,e=l4(l6,c),h=l0(l6,c),i=lY(c),j=g.useRef(null),k=(0,lK.useComposedRefs)(b,j,e.onTriggerChange),l=g.useRef(!1),m=g.useRef(!1),n=g.useCallback(()=>l.current=!1,[]);return g.useEffect(()=>()=>document.removeEventListener("pointerup",n),[n]),(0,f.jsx)(lO.Anchor,{asChild:!0,...i,children:(0,f.jsx)(lR.Primitive.button,{"aria-describedby":e.open?e.contentId:void 0,"data-state":e.stateAttribute,...d,ref:k,onPointerMove:(0,lJ.composeEventHandlers)(a.onPointerMove,a=>{"touch"!==a.pointerType&&(m.current||h.isPointerInTransitRef.current||(e.onTriggerEnter(),m.current=!0))}),onPointerLeave:(0,lJ.composeEventHandlers)(a.onPointerLeave,()=>{e.onTriggerLeave(),m.current=!1}),onPointerDown:(0,lJ.composeEventHandlers)(a.onPointerDown,()=>{e.open&&e.onClose(),l.current=!0,document.addEventListener("pointerup",n,{once:!0})}),onFocus:(0,lJ.composeEventHandlers)(a.onFocus,()=>{l.current||e.onOpen()}),onBlur:(0,lJ.composeEventHandlers)(a.onBlur,e.onClose),onClick:(0,lJ.composeEventHandlers)(a.onClick,e.onClose)})})});l7.displayName=l6;var l8="TooltipPortal",[l9,ma]=lW(l8,{forceMount:void 0}),mb=a=>{let{__scopeTooltip:b,forceMount:c,children:d,container:e}=a,g=l4(l8,b);return(0,f.jsx)(l9,{scope:b,forceMount:c,children:(0,f.jsx)(lQ.Presence,{present:c||g.open,children:(0,f.jsx)(lP.Portal,{asChild:!0,container:e,children:d})})})};mb.displayName=l8;var mc="TooltipContent",md=g.forwardRef((a,b)=>{let c=ma(mc,a.__scopeTooltip),{forceMount:d=c.forceMount,side:e="top",...g}=a,h=l4(mc,a.__scopeTooltip);return(0,f.jsx)(lQ.Presence,{present:d||h.open,children:h.disableHoverableContent?(0,f.jsx)(mi,{side:e,...g,ref:b}):(0,f.jsx)(me,{side:e,...g,ref:b})})}),me=g.forwardRef((a,b)=>{let c=l4(mc,a.__scopeTooltip),d=l0(mc,a.__scopeTooltip),e=g.useRef(null),h=(0,lK.useComposedRefs)(b,e),[i,j]=g.useState(null),{trigger:k,onClose:l}=c,m=e.current,{onPointerInTransitChange:n}=d,o=g.useCallback(()=>{j(null),n(!1)},[n]),p=g.useCallback((a,b)=>{let c,d=a.currentTarget,e={x:a.clientX,y:a.clientY},f=function(a,b){let c=Math.abs(b.top-a.y),d=Math.abs(b.bottom-a.y),e=Math.abs(b.right-a.x),f=Math.abs(b.left-a.x);switch(Math.min(c,d,e,f)){case f:return"left";case e:return"right";case c:return"top";case d:return"bottom";default:throw Error("unreachable")}}(e,d.getBoundingClientRect());j(((c=[...function(a,b,c=5){let d=[];switch(b){case"top":d.push({x:a.x-c,y:a.y+c},{x:a.x+c,y:a.y+c});break;case"bottom":d.push({x:a.x-c,y:a.y-c},{x:a.x+c,y:a.y-c});break;case"left":d.push({x:a.x+c,y:a.y-c},{x:a.x+c,y:a.y+c});break;case"right":d.push({x:a.x-c,y:a.y-c},{x:a.x-c,y:a.y+c})}return d}(e,f),...function(a){let{top:b,right:c,bottom:d,left:e}=a;return[{x:e,y:b},{x:c,y:b},{x:c,y:d},{x:e,y:d}]}(b.getBoundingClientRect())].slice()).sort((a,b)=>a.x<b.x?-1:a.x>b.x?1:a.y<b.y?-1:1*!!(a.y>b.y)),function(a){if(a.length<=1)return a.slice();let b=[];for(let c=0;c<a.length;c++){let d=a[c];for(;b.length>=2;){let a=b[b.length-1],c=b[b.length-2];if((a.x-c.x)*(d.y-c.y)>=(a.y-c.y)*(d.x-c.x))b.pop();else break}b.push(d)}b.pop();let c=[];for(let b=a.length-1;b>=0;b--){let d=a[b];for(;c.length>=2;){let a=c[c.length-1],b=c[c.length-2];if((a.x-b.x)*(d.y-b.y)>=(a.y-b.y)*(d.x-b.x))c.pop();else break}c.push(d)}return(c.pop(),1===b.length&&1===c.length&&b[0].x===c[0].x&&b[0].y===c[0].y)?b:b.concat(c)}(c))),n(!0)},[n]);return g.useEffect(()=>()=>o(),[o]),g.useEffect(()=>{if(k&&m){let a=a=>p(a,m),b=a=>p(a,k);return k.addEventListener("pointerleave",a),m.addEventListener("pointerleave",b),()=>{k.removeEventListener("pointerleave",a),m.removeEventListener("pointerleave",b)}}},[k,m,p,o]),g.useEffect(()=>{if(i){let a=a=>{let b=a.target,c={x:a.clientX,y:a.clientY},d=k?.contains(b)||m?.contains(b),e=!function(a,b){let{x:c,y:d}=a,e=!1;for(let a=0,f=b.length-1;a<b.length;f=a++){let g=b[a],h=b[f],i=g.x,j=g.y,k=h.x,l=h.y;j>d!=l>d&&c<(k-i)*(d-j)/(l-j)+i&&(e=!e)}return e}(c,i);d?o():e&&(o(),l())};return document.addEventListener("pointermove",a),()=>document.removeEventListener("pointermove",a)}},[k,m,i,l,o]),(0,f.jsx)(mi,{...a,ref:h})}),[mf,mg]=lW(l2,{isInside:!1}),mh=(0,lS.createSlottable)("TooltipContent"),mi=g.forwardRef((a,b)=>{let{__scopeTooltip:c,children:d,"aria-label":e,onEscapeKeyDown:h,onPointerDownOutside:i,...j}=a,k=l4(mc,c),l=lY(c),{onClose:m}=k;return g.useEffect(()=>(document.addEventListener(l$,m),()=>document.removeEventListener(l$,m)),[m]),g.useEffect(()=>{if(k.trigger){let a=a=>{let b=a.target;b?.contains(k.trigger)&&m()};return window.addEventListener("scroll",a,{capture:!0}),()=>window.removeEventListener("scroll",a,{capture:!0})}},[k.trigger,m]),(0,f.jsx)(lM.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:h,onPointerDownOutside:i,onFocusOutside:a=>a.preventDefault(),onDismiss:m,children:(0,f.jsxs)(lO.Content,{"data-state":k.stateAttribute,...l,...j,ref:b,style:{...j.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[(0,f.jsx)(mh,{children:d}),(0,f.jsx)(mf,{scope:c,isInside:!0,children:(0,f.jsx)(lV,{id:k.contentId,role:"tooltip",children:e||d})})]})})});md.displayName=mc;var mj="TooltipArrow";g.forwardRef((a,b)=>{let{__scopeTooltip:c,...d}=a,e=lY(c);return mg(mj,c).isInside?null:(0,f.jsx)(lO.Arrow,{...e,...d,ref:b})}).displayName=mj;let mk=g.forwardRef(({className:a,sideOffset:b=4,...c},d)=>(0,f.jsx)(mb,{children:(0,f.jsx)(md,{ref:d,sideOffset:b,className:(0,H.cn)("z-50 overflow-hidden rounded-lg border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-lg","glass-morphism border-white/20","animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...c})}));mk.displayName=md.displayName;let ml=(0,x.default)("Bold",[["path",{d:"M14 12a4 4 0 0 0 0-8H6v8",key:"v2sylx"}],["path",{d:"M15 20a4 4 0 0 0 0-8H6v8Z",key:"1ef5ya"}]]),mm=(0,x.default)("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]),mn=(0,x.default)("Underline",[["path",{d:"M6 4v6a6 6 0 0 0 12 0V4",key:"9kb039"}],["line",{x1:"4",x2:"20",y1:"20",y2:"20",key:"nun2al"}]]),mo=(0,x.default)("Strikethrough",[["path",{d:"M16 4H9a3 3 0 0 0-2.83 4",key:"43sutm"}],["path",{d:"M14 12a4 4 0 0 1 0 8H6",key:"nlfj13"}],["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}]]);var mp=a.i(367329);let mq=(0,x.default)("ListOrdered",[["line",{x1:"10",x2:"21",y1:"6",y2:"6",key:"76qw6h"}],["line",{x1:"10",x2:"21",y1:"12",y2:"12",key:"16nom4"}],["line",{x1:"10",x2:"21",y1:"18",y2:"18",key:"u3jurt"}],["path",{d:"M4 6h1v4",key:"cnovpq"}],["path",{d:"M4 10h2",key:"16xx2s"}],["path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1",key:"m9a95d"}]]);var mr=a.i(80104);let ms=(0,x.default)("AlignCenter",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"17",x2:"7",y1:"12",y2:"12",key:"rsh8ii"}],["line",{x1:"19",x2:"5",y1:"18",y2:"18",key:"1t0tuv"}]]),mt=(0,x.default)("AlignRight",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}],["line",{x1:"21",x2:"7",y1:"18",y2:"18",key:"1g9eri"}]]),mu=(0,x.default)("Undo",[["path",{d:"M3 7v6h6",key:"1v2h90"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13",key:"1r6uu6"}]]),mv=(0,x.default)("Redo",[["path",{d:"M21 7v6h-6",key:"3ptur4"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7",key:"1kgawr"}]]),mw=(0,x.default)("Table",[["path",{d:"M12 3v18",key:"108xh3"}],["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}]]),mx=(0,x.default)("Heading1",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"m17 12 3-2v8",key:"1hhhft"}]]),my=(0,x.default)("Heading2",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M21 18h-4c0-4 4-3 4-6 0-1.5-2-2.5-4-1",key:"9jr5yi"}]]),mz=(0,x.default)("Heading3",[["path",{d:"M4 12h8",key:"17cfdx"}],["path",{d:"M4 18V6",key:"1rz3zl"}],["path",{d:"M12 18V6",key:"zqpxq5"}],["path",{d:"M17.5 10.5c1.7-1 3.5 0 3.5 1.5a2 2 0 0 1-2 2",key:"68ncm8"}],["path",{d:"M17 17.5c2 1.5 4 .3 4-1.5a2 2 0 0 0-2-2",key:"1ejuhz"}]]);var mA=a.i(134148),mB=a.i(808406);let mC=(0,x.default)("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);var mD=a.i(838632),mE=a.i(501027);let mF=(0,x.default)("Droplet",[["path",{d:"M12 22a7 7 0 0 0 7-7c0-2-1-3.9-3-5.5s-3.5-4-4-6.5c-.5 2.5-2 4.9-4 6.5C6 11.1 5 13 5 15a7 7 0 0 0 7 7z",key:"c7niix"}]]),mG=(0,g.forwardRef)(function({value:a,onChange:b,placeholder:c="Saisissez votre texte...",className:d,readOnly:e=!1,height:h=500,fontFamily:i,onFontFamilyChange:j,onTableEditorOpen:k,onShapeEditorOpen:l,onElementPaletteOpen:m,onQuickTemplatesOpen:o,onStylePaletteOpen:p,onWatermarkEditorOpen:q,onSignatureFieldOpen:r,onMapEmbedOpen:s,onAttachmentEmbedOpen:t},u){let[v,w]=(0,g.useState)(!1),[x,y]=(0,g.useState)(i||"Inter"),[z,A]=(0,g.useState)("12");(0,g.useEffect)(()=>{w(!0)},[]);let B=gM.create({name:"fontFamily",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:a=>a.style.fontFamily?.replace(/['"]+/g,""),renderHTML:a=>a.fontFamily?{style:`font-family: ${a.fontFamily}`}:{}}}}]},addCommands:()=>({setFontFamily:a=>({chain:b})=>b().setMark("textStyle",{fontFamily:a}).run(),unsetFontFamily:()=>({chain:a})=>a().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()})}),C=gM.create({name:"fontSize",addOptions:()=>({types:["textStyle"]}),addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:a=>a.style.fontSize?.replace(/px|pt|em|rem/g,""),renderHTML:a=>a.fontSize?{style:`font-size: ${a.fontSize}pt`}:{}}}}]},addCommands:()=>({setFontSize:a=>({chain:b})=>b().setMark("textStyle",{fontSize:a}).run(),unsetFontSize:()=>({chain:a})=>a().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()})}),D=function(a={},b=[]){let c=(0,K.useRef)(a);c.current=a;let[d]=(0,K.useState)(()=>new ho(c)),e=(0,M.useSyncExternalStore)(d.subscribe,d.getEditor,d.getServerSnapshot);return(0,K.useDebugValue)(e),(0,K.useEffect)(d.onRender(b)),!function(a){var b;let[c]=(0,K.useState)(()=>new hn(a.editor)),d=(0,hh.useSyncExternalStoreWithSelector)(c.subscribe,c.getSnapshot,c.getServerSnapshot,a.selector,null!=(b=a.equalityFn)?b:hg.deepEqual);hm(()=>c.watch(a.editor),[a.editor,c]),(0,K.useDebugValue)(d)}({editor:e,selector:({transactionNumber:b})=>!1===a.shouldRerenderOnTransaction||void 0===a.shouldRerenderOnTransaction?null:a.immediatelyRender&&0===b?0:b+1}),e}({immediatelyRender:!1,extensions:[kq.configure({heading:{levels:[1,2,3,4,5,6]},underline:!1}),jW,lm.configure({types:["heading","paragraph"]}),lo,B,C,lq,ll.configure({resizable:!0,HTMLAttributes:{class:"tiptap-table",style:"width: 100%; border-collapse: collapse; margin: 15px 0; border: 2px solid #335ACF; border-radius: 6px; overflow: hidden; box-shadow: 0 2px 8px rgba(51, 90, 207, 0.1);"}}),le,ld,lc,lv.extend({addAttributes(){return{...this.parent?.(),"data-logo-var":{default:null,parseHTML:a=>{let b=a.getAttribute("data-logo-var");return b?{"data-logo-var":b,src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='55'%3E%3Crect width='140' height='55' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' font-family='Arial' font-size='10' fill='%23999'%3ELogo%3C/text%3E%3C/svg%3E"}:null},renderHTML:a=>a["data-logo-var"]?{"data-logo-var":a["data-logo-var"],src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='55'%3E%3Crect width='140' height='55' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' font-family='Arial' font-size='10' fill='%23999'%3ELogo%3C/text%3E%3C/svg%3E"}:{}}}},parseHTML:()=>[{tag:"img[data-logo-var]",getAttrs:a=>{if("string"==typeof a)return!1;let b=a.getAttribute("data-logo-var");return!!b&&{"data-logo-var":b,src:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='140' height='55'%3E%3Crect width='140' height='55' fill='%23f0f0f0'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' font-family='Arial' font-size='10' fill='%23999'%3ELogo%3C/text%3E%3C/svg%3E"}}},{tag:"img"}]}).configure({inline:!1,allowBase64:!0,HTMLAttributes:{class:"tiptap-image"}}),ly,lI],content:a,editable:!e,onUpdate:({editor:a})=>{b(a.getHTML())},editorProps:{attributes:{class:"document-editor focus:outline-none",style:`min-height: ${h}px;`,"data-placeholder":c},parseOptions:{preserveWhitespace:"full"},handleDrop:(a,b,c,d)=>{if(d)return!1;let e=b.dataTransfer?.getData("application/x-variable-id"),f=b.dataTransfer?.getData("application/x-variable-label"),g=b.dataTransfer?.getData("application/x-variable-value");if(e&&f&&g){b.preventDefault();let c=a.posAtCoords({left:b.clientX,top:b.clientY});if(c){let{schema:b}=a.state;if(b.nodes.variable){let d=b.nodes.variable.create({id:e,label:f,value:g}),h=a.state.tr.insert(c.pos,d);a.dispatch(h)}else{let{tr:b}=a.state;b.insertText(g,c.pos),a.dispatch(b)}return!0}}return!1},handleDOMEvents:{dragover:(a,b)=>!!b.dataTransfer?.types.includes("application/x-variable-id")&&(b.preventDefault(),b.dataTransfer.dropEffect="copy",!0),dragenter:(a,b)=>!!b.dataTransfer?.types.includes("application/x-variable-id")&&(b.preventDefault(),!0)}}});return((0,g.useEffect)(()=>{D&&a!==D.getHTML()&&Promise.resolve().then(()=>{D.commands.setContent(a,!1)})},[a,D]),(0,g.useEffect)(()=>{i&&i!==x&&y(i)},[i]),(0,g.useEffect)(()=>{if(!D)return;let a=()=>{let{from:a,to:b}=D.state.selection;if(a===b)return void y(i||"Inter");let c=(D.state.storedMarks||D.state.selection.$from.marks()).find(a=>"textStyle"===a.type.name&&a.attrs.fontFamily);c?y(c.attrs.fontFamily):y(i||"Inter")};return D.on("selectionUpdate",a),D.on("transaction",a),()=>{D.off("selectionUpdate",a),D.off("transaction",a)}},[D,i]),(0,g.useImperativeHandle)(u,()=>({getEditor:()=>D,insertVariable:a=>{if(D){let b=a.replace(/[{}]/g,"");try{D.chain().focus().insertVariable({id:b,label:b,value:`{${b}}`}).run()}catch{D.chain().focus().insertContent(`<span data-type="variable" data-id="${b}" data-label="${b}" data-value="{${b}}" style="background-color: #DBEAFE; color: #1E40AF; padding: 2px 8px; border-radius: 4px; border: 1px solid #93C5FD; font-size: 0.875em; font-weight: 500;">{${b}}</span>`).run()}}},insertVariableNode:(a,b,c)=>{if(D)try{D.chain().focus().insertVariable({id:a,label:b,value:c}).run()}catch{D.chain().focus().insertContent(`<span data-type="variable" data-id="${a}" data-label="${b}" data-value="${c}" style="background-color: #DBEAFE; color: #1E40AF; padding: 2px 8px; border-radius: 4px; border: 1px solid #93C5FD; font-size: 0.875em; font-weight: 500;">${b}</span>`).run()}},insertConditionalBlock:(a="if")=>{if(D)try{D.chain().focus().insertConditionalBlock({type:a}).run()}catch{let b={if:{border:"#14B8A6",bg:"#F0FDFA",label:"SI"},elseif:{border:"#F59E0B",bg:"#FFFBEB",label:"SINON SI"},else:{border:"#3B82F6",bg:"#EFF6FF",label:"SINON"}}[a];D.chain().focus().insertContent(`<div style="border: 2px solid ${b.border}; background-color: ${b.bg}; padding: 16px; margin: 16px 0; border-radius: 8px;">
                <div style="font-size: 12px; font-weight: 600; color: ${b.border}; margin-bottom: 8px;">${b.label} : Condition...</div>
                <p>Contenu conditionnel...</p>
              </div>`).run()}},insertHTML:a=>{D&&D.chain().focus().insertContent(a).run()},insertTable:(a=3,b=3)=>{D&&D.chain().focus().insertTable({rows:a,cols:b,withHeaderRow:!0}).run()},insertBorderedFrame:a=>{if(D){let b=a?.borderStyle||"solid",c=a?.borderWidth||2,d=a?.borderColor||"#335ACF",e=a?.backgroundColor||"#F9FAFB",f=a?.padding||15,g=`<div style="border: ${c}px ${b} ${d}; background-color: ${e}; padding: ${f}px; margin: 15px 0; border-radius: 6px; min-height: 80px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
  <p style="margin: 0; color: #4B5563; font-size: 14px; line-height: 1.6;">Contenu du cadre...</p>
</div>`;D.chain().focus().insertContent(g).run()}},insertFramedSection:(a="Titre de la section",b="#335ACF")=>{D&&D.chain().focus().insertContent(`<div style="border: 2px solid ${b}; background-color: #F9FAFB; margin: 15px 0; border-radius: 6px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
  <div style="background: linear-gradient(135deg, ${b} 0%, ${b}dd 100%); padding: 12px 15px; border-bottom: 2px solid ${b};">
    <h3 style="margin: 0; color: white; font-size: 14px; font-weight: 600;">${a}</h3>
  </div>
  <div style="padding: 15px; min-height: 50px;">
    <p style="margin: 0; color: #374151; font-size: 14px; line-height: 1.5;">Contenu de la section...</p>
  </div>
</div>`).run()},insertAdminTable:(a=["Champ","Valeur"],b=3)=>{if(D){let c='<table style="width: 100%; border-collapse: collapse; margin: 15px 0; border: 2px solid #335ACF; box-shadow: 0 2px 8px rgba(0,0,0,0.08); background-color: white;"><thead><tr style="background: linear-gradient(135deg, #335ACF 0%, #1E40AF 100%);">';a.forEach(a=>{c+=`<th style="padding: 12px 15px; border: 1px solid rgba(255,255,255,0.3); text-align: left; font-weight: 600; color: white;">${a}</th>`}),c+="</tr></thead><tbody>";for(let d=0;d<b;d++){let b=d%2==0?"#FAFBFC":"#FFFFFF";c+=`<tr style="background-color: ${b};">`,a.forEach((a,b)=>{let e=0===b?`Ligne ${d+1}`:`Valeur ${d+1}-${b+1}`;c+=`<td style="padding: 10px 15px; border: 1px solid #E5E7EB; font-size: 13px; color: #374151;">${e}</td>`}),c+="</tr>"}c+="</tbody></table>",D.chain().focus().insertContent(c).run()}},insertHTML:a=>{if(D)try{console.log("Tiptap insertHTML appel avec:",a);let b=a.trim();if(!b)return void console.warn("HTML vide, insertion annule");let c=b.match(/<img[^>]+src="([^"]+)"[^>]*>/i);if(c&&c[1]){let a=c[1],d=b.match(/alt="([^"]*)"/i)?.[1]||"Image",e=b.match(/width="(\d+)"/i),f=b.match(/height="(\d+)"/i);console.log("Dtection d'une image, utilisation de la commande setImage:",{imgSrc:a,imgAlt:d,width:e?.[1],height:f?.[1]}),D.chain().focus().setImage({src:a,alt:d,width:e?parseInt(e[1]):void 0,height:f?parseInt(f[1]):void 0}).run(),console.log(" Image insre via setImage");return}if(b.match(/<hr[^>]*>/i)){console.log("Dtection d'un horizontal rule");let a=b.match(/style="([^"]*)"/i);if(a?a[1]:""){console.log("HR avec styles dtect, utilisation de insertContent pour prserver les styles");let a=D.chain().focus().insertContent(b).run();console.log("Rsultat insertContent pour HR:",a),setTimeout(()=>{let a=D.getHTML();if(a.includes("<hr")||a.toLowerCase().includes("horizontalrule"))console.log(" Horizontal rule stylis confirm dans l'diteur");else{console.warn(" Horizontal rule non dtect aprs insertion, utilisation de la mthode alternative");let a=D.getHTML(),c=new DOMParser().parseFromString(`<div>${a}</div>`,"text/html").querySelector("div");c&&(c.insertAdjacentHTML("beforeend",b),D.commands.setContent(c.innerHTML),console.log(" Horizontal rule insr via mthode alternative"))}},100);return}try{if(D.can().setHorizontalRule()){D.chain().focus().setHorizontalRule().run(),console.log(" Horizontal rule insr via setHorizontalRule");return}}catch(a){console.warn("setHorizontalRule non disponible, utilisation de insertContent:",a)}}document.createElement("div").innerHTML=b;try{console.log("Tentative d'insertion directe du HTML");let a=D.chain().focus().insertContent(b).run();console.log("Rsultat insertContent:",a),setTimeout(()=>{let a=D.getHTML();console.log("HTML actuel aprs insertion (premiers 300 caractres):",a.substring(0,300));let c=b.toLowerCase().replace(/\s+/g," "),d=a.toLowerCase().replace(/\s+/g," "),e=d.includes("data:image"),f=d.includes("<img")||d.includes("img src"),g=d.includes("svg")||d.includes("base64"),h=d.includes("<hr")||d.includes("horizontalrule"),i=e||f||g||h||d.includes(c.substring(0,30));if(console.log("Vrification insertion - HTML cherch:",c.substring(0,50)),console.log("Vrification insertion - data:image:",e,"img tag:",f,"svg:",g,"hr:",h),console.log("Vrification insertion - Trouv:",i),console.log("HTML complet actuel:",a),i)console.log(" HTML insr avec succs via insertContent");else{console.warn("Le HTML n'a pas t insr correctement, utilisation d'une mthode alternative");try{let a=D.getHTML(),c=new DOMParser().parseFromString(`<div>${a}</div>`,"text/html").querySelector("div");if(c){let a=document.createElement("div");a.innerHTML=b,a.firstElementChild?c.appendChild(a.firstElementChild):c.insertAdjacentHTML("beforeend",b);let d=c.innerHTML;D.commands.setContent(d),console.log(" HTML insr via mthode alternative")}}catch(a){console.error("Erreur lors de la mthode alternative:",a)}}},150)}catch(a){console.error("Erreur lors de l'insertion:",a);try{let a=D.getHTML();D.commands.setContent(a+b)}catch(a){console.error("Erreur lors du fallback final:",a)}}}catch(b){console.error("Erreur lors de l'insertion HTML:",b,a);try{D.chain().focus().insertContent(a).run()}catch(b){console.error("Erreur lors de l'insertion directe:",b);try{let b=D.getHTML()+a;D.commands.setContent(b)}catch(a){console.error("Erreur lors du fallback final:",a)}}}else console.error("Editor non disponible pour insertHTML")}}),[D]),v&&D)?(0,f.jsx)(l1,{delayDuration:300,children:(0,f.jsxs)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" "+((0,H.cn)("tiptap-editor border rounded-lg overflow-hidden bg-white",d)||""),children:[!e&&(0,f.jsxs)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" flex flex-wrap items-center gap-1 p-2 border-b bg-gradient-to-r from-gray-50 to-white",children:[(0,f.jsx)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" flex items-center gap-1 border-r pr-2 mr-2",children:(0,f.jsxs)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" flex items-center gap-1",children:[(0,f.jsx)(mA.Type,{className:"h-4 w-4 text-gray-500"}),(0,f.jsxs)("select",{value:x,onChange:a=>{let b=a.target.value;y(b),D&&(D.state.selection.empty,D.chain().focus().setFontFamily(b).run()),j&&setTimeout(()=>j(b),0)},title:"Choisir la police (applique au texte slectionn)",className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" h-8 px-2 text-xs border rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary min-w-[120px]",children:[(0,f.jsx)("option",{value:"Inter",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Inter"}),(0,f.jsx)("option",{value:"Arial",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Arial"}),(0,f.jsx)("option",{value:"Times New Roman",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Times New Roman"}),(0,f.jsx)("option",{value:"Courier New",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Courier New"}),(0,f.jsx)("option",{value:"Georgia",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Georgia"}),(0,f.jsx)("option",{value:"Verdana",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Verdana"}),(0,f.jsx)("option",{value:"Helvetica",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Helvetica"}),(0,f.jsx)("option",{value:"Calibri",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Calibri"}),(0,f.jsx)("option",{value:"Comic Sans MS",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Comic Sans MS"}),(0,f.jsx)("option",{value:"Trebuchet MS",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Trebuchet MS"})]})]})}),(0,f.jsx)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" flex items-center gap-1 border-r pr-2 mr-2",children:(0,f.jsxs)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" flex items-center gap-1",children:[(0,f.jsx)("span",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-500",children:"Taille"}),(0,f.jsxs)("select",{value:z,onChange:a=>{let b=a.target.value;A(b),D&&(D.state.selection.empty,D.chain().focus().setFontSize(b).run())},title:"Choisir la taille de police (applique au texte slectionn)",className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" h-8 px-2 text-xs border rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-primary/20 focus:border-primary min-w-[70px]",children:[(0,f.jsx)("option",{value:"8",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"8pt"}),(0,f.jsx)("option",{value:"9",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"9pt"}),(0,f.jsx)("option",{value:"10",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"10pt"}),(0,f.jsx)("option",{value:"11",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"11pt"}),(0,f.jsx)("option",{value:"12",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"12pt"}),(0,f.jsx)("option",{value:"14",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"14pt"}),(0,f.jsx)("option",{value:"16",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"16pt"}),(0,f.jsx)("option",{value:"18",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"18pt"}),(0,f.jsx)("option",{value:"20",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"20pt"}),(0,f.jsx)("option",{value:"24",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"24pt"}),(0,f.jsx)("option",{value:"28",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"28pt"}),(0,f.jsx)("option",{value:"32",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"32pt"}),(0,f.jsx)("option",{value:"36",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"36pt"}),(0,f.jsx)("option",{value:"48",className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"48pt"})]})]})}),(0,f.jsxs)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" flex items-center gap-1 border-r pr-2 mr-2",children:[(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().undo().run(),disabled:!D.can().undo(),className:"h-8 w-8 p-0",children:(0,f.jsx)(mu,{className:"h-4 w-4"})})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Annuler"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Ctrl+Z"})]})]}),(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().redo().run(),disabled:!D.can().redo(),className:"h-8 w-8 p-0",children:(0,f.jsx)(mv,{className:"h-4 w-4"})})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Refaire"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Ctrl+Shift+Z"})]})]})]}),(0,f.jsxs)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" flex items-center gap-1 border-r pr-2 mr-2",children:[(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().toggleHeading({level:1}).run(),className:(0,H.cn)("h-8 w-8 p-0 transition-all",D.isActive("heading",{level:1})&&"bg-brand-blue-ghost text-brand-blue shadow-sm"),children:(0,f.jsx)(mx,{className:"h-4 w-4"})})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Titre 1"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Ctrl+Alt+1"})]})]}),(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().toggleHeading({level:2}).run(),className:(0,H.cn)("h-8 w-8 p-0 transition-all",D.isActive("heading",{level:2})&&"bg-brand-blue-ghost text-brand-blue shadow-sm"),children:(0,f.jsx)(my,{className:"h-4 w-4"})})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Titre 2"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Ctrl+Alt+2"})]})]}),(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().toggleHeading({level:3}).run(),className:(0,H.cn)("h-8 w-8 p-0 transition-all",D.isActive("heading",{level:3})&&"bg-brand-blue-ghost text-brand-blue shadow-sm"),children:(0,f.jsx)(mz,{className:"h-4 w-4"})})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Titre 3"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Ctrl+Alt+3"})]})]})]}),(0,f.jsxs)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" flex items-center gap-1 border-r pr-2 mr-2",children:[(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().toggleBold().run(),className:(0,H.cn)("h-8 w-8 p-0 transition-all",D.isActive("bold")&&"bg-brand-blue-ghost text-brand-blue shadow-sm"),children:(0,f.jsx)(ml,{className:"h-4 w-4"})})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Gras"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Ctrl+B"})]})]}),(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().toggleItalic().run(),className:(0,H.cn)("h-8 w-8 p-0 transition-all",D.isActive("italic")&&"bg-brand-blue-ghost text-brand-blue shadow-sm"),children:(0,f.jsx)(mm,{className:"h-4 w-4"})})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Italique"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Ctrl+I"})]})]}),(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().toggleUnderline().run(),className:(0,H.cn)("h-8 w-8 p-0 transition-all",D.isActive("underline")&&"bg-brand-blue-ghost text-brand-blue shadow-sm"),children:(0,f.jsx)(mn,{className:"h-4 w-4"})})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Soulign"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Ctrl+U"})]})]}),(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().toggleStrike().run(),className:(0,H.cn)("h-8 w-8 p-0 transition-all",D.isActive("strike")&&"bg-brand-blue-ghost text-brand-blue shadow-sm"),children:(0,f.jsx)(mo,{className:"h-4 w-4"})})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Barr"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Ctrl+Shift+X"})]})]})]}),(0,f.jsxs)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" flex items-center gap-1 border-r pr-2 mr-2",children:[(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().toggleBulletList().run(),className:(0,H.cn)("h-8 w-8 p-0 transition-all",D.isActive("bulletList")&&"bg-brand-blue-ghost text-brand-blue shadow-sm"),children:(0,f.jsx)(mp.List,{className:"h-4 w-4"})})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Liste  puces"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Ctrl+Shift+8"})]})]}),(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().toggleOrderedList().run(),className:(0,H.cn)("h-8 w-8 p-0 transition-all",D.isActive("orderedList")&&"bg-brand-blue-ghost text-brand-blue shadow-sm"),children:(0,f.jsx)(mq,{className:"h-4 w-4"})})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Liste numrote"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Ctrl+Shift+7"})]})]})]}),(0,f.jsxs)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" flex items-center gap-1 border-r pr-2 mr-2",children:[(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().setTextAlign("left").run(),className:(0,H.cn)("h-8 w-8 p-0 transition-all",D.isActive({textAlign:"left"})&&"bg-brand-blue-ghost text-brand-blue shadow-sm"),children:(0,f.jsx)(mr.AlignLeft,{className:"h-4 w-4"})})}),(0,f.jsx)(mk,{children:(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Aligner  gauche"})})]}),(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().setTextAlign("center").run(),className:(0,H.cn)("h-8 w-8 p-0 transition-all",D.isActive({textAlign:"center"})&&"bg-brand-blue-ghost text-brand-blue shadow-sm"),children:(0,f.jsx)(ms,{className:"h-4 w-4"})})}),(0,f.jsx)(mk,{children:(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Centrer"})})]}),(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>D.chain().focus().setTextAlign("right").run(),className:(0,H.cn)("h-8 w-8 p-0 transition-all",D.isActive({textAlign:"right"})&&"bg-brand-blue-ghost text-brand-blue shadow-sm"),children:(0,f.jsx)(mt,{className:"h-4 w-4"})})}),(0,f.jsx)(mk,{children:(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Aligner  droite"})})]})]}),(o||k||l||m)&&(0,f.jsxs)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" flex items-center gap-1",children:[(0,f.jsxs)("div",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" flex items-center gap-1 px-2 border-r pr-2 mr-2",children:[(0,f.jsx)(mB.Sparkles,{className:"h-4 w-4 text-brand-blue"}),(0,f.jsx)("span",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs font-medium text-gray-600 hidden sm:inline",children:"Premium"})]}),o&&(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsxs)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:o,className:"h-8 px-2 gap-1 transition-all hover:bg-brand-blue-ghost",children:[(0,f.jsx)(mE.Zap,{className:"h-4 w-4"}),(0,f.jsx)("span",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs hidden sm:inline",children:"Templates"})]})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Templates rapides"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Insrer des structures prdfinies"})]})]}),k&&(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsxs)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:k,className:"h-8 px-2 gap-1 transition-all hover:bg-brand-blue-ghost",children:[(0,f.jsx)(mw,{className:"h-4 w-4"}),(0,f.jsx)("span",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs hidden sm:inline",children:"Tableau"})]})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"diteur de tableau premium"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Crer et personnaliser des tableaux"})]})]}),l&&(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsxs)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:l,className:"h-8 px-2 gap-1 transition-all hover:bg-brand-blue-ghost",children:[(0,f.jsx)(mC,{className:"h-4 w-4"}),(0,f.jsx)("span",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs hidden sm:inline",children:"Forme"})]})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"diteur de formes"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Insrer des formes gomtriques"})]})]}),m&&(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsxs)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:m,className:"h-8 px-2 gap-1 transition-all hover:bg-brand-blue-ghost",children:[(0,f.jsx)(mD.Image,{className:"h-4 w-4"}),(0,f.jsx)("span",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs hidden sm:inline",children:"lment"})]})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Palette d'lments"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Images, QR codes, codes-barres, etc."})]})]}),p&&(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsxs)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:p,className:"h-8 px-2 gap-1 transition-all hover:bg-brand-blue-ghost",children:[(0,f.jsx)(mA.Type,{className:"h-4 w-4"}),(0,f.jsx)("span",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs hidden sm:inline",children:"Styles"})]})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Styles prdfinis"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Appliquer des styles de paragraphe"})]})]}),q&&(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsxs)(n.Button,{type:"button",variant:"ghost",size:"sm",onClick:q,className:"h-8 px-2 gap-1 transition-all hover:bg-brand-blue-ghost",children:[(0,f.jsx)(mF,{className:"h-4 w-4"}),(0,f.jsx)("span",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs hidden sm:inline",children:"Filigrane"})]})}),(0,f.jsxs)(mk,{children:[(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]]),children:"Filigrane"}),(0,f.jsx)("p",{className:J.default.dynamic([["ac6c869678541b8e",[h]]])+" text-xs text-gray-400",children:"Ajouter un filigrane au document"})]})]})]})]}),(0,f.jsx)(hl,{editor:D,className:"prose-editor"}),(0,f.jsx)(J.default,{id:"ac6c869678541b8e",dynamic:[h],children:`.tiptap-editor .ProseMirror{min-height:${h}px;outline:none}.tiptap-editor .ProseMirror p.is-editor-empty:first-child:before{content:attr(data-placeholder);float:left;color:#9ca3af;pointer-events:none;height:0}.tiptap-editor .ProseMirror:focus{outline:none}.tiptap-editor .ProseMirror table{border-collapse:collapse;table-layout:fixed;border-radius:6px;width:100%;margin:18pt 0;overflow:hidden;box-shadow:0 1px 3px #0000001a}.tiptap-editor .ProseMirror table td,.tiptap-editor .ProseMirror table th{vertical-align:top;box-sizing:border-box;border:1px solid #e5e7eb;min-width:1em;padding:10pt 12pt;position:relative}.tiptap-editor .ProseMirror table th{text-align:left;color:#fff;background-color:#335acf;font-weight:600}.tiptap-editor .ProseMirror table td{color:#374151;background-color:#fff}.tiptap-editor .ProseMirror table tr:nth-child(2n) td{background-color:#f9fafb}.tiptap-editor .ProseMirror table .selectedCell:after{z-index:2;content:"";pointer-events:none;background:#c8c8ff66;position:absolute;inset:0}.tiptap-editor .ProseMirror table .column-resize-handle{pointer-events:none;background-color:#335acf;width:4px;position:absolute;top:0;bottom:-2px;right:-2px}.tiptap-editor .ProseMirror div[style*=border]{margin:18pt 0;display:block}.tiptap-editor .ProseMirror span[style*="background-color: #E0F2FE"]{display:inline-block}`})]})}):(0,f.jsx)("div",{className:(0,H.cn)("h-[400px] border rounded-lg bg-gray-50 animate-pulse",d)})});mG.displayName="TiptapEditor";let mH=(0,g.forwardRef)(function({onChange:a,...b},c){let d=(0,g.useRef)(null);return(0,g.useImperativeHandle)(c,()=>({insertVariable:a=>{d.current&&d.current.insertVariable(a)},insertVariableNode:(a,b,c)=>{d.current&&d.current.insertVariableNode(a,b,c)},insertConditionalBlock:(a="if")=>{d.current&&d.current.insertConditionalBlock(a)},getEditor:()=>d.current?.getEditor(),insertTable:(a=3,b=3)=>{d.current&&d.current.insertTable(a,b)},insertTableWithProperties:a=>{d.current&&d.current.insertTable(a.rows||3,a.cols||3)},insertBorderedFrame:a=>{d.current&&d.current.insertBorderedFrame(a)},insertFramedSection:(a,b)=>{d.current&&d.current.insertFramedSection(a,b)},insertAdminTable:(a,b)=>{d.current&&d.current.insertAdminTable(a,b)},insertHTML:a=>{d.current&&d.current.insertHTML(a)}}),[]),(0,f.jsx)(mG,{ref:d,...b,onChange:a||(()=>{})})});mH.displayName="RichTextEditor";var mI=a.i(676504);let mJ=(0,x.default)("Box",[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]]),mK=(0,x.default)("Columns",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["line",{x1:"12",x2:"12",y1:"3",y2:"21",key:"1efggb"}]]);var mL=a.i(965733),mM=a.i(205522),mN=a.i(887682);function mO({open:a,onOpenChange:b,editorRef:c,onInsert:d}){let[e,h]=(0,g.useState)({rows:3,cols:3,width:100,height:void 0,headers:"first-row",cellSpacing:1,borderSize:1,cellPadding:8,alignment:"undefined",title:"",summary:""});return(0,f.jsx)(mL.Dialog,{open:a,onOpenChange:b,children:(0,f.jsxs)(mL.DialogContent,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[(0,f.jsxs)(mL.DialogHeader,{children:[(0,f.jsx)(mL.DialogTitle,{children:"Proprits du tableau"}),(0,f.jsx)(mL.DialogDescription,{children:"Configurez les proprits du tableau avant de l'insrer dans le document."})]}),(0,f.jsxs)("div",{className:"space-y-4 py-4",children:[(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{htmlFor:"rows",children:"Lignes"}),(0,f.jsx)(mM.Input,{id:"rows",type:"number",min:"1",max:"20",value:e.rows,onChange:a=>h({...e,rows:parseInt(a.target.value)||1})})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{htmlFor:"cols",children:"Colonnes"}),(0,f.jsx)(mM.Input,{id:"cols",type:"number",min:"1",max:"10",value:e.cols,onChange:a=>h({...e,cols:parseInt(a.target.value)||1})})]})]}),(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{htmlFor:"width",children:"Largeur"}),(0,f.jsx)(mM.Input,{id:"width",type:"number",min:"0",max:"100",value:e.width||"",onChange:a=>h({...e,width:a.target.value?parseInt(a.target.value):void 0}),placeholder:"100"}),(0,f.jsx)("p",{className:"text-xs text-text-tertiary",children:"% (0-100)"})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{htmlFor:"height",children:"Hauteur"}),(0,f.jsx)(mM.Input,{id:"height",type:"number",min:"0",value:e.height||"",onChange:a=>h({...e,height:a.target.value?parseInt(a.target.value):void 0}),placeholder:"Auto"}),(0,f.jsx)("p",{className:"text-xs text-text-tertiary",children:"px (optionnel)"})]})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{htmlFor:"headers",children:"En-ttes"}),(0,f.jsxs)(mN.SelectRoot,{value:e.headers,onValueChange:a=>h({...e,headers:a}),children:[(0,f.jsx)(mN.SelectTrigger,{id:"headers",children:(0,f.jsx)(mN.SelectValue,{})}),(0,f.jsxs)(mN.SelectContent,{children:[(0,f.jsx)(mN.SelectItem,{value:"none",children:"Aucun"}),(0,f.jsx)(mN.SelectItem,{value:"first-row",children:"Premire ligne"}),(0,f.jsx)(mN.SelectItem,{value:"first-col",children:"Premire colonne"}),(0,f.jsx)(mN.SelectItem,{value:"both",children:"Premire ligne et colonne"})]})]})]}),(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{htmlFor:"cellSpacing",children:"Espacement entre les cellules"}),(0,f.jsx)(mM.Input,{id:"cellSpacing",type:"number",min:"0",max:"10",value:e.cellSpacing,onChange:a=>h({...e,cellSpacing:parseInt(a.target.value)||0})}),(0,f.jsx)("p",{className:"text-xs text-text-tertiary",children:"px (0-10)"})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{htmlFor:"borderSize",children:"Taille de la bordure"}),(0,f.jsx)(mM.Input,{id:"borderSize",type:"number",min:"0",max:"5",value:e.borderSize,onChange:a=>h({...e,borderSize:parseInt(a.target.value)||0})}),(0,f.jsx)("p",{className:"text-xs text-text-tertiary",children:"px (0-5)"})]})]}),(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{htmlFor:"cellPadding",children:"Marge interne des cellules"}),(0,f.jsx)(mM.Input,{id:"cellPadding",type:"number",min:"0",max:"20",value:e.cellPadding,onChange:a=>h({...e,cellPadding:parseInt(a.target.value)||0})}),(0,f.jsx)("p",{className:"text-xs text-text-tertiary",children:"px (0-20)"})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{htmlFor:"alignment",children:"Alignement"}),(0,f.jsxs)(mN.SelectRoot,{value:e.alignment,onValueChange:a=>h({...e,alignment:a}),children:[(0,f.jsx)(mN.SelectTrigger,{id:"alignment",children:(0,f.jsx)(mN.SelectValue,{})}),(0,f.jsxs)(mN.SelectContent,{children:[(0,f.jsx)(mN.SelectItem,{value:"undefined",children:"Indfini"}),(0,f.jsx)(mN.SelectItem,{value:"left",children:"Gauche"}),(0,f.jsx)(mN.SelectItem,{value:"center",children:"Centre"}),(0,f.jsx)(mN.SelectItem,{value:"right",children:"Droite"})]})]})]})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{htmlFor:"title",children:"Titre du tableau"}),(0,f.jsx)(mM.Input,{id:"title",type:"text",value:e.title||"",onChange:a=>h({...e,title:a.target.value}),placeholder:"Titre du tableau (optionnel)"})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{htmlFor:"summary",children:"Rsum (description)"}),(0,f.jsx)(mM.Input,{id:"summary",type:"text",value:e.summary||"",onChange:a=>h({...e,summary:a.target.value}),placeholder:"Description du tableau (optionnel)"})]})]}),(0,f.jsxs)(mL.DialogFooter,{children:[(0,f.jsx)(n.Button,{variant:"outline",onClick:()=>b(!1),children:"Annuler"}),(0,f.jsx)(n.Button,{onClick:()=>{d(e),b(!1)},children:"OK"})]})]})})}function mP({editorRef:a}){let[b,c]=(0,g.useState)(!1),d=(b,c)=>{if(a.current)try{a.current.insertTable(b,c)}catch(a){console.error("Error inserting table:",a)}},e=b=>{if(a.current)try{a.current.insertBorderedFrame({simple:{borderStyle:"solid",borderWidth:2,borderColor:"#E5E7EB",backgroundColor:"#F9FAFB",padding:15},colored:{borderStyle:"solid",borderWidth:2,borderColor:"#335ACF",backgroundColor:"#EFF6FF",padding:15},gradient:{borderStyle:"solid",borderWidth:2,borderColor:"#335ACF",backgroundColor:"#F0F9FF",padding:20}}[b])}catch(a){console.error("Error inserting frame:",a)}},h=b=>{if(a.current)try{a.current.insertFramedSection("Titre de la section",b)}catch(a){console.error("Error inserting section:",a)}};return(0,f.jsxs)("div",{className:"flex items-center gap-2 p-2 border-b border-bg-gray-200 bg-bg-gray-50",children:[(0,f.jsxs)(mI.DropdownMenu,{children:[(0,f.jsx)(mI.DropdownMenuTrigger,{asChild:!0,children:(0,f.jsxs)(n.Button,{variant:"outline",size:"sm",className:"gap-2",children:[(0,f.jsx)(mw,{className:"h-4 w-4"}),"Tableau"]})}),(0,f.jsxs)(mI.DropdownMenuContent,{align:"start",className:"w-56",children:[(0,f.jsx)(mI.DropdownMenuLabel,{children:"Insrer un tableau"}),(0,f.jsx)(mI.DropdownMenuSeparator,{}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>c(!0),children:[(0,f.jsx)(mw,{className:"h-4 w-4 mr-2"}),"Proprits du tableau..."]}),(0,f.jsx)(mI.DropdownMenuSeparator,{}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>d(2,2),children:[(0,f.jsx)(mw,{className:"h-4 w-4 mr-2"}),"2x2 (rapide)"]}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>d(3,3),children:[(0,f.jsx)(mw,{className:"h-4 w-4 mr-2"}),"3x3 (rapide)"]}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>d(4,4),children:[(0,f.jsx)(mw,{className:"h-4 w-4 mr-2"}),"4x4 (rapide)"]}),(0,f.jsx)(mI.DropdownMenuSeparator,{}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>d(3,2),children:[(0,f.jsx)(mK,{className:"h-4 w-4 mr-2"}),"3 lignes, 2 colonnes"]}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>d(5,2),children:[(0,f.jsx)(mK,{className:"h-4 w-4 mr-2"}),"5 lignes, 2 colonnes"]}),(0,f.jsx)(mI.DropdownMenuSeparator,{}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>((b,c)=>{if(a.current)try{a.current.insertAdminTable(b,c)}catch(a){console.error("Error inserting admin table:",a)}})(["Champ","Valeur"],3),children:[(0,f.jsx)(mw,{className:"h-4 w-4 mr-2"}),"Tableau administratif (2 colonnes)"]})]})]}),(0,f.jsx)(mO,{open:b,onOpenChange:c,editorRef:a,onInsert:b=>{if(a.current)try{a.current.insertTableWithProperties(b)}catch(a){console.error("Error inserting table with properties:",a)}}}),(0,f.jsxs)(mI.DropdownMenu,{children:[(0,f.jsx)(mI.DropdownMenuTrigger,{asChild:!0,children:(0,f.jsxs)(n.Button,{variant:"outline",size:"sm",className:"gap-2",children:[(0,f.jsx)(mC,{className:"h-4 w-4"}),"Cadre"]})}),(0,f.jsxs)(mI.DropdownMenuContent,{align:"start",className:"w-56",children:[(0,f.jsx)(mI.DropdownMenuLabel,{children:"Insrer un cadre"}),(0,f.jsx)(mI.DropdownMenuSeparator,{}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>e("simple"),children:[(0,f.jsx)(mJ,{className:"h-4 w-4 mr-2"}),"Cadre simple"]}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>e("colored"),children:[(0,f.jsx)(mJ,{className:"h-4 w-4 mr-2",style:{color:"#335ACF"}}),"Cadre bleu"]}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>e("gradient"),children:[(0,f.jsx)(mJ,{className:"h-4 w-4 mr-2",style:{color:"#34B9EE"}}),"Cadre avec fond"]}),(0,f.jsx)(mI.DropdownMenuSeparator,{}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>h("#335ACF"),children:[(0,f.jsx)(mC,{className:"h-4 w-4 mr-2"}),"Section avec titre (bleu)"]}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>h("#34B9EE"),children:[(0,f.jsx)(mC,{className:"h-4 w-4 mr-2"}),"Section avec titre (cyan)"]}),(0,f.jsxs)(mI.DropdownMenuItem,{onClick:()=>h("#10B981"),children:[(0,f.jsx)(mC,{className:"h-4 w-4 mr-2"}),"Section avec titre (vert)"]})]})]})]})}var mQ=a.i(801789);function mR({template:a,onTemplateChange:b,onEditorRefReady:c,isActive:d}){let e=(0,g.useRef)(null),h=(0,g.useRef)(!1),[i,j]=(0,g.useState)(()=>{let b=a.header?.content;return(0,mQ.convertTagsToVariableNodes)(b||"")}),k=(0,g.useRef)(!1);(0,g.useEffect)(()=>{d&&!k.current&&e.current&&c?(k.current=!0,c({insertVariable:a=>{e.current?.insertVariable(a)}})):d||(k.current=!1)},[d,c]);let l=a.header||{enabled:!0,height:100,elements:[],repeatOnAllPages:!0,content:""},m=c=>{b({header:{...l,...c},header_enabled:void 0!==c.enabled?c.enabled:a.header_enabled,header_height:void 0!==c.height?c.height:a.header_height})};return(0,g.useEffect)(()=>{if(h.current)return;let b=a.header?.content||"",c=(0,mQ.convertTagsToVariableNodes)(b);c!==i&&(h.current=!0,j(c),setTimeout(()=>{h.current=!1},100))},[a.header]),(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)(E.Card,{children:[(0,f.jsxs)(E.CardHeader,{children:[(0,f.jsx)(E.CardTitle,{children:"Configuration de l'en-tte"}),(0,f.jsx)(E.CardDescription,{children:"Personnalisez l'apparence et le contenu de l'en-tte"})]}),(0,f.jsxs)(E.CardContent,{className:"space-y-6",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)(F.Label,{children:"Afficher l'en-tte"}),(0,f.jsx)("p",{className:"text-sm text-text-tertiary",children:"Afficher l'en-tte sur toutes les pages"})]}),(0,f.jsx)(G.Switch,{checked:a.header_enabled,onCheckedChange:a=>{b({header_enabled:a})}})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsxs)(F.Label,{children:["Hauteur : ",l.height,"px"]}),(0,f.jsx)(I,{value:[l.height],onValueChange:([a])=>m({height:a}),min:50,max:250,step:5,className:"w-full",disabled:!a.header_enabled}),(0,f.jsxs)("div",{className:"flex justify-between text-xs text-text-tertiary",children:[(0,f.jsx)("span",{children:"Min: 50px"}),(0,f.jsx)("span",{children:"Max: 250px"})]})]})]})]}),(0,f.jsxs)(E.Card,{className:"flex-1 flex flex-col overflow-hidden",children:[(0,f.jsxs)(E.CardHeader,{children:[(0,f.jsx)(E.CardTitle,{children:"Contenu de l'en-tte"}),(0,f.jsx)(E.CardDescription,{children:"ditez le contenu de l'en-tte. Utilisez la barre latrale pour insrer des variables, tableaux et cadres."})]}),(0,f.jsxs)(E.CardContent,{className:"flex-1 flex flex-col min-h-[400px]",children:[(0,f.jsx)(mP,{editorRef:e}),(0,f.jsx)("div",{onDragOver:a=>{a.preventDefault(),a.stopPropagation(),a.dataTransfer.dropEffect="copy"},onDrop:a=>{a.preventDefault(),a.stopPropagation();let b=a.dataTransfer.getData("text/plain")||a.dataTransfer.getData("text/html")?.replace(/[{}]/g,"");b&&e.current&&e.current.insertVariable(b)},className:"flex-1",children:(0,f.jsx)(mH,{ref:e,value:i,onChange:a=>{h.current||(j(a),m({content:(0,mQ.convertVariableNodesToTags)(a)}))},placeholder:"Saisissez le contenu de l'en-tte...",className:"flex-1"})})]})]})]})}function mS({template:a,onTemplateChange:b,onEditorRefReady:c,isActive:d}){return(0,f.jsx)(mR,{template:a,onTemplateChange:b,onEditorRefReady:c,isActive:d})}var mT=a.i(219897),mU=a.i(819721),mV=a.i(669520),mW=a.i(613749),mX=a.i(771931);let mY=(0,x.default)("ZoomIn",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"11",x2:"11",y1:"8",y2:"14",key:"1vmskp"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),mZ=(0,x.default)("ZoomOut",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["line",{x1:"21",x2:"16.65",y1:"21",y2:"16.65",key:"13gj7c"}],["line",{x1:"8",x2:"14",y1:"11",y2:"11",key:"durymu"}]]),m$=(0,x.default)("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),m_=(0,x.default)("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);var m0=a.i(284144);let m1={ecole_nom:"cole Moderne de Dakar",ecole_logo:"",ecole_adresse:"123 Avenue de l'Education, Dakar, Sngal",ecole_ville:"Dakar",ecole_telephone:"+221 77 123 45 67",ecole_email:"contact@ecolemoderne.sn",ecole_site_web:"www.ecolemoderne.sn",ecole_slogan:"Excellence et Innovation",eleve_nom:"DIALLO",eleve_prenom:"Amadou",eleve_numero:"LYC001",eleve_date_naissance:"15/03/2007",eleve_classe:"Terminale A",formation_nom:"Formation en Dveloppement Web",formation_code:"DEV-WEB-2024",formation_duree:"6 mois",formation_prix:"500 000 XOF",session_nom:"Session Janvier 2024",session_debut:"01/01/2024",session_fin:"30/06/2024",date_jour:new Date().toLocaleDateString("fr-FR"),date_emission:new Date().toLocaleDateString("fr-FR"),annee_scolaire:"2024-2025",numero_document:"2025-001",date_generation:new Date().toLocaleDateString("fr-FR"),numero_page:1,total_pages:1};function m2(a,b){if(!a)return a;let c=(0,m0.processConditionals)(a,b);return Object.entries(b).forEach(([a,b])=>{let d=RegExp(`\\{${a}\\}`,"g"),e=b?String(b).replace(/</g,"&lt;").replace(/>/g,"&gt;"):"";c=c.replace(d,e)}),c}let m3={A4:{width:210,height:297},A3:{width:297,height:420},Letter:{width:216,height:279},Legal:{width:216,height:356}};function m4({htmlContent:a,headerContent:b,footerContent:c,className:d,pageSize:e="A4",margins:h={top:20,right:20,bottom:20,left:20},fullPageMode:i=!1}){let[j,k]=(0,g.useState)(!1),[l,m]=(0,g.useState)(0),[o,p]=(0,g.useState)(1),[q,s]=(0,g.useState)(1),[t,u]=(0,g.useState)(.8),[v,w]=(0,g.useState)(!1),[x,y]=(0,g.useState)(!1),z=(0,g.useRef)(null),A=(0,g.useMemo)(()=>{let d=a?m2(a,m1):"",e=b?m2(b,m1):"",f=c?m2(c,m1):"",g=Math.max(1,Math.ceil(d.length/3e3));return{header:e,body:d,footer:f,estimatedPages:g}},[a,b,c]),B=m3[e];B.width;let C=3.779527559*B.height-100-60-(h.top+h.bottom)*3.779527559;(0,g.useEffect)(()=>{let a=()=>{if(z.current){let a=Math.max(1,Math.ceil(z.current.scrollHeight/C));s(a),o>a&&p(a)}};requestAnimationFrame(()=>{requestAnimationFrame(a)})},[A.body,o,C]);let D=a=>{a>=1&&a<=q&&p(a)};return(0,f.jsxs)(mT.GlassCard,{variant:"premium",className:(0,H.cn)("flex flex-col overflow-hidden",d),children:[(0,f.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(r.Eye,{className:"h-5 w-5 text-brand-blue"}),(0,f.jsx)("h3",{className:"font-semibold text-text-primary",children:"Prvisualisation en temps rel"})]}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsxs)("div",{className:"flex items-center gap-1 border rounded-lg",children:[(0,f.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:()=>u(a=>Math.max(a-.1,.3)),disabled:t<=.3,className:"h-8 w-8 p-0",children:(0,f.jsx)(mZ,{className:"h-4 w-4"})}),(0,f.jsxs)("span",{className:"text-xs text-text-secondary px-2 min-w-[3rem] text-center",children:[Math.round(100*t),"%"]}),(0,f.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:()=>u(a=>Math.min(a+.1,1.5)),disabled:t>=1.5,className:"h-8 w-8 p-0",children:(0,f.jsx)(mY,{className:"h-4 w-4"})}),(0,f.jsx)(n.Button,{variant:"ghost",size:"sm",onClick:()=>u(.8),className:"h-8 px-2 text-xs",children:"Reset"})]}),(0,f.jsx)(n.Button,{variant:x?"default":"outline",size:"sm",onClick:()=>y(!x),className:"gap-2",title:"Afficher toutes les pages",children:x?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(m_,{className:"h-4 w-4"}),"Vue page"]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(m$,{className:"h-4 w-4"}),"Vue complte"]})}),(0,f.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:()=>{w(!0),window.print(),setTimeout(()=>w(!1),1e3)},className:"gap-2",children:[(0,f.jsx)(mX.Printer,{className:"h-4 w-4"}),"Imprimer"]}),(0,f.jsxs)(n.Button,{variant:"ghost",size:"sm",onClick:()=>{k(!0),m(a=>a+1),setTimeout(()=>k(!1),300)},disabled:j,className:"gap-2",children:[(0,f.jsx)(mV.RefreshCw,{className:(0,H.cn)("h-4 w-4",j&&"animate-spin")}),"Actualiser"]})]})]}),(0,f.jsxs)("div",{className:"flex-1 overflow-auto p-4 bg-gray-50 preview-container",children:[q>1&&!v&&!x&&(0,f.jsxs)("div",{className:"flex items-center justify-center gap-4 mb-4 preview-navigation",children:[(0,f.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>D(o-1),disabled:1===o,children:(0,f.jsx)(mW.ChevronLeft,{className:"h-4 w-4"})}),(0,f.jsxs)("span",{className:"text-sm text-text-secondary",children:["Page ",o," / ",q]}),(0,f.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>D(o+1),disabled:o===q,children:(0,f.jsx)(lB.ChevronRight,{className:"h-4 w-4"})})]}),(0,f.jsxs)("div",{className:"mb-4 flex items-center gap-2 preview-controls",children:[(0,f.jsx)("label",{className:"text-sm text-text-secondary",children:"Format:"}),(0,f.jsxs)("select",{value:e,onChange:a=>{},disabled:!0,className:"text-sm px-2 py-1 border rounded",children:[(0,f.jsx)("option",{value:"A4",children:"A4 (210  297 mm)"}),(0,f.jsx)("option",{value:"A3",children:"A3 (297  420 mm)"}),(0,f.jsx)("option",{value:"Letter",children:"Letter (216  279 mm)"}),(0,f.jsx)("option",{value:"Legal",children:"Legal (216  356 mm)"})]})]}),(0,f.jsx)("div",{className:(0,H.cn)("space-y-4",x&&"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"),children:Array.from({length:q}).map((a,b)=>{let c=b+1,d=c===o;return(0,f.jsxs)("div",{className:(0,H.cn)("mx-auto bg-white shadow-lg rounded-lg overflow-hidden transition-all preview-page",x?"w-full":"",d?"ring-2 ring-brand-blue":x?"opacity-90":"opacity-60",!d&&q>1&&!v&&!x&&"hidden"),style:{width:`${B.width}mm`,minHeight:`${B.height}mm`,maxWidth:"100%",transform:`scale(${t})`,transformOrigin:"top center",padding:`${h.top}mm ${h.right}mm ${h.bottom}mm ${h.left}mm`},children:[A.header&&(0,f.jsx)("div",{className:"border-b border-gray-300 bg-gray-100/50 p-4",style:{minHeight:"100px"},dangerouslySetInnerHTML:{__html:m2(A.header,{...m1,numero_page:c,total_pages:q})}}),(0,f.jsx)("div",{ref:1===c?z:null,className:"p-6 prose prose-sm max-w-none",style:{fontFamily:"Inter, Arial, sans-serif",fontSize:"14px",lineHeight:"1.6",display:1===c?"block":"none"},dangerouslySetInnerHTML:{__html:m2(A.body,{...m1,numero_page:c,total_pages:q})}},`${l}-${c}`),A.footer&&(0,f.jsx)("div",{className:"border-t border-gray-300 bg-gray-100/50 p-4 mt-auto",style:{minHeight:"60px"},dangerouslySetInnerHTML:{__html:m2(A.footer,{...m1,numero_page:c,total_pages:q})}})]},c)})})]})]})}var m5=a.i(797063),m6=a.i(141379),m7=a.i(104720);let m8=(0,x.default)("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);a.i(460355);var m9=a.i(346271),na=a.i(262036),nb=a.i(269240);let nc=()=>new Map,nd=a=>{let b=nc();return a.forEach((a,c)=>{b.set(c,a)}),b},ne=(a,b,c)=>{let d=a.get(b);return void 0===d&&a.set(b,d=c()),d},nf=()=>new Set,ng=a=>a[a.length-1],nh=(a,b)=>{for(let c=0;c<b.length;c++)a.push(b[c])},ni=Array.from,nj=Array.isArray;class nk{constructor(){this._observers=nc()}on(a,b){return ne(this._observers,a,nf).add(b),b}once(a,b){let c=(...d)=>{this.off(a,c),b(...d)};this.on(a,c)}off(a,b){let c=this._observers.get(a);void 0!==c&&(c.delete(b),0===c.size&&this._observers.delete(a))}emit(a,b){return ni((this._observers.get(a)||nc()).values()).forEach(a=>a(...b))}destroy(){this._observers=nc()}}class nl{constructor(){this._observers=nc()}on(a,b){ne(this._observers,a,nf).add(b)}once(a,b){let c=(...d)=>{this.off(a,c),b(...d)};this.on(a,c)}off(a,b){let c=this._observers.get(a);void 0!==c&&(c.delete(b),0===c.size&&this._observers.delete(a))}emit(a,b){return ni((this._observers.get(a)||nc()).values()).forEach(a=>a(...b))}destroy(){this._observers=nc()}}let nm=Math.floor,nn=Math.abs,no=(a,b)=>a<b?a:b,np=(a,b)=>a>b?a:b,nq=Math.pow,nr=a=>0!==a?a<0:1/a<0,ns=Number.MAX_SAFE_INTEGER,nt=Number.isInteger||(a=>"number"==typeof a&&isFinite(a)&&nm(a)===a);(0,String.fromCharCode)(65535);let nu=/^\s*/g,nv=/([A-Z])/g,nw=(a,b)=>a.replace(nv,a=>`${b}${a.toLowerCase()}`).replace(nu,""),nx="undefined"!=typeof TextEncoder?new TextEncoder:null,ny=nx?a=>nx.encode(a):a=>{let b=unescape(encodeURIComponent(a)),c=b.length,d=new Uint8Array(c);for(let a=0;a<c;a++)d[a]=b.codePointAt(a);return d},nz="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});nz&&1===nz.decode(new Uint8Array).length&&(nz=null);class nA{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}let nB=()=>new nA,nC=a=>{let b=a.cpos;for(let c=0;c<a.bufs.length;c++)b+=a.bufs[c].length;return b},nD=a=>{let b=new Uint8Array(nC(a)),c=0;for(let d=0;d<a.bufs.length;d++){let e=a.bufs[d];b.set(e,c),c+=e.length}return b.set(new Uint8Array(a.cbuf.buffer,0,a.cpos),c),b},nE=(a,b)=>{let c=a.cbuf.length;a.cpos===c&&(a.bufs.push(a.cbuf),a.cbuf=new Uint8Array(2*c),a.cpos=0),a.cbuf[a.cpos++]=b},nF=(a,b)=>{for(;b>127;)nE(a,128|127&b),b=nm(b/128);nE(a,127&b)},nG=(a,b)=>{let c=nr(b);for(c&&(b=-b),nE(a,128*(b>63)|64*!!c|63&b),b=nm(b/64);b>0;)nE(a,128*(b>127)|127&b),b=nm(b/128)},nH=new Uint8Array(3e4),nI=nH.length/3,nJ=nx&&nx.encodeInto?(a,b)=>{if(b.length<nI){let c=nx.encodeInto(b,nH).written||0;nF(a,c);for(let b=0;b<c;b++)nE(a,nH[b])}else nL(a,ny(b))}:(a,b)=>{let c=unescape(encodeURIComponent(b)),d=c.length;nF(a,d);for(let b=0;b<d;b++)nE(a,c.codePointAt(b))},nK=(a,b)=>{let c=a.cbuf.length,d=a.cpos,e=no(c-d,b.length),f=b.length-e;a.cbuf.set(b.subarray(0,e),d),a.cpos+=e,f>0&&(a.bufs.push(a.cbuf),a.cbuf=new Uint8Array(np(2*c,f)),a.cbuf.set(b.subarray(e)),a.cpos=f)},nL=(a,b)=>{nF(a,b.byteLength),nK(a,b)},nM=(a,b)=>{let c;(c=a.cbuf.length)-a.cpos<b&&(a.bufs.push(new Uint8Array(a.cbuf.buffer,0,a.cpos)),a.cbuf=new Uint8Array(2*np(c,b)),a.cpos=0);let d=new DataView(a.cbuf.buffer,a.cpos,b);return a.cpos+=b,d},nN=new DataView(new ArrayBuffer(4)),nO=(a,b)=>{switch(typeof b){case"string":nE(a,119),nJ(a,b);break;case"number":if(nt(b)&&0x7fffffff>=nn(b))nE(a,125),nG(a,b);else if(nN.setFloat32(0,b),nN.getFloat32(0)===b)nE(a,124),nM(a,4).setFloat32(0,b,!1);else nE(a,123),nM(a,8).setFloat64(0,b,!1);break;case"bigint":nE(a,122),nM(a,8).setBigInt64(0,b,!1);break;case"object":if(null===b)nE(a,126);else if(nj(b)){nE(a,117),nF(a,b.length);for(let c=0;c<b.length;c++)nO(a,b[c])}else if(b instanceof Uint8Array)nE(a,116),nL(a,b);else{nE(a,118);let c=Object.keys(b);nF(a,c.length);for(let d=0;d<c.length;d++){let e=c[d];nJ(a,e),nO(a,b[e])}}break;case"boolean":nE(a,b?120:121);break;default:nE(a,127)}};class nP extends nA{constructor(a){super(),this.w=a,this.s=null,this.count=0}write(a){this.s===a?this.count++:(this.count>0&&nF(this,this.count-1),this.count=1,this.w(this,a),this.s=a)}}let nQ=a=>{a.count>0&&(nG(a.encoder,1===a.count?a.s:-a.s),a.count>1&&nF(a.encoder,a.count-2))};class nR{constructor(){this.encoder=new nA,this.s=0,this.count=0}write(a){this.s===a?this.count++:(nQ(this),this.count=1,this.s=a)}toUint8Array(){return nQ(this),nD(this.encoder)}}let nS=a=>{if(a.count>0){let b=2*a.diff+ +(1!==a.count);nG(a.encoder,b),a.count>1&&nF(a.encoder,a.count-2)}};class nT{constructor(){this.encoder=new nA,this.s=0,this.count=0,this.diff=0}write(a){this.diff===a-this.s?(this.s=a,this.count++):(nS(this),this.count=1,this.diff=a-this.s,this.s=a)}toUint8Array(){return nS(this),nD(this.encoder)}}class nU{constructor(){this.sarr=[],this.s="",this.lensE=new nR}write(a){this.s+=a,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(a.length)}toUint8Array(){let a=new nA;return this.sarr.push(this.s),this.s="",nJ(a,this.sarr.join("")),nK(a,this.lensE.toUint8Array()),nD(a)}}let nV=()=>{throw Error("Method unimplemented")},nW=()=>{throw Error("Unexpected case")},nX=Error("Unexpected end of array"),nY=Error("Integer out of Range");class nZ{constructor(a){this.arr=a,this.pos=0}}let n$=a=>new nZ(a),n_=a=>{var b;let c;return b=n1(a),c=new Uint8Array(a.arr.buffer,a.pos+a.arr.byteOffset,b),a.pos+=b,c},n0=a=>a.arr[a.pos++],n1=a=>{let b=0,c=1,d=a.arr.length;for(;a.pos<d;){let d=a.arr[a.pos++];if(b+=(127&d)*c,c*=128,d<128)return b;if(b>ns)throw nY}throw nX},n2=a=>{let b=a.arr[a.pos++],c=63&b,d=64,e=(64&b)>0?-1:1;if((128&b)==0)return e*c;let f=a.arr.length;for(;a.pos<f;){if(c+=(127&(b=a.arr[a.pos++]))*d,d*=128,b<128)return e*c;if(c>ns)throw nY}throw nX},n3=nz?a=>nz.decode(n_(a)):a=>{let b=n1(a);if(0===b)return"";{let c=String.fromCodePoint(n0(a));if(--b<100)for(;b--;)c+=String.fromCodePoint(n0(a));else for(;b>0;){let d=b<1e4?b:1e4,e=a.arr.subarray(a.pos,a.pos+d);a.pos+=d,c+=String.fromCodePoint.apply(null,e),b-=d}return decodeURIComponent(escape(c))}},n4=(a,b)=>{let c=new DataView(a.arr.buffer,a.arr.byteOffset+a.pos,b);return a.pos+=b,c},n5=[a=>void 0,a=>null,n2,a=>n4(a,4).getFloat32(0,!1),a=>n4(a,8).getFloat64(0,!1),a=>n4(a,8).getBigInt64(0,!1),a=>!1,a=>!0,n3,a=>{let b=n1(a),c={};for(let d=0;d<b;d++)c[n3(a)]=n6(a);return c},a=>{let b=n1(a),c=[];for(let d=0;d<b;d++)c.push(n6(a));return c},n_],n6=a=>n5[127-n0(a)](a);class n7 extends nZ{constructor(a,b){super(a),this.reader=b,this.s=null,this.count=0}read(){0===this.count&&(this.s=this.reader(this),this.pos!==this.arr.length?this.count=n1(this)+1:this.count=-1);return this.count--,this.s}}class n8 extends nZ{constructor(a){super(a),this.s=0,this.count=0}read(){if(0===this.count){this.s=n2(this);let a=nr(this.s);this.count=1,a&&(this.s=-this.s,this.count=n1(this)+2)}return this.count--,this.s}}class n9 extends nZ{constructor(a){super(a),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){let a=n2(this);this.diff=nm(a/2),this.count=1,1&a&&(this.count=n1(this)+2)}return this.s+=this.diff,this.count--,this.s}}class oa{constructor(a){this.decoder=new n8(a),this.str=n3(this.decoder),this.spos=0}read(){let a=this.spos+this.decoder.read(),b=this.str.slice(this.spos,a);return this.spos=a,b}}var ob=a.i(666680);ob.webcrypto.subtle;let oc=ob.webcrypto.getRandomValues.bind(ob.webcrypto),od=()=>oc(new Uint32Array(1))[0],oe=Date.now,of=a=>new Promise(a);Promise.all.bind(Promise);let og=a=>void 0===a?null:a,oh=new class{constructor(){this.map=new Map}setItem(a,b){this.map.set(a,b)}getItem(a){return this.map.get(a)}},oi=!0;try{"undefined"!=typeof localStorage&&localStorage&&(oh=localStorage,oi=!1)}catch(a){}let oj=oh,ok=Symbol("Equality"),ol=Object.assign,om=Object.keys,on=(a,b)=>Object.prototype.hasOwnProperty.call(a,b),oo=Object.freeze,op=a=>{for(let b in a){let c=a[b];("object"==typeof c||"function"==typeof c)&&op(a[b])}return oo(a)},oq=(a,b,c=0)=>{try{for(;c<a.length;c++)a[c](...b)}finally{c<a.length&&oq(a,b,c+1)}},or=a=>a,ot=(a,b)=>{if(a===b)return!0;if(null==a||null==b||a.constructor!==b.constructor&&(a.constructor||Object)!==(b.constructor||Object))return!1;if(null!=a[ok])return a[ok](b);switch(a.constructor){case ArrayBuffer:a=new Uint8Array(a),b=new Uint8Array(b);case Uint8Array:if(a.byteLength!==b.byteLength)return!1;for(let c=0;c<a.length;c++)if(a[c]!==b[c])return!1;break;case Set:if(a.size!==b.size)return!1;for(let c of a)if(!b.has(c))return!1;break;case Map:if(a.size!==b.size)return!1;for(let c of a.keys())if(!b.has(c)||!ot(a.get(c),b.get(c)))return!1;break;case void 0:case Object:if(om(a).length!==om(b).length)return!1;for(let c in a)if(!on(a,c)||!ot(a[c],b[c]))return!1;break;case Array:if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(!ot(a[c],b[c]))return!1;break;default:return!1}return!0},ou="undefined"!=typeof process&&process.release&&/node|io\.js/.test(process.release.name)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let ov=[],ow=a=>(()=>{if(void 0===d)if(ou){d=nc();let a=process.argv,b=null;for(let c=0;c<a.length;c++){let e=a[c];"-"===e[0]?(null!==b&&d.set(b,""),b=e):null!==b?(d.set(b,e),b=null):ov.push(e)}null!==b&&d.set(b,"")}else"object"==typeof location?(d=nc(),(location.search||"?").slice(1).split("&").forEach(a=>{if(0!==a.length){let[b,c]=a.split("=");d.set(`--${nw(b,"-")}`,c),d.set(`-${nw(b,"-")}`,c)}})):d=nc();return d})().has(a),ox=a=>ou?og(process.env[a.toUpperCase().replaceAll("-","_")]):og(oj.getItem(a)),oy=a=>ow("--"+a)||null!==ox(a);oy("production");let oz=ou&&["true","1","2"].includes(process.env.FORCE_COLOR)||!ow("--no-colors")&&!oy("no-color")&&(!ou||process.stdout.isTTY)&&(!ou||ow("--color")||null!==ox("COLORTERM")||(ox("TERM")||"").includes("color")),oA=Symbol,oB=oA(),oC=oA(),oD=oA(),oE=oA(),oF=oA(),oG=oA(),oH=oA(),oI=oA(),oJ=oA();oe();let oK={[oB]:"\x1b[1m",[oC]:"\x1b[2m",[oD]:"\x1b[34m",[oF]:"\x1b[32m",[oE]:"\x1b[37m",[oG]:"\x1b[31m",[oH]:"\x1b[35m",[oI]:"\x1b[38;5;208m",[oJ]:"\x1b[0m"},oL=oz?a=>{1===a.length&&a[0]?.constructor===Function&&(a=a[0]());let b=[],c=[],d=0;for(;d<a.length;d++){let c=a[d],e=oK[c];if(void 0!==e)b.push(e);else if(void 0===c)break;else if(c.constructor===String||c.constructor===Number)b.push(c);else break}for(d>0&&(b.push("\x1b[0m"),c.push(b.join("")));d<a.length;d++){let b=a[d];b instanceof Symbol||c.push(b)}return c}:a=>{1===a.length&&a[0]?.constructor===Function&&(a=a[0]());let b=[],c=[],d=0;for(;d<a.length;d++){let c=a[d];if(void 0===c)break;if(c.constructor===String||c.constructor===Number)b.push(c);else if(c.constructor===Object)break}for(d>0&&c.push(b.join(""));d<a.length;d++){let b=a[d];b instanceof Symbol||c.push(b)}return c},oM=a=>({[Symbol.iterator](){return this},next:a}),oN=(a,b)=>oM(()=>{let{done:c,value:d}=a.next();return{done:c,value:c?void 0:b(d)}});class oO{constructor(a,b){this.clock=a,this.len=b}}class oP{constructor(){this.clients=new Map}}let oQ=(a,b,c)=>b.clients.forEach((b,d)=>{let e=a.doc.store.clients.get(d);if(null!=e){let d=e[e.length-1],f=d.id.clock+d.length;for(let d=0,g=b[d];d<b.length&&g.clock<f;g=b[++d])pr(a,e,g.clock,g.len,c)}}),oR=(a,b)=>{let c=a.clients.get(b.client);return void 0!==c&&null!==((a,b)=>{let c=0,d=a.length-1;for(;c<=d;){let e=nm((c+d)/2),f=a[e],g=f.clock;if(g<=b){if(b<g+f.len)return e;c=e+1}else d=e-1}return null})(c,b.clock)},oS=a=>{a.clients.forEach(a=>{let b,c;for(a.sort((a,b)=>a.clock-b.clock),b=1,c=1;b<a.length;b++){let d=a[c-1],e=a[b];d.clock+d.len>=e.clock?d.len=np(d.len,e.clock+e.len-d.clock):(c<b&&(a[c]=e),c++)}a.length=c})},oT=(a,b,c,d)=>{ne(a.clients,b,()=>[]).push(new oO(c,d))},oU=()=>new oP,oV=(a,b)=>{nF(a.restEncoder,b.clients.size),ni(b.clients.entries()).sort((a,b)=>b[0]-a[0]).forEach(([b,c])=>{a.resetDsCurVal(),nF(a.restEncoder,b);let d=c.length;nF(a.restEncoder,d);for(let b=0;b<d;b++){let d=c[b];a.writeDsClock(d.clock),a.writeDsLen(d.len)}})},oW=a=>{let b=new oP,c=n1(a.restDecoder);for(let d=0;d<c;d++){a.resetDsCurVal();let c=n1(a.restDecoder),d=n1(a.restDecoder);if(d>0){let e=ne(b.clients,c,()=>[]);for(let b=0;b<d;b++)e.push(new oO(a.readDsClock(),a.readDsLen()))}}return b},oX=(a,b,c)=>{let d=new oP,e=n1(a.restDecoder);for(let f=0;f<e;f++){a.resetDsCurVal();let e=n1(a.restDecoder),f=n1(a.restDecoder),g=c.clients.get(e)||[],h=pk(c,e);for(let c=0;c<f;c++){let c=a.readDsClock(),f=c+a.readDsLen();if(c<h){h<f&&oT(d,e,h,f-h);let a=pm(g,c),i=g[a];for(!i.deleted&&i.id.clock<c&&(g.splice(a+1,0,qN(b,i,c-i.id.clock)),a++);a<g.length;)if((i=g[a++]).id.clock<f)i.deleted||(f<i.id.clock+i.length&&g.splice(a,0,qN(b,i,f-i.id.clock)),i.delete(b));else break}else oT(d,e,c,f-c)}}if(d.clients.size>0){let a=new o4;return nF(a.restEncoder,0),oV(a,d),a.toUint8Array()}return null};class oY extends nk{constructor({guid:a="10000000-1000-4000-8000-100000000000".replace(/[018]/g,a=>(a^od()&15>>a/4).toString(16)),collectionid:b=null,gc:c=!0,gcFilter:d=()=>!0,meta:e=null,autoLoad:f=!1,shouldLoad:g=!0}={}){super(),this.gc=c,this.gcFilter=d,this.clientID=od(),this.guid=a,this.collectionid=b,this.share=new Map,this.store=new pi,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=g,this.autoLoad=f,this.meta=e,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=of(a=>{this.on("load",()=>{this.isLoaded=!0,a(this)})});const h=()=>of(a=>{let b=c=>{(void 0===c||!0===c)&&(this.off("sync",b),a())};this.on("sync",b)});this.on("sync",a=>{!1===a&&this.isSynced&&(this.whenSynced=h()),this.isSynced=void 0===a||!0===a,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=h()}load(){let a=this._item;null===a||this.shouldLoad||px(a.parent.doc,a=>{a.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(ni(this.subdocs).map(a=>a.guid))}transact(a,b=null){return px(this,a,b)}get(a,b=pP){let c=ne(this.share,a,()=>{let a=new b;return a._integrate(this,null),a}),d=c.constructor;if(b!==pP&&d!==b)if(d===pP){let d=new b;d._map=c._map,c._map.forEach(a=>{for(;null!==a;a=a.left)a.parent=d}),d._start=c._start;for(let a=d._start;null!==a;a=a.right)a.parent=d;return d._length=c._length,this.share.set(a,d),d._integrate(this,null),d}else throw Error(`Type with the name ${a} has already been defined with a different constructor`);return c}getArray(a=""){return this.get(a,p3)}getText(a=""){return this.get(a,ql)}getMap(a=""){return this.get(a,p5)}getXmlElement(a=""){return this.get(a,qo)}getXmlFragment(a=""){return this.get(a,qn)}toJSON(){let a={};return this.share.forEach((b,c)=>{a[c]=b.toJSON()}),a}destroy(){this.isDestroyed=!0,ni(this.subdocs).forEach(a=>a.destroy());let a=this._item;if(null!==a){this._item=null;let b=a.content;b.doc=new oY({guid:this.guid,...b.opts,shouldLoad:!1}),b.doc._item=a,px(a.parent.doc,c=>{let d=b.doc;a.deleted||c.subdocsAdded.add(d),c.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class oZ{constructor(a){this.restDecoder=a}resetDsCurVal(){}readDsClock(){return n1(this.restDecoder)}readDsLen(){return n1(this.restDecoder)}}class o$ extends oZ{readLeftID(){return pf(n1(this.restDecoder),n1(this.restDecoder))}readRightID(){return pf(n1(this.restDecoder),n1(this.restDecoder))}readClient(){return n1(this.restDecoder)}readInfo(){return n0(this.restDecoder)}readString(){return n3(this.restDecoder)}readParentInfo(){return 1===n1(this.restDecoder)}readTypeRef(){return n1(this.restDecoder)}readLen(){return n1(this.restDecoder)}readAny(){return n6(this.restDecoder)}readBuf(){var a;let b;return(b=new Uint8Array((a=n_(this.restDecoder)).byteLength)).set(a),b}readJSON(){return JSON.parse(n3(this.restDecoder))}readKey(){return n3(this.restDecoder)}}class o_{constructor(a){this.dsCurrVal=0,this.restDecoder=a}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=n1(this.restDecoder),this.dsCurrVal}readDsLen(){let a=n1(this.restDecoder)+1;return this.dsCurrVal+=a,a}}class o0 extends o_{constructor(a){super(a),this.keys=[],n1(a),this.keyClockDecoder=new n9(n_(a)),this.clientDecoder=new n8(n_(a)),this.leftClockDecoder=new n9(n_(a)),this.rightClockDecoder=new n9(n_(a)),this.infoDecoder=new n7(n_(a),n0),this.stringDecoder=new oa(n_(a)),this.parentInfoDecoder=new n7(n_(a),n0),this.typeRefDecoder=new n8(n_(a)),this.lenDecoder=new n8(n_(a))}readLeftID(){return new pd(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new pd(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return n6(this.restDecoder)}readBuf(){return n_(this.restDecoder)}readJSON(){return n6(this.restDecoder)}readKey(){let a=this.keyClockDecoder.read();if(a<this.keys.length)return this.keys[a];{let a=this.stringDecoder.read();return this.keys.push(a),a}}}class o1{constructor(){this.restEncoder=nB()}toUint8Array(){return nD(this.restEncoder)}resetDsCurVal(){}writeDsClock(a){nF(this.restEncoder,a)}writeDsLen(a){nF(this.restEncoder,a)}}class o2 extends o1{writeLeftID(a){nF(this.restEncoder,a.client),nF(this.restEncoder,a.clock)}writeRightID(a){nF(this.restEncoder,a.client),nF(this.restEncoder,a.clock)}writeClient(a){nF(this.restEncoder,a)}writeInfo(a){nE(this.restEncoder,a)}writeString(a){nJ(this.restEncoder,a)}writeParentInfo(a){nF(this.restEncoder,+!!a)}writeTypeRef(a){nF(this.restEncoder,a)}writeLen(a){nF(this.restEncoder,a)}writeAny(a){nO(this.restEncoder,a)}writeBuf(a){nL(this.restEncoder,a)}writeJSON(a){nJ(this.restEncoder,JSON.stringify(a))}writeKey(a){nJ(this.restEncoder,a)}}class o3{constructor(){this.restEncoder=nB(),this.dsCurrVal=0}toUint8Array(){return nD(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(a){let b=a-this.dsCurrVal;this.dsCurrVal=a,nF(this.restEncoder,b)}writeDsLen(a){0===a&&nW(),nF(this.restEncoder,a-1),this.dsCurrVal+=a}}class o4 extends o3{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new nT,this.clientEncoder=new nR,this.leftClockEncoder=new nT,this.rightClockEncoder=new nT,this.infoEncoder=new nP(nE),this.stringEncoder=new nU,this.parentInfoEncoder=new nP(nE),this.typeRefEncoder=new nR,this.lenEncoder=new nR}toUint8Array(){let a=nB();return nF(a,0),nL(a,this.keyClockEncoder.toUint8Array()),nL(a,this.clientEncoder.toUint8Array()),nL(a,this.leftClockEncoder.toUint8Array()),nL(a,this.rightClockEncoder.toUint8Array()),nL(a,nD(this.infoEncoder)),nL(a,this.stringEncoder.toUint8Array()),nL(a,nD(this.parentInfoEncoder)),nL(a,this.typeRefEncoder.toUint8Array()),nL(a,this.lenEncoder.toUint8Array()),nK(a,nD(this.restEncoder)),nD(a)}writeLeftID(a){this.clientEncoder.write(a.client),this.leftClockEncoder.write(a.clock)}writeRightID(a){this.clientEncoder.write(a.client),this.rightClockEncoder.write(a.clock)}writeClient(a){this.clientEncoder.write(a)}writeInfo(a){this.infoEncoder.write(a)}writeString(a){this.stringEncoder.write(a)}writeParentInfo(a){this.parentInfoEncoder.write(+!!a)}writeTypeRef(a){this.typeRefEncoder.write(a)}writeLen(a){this.lenEncoder.write(a)}writeAny(a){nO(this.restEncoder,a)}writeBuf(a){nL(this.restEncoder,a)}writeJSON(a){nO(this.restEncoder,a)}writeKey(a){let b=this.keyMap.get(a);void 0===b?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(a)):this.keyClockEncoder.write(b)}}let o5=(a,b,c)=>{let d=new Map;c.forEach((a,c)=>{pk(b,c)>a&&d.set(c,a)}),pj(b).forEach((a,b)=>{c.has(b)||d.set(b,0)}),nF(a.restEncoder,d.size),ni(d.entries()).sort((a,b)=>b[0]-a[0]).forEach(([c,d])=>{((a,b,c,d)=>{d=np(d,b[0].id.clock);let e=pm(b,d);nF(a.restEncoder,b.length-e),a.writeClient(c),nF(a.restEncoder,d);let f=b[e];f.write(a,d-f.id.clock);for(let c=e+1;c<b.length;c++)b[c].write(a,0)})(a,b.clients.get(c),c,d)})},o6=(a,b,c,d=o0)=>{let e=n$(b);((a,b,c,d=new o0(a))=>px(b,a=>{a.local=!1;let b=!1,c=a.doc,e=c.store,f=((a,b,c)=>{let d=[],e=ni(c.keys()).sort((a,b)=>a-b);if(0===e.length)return null;let f=()=>{if(0===e.length)return null;let a=c.get(e[e.length-1]);for(;a.refs.length===a.i;){if(e.pop(),!(e.length>0))return null;a=c.get(e[e.length-1])}return a},g=f();if(null===g)return null;let h=new pi,i=new Map,j=(a,b)=>{let c=i.get(a);(null==c||c>b)&&i.set(a,b)},k=g.refs[g.i++],l=new Map,m=()=>{for(let a of d){let b=a.id.client,d=c.get(b);d?(d.i--,h.clients.set(b,d.refs.slice(d.i)),c.delete(b),d.i=0,d.refs=[]):h.clients.set(b,[a]),e=e.filter(a=>a!==b)}d.length=0};for(;;){if(k.constructor!==qR){let e=ne(l,k.id.client,()=>pk(b,k.id.client))-k.id.clock;if(e<0)d.push(k),j(k.id.client,k.id.clock-1),m();else{let f=k.getMissing(a,b);if(null!==f){d.push(k);let a=c.get(f)||{refs:[],i:0};if(a.refs.length===a.i)j(f,pk(b,f)),m();else{k=a.refs[a.i++];continue}}else(0===e||e<k.length)&&(k.integrate(a,e),l.set(k.id.client,k.id.clock+k.length))}}if(d.length>0)k=d.pop();else if(null!==g&&g.i<g.refs.length)k=g.refs[g.i++];else{if(null===(g=f()))break;k=g.refs[g.i++]}}if(h.clients.size>0){let a=new o4;return o5(a,h,new Map),nF(a.restEncoder,0),{missing:i,update:a.toUint8Array()}}return null})(a,e,((a,b)=>{let c=nc(),d=n1(a.restDecoder);for(let e=0;e<d;e++){let d=n1(a.restDecoder),e=Array(d),f=a.readClient(),g=n1(a.restDecoder);c.set(f,{i:0,refs:e});for(let c=0;c<d;c++){let d=a.readInfo();switch(31&d){case 0:{let b=a.readLen();e[c]=new qt(pf(f,g),b),g+=b;break}case 10:{let b=n1(a.restDecoder);e[c]=new qR(pf(f,g),b),g+=b;break}default:{let h=(192&d)==0,i=new qO(pf(f,g),null,(128&d)==128?a.readLeftID():null,null,(64&d)==64?a.readRightID():null,h?a.readParentInfo()?b.get(a.readString()):a.readLeftID():null,h&&(32&d)==32?a.readString():null,qP(a,d));e[c]=i,g+=i.length}}}}return c})(d,c)),g=e.pendingStructs;if(g){for(let[a,c]of g.missing)if(c<pk(e,a)){b=!0;break}if(f){for(let[a,b]of f.missing){let c=g.missing.get(a);(null==c||c>b)&&g.missing.set(a,b)}g.update=pB([g.update,f.update])}}else e.pendingStructs=f;let h=oX(d,a,e);if(e.pendingDs){let b=new o0(n$(e.pendingDs));n1(b.restDecoder);let c=oX(b,a,e);h&&c?e.pendingDs=pB([h,c]):e.pendingDs=h||c}else e.pendingDs=h;if(b){let b=e.pendingStructs.update;e.pendingStructs=null,o6(a.doc,b)}},c,!1))(e,a,c,new d(e))},o7=a=>(a=>{let b=new Map,c=n1(a.restDecoder);for(let d=0;d<c;d++){let c=n1(a.restDecoder),d=n1(a.restDecoder);b.set(c,d)}return b})(new oZ(n$(a))),o8=(a,b)=>(nF(a.restEncoder,b.size),ni(b.entries()).sort((a,b)=>b[0]-a[0]).forEach(([b,c])=>{nF(a.restEncoder,b),nF(a.restEncoder,c)}),a);class o9{constructor(){this.l=[]}}let pa=()=>new o9,pb=(a,b)=>{let c=a.l,d=c.length;a.l=c.filter(a=>b!==a),d===a.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},pc=(a,b,c)=>oq(a.l,[b,c]);class pd{constructor(a,b){this.client=a,this.clock=b}}let pe=(a,b)=>a===b||null!==a&&null!==b&&a.client===b.client&&a.clock===b.clock,pf=(a,b)=>new pd(a,b);e=oU(),new class a{constructor(a,b){this.ds=a,this.sv=b}}(e,new Map);let pg=(a,b)=>void 0===b?!a.deleted:b.sv.has(a.id.client)&&(b.sv.get(a.id.client)||0)>a.id.clock&&!oR(b.ds,a.id),ph=(a,b)=>{let c=ne(a.meta,ph,nf),d=a.doc.store;c.has(b)||(b.sv.forEach((b,c)=>{b<pk(d,c)&&pp(a,pf(c,b))}),oQ(a,b.ds,a=>{}),c.add(b))};class pi{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}let pj=a=>{let b=new Map;return a.clients.forEach((a,c)=>{let d=a[a.length-1];b.set(c,d.id.clock+d.length)}),b},pk=(a,b)=>{let c=a.clients.get(b);if(void 0===c)return 0;let d=c[c.length-1];return d.id.clock+d.length},pl=(a,b)=>{let c=a.clients.get(b.id.client);if(void 0===c)c=[],a.clients.set(b.id.client,c);else{let a=c[c.length-1];if(a.id.clock+a.length!==b.id.clock)throw nW()}c.push(b)},pm=(a,b)=>{let c=0,d=a.length-1,e=a[d],f=e.id.clock;if(f===b)return d;let g=nm(b/(f+e.length-1)*d);for(;c<=d;){if((f=(e=a[g]).id.clock)<=b){if(b<f+e.length)return g;c=g+1}else d=g-1;g=nm((c+d)/2)}throw nW()},pn=(a,b)=>{let c=a.clients.get(b.client);return c[pm(c,b.clock)]},po=(a,b,c)=>{let d=pm(b,c),e=b[d];return e.id.clock<c&&e instanceof qO?(b.splice(d+1,0,qN(a,e,c-e.id.clock)),d+1):d},pp=(a,b)=>{let c=a.doc.store.clients.get(b.client);return c[po(a,c,b.clock)]},pq=(a,b,c)=>{let d=b.clients.get(c.client),e=pm(d,c.clock),f=d[e];return c.clock!==f.id.clock+f.length-1&&f.constructor!==qt&&d.splice(e+1,0,qN(a,f,c.clock-f.id.clock+1)),f},pr=(a,b,c,d,e)=>{let f;if(0===d)return;let g=c+d,h=po(a,b,c);do g<(f=b[h++]).id.clock+f.length&&po(a,b,g),e(f);while(h<b.length&&b[h].id.clock<g)};class ps{constructor(a,b,c){this.doc=a,this.deleteSet=new oP,this.beforeState=pj(a.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=b,this.meta=new Map,this.local=c,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}let pt=(a,b)=>(0!==b.deleteSet.clients.size||!!((a,b)=>{for(let[c,d]of a)if(b(d,c))return!0;return!1})(b.afterState,(a,c)=>b.beforeState.get(c)!==a))&&(oS(b.deleteSet),o5(a,b.doc.store,b.beforeState),oV(a,b.deleteSet),!0),pu=(a,b,c)=>{let d=b._item;(null===d||d.id.clock<(a.beforeState.get(d.id.client)||0)&&!d.deleted)&&ne(a.changed,b,nf).add(c)},pv=(a,b)=>{let c=a[b],d=a[b-1],e=b;for(;e>0;c=d,d=a[--e-1]){if(d.deleted===c.deleted&&d.constructor===c.constructor&&d.mergeWith(c)){c instanceof qO&&null!==c.parentSub&&c.parent._map.get(c.parentSub)===c&&c.parent._map.set(c.parentSub,d);continue}break}let f=b-e;return f&&a.splice(b+1-f,f),f},pw=(a,b)=>{if(b<a.length){let c=a[b],d=c.doc,e=d.store,f=c.deleteSet,g=c._mergeStructs;try{oS(f),c.afterState=pj(c.doc.store),d.emit("beforeObserverCalls",[c,d]);let a=[];c.changed.forEach((b,d)=>a.push(()=>{null!==d._item&&d._item.deleted||d._callObserver(c,b)})),a.push(()=>{c.changedParentTypes.forEach((b,d)=>{d._dEH.l.length>0&&(null===d._item||!d._item.deleted)&&((b=b.filter(a=>null===a.target._item||!a.target._item.deleted)).forEach(a=>{a.currentTarget=d,a._path=null}),b.sort((a,b)=>a.path.length-b.path.length),a.push(()=>{pc(d._dEH,b,c)}))}),a.push(()=>d.emit("afterTransaction",[c,d])),a.push(()=>{c._needFormattingCleanup&&qi(c)})}),oq(a,[])}finally{d.gc&&((a,b,c)=>{for(let[d,e]of a.clients.entries()){let a=b.clients.get(d);for(let d=e.length-1;d>=0;d--){let f=e[d],g=f.clock+f.len;for(let d=pm(a,f.clock),e=a[d];d<a.length&&e.id.clock<g;e=a[++d]){let e=a[d];if(f.clock+f.len<=e.id.clock)break;e instanceof qO&&e.deleted&&!e.keep&&c(e)&&e.gc(b,!1)}}}})(f,e,d.gcFilter),f.clients.forEach((a,b)=>{let c=e.clients.get(b);for(let b=a.length-1;b>=0;b--){let d=a[b],e=no(c.length-1,1+pm(c,d.clock+d.len-1));for(let a=e,b=c[a];a>0&&b.id.clock>=d.clock;b=c[a])a-=1+pv(c,a)}}),c.afterState.forEach((a,b)=>{let d=c.beforeState.get(b)||0;if(d!==a){let a=e.clients.get(b),c=np(pm(a,d),1);for(let b=a.length-1;b>=c;)b-=1+pv(a,b)}});for(let a=g.length-1;a>=0;a--){let{client:b,clock:c}=g[a].id,d=e.clients.get(b),f=pm(d,c);!(f+1<d.length&&pv(d,f+1)>1)&&f>0&&pv(d,f)}if(c.local||c.afterState.get(d.clientID)===c.beforeState.get(d.clientID)||(((...a)=>{console.log(...oL(a))})(oI,oB,"[yjs] ",oC,oG,"Changed the client-id because another client seems to be using it."),d.clientID=od()),d.emit("afterTransactionCleanup",[c,d]),d._observers.has("update")){let a=new o2;pt(a,c)&&d.emit("update",[a.toUint8Array(),c.origin,d,c])}if(d._observers.has("updateV2")){let a=new o4;pt(a,c)&&d.emit("updateV2",[a.toUint8Array(),c.origin,d,c])}let{subdocsAdded:h,subdocsLoaded:i,subdocsRemoved:j}=c;(h.size>0||j.size>0||i.size>0)&&(h.forEach(a=>{a.clientID=d.clientID,null==a.collectionid&&(a.collectionid=d.collectionid),d.subdocs.add(a)}),j.forEach(a=>d.subdocs.delete(a)),d.emit("subdocs",[{loaded:i,added:h,removed:j},d,c]),j.forEach(a=>a.destroy())),a.length<=b+1?(d._transactionCleanups=[],d.emit("afterAllTransactions",[d,a])):pw(a,b+1)}}},px=(a,b,c=null,d=!0)=>{let e=a._transactionCleanups,f=!1,g=null;null===a._transaction&&(f=!0,a._transaction=new ps(a,c,d),e.push(a._transaction),1===e.length&&a.emit("beforeAllTransactions",[a]),a.emit("beforeTransaction",[a._transaction,a]));try{g=b(a._transaction)}finally{if(f){let b=a._transaction===e[0];a._transaction=null,b&&pw(e,0)}}return g};class py{constructor(a,b){this.gen=function*(a){let b=n1(a.restDecoder);for(let c=0;c<b;c++){let b=n1(a.restDecoder),c=a.readClient(),d=n1(a.restDecoder);for(let e=0;e<b;e++){let b=a.readInfo();if(10===b){let b=n1(a.restDecoder);yield new qR(pf(c,d),b),d+=b}else if((31&b)!=0){let e=(192&b)==0,f=new qO(pf(c,d),null,(128&b)==128?a.readLeftID():null,null,(64&b)==64?a.readRightID():null,e?a.readParentInfo()?a.readString():a.readLeftID():null,e&&(32&b)==32?a.readString():null,qP(a,b));yield f,d+=f.length}else{let b=a.readLen();yield new qt(pf(c,d),b),d+=b}}}}(a),this.curr=null,this.done=!1,this.filterSkips=b,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&null!==this.curr&&this.curr.constructor===qR)return this.curr}}class pz{constructor(a){this.currClient=0,this.startClock=0,this.written=0,this.encoder=a,this.clientStructs=[]}}let pA=(a,b)=>{if(a.constructor===qt){let{client:c,clock:d}=a.id;return new qt(pf(c,d+b),a.length-b)}if(a.constructor===qR){let{client:c,clock:d}=a.id;return new qR(pf(c,d+b),a.length-b)}{let{client:c,clock:d}=a.id;return new qO(pf(c,d+b),null,pf(c,d+b-1),null,a.rightOrigin,a.parent,a.parentSub,a.content.splice(b))}},pB=(a,b=o0,c=o4)=>{if(1===a.length)return a[0];let d=a.map(a=>new b(n$(a))),e=d.map(a=>new py(a,!0)),f=null,g=new c,h=new pz(g);for(;(e=e.filter(a=>null!==a.curr)).sort((a,b)=>{if(a.curr.id.client!==b.curr.id.client)return b.curr.id.client-a.curr.id.client;{let c=a.curr.id.clock-b.curr.id.clock;return 0===c?a.curr.constructor===b.curr.constructor?0:a.curr.constructor===qR?1:-1:c}}),0!==e.length;){let a=e[0],b=a.curr.id.client;if(null!==f){let c=a.curr,d=!1;for(;null!==c&&c.id.clock+c.length<=f.struct.id.clock+f.struct.length&&c.id.client>=f.struct.id.client;)c=a.next(),d=!0;if(null===c||c.id.client!==b||d&&c.id.clock>f.struct.id.clock+f.struct.length)continue;if(b!==f.struct.id.client)pD(h,f.struct,f.offset),f={struct:c,offset:0},a.next();else if(f.struct.id.clock+f.struct.length<c.id.clock)if(f.struct.constructor===qR)f.struct.length=c.id.clock+c.length-f.struct.id.clock;else{pD(h,f.struct,f.offset);let a=c.id.clock-f.struct.id.clock-f.struct.length;f={struct:new qR(pf(b,f.struct.id.clock+f.struct.length),a),offset:0}}else{let b=f.struct.id.clock+f.struct.length-c.id.clock;b>0&&(f.struct.constructor===qR?f.struct.length-=b:c=pA(c,b)),f.struct.mergeWith(c)||(pD(h,f.struct,f.offset),f={struct:c,offset:0},a.next())}}else f={struct:a.curr,offset:0},a.next();for(let c=a.curr;null!==c&&c.id.client===b&&c.id.clock===f.struct.id.clock+f.struct.length&&c.constructor!==qR;c=a.next())pD(h,f.struct,f.offset),f={struct:c,offset:0}}return null!==f&&(pD(h,f.struct,f.offset),f=null),pE(h),oV(g,(a=>{let b=new oP;for(let c=0;c<a.length;c++)a[c].clients.forEach((d,e)=>{if(!b.clients.has(e)){let f=d.slice();for(let b=c+1;b<a.length;b++)nh(f,a[b].clients.get(e)||[]);b.clients.set(e,f)}});return oS(b),b})(d.map(a=>oW(a)))),g.toUint8Array()},pC=a=>{a.written>0&&(a.clientStructs.push({written:a.written,restEncoder:nD(a.encoder.restEncoder)}),a.encoder.restEncoder=nB(),a.written=0)},pD=(a,b,c)=>{a.written>0&&a.currClient!==b.id.client&&pC(a),0===a.written&&(a.currClient=b.id.client,a.encoder.writeClient(b.id.client),nF(a.encoder.restEncoder,b.id.clock+c)),b.write(a.encoder,c),a.written++},pE=a=>{pC(a);let b=a.encoder.restEncoder;nF(b,a.clientStructs.length);for(let c=0;c<a.clientStructs.length;c++){let d=a.clientStructs[c];nF(b,d.written),nK(b,d.restEncoder)}},pF="You must not compute changes after the event-handler fired.";class pG{constructor(a,b){this.target=a,this.currentTarget=a,this.transaction=b,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=pH(this.currentTarget,this.target))}deletes(a){return oR(this.transaction.deleteSet,a.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw Error(pF);let a=new Map,b=this.target;this.transaction.changed.get(b).forEach(c=>{if(null!==c){let d,e,f=b._map.get(c);if(this.adds(f)){let a=f.left;for(;null!==a&&this.adds(a);)a=a.left;if(this.deletes(f))if(!(null!==a&&this.deletes(a)))return;else d="delete",e=ng(a.content.getContent());else null!==a&&this.deletes(a)?(d="update",e=ng(a.content.getContent())):(d="add",e=void 0)}else{if(!this.deletes(f))return;d="delete",e=ng(f.content.getContent())}a.set(c,{action:d,oldValue:e})}}),this._keys=a}return this._keys}get delta(){return this.changes.delta}adds(a){return a.id.clock>=(this.transaction.beforeState.get(a.id.client)||0)}get changes(){let a=this._changes;if(null===a){if(0===this.transaction.doc._transactionCleanups.length)throw Error(pF);let b=this.target,c=nf(),d=nf(),e=[];if(a={added:c,deleted:d,delta:e,keys:this.keys},this.transaction.changed.get(b).has(null)){let a=null,f=()=>{a&&e.push(a)};for(let e=b._start;null!==e;e=e.right)e.deleted?this.deletes(e)&&!this.adds(e)&&((null===a||void 0===a.delete)&&(f(),a={delete:0}),a.delete+=e.length,d.add(e)):this.adds(e)?((null===a||void 0===a.insert)&&(f(),a={insert:[]}),a.insert=a.insert.concat(e.content.getContent()),c.add(e)):((null===a||void 0===a.retain)&&(f(),a={retain:0}),a.retain+=e.length);null!==a&&void 0===a.retain&&f()}this._changes=a}return a}}let pH=(a,b)=>{let c=[];for(;null!==b._item&&b!==a;){if(null!==b._item.parentSub)c.unshift(b._item.parentSub);else{let a=0,d=b._item.parent._start;for(;d!==b._item&&null!==d;)!d.deleted&&d.countable&&(a+=d.length),d=d.right;c.unshift(a)}b=b._item.parent}return c},pI=()=>{((...a)=>{console.warn(...oL(a))})("Invalid access: Add Yjs type to a document before reading data.")},pJ=0;class pK{constructor(a,b){a.marker=!0,this.p=a,this.index=b,this.timestamp=pJ++}}let pL=(a,b,c)=>{a.p.marker=!1,a.p=b,b.marker=!0,a.index=c,a.timestamp=pJ++},pM=(a,b)=>{if(null===a._start||0===b||null===a._searchMarker)return null;let c=0===a._searchMarker.length?null:a._searchMarker.reduce((a,c)=>nn(b-a.index)<nn(b-c.index)?a:c),d=a._start,e=0;for(null!==c&&(d=c.p,e=c.index,c.timestamp=pJ++);null!==d.right&&e<b;){if(!d.deleted&&d.countable){if(b<e+d.length)break;e+=d.length}d=d.right}for(;null!==d.left&&e>b;)!(d=d.left).deleted&&d.countable&&(e-=d.length);for(;null!==d.left&&d.left.id.client===d.id.client&&d.left.id.clock+d.left.length===d.id.clock;)!(d=d.left).deleted&&d.countable&&(e-=d.length);if(null!==c&&nn(c.index-e)<d.parent.length/80)return pL(c,d,e),c;var f=a._searchMarker,g=d,h=e;if(f.length>=80){let a=f.reduce((a,b)=>a.timestamp<b.timestamp?a:b);return pL(a,g,h),a}{let a=new pK(g,h);return f.push(a),a}},pN=(a,b,c)=>{for(let d=a.length-1;d>=0;d--){let e=a[d];if(c>0){let b=e.p;for(b.marker=!1;b&&(b.deleted||!b.countable);)(b=b.left)&&!b.deleted&&b.countable&&(e.index-=b.length);if(null===b||!0===b.marker){a.splice(d,1);continue}e.p=b,b.marker=!0}(b<e.index||c>0&&b===e.index)&&(e.index=np(b,e.index+c))}},pO=(a,b,c)=>{let d=a,e=b.changedParentTypes;for(;ne(e,a,()=>[]).push(c),null!==a._item;)a=a._item.parent;pc(d._eH,c,b)};class pP{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=pa(),this._dEH=pa(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(a,b){this.doc=a,this._item=b}_copy(){throw nV()}clone(){throw nV()}_write(a){}get _first(){let a=this._start;for(;null!==a&&a.deleted;)a=a.right;return a}_callObserver(a,b){!a.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(a){let b;b=this._eH,b.l.push(a)}observeDeep(a){let b;b=this._dEH,b.l.push(a)}unobserve(a){pb(this._eH,a)}unobserveDeep(a){pb(this._dEH,a)}toJSON(){}}let pQ=(a,b,c)=>{a.doc??pI(),b<0&&(b=a._length+b),c<0&&(c=a._length+c);let d=c-b,e=[],f=a._start;for(;null!==f&&d>0;){if(f.countable&&!f.deleted){let a=f.content.getContent();if(a.length<=b)b-=a.length;else{for(let c=b;c<a.length&&d>0;c++)e.push(a[c]),d--;b=0}}f=f.right}return e},pR=a=>{a.doc??pI();let b=[],c=a._start;for(;null!==c;){if(c.countable&&!c.deleted){let a=c.content.getContent();for(let c=0;c<a.length;c++)b.push(a[c])}c=c.right}return b},pS=(a,b)=>{let c=0,d=a._start;for(a.doc??pI();null!==d;){if(d.countable&&!d.deleted){let e=d.content.getContent();for(let d=0;d<e.length;d++)b(e[d],c++,a)}d=d.right}},pT=(a,b)=>{let c=[];return pS(a,(d,e)=>{c.push(b(d,e,a))}),c},pU=(a,b)=>{a.doc??pI();let c=pM(a,b),d=a._start;for(null!==c&&(d=c.p,b-=c.index);null!==d;d=d.right)if(!d.deleted&&d.countable){if(b<d.length)return d.content.getContent()[b];b-=d.length}},pV=(a,b,c,d)=>{let e=c,f=a.doc,g=f.clientID,h=f.store,i=null===c?b._start:c.right,j=[],k=()=>{j.length>0&&((e=new qO(pf(g,pk(h,g)),e,e&&e.lastId,i,i&&i.id,b,null,new qC(j))).integrate(a,0),j=[])};d.forEach(c=>{if(null===c)j.push(c);else switch(c.constructor){case Number:case Object:case Boolean:case Array:case String:j.push(c);break;default:switch(k(),c.constructor){case Uint8Array:case ArrayBuffer:(e=new qO(pf(g,pk(h,g)),e,e&&e.lastId,i,i&&i.id,b,null,new qu(new Uint8Array(c)))).integrate(a,0);break;case oY:(e=new qO(pf(g,pk(h,g)),e,e&&e.lastId,i,i&&i.id,b,null,new qx(c))).integrate(a,0);break;default:if(c instanceof pP)(e=new qO(pf(g,pk(h,g)),e,e&&e.lastId,i,i&&i.id,b,null,new qM(c))).integrate(a,0);else throw Error("Unexpected content type in insert operation")}}}),k()},pW=(a,b,c,d)=>{if(c>b._length)throw Error("Length exceeded!");if(0===c)return b._searchMarker&&pN(b._searchMarker,c,d.length),pV(a,b,null,d);let e=c,f=pM(b,c),g=b._start;for(null!==f&&(g=f.p,0==(c-=f.index)&&(c+=(g=g.prev)&&g.countable&&!g.deleted?g.length:0));null!==g;g=g.right)if(!g.deleted&&g.countable){if(c<=g.length){c<g.length&&pp(a,pf(g.id.client,g.id.clock+c));break}c-=g.length}return b._searchMarker&&pN(b._searchMarker,e,d.length),pV(a,b,g,d)},pX=(a,b,c,d)=>{if(0===d)return;let e=c,f=d,g=pM(b,c),h=b._start;for(null!==g&&(h=g.p,c-=g.index);null!==h&&c>0;h=h.right)!h.deleted&&h.countable&&(c<h.length&&pp(a,pf(h.id.client,h.id.clock+c)),c-=h.length);for(;d>0&&null!==h;)h.deleted||(d<h.length&&pp(a,pf(h.id.client,h.id.clock+d)),h.delete(a),d-=h.length),h=h.right;if(d>0)throw Error("Length exceeded!");b._searchMarker&&pN(b._searchMarker,e,-f+d)},pY=(a,b,c)=>{let d=b._map.get(c);void 0!==d&&d.delete(a)},pZ=(a,b,c,d)=>{let e,f=b._map.get(c)||null,g=a.doc,h=g.clientID;if(null==d)e=new qC([d]);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:e=new qC([d]);break;case Uint8Array:e=new qu(d);break;case oY:e=new qx(d);break;default:if(d instanceof pP)e=new qM(d);else throw Error("Unexpected content type")}new qO(pf(h,pk(g.store,h)),f,f&&f.lastId,null,null,b,c,e).integrate(a,0)},p$=(a,b)=>{a.doc??pI();let c=a._map.get(b);return void 0===c||c.deleted?void 0:c.content.getContent()[c.length-1]},p_=a=>{let b={};return a.doc??pI(),a._map.forEach((a,c)=>{a.deleted||(b[c]=a.content.getContent()[a.length-1])}),b},p0=(a,b)=>{a.doc??pI();let c=a._map.get(b);return void 0!==c&&!c.deleted},p1=a=>{let b,c;return a.doc??pI(),b=a._map.entries(),c=a=>!a[1].deleted,oM(()=>{let a;do a=b.next();while(!a.done&&!c(a.value))return a})};class p2 extends pG{}class p3 extends pP{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(a){let b=new p3;return b.push(a),b}_integrate(a,b){super._integrate(a,b),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new p3}clone(){let a=new p3;return a.insert(0,this.toArray().map(a=>a instanceof pP?a.clone():a)),a}get length(){return this.doc??pI(),this._length}_callObserver(a,b){super._callObserver(a,b),pO(this,a,new p2(this,a))}insert(a,b){null!==this.doc?px(this.doc,c=>{pW(c,this,a,b)}):this._prelimContent.splice(a,0,...b)}push(a){null!==this.doc?px(this.doc,b=>{((a,b,c)=>{let d=(b._searchMarker||[]).reduce((a,b)=>b.index>a.index?b:a,{index:0,p:b._start}).p;if(d)for(;d.right;)d=d.right;return pV(a,b,d,c)})(b,this,a)}):this._prelimContent.push(...a)}unshift(a){this.insert(0,a)}delete(a,b=1){null!==this.doc?px(this.doc,c=>{pX(c,this,a,b)}):this._prelimContent.splice(a,b)}get(a){return pU(this,a)}toArray(){return pR(this)}slice(a=0,b=this.length){return pQ(this,a,b)}toJSON(){return this.map(a=>a instanceof pP?a.toJSON():a)}map(a){return pT(this,a)}forEach(a){pS(this,a)}[Symbol.iterator](){let a,b,c;return a=this._start,b=null,c=0,{[Symbol.iterator](){return this},next:()=>{if(null===b){for(;null!==a&&a.deleted;)a=a.right;if(null===a)return{done:!0,value:void 0};b=a.content.getContent(),c=0,a=a.right}let d=b[c++];return b.length<=c&&(b=null),{done:!1,value:d}}}}_write(a){a.writeTypeRef(qF)}}class p4 extends pG{constructor(a,b,c){super(a,b),this.keysChanged=c}}class p5 extends pP{constructor(a){super(),this._prelimContent=null,void 0===a?this._prelimContent=new Map:this._prelimContent=new Map(a)}_integrate(a,b){super._integrate(a,b),this._prelimContent.forEach((a,b)=>{this.set(b,a)}),this._prelimContent=null}_copy(){return new p5}clone(){let a=new p5;return this.forEach((b,c)=>{a.set(c,b instanceof pP?b.clone():b)}),a}_callObserver(a,b){pO(this,a,new p4(this,a,b))}toJSON(){this.doc??pI();let a={};return this._map.forEach((b,c)=>{if(!b.deleted){let d=b.content.getContent()[b.length-1];a[c]=d instanceof pP?d.toJSON():d}}),a}get size(){return[...p1(this)].length}keys(){return oN(p1(this),a=>a[0])}values(){return oN(p1(this),a=>a[1].content.getContent()[a[1].length-1])}entries(){return oN(p1(this),a=>[a[0],a[1].content.getContent()[a[1].length-1]])}forEach(a){this.doc??pI(),this._map.forEach((b,c)=>{b.deleted||a(b.content.getContent()[b.length-1],c,this)})}[Symbol.iterator](){return this.entries()}delete(a){null!==this.doc?px(this.doc,b=>{pY(b,this,a)}):this._prelimContent.delete(a)}set(a,b){return null!==this.doc?px(this.doc,c=>{pZ(c,this,a,b)}):this._prelimContent.set(a,b),b}get(a){return p$(this,a)}has(a){return p0(this,a)}clear(){null!==this.doc?px(this.doc,a=>{this.forEach(function(b,c,d){pY(a,d,c)})}):this._prelimContent.clear()}_write(a){a.writeTypeRef(qG)}}let p6=(a,b)=>{let c,d;return a===b||"object"==typeof a&&"object"==typeof b&&a&&b&&((c=a)===(d=b)||om(c).length===om(d).length&&((a,b)=>{for(let c in a)if(!b(a[c],c))return!1;return!0})(c,(a,b)=>{let c;return(void 0!==a||on(d,b))&&((c=d[b])===a||!!c?.[ok]?.(a))}))};class p7{constructor(a,b,c,d){this.left=a,this.right=b,this.index=c,this.currentAttributes=d}forward(){null===this.right&&nW(),this.right.content.constructor===qz?this.right.deleted||qb(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}}let p8=(a,b,c)=>{for(;null!==b.right&&c>0;)b.right.content.constructor===qz?b.right.deleted||qb(b.currentAttributes,b.right.content):b.right.deleted||(c<b.right.length&&pp(a,pf(b.right.id.client,b.right.id.clock+c)),b.index+=b.right.length,c-=b.right.length),b.left=b.right,b.right=b.right.right;return b},p9=(a,b,c,d)=>{let e=new Map,f=d?pM(b,c):null;return f?p8(a,new p7(f.p.left,f.p,f.index,e),c-f.index):p8(a,new p7(null,b._start,0,e),c)},qa=(a,b,c,d)=>{for(;null!==c.right&&(!0===c.right.deleted||c.right.content.constructor===qz&&p6(d.get(c.right.content.key),c.right.content.value));)c.right.deleted||d.delete(c.right.content.key),c.forward();let e=a.doc,f=e.clientID;d.forEach((d,g)=>{let h=c.left,i=c.right,j=new qO(pf(f,pk(e.store,f)),h,h&&h.lastId,i,i&&i.id,b,null,new qz(g,d));j.integrate(a,0),c.right=j,c.forward()})},qb=(a,b)=>{let{key:c,value:d}=b;null===d?a.delete(c):a.set(c,d)},qc=(a,b)=>{for(;null!==a.right&&(a.right.deleted||a.right.content.constructor===qz&&p6(b[a.right.content.key]??null,a.right.content.value));){;a.forward()}},qd=(a,b,c,d)=>{let e=a.doc,f=e.clientID,g=new Map;for(let h in d){let i=d[h],j=c.currentAttributes.get(h)??null;if(!p6(j,i)){g.set(h,j);let{left:d,right:k}=c;c.right=new qO(pf(f,pk(e.store,f)),d,d&&d.lastId,k,k&&k.id,b,null,new qz(h,i)),c.right.integrate(a,0),c.forward()}}return g},qe=(a,b,c,d,e)=>{c.currentAttributes.forEach((a,b)=>{void 0===e[b]&&(e[b]=null)});let f=a.doc,g=f.clientID;qc(c,e);let h=qd(a,b,c,e),i=d.constructor===String?new qD(d):d instanceof pP?new qM(d):new qy(d),{left:j,right:k,index:l}=c;b._searchMarker&&pN(b._searchMarker,c.index,i.getLength()),(k=new qO(pf(g,pk(f.store,g)),j,j&&j.lastId,k,k&&k.id,b,null,i)).integrate(a,0),c.right=k,c.index=l,c.forward(),qa(a,b,c,h)},qf=(a,b,c,d,e)=>{let f=a.doc,g=f.clientID;qc(c,e);let h=qd(a,b,c,e);for(;null!==c.right&&(d>0||h.size>0&&(c.right.deleted||c.right.content.constructor===qz));){if(!c.right.deleted)if(c.right.content.constructor===qz){let{key:b,value:f}=c.right.content,g=e[b];if(void 0!==g){if(p6(g,f))h.delete(b);else{if(0===d)break;h.set(b,f)}c.right.delete(a)}else c.currentAttributes.set(b,f)}else d<c.right.length&&pp(a,pf(c.right.id.client,c.right.id.clock+d)),d-=c.right.length;c.forward()}if(d>0){let e="";for(;d>0;d--)e+="\n";c.right=new qO(pf(g,pk(f.store,g)),c.left,c.left&&c.left.lastId,c.right,c.right&&c.right.id,b,null,new qD(e)),c.right.integrate(a,0),c.forward()}qa(a,b,c,h)},qg=(a,b,c,d,e)=>{let f=b,g=nc();for(;f&&(!f.countable||f.deleted);){if(!f.deleted&&f.content.constructor===qz){let a=f.content;g.set(a.key,a)}f=f.right}let h=0,i=!1;for(;b!==f;){if(c===b&&(i=!0),!b.deleted){let c=b.content;if(c.constructor===qz){let{key:f,value:j}=c,k=d.get(f)??null;(g.get(f)!==c||k===j)&&(b.delete(a),h++,i||(e.get(f)??null)!==j||k===j||(null===k?e.delete(f):e.set(f,k))),i||b.deleted||qb(e,c)}}b=b.right}return h},qh=a=>{let b=0;return px(a.doc,c=>{let d=a._start,e=a._start,f=nc(),g=nd(f);for(;e;)!1===e.deleted&&(e.content.constructor===qz?qb(g,e.content):(b+=qg(c,d,e,f,g),f=nd(g),d=e)),e=e.right}),b},qi=a=>{let b=new Set,c=a.doc;for(let[d,e]of a.afterState.entries()){let f=a.beforeState.get(d)||0;e!==f&&pr(a,c.store.clients.get(d),f,e,a=>{a.deleted||a.content.constructor!==qz||a.constructor===qt||b.add(a.parent)})}px(c,c=>{for(let d of(oQ(a,a.deleteSet,a=>{if(a instanceof qt||!a.parent._hasFormatting||b.has(a.parent))return;let d=a.parent;if(a.content.constructor===qz)b.add(d);else{for(var e=a;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;let b=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===qz){let a=e.content.key;b.has(a)?e.delete(c):b.add(a)}e=e.left}}}),b))qh(d)})},qj=(a,b,c)=>{let d=c,e=nd(b.currentAttributes),f=b.right;for(;c>0&&null!==b.right;){if(!1===b.right.deleted)switch(b.right.content.constructor){case qM:case qy:case qD:c<b.right.length&&pp(a,pf(b.right.id.client,b.right.id.clock+c)),c-=b.right.length,b.right.delete(a)}b.forward()}f&&qg(a,f,b.right,e,b.currentAttributes);let g=(b.left||b.right).parent;return g._searchMarker&&pN(g._searchMarker,b.index,-d+c),b};class qk extends pG{constructor(a,b,c){super(a,b),this.childListChanged=!1,this.keysChanged=new Set,c.forEach(a=>{null===a?this.childListChanged=!0:this.keysChanged.add(a)})}get changes(){if(null===this._changes){let a={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=a}return this._changes}get delta(){if(null===this._delta){let a=this.target.doc,b=[];px(a,a=>{let c=new Map,d=new Map,e=this.target._start,f=null,g={},h="",i=0,j=0,k=()=>{if(null!==f){let a=null;switch(f){case"delete":j>0&&(a={delete:j}),j=0;break;case"insert":("object"==typeof h||h.length>0)&&(a={insert:h},c.size>0&&(a.attributes={},c.forEach((b,c)=>{null!==b&&(a.attributes[c]=b)}))),h="";break;case"retain":i>0&&(a={retain:i},(a=>{for(let b in a)return!1;return!0})(g)||(a.attributes=ol({},g))),i=0}a&&b.push(a),f=null}};for(;null!==e;){switch(e.content.constructor){case qM:case qy:this.adds(e)?this.deletes(e)||(k(),f="insert",h=e.content.getContent()[0],k()):this.deletes(e)?("delete"!==f&&(k(),f="delete"),j+=1):e.deleted||("retain"!==f&&(k(),f="retain"),i+=1);break;case qD:this.adds(e)?this.deletes(e)||("insert"!==f&&(k(),f="insert"),h+=e.content.str):this.deletes(e)?("delete"!==f&&(k(),f="delete"),j+=e.length):e.deleted||("retain"!==f&&(k(),f="retain"),i+=e.length);break;case qz:{let{key:b,value:h}=e.content;if(this.adds(e))this.deletes(e)||(p6(c.get(b)??null,h)?null!==h&&e.delete(a):("retain"===f&&k(),p6(h,d.get(b)??null)?delete g[b]:g[b]=h));else if(this.deletes(e)){d.set(b,h);let a=c.get(b)??null;p6(a,h)||("retain"===f&&k(),g[b]=a)}else if(!e.deleted){d.set(b,h);let c=g[b];void 0!==c&&(p6(c,h)?null!==c&&e.delete(a):("retain"===f&&k(),null===h?delete g[b]:g[b]=h))}e.deleted||("insert"===f&&k(),qb(c,e.content))}}e=e.right}for(k();b.length>0;){let a=b[b.length-1];if(void 0!==a.retain&&void 0===a.attributes)b.pop();else break}}),this._delta=b}return this._delta}}class ql extends pP{constructor(a){super(),this._pending=void 0!==a?[()=>this.insert(0,a)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??pI(),this._length}_integrate(a,b){super._integrate(a,b);try{this._pending.forEach(a=>a())}catch(a){console.error(a)}this._pending=null}_copy(){return new ql}clone(){let a=new ql;return a.applyDelta(this.toDelta()),a}_callObserver(a,b){super._callObserver(a,b);let c=new qk(this,a,b);pO(this,a,c),!a.local&&this._hasFormatting&&(a._needFormattingCleanup=!0)}toString(){this.doc??pI();let a="",b=this._start;for(;null!==b;)!b.deleted&&b.countable&&b.content.constructor===qD&&(a+=b.content.str),b=b.right;return a}toJSON(){return this.toString()}applyDelta(a,{sanitize:b=!0}={}){null!==this.doc?px(this.doc,c=>{let d=new p7(null,this._start,0,new Map);for(let e=0;e<a.length;e++){let f=a[e];if(void 0!==f.insert){let g=b||"string"!=typeof f.insert||e!==a.length-1||null!==d.right||"\n"!==f.insert.slice(-1)?f.insert:f.insert.slice(0,-1);("string"!=typeof g||g.length>0)&&qe(c,this,d,g,f.attributes||{})}else void 0!==f.retain?qf(c,this,d,f.retain,f.attributes||{}):void 0!==f.delete&&qj(c,d,f.delete)}}):this._pending.push(()=>this.applyDelta(a))}toDelta(a,b,c){this.doc??pI();let d=[],e=new Map,f=this.doc,g="",h=this._start;function i(){if(g.length>0){let a={},b=!1;e.forEach((c,d)=>{b=!0,a[d]=c});let c={insert:g};b&&(c.attributes=a),d.push(c),g=""}}let j=()=>{for(;null!==h;){if(pg(h,a)||void 0!==b&&pg(h,b))switch(h.content.constructor){case qD:{let d=e.get("ychange");void 0===a||pg(h,a)?void 0===b||pg(h,b)?void 0!==d&&(i(),e.delete("ychange")):(void 0===d||d.user!==h.id.client||"added"!==d.type)&&(i(),e.set("ychange",c?c("added",h.id):{type:"added"})):(void 0===d||d.user!==h.id.client||"removed"!==d.type)&&(i(),e.set("ychange",c?c("removed",h.id):{type:"removed"})),g+=h.content.str;break}case qM:case qy:{i();let a={insert:h.content.getContent()[0]};if(e.size>0){let b={};a.attributes=b,e.forEach((a,c)=>{b[c]=a})}d.push(a);break}case qz:pg(h,a)&&(i(),qb(e,h.content))}h=h.right}i()};return a||b?px(f,c=>{a&&ph(c,a),b&&ph(c,b),j()},"cleanup"):j(),d}insert(a,b,c){if(b.length<=0)return;let d=this.doc;null!==d?px(d,d=>{let e=p9(d,this,a,!c);c||(c={},e.currentAttributes.forEach((a,b)=>{c[b]=a})),qe(d,this,e,b,c)}):this._pending.push(()=>this.insert(a,b,c))}insertEmbed(a,b,c){let d=this.doc;null!==d?px(d,d=>{let e=p9(d,this,a,!c);qe(d,this,e,b,c||{})}):this._pending.push(()=>this.insertEmbed(a,b,c||{}))}delete(a,b){if(0===b)return;let c=this.doc;null!==c?px(c,c=>{qj(c,p9(c,this,a,!0),b)}):this._pending.push(()=>this.delete(a,b))}format(a,b,c){if(0===b)return;let d=this.doc;null!==d?px(d,d=>{let e=p9(d,this,a,!1);null!==e.right&&qf(d,this,e,b,c)}):this._pending.push(()=>this.format(a,b,c))}removeAttribute(a){null!==this.doc?px(this.doc,b=>{pY(b,this,a)}):this._pending.push(()=>this.removeAttribute(a))}setAttribute(a,b){null!==this.doc?px(this.doc,c=>{pZ(c,this,a,b)}):this._pending.push(()=>this.setAttribute(a,b))}getAttribute(a){return p$(this,a)}getAttributes(){return p_(this)}_write(a){a.writeTypeRef(qH)}}class qm{constructor(a,b=()=>!0){this._filter=b,this._root=a,this._currentNode=a._start,this._firstCall=!0,a.doc??pI()}[Symbol.iterator](){return this}next(){let a=this._currentNode,b=a&&a.content&&a.content.type;if(null!==a&&(!this._firstCall||a.deleted||!this._filter(b)))do if(b=a.content.type,a.deleted||b.constructor!==qo&&b.constructor!==qn||null===b._start)for(;null!==a;){let b=a.next;if(null!==b){a=b;break}a=a.parent===this._root?null:a.parent._item}else a=b._start;while(null!==a&&(a.deleted||!this._filter(a.content.type)))return(this._firstCall=!1,null===a)?{value:void 0,done:!0}:(this._currentNode=a,{value:a.content.type,done:!1})}}class qn extends pP{constructor(){super(),this._prelimContent=[]}get firstChild(){let a=this._first;return a?a.content.getContent()[0]:null}_integrate(a,b){super._integrate(a,b),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new qn}clone(){let a=new qn;return a.insert(0,this.toArray().map(a=>a instanceof pP?a.clone():a)),a}get length(){return this.doc??pI(),null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(a){return new qm(this,a)}querySelector(a){a=a.toUpperCase();let b=new qm(this,b=>b.nodeName&&b.nodeName.toUpperCase()===a).next();return b.done?null:b.value}querySelectorAll(a){return a=a.toUpperCase(),ni(new qm(this,b=>b.nodeName&&b.nodeName.toUpperCase()===a))}_callObserver(a,b){pO(this,a,new qp(this,b,a))}toString(){return pT(this,a=>a.toString()).join("")}toJSON(){return this.toString()}toDOM(a=document,b={},c){let d=a.createDocumentFragment();return void 0!==c&&c._createAssociation(d,this),pS(this,e=>{d.insertBefore(e.toDOM(a,b,c),null)}),d}insert(a,b){null!==this.doc?px(this.doc,c=>{pW(c,this,a,b)}):this._prelimContent.splice(a,0,...b)}insertAfter(a,b){if(null!==this.doc)px(this.doc,c=>{pV(c,this,a&&a instanceof pP?a._item:a,b)});else{let c=this._prelimContent,d=null===a?0:c.findIndex(b=>b===a)+1;if(0===d&&null!==a)throw Error("Reference item not found");c.splice(d,0,...b)}}delete(a,b=1){null!==this.doc?px(this.doc,c=>{pX(c,this,a,b)}):this._prelimContent.splice(a,b)}toArray(){return pR(this)}push(a){this.insert(this.length,a)}unshift(a){this.insert(0,a)}get(a){return pU(this,a)}slice(a=0,b=this.length){return pQ(this,a,b)}forEach(a){pS(this,a)}_write(a){a.writeTypeRef(qJ)}}class qo extends qn{constructor(a="UNDEFINED"){super(),this.nodeName=a,this._prelimAttrs=new Map}get nextSibling(){let a=this._item?this._item.next:null;return a?a.content.type:null}get prevSibling(){let a=this._item?this._item.prev:null;return a?a.content.type:null}_integrate(a,b){super._integrate(a,b),this._prelimAttrs.forEach((a,b)=>{this.setAttribute(b,a)}),this._prelimAttrs=null}_copy(){return new qo(this.nodeName)}clone(){let a=new qo(this.nodeName);var b=this.getAttributes(),c=(b,c)=>{a.setAttribute(c,b)};for(let a in b)c(b[a],a);return a.insert(0,this.toArray().map(a=>a instanceof pP?a.clone():a)),a}toString(){let a=this.getAttributes(),b=[],c=[];for(let b in a)c.push(b);c.sort();let d=c.length;for(let e=0;e<d;e++){let d=c[e];b.push(d+'="'+a[d]+'"')}let e=this.nodeName.toLocaleLowerCase(),f=b.length>0?" "+b.join(" "):"";return`<${e}${f}>${super.toString()}</${e}>`}removeAttribute(a){null!==this.doc?px(this.doc,b=>{pY(b,this,a)}):this._prelimAttrs.delete(a)}setAttribute(a,b){null!==this.doc?px(this.doc,c=>{pZ(c,this,a,b)}):this._prelimAttrs.set(a,b)}getAttribute(a){return p$(this,a)}hasAttribute(a){return p0(this,a)}getAttributes(a){let b;return a?(b={},this._map.forEach((c,d)=>{let e=c;for(;null!==e&&(!a.sv.has(e.id.client)||e.id.clock>=(a.sv.get(e.id.client)||0));)e=e.left;null!==e&&pg(e,a)&&(b[d]=e.content.getContent()[e.length-1])}),b):p_(this)}toDOM(a=document,b={},c){let d=a.createElement(this.nodeName),e=this.getAttributes();for(let a in e){let b=e[a];"string"==typeof b&&d.setAttribute(a,b)}return pS(this,e=>{d.appendChild(e.toDOM(a,b,c))}),void 0!==c&&c._createAssociation(d,this),d}_write(a){a.writeTypeRef(qI),a.writeKey(this.nodeName)}}class qp extends pG{constructor(a,b,c){super(a,c),this.childListChanged=!1,this.attributesChanged=new Set,b.forEach(a=>{null===a?this.childListChanged=!0:this.attributesChanged.add(a)})}}class qq extends p5{constructor(a){super(),this.hookName=a}_copy(){return new qq(this.hookName)}clone(){let a=new qq(this.hookName);return this.forEach((b,c)=>{a.set(c,b)}),a}toDOM(a=document,b={},c){let d,e=b[this.hookName];return(d=void 0!==e?e.createDom(this):document.createElement(this.hookName)).setAttribute("data-yjs-hook",this.hookName),void 0!==c&&c._createAssociation(d,this),d}_write(a){a.writeTypeRef(qK),a.writeKey(this.hookName)}}class qr extends ql{get nextSibling(){let a=this._item?this._item.next:null;return a?a.content.type:null}get prevSibling(){let a=this._item?this._item.prev:null;return a?a.content.type:null}_copy(){return new qr}clone(){let a=new qr;return a.applyDelta(this.toDelta()),a}toDOM(a=document,b,c){let d=a.createTextNode(this.toString());return void 0!==c&&c._createAssociation(d,this),d}toString(){return this.toDelta().map(a=>{let b=[];for(let c in a.attributes){let d=[];for(let b in a.attributes[c])d.push({key:b,value:a.attributes[c][b]});d.sort((a,b)=>a.key<b.key?-1:1),b.push({nodeName:c,attrs:d})}b.sort((a,b)=>a.nodeName<b.nodeName?-1:1);let c="";for(let a=0;a<b.length;a++){let d=b[a];c+=`<${d.nodeName}`;for(let a=0;a<d.attrs.length;a++){let b=d.attrs[a];c+=` ${b.key}="${b.value}"`}c+=">"}c+=a.insert;for(let a=b.length-1;a>=0;a--)c+=`</${b[a].nodeName}>`;return c}).join("")}toJSON(){return this.toString()}_write(a){a.writeTypeRef(qL)}}class qs{constructor(a,b){this.id=a,this.length=b}get deleted(){throw nV()}mergeWith(a){return!1}write(a,b,c){throw nV()}integrate(a,b){throw nV()}}class qt extends qs{get deleted(){return!0}delete(){}mergeWith(a){return this.constructor===a.constructor&&(this.length+=a.length,!0)}integrate(a,b){b>0&&(this.id.clock+=b,this.length-=b),pl(a.doc.store,this)}write(a,b){a.writeInfo(0),a.writeLen(this.length-b)}getMissing(a,b){return null}}class qu{constructor(a){this.content=a}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new qu(this.content)}splice(a){throw nV()}mergeWith(a){return!1}integrate(a,b){}delete(a){}gc(a){}write(a,b){a.writeBuf(this.content)}getRef(){return 3}}class qv{constructor(a){this.len=a}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new qv(this.len)}splice(a){let b=new qv(this.len-a);return this.len=a,b}mergeWith(a){return this.len+=a.len,!0}integrate(a,b){oT(a.deleteSet,b.id.client,b.id.clock,this.len),b.markDeleted()}delete(a){}gc(a){}write(a,b){a.writeLen(this.len-b)}getRef(){return 1}}let qw=(a,b)=>new oY({guid:a,...b,shouldLoad:b.shouldLoad||b.autoLoad||!1});class qx{constructor(a){a._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=a;const b={};this.opts=b,a.gc||(b.gc=!1),a.autoLoad&&(b.autoLoad=!0),null!==a.meta&&(b.meta=a.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new qx(qw(this.doc.guid,this.opts))}splice(a){throw nV()}mergeWith(a){return!1}integrate(a,b){this.doc._item=b,a.subdocsAdded.add(this.doc),this.doc.shouldLoad&&a.subdocsLoaded.add(this.doc)}delete(a){a.subdocsAdded.has(this.doc)?a.subdocsAdded.delete(this.doc):a.subdocsRemoved.add(this.doc)}gc(a){}write(a,b){a.writeString(this.doc.guid),a.writeAny(this.opts)}getRef(){return 9}}class qy{constructor(a){this.embed=a}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new qy(this.embed)}splice(a){throw nV()}mergeWith(a){return!1}integrate(a,b){}delete(a){}gc(a){}write(a,b){a.writeJSON(this.embed)}getRef(){return 5}}class qz{constructor(a,b){this.key=a,this.value=b}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new qz(this.key,this.value)}splice(a){throw nV()}mergeWith(a){return!1}integrate(a,b){let c=b.parent;c._searchMarker=null,c._hasFormatting=!0}delete(a){}gc(a){}write(a,b){a.writeKey(this.key),a.writeJSON(this.value)}getRef(){return 6}}class qA{constructor(a){this.arr=a}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new qA(this.arr)}splice(a){let b=new qA(this.arr.slice(a));return this.arr=this.arr.slice(0,a),b}mergeWith(a){return this.arr=this.arr.concat(a.arr),!0}integrate(a,b){}delete(a){}gc(a){}write(a,b){let c=this.arr.length;a.writeLen(c-b);for(let d=b;d<c;d++){let b=this.arr[d];a.writeString(void 0===b?"undefined":JSON.stringify(b))}}getRef(){return 2}}let qB="development"===ox("node_env");class qC{constructor(a){this.arr=a,qB&&op(a)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new qC(this.arr)}splice(a){let b=new qC(this.arr.slice(a));return this.arr=this.arr.slice(0,a),b}mergeWith(a){return this.arr=this.arr.concat(a.arr),!0}integrate(a,b){}delete(a){}gc(a){}write(a,b){let c=this.arr.length;a.writeLen(c-b);for(let d=b;d<c;d++){let b=this.arr[d];a.writeAny(b)}}getRef(){return 8}}class qD{constructor(a){this.str=a}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new qD(this.str)}splice(a){let b=new qD(this.str.slice(a));this.str=this.str.slice(0,a);let c=this.str.charCodeAt(a-1);return c>=55296&&c<=56319&&(this.str=this.str.slice(0,a-1)+"",b.str=""+b.str.slice(1)),b}mergeWith(a){return this.str+=a.str,!0}integrate(a,b){}delete(a){}gc(a){}write(a,b){a.writeString(0===b?this.str:this.str.slice(b))}getRef(){return 4}}let qE=[a=>new p3,a=>new p5,a=>new ql,a=>new qo(a.readKey()),a=>new qn,a=>new qq(a.readKey()),a=>new qr],qF=0,qG=1,qH=2,qI=3,qJ=4,qK=5,qL=6;class qM{constructor(a){this.type=a}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new qM(this.type._copy())}splice(a){throw nV()}mergeWith(a){return!1}integrate(a,b){this.type._integrate(a.doc,b)}delete(a){let b=this.type._start;for(;null!==b;)b.deleted?b.id.clock<(a.beforeState.get(b.id.client)||0)&&a._mergeStructs.push(b):b.delete(a),b=b.right;this.type._map.forEach(b=>{b.deleted?b.id.clock<(a.beforeState.get(b.id.client)||0)&&a._mergeStructs.push(b):b.delete(a)}),a.changed.delete(this.type)}gc(a){let b=this.type._start;for(;null!==b;)b.gc(a,!0),b=b.right;this.type._start=null,this.type._map.forEach(b=>{for(;null!==b;)b.gc(a,!0),b=b.left}),this.type._map=new Map}write(a,b){this.type._write(a)}getRef(){return 7}}let qN=(a,b,c)=>{let{client:d,clock:e}=b.id,f=new qO(pf(d,e+c),b,pf(d,e+c-1),b.right,b.rightOrigin,b.parent,b.parentSub,b.content.splice(c));return b.deleted&&f.markDeleted(),b.keep&&(f.keep=!0),null!==b.redone&&(f.redone=pf(b.redone.client,b.redone.clock+c)),b.right=f,null!==f.right&&(f.right.left=f),a._mergeStructs.push(f),null!==f.parentSub&&null===f.right&&f.parent._map.set(f.parentSub,f),b.length=c,f};class qO extends qs{constructor(a,b,c,d,e,f,g,h){super(a,h.getLength()),this.origin=c,this.left=b,this.right=d,this.rightOrigin=e,this.parent=f,this.parentSub=g,this.redone=null,this.content=h,this.info=2*!!this.content.isCountable()}set marker(a){(8&this.info)>0!==a&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(a){this.keep!==a&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(a){this.deleted!==a&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(a,b){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=pk(b,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=pk(b,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===pd&&this.id.client!==this.parent.client&&this.parent.clock>=pk(b,this.parent.client))return this.parent.client;if(this.origin&&(this.left=pq(a,b,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=pp(a,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===qt||this.right&&this.right.constructor===qt)this.parent=null;else if(this.parent){if(this.parent.constructor===pd){let a=pn(b,this.parent);a.constructor===qt?this.parent=null:this.parent=a.content.type}}else this.left&&this.left.constructor===qO?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===qO&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(a,b){if(b>0&&(this.id.clock+=b,this.left=pq(a,a.doc.store,pf(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(b),this.length-=b),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let b,c=this.left;if(null!==c)b=c.right;else if(null!==this.parentSub)for(b=this.parent._map.get(this.parentSub)||null;null!==b&&null!==b.left;)b=b.left;else b=this.parent._start;let d=new Set,e=new Set;for(;null!==b&&b!==this.right;){if(e.add(b),d.add(b),pe(this.origin,b.origin)){if(b.id.client<this.id.client)c=b,d.clear();else if(pe(this.rightOrigin,b.rightOrigin))break}else if(null!==b.origin&&e.has(pn(a.doc.store,b.origin)))d.has(pn(a.doc.store,b.origin))||(c=b,d.clear());else break;b=b.right}this.left=c}if(null!==this.left){let a=this.left.right;this.right=a,this.left.right=this}else{let a;if(null!==this.parentSub)for(a=this.parent._map.get(this.parentSub)||null;null!==a&&null!==a.left;)a=a.left;else a=this.parent._start,this.parent._start=this;this.right=a}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(a)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),pl(a.doc.store,this),this.content.integrate(a,this),pu(a,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(a)}else new qt(this.id,this.length).integrate(a,0)}get next(){let a=this.right;for(;null!==a&&a.deleted;)a=a.right;return a}get prev(){let a=this.left;for(;null!==a&&a.deleted;)a=a.left;return a}get lastId(){return 1===this.length?this.id:pf(this.id.client,this.id.clock+this.length-1)}mergeWith(a){if(this.constructor===a.constructor&&pe(a.origin,this.lastId)&&this.right===a&&pe(this.rightOrigin,a.rightOrigin)&&this.id.client===a.id.client&&this.id.clock+this.length===a.id.clock&&this.deleted===a.deleted&&null===this.redone&&null===a.redone&&this.content.constructor===a.content.constructor&&this.content.mergeWith(a.content)){let b=this.parent._searchMarker;return b&&b.forEach(b=>{b.p===a&&(b.p=this,!this.deleted&&this.countable&&(b.index-=this.length))}),a.keep&&(this.keep=!0),this.right=a.right,null!==this.right&&(this.right.left=this),this.length+=a.length,!0}return!1}delete(a){if(!this.deleted){let b=this.parent;this.countable&&null===this.parentSub&&(b._length-=this.length),this.markDeleted(),oT(a.deleteSet,this.id.client,this.id.clock,this.length),pu(a,b,this.parentSub),this.content.delete(a)}}gc(a,b){if(!this.deleted)throw nW();if(this.content.gc(a),b){var c;let b;c=new qt(this.id,this.length),(b=a.clients.get(this.id.client))[pm(b,this.id.clock)]=c}else this.content=new qv(this.length)}write(a,b){let c=b>0?pf(this.id.client,this.id.clock+b-1):this.origin,d=this.rightOrigin,e=this.parentSub,f=31&this.content.getRef()|128*(null!==c)|64*(null!==d)|32*(null!==e);if(a.writeInfo(f),null!==c&&a.writeLeftID(c),null!==d&&a.writeRightID(d),null===c&&null===d){let b=this.parent;if(void 0!==b._item){let c=b._item;if(null===c){let c=(a=>{for(let[b,c]of a.doc.share.entries())if(c===a)return b;throw nW()})(b);a.writeParentInfo(!0),a.writeString(c)}else a.writeParentInfo(!1),a.writeLeftID(c.id)}else b.constructor===String?(a.writeParentInfo(!0),a.writeString(b)):b.constructor===pd?(a.writeParentInfo(!1),a.writeLeftID(b)):nW();null!==e&&a.writeString(e)}this.content.write(a,b)}}let qP=(a,b)=>qQ[31&b](a),qQ=[()=>{nW()},a=>new qv(a.readLen()),a=>{let b=a.readLen(),c=[];for(let d=0;d<b;d++){let b=a.readString();"undefined"===b?c.push(void 0):c.push(JSON.parse(b))}return new qA(c)},a=>new qu(a.readBuf()),a=>new qD(a.readString()),a=>new qy(a.readJSON()),a=>new qz(a.readKey(),a.readJSON()),a=>new qM(qE[a.readTypeRef()](a)),a=>{let b=a.readLen(),c=[];for(let d=0;d<b;d++)c.push(a.readAny());return new qC(c)},a=>new qx(qw(a.readString(),a.readAny())),()=>{nW()}];class qR extends qs{get deleted(){return!0}delete(){}mergeWith(a){return this.constructor===a.constructor&&(this.length+=a.length,!0)}integrate(a,b){nW()}write(a,b){a.writeInfo(10),nF(a.restEncoder,this.length-b)}getMissing(a,b){return null}}let qS="undefined"!=typeof globalThis?globalThis:a.g,qT="__ $YJS$ __";!0===qS[qT]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),qS[qT]=!0;let qU=new Map,qV="undefined"==typeof BroadcastChannel?class{constructor(a){let b;this.room=a,this.onmessage=null,this._onChange=b=>{var c;let d;return b.key===a&&null!==this.onmessage&&this.onmessage({data:(c=b.newValue||"",new Uint8Array((d=Buffer.from(c,"base64")).buffer,d.byteOffset,d.byteLength))})},b=this._onChange,oi||addEventListener("storage",b)}postMessage(a){let b;oj.setItem(this.room,(b=new Uint8Array(a),Buffer.from(b.buffer,b.byteOffset,b.byteLength).toString("base64")))}close(){let a;a=this._onChange,oi||removeEventListener("storage",a)}}:BroadcastChannel,qW=a=>ne(qU,a,()=>{let b=nf(),c=new qV(a);return c.onmessage=a=>b.forEach(b=>b(a.data,"broadcastchannel")),{bc:c,subs:b}}),qX=(a,b,c=null)=>{let d=qW(a);d.bc.postMessage(b),d.subs.forEach(a=>a(b,c))},qY=(a,b)=>{nF(a,0),nL(a,((a,b=new o3)=>(a instanceof Map?o8(b,a):o8(b,pj(a.store)),b.toUint8Array()))(b,new o1))},qZ=(a,b,c)=>{nF(a,1),nL(a,((a,b=new Uint8Array([0]),c=new o4)=>{((a,b,c=new Map)=>{var d;let e;o5(a,b.store,c),oV(a,(d=b.store,e=oU(),d.clients.forEach((a,b)=>{let c=[];for(let b=0;b<a.length;b++){let d=a[b];if(d.deleted){let e=d.id.clock,f=d.length;if(b+1<a.length)for(let c=a[b+1];b+1<a.length&&c.deleted;c=a[++b+1])f+=c.length;c.push(new oO(e,f))}}c.length>0&&e.clients.set(b,c)}),e))})(c,a,o7(b));let d=[c.toUint8Array()];if(a.store.pendingDs&&d.push(a.store.pendingDs),a.store.pendingStructs&&d.push(((a,b,c=o0,d=o4)=>{let e=o7(b),f=new d,g=new pz(f),h=new c(n$(a)),i=new py(h,!1);for(;i.curr;){let a=i.curr,b=a.id.client,c=e.get(b)||0;if(i.curr.constructor===qR){i.next();continue}if(a.id.clock+a.length>c)for(pD(g,a,np(c-a.id.clock,0)),i.next();i.curr&&i.curr.id.client===b;)pD(g,i.curr,0),i.next();else for(;i.curr&&i.curr.id.client===b&&i.curr.id.clock+i.curr.length<=c;)i.next()}return pE(g),oV(f,oW(h)),f.toUint8Array()})(a.store.pendingStructs.update,b)),d.length>1){if(c.constructor===o2)return pB(d.map((a,b)=>0===b?a:((a,b,c,d)=>{let e=new c(n$(a)),f=new py(e,!1),g=new d,h=new pz(g);for(let a=f.curr;null!==a;a=f.next())pD(h,b(a),0);return pE(h),oV(g,oW(e)),g.toUint8Array()})(a,or,o0,o2)),o$,o2);else if(c.constructor===o4)return pB(d)}return d[0]})(b,c,new o2))};class q$ extends nl{constructor(a){super(),this.doc=a,this.clientID=a.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let a=oe();null!==this.getLocalState()&&15e3<=a-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let b=[];this.meta.forEach((c,d)=>{d!==this.clientID&&3e4<=a-c.lastUpdated&&this.states.has(d)&&b.push(d)}),b.length>0&&q_(this,b,"timeout")},nm(3e3)),a.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(a){let b=this.clientID,c=this.meta.get(b),d=void 0===c?0:c.clock+1,e=this.states.get(b);null===a?this.states.delete(b):this.states.set(b,a),this.meta.set(b,{clock:d,lastUpdated:oe()});let f=[],g=[],h=[],i=[];null===a?i.push(b):null==e?null!=a&&f.push(b):(g.push(b),ot(e,a)||h.push(b)),(f.length>0||h.length>0||i.length>0)&&this.emit("change",[{added:f,updated:h,removed:i},"local"]),this.emit("update",[{added:f,updated:g,removed:i},"local"])}setLocalStateField(a,b){let c=this.getLocalState();null!==c&&this.setLocalState({...c,[a]:b})}getStates(){return this.states}}let q_=(a,b,c)=>{let d=[];for(let c=0;c<b.length;c++){let e=b[c];if(a.states.has(e)){if(a.states.delete(e),e===a.clientID){let b=a.meta.get(e);a.meta.set(e,{clock:b.clock+1,lastUpdated:oe()})}d.push(e)}}d.length>0&&(a.emit("change",[{added:[],updated:[],removed:d},c]),a.emit("update",[{added:[],updated:[],removed:d},c]))},q0=(a,b,c=a.states)=>{let d=b.length,e=nB();nF(e,d);for(let f=0;f<d;f++){let d=b[f],g=c.get(d)||null,h=a.meta.get(d).clock;nF(e,d),nF(e,h),nJ(e,JSON.stringify(g))}return nD(e)},q1=[];q1[0]=(a,b,c,d,e)=>{nF(a,0);let f=((a,b,c,d,e)=>{let f=n1(a);switch(f){case 0:qZ(b,c,n_(a));break;case 1:case 2:var g=a,h=c,i=d,j=e;try{let a;a=n_(g),o6(h,a,i,o$)}catch(a){null!=j&&j(a),console.error("Caught error while handling a Yjs update",a)}break;default:throw Error("Unknown message type")}return f})(b,a,c.doc,c);d&&1===f&&!c.synced&&(c.synced=!0)},q1[3]=(a,b,c,d,e)=>{nF(a,1),nL(a,q0(c.awareness,Array.from(c.awareness.getStates().keys())))},q1[1]=(a,b,c,d,e)=>{((a,b,c)=>{let d=n$(b),e=oe(),f=[],g=[],h=[],i=[],j=n1(d);for(let b=0;b<j;b++){let b=n1(d),c=n1(d),j=JSON.parse(n3(d)),k=a.meta.get(b),l=a.states.get(b),m=void 0===k?0:k.clock;(m<c||m===c&&null===j&&a.states.has(b))&&(null===j?b===a.clientID&&null!=a.getLocalState()?c++:a.states.delete(b):a.states.set(b,j),a.meta.set(b,{clock:c,lastUpdated:e}),void 0===k&&null!==j?f.push(b):void 0!==k&&null===j?i.push(b):null!==j&&(ot(j,l)||h.push(b),g.push(b)))}(f.length>0||h.length>0||i.length>0)&&a.emit("change",[{added:f,updated:h,removed:i},c]),(f.length>0||g.length>0||i.length>0)&&a.emit("update",[{added:f,updated:g,removed:i},c])})(c.awareness,n_(b),c)},q1[2]=(a,b,c,d,e)=>{var f;f=c.doc,0===n1(b)&&((a,b)=>q2(c,b))(f,n3(b))};let q2=(a,b)=>console.warn(`Permission denied to access ${a.url}.
${b}`),q3=(a,b,c)=>{let d=n$(b),e=nB(),f=n1(d),g=a.messageHandlers[f];return g?g(e,d,a,c,f):console.error("Unable to compute message"),e},q4=(a,b,c)=>{b===a.ws&&(a.emit("connection-close",[c,a]),a.ws=null,b.close(),a.wsconnecting=!1,a.wsconnected?(a.wsconnected=!1,a.synced=!1,q_(a.awareness,Array.from(a.awareness.getStates().keys()).filter(b=>b!==a.doc.clientID),a),a.emit("status",[{status:"disconnected"}])):a.wsUnsuccessfulReconnects++,setTimeout(q5,no(100*nq(2,a.wsUnsuccessfulReconnects),a.maxBackoffTime),a))},q5=a=>{if(a.shouldConnect&&null===a.ws){let b=new a._WS(a.url,a.protocols);b.binaryType="arraybuffer",a.ws=b,a.wsconnecting=!0,a.wsconnected=!1,a.synced=!1,b.onmessage=c=>{a.wsLastMessageReceived=oe();let d=q3(a,new Uint8Array(c.data),!0);nC(d)>1&&b.send(nD(d))},b.onerror=b=>{a.emit("connection-error",[b,a])},b.onclose=c=>{q4(a,b,c)},b.onopen=()=>{a.wsLastMessageReceived=oe(),a.wsconnecting=!1,a.wsconnected=!0,a.wsUnsuccessfulReconnects=0,a.emit("status",[{status:"connected"}]);let c=nB();if(nF(c,0),qY(c,a.doc),b.send(nD(c)),null!==a.awareness.getLocalState()){let c=nB();nF(c,1),nL(c,q0(a.awareness,[a.doc.clientID])),b.send(nD(c))}},a.emit("status",[{status:"connecting"}])}},q6=(a,b)=>{let c=a.ws;a.wsconnected&&c&&c.readyState===c.OPEN&&c.send(b),a.bcconnected&&qX(a.bcChannel,b,a)};class q7 extends nk{constructor(a,b,c,{connect:d=!0,awareness:e=new q$(c),params:f={},protocols:g=[],WebSocketPolyfill:h=WebSocket,resyncInterval:i=-1,maxBackoffTime:j=2500,disableBc:k=!1}={}){for(super();"/"===a[a.length-1];)a=a.slice(0,a.length-1);this.serverUrl=a,this.bcChannel=a+"/"+b,this.maxBackoffTime=j,this.params=f,this.protocols=g,this.roomname=b,this.doc=c,this._WS=h,this.awareness=e,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=k,this.wsUnsuccessfulReconnects=0,this.messageHandlers=q1.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=d,this._resyncInterval=0,i>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let a=nB();nF(a,0),qY(a,c),this.ws.send(nD(a))}},i)),this._bcSubscriber=(a,b)=>{if(b!==this){let b=q3(this,new Uint8Array(a),!1);nC(b)>1&&qX(this.bcChannel,nD(b),this)}},this._updateHandler=(a,b)=>{if(b!==this){let b=nB();nF(b,0),nF(b,2),nL(b,a),q6(this,nD(b))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:a,updated:b,removed:c},d)=>{let f=a.concat(b).concat(c),g=nB();nF(g,1),nL(g,q0(e,f)),q6(this,nD(g))},this._exitHandler=()=>{q_(this.awareness,[c.clientID],"app closed")},ou&&"undefined"!=typeof process&&process.on("exit",this._exitHandler),e.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&3e4<oe()-this.wsLastMessageReceived&&q4(this,this.ws,null)},3e3),d&&this.connect()}get url(){let a=((a,b)=>{let c=[];for(let d in a)c.push(b(a[d],d));return c})(this.params,(a,b)=>`${encodeURIComponent(b)}=${encodeURIComponent(a)}`).join("&");return this.serverUrl+"/"+this.roomname+(0===a.length?"":"?"+a)}get synced(){return this._synced}set synced(a){this._synced!==a&&(this._synced=a,this.emit("synced",[a]),this.emit("sync",[a]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),ou&&"undefined"!=typeof process&&process.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;if(!this.bcconnected){var a,b;a=this.bcChannel,b=this._bcSubscriber,qW(a).subs.add(b),this.bcconnected=!0}let c=nB();nF(c,0),qY(c,this.doc),qX(this.bcChannel,nD(c),this);let d=nB();nF(d,0),qZ(d,this.doc),qX(this.bcChannel,nD(d),this);let e=nB();nF(e,3),qX(this.bcChannel,nD(e),this);let f=nB();nF(f,1),nL(f,q0(this.awareness,[this.doc.clientID])),qX(this.bcChannel,nD(f),this)}disconnectBc(){let a=nB();if(nF(a,1),nL(a,q0(this.awareness,[this.doc.clientID],new Map)),q6(this,nD(a)),this.bcconnected){var b,c;let a;b=this.bcChannel,c=this._bcSubscriber,(a=qW(b)).subs.delete(c)&&0===a.subs.size&&(a.bc.close(),qU.delete(b)),this.bcconnected=!1}}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&q4(this,this.ws,null)}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(q5(this),this.connectBc())}}class q8{supabase;constructor(a){this.supabase=a||(0,nb.createClient)()}providers=new Map;ydocs=new Map;activeUsers=new Map;async initializeCollaboration(a,b,c,d,e){let f=this.ydocs.get(a);f||(f=new oY,this.ydocs.set(a,f));let g=this.providers.get(a);if(!g){let c=process.env.NEXT_PUBLIC_WS_URL;if(!c)throw Error("Collaboration dsactive: aucun serveur WebSocket configur (NEXT_PUBLIC_WS_URL)");try{g=new q7(c,`template-${a}`,f,{params:{userId:b,templateId:a},resyncInterval:-1});let d=0;g.on("status",b=>{if("connected"===b.status)d=0,console.log("Collaboration status: connected");else if("disconnected"===b.status)if(++d<=3)console.warn(`WebSocket disconnected (tentative ${d}/3)`);else throw console.warn("WebSocket: trop de tentatives de connexion, collaboration dsactive"),g&&(g.destroy(),this.providers.delete(a)),Error("Impossible de se connecter au serveur de collaboration aprs plusieurs tentatives")}),g.on("connection-error",(a,b)=>{let c=a?.message||a?.error?.message||String(a);console.warn("Erreur de connexion WebSocket:",c)}),g.awareness.on("change",()=>{this.updateActiveUsers(a,g)}),this.providers.set(a,g)}catch(a){if(console.warn("Erreur lors de la cration du provider WebSocket:",a),g)try{g.destroy()}catch(a){}throw a}}let h=this.generateUserColor(b),i={id:b,name:c,email:d,avatarUrl:e,color:h};return this.activeUsers.has(a)||this.activeUsers.set(a,new Map),this.activeUsers.get(a).set(b,i),g.awareness.setLocalStateField("user",i),{ydoc:f,provider:g}}updateCursor(a,b,c,d){let e=this.providers.get(a);if(!e)return;let f=this.activeUsers.get(a);if(!f)return;let g=f.get(b);g&&(g.cursor={position:c,selection:d},e.awareness.setLocalStateField("user",g))}getActiveUsers(a){let b=this.activeUsers.get(a);return b?Array.from(b.values()):[]}updateActiveUsers(a,b){let c=b.awareness.getStates(),d=new Map;c.forEach((a,b)=>{if(a.user){let b=a.user;d.set(b.id,b)}}),this.activeUsers.set(a,d)}generateUserColor(a){let b=["#335ACF","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16"],c=0;for(let b=0;b<a.length;b++)c=a.charCodeAt(b)+((c<<5)-c);return b[Math.abs(c)%b.length]}disconnect(a,b){let c=this.providers.get(a);c&&c.awareness.setLocalStateField("user",null);let d=this.activeUsers.get(a);d&&d.delete(b)}cleanup(a){let b=this.providers.get(a);b&&(b.destroy(),this.providers.delete(a));let c=this.ydocs.get(a);c&&(c.destroy(),this.ydocs.delete(a)),this.activeUsers.delete(a)}async syncToSupabase(a,b,c){let d=b.getXmlFragment(c).toString(),e={};"header"===c?e.header={html:d,elements:[]}:"body"===c?e.content={html:d,elements:[]}:"footer"===c&&(e.footer={html:d,elements:[]});let{error:f}=await this.supabase.from("document_templates").update(e).eq("id",a);if(f)throw console.error("Erreur lors de la synchronisation:",f),f}async loadFromSupabase(a,b,c){let{data:d,error:e}=await this.supabase.from("document_templates").select("header, content, footer").eq("id",a).single();if(e)throw e;let f="";"header"===c?f=d.header?.html||"":"body"===c?f=d.content?.html||"":"footer"===c&&(f=d.footer?.html||"");let g=b.getXmlFragment(c),h=new qr;h.insert(0,f),g.insert(0,[h])}}let q9=new q8,ra=`
  <div style="width: 100%; padding: 10px 0 10px 0; margin-bottom: 12px; font-family: 'Times New Roman', Times, serif;">
    <table cellpadding="0" cellspacing="0" style="width: 100%; border: 0; table-layout: fixed;">
      <tr>
        <td style="width: 70%; vertical-align: top; padding-right: 15px; border: 0; text-align: left;">
          <p style="font-weight: bold; font-size: 7.5pt; font-family: 'Times New Roman', Times, serif; margin: 0 0 3px 0; color: #1A1A1A; line-height: 1.2;">
            {ecole_nom}
          </p>
          <p style="font-size: 7.5pt; font-family: 'Times New Roman', Times, serif; color: #666; margin: 1px 0; line-height: 1.3;">
            {ecole_adresse}
          </p>
          <p style="font-size: 7.5pt; font-family: 'Times New Roman', Times, serif; color: #666; margin: 1px 0; line-height: 1.3;">
            {ecole_code_postal} {ecole_ville}
          </p>
          <p style="font-size: 7.5pt; font-family: 'Times New Roman', Times, serif; color: #666; margin: 1px 0; line-height: 1.3;">
            Email : {ecole_email}
          </p>
          <p style="font-size: 7.5pt; font-family: 'Times New Roman', Times, serif; color: #666; margin: 1px 0; line-height: 1.3;">
            Tel : {ecole_telephone}
          </p>
        </td>
        <td style="width: 30%; vertical-align: top; border: 0; text-align: right;">
          {ecole_logo}
        </td>
      </tr>
    </table>
  </div>
`,rb=`
  <div style="padding: 8px 0 6px 0; margin-top: 10px; background-color: #FAFAFA; font-family: 'Times New Roman', Times, serif;">
    <p style="font-size: 7pt; font-family: 'Times New Roman', Times, serif; color: #1A1A1A; margin: 0; text-align: center; font-weight: 500; line-height: 1.3;">
      {ecole_nom} | {ecole_adresse} {ecole_ville} {ecole_code_postal} | Num\xe9ro SIRET: {ecole_siret}
    </p>
    <p style="font-size: 7pt; font-family: 'Times New Roman', Times, serif; color: #666; margin: 2px 0 0 0; text-align: center; line-height: 1.2;">
      Num\xe9ro de d\xe9claration d'activit\xe9: {ecole_numero_declaration} <em>(aupr\xe8s du pr\xe9fet de r\xe9gion de: {ecole_region})</em>
    </p>
    <p style="font-size: 7pt; font-family: 'Times New Roman', Times, serif; color: #888; font-style: italic; margin: 2px 0 0 0; text-align: center; line-height: 1.2;">
      Cet enregistrement ne vaut pas l'agr\xe9ment de l'\xc9tat.
    </p>
  </div>
`;function rc(a,b){return`
    <div style="margin-top: 40px;">
      <p style="text-align: center; margin-bottom: 25px; font-size: 10pt;">
        Fait \xe0 {ecole_ville}, le {date_jour}
      </p>
      
      <div style="display: flex; justify-content: space-between;">
        <div style="width: 45%; text-align: center;">
          <p style="font-weight: bold; margin-bottom: 50px; font-size: 10pt;">${a}</p>
          <p style="margin-bottom: 8px; font-size: 10pt;">{ecole_nom}</p>
          <div style="border-top: 1px solid #1A1A1A; margin: 0 auto; width: 80%; padding-top: 8px;">
            <p style="font-size: 9pt; color: #666;">Signature</p>
          </div>
        </div>
        <div style="width: 45%; text-align: center;">
          <p style="font-weight: bold; margin-bottom: 50px; font-size: 10pt;">${b}</p>
          <p style="margin-bottom: 8px; font-size: 10pt;">{eleve_nom} {eleve_prenom}</p>
          <div style="border-top: 1px solid #1A1A1A; margin: 0 auto; width: 80%; padding-top: 8px;">
            <p style="font-size: 9pt; color: #666;">Signature</p>
          </div>
        </div>
      </div>
    </div>
  `}let rd={convention:{type:"convention",name:"Contrat de formation professionnelle",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 25px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0 0 8px 0; color: #1A1A1A;">
          Contrat de formation professionnelle
        </h1>
        <p style="font-size: 9pt; color: #666; margin: 0; font-style: italic;">
          (Article L. 6353-1 du Code du Travail D\xe9cret N\xb0 2018-1341 du 28 d\xe9cembre 2018)
        </p>
      </div>

      <div style="margin-bottom: 25px;">
        <p style="font-weight: bold; margin: 0 0 12px 0; font-size: 11pt;">Entre l'organisme de formation : {ecole_nom}</p>
        <p style="margin: 0 0 3px 0; font-size: 10pt;">immatricul\xe9e au RCS de sous le num\xe9ro {ecole_siret}</p>
        <p style="margin: 0 0 10px 0; font-size: 10pt;">Dont le si\xe8ge social est situ\xe9 {ecole_adresse} {ecole_code_postal} {ecole_ville}.</p>
        
        <p style="margin: 12px 0 0 0; font-size: 10pt;">
          Repr\xe9sent\xe9e aux fins des pr\xe9sentes par {ecole_representant} en sa qualit\xe9 de repr\xe9sentant, d\xfbment habilit\xe9(e).
        </p>
        <p style="margin: 5px 0 0 0; font-size: 10pt;">
          D\xe9claration d'activit\xe9 n\xb0{ecole_numero_declaration} aupr\xe8s de la pr\xe9fecture de la r\xe9gion {ecole_region}.
        </p>
        
        <p style="margin: 15px 0 5px 0; font-weight: bold; font-style: italic; font-size: 10pt;">
          Ci-apr\xe8s d\xe9nomm\xe9e \xab l'Organisme de Formation \xbb
        </p>
        
        <p style="margin: 20px 0 10px 0; font-weight: bold; font-size: 11pt;">D'une part</p>
        
        <p style="margin: 20px 0 10px 0; font-weight: bold; font-size: 11pt;">Et {eleve_prenom} {eleve_nom}</p>
        
        <p style="margin: 15px 0 5px 0; font-weight: bold; font-style: italic; font-size: 10pt;">
          Ci-apr\xe8s d\xe9nomm\xe9e \xab le B\xe9n\xe9ficiaire \xbb
        </p>
        
        <p style="margin: 20px 0 10px 0; font-weight: bold; font-size: 11pt;">D'autre part</p>
        
        <p style="margin: 20px 0 15px 0; font-style: italic; font-size: 10pt;">
          Ci-apr\xe8s individuellement ou collectivement d\xe9sign\xe9(s) la ou les \xab Partie(s) \xbb
        </p>
      </div>

      <p style="text-align: justify; line-height: 1.6; margin: 20px 0; font-size: 10pt;">
        Il est conclu un contrat de formation professionnelle conform\xe9ment aux dispositions des articles L. 6311-1 \xe0 L. 6363-2 du Code du Travail, et 
        \xe9galement en application des dispositions du Livre III de la 6\xe8me partie et des cat\xe9gories pr\xe9vues \xe0 l'article L6313.1 du Code du Travail relatif \xe0 la 
        formation professionnelle continue tout au long de la vie
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">1. Objet du contrat</h2>
      <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
        Aux termes du pr\xe9sent contrat, l'Organisme de Formation s'engage \xe0 organiser l'action de formation suivante :
      </p>
      <p style="font-weight: bold; font-size: 11pt; margin: 10px 0;">{formation_nom} DU {session_debut} au {session_fin}</p>
      
      <p style="margin: 10px 0 5px 0; font-size: 10pt;">
        Cat\xe9gorie de l'action de formation (art. L6313-1 du code du travail) :<br/>
        <strong>Action de formation</strong>
      </p>
      
      <p style="margin: 15px 0 8px 0; font-size: 10pt;">
        Dipl\xf4me vis\xe9 : <strong>Certification (dont CQP) ou habilitation enregistr\xe9e au R\xe9pertoire National des Certifications Professionnelles (RNCP)</strong>
      </p>
      
      <p style="margin: 15px 0 5px 0; font-size: 10pt;">Objectifs : {formation_objectifs}</p>
      <p style="margin: 5px 0; font-size: 10pt;">Contenu de l'action de formation et moyens pr\xe9vus : Annexe 1</p>
      <p style="margin: 5px 0; font-size: 10pt;">Dur\xe9e : <strong>{formation_duree}</strong></p>
      <p style="margin: 5px 0; font-size: 10pt;">Lieu de la formation : <strong>{session_lieu}</strong></p>
      <p style="margin: 5px 0; font-size: 10pt;">Effectifs form\xe9s : <strong>{session_effectif}</strong></p>

      <table style="width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 10pt;">
        <thead>
          <tr style="background-color: #F3F4F6;">
            <th style="padding: 8px; text-align: left; border: 1px solid #E5E7EB; font-weight: bold;">Date</th>
            <th style="padding: 8px; text-align: center; border: 1px solid #E5E7EB; font-weight: bold;">Heure</th>
            <th style="padding: 8px; text-align: right; border: 1px solid #E5E7EB; font-weight: bold;">Lieu</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="padding: 8px; border: 1px solid #E5E7EB;">du {session_debut} au {session_fin}</td>
            <td style="padding: 8px; text-align: center; border: 1px solid #E5E7EB;">en pr\xe9sentiel</td>
            <td style="padding: 8px; text-align: right; border: 1px solid #E5E7EB;">en pr\xe9sentiel</td>
          </tr>
        </tbody>
      </table>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">2. Effectif form\xe9</h2>
      
      <p style="font-size: 10pt; margin: 0 0 10px 0;"><strong>Public vis\xe9 au sens de l'article L 6313-3 du Code du Travail :</strong></p>
      <ul style="margin: 10px 0 10px 20px; font-size: 10pt; line-height: 1.6;">
        <li>les actions de formation ont pour objet de permettre \xe0 toute personne sans qualification professionnelle ou sans contrat de travail d'acc\xe9der dans les meilleures conditions \xe0 un emploi</li>
        <li>favoriser l'adaptation des travailleurs \xe0 leur poste de travail, \xe0 l'\xe9volution des emplois ainsi que leur maintien dans l'emploi et de participer au d\xe9veloppement des comp\xe9tences en lien ou non avec leur poste de travail. Elles peuvent permettre \xe0 des travailleurs d'acqu\xe9rir une qualification plus \xe9lev\xe9e</li>
        <li>r\xe9duire, pour les travailleurs dont l'emploi est menac\xe9, les risques r\xe9sultant d'une qualification inadapt\xe9e \xe0 l'\xe9volution des techniques et des structures des entreprises, en les pr\xe9parant \xe0 une mutation d'activit\xe9 soit dans le cadre, soit en dehors de leur entreprise. Elles peuvent permettre \xe0 des salari\xe9s dont le contrat de travail est rompu d'acc\xe9der \xe0 des emplois exigeant une qualification diff\xe9rente, ou \xe0 des non-salari\xe9s d'acc\xe9der \xe0 de nouvelles activit\xe9s professionnelles</li>
        <li>favoriser la mobilit\xe9 professionnelle.</li>
      </ul>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">3. Prix de la formation</h2>
      <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
        En contrepartie de cette action de formation, le b\xe9n\xe9ficiaire (ou le financeur dans le cadre d'une subrogation de paiement) s'acquittera des co\xfbts 
        suivants qui couvrent l'int\xe9gralit\xe9 des frais engag\xe9s par l'organisme de formation pour cette session :
      </p>
      
      <table style="width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 10pt;">
        <thead>
          <tr style="background-color: #F3F4F6;">
            <th style="padding: 8px; text-align: left; border: 1px solid #E5E7EB; font-weight: bold;">Description</th>
            <th style="padding: 8px; text-align: right; border: 1px solid #E5E7EB; font-weight: bold;">Prix</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="padding: 8px; border: 1px solid #E5E7EB;">Formation</td>
            <td style="padding: 8px; text-align: right; border: 1px solid #E5E7EB;">{montant_ttc}</td>
          </tr>
        </tbody>
      </table>
      
      <p style="margin: 10px 0 5px 0; font-size: 10pt;">L'organisme de formation atteste \xeatre exon\xe9r\xe9 de TVA.</p>
      <p style="margin: 5px 0; font-size: 10pt; font-weight: bold;">TOTAL NET DE TAXES : {montant_ttc}</p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">4. Modalit\xe9s de d\xe9roulement (pr\xe9sentiel, \xe0 distance, mixte, en situation de travail) et de suivi</h2>
      <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
        La Formation s'effectue Formation pr\xe9sentielle.
      </p>
      <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
        Des feuilles de pr\xe9sence seront sign\xe9es par les Stagiaires et le(s) formateur(s) par demi-journ\xe9e de formation, l'objectif \xe9tant de justifier la 
        r\xe9alisation de la Formation.
      </p>
      <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
        L'appr\xe9ciation des r\xe9sultats se fera \xe0 travers la mise en uvre QCM et/ou grilles d'\xe9valuation et/ou travaux pratiques et/ou fiches d'\xe9valuation 
        et/ou mises en situation et/ou autre.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">5. Moyens de sanction (dipl\xf4me, titre professionnel, certification, attestation de fin de formation ou autres)</h2>
      <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
        \xc0 l'issue de la Formation, l'Organisme de Formation d\xe9livre au Stagiaire le {diplome_ou_certification} en cas de r\xe9ussite.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">6. D\xe9dit ou abandon</h2>
      <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
        En cas de d\xe9dit par le B\xe9n\xe9ficiaire \xe0 moins de 7 jours francs avant le d\xe9but de l'action mentionn\xe9e \xe0 l'article 1, ou d'abandon en cours de 
        Formation par un ou plusieurs Stagiaire(s), l'Organisme de Formation (i) remboursera sur le co\xfbt total, les sommes qu'il n'aura pas r\xe9ellement 
        d\xe9pens\xe9es ou engag\xe9es pour la r\xe9alisation de ladite action et/ou (ii) proposera une nouvelle date de Formation.
      </p>
      <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
        Le cas \xe9ch\xe9ant, le B\xe9n\xe9ficiaire s'engage au versement d'un montant de 20 % du co\xfbt total de la Formation \xe0 titre de d\xe9dommagement, cette 
        somme ne pouvant faire l'objet d'un financement par fonds publics ou paritaires.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">7. Modalit\xe9s de r\xe8glement</h2>
      <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
        Le paiement sera d\xfb en totalit\xe9 \xe0 r\xe9ception d'une facture \xe9mise par l'Organisme de Formation \xe0 destination du B\xe9n\xe9ficiaire.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">8. Propri\xe9t\xe9 intellectuelle</h2>
      <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
        Les supports de formation, quelle qu'en soit la forme, et les contenus de toute nature (textes, images, visuels, musiques, logos, marques, base de 
        donn\xe9es, etc.) exploit\xe9s par l'Organisme de Formation dans le cadre de l'action de formation sont prot\xe9g\xe9s par tous droits de propri\xe9t\xe9 
        intellectuelle ou droits des producteurs de bases de donn\xe9es en vigueur. Tous d\xe9sassemblages, d\xe9compilations, d\xe9cryptages, extractions, 
        r\xe9utilisations, copies et plus g\xe9n\xe9ralement, tous actes de reproduction, repr\xe9sentation, diffusion et utilisation de l'un quelconque de ces 
        \xe9l\xe9ments, en tout ou partie, sans l'autorisation de l'Organisme de Formation sont strictement interdits et pourront faire l'objet de poursuites 
        judiciaires.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">9. Donn\xe9es \xe0 caract\xe8re personnel</h2>
      <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
        L'Organisme de Formation pratique une politique de protection des donn\xe9es personnelles dont les caract\xe9ristiques sont explicit\xe9es dans la 
        politique de confidentialit\xe9.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">10. Diff\xe9rents \xe9ventuels</h2>
      <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
        Si une contestation ou un diff\xe9rend ne peuvent \xeatre r\xe9gl\xe9s \xe0 l'amiable, le Tribunal de {ecole_ville} sera seul comp\xe9tent pour r\xe9gler le litige.
      </p>

      <p style="text-align: center; margin: 30px 0 20px 0; font-size: 10pt;">
        Document r\xe9alis\xe9 en 2 exemplaires \xe0 {ecole_ville}, le {date_jour}.
      </p>

      <div style="margin-top: 40px;">
        <p style="text-align: center; margin-bottom: 25px; font-size: 10pt;">
          Pour l'organisme de formation,
        </p>
        
        <div style="display: flex; justify-content: space-between;">
          <div style="width: 45%; text-align: center;">
            <p style="font-weight: bold; margin-bottom: 50px; font-size: 10pt;">Pour l'Organisme de Formation</p>
            <p style="margin-bottom: 8px; font-size: 10pt;">{ecole_nom}</p>
            <div style="border-top: 1px solid #1A1A1A; margin: 0 auto; width: 80%; padding-top: 8px;">
              <p style="font-size: 9pt; color: #666;">Signature</p>
            </div>
          </div>
          <div style="width: 45%; text-align: center;">
            <p style="font-weight: bold; margin-bottom: 50px; font-size: 10pt;">Pour le B\xe9n\xe9ficiaire</p>
            <p style="margin-bottom: 8px; font-size: 10pt;">{eleve_nom} {eleve_prenom}</p>
            <div style="border-top: 1px solid #1A1A1A; margin: 0 auto; width: 80%; padding-top: 8px;">
              <p style="font-size: 9pt; color: #666;">Signature</p>
            </div>
          </div>
        </div>
      </div>

      <div style="page-break-before: always; margin-top: 40px;">
        <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Annexe 1 : Programme de formation</h2>
        <p style="font-size: 10pt; margin: 0 0 10px 0;"><strong>Nom de la session :</strong> {formation_nom} DU {session_debut} au {session_fin}</p>
        
        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">DUR\xc9E ET LIEU DE FORMATION</h3>
        <ul style="margin: 10px 0 20px 20px; font-size: 10pt; line-height: 1.6;">
          <li>Dur\xe9e en heures : {formation_duree}</li>
          <li>Lieu : {session_lieu}</li>
        </ul>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">PUBLIC CONCERN\xc9</h3>
        <p style="font-size: 10pt; margin: 0 0 20px 0;">{formation_public_concerne}</p>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">PR\xc9REQUIS</h3>
        <div style="font-size: 10pt; margin: 0 0 20px 0;">
          {formation_prerequis}
        </div>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">QUALIT\xc9 ET INDICATEURS DE R\xc9SULTATS</h3>
        <p style="font-size: 10pt; margin: 0 0 20px 0;">{formation_qualite_et_resultats}</p>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">ACCESSIBILIT\xc9</h3>
        <p style="font-size: 10pt; margin: 0 0 20px 0;">Formation accessible aux personnes en situation de handicap. Pour toutes demandes d'adaptation, veuillez contacter notre r\xe9f\xe9rent handicap.</p>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">OBJECTIFS</h3>
        <div style="font-size: 10pt; margin: 0 0 20px 0;">
          {formation_objectifs}
        </div>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">CONTENU DE LA FORMATION</h3>
        <div style="font-size: 10pt; margin: 0 0 20px 0;">
          {formation_contenu}
        </div>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">ORGANISATION DE LA FORMATION</h3>
        <ul style="margin: 10px 0 20px 20px; font-size: 10pt; line-height: 1.6;">
          <li><strong>\xc9quipe p\xe9dagogique :</strong> {formation_equipe_pedagogique}</li>
          <li><strong>Ressources p\xe9dagogiques et techniques pr\xe9vues :</strong> {formation_ressources}</li>
          <li>accueil des Stagiaires dans une salle d\xe9di\xe9e \xe0 la formation,</li>
          <li>fourniture des supports de formation : {formation_supports}</li>
        </ul>
      </div>

      <div style="page-break-before: always; margin-top: 40px;">
        <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Annexe 2 : R\xe8glement Int\xe9rieur</h2>
        
        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">Article 1 - Objet et champ d'application</h3>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 15px 0; font-size: 10pt;">
          Conform\xe9ment aux dispositions des articles L.6352-3, L.6352-4 et R.6352-1 \xe0 R.6352-15 du Code du Travail, le pr\xe9sent r\xe8glement a pour objet de 
          d\xe9terminer les principales mesures applicables en mati\xe8re de sant\xe9, de s\xe9curit\xe9 et de discipline aux stagiaires de l'organisme de formation, 
          d\xe9nomm\xe9 ci-apr\xe8s.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 15px 0; font-size: 10pt;">
          Tout stagiaire doit respecter les termes du pr\xe9sent r\xe8glement durant toute la dur\xe9e de l'action de formation.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
          Toutefois, lorsque la formation se d\xe9roule dans une entreprise d\xe9j\xe0 dot\xe9e d'un r\xe8glement int\xe9rieur, les mesures de sant\xe9 et de s\xe9curit\xe9 
          applicables aux stagiaires sont celles de ce r\xe8glement.
        </p>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">Article 2 - Hygi\xe8ne et s\xe9curit\xe9</h3>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Chaque stagiaire doit veiller au respect des consignes g\xe9n\xe9rales et particuli\xe8res en mati\xe8re d'hygi\xe8ne et de s\xe9curit\xe9, sous peine de sanctions 
          disciplinaires.
        </p>
        <p style="font-size: 10pt; margin: 10px 0 5px 0; font-weight: bold;">Propret\xe9 des locaux</p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Les stagiaires doivent maintenir en ordre et en \xe9tat de propret\xe9 constante les locaux o\xf9 se d\xe9roule la formation. \xc0 ce titre, il leur est interdit de 
          manger dans les salles de cours.
        </p>
        <p style="font-size: 10pt; margin: 10px 0 5px 0; font-weight: bold;">Alcool et produits stup\xe9fiants</p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          L'introduction et la consommation de produits stup\xe9fiants ou de boissons alcoolis\xe9es est strictement interdite.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Il est \xe9galement interdit de p\xe9n\xe9trer ou de demeurer dans l'\xe9tablissement en \xe9tat d'ivresse ou sous l'emprise de produits stup\xe9fiants.
        </p>
        <p style="font-size: 10pt; margin: 10px 0 5px 0; font-weight: bold;">Consignes de s\xe9curit\xe9  Incendie</p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Les consignes d'incendie et notamment un plan de localisation des extincteurs et des issues de secours sont affich\xe9s dans les locaux de formation 
          de mani\xe8re \xe0 \xeatre connus des stagiaires.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Les stagiaires sont tenu\xb7e\xb7s d'ex\xe9cuter sans d\xe9lai l'ordre d'\xe9vacuation donn\xe9 par l'animateur de la formation ou par un salari\xe9 de l'entreprise o\xf9 
          se d\xe9roule la formation.
        </p>
        <p style="font-size: 10pt; margin: 10px 0 5px 0; font-weight: bold;">Accident - d\xe9claration</p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Tout accident ou incident survenu \xe0 l'occasion ou en cours de formation doit \xeatre imm\xe9diatement d\xe9clar\xe9 par le\xb7la stagiaire accident\xe9\xb7e ou les 
          personnes t\xe9moins de l'accident, \xe0 l'organisme de formation.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Conform\xe9ment \xe0 l'article R. 6342-3 du Code du Travail, l'accident survenu au\xb7\xe0 la stagiaire pendant qu'il\xb7elle se trouve sur le lieu de formation ou 
          pendant qu'il\xb7elle s'y rend ou en revient, fait l'objet d'une d\xe9claration par l'organisme de formation aupr\xe8s de la caisse de s\xe9curit\xe9 sociale.
        </p>
        <p style="font-size: 10pt; margin: 10px 0 5px 0; font-weight: bold;">Interdiction de fumer ou de vapoter</p>
        <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
          Il est interdit de fumer ou de vapoter (utilisation d'une cigarette \xe9lectronique) dans les locaux de formation.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
          Les stagiaires sont toutefois autoris\xe9\xb7e\xb7s pendant leur temps de pause \xe0 aller fumer ou vapoter \xe0 l'ext\xe9rieur de l'\xe9tablissement.
        </p>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">Article 3  Horaires, absences et retards</h3>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Les horaires de la formation seront communiqu\xe9s aux stagiaires au pr\xe9alable. Les stagiaires sont tenu\xb7e\xb7s de respecter ces horaires.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Sauf autorisation express, les stagiaires ne peuvent pas s'absenter pendant les heures de formation. L'\xe9margement devra \xeatre fait au d\xe9but ou \xe0 
          la fin de chaque atelier selon la pratique de l'organisme de formation.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          En cas d'absence ou retard, les stagiaires en informent dans les plus brefs d\xe9lais l'organisme de formation et s'en justifier.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          L'employeur du stagiaire est inform\xe9 des absences dans les meilleurs d\xe9lais qui suivent la connaissance par l'organisme de formation.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
          De plus, pour les stagiaires dont le co\xfbt de la formation est pris en charge par un financeur externe (OPCO, P\xf4le Emploi, Caisse des D\xe9p\xf4ts), les 
          absences non justifi\xe9es entra\xeenent une retenue sur la prise en charge du co\xfbt de la formation, proportionnelle \xe0 la dur\xe9e de l'absence.
        </p>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">Article 4 - Comportement</h3>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Il est demand\xe9 \xe0 tout stagiaire d'avoir un comportement garantissant le respect des r\xe8gles \xe9l\xe9mentaires de savoir vivre, de savoir \xeatre en 
          collectivit\xe9 et le bon d\xe9roulement des formations.
        </p>
        <p style="font-size: 10pt; margin: 10px 0 5px 0; font-weight: bold;">\xc0 titre d'exemple, il est formellement interdit aux stagiaires :</p>
        <ul style="margin: 10px 0 10px 20px; font-size: 10pt; line-height: 1.6;">
          <li>De modifier, d'utiliser \xe0 une fin tierce ou de diffuser les supports de formation sans l'autorisation express de l'organisme de formation ;</li>
          <li>De modifier les r\xe9glages des param\xe8tres de l'ordinateur ;</li>
          <li>D'utiliser leurs t\xe9l\xe9phones portables durant les sessions \xe0 des fins autres que celles de la formation.</li>
        </ul>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">Article 5 : Acc\xe8s aux locaux</h3>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Les stagiaires ont acc\xe8s aux locaux o\xf9 se d\xe9roule la formation exclusivement pour suivre le stage auquel ils\xb7elles sont inscrit\xb7e\xb7s. Ils\xb7elles ne 
          peuvent y entrer ou y demeurer \xe0 d'autres fins, sauf autorisation.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
          Il leur est interdit d'\xeatre accompagn\xe9\xb7e\xb7s de personnes non inscrites au stage.
        </p>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">Article 6 - Utilisation du mat\xe9riel</h3>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Tout\xb7e stagiaire est tenu\xb7e de conserver en bon \xe9tat le mat\xe9riel et la documentation mis \xe0 la disposition par l'organisme de formation.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          L'utilisation du mat\xe9riel \xe0 d'autres fins, notamment personnelles est interdite, sauf pour le mat\xe9riel mis \xe0 disposition \xe0 cet effet.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Il est formellement interdit de diffuser les codes personnels n\xe9cessaires pour se connecter \xe0 l'espace extranet.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          A la fin du stage, le\xb7la stagiaire est tenu\xb7e de restituer tout mat\xe9riel et document en sa possession appartenant \xe0 l'organisme de formation, sauf 
          les documents p\xe9dagogiques distribu\xe9s en cours de formation ou pr\xe9sents sur son extranet.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          La documentation p\xe9dagogique remise lors des sessions de formation est prot\xe9g\xe9e au titre des droits d'auteur et ne peut \xeatre r\xe9utilis\xe9e que pour 
          un strict usage personnel.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
          Il est formellement interdit pour le.la stagiaire, sauf d\xe9rogation expresse, d'enregistrer ou de filmer les sessions de formation.
        </p>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">Article 7 : Vol ou d\xe9gradation des biens personnels des stagiaires</h3>
        <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
          L'organisme de formation d\xe9cline toute responsabilit\xe9 en cas de perte, vol ou d\xe9t\xe9rioration des objets personnels de toute nature d\xe9pos\xe9s par 
          les stagiaires dans les locaux de formation.
        </p>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">Article 8 - Sanctions</h3>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Tout agissement consid\xe9r\xe9 comme fautif pourra, en fonction de sa gravit\xe9, faire l'objet de l'une ou l'autre des sanctions ci-apr\xe8s, sans 
          n\xe9cessairement suivre l'ordre de ce classement :
        </p>
        <ul style="margin: 10px 0 10px 20px; font-size: 10pt; line-height: 1.6;">
          <li>rappel \xe0 l'ordre ;</li>
          <li>avertissement \xe9crit ;</li>
          <li>bl\xe2me ;</li>
          <li>exclusion temporaire de la formation ;</li>
          <li>exclusion d\xe9finitive de la formation.</li>
        </ul>
        <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
          L'organisme de formation informe de la sanction prise le cas \xe9ch\xe9ant : l'employeur du\xb7de la stagiaire ou l'administration de l'agent stagiaire ; 
          et/ou le financeur du stage.
        </p>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">Article 9 - Proc\xe9dure disciplinaire</h3>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          En application de l'article R.6352-4 du Code du Travail, \xab aucune sanction ne peut \xeatre prononc\xe9e \xe0 l'encontre du stagiaire sans que celui-ci ait 
          \xe9t\xe9 inform\xe9 au pr\xe9alable des griefs retenus contre lui \xbb.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Lorsque l'organisme de formation envisage une prise de sanction, il convoque le la stagiaire par lettre recommand\xe9e avec accus\xe9 de r\xe9ception ou 
          remise \xe0 l'int\xe9ress\xe9 contre d\xe9charge en lui indiquant l'objet de la convocation, la date, l'heure et le lieu de l'entretien, sauf si la sanction 
          envisag\xe9e n'a pas d'incidence sur la pr\xe9sence du de la stagiaire pour la suite de la formation.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Au cours de l'entretien, le.la stagiaire a la possibilit\xe9 de se faire assister par une personne de son choix, stagiaire ou salari\xe9 de l'organisme de 
          formation. La convocation mentionn\xe9e \xe0 l'article pr\xe9c\xe8dent fait \xe9tat de cette facult\xe9. Lors de l'entretien, le motif de la sanction envisag\xe9e est 
          indiqu\xe9 au \xe0 la stagiaire : celui.celle-ci a alors la possibilit\xe9 de donner toute explication ou justification des faits qui lui sont reproch\xe9s.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Lorsqu'une mesure conservatoire d'exclusion temporaire \xe0 effet imm\xe9diat est consid\xe9r\xe9e comme indispensable par l'organisme de formation, 
          aucune sanction d\xe9finitive relative \xe0 l'agissement fautif \xe0 l'origine de cette exclusion ne peut \xeatre prise sans que le la stagiaire n'ait \xe9t\xe9 au 
          pr\xe9alable inform\xe9 des griefs retenus contre lui elle et, \xe9ventuellement, qu'il elle ait \xe9t\xe9 convoqu\xe9(e) \xe0 un entretien et ait eu la possibilit\xe9 de 
          s'expliquer devant un Commission de discipline.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          La sanction ne peut intervenir moins d'un jour franc ni plus de 15 jours apr\xe8s l'entretien o\xf9, le cas \xe9ch\xe9ant, apr\xe8s avis de la Commission de 
          discipline.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
          Elle fait l'objet d'une notification \xe9crite et motiv\xe9e au \xe0 la stagiaire sous forme lettre recommand\xe9e, ou d'une lettre remise contre d\xe9charge.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
          L'organisme de formation informe concomitamment l'employeur, et \xe9ventuellement l'organisme paritaire prenant \xe0 sa charge les frais de 
          formation, de la sanction prise.
        </p>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">Article 10 : Repr\xe9sentation des stagiaires</h3>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Dans les stages d'une dur\xe9e sup\xe9rieure \xe0 500 heures, il est proc\xe9d\xe9 simultan\xe9ment \xe0 l'\xe9lection d'un d\xe9l\xe9gu\xe9 titulaire et d'un d\xe9l\xe9gu\xe9 suppl\xe9ant 
          conform\xe9ment aux dispositions des articles R.6352-9 et suivants du Code du Travail.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Tous les stagiaires sont \xe9lecteurs et \xe9ligibles, sauf les d\xe9tenus admis \xe0 participer \xe0 une action de formation professionnelle.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          L'organisme de formation organise le scrutin qui a lieu pendant les heures de formation, au plus t\xf4t 20 heures, au plus tard 40 heures apr\xe8s le 
          d\xe9but du stage. En cas d'impossibilit\xe9 de d\xe9signer les repr\xe9sentants des stagiaires, l'organisme de formation dresse un PV de carence qu'il 
          transmet au pr\xe9fet de r\xe9gion territorialement comp\xe9tent.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Les d\xe9l\xe9gu\xe9s sont \xe9lus pour la dur\xe9e de la formation. Leurs fonctions prennent fin lorsqu'ils cessent, pour quelque cause que ce soit, de participer 
          \xe0 la formation.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0 0 10px 0; font-size: 10pt;">
          Si le d\xe9l\xe9gu\xe9 titulaire et le d\xe9l\xe9gu\xe9 suppl\xe9ant ont cess\xe9 leurs fonctions avant la fin de la session de formation, il est proc\xe9d\xe9 \xe0 une nouvelle 
          \xe9lection dans les conditions pr\xe9vues aux articles R.6352-9 \xe0 R.6352-12.
        </p>
        <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
          Les repr\xe9sentants des stagiaires font toute suggestion pour am\xe9liorer le d\xe9roulement des stages et les conditions de vie des stagiaires dans 
          l'organisme de formation. Ils pr\xe9sentent toutes les r\xe9clamations individuelles ou collectives relatives \xe0 ces mati\xe8res, aux conditions d'hygi\xe8ne et 
          de s\xe9curit\xe9  et \xe0 l'application du r\xe8glement int\xe9rieur.
        </p>

        <h3 style="font-size: 11pt; font-weight: bold; margin: 20px 0 10px 0; color: #1A1A1A;">Article 11 : Publicit\xe9</h3>
        <p style="text-align: justify; line-height: 1.6; margin: 0; font-size: 10pt;">
          Le pr\xe9sent r\xe8glement est affich\xe9 dans les locaux et sur le site internet de l'organisme de formation. En outre, un exemplaire est remis \xe0 chaque 
          stagiaire.
        </p>

        <p style="margin-top: 30px; font-size: 10pt;">Fait \xe0 {ecole_ville}</p>
        <p style="margin: 5px 0 0 0; font-size: 10pt;">Le {date_jour}</p>
      </div>
    `,footerContent:rb},facture:{type:"facture",name:"Facture",headerContent:ra,bodyContent:`
      <!-- En-t\xeate Facture Ultra Premium Compact -->
      <div style="margin-bottom: 5px;">
        <table cellpadding="0" cellspacing="0" style="width: 100%; border: 0;">
          <tr>
            <td style="width: 60%; vertical-align: top; border: 0;">
              <div style="background: linear-gradient(135deg, #1E3A5F 0%, #2563EB 100%); color: white; padding: 6px 12px; border-radius: 3px; display: inline-block;">
                <p style="margin: 0; font-size: 16pt; font-weight: 800; letter-spacing: 0.3px; font-family: 'Times New Roman', Times, serif;">FACTURE</p>
              </div>
              <p style="margin: 3px 0 0 0; font-size: 10pt; font-weight: 700; color: #1E3A5F; font-family: 'Times New Roman', Times, serif;">N\xb0 {numero_facture}</p>
            </td>
            <td style="width: 40%; vertical-align: top; border: 0; text-align: right;">
              <table cellpadding="0" cellspacing="0" style="margin-left: auto; border: 0;">
                <tr>
                  <td style="padding: 1px 5px 1px 0; font-size: 6.5pt; color: #64748B; border: 0; text-align: right;">Date d'\xe9mission</td>
                  <td style="padding: 1px 0; font-size: 7.5pt; font-weight: 600; color: #1E293B; border: 0;">{date_emission}</td>
                </tr>
                <tr>
                  <td style="padding: 1px 5px 1px 0; font-size: 6.5pt; color: #64748B; border: 0; text-align: right;">\xc9ch\xe9ance</td>
                  <td style="padding: 1px 0; font-size: 7.5pt; font-weight: 600; color: #DC2626; border: 0;">{date_echeance}</td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
      </div>

      <!-- S\xe9parateur \xe9l\xe9gant -->
      <div style="height: 1px; background: linear-gradient(90deg, #2563EB 0%, #60A5FA 50%, transparent 100%); margin: 4px 0;"></div>

      <!-- Informations Client Ultra Compact -->
      <table cellpadding="0" cellspacing="0" style="width: 100%; margin-bottom: 5px; border: 0;">
        <tr>
          <td style="width: 55%; vertical-align: top; padding-right: 8px; border: 0;">
            <div style="background: #F8FAFC; border-left: 2px solid #2563EB; padding: 4px 8px; border-radius: 0 2px 2px 0;">
              <p style="margin: 0 0 2px 0; font-size: 6pt; font-weight: 700; text-transform: uppercase; letter-spacing: 0.3px; color: #64748B;">Factur\xe9 \xe0</p>
              <p style="margin: 0 0 1px 0; font-size: 9pt; font-weight: 700; color: #0F172A;">{eleve_prenom} {eleve_nom}</p>
              <p style="margin: 0 0 1px 0; font-size: 7pt; color: #475569; line-height: 1.15;">{eleve_adresse}</p>
              <p style="margin: 0 0 1px 0; font-size: 7pt; color: #475569; line-height: 1.15;">{eleve_code_postal} {eleve_ville}</p>
              <p style="margin: 0; font-size: 6.5pt; color: #475569; line-height: 1.15;">{eleve_email} | {eleve_telephone}</p>
            </div>
          </td>
          <td style="width: 45%; vertical-align: top; border: 0;">
            <div style="background: #EFF6FF; border: 1px solid #BFDBFE; padding: 4px 8px; border-radius: 2px;">
              <p style="margin: 0 0 2px 0; font-size: 6pt; font-weight: 700; text-transform: uppercase; letter-spacing: 0.3px; color: #1D4ED8;">R\xe9f\xe9rence client</p>
              <p style="margin: 0 0 1px 0; font-size: 8.5pt; font-weight: 700; color: #1E40AF;">N\xb0 {eleve_numero}</p>
              <p style="margin: 0; font-size: 7pt; color: #3B82F6; line-height: 1.15;">{formation_nom}</p>
            </div>
          </td>
        </tr>
      </table>

      <!-- Tableau des prestations Ultra Compact -->
      <table cellpadding="0" cellspacing="0" style="width: 100%; margin-bottom: 5px; border-collapse: collapse; font-size: 7.5pt;">
        <thead>
          <tr>
            <th style="padding: 5px 6px; text-align: left; background: linear-gradient(135deg, #1E3A5F 0%, #1E40AF 100%); color: white; font-weight: 600; font-size: 6.5pt; text-transform: uppercase; letter-spacing: 0.2px;">Description</th>
            <th style="padding: 5px 4px; text-align: center; background: linear-gradient(135deg, #1E3A5F 0%, #1E40AF 100%); color: white; font-weight: 600; font-size: 6.5pt; text-transform: uppercase; width: 35px;">Qt\xe9</th>
            <th style="padding: 5px 4px; text-align: right; background: linear-gradient(135deg, #1E3A5F 0%, #1E40AF 100%); color: white; font-weight: 600; font-size: 6.5pt; text-transform: uppercase; width: 65px;">P.U. HT</th>
            <th style="padding: 5px 6px; text-align: right; background: linear-gradient(135deg, #1E3A5F 0%, #1E40AF 100%); color: white; font-weight: 600; font-size: 6.5pt; text-transform: uppercase; width: 65px;">Total HT</th>
          </tr>
        </thead>
        <tbody>
          <tr style="background: #FFFFFF;">
            <td style="padding: 6px; border-bottom: 1px solid #E2E8F0; border-left: 1px solid #E2E8F0;">
              <p style="margin: 0 0 1px 0; font-weight: 600; font-size: 8pt; color: #0F172A;">{formation_nom}</p>
              <p style="margin: 0; font-size: 6.5pt; color: #64748B; line-height: 1.15;">{session_debut}  {session_fin} | {formation_duree}</p>
            </td>
            <td style="padding: 6px 4px; text-align: center; border-bottom: 1px solid #E2E8F0; font-weight: 500; color: #334155; font-size: 7.5pt;">1</td>
            <td style="padding: 6px 4px; text-align: right; border-bottom: 1px solid #E2E8F0; font-weight: 500; color: #334155; font-size: 7.5pt;">{montant_ht} </td>
            <td style="padding: 6px; text-align: right; border-bottom: 1px solid #E2E8F0; border-right: 1px solid #E2E8F0; font-weight: 700; color: #0F172A; font-size: 7.5pt;">{montant_ht} </td>
          </tr>
        </tbody>
      </table>

      <!-- Bloc Totaux Ultra Compact -->
      <table cellpadding="0" cellspacing="0" style="width: 100%; margin-bottom: 5px; border: 0;">
        <tr>
          <td style="width: 50%; vertical-align: top; padding-right: 8px; border: 0;">
            <!-- Montant en lettres -->
            <div style="background: #F0FDF4; border: 1px solid #86EFAC; padding: 4px 8px; border-radius: 2px;">
              <p style="margin: 0 0 1px 0; font-size: 6pt; font-weight: 700; text-transform: uppercase; letter-spacing: 0.2px; color: #166534;">Arr\xeat\xe9 \xe0 la somme de</p>
              <p style="margin: 0; font-size: 7.5pt; font-style: italic; color: #15803D; line-height: 1.15;">{montant_lettres}</p>
            </div>
          </td>
          <td style="width: 50%; vertical-align: top; border: 0;">
            <table cellpadding="0" cellspacing="0" style="width: 100%; border-collapse: collapse;">
              <tr>
                <td style="padding: 3px 6px; text-align: right; background: #F8FAFC; font-size: 7pt; color: #64748B; border: 1px solid #E2E8F0;">Sous-total HT</td>
                <td style="padding: 3px 6px; text-align: right; background: #F8FAFC; font-size: 7.5pt; font-weight: 600; color: #334155; border: 1px solid #E2E8F0; width: 70px;">{montant_ht} </td>
              </tr>
              <tr>
                <td style="padding: 3px 6px; text-align: right; background: #F8FAFC; font-size: 7pt; color: #64748B; border: 1px solid #E2E8F0;">TVA ({taux_tva}%)</td>
                <td style="padding: 3px 6px; text-align: right; background: #F8FAFC; font-size: 7.5pt; font-weight: 500; color: #334155; border: 1px solid #E2E8F0;">{tva} </td>
              </tr>
              <tr>
                <td style="padding: 5px; text-align: right; background: linear-gradient(135deg, #1E3A5F 0%, #1E40AF 100%); color: white; font-size: 8pt; font-weight: 700; border-radius: 0 0 0 2px;">TOTAL TTC</td>
                <td style="padding: 5px; text-align: right; background: linear-gradient(135deg, #1E3A5F 0%, #1E40AF 100%); color: white; font-size: 9.5pt; font-weight: 800; border-radius: 0 0 2px 0;">{montant_ttc} </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>

      <!-- Informations de paiement Ultra Compact -->
      <table cellpadding="0" cellspacing="0" style="width: 100%; margin-bottom: 4px; border: 0;">
        <tr>
          <td style="width: 50%; vertical-align: top; padding-right: 4px; border: 0;">
            <div style="background: #FEF3C7; border-left: 2px solid #F59E0B; padding: 4px 8px; border-radius: 0 2px 2px 0;">
              <p style="margin: 0 0 2px 0; font-size: 6.5pt; font-weight: 700; color: #92400E;"> PAIEMENT</p>
              <p style="margin: 0 0 1px 0; font-size: 6.5pt; color: #78350F; line-height: 1.1;"><strong>Mode:</strong> {mode_paiement}</p>
              <p style="margin: 0; font-size: 6.5pt; color: #78350F; line-height: 1.1;"><strong>IBAN:</strong> {iban}</p>
            </div>
          </td>
          <td style="width: 50%; vertical-align: top; padding-left: 4px; border: 0;">
            <div style="background: #FEF2F2; border-left: 2px solid #EF4444; padding: 4px 8px; border-radius: 0 2px 2px 0;">
              <p style="margin: 0 0 2px 0; font-size: 6.5pt; font-weight: 700; color: #991B1B;"> RETARD</p>
              <p style="margin: 0; font-size: 6pt; color: #7F1D1D; line-height: 1.1;">Taux \xd7 3 + 40 (L441-10)</p>
            </div>
          </td>
        </tr>
      </table>

      <!-- Mentions l\xe9gales ultra compactes -->
      <div style="background: #F1F5F9; padding: 3px 8px; border-radius: 2px; margin-top: 3px;">
        <p style="margin: 0; font-size: 6pt; color: #64748B; text-align: center; line-height: 1.2;">
          TVA non applicable (art. 293B CGI)  SIRET: {ecole_siret}  D\xe9claration: {ecole_numero_declaration}
        </p>
      </div>
    `,footerContent:rb},devis:{type:"devis",name:"Devis",headerContent:ra,bodyContent:`
      <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 25px;">
        <div style="flex: 1;">
          <h1 style="font-size: 20pt; font-weight: bold; margin: 0; color: #1A1A1A;">DEVIS</h1>
          <p style="font-size: 12pt; margin: 8px 0 0 0; color: #666;">N\xb0 {numero_devis}</p>
        </div>
        <div style="text-align: right;">
          <p style="font-size: 10pt; margin: 0;"><strong>Date d'\xe9mission :</strong> {date_emission}</p>
          <p style="font-size: 10pt; margin: 5px 0;"><strong>Valable jusqu'au :</strong> {validite_devis}</p>
        </div>
      </div>

      <div style="border-top: 1px solid #E5E7EB; margin: 20px 0;"></div>

      <div style="display: flex; justify-content: space-between; margin-bottom: 25px;">
        <div style="width: 48%; padding: 15px; background-color: #F9FAFB; border-left: 3px solid #1A1A1A;">
          <p style="font-weight: bold; margin: 0 0 10px 0; font-size: 10pt; text-transform: uppercase; color: #666;">Devis pour :</p>
          <p style="margin: 0; font-size: 11pt; font-weight: bold;">{eleve_nom} {eleve_prenom}</p>
          <p style="margin: 5px 0; font-size: 10pt; color: #666;">{eleve_adresse}</p>
          <p style="margin: 3px 0; font-size: 10pt; color: #666;">T\xe9l : {eleve_telephone}</p>
          <p style="margin: 3px 0; font-size: 10pt; color: #666;">Email : {eleve_email}</p>
        </div>
      </div>

      <div style="padding: 15px; background-color: #F0F9FF; border-left: 3px solid #0EA5E9; margin-bottom: 20px;">
        <p style="margin: 0; font-size: 11pt; font-weight: 600;">
          Objet : Devis pour la formation "{formation_nom}"
        </p>
        <p style="margin: 8px 0 0 0; font-size: 10pt; color: #333;">{formation_description}</p>
      </div>

      <table style="width: 100%; border-collapse: collapse; margin: 25px 0; font-size: 10pt;">
        <thead>
          <tr style="background-color: #1A1A1A; color: white;">
            <th style="padding: 10px 12px; text-align: left; font-weight: bold;">Description de la formation</th>
            <th style="padding: 10px 12px; text-align: center; font-weight: bold; width: 80px;">Dur\xe9e</th>
            <th style="padding: 10px 12px; text-align: right; font-weight: bold; width: 100px;">Prix HT</th>
            <th style="padding: 10px 12px; text-align: right; font-weight: bold; width: 100px;">Montant HT</th>
          </tr>
        </thead>
        <tbody>
          <tr style="border-bottom: 1px solid #E5E7EB;">
            <td style="padding: 12px;">
              <p style="margin: 0; font-weight: 600;">{formation_nom}</p>
              <p style="margin: 4px 0 0 0; font-size: 9pt; color: #666;">P\xe9riode : {session_debut} au {session_fin}</p>
              <p style="margin: 2px 0 0 0; font-size: 9pt; color: #666;">Lieu : {session_lieu}</p>
            </td>
            <td style="padding: 12px; text-align: center; font-weight: 500;">{formation_duree}</td>
            <td style="padding: 12px; text-align: right; font-weight: 500;">{montant_ht} </td>
            <td style="padding: 12px; text-align: right; font-weight: 600;">{montant_ht} </td>
          </tr>
        </tbody>
      </table>

      <div style="display: flex; justify-content: flex-end; margin-bottom: 25px;">
        <table style="width: 280px; border-collapse: collapse; font-size: 10pt;">
          <tr style="border-bottom: 1px solid #E5E7EB;">
            <td style="padding: 8px 12px; text-align: right; background-color: #F9FAFB;">Sous-total HT :</td>
            <td style="padding: 8px 12px; text-align: right; background-color: #F9FAFB; font-weight: 600;">{montant_ht} </td>
          </tr>
          <tr style="border-bottom: 1px solid #E5E7EB;">
            <td style="padding: 8px 12px; text-align: right; background-color: #F9FAFB;">TVA ({taux_tva}%) :</td>
            <td style="padding: 8px 12px; text-align: right; background-color: #F9FAFB;">{tva} </td>
          </tr>
          <tr style="background-color: #1A1A1A; color: white;">
            <td style="padding: 12px; text-align: right; font-weight: bold; font-size: 12pt;">TOTAL TTC :</td>
            <td style="padding: 12px; text-align: right; font-weight: bold; font-size: 12pt;">{montant_ttc} </td>
          </tr>
        </table>
      </div>

      <div style="padding: 15px; background-color: #FEF3C7; border-left: 3px solid #F59E0B; margin-bottom: 20px;">
        <p style="margin: 0 0 10px 0; font-size: 10pt; font-weight: 600; color: #92400E;">
          Conditions et validit\xe9 du devis
        </p>
        <ul style="margin: 0 0 0 20px; font-size: 10pt; line-height: 1.6; color: #78350F;">
          <li>Ce devis est valable jusqu'au <strong>{validite_devis}</strong></li>
          <li>Modalit\xe9s de paiement : <strong>{mode_paiement}</strong></li>
          <li>La r\xe9servation est d\xe9finitive apr\xe8s acceptation \xe9crite du pr\xe9sent devis</li>
          <li>En cas d'acceptation, un acompte de 30% peut \xeatre demand\xe9</li>
        </ul>
      </div>

      <div style="padding: 15px; background-color: #F0FDF4; border-left: 3px solid #10B981;">
        <p style="margin: 0; font-size: 10pt; line-height: 1.6; color: #166534;">
          <strong>Pour accepter ce devis :</strong><br/>
          Veuillez retourner ce document sign\xe9 par courrier, email ({ecole_email}) ou directement \xe0 notre secr\xe9tariat 
          avant le {validite_devis}.
        </p>
      </div>

      ${rc("L'Organisme de Formation","Le Client (Bon pour accord)")}
    `,footerContent:rb},convocation:{type:"convocation",name:"Convocation",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 25px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0; color: #1A1A1A;">
          CONVOCATION
        </h1>
      </div>

      <div style="margin-bottom: 25px;">
        <p style="font-size: 10pt; margin: 0 0 15px 0;">Madame, Monsieur,</p>
        <p style="font-size: 10pt; margin: 0 0 10px 0; text-align: justify; line-height: 1.6;">
          Nous avons l'honneur de vous convier \xe0 :
        </p>
      </div>

      <div style="padding: 20px; background-color: #F9FAFB; border-left: 3px solid #1A1A1A; margin-bottom: 25px;">
        <p style="margin: 0 0 10px 0; font-size: 10pt;"><strong>Objet :</strong> {convocation_objet}</p>
        <p style="margin: 0 0 10px 0; font-size: 10pt;"><strong>Date :</strong> {convocation_date}</p>
        <p style="margin: 0 0 10px 0; font-size: 10pt;"><strong>Heure :</strong> {convocation_heure}</p>
        <p style="margin: 0 0 10px 0; font-size: 10pt;"><strong>Lieu :</strong> {convocation_lieu}</p>
        <p style="margin: 0 0 10px 0; font-size: 10pt;"><strong>Adresse :</strong> {convocation_adresse}</p>
        <p style="margin: 0; font-size: 10pt;"><strong>Dur\xe9e pr\xe9vue :</strong> {convocation_duree}</p>
      </div>

      <div style="margin-bottom: 25px;">
        <p style="margin: 0 0 8px 0; font-size: 10pt;"><strong>Participant(s) :</strong></p>
        <p style="margin: 0; font-size: 10pt;">{eleve_nom} {eleve_prenom}</p>
        <p style="margin: 5px 0 0 0; font-size: 10pt;">Num\xe9ro d'\xe9l\xe8ve : {eleve_numero}</p>
        <p style="margin: 5px 0 0 0; font-size: 10pt;">Formation : {formation_nom}</p>
      </div>

      <div style="margin-bottom: 25px;">
        <p style="margin: 0 0 8px 0; font-size: 10pt;"><strong>Ordre du jour :</strong></p>
        <div style="margin-left: 15px; font-size: 10pt;">
          {convocation_contenu}
        </div>
      </div>

      <div style="padding: 15px; background-color: #FEF3C7; border-left: 3px solid #F59E0B; margin-bottom: 25px;">
        <p style="margin: 0; font-size: 10pt; font-weight: 600; color: #92400E;">Note importante :</p>
        <p style="margin: 5px 0 0 0; font-size: 10pt; color: #78350F;">
          Veuillez confirmer votre pr\xe9sence avant le {date_confirmation} en r\xe9pondant \xe0 ce message ou en contactant 
          le {ecole_telephone}.
        </p>
      </div>

      <p style="margin: 25px 0 10px 0; font-size: 10pt;">Nous restons \xe0 votre disposition pour tout compl\xe9ment d'information.</p>
      <p style="margin: 10px 0 20px 0; font-size: 10pt;">Cordialement,</p>
      
      <div style="margin-top: 30px;">
        <p style="margin: 0; font-size: 10pt; font-weight: bold;">{ecole_representant}</p>
        <p style="margin: 3px 0; font-size: 10pt;">{ecole_nom}</p>
      </div>

      <p style="margin-top: 25px; font-size: 9pt; color: #666;">
        Fait \xe0 {ecole_ville}, le {date_jour}
      </p>
    `,footerContent:rb},contrat:{type:"contrat",name:"Contrat de scolarit",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 25px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0 0 8px 0; color: #1A1A1A;">
          CONTRAT DE SCOLARIT\xc9
        </h1>
        <p style="font-size: 11pt; color: #666; margin: 0;">Ann\xe9e scolaire {annee_scolaire}</p>
      </div>

      
    <div style="margin-bottom: 25px;">
      <p style="font-weight: bold; margin: 0 0 12px 0; font-size: 11pt;">Entre l'organisme de formation : {ecole_nom}</p>
      <p style="margin: 0 0 3px 0; font-size: 10pt;">immatricul\xe9e au RCS de sous le num\xe9ro {ecole_siret}</p>
      <p style="margin: 0 0 10px 0; font-size: 10pt;">Dont le si\xe8ge social est situ\xe9 {ecole_adresse} {ecole_code_postal} {ecole_ville}.</p>
      
      <p style="margin: 12px 0 0 0; font-size: 10pt;">
        Repr\xe9sent\xe9e aux fins des pr\xe9sentes par {ecole_representant} en sa qualit\xe9 de repr\xe9sentant, d\xfbment habilit\xe9(e).
      </p>
      <p style="margin: 5px 0 0 0; font-size: 10pt;">
        D\xe9claration d'activit\xe9 n\xb0{ecole_numero_declaration} aupr\xe8s de la pr\xe9fecture de la r\xe9gion .
      </p>
      
      <p style="margin: 15px 0 5px 0; font-weight: bold; font-style: italic; font-size: 10pt;">
        Ci-apr\xe8s d\xe9nomm\xe9e \xab l'Organisme de Formation \xbb
      </p>
      
      <p style="margin: 20px 0 10px 0; font-weight: bold; font-size: 11pt;">D'une part</p>
      
      <p style="margin: 20px 0 10px 0; font-weight: bold; font-size: 11pt;">Et {eleve_prenom} {eleve_nom}</p>
      
      <p style="margin: 15px 0 5px 0; font-weight: bold; font-style: italic; font-size: 10pt;">
        Ci-apr\xe8s d\xe9nomm\xe9e \xab le B\xe9n\xe9ficiaire \xbb
      </p>
      
      <p style="margin: 20px 0 10px 0; font-weight: bold; font-size: 11pt;">D'autre part</p>
      
      <p style="margin: 20px 0 15px 0; font-style: italic; font-size: 10pt;">
        Ci-apr\xe8s individuellement ou collectivement d\xe9sign\xe9(s) la ou les \xab Partie(s) \xbb
      </p>
    </div>
  

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 1 - Inscription et scolarit\xe9</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt;">
        L'\xe9l\xe8ve <strong>{eleve_nom} {eleve_prenom}</strong> est inscrit(e) pour l'ann\xe9e scolaire <strong>{annee_scolaire}</strong> 
        dans la classe <strong>{eleve_classe}</strong> de l'\xe9tablissement <strong>{ecole_nom}</strong>.
      </p>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin-top: 10px;">
        La scolarit\xe9 d\xe9bute le {session_debut} et se termine le {session_fin}. 
        Les cours sont dispens\xe9s selon le calendrier scolaire et les horaires d\xe9finis par l'\xe9tablissement.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 2 - Frais de scolarit\xe9</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt;">
        Les frais de scolarit\xe9 pour l'ann\xe9e scolaire <strong>{annee_scolaire}</strong> s'\xe9l\xe8vent \xe0 
        <strong>{montant_ttc} </strong> (en toutes lettres : {montant_lettres}).
      </p>
      <p style="margin: 15px 0 5px 0; font-size: 10pt;"><strong>Modalit\xe9s de paiement :</strong></p>
      <p style="font-size: 10pt; margin: 0;">{mode_paiement}</p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 3 - Obligations de l'\xe9l\xe8ve</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt;">L'\xe9l\xe8ve s'engage \xe0 :</p>
      <ul style="margin: 10px 0 10px 20px; font-size: 10pt; line-height: 1.6;">
        <li>Suivre assid\xfbment tous les cours et activit\xe9s p\xe9dagogiques</li>
        <li>Respecter le r\xe8glement int\xe9rieur de l'\xe9tablissement</li>
        <li>Acquitter les frais de scolarit\xe9 dans les d\xe9lais convenus</li>
        <li>Participer activement aux \xe9valuations</li>
      </ul>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 4 - Engagements de l'\xe9tablissement</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt;">L'\xe9tablissement s'engage \xe0 :</p>
      <ul style="margin: 10px 0 10px 20px; font-size: 10pt; line-height: 1.6;">
        <li>Dispenser un enseignement de qualit\xe9 conforme aux programmes</li>
        <li>Fournir les moyens p\xe9dagogiques n\xe9cessaires</li>
        <li>Assurer le suivi p\xe9dagogique et l'\xe9valuation des acquis</li>
        <li>D\xe9livrer les documents administratifs n\xe9cessaires</li>
      </ul>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 5 - R\xe9siliation</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt;">
        Le pr\xe9sent contrat peut \xeatre r\xe9sili\xe9 par l'une ou l'autre des parties, sous r\xe9serve d'un pr\xe9avis d'un mois. 
        En cas de r\xe9siliation par l'\xe9l\xe8ve ou sa famille, les frais de scolarit\xe9 dus pour la p\xe9riode d\xe9j\xe0 \xe9coul\xe9e 
        restent acquis \xe0 l'\xe9tablissement.
      </p>

      ${rc("L'tablissement","L'lve / Reprsentant lgal")}
    `,footerContent:rb},attestation_reussite:{type:"attestation_reussite",name:"Attestation de russite",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0; color: #1A1A1A;">
          ATTESTATION DE R\xc9USSITE
        </h1>
      </div>

      <div style="margin-bottom: 25px;">
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0 0 15px 0;">
          Le directeur de <strong>{ecole_nom}</strong>, \xe9tablissement situ\xe9 \xe0 <strong>{ecole_adresse}</strong>,
        </p>
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0 0 15px 0;">
          <strong>ATTESTE</strong> que <strong>{eleve_nom} {eleve_prenom}</strong>, n\xe9(e) le 
          <strong>{eleve_date_naissance}</strong>, num\xe9ro d'\xe9l\xe8ve <strong>{eleve_numero}</strong>,
        </p>
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0 0 15px 0;">
          a suivi avec <strong>assiduit\xe9</strong> et a <strong>r\xe9ussi</strong> la formation intitul\xe9e 
          <strong>"{formation_nom}"</strong>
        </p>
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0;">
          qui s'est d\xe9roul\xe9e du <strong>{session_debut}</strong> au <strong>{session_fin}</strong> 
          (dur\xe9e : {formation_duree}).
        </p>
      </div>

      <div style="padding: 15px; background-color: #F0F9FF; border-left: 3px solid #0EA5E9; margin-bottom: 25px;">
        <p style="margin: 0; font-size: 10pt; font-weight: bold;">R\xe9sultats :</p>
        <p style="margin: 8px 0 0 0; font-size: 10pt;">Moyenne g\xe9n\xe9rale : <strong>{moyenne}/20</strong></p>
        <p style="margin: 5px 0 0 0; font-size: 10pt;">Mention : <strong>{mention}</strong></p>
        <p style="margin: 5px 0 0 0; font-size: 10pt;">Classement : <strong>{classement}</strong></p>
      </div>

      <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 30px 0;">
        La pr\xe9sente attestation est d\xe9livr\xe9e \xe0 l'int\xe9ress\xe9(e) pour servir et valoir ce que de droit.
      </p>

      <div style="margin-top: 50px; text-align: right;">
        <p style="margin: 0; font-size: 10pt;">Fait \xe0 {ecole_ville}, le {date_jour}</p>
        <div style="margin-top: 40px;">
          <p style="margin: 0; font-weight: bold; font-size: 10pt;">{ecole_representant}</p>
          <p style="margin: 3px 0 0 0; font-size: 10pt;">Directeur</p>
          <div style="border-top: 1px solid #1A1A1A; margin: 30px 0 0 auto; width: 180px; padding-top: 8px; text-align: center;">
            <p style="font-size: 9pt; color: #666; margin: 0;">Signature et cachet</p>
          </div>
        </div>
      </div>
    `,footerContent:rb},certificat_scolarite:{type:"certificat_scolarite",name:"Certificat de scolarit",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0 0 8px 0; color: #1A1A1A;">
          CERTIFICAT DE SCOLARIT\xc9
        </h1>
        <p style="font-size: 11pt; color: #666; margin: 0;">Ann\xe9e scolaire {annee_scolaire}</p>
      </div>

      <div style="margin-bottom: 25px;">
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0 0 15px 0;">
          Le directeur de <strong>{ecole_nom}</strong>, \xe9tablissement situ\xe9 \xe0 <strong>{ecole_adresse}</strong>,
        </p>
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0 0 15px 0;">
          <strong>CERTIFIE</strong> que <strong>{eleve_nom} {eleve_prenom}</strong>, n\xe9(e) le 
          <strong>{eleve_date_naissance}</strong>, num\xe9ro d'\xe9l\xe8ve <strong>{eleve_numero}</strong>,
        </p>
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0 0 15px 0;">
          est r\xe9guli\xe8rement inscrit(e) dans cet \xe9tablissement pour l'ann\xe9e scolaire <strong>{annee_scolaire}</strong>,
        </p>
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0;">
          en classe de <strong>{eleve_classe}</strong>.
        </p>
      </div>

      <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 40px 0;">
        Le pr\xe9sent certificat est d\xe9livr\xe9 \xe0 l'int\xe9ress\xe9(e) pour servir et valoir ce que de droit.
      </p>

      <div style="margin-top: 50px; text-align: right;">
        <p style="margin: 0; font-size: 10pt;">Fait \xe0 {ecole_ville}, le {date_jour}</p>
        <div style="margin-top: 40px;">
          <p style="margin: 0; font-weight: bold; font-size: 10pt;">{ecole_representant}</p>
          <p style="margin: 3px 0 0 0; font-size: 10pt;">Directeur</p>
          <div style="border-top: 1px solid #1A1A1A; margin: 30px 0 0 auto; width: 180px; padding-top: 8px; text-align: center;">
            <p style="font-size: 9pt; color: #666; margin: 0;">Signature et cachet</p>
          </div>
        </div>
      </div>
    `,footerContent:rb},releve_notes:{type:"releve_notes",name:"Relev de notes",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 25px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0 0 8px 0; color: #1A1A1A;">
          RELEV\xc9 DE NOTES
        </h1>
        <p style="font-size: 11pt; color: #666; margin: 0;">Ann\xe9e scolaire {annee_scolaire} - {trimestre}</p>
      </div>

      <div style="padding: 15px; background-color: #F9FAFB; border-left: 3px solid #1A1A1A; margin-bottom: 25px;">
        <table style="width: 100%; border-collapse: collapse; font-size: 10pt;">
          <tr><td style="padding: 4px 0; width: 150px; font-weight: 600;">Nom :</td><td style="padding: 4px 0; font-weight: bold;">{eleve_nom}</td></tr>
          <tr><td style="padding: 4px 0; font-weight: 600;">Pr\xe9nom :</td><td style="padding: 4px 0; font-weight: bold;">{eleve_prenom}</td></tr>
          <tr><td style="padding: 4px 0; font-weight: 600;">Num\xe9ro d'\xe9l\xe8ve :</td><td style="padding: 4px 0;">{eleve_numero}</td></tr>
          <tr><td style="padding: 4px 0; font-weight: 600;">Classe :</td><td style="padding: 4px 0;">{eleve_classe}</td></tr>
        </table>
      </div>

      <table style="width: 100%; border-collapse: collapse; margin: 25px 0; font-size: 10pt;">
        <thead>
          <tr style="background-color: #1A1A1A; color: white;">
            <th style="padding: 10px 12px; text-align: left; font-weight: bold;">Mati\xe8re</th>
            <th style="padding: 10px 12px; text-align: center; font-weight: bold; width: 70px;">Coeff.</th>
            <th style="padding: 10px 12px; text-align: center; font-weight: bold; width: 80px;">Note /20</th>
            <th style="padding: 10px 12px; text-align: left; font-weight: bold;">Appr\xe9ciation</th>
          </tr>
        </thead>
        <tbody>
          <tr style="border-bottom: 1px solid #E5E7EB; background-color: #FAFAFA;">
            <td style="padding: 10px 12px; font-weight: 500;">{matiere_1}</td>
            <td style="padding: 10px 12px; text-align: center;">{coef_1}</td>
            <td style="padding: 10px 12px; text-align: center; font-weight: bold;">{note_1}</td>
            <td style="padding: 10px 12px; font-size: 9pt; color: #666;">{appreciation_1}</td>
          </tr>
          <tr style="border-bottom: 1px solid #E5E7EB;">
            <td style="padding: 10px 12px; font-weight: 500;">{matiere_2}</td>
            <td style="padding: 10px 12px; text-align: center;">{coef_2}</td>
            <td style="padding: 10px 12px; text-align: center; font-weight: bold;">{note_2}</td>
            <td style="padding: 10px 12px; font-size: 9pt; color: #666;">{appreciation_2}</td>
          </tr>
          <tr style="border-bottom: 1px solid #E5E7EB; background-color: #FAFAFA;">
            <td style="padding: 10px 12px; font-weight: 500;">{matiere_3}</td>
            <td style="padding: 10px 12px; text-align: center;">{coef_3}</td>
            <td style="padding: 10px 12px; text-align: center; font-weight: bold;">{note_3}</td>
            <td style="padding: 10px 12px; font-size: 9pt; color: #666;">{appreciation_3}</td>
          </tr>
        </tbody>
      </table>

      <div style="display: flex; justify-content: space-between; padding: 15px; background-color: #F0F9FF; border-left: 3px solid #0EA5E9; margin-bottom: 25px;">
        <div style="flex: 1;">
          <p style="margin: 0 0 8px 0; font-size: 11pt;">
            <strong>Moyenne g\xe9n\xe9rale :</strong> <span style="font-size: 14pt; font-weight: bold;">{moyenne}/20</span>
          </p>
          <p style="margin: 0 0 5px 0; font-size: 10pt; color: #666;">Moyenne de la classe : {moyenne_classe}/20</p>
          <p style="margin: 0; font-size: 10pt; color: #666;">Classement : {classement} sur {effectif_classe} \xe9l\xe8ves</p>
        </div>
        <div style="text-align: right; padding-left: 20px;">
          <div style="padding: 10px 15px; background-color: #FEF3C7; border-radius: 4px; display: inline-block;">
            <p style="margin: 0; font-size: 9pt; font-weight: 600; color: #92400E; text-transform: uppercase;">Mention</p>
            <p style="margin: 4px 0 0 0; font-size: 12pt; font-weight: bold; color: #78350F;">{mention}</p>
          </div>
        </div>
      </div>

      <div style="padding: 15px; background-color: #F9FAFB; border-left: 3px solid #1A1A1A; margin-bottom: 25px;">
        <p style="font-weight: bold; margin: 0 0 10px 0; font-size: 10pt;">Appr\xe9ciation g\xe9n\xe9rale :</p>
        <p style="text-align: justify; line-height: 1.6; font-size: 10pt; color: #333; margin: 0;">
          {appreciations}
        </p>
      </div>

      <div style="margin-top: 40px; text-align: right;">
        <p style="margin: 0; font-size: 10pt;">Fait \xe0 {ecole_ville}, le {date_jour}</p>
        <div style="margin-top: 30px;">
          <p style="margin: 0; font-weight: bold; font-size: 10pt;">{ecole_representant}</p>
          <p style="margin: 3px 0 0 0; font-size: 10pt;">Directeur</p>
        </div>
      </div>
    `,footerContent:rb},attestation_entree:{type:"attestation_entree",name:"Attestation d'entre en formation",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0; color: #1A1A1A;">
          ATTESTATION D'ENTR\xc9E EN FORMATION
        </h1>
      </div>

      <div style="margin-bottom: 25px;">
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0 0 15px 0;">
          Le directeur de <strong>{ecole_nom}</strong>, \xe9tablissement situ\xe9 \xe0 <strong>{ecole_adresse}</strong>,
        </p>
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0 0 15px 0;">
          <strong>ATTESTE</strong> que <strong>{eleve_nom} {eleve_prenom}</strong>, n\xe9(e) le 
          <strong>{eleve_date_naissance}</strong>, num\xe9ro d'\xe9l\xe8ve <strong>{eleve_numero}</strong>,
        </p>
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0 0 15px 0;">
          a \xe9t\xe9 admis(e) et s'est inscrit(e) dans la formation intitul\xe9e <strong>"{formation_nom}"</strong>
        </p>
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0;">
          qui d\xe9butera le <strong>{session_debut}</strong> et se terminera le <strong>{session_fin}</strong> 
          (dur\xe9e : {formation_duree}).
        </p>
      </div>

      <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 40px 0;">
        La pr\xe9sente attestation est d\xe9livr\xe9e \xe0 l'int\xe9ress\xe9(e) pour servir et valoir ce que de droit, 
        notamment pour l'\xe9tablissement des droits sociaux et administratifs.
      </p>

      <div style="margin-top: 50px; text-align: right;">
        <p style="margin: 0; font-size: 10pt;">Fait \xe0 {ecole_ville}, le {date_jour}</p>
        <div style="margin-top: 40px;">
          <p style="margin: 0; font-weight: bold; font-size: 10pt;">{ecole_representant}</p>
          <p style="margin: 3px 0 0 0; font-size: 10pt;">Directeur</p>
          <div style="border-top: 1px solid #1A1A1A; margin: 30px 0 0 auto; width: 180px; padding-top: 8px; text-align: center;">
            <p style="font-size: 9pt; color: #666; margin: 0;">Signature et cachet</p>
          </div>
        </div>
      </div>
    `,footerContent:rb},reglement_interieur:{type:"reglement_interieur",name:"Rglement intrieur",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 25px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0 0 8px 0; color: #1A1A1A;">
          R\xc8GLEMENT INT\xc9RIEUR
        </h1>
        <p style="font-size: 11pt; color: #666; margin: 0;">Ann\xe9e scolaire {annee_scolaire}</p>
      </div>

      <div style="margin-bottom: 25px;">
        <h2 style="font-size: 12pt; font-weight: bold; margin: 0 0 12px 0; color: #1A1A1A;">PR\xc9AMBULE</h2>
        <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
          Le pr\xe9sent r\xe8glement int\xe9rieur a pour objet de fixer les r\xe8gles de vie collective applicables 
          \xe0 tous les membres de la communaut\xe9 \xe9ducative de <strong>{ecole_nom}</strong>. Il s'applique 
          \xe0 l'ensemble des personnes pr\xe9sentes dans l'\xe9tablissement.
        </p>
      </div>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 1 : Principes g\xe9n\xe9raux</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        L'\xe9tablissement <strong>{ecole_nom}</strong> a pour mission de dispenser un enseignement de qualit\xe9 
        dans le respect des valeurs de la R\xe9publique : libert\xe9, \xe9galit\xe9, fraternit\xe9, la\xefcit\xe9.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 2 : Horaires</h2>
      <ul style="margin: 10px 0 10px 20px; font-size: 10pt; line-height: 1.6;">
        <li>Horaires d'ouverture : {horaires_ouverture}</li>
        <li>Horaires des cours : {horaires_cours}</li>
        <li>Les \xe9l\xe8ves doivent arriver \xe0 l'heure et assister \xe0 tous les cours</li>
        <li>Tout retard ou absence doit \xeatre justifi\xe9</li>
      </ul>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 3 : Assiduit\xe9</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        L'assiduit\xe9 est obligatoire pour tous les cours et activit\xe9s p\xe9dagogiques. 
        Les absences doivent \xeatre signal\xe9es et justifi\xe9es dans les meilleurs d\xe9lais.
        En cas d'absences r\xe9p\xe9t\xe9es et non justifi\xe9es, l'\xe9tablissement se r\xe9serve le droit de prendre 
        les mesures appropri\xe9es.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 4 : Comportement</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        Les \xe9l\xe8ves doivent adopter un comportement respectueux envers tous les membres de la communaut\xe9 
        \xe9ducative et se conformer aux r\xe8gles de politesse et de civilit\xe9.
        Tout acte de violence, de harc\xe8lement ou de discrimination est strictement interdit et peut 
        donner lieu \xe0 des sanctions disciplinaires.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 5 : Sanctions disciplinaires</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        En cas de manquement au r\xe8glement int\xe9rieur, des sanctions peuvent \xeatre prononc\xe9es selon 
        la gravit\xe9 des faits : avertissement, exclusion temporaire ou d\xe9finitive.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 6 : Hygi\xe8ne et s\xe9curit\xe9</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        Les consignes de s\xe9curit\xe9 affich\xe9es dans l'\xe9tablissement doivent \xeatre respect\xe9es.
        L'usage du tabac, de l'alcool et de toute substance illicite est strictement interdit.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 7 : Publicit\xe9</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        Le pr\xe9sent r\xe8glement est affich\xe9 dans les locaux et sur le site internet de l'organisme de formation. En outre, un exemplaire est remis \xe0 chaque 
        stagiaire.
      </p>

      <div style="margin-top: 40px;">
        <p style="margin: 0; font-size: 10pt;">Fait \xe0 {ecole_ville}</p>
        <p style="margin: 5px 0 0 0; font-size: 10pt;">Le {date_jour}</p>
      </div>
    `,footerContent:rb},cgv:{type:"cgv",name:"Conditions Gnrales de Vente",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 25px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0 0 8px 0; color: #1A1A1A;">
          CONDITIONS G\xc9N\xc9RALES DE VENTE
        </h1>
        <p style="font-size: 11pt; color: #666; margin: 0;">{ecole_nom}</p>
      </div>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 1 - Objet</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        Les pr\xe9sentes Conditions G\xe9n\xe9rales de Vente (CGV) r\xe9gissent les relations contractuelles entre 
        <strong>{ecole_nom}</strong> et ses clients dans le cadre de la vente de formations et de services \xe9ducatifs.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 2 - Commandes</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        Toute commande de formation implique l'acceptation sans r\xe9serve des pr\xe9sentes CGV. 
        La commande devient ferme et d\xe9finitive apr\xe8s acceptation de l'\xe9tablissement.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 3 - Prix</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        Les prix des formations sont indiqu\xe9s en euros TTC. Ils sont fermes et non r\xe9visables pendant 
        la dur\xe9e de validit\xe9 indiqu\xe9e sur le devis.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 4 - Modalit\xe9s de paiement</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        Le paiement s'effectue selon les modalit\xe9s d\xe9finies dans le contrat ou le devis accept\xe9. 
        En cas de retard de paiement, des p\xe9nalit\xe9s de retard au taux de 3 fois le taux l\xe9gal 
        peuvent \xeatre appliqu\xe9es.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 5 - Droit de r\xe9tractation</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        Conform\xe9ment \xe0 la l\xe9gislation en vigueur, le client dispose d'un d\xe9lai de 14 jours calendaires 
        pour exercer son droit de r\xe9tractation \xe0 compter de l'acceptation de la commande.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 6 - Annulation</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        En cas d'annulation par le client, des frais d'annulation peuvent \xeatre appliqu\xe9s selon 
        les conditions pr\xe9vues dans le contrat. L'\xe9tablissement se r\xe9serve le droit d'annuler 
        une formation en cas d'insuffisance d'inscriptions.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 7 - Responsabilit\xe9</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        L'\xe9tablissement s'engage \xe0 dispenser les formations dans les conditions de qualit\xe9 
        pr\xe9vues. La responsabilit\xe9 de l'\xe9tablissement est limit\xe9e aux dommages directs et pr\xe9visibles.
      </p>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Article 8 - Litiges</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        En cas de litige, les parties conviennent de rechercher une solution amiable avant toute 
        action judiciaire. \xc0 d\xe9faut, les tribunaux de {ecole_ville} seront seuls comp\xe9tents.
      </p>

      <div style="margin-top: 40px; text-align: right;">
        <p style="margin: 0; font-size: 10pt;">Fait \xe0 {ecole_ville}, le {date_jour}</p>
        <div style="margin-top: 30px;">
          <p style="margin: 0; font-weight: bold; font-size: 10pt;">{ecole_representant}</p>
          <p style="margin: 3px 0 0 0; font-size: 10pt;">Directeur</p>
        </div>
      </div>
    `,footerContent:rb},programme:{type:"programme",name:"Programme de formation",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 25px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0 0 8px 0; color: #1A1A1A;">
          PROGRAMME DE FORMATION
        </h1>
        <p style="font-size: 14pt; font-weight: bold; margin: 10px 0 0 0; color: #333;">
          {programme_nom}
        </p>
        <p style="font-size: 10pt; color: #666; margin: 5px 0 0 0;">
          Code : {programme_code} | Dur\xe9e totale : {programme_duree_totale}
        </p>
      </div>

      <div style="padding: 15px; background-color: #F9FAFB; border-left: 3px solid #1A1A1A; margin-bottom: 20px;">
        <p style="margin: 0 0 8px 0; font-size: 11pt; font-weight: bold;"> Description du programme :</p>
        <p style="margin: 0; text-align: justify; line-height: 1.6; font-size: 10pt;">
          {programme_description}
        </p>
      </div>

      <div style="padding: 15px; background-color: #F0F9FF; border-left: 3px solid #0EA5E9; margin-bottom: 20px;">
        <p style="margin: 0 0 8px 0; font-size: 11pt; font-weight: bold;"> Objectifs du programme :</p>
        <p style="margin: 0; text-align: justify; line-height: 1.6; font-size: 10pt;">
          {programme_objectifs}
        </p>
      </div>

      <div style="padding: 15px; background-color: #FEF3C7; border-left: 3px solid #F59E0B; margin-bottom: 20px;">
        <p style="margin: 0 0 8px 0; font-size: 11pt; font-weight: bold;"> Public concern\xe9 :</p>
        <p style="margin: 0; line-height: 1.6; font-size: 10pt;">
          {programme_public_concerne}
        </p>
      </div>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">Pr\xe9requis</h2>
      <ul style="margin: 10px 0 20px 20px; font-size: 10pt; line-height: 1.6;">
        <li>{prerequis_1}</li>
        <li>{prerequis_2}</li>
        <li>{prerequis_3}</li>
      </ul>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">CONTENU P\xc9DAGOGIQUE</h2>

      <div style="margin-bottom: 20px; padding: 15px; background-color: #FAFAFA; border-radius: 4px;">
        <h3 style="font-size: 11pt; font-weight: bold; margin: 0 0 10px 0;">Module 1 : {module_1_titre}</h3>
        <p style="margin: 0 0 10px 0; font-size: 10pt;"><strong>Dur\xe9e :</strong> {module_1_duree}</p>
        <ul style="margin: 0 0 0 20px; font-size: 10pt; line-height: 1.6;">
          <li>{module_1_contenu_1}</li>
          <li>{module_1_contenu_2}</li>
          <li>{module_1_contenu_3}</li>
        </ul>
      </div>

      <div style="margin-bottom: 20px; padding: 15px; background-color: #FAFAFA; border-radius: 4px;">
        <h3 style="font-size: 11pt; font-weight: bold; margin: 0 0 10px 0;">Module 2 : {module_2_titre}</h3>
        <p style="margin: 0 0 10px 0; font-size: 10pt;"><strong>Dur\xe9e :</strong> {module_2_duree}</p>
        <ul style="margin: 0 0 0 20px; font-size: 10pt; line-height: 1.6;">
          <li>{module_2_contenu_1}</li>
          <li>{module_2_contenu_2}</li>
          <li>{module_2_contenu_3}</li>
        </ul>
      </div>

      <div style="margin-bottom: 20px; padding: 15px; background-color: #FAFAFA; border-radius: 4px;">
        <h3 style="font-size: 11pt; font-weight: bold; margin: 0 0 10px 0;">Module 3 : {module_3_titre}</h3>
        <p style="margin: 0 0 10px 0; font-size: 10pt;"><strong>Dur\xe9e :</strong> {module_3_duree}</p>
        <ul style="margin: 0 0 0 20px; font-size: 10pt; line-height: 1.6;">
          <li>{module_3_contenu_1}</li>
          <li>{module_3_contenu_2}</li>
          <li>{module_3_contenu_3}</li>
        </ul>
      </div>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">M\xc9THODES P\xc9DAGOGIQUES</h2>
      <ul style="margin: 10px 0 20px 20px; font-size: 10pt; line-height: 1.6;">
        <li>Cours th\xe9oriques et pratiques</li>
        <li>Travaux dirig\xe9s et \xe9tudes de cas</li>
        <li>Projets et mises en situation</li>
        <li>\xc9valuations continues</li>
      </ul>

      <h2 style="font-size: 12pt; font-weight: bold; margin: 25px 0 12px 0; color: #1A1A1A;">MODALIT\xc9S D'\xc9VALUATION</h2>
      <p style="text-align: justify; line-height: 1.6; font-size: 10pt; margin: 0;">
        L'\xe9valuation se fait par contr\xf4le continu, travaux pratiques et examen final. 
        Une attestation de r\xe9ussite est d\xe9livr\xe9e aux participants ayant obtenu une moyenne 
        minimale de 10/20.
      </p>

      <div style="padding: 15px; background-color: #F0F9FF; border-left: 3px solid #0EA5E9; margin: 25px 0;">
        <p style="margin: 0 0 8px 0; font-size: 10pt;"><strong>Dates de formation :</strong></p>
        <p style="margin: 0 0 8px 0; font-size: 10pt;">Du {session_debut} au {session_fin}</p>
        <p style="margin: 0 0 8px 0; font-size: 10pt;"><strong>Lieu :</strong> {session_lieu}</p>
        <p style="margin: 0; font-size: 10pt;"><strong>Horaires :</strong> {session_horaires}</p>
      </div>

      <div style="margin-top: 30px; text-align: right;">
        <p style="margin: 0; font-size: 10pt;">Fait \xe0 {ecole_ville}, le {date_jour}</p>
        <div style="margin-top: 20px;">
          <p style="margin: 0; font-weight: bold; font-size: 10pt;">{ecole_representant}</p>
          <p style="margin: 3px 0 0 0; font-size: 10pt;">Directeur</p>
        </div>
      </div>
    `,footerContent:rb},attestation_assiduite:{type:"attestation_assiduite",name:"Attestation d'assiduit",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0; color: #1A1A1A;">
          ATTESTATION D'ASSIDUIT\xc9
        </h1>
      </div>

      <div style="margin-bottom: 25px;">
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0 0 15px 0;">
          Le directeur de <strong>{ecole_nom}</strong>, \xe9tablissement situ\xe9 \xe0 <strong>{ecole_adresse}</strong>,
        </p>
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0 0 15px 0;">
          <strong>ATTESTE</strong> que <strong>{eleve_nom} {eleve_prenom}</strong>, n\xe9(e) le 
          <strong>{eleve_date_naissance}</strong>, num\xe9ro d'\xe9l\xe8ve <strong>{eleve_numero}</strong>,
        </p>
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0 0 15px 0;">
          a suivi avec <strong>assiduit\xe9</strong> la formation intitul\xe9e <strong>"{formation_nom}"</strong>
        </p>
        <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 0;">
          qui s'est d\xe9roul\xe9e du <strong>{session_debut}</strong> au <strong>{session_fin}</strong> 
          (dur\xe9e totale : {formation_duree}).
        </p>
      </div>

      <div style="padding: 15px; background-color: #F0F9FF; border-left: 3px solid #0EA5E9; margin-bottom: 25px;">
        <p style="margin: 0; font-size: 10pt; font-weight: bold;">Taux de pr\xe9sence :</p>
        <p style="margin: 8px 0 0 0; font-size: 10pt;">Heures suivies : <strong>{heures_suivies}</strong> sur <strong>{heures_totales}</strong></p>
        <p style="margin: 5px 0 0 0; font-size: 10pt;">Taux d'assiduit\xe9 : <strong>{taux_assiduite}%</strong></p>
      </div>

      <p style="text-align: justify; line-height: 1.8; font-size: 10pt; margin: 40px 0;">
        La pr\xe9sente attestation est d\xe9livr\xe9e \xe0 l'int\xe9ress\xe9(e) pour servir et valoir ce que de droit, 
        notamment pour l'\xe9tablissement des droits sociaux, administratifs et pour justifier de sa 
        pr\xe9sence en formation.
      </p>

      <div style="margin-top: 50px; text-align: right;">
        <p style="margin: 0; font-size: 10pt;">Fait \xe0 {ecole_ville}, le {date_jour}</p>
        <div style="margin-top: 40px;">
          <p style="margin: 0; font-weight: bold; font-size: 10pt;">{ecole_representant}</p>
          <p style="margin: 3px 0 0 0; font-size: 10pt;">Directeur</p>
          <div style="border-top: 1px solid #1A1A1A; margin: 30px 0 0 auto; width: 180px; padding-top: 8px; text-align: center;">
            <p style="font-size: 9pt; color: #666; margin: 0;">Signature et cachet</p>
          </div>
        </div>
      </div>
    `,footerContent:rb},certificat_realisation:{type:"certificat_realisation",name:"Certificat de ralisation",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0; color: #1A1A1A;">
          CERTIFICAT DE R\xc9ALISATION
        </h1>
      </div>
      
      <div style="margin-bottom: 30px;">
        <p style="text-align: justify; font-size: 11pt; line-height: 1.6;">
          L'\xe9tablissement <strong>{ecole_nom}</strong> certifie que 
          <strong>{eleve_prenom} {eleve_nom}</strong> a r\xe9alis\xe9 avec succ\xe8s la formation 
          <strong>"{formation_nom}"</strong>.
        </p>
      </div>
      
      <div style="margin-top: 50px; text-align: center;">
        <p style="margin-bottom: 30px;">{ecole_ville}, le {date_jour}</p>
        <p><strong>Le Directeur</strong></p>
        <p style="margin-top: 40px;">________________________</p>
        <p>{ecole_directeur}</p>
      </div>
    `,footerContent:rb},livret_accueil:{type:"livret_accueil",name:"Livret d'accueil",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0; color: #1A1A1A;">
          LIVRET D'ACCUEIL
        </h1>
      </div>
      
      <div style="margin-bottom: 30px;">
        <h2 style="font-size: 14pt; font-weight: bold; margin-bottom: 15px;">BIENVENUE</h2>
        <p style="text-align: justify; font-size: 11pt; line-height: 1.6;">
          Bienvenue \xe0 <strong>{ecole_nom}</strong>.
        </p>
        <p style="text-align: justify; font-size: 11pt; line-height: 1.6; margin-top: 10px;">
          Ce livret vous pr\xe9sente les informations essentielles de notre \xe9tablissement.
        </p>
      </div>
      
      <div style="margin-bottom: 30px;">
        <h2 style="font-size: 14pt; font-weight: bold; margin-bottom: 15px;">PR\xc9SENTATION</h2>
        <p style="font-size: 11pt; line-height: 1.6;"><strong>\xc9tablissement :</strong> {ecole_nom}</p>
        <p style="font-size: 11pt; line-height: 1.6;"><strong>Adresse :</strong> {ecole_adresse}, {ecole_ville}</p>
        <p style="font-size: 11pt; line-height: 1.6;"><strong>Contact :</strong> {ecole_telephone} | {ecole_email}</p>
      </div>
    `,footerContent:rb},emargement:{type:"emargement",name:"Feuille d'margement",headerContent:ra,bodyContent:`
      <div style="text-align: center; margin-bottom: 30px;">
        <h1 style="font-size: 16pt; font-weight: bold; margin: 0; color: #1A1A1A;">
          FEUILLE D'\xc9MARGEMENT
        </h1>
      </div>
      
      <div style="margin-bottom: 30px;">
        <p style="font-size: 11pt; line-height: 1.6;"><strong>Formation :</strong> {formation_nom}</p>
        <p style="font-size: 11pt; line-height: 1.6;"><strong>Session :</strong> {session_nom}</p>
        <p style="font-size: 11pt; line-height: 1.6;"><strong>Date :</strong> {session_debut}</p>
        <p style="font-size: 11pt; line-height: 1.6;"><strong>Lieu :</strong> {session_lieu}</p>
      </div>
      
      <table style="width: 100%; border-collapse: collapse; margin-top: 30px;">
        <thead>
          <tr style="background-color: #f3f4f6;">
            <th style="padding: 10px; border: 1px solid #ddd; text-align: left; font-size: 11pt;">Nom et Pr\xe9nom</th>
            <th style="padding: 10px; border: 1px solid #ddd; text-align: center; font-size: 11pt;">Signature</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td style="padding: 10px; border: 1px solid #ddd; font-size: 11pt;">{eleve_prenom} {eleve_nom}</td>
            <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">________________</td>
          </tr>
        </tbody>
      </table>
    `,footerContent:rb}},re=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[140501]},ssr:!1}),rf=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[834606]},ssr:!1}),rg=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[273026]},ssr:!1}),rh=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[697899]},ssr:!1}),ri=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[300756]},ssr:!1}),rj=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[891564]},ssr:!1}),rk=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[377120]},ssr:!1});(0,mU.default)(async()=>{},{loadableGenerated:{modules:[836246]},ssr:!1});let rl=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[311993]},ssr:!1}),rm=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[109098]},ssr:!1}),rn=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[268655]},ssr:!1}),ro=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[944369]},ssr:!1});(0,mU.default)(async()=>{},{loadableGenerated:{modules:[911350]},ssr:!1}),(0,mU.default)(async()=>{},{loadableGenerated:{modules:[911350]},ssr:!1}),(0,mU.default)(async()=>{},{loadableGenerated:{modules:[911350]},ssr:!1});let rp=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[939754]},ssr:!1}),rq=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[473345]},ssr:!1}),rr=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[897169]},ssr:!1}),rs=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[810760]},ssr:!1}),rt=(0,mU.default)(async()=>{},{loadableGenerated:{modules:[487442]},ssr:!1});function ru({template:a,onTemplateChange:b,onEditorRefReady:c,isActive:d}){let{user:e}=(0,l.useAuth)(),h=(0,g.useRef)(null),i=(0,g.useRef)(!1),[j,k]=(0,g.useState)(()=>{let b=a.content?.html,c=a.content?.elements?.[0]?.content;return(0,mQ.convertTagsToVariableNodes)(b||c||"")});(0,g.useEffect)(()=>{if(!a.id||!a.type)return;let c=a.content?.html,d=a.content?.elements?.[0]?.content,e=c||d||"",f=e.trim();if(console.log("[BodyEditor] Template charg:",{templateId:a.id,templateType:a.type,hasHtml:!!c,hasElementsContent:!!d,currentContentLength:e.length,trimmedLength:f.length}),!f||f.length<50){console.log("[BodyEditor] Contenu vide ou trop court ("+f.length+" caractres), initialisation avec le contenu par dfaut...");try{let c=rd[a.type];if(console.log("[BodyEditor] Contenu par dfaut rcupr:",{hasBodyContent:!!c.bodyContent,bodyContentLength:c.bodyContent?.length||0}),c.bodyContent&&c.bodyContent.trim().length>50){let d=c.bodyContent;console.log("[BodyEditor] Mise  jour du template avec le contenu par dfaut ("+d.length+" caractres)");let e=(0,mQ.convertTagsToVariableNodes)(d);k(e),b({content:{...a.content,elements:[{id:"main-content",type:"text",position:{x:0,y:0},content:d}]},header:{...a.header,content:c.headerContent},footer:{...a.footer,content:c.footerContent}})}else console.warn("[BodyEditor] Le contenu par dfaut est galement vide ou trop court")}catch(a){console.error("[BodyEditor] Erreur lors de l'initialisation du contenu par dfaut:",a)}}else e===j||i.current||(console.log("[BodyEditor] Synchronisation du contenu depuis le template ("+f.length+" caractres)"),i.current=!0,k((0,mQ.convertTagsToVariableNodes)(e)),setTimeout(()=>{i.current=!1},100))},[a.id,a.type,a.content]);let[m,o]=(0,g.useState)(!1),[p,q]=(0,g.useState)(!1),[s,t]=(0,g.useState)(!1),[u,v]=(0,g.useState)(!1),[w,x]=(0,g.useState)(!1),[y,z]=(0,g.useState)(!1),[A,B]=(0,g.useState)(!1),[C,D]=(0,g.useState)(!1),[E,F]=(0,g.useState)(!1),[G,H]=(0,g.useState)(!1),[I,J]=(0,g.useState)(null),[K,L]=(0,g.useState)(!1),[M,N]=(0,g.useState)(!1),[O,P]=(0,g.useState)(!1),[Q,R]=(0,g.useState)(!1),[S,T]=(0,g.useState)(!1),[U,V]=(0,g.useState)(!1),[W,X]=(0,g.useState)(!1),[Y,Z]=(0,g.useState)(null),[$,_]=(0,g.useState)(1),[aa,ab]=(0,g.useState)(!0),[ac,ad]=(0,g.useState)(!1),[ae,af]=(0,g.useState)({enabled:!1,gridSize:10,snapToGrid:!1,showRulers:!1,showGuides:!1,guideColor:"#335ACF",gridColor:"#e5e7eb"}),[ag,ah]=(0,g.useState)(!1);ae.gridSize,ae.snapToGrid,(0,g.useEffect)(()=>{if(!a.id||!e?.id)return;if(!process.env.NEXT_PUBLIC_WS_URL)return void o(!1);let b=!0;return(async()=>{try{await q9.initializeCollaboration(a.id,e.id,e.full_name||e.email||"Utilisateur",e.email||"",e.avatar_url||void 0),b&&o(!0)}catch(a){if(b){o(!1);let b=a instanceof Error?a.message:String(a);b.includes("dsactive")||b.includes("aucun serveur")||console.warn("Collaboration non disponible:",b)}}})(),()=>{b=!1,a.id&&e?.id&&q9.disconnect(a.id,e.id)}},[a.id,e?.id,e?.email,e?.full_name,e?.avatar_url]);let ai=(0,g.useRef)(!1);(0,g.useEffect)(()=>{d&&!ai.current&&h.current&&c?(ai.current=!0,c({insertVariable:a=>{h.current?.insertVariable(a)}})):d||(ai.current=!1)},[d,c]);let aj=a=>{if(h.current)if(console.log("Insertion HTML:",a),h.current.insertHTML)h.current.insertHTML(a);else{let b=h.current.getEditor();if(b)try{b.chain().focus().insertContent(a).run()}catch(a){console.error("Erreur lors de l'insertion:",a)}}else console.error("editorRef.current est null")},ak=a.header?.content||"",al=a.footer?.content||"",am=a.content?.pageSize||a.page_size||"A4",an=a.margins||{top:20,right:20,bottom:20,left:20};return(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsx)(mT.GlassCard,{variant:"subtle",className:"p-4",children:(0,f.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,f.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[(0,f.jsx)(m5.Info,{className:"h-5 w-5 text-brand-blue mt-0.5 flex-shrink-0"}),(0,f.jsxs)("div",{className:"space-y-1",children:[(0,f.jsx)("p",{className:"text-sm font-medium text-text-primary",children:"Zone d'dition du corps du document"}),(0,f.jsx)("p",{className:"text-sm text-text-secondary",children:"L'en-tte et le pied de page sont affichs en gris pour rfrence. Ils seront automatiquement ajouts  chaque page lors de la gnration du document."})]})]}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[m&&a.id&&e?.id&&(0,f.jsx)(rt,{templateId:a.id,currentUserId:e.id}),(0,f.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>ab(!aa),className:"gap-2",children:aa?(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(m6.EyeOff,{className:"h-4 w-4"}),"Masquer l'aperu"]}):(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(r.Eye,{className:"h-4 w-4"}),"Afficher l'aperu"]})})]})]})}),(0,f.jsxs)("div",{className:"flex items-center justify-between gap-2 p-2 bg-gray-50 rounded-lg",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:()=>L(!0),title:"Insrer une zone de texte",children:[(0,f.jsx)(m7.FileText,{className:"h-4 w-4 mr-2"}),"Zone de texte"]}),(0,f.jsxs)(n.Button,{variant:ae.enabled?"default":"outline",size:"sm",onClick:()=>ad(!0),title:"Grille et rgles",children:[(0,f.jsx)(m8,{className:"h-4 w-4 mr-2"}),"Grille"]})]}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>_(a=>Math.max(a-.1,.5)),disabled:$<=.5,title:"Zoom arrire",children:(0,f.jsx)(mZ,{className:"h-4 w-4"})}),(0,f.jsxs)("span",{className:"text-sm text-gray-600 min-w-[60px] text-center",children:[Math.round(100*$),"%"]}),(0,f.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>_(a=>Math.min(a+.1,2)),disabled:$>=2,title:"Zoom avant",children:(0,f.jsx)(mY,{className:"h-4 w-4"})}),(0,f.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>_(1),title:"Rinitialiser le zoom",children:(0,f.jsx)(m$,{className:"h-4 w-4"})})]})]}),(0,f.jsx)(mT.GlassCard,{variant:"premium",className:"flex-1 flex flex-col overflow-hidden p-6",children:(0,f.jsx)("div",{className:"flex-1 flex flex-col min-h-[600px]",children:(0,f.jsx)("div",{onDragOver:a=>{a.preventDefault(),a.stopPropagation(),a.dataTransfer.dropEffect="copy"},onDrop:a=>{a.preventDefault(),a.stopPropagation();let b=a.dataTransfer.getData("text/plain")||a.dataTransfer.getData("text/html")?.replace(/[{}]/g,"");b&&h.current&&h.current.insertVariable(b)},className:"flex-1",style:{transform:`scale(${$})`,transformOrigin:"top left",width:`${100/$}%`,height:`${100/$}%`},children:(0,f.jsx)(mH,{ref:h,value:j,onChange:c=>{if(i.current)return;k(c);let d=(0,mQ.convertVariableNodesToTags)(c);b({content:{...a.content,elements:[{id:"main-content",type:"text",position:{x:0,y:0},content:d}]}})},placeholder:"Saisissez le contenu du document...",className:"flex-1",onTableEditorOpen:()=>q(!0),onShapeEditorOpen:()=>t(!0),onElementPaletteOpen:()=>v(!0),onSignatureFieldOpen:()=>P(!0),onQuickTemplatesOpen:()=>x(!0),onStylePaletteOpen:()=>z(!0),onWatermarkEditorOpen:()=>B(!0)})})})}),aa&&(0,f.jsx)("div",{className:"mt-4",children:(0,f.jsx)(m4,{htmlContent:j,headerContent:ak,footerContent:al,pageSize:am,margins:an,className:"h-full"})}),(0,f.jsxs)(na.AnimatePresence,{children:[p&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>q(!1),children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(re,{onInsert:aj,onClose:()=>q(!1)})})}),s&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>t(!1),children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(rf,{onInsert:aj,onClose:()=>t(!1)})})}),u&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>v(!1),children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(rg,{onInsert:aj,onClose:()=>v(!1),onChartEditorOpen:()=>{v(!1),D(!0)},onSignatureFieldOpen:()=>{v(!1),P(!0)},onFormFieldOpen:()=>{v(!1),V(!0)},onMediaLibraryOpen:()=>{v(!1),X(!0)}})})}),w&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>x(!1),children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(ri,{onInsert:aj,onClose:()=>x(!1)})})}),y&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>z(!1),children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(rj,{onApplyStyle:a=>{let b=[];a.fontSize&&b.push(`font-size: ${a.fontSize}`),a.fontWeight&&b.push(`font-weight: ${a.fontWeight}`),a.fontStyle&&b.push(`font-style: ${a.fontStyle}`),a.color&&b.push(`color: ${a.color}`),a.backgroundColor&&b.push(`background-color: ${a.backgroundColor}`),a.textAlign&&b.push(`text-align: ${a.textAlign}`),a.lineHeight&&b.push(`line-height: ${a.lineHeight}`),a.marginTop&&b.push(`margin-top: ${a.marginTop}`),a.marginBottom&&b.push(`margin-bottom: ${a.marginBottom}`),a.padding&&b.push(`padding: ${a.padding}`),a.borderLeft&&b.push(`border-left: ${a.borderLeft} solid ${a.borderColor||"#335ACF"}`);let c=b.join("; ");aj(`<p style="${c}">Texte stylis\xe9</p>`),z(!1)},onClose:()=>z(!1)})})}),A&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>B(!1),children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(rk,{onInsert:aj,onClose:()=>B(!1)})})}),E&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>F(!1),children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(rl,{onInsert:aj,onClose:()=>F(!1)})})}),G&&I&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>{H(!1),J(null)},children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(rm,{onSelect:a=>{I(a),H(!1),J(null)},onClose:()=>{H(!1),J(null)}})})}),K&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>L(!1),children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(rn,{onInsert:aj,onClose:()=>L(!1)})})}),M&&Y&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>{N(!1),Z(null)},children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(ro,{imageUrl:Y.url,onUpdate:a=>{aj(`
                    <p style="text-align: ${a.align||"center"}; margin: 16px 0;">
                      <img 
                        src="${Y.url}" 
                        alt="Image" 
                        style="
                          width: ${"%"===a.widthUnit?`${a.width}%`:"auto"===a.widthUnit?"auto":`${a.width}px`};
                          height: ${"%"===a.heightUnit?`${a.height}%`:"auto"===a.heightUnit?"auto":`${a.height}px`};
                          border-radius: ${a.borderRadius||0}px;
                          opacity: ${a.opacity||1};
                          transform: rotate(${a.rotation||0}deg);
                          display: block;
                          max-width: 100%;
                          height: auto;
                        "
                      />
                    </p>
                  `),N(!1),Z(null)},onClose:()=>{N(!1),Z(null)}})})}),O&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>P(!1),children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(rp,{onInsert:aj,onClose:()=>P(!1)})})}),Q&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>R(!1),children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(rq,{onInsert:aj,onClose:()=>R(!1)})})}),S&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>T(!1),children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(rr,{onInsert:aj,onClose:()=>T(!1)})})}),U&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>V(!1),children:(0,f.jsx)(m9.motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:a=>a.stopPropagation(),children:(0,f.jsx)(rs,{onInsert:a=>{aj(a),V(!1)},onClose:()=>V(!1)})})}),W&&(0,f.jsx)(rh,{onInsert:(a,b)=>{aj(`<p style="text-align: center; margin: 16px 0;">
                <img 
                  src="${a}" 
                  alt="${b||"Image"}" 
                  style="max-width: 100%; height: auto; border-radius: 8px; display: block; margin: 0 auto;"
                />
              </p>`),X(!1)},category:"image",showUpload:!0})]})]})}var rv=a.i(154347);let rw=[{id:"logo_left_info_right",name:"Logo Gauche / Infos Droite",description:"Logo  gauche, informations de contact  droite",preview:"Logo | Nom cole\n       | Contact"},{id:"logo_centered",name:"Logo Centr",description:"Logo et nom centrs verticalement",preview:"       Logo\n   Nom cole"},{id:"banner_gradient",name:"Bannire Gradient",description:"Header avec fond dgrad et logo",preview:"Logo | Nom cole\n     | Contact (fond bleu)"},{id:"minimal",name:"Minimal",description:"Header simple et pur",preview:"Logo | Nom cole"},{id:"professional",name:"Professionnel",description:"Header avec bordure et slogan",preview:"Logo | Nom cole\n     | Slogan (avec bordure)"}],rx=[{id:"simple",name:"Simple",description:"Pagination centre avec nom de l'cole",preview:"Nom cole | Page X / Y"},{id:"complete",name:"Complet",description:"Contact, pagination et site web",preview:"Contact | Page X / Y | Site Web\nDate gnration"},{id:"minimal",name:"Minimal",description:"Uniquement la pagination",preview:"Page X / Y"},{id:"professional",name:"Professionnel",description:"Avec bordure et mentions lgales",preview:"Confidentiel | Page X / Y | Contact\n       Mentions lgales"},{id:"modern",name:"Moderne",description:"QR Code, contact et pagination",preview:"[QR] | Contact | Page X / Y | Site Web"}];function ry({type:a,value:b,onChange:c}){return(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[("header"===a?rw:rx).map(a=>{let d=b===a.id;return(0,f.jsx)(E.Card,{className:(0,H.cn)("cursor-pointer transition-all hover:border-brand-blue hover:shadow-md",d&&"border-brand-blue border-2 shadow-md"),onClick:()=>c(a.id),children:(0,f.jsx)(E.CardContent,{className:"p-4",children:(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsx)("h4",{className:"text-sm font-semibold text-text-primary",children:a.name}),d&&(0,f.jsx)("div",{className:"h-2 w-2 rounded-full bg-brand-blue"})]}),(0,f.jsx)("p",{className:"text-xs text-text-tertiary",children:a.description}),(0,f.jsx)("div",{className:"mt-3 p-2 bg-gray-50 rounded text-xs font-mono text-gray-600 whitespace-pre-line border border-gray-200",children:a.preview})]})})},a.id)}),(0,f.jsx)(E.Card,{className:(0,H.cn)("cursor-pointer transition-all hover:border-brand-blue hover:shadow-md","custom"===b&&"border-brand-blue border-2 shadow-md"),onClick:()=>c("custom"),children:(0,f.jsx)(E.CardContent,{className:"p-4",children:(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsx)("h4",{className:"text-sm font-semibold text-text-primary",children:"Personnalis"}),"custom"===b&&(0,f.jsx)("div",{className:"h-2 w-2 rounded-full bg-brand-blue"})]}),(0,f.jsx)("p",{className:"text-xs text-text-tertiary",children:"Crez votre propre layout"}),(0,f.jsx)("div",{className:"mt-3 p-2 bg-gray-50 rounded text-xs font-mono text-gray-400 whitespace-pre-line border border-gray-200 flex items-center justify-center h-12",children:(0,f.jsx)(rv.Palette,{className:"h-4 w-4 opacity-50"})})]})})})]})}function rz({template:a,onTemplateChange:b,onEditorRefReady:c,isActive:d}){let e=(0,g.useRef)(null),h=(0,g.useRef)(!1),[i,j]=(0,g.useState)(()=>{let b=a.footer?.content;return(0,mQ.convertTagsToVariableNodes)(b||"")}),k=(0,g.useRef)(!1);(0,g.useEffect)(()=>{d&&!k.current&&e.current&&c?(k.current=!0,c({insertVariable:a=>{e.current?.insertVariable(a)}})):d||(k.current=!1)},[d,c]);let l=a.footer||{enabled:!0,height:60,layout:"complete",elements:[],repeatOnAllPages:!0,pagination:{enabled:!0,format:"Page {numero_page} / {total_pages}",position:"center"},content:""},m=c=>{let{pagination:d,...e}=c;b({footer:{...l,...e,...d&&l.pagination?{pagination:{...l.pagination,...d}}:d?{pagination:{enabled:!1,format:"Page {numero_page} / {total_pages}",position:"center",...d}}:{}},footer_enabled:void 0!==c.enabled?c.enabled:a.footer_enabled,footer_height:void 0!==c.height?c.height:a.footer_height})};return(0,g.useEffect)(()=>{if(h.current)return;let b=a.footer?.content||"",c=(0,mQ.convertTagsToVariableNodes)(b);c!==i&&(h.current=!0,j(c),setTimeout(()=>{h.current=!1},100))},[a.footer]),(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)(E.Card,{children:[(0,f.jsxs)(E.CardHeader,{children:[(0,f.jsx)(E.CardTitle,{children:"Configuration du pied de page"}),(0,f.jsx)(E.CardDescription,{children:"Personnalisez l'apparence et le contenu du pied de page"})]}),(0,f.jsxs)(E.CardContent,{className:"space-y-6",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)(F.Label,{children:"Afficher le pied de page"}),(0,f.jsx)("p",{className:"text-sm text-text-tertiary",children:"Afficher le pied de page sur toutes les pages"})]}),(0,f.jsx)(G.Switch,{checked:a.footer_enabled,onCheckedChange:a=>{b({footer_enabled:a})}})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsxs)(F.Label,{children:["Hauteur : ",l.height,"px"]}),(0,f.jsx)(I,{value:[l.height],onValueChange:([a])=>m({height:a}),min:30,max:150,step:5,className:"w-full",disabled:!a.footer_enabled}),(0,f.jsxs)("div",{className:"flex justify-between text-xs text-text-tertiary",children:[(0,f.jsx)("span",{children:"Min: 30px"}),(0,f.jsx)("span",{children:"Max: 150px"})]})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{children:"Layout prdfini"}),(0,f.jsx)(ry,{type:"footer",value:l.layout||"complete",onChange:a=>{let b=function(a,b={}){let c=[];switch(a){case"simple":return c.push({id:"school_name_center",type:"text",position:{x:0,y:20},content:"{ecole_nom}",style:{fontSize:9,color:"#4D4D4D",textAlign:"center"}},{id:"pagination_right",type:"text",position:{x:450,y:20},content:"Page {numero_page} / {total_pages}",style:{fontSize:8,color:"#666666",textAlign:"right"}}),{height:50,backgroundColor:"#F9FAFB",pagination:{enabled:!0,format:"Page {numero_page} / {total_pages}",position:"right"},elements:c,layout:"simple"};case"complete":return c.push({id:"contact_left",type:"text",position:{x:20,y:15},content:"{ecole_telephone} | {ecole_email}",style:{fontSize:8,color:"#4D4D4D",textAlign:"left"}},{id:"pagination_center",type:"text",position:{x:0,y:15},content:"Page {numero_page} / {total_pages}",style:{fontSize:9,color:"#4D4D4D",textAlign:"center"}},{id:"website_right",type:"text",position:{x:450,y:15},content:"{ecole_site_web}",style:{fontSize:8,color:"#34B9EE",textAlign:"right",textDecoration:"underline"}},{id:"generation_date",type:"text",position:{x:20,y:30},content:"Document gnr le {date_generation}",style:{fontSize:7,color:"#999999",fontStyle:"italic"}}),{height:60,backgroundColor:"#F9FAFB",border:{top:{enabled:!0,color:"#E5E7EB",width:1,style:"solid"}},pagination:{enabled:!0,format:"Page {numero_page} / {total_pages}",position:"center"},elements:c,layout:"complete"};case"minimal":return{height:40,backgroundColor:"#FFFFFF",pagination:{enabled:!0,format:"Page {numero_page} / {total_pages}",position:"center"},elements:[],layout:"minimal"};case"professional":return c.push({id:"separator",type:"line",position:{x:0,y:0},style:{color:"#E5E7EB",border:{enabled:!0,color:"#E5E7EB",width:1}}},{id:"legal",type:"text",position:{x:20,y:10},content:"Document confidentiel - Tous droits rservs",style:{fontSize:7,color:"#999999",textAlign:"left"}},{id:"contact",type:"text",position:{x:20,y:25},content:"{ecole_telephone} | {ecole_email}",style:{fontSize:8,color:"#4D4D4D",textAlign:"left"}},{id:"pagination",type:"text",position:{x:0,y:20},content:"Page {numero_page} / {total_pages}",style:{fontSize:8,color:"#4D4D4D",textAlign:"center"}}),{height:50,backgroundColor:"#FFFFFF",border:{top:{enabled:!0,color:"#E5E7EB",width:1,style:"solid"}},pagination:{enabled:!0,format:"Page {numero_page} / {total_pages}",position:"center"},elements:c,layout:"professional"};case"modern":return c.push({id:"qrcode",type:"qrcode",position:{x:20,y:10},size:{width:30,height:30},qrData:"{ecole_site_web}"},{id:"contact",type:"text",position:{x:60,y:15},content:"{ecole_telephone} | {ecole_email}",style:{fontSize:8,color:"#4D4D4D"}},{id:"pagination",type:"text",position:{x:0,y:15},content:"Page {numero_page} / {total_pages}",style:{fontSize:8,color:"#4D4D4D",textAlign:"center"}},{id:"website",type:"text",position:{x:420,y:15},content:"{ecole_site_web}",style:{fontSize:8,color:"#34B9EE",textAlign:"right"}}),{height:50,backgroundColor:"#F9FAFB",border:{top:{enabled:!0,color:"#E5E7EB",width:1,style:"dashed"}},pagination:{enabled:!0,format:"Page {numero_page} / {total_pages}",position:"center"},elements:c,layout:"modern"};default:return{height:60,backgroundColor:"#F9FAFB",pagination:{enabled:!0,format:"Page {numero_page} / {total_pages}",position:"center"},elements:[],layout:"custom"}}}(a);m({layout:a,...b})}})]}),l.pagination&&(0,f.jsxs)("div",{className:"space-y-4 border-t border-bg-gray-200 pt-4",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)(F.Label,{children:"Afficher la numrotation"}),(0,f.jsx)("p",{className:"text-sm text-text-tertiary",children:"Numrotation automatique des pages"})]}),(0,f.jsx)(G.Switch,{checked:l.pagination.enabled,onCheckedChange:a=>{m({pagination:l.pagination?{...l.pagination,enabled:a}:{enabled:a,format:"Page {numero_page} / {total_pages}",position:"center"}})}})]}),l.pagination.enabled&&(0,f.jsxs)("div",{className:"space-y-2 pl-4",children:[(0,f.jsx)(F.Label,{children:"Format"}),(0,f.jsxs)("select",{value:l.pagination.format,onChange:a=>{m({pagination:{...l.pagination,format:a.target.value}})},className:"w-full border border-bg-gray-200 rounded px-3 py-2 text-sm",children:[(0,f.jsx)("option",{value:"Page {numero_page}",children:"Page X"}),(0,f.jsx)("option",{value:"{numero_page} / {total_pages}",children:"X / Y"}),(0,f.jsx)("option",{value:"Page {numero_page} / {total_pages}",children:"Page X / Y"}),(0,f.jsx)("option",{value:"Page {numero_page} sur {total_pages}",children:"Page X sur Y"})]}),(0,f.jsx)(F.Label,{children:"Position"}),(0,f.jsxs)("select",{value:l.pagination.position,onChange:a=>{m({pagination:{...l.pagination,position:a.target.value}})},className:"w-full border border-bg-gray-200 rounded px-3 py-2 text-sm",children:[(0,f.jsx)("option",{value:"left",children:"Gauche"}),(0,f.jsx)("option",{value:"center",children:"Centre"}),(0,f.jsx)("option",{value:"right",children:"Droite"})]})]})]})]})]}),(0,f.jsxs)(E.Card,{className:"flex-1 flex flex-col overflow-hidden",children:[(0,f.jsxs)(E.CardHeader,{children:[(0,f.jsx)(E.CardTitle,{children:"Contenu du pied de page"}),(0,f.jsx)(E.CardDescription,{children:"ditez le contenu du pied de page. Utilisez la barre latrale pour insrer des variables, tableaux et cadres."})]}),(0,f.jsxs)(E.CardContent,{className:"flex-1 flex flex-col min-h-[300px]",children:[(0,f.jsx)(mP,{editorRef:e}),(0,f.jsx)("div",{onDragOver:a=>{a.preventDefault(),a.stopPropagation(),a.dataTransfer.dropEffect="copy"},onDrop:a=>{a.preventDefault(),a.stopPropagation();let b=a.dataTransfer.getData("text/plain")||a.dataTransfer.getData("text/html")?.replace(/[{}]/g,"");b&&e.current&&e.current.insertVariable(b)},className:"flex-1",children:(0,f.jsx)(mH,{ref:e,value:i,onChange:a=>{h.current||(j(a),m({content:(0,mQ.convertVariableNodesToTags)(a)}))},placeholder:"Saisissez le contenu du pied de page...",className:"flex-1"})})]})]})]})}function rA({template:a,onTemplateChange:b,onEditorRefReady:c,isActive:d}){return(0,f.jsx)(rz,{template:a,onTemplateChange:b,onEditorRefReady:c,isActive:d})}var rB=a.i(941675),rC=a.i(546842),rD=a.i(290821);let rE=(0,x.default)("GitCompare",[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]]);var rF=a.i(603420),rG=a.i(433363);function rH({templateId:a,version1Id:b,version2Id:c,onClose:d}){let[e,h]=(0,g.useState)(null),[j,k]=(0,g.useState)(null),{data:l}=(0,i.useQuery)({queryKey:["template-version",a,b],queryFn:async()=>{let c=await m.documentTemplateService.getTemplateVersionById(a,b);return c&&c.template_data?c.template_data:null},enabled:!!b}),{data:o}=(0,i.useQuery)({queryKey:["template-version",a,c],queryFn:async()=>{let b=await m.documentTemplateService.getTemplateVersionById(a,c);return b&&b.template_data?b.template_data:null},enabled:!!c});(0,g.useEffect)(()=>{l&&h(l),o&&k(o)},[l,o]);let p=a=>{if(!a)return"";let b=a.header?.elements?.map(a=>a.content||"").filter(Boolean).join(" ")||"",c=a.content?.elements?.map(a=>a.content||"").filter(Boolean).join(" ")||"",d=a.footer?.elements?.map(a=>a.content||"").filter(Boolean).join(" ")||"";return`${a.name} ${b} ${c} ${d}`.replace(/\s+/g," ").trim()},q=p(e),r=p(j);return(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,f.jsxs)(E.Card,{className:"w-full max-w-6xl max-h-[90vh] overflow-y-auto",children:[(0,f.jsxs)(E.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[(0,f.jsx)(E.CardTitle,{children:"Comparaison des versions"}),(0,f.jsx)(n.Button,{variant:"ghost",size:"icon",onClick:d,children:(0,f.jsx)(lw.X,{className:"h-4 w-4"})})]}),(0,f.jsx)(E.CardContent,{children:(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("h3",{className:"font-semibold mb-2",children:"Version 1"}),(0,f.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg border max-h-96 overflow-y-auto",children:(0,f.jsx)("pre",{className:"text-xs whitespace-pre-wrap font-mono",children:q||"Aucun contenu"})})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("h3",{className:"font-semibold mb-2",children:"Version 2"}),(0,f.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg border max-h-96 overflow-y-auto",children:(0,f.jsx)("pre",{className:"text-xs whitespace-pre-wrap font-mono",children:r||"Aucun contenu"})})]})]})})]})})}function rI({templateId:a,onVersionRestore:b}){let[c,d]=(0,g.useState)(null),[e,h]=(0,g.useState)(!1),[l,o]=(0,g.useState)(!1),[p,q]=(0,g.useState)(null),[u,v]=(0,g.useState)(null),w=(0,k.useQueryClient)(),{data:x,isLoading:y}=(0,i.useQuery)({queryKey:["template-versions",a],queryFn:()=>m.documentTemplateService.getTemplateVersions(a),enabled:!!a}),z=(0,j.useMutation)({mutationFn:b=>m.documentTemplateService.restoreTemplateVersion(a,b),onSuccess:()=>{w.invalidateQueries({queryKey:["document-template",a]}),w.invalidateQueries({queryKey:["template-versions",a]}),b?.(),d(null)}});return y?(0,f.jsx)(mT.GlassCard,{variant:"premium",className:"p-6",children:(0,f.jsxs)("div",{className:"flex items-center gap-2 text-text-secondary",children:[(0,f.jsx)(t.History,{className:"h-5 w-5 animate-pulse"}),(0,f.jsx)("span",{children:"Chargement de l'historique..."})]})}):x&&0!==x.length?(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)(mT.GlassCard,{variant:"premium",className:"p-6",children:[(0,f.jsx)("div",{className:"flex items-center justify-between mb-4",children:(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(t.History,{className:"h-5 w-5 text-brand-blue"}),(0,f.jsx)("h3",{className:"font-semibold text-text-primary",children:"Historique des versions"}),(0,f.jsxs)("span",{className:"text-sm text-text-tertiary",children:["(",x.length," version",x.length>1?"s":"",")"]})]})}),(0,f.jsx)("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:(0,f.jsx)(na.AnimatePresence,{children:x.map((a,b)=>(0,f.jsx)(m9.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{delay:.05*b},className:(0,H.cn)("p-4 rounded-lg border transition-all cursor-pointer",c?.id===a.id?"border-brand-blue bg-brand-blue-ghost":"border-gray-200 hover:border-brand-blue hover:bg-gray-50"),onClick:()=>d(a),children:(0,f.jsxs)("div",{className:"flex items-start justify-between",children:[(0,f.jsxs)("div",{className:"flex-1",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,f.jsxs)("span",{className:"font-semibold text-text-primary",children:["Version ",a.version_number]}),0===b&&(0,f.jsx)("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded",children:"Dernire"})]}),a.name&&(0,f.jsx)("p",{className:"text-sm text-text-secondary mb-1",children:a.name}),a.description&&(0,f.jsx)("p",{className:"text-xs text-text-tertiary mb-2",children:a.description}),(0,f.jsxs)("div",{className:"flex items-center gap-4 text-xs text-text-tertiary",children:[(0,f.jsxs)("div",{className:"flex items-center gap-1",children:[(0,f.jsx)(rB.Calendar,{className:"h-3 w-3"}),(0,f.jsx)("span",{children:(0,rF.formatDistanceToNow)(new Date(a.created_at),{addSuffix:!0,locale:rG.fr})})]}),a.created_by&&(0,f.jsxs)("div",{className:"flex items-center gap-1",children:[(0,f.jsx)(rC.User,{className:"h-3 w-3"}),(0,f.jsx)("span",{children:"Par utilisateur"})]})]})]}),(0,f.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,f.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:b=>{b.stopPropagation(),h(!0),d(a)},children:[(0,f.jsx)(r.Eye,{className:"h-4 w-4 mr-1"}),"Aperu"]}),b>0&&x&&(0,f.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:a=>{a.stopPropagation(),q(x[b].id),v(x[0].id),o(!0)},children:[(0,f.jsx)(rE,{className:"h-4 w-4 mr-1"}),"Comparer"]}),b>0&&(0,f.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:b=>{var c;b.stopPropagation(),c=a.version_number,confirm(`\xcates-vous s\xfbr de vouloir restaurer la version ${c} ? Cette action remplacera la version actuelle.`)&&z.mutate(c)},disabled:z.isPending,className:"text-orange-600 hover:text-orange-700 hover:border-orange-300",children:[(0,f.jsx)(s.RotateCcw,{className:"h-4 w-4 mr-1"}),"Restaurer"]})]})]})},a.id))})})]}),z.isPending&&(0,f.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,f.jsxs)(mT.GlassCard,{variant:"premium",className:"p-6 max-w-md",children:[(0,f.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,f.jsx)(s.RotateCcw,{className:"h-6 w-6 text-brand-blue animate-spin"}),(0,f.jsx)("h3",{className:"font-semibold text-text-primary",children:"Restauration en cours..."})]}),(0,f.jsx)("p",{className:"text-text-secondary",children:"Veuillez patienter pendant la restauration de la version."})]})}),z.isSuccess&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"fixed top-4 right-4 z-50",children:(0,f.jsx)(mT.GlassCard,{variant:"premium",className:"p-4 border-green-200 bg-green-50",children:(0,f.jsxs)("div",{className:"flex items-center gap-2 text-green-700",children:[(0,f.jsx)(B.CheckCircle2,{className:"h-5 w-5"}),(0,f.jsx)("span",{className:"font-medium",children:"Version restaure avec succs"})]})})}),z.isError&&(0,f.jsx)(m9.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"fixed top-4 right-4 z-50",children:(0,f.jsx)(mT.GlassCard,{variant:"premium",className:"p-4 border-red-200 bg-red-50",children:(0,f.jsxs)("div",{className:"flex items-center gap-2 text-red-700",children:[(0,f.jsx)(rD.AlertCircle,{className:"h-5 w-5"}),(0,f.jsxs)("span",{className:"font-medium",children:["Erreur lors de la restauration : ",z.error?.message||"Erreur inconnue"]})]})})}),l&&p&&u&&(0,f.jsx)(rH,{templateId:a,version1Id:p,version2Id:u,onClose:()=>{o(!1),q(null),v(null)}})]}):(0,f.jsx)(mT.GlassCard,{variant:"premium",className:"p-6",children:(0,f.jsxs)("div",{className:"text-center py-8",children:[(0,f.jsx)(t.History,{className:"h-12 w-12 mx-auto mb-4 text-text-tertiary opacity-50"}),(0,f.jsx)("p",{className:"text-text-secondary",children:"Aucune version prcdente"}),(0,f.jsx)("p",{className:"text-sm text-text-tertiary mt-2",children:"Les versions seront cres automatiquement lors des modifications"})]})})}var rJ=a.i(458198);function rK({onClose:a}){return(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,f.jsxs)(E.Card,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,f.jsxs)(E.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[(0,f.jsx)(E.CardTitle,{children:"Raccourcis clavier"}),(0,f.jsx)(n.Button,{variant:"ghost",size:"icon",onClick:a,children:(0,f.jsx)(lw.X,{className:"h-4 w-4"})})]}),(0,f.jsx)(E.CardContent,{children:(0,f.jsx)("div",{className:"space-y-4",children:[{keys:["Ctrl","S"],description:"Sauvegarder le template"},{keys:["Ctrl","P"],description:"Aperu du document"},{keys:["Ctrl","Z"],description:"Annuler"},{keys:["Ctrl","Y"],description:"Refaire"},{keys:["Ctrl","B"],description:"Gras"},{keys:["Ctrl","I"],description:"Italique"},{keys:["Ctrl","U"],description:"Soulign"}].map((a,b)=>(0,f.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,f.jsx)("span",{className:"text-sm text-muted-foreground",children:a.description}),(0,f.jsx)("div",{className:"flex gap-1",children:a.keys.map((a,b)=>(0,f.jsx)("kbd",{className:"px-2 py-1 text-xs font-semibold text-gray-800 bg-gray-100 border border-gray-200 rounded-lg",children:a},b))})]},b))})})]})})}function rL({template:a,onClose:b}){return(0,f.jsxs)(E.Card,{className:"w-full max-w-2xl",children:[(0,f.jsxs)(E.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[(0,f.jsx)(E.CardTitle,{children:"Gnration programme"}),(0,f.jsx)(n.Button,{variant:"ghost",size:"icon",onClick:b,className:"h-6 w-6",children:(0,f.jsx)(lw.X,{className:"h-4 w-4"})})]}),(0,f.jsxs)(E.CardContent,{children:[(0,f.jsx)("p",{className:"text-sm text-gray-500",children:"La fonctionnalit de gnration programme sera bientt disponible."}),(0,f.jsx)("div",{className:"mt-4 flex justify-end",children:(0,f.jsx)(n.Button,{onClick:b,children:"Fermer"})})]})]})}function rM({template:a,onClose:b}){return(0,f.jsxs)(E.Card,{className:"w-full max-w-2xl",children:[(0,f.jsxs)(E.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[(0,f.jsx)(E.CardTitle,{children:"Collaboration"}),(0,f.jsx)(n.Button,{variant:"ghost",size:"icon",onClick:b,className:"h-6 w-6",children:(0,f.jsx)(lw.X,{className:"h-4 w-4"})})]}),(0,f.jsxs)(E.CardContent,{children:[(0,f.jsx)("p",{className:"text-sm text-gray-500",children:"La fonctionnalit de collaboration sera bientt disponible."}),(0,f.jsx)("div",{className:"mt-4 flex justify-end",children:(0,f.jsx)(n.Button,{onClick:b,children:"Fermer"})})]})]})}var rN=a.i(254161),rO=a.i(621958),rP=a.i(495756),rQ=a.i(54018),rR=a.i(325015),rS=a.i(915618);let rT=new class{supabase;constructor(a){this.supabase=a||(0,nb.createClient)()}async createWorkflow(a,b){let{data:c,error:d}=await this.supabase.from("template_workflows").insert({organization_id:a.organization_id,name:a.name,description:a.description,is_default:a.is_default||!1,created_by:b}).select().single();if(d)throw d;if(a.steps.length>0){let b=a.steps.map(a=>({workflow_id:c.id,step_order:a.step_order,name:a.name,description:a.description,approver_role:a.approver_role||null,approver_user_id:a.approver_user_id||null,is_required:a.is_required??!0,can_reject:a.can_reject??!0,can_comment:a.can_comment??!0,timeout_days:a.timeout_days||null})),{error:d}=await this.supabase.from("template_workflow_steps").insert(b);if(d)throw d}return c}async getWorkflows(a){let{data:b,error:c}=await this.supabase.from("template_workflows").select("*").eq("organization_id",a).order("created_at",{ascending:!1});if(c)throw c;return b||[]}async getWorkflowWithSteps(a){let{data:b,error:c}=await this.supabase.from("template_workflows").select("*").eq("id",a).single();if(c)throw c;let{data:d,error:e}=await this.supabase.from("template_workflow_steps").select("*").eq("workflow_id",a).order("step_order",{ascending:!0});if(e)throw e;return{...b,steps:d||[]}}async updateWorkflow(a,b){let{data:c,error:d}=await this.supabase.from("template_workflows").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteWorkflow(a){let{error:b}=await this.supabase.from("template_workflows").delete().eq("id",a);if(b)throw b}async addWorkflowStep(a,b){let{data:c,error:d}=await this.supabase.from("template_workflow_steps").insert({workflow_id:a,...b}).select().single();if(d)throw d;return c}async updateWorkflowStep(a,b){let{data:c,error:d}=await this.supabase.from("template_workflow_steps").update(b).eq("id",a).select().single();if(d)throw d;return c}async deleteWorkflowStep(a){let{error:b}=await this.supabase.from("template_workflow_steps").delete().eq("id",a);if(b)throw b}async startWorkflow(a,b,c){let{data:d}=await this.supabase.from("template_workflow_steps").select("id").eq("workflow_id",b).order("step_order",{ascending:!0}).limit(1).single(),{data:e,error:f}=await this.supabase.from("template_workflow_instances").insert({template_id:a,workflow_id:b,started_by:c,status:"in_progress",current_step_id:d?.id||null}).select().single();if(f)throw f;return d&&await this.createApprovalsForStep(e.id,d.id),e}async createApprovalsForStep(a,b){let{data:c}=await this.supabase.from("template_workflow_steps").select("*").eq("id",b).single();if(c){if(c.approver_user_id){let d=c.timeout_days?new Date(Date.now()+24*c.timeout_days*36e5).toISOString():null;await this.supabase.from("template_workflow_approvals").insert({instance_id:a,step_id:b,approver_id:c.approver_user_id,status:"pending",deadline:d})}else if(c.approver_role){let{data:d}=await this.supabase.from("users").select("id").eq("role",c.approver_role);if(d){let e=c.timeout_days?new Date(Date.now()+24*c.timeout_days*36e5).toISOString():null,f=d.map(c=>({instance_id:a,step_id:b,approver_id:c.id,status:"pending",deadline:e}));await this.supabase.from("template_workflow_approvals").insert(f)}}}}async getTemplateInstances(a){let{data:b,error:c}=await this.supabase.from("template_workflow_instances").select("*, workflow:template_workflows(*)").eq("template_id",a).order("created_at",{ascending:!1});if(c)throw c;return b||[]}async getInstanceWithDetails(a){let{data:b,error:c}=await this.supabase.from("template_workflow_instances").select("*, workflow:template_workflows(*)").eq("id",a).single();if(c)throw c;let d=null;if(b.current_step_id){let{data:a}=await this.supabase.from("template_workflow_steps").select("*").eq("id",b.current_step_id).single();d=a||null}let{data:e}=await this.supabase.from("template_workflow_approvals").select("*, step:template_workflow_steps(*), approver:users!template_workflow_approvals_approver_id_fkey(id, email, full_name)").eq("instance_id",a).order("created_at",{ascending:!0});return{...b,workflow:b.workflow,current_step:d,approvals:e||[]}}async approveStep(a,b,c,d){let{data:e,error:f}=await this.supabase.from("template_workflow_approvals").update({status:b,comment:c,approved_at:"approved"===b?new Date().toISOString():null}).eq("id",a).select().single();if(f)throw f;if("rejected"===b)await this.supabase.from("template_workflow_instances").update({status:"rejected",completed_at:new Date().toISOString()}).eq("id",e.instance_id);else{let{data:a}=await this.supabase.from("template_workflow_approvals").select("*, step:template_workflow_steps(*)").eq("instance_id",e.instance_id).eq("step_id",e.step_id),{data:b}=await this.supabase.from("template_workflow_steps").select("*").eq("id",e.step_id).single();if(!b)throw Error("tape non trouve");let c=a?.filter(a=>{let b=a.step;return b?.is_required!==!1})||[];if(c.length>0&&c.every(a=>"approved"===a.status)){let{data:a}=await this.supabase.from("template_workflow_instances").select("workflow_id, current_step_id").eq("id",e.instance_id).single();if(!a)throw Error("Instance non trouve");let{data:c}=await this.supabase.from("template_workflow_steps").select("*").eq("workflow_id",a.workflow_id).gt("step_order",b.step_order).order("step_order",{ascending:!0}).limit(1).single();c?(await this.supabase.from("template_workflow_instances").update({current_step_id:c.id,status:"in_progress"}).eq("id",e.instance_id),await this.createApprovalsForStep(e.instance_id,c.id)):await this.supabase.from("template_workflow_instances").update({status:"approved",completed_at:new Date().toISOString(),current_step_id:null}).eq("id",e.instance_id)}}return e}async getPendingApprovals(a){let{data:b,error:c}=await this.supabase.from("template_workflow_approvals").select("*, instance:template_workflow_instances(*, template:document_templates(*)), step:template_workflow_steps(*)").eq("approver_id",a).eq("status","pending").order("created_at",{ascending:!0});if(c)throw c;return b||[]}};function rU({template:a,onClose:b}){let{user:c}=(0,l.useAuth)(),{addToast:d}=(0,D.useToast)(),e=(0,k.useQueryClient)(),[h,m]=(0,g.useState)("workflows"),[o,p]=(0,g.useState)(!1),[q,r]=(0,g.useState)(""),[s,t]=(0,g.useState)(""),[u,v]=(0,g.useState)([]),{data:w}=(0,i.useQuery)({queryKey:["workflows",c?.organization_id],queryFn:()=>rT.getWorkflows(c?.organization_id||""),enabled:!!c?.organization_id}),{data:x}=(0,i.useQuery)({queryKey:["workflow-instances",a.id],queryFn:()=>rT.getTemplateInstances(a.id||""),enabled:!!a.id}),{data:y}=(0,i.useQuery)({queryKey:["pending-approvals",c?.id],queryFn:()=>rT.getPendingApprovals(c?.id||""),enabled:!!c?.id}),z=(0,j.useMutation)({mutationFn:async()=>{if(!c?.organization_id||!c?.id)throw Error("Utilisateur non authentifi");return rT.createWorkflow({organization_id:c.organization_id,name:q,description:s,steps:u},c.id)},onSuccess:()=>{d({title:"Workflow cr",description:"Le workflow de validation a t cr avec succs.",type:"success"}),e.invalidateQueries({queryKey:["workflows"]}),p(!1),r(""),t(""),v([])},onError:a=>{d({title:"Erreur",description:a.message||"Impossible de crer le workflow.",type:"error"})}}),A=(0,j.useMutation)({mutationFn:async b=>{if(!c?.id||!a.id)throw Error("Donnes manquantes");return rT.startWorkflow(a.id,b,c.id)},onSuccess:()=>{d({title:"Workflow dmarr",description:"Le processus de validation a t dmarr.",type:"success"}),e.invalidateQueries({queryKey:["workflow-instances"]})},onError:a=>{d({title:"Erreur",description:a.message||"Impossible de dmarrer le workflow.",type:"error"})}}),B=(0,j.useMutation)({mutationFn:async({approvalId:a,status:b,comment:d})=>rT.approveStep(a,b,d,c?.id),onSuccess:()=>{d({title:"Dcision enregistre",description:"Votre dcision a t enregistre.",type:"success"}),e.invalidateQueries({queryKey:["workflow-instances"]}),e.invalidateQueries({queryKey:["pending-approvals"]})},onError:a=>{d({title:"Erreur",description:a.message||"Impossible d'enregistrer la dcision.",type:"error"})}}),C=(a,b)=>{let c=[...u];c[a]={...c[a],...b},v(c)},G=a=>{switch(a){case"approved":return(0,f.jsx)(rN.Badge,{className:"bg-green-100 text-green-800",children:"Approuv"});case"rejected":return(0,f.jsx)(rN.Badge,{className:"bg-red-100 text-red-800",children:"Rejet"});case"in_progress":return(0,f.jsx)(rN.Badge,{className:"bg-blue-100 text-blue-800",children:"En cours"});case"pending":return(0,f.jsx)(rN.Badge,{className:"bg-yellow-100 text-yellow-800",children:"En attente"});default:return(0,f.jsx)(rN.Badge,{children:a})}};return(0,f.jsxs)(E.Card,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,f.jsx)(E.CardHeader,{children:(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)(E.CardTitle,{children:"Workflow de validation"}),(0,f.jsx)(E.CardDescription,{children:"Configurez et grez les processus d'approbation multi-niveaux pour vos templates"})]}),b&&(0,f.jsx)(n.Button,{variant:"ghost",size:"icon",onClick:b,children:(0,f.jsx)(lw.X,{className:"h-4 w-4"})})]})}),(0,f.jsx)(E.CardContent,{children:(0,f.jsxs)(rO.Tabs,{value:h,onValueChange:m,children:[(0,f.jsxs)(rO.TabsList,{className:"grid w-full grid-cols-3",children:[(0,f.jsx)(rO.TabsTrigger,{value:"workflows",children:"Workflows"}),(0,f.jsx)(rO.TabsTrigger,{value:"instances",children:"Instances"}),(0,f.jsx)(rO.TabsTrigger,{value:"approvals",children:"Mes approbations"})]}),(0,f.jsxs)(rO.TabsContent,{value:"workflows",className:"space-y-4",children:[(0,f.jsxs)("div",{className:"flex justify-between items-center",children:[(0,f.jsx)("h3",{className:"text-lg font-semibold",children:"Workflows disponibles"}),(0,f.jsxs)(n.Button,{onClick:()=>p(!0),children:[(0,f.jsx)(rS.Plus,{className:"h-4 w-4 mr-2"}),"Crer un workflow"]})]}),o&&(0,f.jsxs)(E.Card,{className:"p-4 space-y-4",children:[(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{children:"Nom du workflow *"}),(0,f.jsx)(mM.Input,{value:q,onChange:a=>r(a.target.value),placeholder:"ex: Validation standard"})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{children:"Description"}),(0,f.jsx)(mM.Input,{value:s,onChange:a=>t(a.target.value),placeholder:"Description du workflow..."})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsxs)("div",{className:"flex justify-between items-center",children:[(0,f.jsx)(F.Label,{children:"tapes du workflow"}),(0,f.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:()=>{v([...u,{step_order:u.length+1,name:`\xc9tape ${u.length+1}`,is_required:!0,can_reject:!0,can_comment:!0}])},children:[(0,f.jsx)(rS.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une tape"]})]}),(0,f.jsx)(na.AnimatePresence,{children:u.map((a,b)=>(0,f.jsxs)(m9.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"p-4 border rounded-lg space-y-3",children:[(0,f.jsxs)("div",{className:"flex justify-between items-center",children:[(0,f.jsxs)("h4",{className:"font-medium",children:["tape ",a.step_order]}),(0,f.jsx)(n.Button,{variant:"ghost",size:"icon",onClick:()=>{v(u.filter((a,c)=>c!==b).map((a,b)=>({...a,step_order:b+1})))},children:(0,f.jsx)(lD.Trash2,{className:"h-4 w-4"})})]}),(0,f.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{children:"Nom *"}),(0,f.jsx)(mM.Input,{value:a.name,onChange:a=>C(b,{name:a.target.value}),placeholder:"ex: Validation manager"})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{children:"Rle approbateur"}),(0,f.jsxs)(mN.Select,{value:a.approver_role||"",onValueChange:a=>C(b,{approver_role:a}),children:[(0,f.jsx)(mN.SelectTrigger,{children:(0,f.jsx)(mN.SelectValue,{placeholder:"Slectionner un rle"})}),(0,f.jsxs)(mN.SelectContent,{children:[(0,f.jsx)(mN.SelectItem,{value:"admin",children:"Administrateur"}),(0,f.jsx)(mN.SelectItem,{value:"manager",children:"Manager"}),(0,f.jsx)(mN.SelectItem,{value:"director",children:"Directeur"})]})]})]})]}),(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsx)(F.Label,{children:"Description"}),(0,f.jsx)(mM.Input,{value:a.description||"",onChange:a=>C(b,{description:a.target.value}),placeholder:"Description de l'tape..."})]}),(0,f.jsxs)("div",{className:"flex gap-4",children:[(0,f.jsxs)(F.Label,{className:"flex items-center gap-2",children:[(0,f.jsx)("input",{type:"checkbox",checked:a.is_required??!0,onChange:a=>C(b,{is_required:a.target.checked})}),"Requis"]}),(0,f.jsxs)(F.Label,{className:"flex items-center gap-2",children:[(0,f.jsx)("input",{type:"checkbox",checked:a.can_reject??!0,onChange:a=>C(b,{can_reject:a.target.checked})}),"Peut rejeter"]}),(0,f.jsxs)(F.Label,{className:"flex items-center gap-2",children:[(0,f.jsx)("input",{type:"checkbox",checked:a.can_comment??!0,onChange:a=>C(b,{can_comment:a.target.checked})}),"Peut commenter"]})]})]},b))})]}),(0,f.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,f.jsx)(n.Button,{variant:"outline",onClick:()=>p(!1),children:"Annuler"}),(0,f.jsx)(n.Button,{onClick:()=>z.mutate(),disabled:!q||0===u.length,children:"Crer le workflow"})]})]}),(0,f.jsx)("div",{className:"space-y-2",children:w?.map(a=>(0,f.jsx)(E.Card,{className:"p-4",children:(0,f.jsxs)("div",{className:"flex justify-between items-center",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{className:"font-semibold",children:a.name}),a.description&&(0,f.jsx)("p",{className:"text-sm text-muted-foreground",children:a.description})]}),(0,f.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:()=>A.mutate(a.id),disabled:A.isPending,children:[(0,f.jsx)(rR.Play,{className:"h-4 w-4 mr-2"}),"Dmarrer"]})]})},a.id))})]}),(0,f.jsxs)(rO.TabsContent,{value:"instances",className:"space-y-4",children:[(0,f.jsx)("h3",{className:"text-lg font-semibold",children:"Workflows en cours"}),(0,f.jsxs)("div",{className:"space-y-2",children:[x?.map(a=>(0,f.jsx)(E.Card,{className:"p-4",children:(0,f.jsx)("div",{className:"flex justify-between items-start",children:(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{className:"font-semibold",children:a.workflow?.name||"Workflow"}),(0,f.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Dmarr le ",(0,H.formatDate)(a.started_at)]}),G(a.status)]})})},a.id)),(!x||0===x.length)&&(0,f.jsx)("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucun workflow en cours pour ce template"})]})]}),(0,f.jsxs)(rO.TabsContent,{value:"approvals",className:"space-y-4",children:[(0,f.jsx)("h3",{className:"text-lg font-semibold",children:"Mes approbations en attente"}),(0,f.jsxs)("div",{className:"space-y-2",children:[y?.map(a=>(0,f.jsx)(E.Card,{className:"p-4",children:(0,f.jsxs)("div",{className:"space-y-3",children:[(0,f.jsxs)("div",{className:"flex justify-between items-start",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("h4",{className:"font-semibold",children:a.instance?.template?.name||"Template"}),(0,f.jsxs)("p",{className:"text-sm text-muted-foreground",children:["tape: ",a.step?.name||"N/A"]})]}),G(a.status)]}),(0,f.jsxs)("div",{className:"flex gap-2",children:[(0,f.jsxs)(n.Button,{size:"sm",onClick:()=>B.mutate({approvalId:a.id,status:"approved"}),disabled:B.isPending,children:[(0,f.jsx)(rP.CheckCircle,{className:"h-4 w-4 mr-2"}),"Approuver"]}),(0,f.jsxs)(n.Button,{size:"sm",variant:"destructive",onClick:()=>B.mutate({approvalId:a.id,status:"rejected"}),disabled:B.isPending,children:[(0,f.jsx)(rQ.XCircle,{className:"h-4 w-4 mr-2"}),"Rejeter"]})]})]})},a.id)),(!y||0===y.length)&&(0,f.jsx)("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucune approbation en attente"})]})]})]})})]})}var rV=a.i(587532),rW=a.i(784581),rX=a.i(654074),rY=a.i(767552);let rZ=[{name:"tablissement",variables:[{key:"ecole_nom",label:"Nom de l'cole"},{key:"ecole_adresse",label:"Adresse de l'cole"},{key:"ecole_ville",label:"Ville de l'cole"},{key:"ecole_code_postal",label:"Code postal"},{key:"ecole_telephone",label:"Tlphone de l'cole"},{key:"ecole_email",label:"Email de l'cole"},{key:"ecole_site_web",label:"Site web de l'cole"},{key:"ecole_slogan",label:"Slogan de l'cole"},{key:"ecole_logo",label:"Logo de l'cole"},{key:"ecole_siret",label:"SIRET"},{key:"ecole_region",label:"Rgion"},{key:"ecole_numero_declaration",label:"N de dclaration d'activit"},{key:"ecole_representant",label:"Reprsentant lgal"}]},{name:"lve",variables:[{key:"eleve_nom",label:"Nom de l'lve"},{key:"eleve_prenom",label:"Prnom de l'lve"},{key:"eleve_numero",label:"Numro de l'lve"},{key:"eleve_date_naissance",label:"Date de naissance"},{key:"eleve_classe",label:"Classe de l'lve"},{key:"eleve_photo",label:"Photo de l'lve"},{key:"eleve_adresse",label:"Adresse de l'lve"},{key:"eleve_telephone",label:"Tlphone de l'lve"},{key:"eleve_email",label:"Email de l'lve"}]},{name:"Tuteur",variables:[{key:"tuteur_nom",label:"Nom du tuteur"},{key:"tuteur_telephone",label:"Tlphone du tuteur"},{key:"tuteur_email",label:"Email du tuteur"},{key:"tuteur_adresse",label:"Adresse du tuteur"}]},{name:"Formation",variables:[{key:"formation_nom",label:"Nom de la formation"},{key:"formation_code",label:"Code de la formation"},{key:"formation_duree",label:"Dure de la formation"},{key:"formation_prix",label:"Prix de la formation"},{key:"formation_dates",label:"Dates de la formation"},{key:"formation_description",label:"Description de la formation"}]},{name:"Session",variables:[{key:"session_nom",label:"Nom de la session"},{key:"session_debut",label:"Date de dbut"},{key:"session_fin",label:"Date de fin"},{key:"session_lieu",label:"Lieu de la session"},{key:"session_horaires",label:"Horaires de la session"}]},{name:"Finances",variables:[{key:"montant",label:"Montant"},{key:"montant_lettres",label:"Montant en lettres"},{key:"montant_ttc",label:"Montant TTC"},{key:"montant_ht",label:"Montant HT"},{key:"tva",label:"TVA"},{key:"taux_tva",label:"Taux de TVA (%)"},{key:"date_paiement",label:"Date de paiement"},{key:"date_echeance",label:"Date d'chance"},{key:"mode_paiement",label:"Mode de paiement"},{key:"numero_facture",label:"Numro de facture"},{key:"numero_devis",label:"Numro de devis"},{key:"validite_devis",label:"Validit du devis"}]},{name:"Dates",variables:[{key:"date_jour",label:"Date du jour"},{key:"date_emission",label:"Date d'mission"},{key:"annee_scolaire",label:"Anne scolaire"},{key:"trimestre",label:"Trimestre"},{key:"semestre",label:"Semestre"}]},{name:"Notes",variables:[{key:"moyenne",label:"Moyenne"},{key:"moyenne_classe",label:"Moyenne de la classe"},{key:"classement",label:"Classement"},{key:"appreciations",label:"Apprciations"},{key:"mention",label:"Mention"}]},{name:"Convocation",variables:[{key:"convocation_objet",label:"Objet de la convocation"},{key:"convocation_date",label:"Date de convocation"},{key:"convocation_heure",label:"Heure de convocation"},{key:"convocation_lieu",label:"Lieu de convocation"},{key:"convocation_adresse",label:"Adresse de convocation"},{key:"convocation_duree",label:"Dure prvue"},{key:"convocation_contenu",label:"Contenu/Ordre du jour"},{key:"date_confirmation",label:"Date limite de confirmation"}]},{name:"Notes & valuations",variables:[{key:"matiere_1",label:"Matire 1"},{key:"matiere_2",label:"Matire 2"},{key:"matiere_3",label:"Matire 3"},{key:"coef_1",label:"Coefficient 1"},{key:"coef_2",label:"Coefficient 2"},{key:"coef_3",label:"Coefficient 3"},{key:"note_1",label:"Note 1"},{key:"note_2",label:"Note 2"},{key:"note_3",label:"Note 3"},{key:"appreciation_1",label:"Apprciation 1"},{key:"appreciation_2",label:"Apprciation 2"},{key:"appreciation_3",label:"Apprciation 3"},{key:"effectif_classe",label:"Effectif de la classe"}]},{name:"Programme",variables:[{key:"formation_objectifs",label:"Objectifs de la formation"},{key:"prerequis_1",label:"Prrequis 1"},{key:"prerequis_2",label:"Prrequis 2"},{key:"prerequis_3",label:"Prrequis 3"},{key:"module_1_titre",label:"Module 1 - Titre"},{key:"module_1_duree",label:"Module 1 - Dure"},{key:"module_1_contenu_1",label:"Module 1 - Contenu 1"},{key:"module_1_contenu_2",label:"Module 1 - Contenu 2"},{key:"module_1_contenu_3",label:"Module 1 - Contenu 3"},{key:"module_2_titre",label:"Module 2 - Titre"},{key:"module_2_duree",label:"Module 2 - Dure"},{key:"module_2_contenu_1",label:"Module 2 - Contenu 1"},{key:"module_2_contenu_2",label:"Module 2 - Contenu 2"},{key:"module_2_contenu_3",label:"Module 2 - Contenu 3"},{key:"module_3_titre",label:"Module 3 - Titre"},{key:"module_3_duree",label:"Module 3 - Dure"},{key:"module_3_contenu_1",label:"Module 3 - Contenu 1"},{key:"module_3_contenu_2",label:"Module 3 - Contenu 2"},{key:"module_3_contenu_3",label:"Module 3 - Contenu 3"}]},{name:"Rglement & Horaires",variables:[{key:"horaires_ouverture",label:"Horaires d'ouverture"},{key:"horaires_cours",label:"Horaires des cours"}]},{name:"Assiduit",variables:[{key:"heures_suivies",label:"Heures suivies"},{key:"heures_totales",label:"Heures totales"},{key:"taux_assiduite",label:"Taux d'assiduit (%)"}]},{name:"Divers",variables:[{key:"numero_document",label:"Numro du document"},{key:"validite_document",label:"Validit du document"},{key:"code_verification",label:"Code de vrification"},{key:"date_generation",label:"Date de gnration"},{key:"heure",label:"Heure"},{key:"annee_actuelle",label:"Anne actuelle"},{key:"copyright",label:"Copyright"},{key:"numero_page",label:"Numro de page"},{key:"total_pages",label:"Total de pages"}]}];function r$({onVariableSelect:a,className:b}){let[c,d]=(0,g.useState)(""),[e,h]=(0,g.useState)(!1),[i,j]=(0,g.useState)(!1),[k,l]=(0,g.useState)(!1),[m,n]=(0,g.useState)(!1),[o,p]=(0,g.useState)(!1),[q,r]=(0,g.useState)(new Set(rZ.map(a=>a.name))),s=rZ.map(a=>({...a,variables:a.variables.filter(a=>a.label.toLowerCase().includes(c.toLowerCase())||a.key.toLowerCase().includes(c.toLowerCase()))})).filter(a=>a.variables.length>0);return(0,f.jsxs)(E.Card,{className:(0,H.cn)("h-full flex flex-col",b),children:[(0,f.jsxs)(E.CardHeader,{className:"pb-3",children:[(0,f.jsx)(E.CardTitle,{className:"text-lg",children:"Balises  glisser-dposer"}),(0,f.jsx)("div",{className:"mt-3",children:(0,f.jsx)(mM.Input,{placeholder:"Rechercher une balise",value:c,onChange:a=>d(a.target.value),leftIcon:(0,f.jsx)(rV.Search,{className:"h-4 w-4 text-text-tertiary"}),className:"w-full"})})]}),(0,f.jsxs)(E.CardContent,{className:"flex-1 overflow-y-auto",children:[(0,f.jsx)("div",{className:"space-y-2",children:(0,f.jsx)(na.AnimatePresence,{children:s.map((b,c)=>(0,f.jsxs)(m9.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2,delay:.05*c},className:"space-y-1",children:[(0,f.jsxs)("button",{onClick:()=>{var a;let c;return a=b.name,void((c=new Set(q)).has(a)?c.delete(a):c.add(a),r(c))},className:"w-full flex items-center justify-between px-2 py-1.5 text-sm font-semibold text-text-primary hover:bg-bg-gray-100 rounded transition-all duration-200 hover:shadow-sm",children:[(0,f.jsx)("span",{children:b.name}),(0,f.jsx)(m9.motion.span,{animate:{rotate:180*!q.has(b.name)},transition:{duration:.2},className:"text-text-tertiary",children:q.has(b.name)?"":"+"})]}),(0,f.jsx)(na.AnimatePresence,{children:q.has(b.name)&&(0,f.jsx)(m9.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"space-y-1 pl-2 overflow-hidden",children:b.variables.map((b,c)=>(0,f.jsx)(m9.motion.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.03*c},children:(0,f.jsxs)("button",{onClick:()=>{a(b.key)},className:"w-full flex items-center gap-2 px-3 py-2 text-sm text-text-secondary hover:bg-brand-blue-ghost hover:text-brand-blue rounded-lg transition-all duration-200 cursor-move group hover:shadow-sm hover:scale-[1.02]",draggable:!0,onDragStart:a=>{a.dataTransfer.setData("application/x-variable-id",b.key),a.dataTransfer.setData("application/x-variable-label",b.label),a.dataTransfer.setData("application/x-variable-value",`{${b.key}}`),a.dataTransfer.setData("text/html",`{${b.key}}`),a.dataTransfer.setData("text/plain",b.key),a.dataTransfer.effectAllowed="copy",a.dataTransfer.dropEffect="copy",a.currentTarget.style.opacity="0.5"},onDragEnd:a=>{a.currentTarget.style.opacity="1"},children:[(0,f.jsx)(rW.GripVertical,{className:"h-4 w-4 text-text-tertiary group-hover:text-brand-blue transition-all duration-200 group-hover:scale-110"}),(0,f.jsx)("span",{className:"flex-1 text-left",children:b.label}),(0,f.jsx)("code",{className:"text-xs text-brand-blue bg-brand-blue-ghost px-1.5 py-0.5 rounded transition-all duration-200 group-hover:bg-brand-blue group-hover:text-white",children:`{${b.key}}`})]})},b.key))})})]},b.name))})}),0===s.length&&(0,f.jsxs)(m9.motion.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-8 text-text-tertiary text-sm",children:['Aucune balise trouve pour "',c,'"']})]}),(0,f.jsx)("div",{className:"border-t p-4",children:(0,f.jsxs)(mT.GlassCard,{variant:"subtle",className:"p-3",children:[(0,f.jsxs)("button",{onClick:()=>h(!e),className:"w-full flex items-center justify-between text-sm font-semibold text-text-primary",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(rX.Code,{className:"h-4 w-4 text-brand-blue"}),(0,f.jsx)("span",{children:"Conditions (IF/ELSE)"})]}),e?(0,f.jsx)(rY.ChevronUp,{className:"h-4 w-4"}):(0,f.jsx)(lA.ChevronDown,{className:"h-4 w-4"})]}),(0,f.jsx)(na.AnimatePresence,{children:e&&(0,f.jsxs)(m9.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"mt-3 space-y-3 text-xs text-text-secondary overflow-hidden",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Condition simple :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{IF variable}
  Contenu affich\xe9 si variable existe
{ENDIF}`})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Avec ELSE :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{IF variable}
  Contenu si vrai
{ELSE}
  Contenu si faux
{ENDIF}`})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Comparaisons :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{IF montant > 1000}
  Montant \xe9lev\xe9
{ENDIF}

{IF eleve_classe == "Terminale"}
  Classe terminale
{ENDIF}`})]}),(0,f.jsx)("div",{className:"pt-2 border-t",children:(0,f.jsxs)("p",{className:"text-xs text-text-tertiary",children:["Oprateurs supports : ",(0,f.jsx)("code",{children:"=="}),", ",(0,f.jsx)("code",{children:"!="}),", ",(0,f.jsx)("code",{children:">"}),", ",(0,f.jsx)("code",{children:"<"}),", ",(0,f.jsx)("code",{children:">="}),", ",(0,f.jsx)("code",{children:"<="})]})})]})})]})}),(0,f.jsx)("div",{className:"border-t p-4",children:(0,f.jsxs)(mT.GlassCard,{variant:"subtle",className:"p-3",children:[(0,f.jsxs)("button",{onClick:()=>j(!i),className:"w-full flex items-center justify-between text-sm font-semibold text-text-primary",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(rX.Code,{className:"h-4 w-4 text-brand-blue"}),(0,f.jsx)("span",{children:"Boucles (FOR/WHILE)"})]}),i?(0,f.jsx)(rY.ChevronUp,{className:"h-4 w-4"}):(0,f.jsx)(lA.ChevronDown,{className:"h-4 w-4"})]}),(0,f.jsx)(na.AnimatePresence,{children:i&&(0,f.jsxs)(m9.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"mt-3 space-y-3 text-xs text-text-secondary overflow-hidden",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Boucle FOR sur tableau :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{FOR item IN items}
  {item.nom} - {item.prix}
{ENDFOR}`})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Boucle FOR sur plage :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{FOR i FROM 1 TO 10}
  Ligne {i}
{ENDFOR}`})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Variables de boucle :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{item_index} - Index (0-based)
{item_number} - Num\xe9ro (1-based)
{item_is_first} - Premi\xe8re it\xe9ration
{item_is_last} - Derni\xe8re it\xe9ration`})]})]})})]})}),(0,f.jsx)("div",{className:"border-t p-4",children:(0,f.jsxs)(mT.GlassCard,{variant:"subtle",className:"p-3",children:[(0,f.jsxs)("button",{onClick:()=>n(!m),className:"w-full flex items-center justify-between text-sm font-semibold text-text-primary",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(rX.Code,{className:"h-4 w-4 text-brand-blue"}),(0,f.jsx)("span",{children:"Tableaux dynamiques"})]}),m?(0,f.jsx)(rY.ChevronUp,{className:"h-4 w-4"}):(0,f.jsx)(lA.ChevronDown,{className:"h-4 w-4"})]}),(0,f.jsx)(na.AnimatePresence,{children:m&&(0,f.jsxs)(m9.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"mt-3 space-y-3 text-xs text-text-secondary overflow-hidden",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Tableau dynamique :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{TABLE items}
  <table>
    <thead>...</thead>
    {ROW}
      <tr><td>{item.nom}</td></tr>
    {ENDROW}
  </table>
{ENDTABLE}`})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Ligne conditionnelle :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{IF_ROW item.prix > 100}
  <tr class="highlight">...</tr>
{ENDIF_ROW}`})]})]})})]})}),(0,f.jsx)("div",{className:"border-t p-4",children:(0,f.jsxs)(mT.GlassCard,{variant:"subtle",className:"p-3",children:[(0,f.jsxs)("button",{onClick:()=>p(!o),className:"w-full flex items-center justify-between text-sm font-semibold text-text-primary",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(rX.Code,{className:"h-4 w-4 text-brand-blue"}),(0,f.jsx)("span",{children:"Visibilit conditionnelle"})]}),o?(0,f.jsx)(rY.ChevronUp,{className:"h-4 w-4"}):(0,f.jsx)(lA.ChevronDown,{className:"h-4 w-4"})]}),(0,f.jsx)(na.AnimatePresence,{children:o&&(0,f.jsxs)(m9.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"mt-3 space-y-3 text-xs text-text-secondary overflow-hidden",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Afficher conditionnellement :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{SHOW_IF condition}
  Contenu affich\xe9 si vrai
{ELSE}
  Contenu alternatif
{END_SHOW}`})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Masquer conditionnellement :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{HIDE_IF condition}
  Contenu masqu\xe9 si vrai
{END_HIDE}`})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Classes CSS conditionnelles :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:'<div class="{IF condition}visible{ELSE}hidden{ENDIF}">'})]})]})})]})}),(0,f.jsx)("div",{className:"border-t p-4",children:(0,f.jsxs)(mT.GlassCard,{variant:"subtle",className:"p-3",children:[(0,f.jsxs)("button",{onClick:()=>l(!k),className:"w-full flex items-center justify-between text-sm font-semibold text-text-primary",children:[(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(rX.Code,{className:"h-4 w-4 text-brand-blue"}),(0,f.jsx)("span",{children:"Fonctions calcules"})]}),k?(0,f.jsx)(rY.ChevronUp,{className:"h-4 w-4"}):(0,f.jsx)(lA.ChevronDown,{className:"h-4 w-4"})]}),(0,f.jsx)(na.AnimatePresence,{children:k&&(0,f.jsxs)(m9.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"mt-3 space-y-3 text-xs text-text-secondary overflow-hidden",children:[(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Calculs :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{SUM notes} - Somme
{AVERAGE notes} - Moyenne
{COUNT items} - Nombre
{MIN values} - Minimum
{MAX values} - Maximum`})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Formatage :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{ROUND montant 2} - Arrondir
{FORMAT_CURRENCY montant EUR} - Devise
{FORMAT_DATE date DD/MM/YYYY} - Date`})]}),(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-semibold mb-1",children:"Texte :"}),(0,f.jsx)("code",{className:"block bg-gray-100 p-2 rounded text-xs",children:`{UPPERCASE texte} - Majuscules
{LOWERCASE texte} - Minuscules
{CAPITALIZE texte} - Premi\xe8re lettre majuscule`})]})]})})]})})]})}function r_({template:a,onTemplateChange:b}){let[c,d]=(0,g.useState)(a.font_size||10);return(0,f.jsxs)(E.Card,{className:"border border-gray-200",children:[(0,f.jsx)(E.CardHeader,{className:"pb-3",children:(0,f.jsxs)(E.CardTitle,{className:"text-base font-semibold flex items-center gap-2",children:[(0,f.jsx)(lC.Settings,{className:"h-4 w-4"}),"Paramtres du document"]})}),(0,f.jsx)(E.CardContent,{className:"space-y-4",children:(0,f.jsxs)("div",{className:"space-y-2",children:[(0,f.jsxs)("div",{className:"flex items-center justify-between",children:[(0,f.jsx)(F.Label,{htmlFor:"font-size",className:"text-sm font-medium",children:"Taille de police par dfaut"}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(mM.Input,{id:"font-size",type:"number",min:"6",max:"24",step:"0.5",value:c,onChange:a=>{let c=parseFloat(a.target.value);!isNaN(c)&&c>=6&&c<=24&&(d(c),b({font_size:c}))},className:"w-16 h-8 text-sm text-center"}),(0,f.jsx)("span",{className:"text-sm text-gray-500",children:"pt"})]})]}),(0,f.jsx)(I,{value:[c],onValueChange:a=>{let c=a[0];d(c),b({font_size:c})},min:6,max:24,step:.5,className:"w-full"}),(0,f.jsxs)("div",{className:"flex justify-between text-xs text-gray-400",children:[(0,f.jsx)("span",{children:"6pt"}),(0,f.jsx)("span",{children:"12pt"}),(0,f.jsx)("span",{children:"18pt"}),(0,f.jsx)("span",{children:"24pt"})]}),(0,f.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Cette taille sera applique  tout le contenu du document par dfaut. Vous pouvez toujours modifier la taille de police individuellement dans l'diteur."})]})})]})}var r0=a.i(265602),r1=a.i(773320),r2=a.i(533441),r3=a.i(452495),r4=a.i(539833),r5=a.i(284505),r6=a.i(823292);function r7({templateId:a,currentDocxUrl:b,onUploadSuccess:c,onRemoveSuccess:d}){let[e,h]=(0,g.useState)(!1),[i,j]=(0,g.useState)(!1),[k,l]=(0,g.useState)(!1),m=(0,g.useRef)(null),o=a=>{a.preventDefault(),a.stopPropagation(),"dragenter"===a.type||"dragover"===a.type?l(!0):"dragleave"===a.type&&l(!1)},p=async a=>{a.preventDefault(),a.stopPropagation(),l(!1),a.dataTransfer.files&&a.dataTransfer.files[0]&&await r(a.dataTransfer.files[0])},q=async a=>{a.target.files&&a.target.files[0]&&await r(a.target.files[0])},r=async b=>{if(!b.name.endsWith(".docx"))return void r6.toast.error("Le fichier doit tre un document Word (.docx)");if(b.size>0xa00000)return void r6.toast.error("Le fichier est trop volumineux (max 10MB)");h(!0);try{let d=new FormData;d.append("file",b),d.append("templateId",a);let e=await fetch("/api/documents/upload-docx-template",{method:"POST",body:d}),f=await e.json();if(!e.ok)throw Error(f.error||"Erreur lors de l'upload");r6.toast.success("Template DOCX upload avec succs"),c?.(f.docxTemplateUrl)}catch(a){console.error("Erreur upload:",a),r6.toast.error(a instanceof Error?a.message:"Erreur lors de l'upload")}finally{h(!1),m.current&&(m.current.value="")}},s=async()=>{if(confirm("tes-vous sr de vouloir supprimer le template DOCX ?")){j(!0);try{if(!(await fetch(`/api/document-templates/${a}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({docx_template_url:null})})).ok)throw Error("Erreur lors de la suppression");r6.toast.success("Template DOCX supprim"),d?.()}catch(a){console.error("Erreur suppression:",a),r6.toast.error(a instanceof Error?a.message:"Erreur lors de la suppression")}finally{j(!1)}}};return(0,f.jsxs)(E.Card,{className:"mt-6",children:[(0,f.jsxs)(E.CardHeader,{children:[(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsx)(m7.FileText,{className:"h-5 w-5 text-blue-500"}),(0,f.jsx)(E.CardTitle,{className:"text-lg",children:"Template Word Natif (DOCX)"}),(0,f.jsx)(l1,{children:(0,f.jsxs)(l5,{children:[(0,f.jsx)(l7,{asChild:!0,children:(0,f.jsx)(r4.HelpCircle,{className:"h-4 w-4 text-muted-foreground cursor-help"})}),(0,f.jsx)(mk,{className:"max-w-xs",children:(0,f.jsxs)("p",{children:["Uploadez un template Word (.docx) pour une gnration fidle au design. Utilisez des balises ","{variable}"," dans le document pour les variables dynamiques."]})})]})})]}),(0,f.jsxs)(E.CardDescription,{children:["Pour une gnration Word parfaite, uploadez un template DOCX avec des balises ","{variable}"]})]}),(0,f.jsxs)(E.CardContent,{children:[b?(0,f.jsxs)("div",{className:"space-y-4",children:[(0,f.jsxs)(r0.Alert,{className:"bg-green-50 border-green-200",children:[(0,f.jsx)(r2.Check,{className:"h-4 w-4 text-green-600"}),(0,f.jsx)(r0.AlertDescription,{className:"text-green-800",children:"Un template DOCX est configur. Les documents Word seront gnrs avec une fidlit parfaite."})]}),(0,f.jsxs)("div",{className:"flex items-center justify-between p-3 bg-muted rounded-lg",children:[(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsx)(m7.FileText,{className:"h-8 w-8 text-blue-500"}),(0,f.jsxs)("div",{children:[(0,f.jsx)("p",{className:"font-medium",children:"Template DOCX"}),(0,f.jsx)("p",{className:"text-sm text-muted-foreground",children:"Fichier upload"})]})]}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:()=>window.open(b,"_blank"),children:[(0,f.jsx)(r5.Download,{className:"h-4 w-4 mr-1"}),"Tlcharger"]}),(0,f.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:()=>m.current?.click(),disabled:e,children:[(0,f.jsx)(r1.Upload,{className:"h-4 w-4 mr-1"}),"Remplacer"]}),(0,f.jsxs)(n.Button,{variant:"outline",size:"sm",onClick:s,disabled:i,className:"text-destructive hover:text-destructive",children:[(0,f.jsx)(lD.Trash2,{className:"h-4 w-4 mr-1"}),"Supprimer"]})]})]})]}):(0,f.jsxs)("div",{className:`
              border-2 border-dashed rounded-lg p-8 text-center transition-colors
              ${k?"border-primary bg-primary/5":"border-muted-foreground/25"}
              ${e?"opacity-50 pointer-events-none":"cursor-pointer hover:border-primary/50"}
            `,onDragEnter:o,onDragLeave:o,onDragOver:o,onDrop:p,onClick:()=>!e&&m.current?.click(),children:[(0,f.jsx)(r1.Upload,{className:"h-10 w-10 mx-auto mb-4 text-muted-foreground"}),(0,f.jsx)("p",{className:"font-medium mb-1",children:e?"Upload en cours...":"Glissez-dposez votre template DOCX ici"}),(0,f.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"ou cliquez pour slectionner un fichier"}),(0,f.jsx)("p",{className:"text-xs text-muted-foreground",children:"Format accept : .docx (max 10MB)"})]}),(0,f.jsx)("input",{ref:m,type:"file",accept:".docx",onChange:q,className:"hidden"}),(0,f.jsx)("div",{className:"mt-4 pt-4 border-t",children:(0,f.jsxs)("a",{href:"/docs/DOCX_TEMPLATE_GUIDE.md",target:"_blank",className:"text-sm text-primary hover:underline inline-flex items-center gap-1",children:[(0,f.jsx)(r3.ExternalLink,{className:"h-3 w-3"}),"Guide de cration de templates DOCX"]})})]})]})}var r8=a.i(747895);function r9(){let b=(0,h.useParams)(),c=(0,h.useRouter)(),d=(0,h.useSearchParams)(),{user:e}=(0,l.useAuth)(),{addToast:x}=(0,D.useToast)(),E=(0,k.useQueryClient)(),F=b.type,G=(0,r8.getDocumentTypeConfig)(F),I=d.get("template_id"),[J,K]=(0,g.useState)("body"),[L,M]=(0,g.useState)(null),[N,O]=(0,g.useState)(!1),[P,Q]=(0,g.useState)(!1),[R,S]=(0,g.useState)(!1),[T,U]=(0,g.useState)(!1),[V,W]=(0,g.useState)(!1),[X,Y]=(0,g.useState)(!1),[Z,$]=(0,g.useState)(!1),[_,aa]=(0,g.useState)(null),ab=(0,g.useRef)(null),ac=(0,g.useCallback)(a=>{aa(a)},[]);(0,g.useEffect)(()=>{let a="true"===localStorage.getItem("editor-dark-mode");S(a),a&&document.documentElement.classList.add("dark")},[]);let ad=()=>{let a=!R;S(a),localStorage.setItem("editor-dark-mode",String(a)),a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},{data:ae,isLoading:af}=(0,i.useQuery)({queryKey:["document-template",e?.organization_id,F,I],queryFn:async()=>{if(!e?.organization_id)return null;if(I)try{let a=await m.documentTemplateService.getTemplateById(I);if(a.type===F)return a}catch(a){console.error("Erreur lors du chargement du template spcifique:",a)}let a=await m.documentTemplateService.getDefaultTemplate(e.organization_id,F),b=await m.documentTemplateService.getAllTemplates(e.organization_id,{type:F});if(!a&&0===b.length)try{let a=rd[F];return await m.documentTemplateService.createTemplate({organization_id:e.organization_id,type:F,name:a.name,header:{enabled:!0,height:100,elements:[],repeatOnAllPages:!0,content:a.headerContent},content:{pageSize:"A4",margins:{top:20,right:20,bottom:20,left:20},elements:[],html:a.bodyContent},font_size:10,footer:{enabled:!0,height:60,elements:[],repeatOnAllPages:!0,pagination:{enabled:!0,format:"Page {numero_page} / {total_pages}",position:"center"},content:a.footerContent},header_enabled:!0,header_height:100,footer_enabled:!0,footer_height:60,is_default:!0})}catch(a){if("23505"===a.code||a.message?.includes("duplicate")){let a=await m.documentTemplateService.getDefaultTemplate(e.organization_id,F);if(a)return a;if(b.length>0)return b[0]}throw a}if(!a&&b.length>0){let a=b[0],c=a.content?.html,d=a.content?.elements?.[0]?.content,e=(c||d||"").trim(),f=e&&e.length>=50;if(console.log("[Page] Template existant trouv:",{templateId:a.id,hasHtml:!!c,htmlLength:c?.length||0,hasElementsContent:!!d,elementsContentLength:d?.length||0,trimmedLength:e.length,hasContent:f}),!f){console.log("[Page] Template vide, initialisation avec le contenu par dfaut...");let b=rd[F];try{let c=await m.documentTemplateService.updateTemplate({id:a.id,content:{...a.content,html:b.bodyContent,elements:[{id:"main-content",type:"text",position:{x:0,y:0},content:b.bodyContent}]},header:{...a.header,content:b.headerContent},footer:{...a.footer,content:b.footerContent}});return console.log("[Page] Template mis  jour avec succs"),c}catch(a){console.error("[Page] Erreur lors de la mise  jour du template:",a)}}return a}if(a){let b=a.content?.html,c=a.content?.elements?.[0]?.content,d=(b||c||"").trim(),e=d&&d.length>=50,f=rd[F],g=f.bodyContent.trim(),h=!0===a.is_default;if(console.log("[Page] Template par dfaut trouv:",{templateId:a.id,isDefault:h,hasHtml:!!b,htmlLength:b?.length||0,hasElementsContent:!!c,elementsContentLength:c?.length||0,trimmedLength:d.length,hasContent:e,defaultContentLength:g.length}),!e){console.log("[Page] Template par dfaut vide, initialisation avec le contenu par dfaut...");try{let b=await m.documentTemplateService.updateTemplate({id:a.id,content:{...a.content,html:f.bodyContent,elements:[{id:"main-content",type:"text",position:{x:0,y:0},content:f.bodyContent}]},header:{...a.header,content:f.headerContent},footer:{...a.footer,content:f.footerContent}});return console.log("[Page] Template par dfaut mis  jour avec succs"),b}catch(a){console.error("[Page] Erreur lors de la mise  jour du template par dfaut:",a)}}}return a},enabled:!!e?.organization_id&&!!F}),ag=(0,g.useRef)(null);(0,g.useEffect)(()=>{ae&&!N&&!P&&(ag.current&&JSON.stringify(ae)===JSON.stringify(ag.current)||(M(ae),ag.current=ae))},[ae,N,P]),(0,g.useEffect)(()=>{ae&&!ag.current&&(ag.current=ae,console.log("[Page] savedTemplateRef initialis avec le template existant"))},[ae]);let ah=(0,j.useMutation)({mutationFn:async a=>{let{id:b,...c}=a;return m.documentTemplateService.updateTemplate({id:b,...c})},onSuccess:a=>{ag.current=a||L,E.invalidateQueries({queryKey:["document-template"]}),E.invalidateQueries({queryKey:["document-templates"]}),O(!1),x({type:"success",title:"Modle enregistr",description:"Le modle a t enregistr avec succs."})},onError:a=>{x({type:"error",title:"Erreur",description:a instanceof Error?a.message:"Une erreur est survenue lors de l'enregistrement."})}}),ai=async()=>{if(L&&e?.organization_id&&confirm("tes-vous sr de vouloir rinitialiser ce template avec le contenu par dfaut ? Toutes les modifications non sauvegardes seront perdues."))try{let a=rd[F],b={...L,name:a.name,content:{...L.content,elements:[{id:"main-content",type:"text",position:{x:0,y:0},content:a.bodyContent}]},header:{...L.header,content:a.headerContent},footer:{...L.footer,content:a.footerContent}};await ah.mutateAsync(b),M(b),O(!1),x({type:"success",title:"Template rinitialis",description:"Le template a t rinitialis avec le contenu par dfaut."})}catch(a){console.error("Erreur lors de la rinitialisation:",a),x({type:"error",title:"Erreur",description:"Une erreur est survenue lors de la rinitialisation du template."})}},aj=()=>{L&&ah.mutate(L)};(0,g.useEffect)(()=>{if(L&&N&&!P)return ab.current&&clearTimeout(ab.current),ab.current=setTimeout(async()=>{Q(!0);try{await m.documentTemplateService.updateTemplate(L),ag.current={...L},setTimeout(()=>{JSON.stringify(L)===JSON.stringify(L)&&(O(!1),ag.current={...L},setTimeout(()=>{E.invalidateQueries({queryKey:["document-template",e?.organization_id,F]})},500))},200)}catch(a){console.error("Erreur lors de l'auto-sauvegarde:",a)}finally{Q(!1),ab.current=null}},3e3),()=>{ab.current&&(clearTimeout(ab.current),ab.current=null)}},[L,N,e?.organization_id,F,E]);let ak=a=>{!L||Object.keys(a).some(b=>{let c=a[b],d=L[b];return JSON.stringify(c)!==JSON.stringify(d)})&&(M({...L,...a}),O(!0))};return((0,g.useEffect)(()=>{let{loadCustomShortcuts:b,getShortcutConfig:d,matchesShortcut:e,DEFAULT_SHORTCUTS:f}=a.r(401794),g=b(),h=a=>{a.target?.tagName==="INPUT"||a.target?.tagName==="TEXTAREA"||a.target?.isContentEditable||Object.keys(f).forEach(b=>{if(e(a,g[b]?g[b]:d(b)))switch(a.preventDefault(),b){case"save":L&&N&&aj();break;case"preview":c.push(`/dashboard/settings/document-templates/${F}/preview`);break;case"cycleTabs":let f=["header","body","footer","versions"],h=(f.indexOf(J)+1)%f.length;K(f[h]);break;case"toggleDarkMode":ad()}})};return window.addEventListener("keydown",h),()=>{window.removeEventListener("keydown",h)}},[L,N,J,F,c]),af||!L)?(0,f.jsx)(rJ.SkeletonLoader,{}):(0,f.jsxs)("div",{className:(0,H.cn)("h-screen flex flex-col",R&&"dark"),children:[(0,f.jsxs)("div",{className:"flex items-center justify-between border-b border-bg-gray-200 pb-4 px-6 pt-4 flex-shrink-0",children:[(0,f.jsxs)("div",{className:"flex items-center gap-4",children:[(0,f.jsx)(C.default,{href:"/dashboard/settings/document-templates",children:(0,f.jsx)(n.Button,{variant:"outline",size:"icon",children:(0,f.jsx)(p.ArrowLeft,{className:"h-4 w-4"})})}),(0,f.jsxs)("div",{children:[(0,f.jsxs)("h1",{className:"text-2xl font-bold text-text-primary flex items-center gap-2",children:[(0,f.jsx)(G.icon,{className:"h-6 w-6",style:{color:G.color}}),G.name]}),(0,f.jsx)("p",{className:"text-sm text-text-tertiary mt-1",children:"diteur de modle de document"})]})]}),(0,f.jsxs)("div",{className:"flex items-center gap-2",children:[(0,f.jsxs)(n.Button,{variant:"outline",onClick:()=>K("versions"),className:"versions"===J?"bg-brand-blue-ghost border-brand-blue":"",children:[(0,f.jsx)(t.History,{className:"h-4 w-4 mr-2"}),"Versions"]}),(0,f.jsxs)(n.Button,{variant:"outline",onClick:()=>{c.push(`/dashboard/settings/document-templates/${F}/preview`)},children:[(0,f.jsx)(r.Eye,{className:"h-4 w-4 mr-2"}),"Prvisualiser"]}),P&&(0,f.jsxs)("div",{className:"flex items-center gap-2 text-sm text-text-tertiary",children:[(0,f.jsx)(u.Loader2,{className:"h-4 w-4 animate-spin"}),(0,f.jsx)("span",{className:"hidden sm:inline",children:"Auto-sauvegarde..."})]}),(0,f.jsx)(n.Button,{variant:"outline",size:"icon",onClick:ad,title:R?"Mode clair":"Mode sombre",children:R?(0,f.jsx)(w.Sun,{className:"h-4 w-4"}):(0,f.jsx)(v.Moon,{className:"h-4 w-4"})}),(0,f.jsx)(n.Button,{variant:"outline",size:"icon",onClick:()=>U(!0),title:"Raccourcis clavier",children:(0,f.jsx)(y,{className:"h-4 w-4"})}),(0,f.jsx)(n.Button,{variant:"outline",size:"icon",onClick:ai,title:"Rinitialiser avec le contenu par dfaut",children:(0,f.jsx)(s.RotateCcw,{className:"h-4 w-4"})}),(0,f.jsx)(n.Button,{variant:"outline",size:"icon",onClick:()=>W(!0),title:"Gnration programme",children:(0,f.jsx)(z.Clock,{className:"h-4 w-4"})}),(0,f.jsx)(n.Button,{variant:"outline",size:"icon",onClick:()=>Y(!0),title:"Collaboration",children:(0,f.jsx)(A.Users,{className:"h-4 w-4"})}),(0,f.jsx)(n.Button,{variant:"outline",size:"icon",onClick:()=>$(!0),title:"Workflow de validation",children:(0,f.jsx)(B.CheckCircle2,{className:"h-4 w-4"})}),(0,f.jsxs)(n.Button,{variant:"default",onClick:aj,disabled:!N||ah.isPending,className:"hidden sm:flex",title:N?"Enregistrer les modifications":"Aucune modification  enregistrer",children:[(0,f.jsx)(q.Save,{className:"h-4 w-4 mr-2"}),ah.isPending?"Enregistrement...":"Enregistrer"]}),(0,f.jsx)(n.Button,{variant:"default",size:"icon",onClick:aj,disabled:!N||ah.isPending,className:"sm:hidden",title:N?"Enregistrer les modifications":"Aucune modification  enregistrer",children:(0,f.jsx)(q.Save,{className:"h-4 w-4"})}),!1]})]}),(0,f.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,f.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:(0,f.jsxs)(o.Accordion,{type:"single",defaultValue:J||void 0,className:"w-full space-y-4",children:[(0,f.jsxs)(o.AccordionItem,{value:"header",className:"border rounded-lg",children:[(0,f.jsx)(o.AccordionTrigger,{className:"px-6 py-4 hover:no-underline",children:(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsx)("span",{className:"text-xl",children:""}),(0,f.jsx)("span",{className:"text-lg font-semibold",children:"En-tte"})]})}),(0,f.jsx)(o.AccordionContent,{className:"px-0",children:(0,f.jsx)("div",{className:"px-6 pb-4",children:(0,f.jsx)(mS,{template:L,onTemplateChange:ak,onEditorRefReady:ac,isActive:"header"===J})})})]}),(0,f.jsxs)(o.AccordionItem,{value:"body",className:"border rounded-lg",children:[(0,f.jsx)(o.AccordionTrigger,{className:"px-6 py-4 hover:no-underline",children:(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsx)("span",{className:"text-xl",children:""}),(0,f.jsx)("span",{className:"text-lg font-semibold",children:"Contenu du document"})]})}),(0,f.jsx)(o.AccordionContent,{className:"px-0",children:(0,f.jsx)("div",{className:"px-6 pb-4",children:(0,f.jsx)(ru,{template:L,onTemplateChange:ak,onEditorRefReady:ac,isActive:"body"===J})})})]}),(0,f.jsxs)(o.AccordionItem,{value:"footer",className:"border rounded-lg",children:[(0,f.jsx)(o.AccordionTrigger,{className:"px-6 py-4 hover:no-underline",children:(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsx)("span",{className:"text-xl",children:""}),(0,f.jsx)("span",{className:"text-lg font-semibold",children:"Pied de page"})]})}),(0,f.jsx)(o.AccordionContent,{className:"px-0",children:(0,f.jsx)("div",{className:"px-6 pb-4",children:(0,f.jsx)(rA,{template:L,onTemplateChange:ak,onEditorRefReady:ac,isActive:"footer"===J})})})]}),(0,f.jsxs)(o.AccordionItem,{value:"versions",className:"border rounded-lg",children:[(0,f.jsx)(o.AccordionTrigger,{className:"px-6 py-4 hover:no-underline",children:(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsx)(t.History,{className:"h-5 w-5"}),(0,f.jsx)("span",{className:"text-lg font-semibold",children:"Versions"})]})}),(0,f.jsx)(o.AccordionContent,{className:"px-0",children:(0,f.jsx)("div",{className:"px-6 pb-4",children:(0,f.jsx)(rI,{templateId:L.id,onVersionRestore:()=>{E.invalidateQueries({queryKey:["document-template",e?.organization_id,F]}),K("body"),O(!1)}})})})]}),(0,f.jsxs)(o.AccordionItem,{value:"docx-template",className:"border rounded-lg",children:[(0,f.jsx)(o.AccordionTrigger,{className:"px-6 py-4 hover:no-underline",children:(0,f.jsxs)("div",{className:"flex items-center gap-3",children:[(0,f.jsx)("span",{className:"text-xl",children:""}),(0,f.jsx)("span",{className:"text-lg font-semibold",children:"Template Word (DOCX)"}),L.docx_template_url&&(0,f.jsx)("span",{className:"text-xs bg-green-100 text-green-800 px-2 py-0.5 rounded-full",children:"Configur"})]})}),(0,f.jsx)(o.AccordionContent,{className:"px-0",children:(0,f.jsx)("div",{className:"px-6 pb-4",children:(0,f.jsx)(r7,{templateId:L.id,currentDocxUrl:L.docx_template_url,onUploadSuccess:a=>{ak({docx_template_url:a}),x({type:"success",title:"Template DOCX upload",description:"Le template Word sera utilis pour la gnration de documents Word."})},onRemoveSuccess:()=>{ak({docx_template_url:null}),x({type:"info",title:"Template DOCX supprim",description:"La gnration Word utilisera dsormais la conversion HTML."})}})})})]})]})}),(0,f.jsxs)("div",{className:"w-80 border-l border-gray-200 flex-shrink-0 overflow-y-auto bg-white flex flex-col",children:[(0,f.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,f.jsx)(r_,{template:L,onTemplateChange:ak})}),(0,f.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,f.jsx)(r$,{onVariableSelect:a=>{_&&_.insertVariable(a)},className:"h-full border-0 rounded-none"})})]})]}),T&&(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,f.jsx)(rK,{onClose:()=>U(!1)})}),V&&L&&(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,f.jsx)(rL,{template:L,onClose:()=>W(!1)})}),X&&L&&(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,f.jsx)(rM,{template:L,onClose:()=>Y(!1)})}),Z&&L&&(0,f.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:(0,f.jsx)(rU,{template:L,onClose:()=>$(!1)})})]})}a.s(["default",()=>r9],249705)}];

//# sourceMappingURL=_e54fca59._.js.map