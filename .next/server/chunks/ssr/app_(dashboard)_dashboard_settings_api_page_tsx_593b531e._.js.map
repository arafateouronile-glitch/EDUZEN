{"version":3,"sources":["../../../../app/%28dashboard%29/dashboard/settings/api/page.tsx","../../../../lib/services/api.service.ts"],"sourcesContent":["'use client'\n\nimport { useState } from 'react'\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query'\nimport { useAuth } from '@/lib/hooks/use-auth'\nimport { apiService } from '@/lib/services/api.service'\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card'\nimport { Button } from '@/components/ui/button'\nimport { Input } from '@/components/ui/input'\nimport { Label } from '@/components/ui/label'\nimport { Textarea } from '@/components/ui/textarea'\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from '@/components/ui/dialog'\nimport {\n  Key,\n  Plus,\n  Trash2,\n  Copy,\n  Eye,\n  EyeOff,\n  ExternalLink,\n  AlertCircle,\n  CheckCircle,\n  Clock,\n  Webhook,\n} from 'lucide-react'\nimport { formatDate, formatDateTime } from '@/lib/utils'\nimport { useToast } from '@/components/ui/toast'\n\nexport default function APISettingsPage() {\n  const { user } = useAuth()\n  const queryClient = useQueryClient()\n  const { addToast } = useToast()\n  const toast = (options: any) => {\n    addToast({\n      title: options.title,\n      description: options.description,\n      type: options.type || options.variant || 'success',\n    })\n  }\n  const [newKeyName, setNewKeyName] = useState('')\n  const [newKeyDescription, setNewKeyDescription] = useState('')\n  const [newKeyScopes, setNewKeyScopes] = useState<string[]>([])\n  const [createdKey, setCreatedKey] = useState<string | null>(null)\n  const [showKey, setShowKey] = useState(false)\n\n  // Récupérer les clés API\n  const { data: apiKeys } = useQuery({\n    queryKey: ['api-keys', user?.organization_id],\n    queryFn: () => apiService.getAPIKeys(user?.organization_id || ''),\n    enabled: !!user?.organization_id,\n  })\n\n  // Récupérer les webhooks\n  const { data: webhooks } = useQuery({\n    queryKey: ['webhooks', user?.organization_id],\n    queryFn: () => apiService.getWebhooks(user?.organization_id || ''),\n    enabled: !!user?.organization_id,\n  })\n\n  // Récupérer les quotas\n  const { data: quota } = useQuery({\n    queryKey: ['api-quota', user?.organization_id],\n    queryFn: () => apiService.getQuota(user?.organization_id || ''),\n    enabled: !!user?.organization_id,\n  })\n\n  // Créer une clé API\n  const createKeyMutation = useMutation({\n    mutationFn: () =>\n      apiService.createAPIKey(user?.organization_id || '', user?.id || '', newKeyName, {\n        description: newKeyDescription,\n        scopes: newKeyScopes,\n      }),\n    onSuccess: (data: any) => {\n      setCreatedKey(data.key)\n      queryClient.invalidateQueries({ queryKey: ['api-keys'] })\n      setNewKeyName('')\n      setNewKeyDescription('')\n      setNewKeyScopes([])\n      toast({\n        title: 'Clé API créée',\n        description: 'Votre clé API a été créée avec succès. Copiez-la maintenant, elle ne sera plus affichée.',\n      })\n    },\n  })\n\n  // Révoquer une clé API\n  const revokeKeyMutation = useMutation({\n    mutationFn: (keyId: string) => apiService.revokeAPIKey(keyId),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['api-keys'] })\n      toast({\n        title: 'Clé API révoquée',\n        description: 'La clé API a été révoquée avec succès.',\n      })\n    },\n  })\n\n  const copyToClipboard = (text: string) => {\n    navigator.clipboard.writeText(text)\n    toast({\n      title: 'Copié',\n      description: 'La clé API a été copiée dans le presse-papiers.',\n    })\n  }\n\n  const scopes = [\n    { value: 'read:students', label: 'Lire les étudiants' },\n    { value: 'write:students', label: 'Créer/modifier les étudiants' },\n    { value: 'read:documents', label: 'Lire les documents' },\n    { value: 'write:documents', label: 'Créer/modifier les documents' },\n    { value: 'read:payments', label: 'Lire les paiements' },\n    { value: 'write:payments', label: 'Créer/modifier les paiements' },\n    { value: '*', label: 'Tous les accès' },\n  ]\n\n  return (\n    <div className=\"container mx-auto py-8 px-4 max-w-7xl\">\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold mb-2 flex items-center gap-2\">\n          <Key className=\"h-8 w-8\" />\n          Gestion de l'API\n        </h1>\n        <p className=\"text-muted-foreground\">\n          Gérez vos clés API et webhooks pour intégrer EDUZEN avec vos applications\n        </p>\n      </div>\n\n      <Tabs defaultValue=\"keys\" className=\"space-y-6\">\n        <TabsList>\n          <TabsTrigger value=\"keys\">Clés API</TabsTrigger>\n          <TabsTrigger value=\"webhooks\">Webhooks</TabsTrigger>\n          <TabsTrigger value=\"quota\">Quotas</TabsTrigger>\n          <TabsTrigger value=\"docs\">Documentation</TabsTrigger>\n        </TabsList>\n\n        {/* Onglet Clés API */}\n        <TabsContent value=\"keys\">\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-2xl font-semibold\">Clés API</h2>\n                <p className=\"text-muted-foreground\">\n                  Créez et gérez vos clés API pour accéder à l'API publique\n                </p>\n              </div>\n              <Dialog>\n                <DialogTrigger asChild>\n                  <Button>\n                    <Plus className=\"h-4 w-4 mr-2\" />\n                    Nouvelle clé API\n                  </Button>\n                </DialogTrigger>\n                <DialogContent>\n                  <DialogHeader>\n                    <DialogTitle>Créer une nouvelle clé API</DialogTitle>\n                    <DialogDescription>\n                      Créez une clé API pour accéder à l'API publique. Vous pourrez copier la clé\n                      une seule fois.\n                    </DialogDescription>\n                  </DialogHeader>\n                  <div className=\"space-y-4\">\n                    <div>\n                      <Label htmlFor=\"key-name\">Nom</Label>\n                      <Input\n                        id=\"key-name\"\n                        value={newKeyName}\n                        onChange={(e) => setNewKeyName(e.target.value)}\n                        placeholder=\"Ex: Production API, Development\"\n                      />\n                    </div>\n                    <div>\n                      <Label htmlFor=\"key-description\">Description</Label>\n                      <Textarea\n                        id=\"key-description\"\n                        value={newKeyDescription}\n                        onChange={(e) => setNewKeyDescription(e.target.value)}\n                        placeholder=\"Description de l'utilisation de cette clé\"\n                      />\n                    </div>\n                    <div>\n                      <Label>Permissions (Scopes)</Label>\n                      <div className=\"space-y-2 mt-2\">\n                        {scopes.map((scope) => (\n                          <label key={scope.value} className=\"flex items-center space-x-2\">\n                            <input\n                              type=\"checkbox\"\n                              checked={newKeyScopes.includes(scope.value)}\n                              onChange={(e) => {\n                                if (e.target.checked) {\n                                  setNewKeyScopes([...newKeyScopes, scope.value])\n                                } else {\n                                  setNewKeyScopes(newKeyScopes.filter((s) => s !== scope.value))\n                                }\n                              }}\n                            />\n                            <span className=\"text-sm\">{scope.label}</span>\n                          </label>\n                        ))}\n                      </div>\n                    </div>\n                    <Button\n                      onClick={() => createKeyMutation.mutate()}\n                      disabled={!newKeyName || createKeyMutation.isPending}\n                      className=\"w-full\"\n                    >\n                      Créer la clé API\n                    </Button>\n                  </div>\n                </DialogContent>\n              </Dialog>\n\n              {/* Dialog pour afficher la clé créée */}\n              {createdKey && (\n                <Dialog open={!!createdKey} onOpenChange={() => setCreatedKey(null)}>\n                  <DialogContent>\n                    <DialogHeader>\n                      <DialogTitle>Clé API créée</DialogTitle>\n                      <DialogDescription>\n                        Copiez cette clé maintenant. Elle ne sera plus affichée après la fermeture\n                        de cette fenêtre.\n                      </DialogDescription>\n                    </DialogHeader>\n                    <div className=\"space-y-4\">\n                      <div className=\"flex items-center gap-2\">\n                        <Input\n                          value={createdKey}\n                          readOnly\n                          type={showKey ? 'text' : 'password'}\n                          className=\"font-mono\"\n                        />\n                        <Button\n                          variant=\"outline\"\n                          size=\"icon\"\n                          onClick={() => setShowKey(!showKey)}\n                        >\n                          {showKey ? <EyeOff className=\"h-4 w-4\" /> : <Eye className=\"h-4 w-4\" />}\n                        </Button>\n                        <Button variant=\"outline\" size=\"icon\" onClick={() => copyToClipboard(createdKey)}>\n                          <Copy className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                      <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-3 flex items-start gap-2\">\n                        <AlertCircle className=\"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5\" />\n                        <p className=\"text-sm text-yellow-800\">\n                          <strong>Important :</strong> Cette clé ne sera affichée qu'une seule fois.\n                          Assurez-vous de la copier et de la stocker en sécurité.\n                        </p>\n                      </div>\n                    </div>\n                  </DialogContent>\n                </Dialog>\n              )}\n            </div>\n\n            {/* Liste des clés API */}\n            {apiKeys && apiKeys.length > 0 ? (\n              <div className=\"space-y-4\">\n                {apiKeys.map((key: any) => (\n                  <Card key={key.id}>\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <CardTitle className=\"text-lg\">{key.name}</CardTitle>\n                          {key.description && (\n                            <CardDescription className=\"mt-1\">{key.description}</CardDescription>\n                          )}\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          {key.is_active ? (\n                            <span className=\"flex items-center gap-1 text-sm text-green-600\">\n                              <CheckCircle className=\"h-4 w-4\" />\n                              Active\n                            </span>\n                          ) : (\n                            <span className=\"flex items-center gap-1 text-sm text-gray-500\">\n                              <Clock className=\"h-4 w-4\" />\n                              Révoquée\n                            </span>\n                          )}\n                        </div>\n                      </div>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-3\">\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-sm font-mono text-muted-foreground\">\n                            {key.key_prefix}\n                          </span>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => copyToClipboard(key.key_prefix)}\n                          >\n                            <Copy className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n                          <div>\n                            <span className=\"text-muted-foreground\">Créée le</span>\n                            <p className=\"font-medium\">{formatDate(key.created_at)}</p>\n                          </div>\n                          {key.last_used_at && (\n                            <div>\n                              <span className=\"text-muted-foreground\">Dernière utilisation</span>\n                              <p className=\"font-medium\">{formatDate(key.last_used_at)}</p>\n                            </div>\n                          )}\n                          <div>\n                            <span className=\"text-muted-foreground\">Requêtes</span>\n                            <p className=\"font-medium\">{key.request_count || 0}</p>\n                          </div>\n                          {key.expires_at && (\n                            <div>\n                              <span className=\"text-muted-foreground\">Expire le</span>\n                              <p className=\"font-medium\">{formatDate(key.expires_at)}</p>\n                            </div>\n                          )}\n                        </div>\n                        {key.scopes && key.scopes.length > 0 && (\n                          <div>\n                            <span className=\"text-sm text-muted-foreground\">Permissions :</span>\n                            <div className=\"flex flex-wrap gap-2 mt-1\">\n                              {key.scopes.map((scope: string) => (\n                                <span\n                                  key={scope}\n                                  className=\"text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded\"\n                                >\n                                  {scopes.find((s) => s.value === scope)?.label || scope}\n                                </span>\n                              ))}\n                            </div>\n                          </div>\n                        )}\n                        <div className=\"flex items-center gap-2 pt-2 border-t\">\n                          {key.is_active && (\n                            <Button\n                              variant=\"destructive\"\n                              size=\"sm\"\n                              onClick={() => revokeKeyMutation.mutate(key.id)}\n                            >\n                              <Trash2 className=\"h-4 w-4 mr-2\" />\n                              Révoquer\n                            </Button>\n                          )}\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <Card>\n                <CardContent className=\"pt-6 text-center text-muted-foreground\">\n                  Aucune clé API. Créez-en une pour commencer à utiliser l'API.\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </TabsContent>\n\n        {/* Onglet Webhooks */}\n        <TabsContent value=\"webhooks\">\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <h2 className=\"text-2xl font-semibold\">Webhooks</h2>\n                <p className=\"text-muted-foreground\">\n                  Configurez des webhooks pour recevoir des notifications d'événements\n                </p>\n              </div>\n              <Button>\n                <Plus className=\"h-4 w-4 mr-2\" />\n                Nouveau webhook\n              </Button>\n            </div>\n\n            {webhooks && webhooks.length > 0 ? (\n              <div className=\"space-y-4\">\n                {webhooks.map((webhook: any) => (\n                  <Card key={webhook.id}>\n                    <CardHeader>\n                      <div className=\"flex items-start justify-between\">\n                        <div>\n                          <CardTitle className=\"text-lg\">{webhook.name}</CardTitle>\n                          <CardDescription className=\"mt-1 font-mono text-xs\">\n                            {webhook.url}\n                          </CardDescription>\n                        </div>\n                        {webhook.is_active ? (\n                          <span className=\"flex items-center gap-1 text-sm text-green-600\">\n                            <CheckCircle className=\"h-4 w-4\" />\n                            Actif\n                          </span>\n                        ) : (\n                          <span className=\"flex items-center gap-1 text-sm text-gray-500\">\n                            <Clock className=\"h-4 w-4\" />\n                            Inactif\n                          </span>\n                        )}\n                      </div>\n                    </CardHeader>\n                    <CardContent>\n                      <div className=\"space-y-3\">\n                        {webhook.events && webhook.events.length > 0 && (\n                          <div>\n                            <span className=\"text-sm text-muted-foreground\">Événements :</span>\n                            <div className=\"flex flex-wrap gap-2 mt-1\">\n                              {webhook.events.map((event: string) => (\n                                <span\n                                  key={event}\n                                  className=\"text-xs px-2 py-1 bg-purple-100 text-purple-800 rounded\"\n                                >\n                                  {event}\n                                </span>\n                              ))}\n                            </div>\n                          </div>\n                        )}\n                        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n                          <div>\n                            <span className=\"text-muted-foreground\">Succès</span>\n                            <p className=\"font-medium\">{webhook.success_count || 0}</p>\n                          </div>\n                          <div>\n                            <span className=\"text-muted-foreground\">Échecs</span>\n                            <p className=\"font-medium\">{webhook.failure_count || 0}</p>\n                          </div>\n                          {webhook.last_triggered_at && (\n                            <div>\n                              <span className=\"text-muted-foreground\">Dernier déclenchement</span>\n                              <p className=\"font-medium\">{formatDate(webhook.last_triggered_at)}</p>\n                            </div>\n                          )}\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <Card>\n                <CardContent className=\"pt-6 text-center text-muted-foreground\">\n                  Aucun webhook configuré. Créez-en un pour recevoir des notifications.\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </TabsContent>\n\n        {/* Onglet Quotas */}\n        <TabsContent value=\"quota\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Quotas API</CardTitle>\n              <CardDescription>\n                Limites d'utilisation de l'API pour votre organisation\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              {quota ? (\n                <div className=\"space-y-6\">\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                    <div>\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-sm font-medium\">Par minute</span>\n                        <span className=\"text-sm text-muted-foreground\">\n                          {(quota as any).requests_used_minute || 0} / {(quota as any).requests_per_minute || 60}\n                        </span>\n                      </div>\n                      <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                        <div\n                          className=\"bg-primary h-2 rounded-full transition-all\"\n                          style={{\n                            width: `${\n                              (((quota as any).requests_used_minute || 0) / ((quota as any).requests_per_minute || 60)) *\n                              100\n                            }%`,\n                          }}\n                        />\n                      </div>\n                    </div>\n                    <div>\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-sm font-medium\">Par heure</span>\n                        <span className=\"text-sm text-muted-foreground\">\n                          {(quota as any).requests_used_hour || 0} / {(quota as any).requests_per_hour || 1000}\n                        </span>\n                      </div>\n                      <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                        <div\n                          className=\"bg-primary h-2 rounded-full transition-all\"\n                          style={{\n                            width: `${\n                              (((quota as any).requests_used_hour || 0) / ((quota as any).requests_per_hour || 1000)) *\n                              100\n                            }%`,\n                          }}\n                        />\n                      </div>\n                    </div>\n                    <div>\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-sm font-medium\">Par jour</span>\n                        <span className=\"text-sm text-muted-foreground\">\n                          {(quota as any).requests_used_day || 0} / {(quota as any).requests_per_day || 10000}\n                        </span>\n                      </div>\n                      <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                        <div\n                          className=\"bg-primary h-2 rounded-full transition-all\"\n                          style={{\n                            width: `${\n                              (((quota as any).requests_used_day || 0) / ((quota as any).requests_per_day || 10000)) *\n                              100\n                            }%`,\n                          }}\n                        />\n                      </div>\n                    </div>\n                    <div>\n                      <div className=\"flex items-center justify-between mb-2\">\n                        <span className=\"text-sm font-medium\">Par mois</span>\n                        <span className=\"text-sm text-muted-foreground\">\n                          {(quota as any).requests_used_month || 0} / {(quota as any).requests_per_month || 100000}\n                        </span>\n                      </div>\n                      <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                        <div\n                          className=\"bg-primary h-2 rounded-full transition-all\"\n                          style={{\n                            width: `${\n                              (((quota as any).requests_used_month || 0) /\n                                ((quota as any).requests_per_month || 100000)) *\n                              100\n                            }%`,\n                          }}\n                        />\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"text-center text-muted-foreground\">\n                  Chargement des quotas...\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        </TabsContent>\n\n        {/* Onglet Documentation */}\n        <TabsContent value=\"docs\">\n          <Card>\n            <CardHeader>\n              <CardTitle>Documentation API</CardTitle>\n              <CardDescription>\n                Accédez à la documentation complète de l'API publique\n              </CardDescription>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-4\">\n                <p className=\"text-muted-foreground\">\n                  La documentation OpenAPI/Swagger de l'API est disponible à l'adresse suivante :\n                </p>\n                <div className=\"flex items-center gap-2\">\n                  <code className=\"px-3 py-2 bg-gray-100 rounded text-sm\">\n                    {process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3001'}/api/v1/docs\n                  </code>\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() =>\n                      window.open(`${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:3001'}/api/v1/docs`, '_blank')\n                    }\n                  >\n                    <ExternalLink className=\"h-4 w-4 mr-2\" />\n                    Ouvrir\n                  </Button>\n                </div>\n                <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                  <h3 className=\"font-semibold mb-2\">Utilisation de l'API</h3>\n                  <ol className=\"list-decimal list-inside space-y-2 text-sm text-muted-foreground\">\n                    <li>Créez une clé API dans l'onglet \"Clés API\"</li>\n                    <li>Utilisez cette clé dans l'en-tête <code>X-API-Key</code> de vos requêtes</li>\n                    <li>Consultez la documentation pour voir tous les endpoints disponibles</li>\n                    <li>Respectez les limites de rate limiting configurées</li>\n                  </ol>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </TabsContent>\n      </Tabs>\n    </div>\n  )\n}\n\n","import { createClient } from '@/lib/supabase/client'\nimport type { SupabaseClient } from '@supabase/supabase-js'\nimport crypto from 'crypto'\nimport { Database } from '@/types/database.types'\nimport type { TableRow, TableInsert, TableUpdate } from '@/lib/types/supabase-helpers'\n\n// Types locaux pour les tables API qui ne sont pas encore dans le schéma Supabase\ntype APIKey = any\ntype Webhook = any\ntype WebhookDelivery = any\n\nexport class APIService {\n  private supabase: SupabaseClient<Database>\n\n\n  constructor(supabaseClient?: SupabaseClient<Database>) {\n\n    this.supabase = supabaseClient || createClient()\n\n  }\n\n  // ========== API KEYS ==========\n\n  /**\n   * Génère une nouvelle clé API\n   */\n  generateAPIKey(): { key: string; hash: string; prefix: string } {\n    const key = `eduz_${crypto.randomBytes(32).toString('hex')}`\n    const hash = crypto.createHash('sha256').update(key).digest('hex')\n    const prefix = key.substring(0, 12) + '...'\n    return { key, hash, prefix }\n  }\n\n  /**\n   * Vérifie une clé API\n   */\n  async verifyAPIKey(apiKey: string): Promise<APIKey | null> {\n    const hash = crypto.createHash('sha256').update(apiKey).digest('hex')\n    const { data, error } = await (this.supabase as any)\n      .from('api_keys')\n      .select('*')\n      .eq('key_hash', hash)\n      .eq('is_active', true)\n      .maybeSingle()\n\n    if (error) throw error\n    return data\n  }\n\n  /**\n   * Crée une nouvelle clé API\n   */\n  async createAPIKey(\n    organizationId: string,\n    userId: string,\n    name: string,\n    options?: {\n      description?: string\n      scopes?: string[]\n      allowedIPs?: string[]\n      allowedOrigins?: string[]\n      rateLimitPerMinute?: number\n      rateLimitPerHour?: number\n      rateLimitPerDay?: number\n      expiresAt?: Date\n    }\n  ) {\n    const { key, hash, prefix } = this.generateAPIKey()\n\n    // Créer le quota si nécessaire\n    await this.ensureQuotaExists(organizationId)\n\n    const { data, error } = await (this.supabase as any)\n      .from('api_keys')\n      .insert({\n        organization_id: organizationId,\n        user_id: userId,\n        name,\n        key_hash: hash,\n        key_prefix: prefix,\n        description: options?.description,\n        scopes: options?.scopes || [],\n        allowed_ips: options?.allowedIPs || [],\n        allowed_origins: options?.allowedOrigins || [],\n        rate_limit_per_minute: options?.rateLimitPerMinute || 60,\n        rate_limit_per_hour: options?.rateLimitPerHour || 1000,\n        rate_limit_per_day: options?.rateLimitPerDay || 10000,\n        expires_at: options?.expiresAt?.toISOString(),\n      })\n      .select()\n      .single()\n\n    if (error) throw error\n\n    // Retourner la clé (seulement à la création)\n    return { ...data, key }\n  }\n\n  /**\n   * Récupère les clés API d'une organisation\n   */\n  async getAPIKeys(organizationId: string) {\n    const { data, error } = await (this.supabase as any)\n      .from('api_keys')\n      .select('*')\n      .eq('organization_id', organizationId)\n      .order('created_at', { ascending: false })\n\n    if (error) throw error\n    return data\n  }\n\n  /**\n   * Met à jour une clé API\n   */\n  async updateAPIKey(keyId: string, updates: any) {\n    const { data, error } = await (this.supabase as any)\n      .from('api_keys')\n      .update(updates)\n      .eq('id', keyId)\n      .select()\n      .single()\n\n    if (error) throw error\n    return data\n  }\n\n  /**\n   * Désactive une clé API\n   */\n  async revokeAPIKey(keyId: string) {\n    return this.updateAPIKey(keyId, { is_active: false })\n  }\n\n  /**\n   * Supprime une clé API\n   */\n  async deleteAPIKey(keyId: string) {\n    const { error } = await (this.supabase as any)\n      .from('api_keys')\n      .delete()\n      .eq('id', keyId)\n\n    if (error) throw error\n  }\n\n  // ========== RATE LIMITING ==========\n\n  /**\n   * Vérifie si une requête respecte les limites de taux\n   */\n  async checkRateLimit(\n    apiKey: APIKey,\n    organizationId: string\n  ): Promise<{ allowed: boolean; remaining: number; resetAt: Date }> {\n    // Vérifier les limites de la clé API\n    const keyLimits = await this.checkKeyRateLimit(apiKey.id)\n    if (!keyLimits.allowed) {\n      return keyLimits\n    }\n\n    // Vérifier les quotas de l'organisation\n    const quotaLimits = await this.checkQuotaRateLimit(organizationId)\n    if (!quotaLimits.allowed) {\n      return quotaLimits\n    }\n\n    return { allowed: true, remaining: Math.min(keyLimits.remaining, quotaLimits.remaining), resetAt: quotaLimits.resetAt }\n  }\n\n  private async checkKeyRateLimit(\n    keyId: string\n  ): Promise<{ allowed: boolean; remaining: number; resetAt: Date }> {\n    const { data: key } = await (this.supabase as any)\n      .from('api_keys')\n      .select('rate_limit_per_minute, rate_limit_per_hour, rate_limit_per_day')\n      .eq('id', keyId)\n      .single()\n\n    if (!key) {\n      return { allowed: false, remaining: 0, resetAt: new Date() }\n    }\n\n    const now = new Date()\n    const oneMinuteAgo = new Date(now.getTime() - 60 * 1000)\n    const oneHourAgo = new Date(now.getTime() - 60 * 60 * 1000)\n    const oneDayAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000)\n\n    // Compter les requêtes récentes\n    const { count: minuteCount } = await (this.supabase as any)\n      .from('api_requests')\n      .select('*', { count: 'exact', head: true })\n      .eq('api_key_id', keyId)\n      .gte('created_at', oneMinuteAgo.toISOString())\n\n    const { count: hourCount } = await (this.supabase as any)\n      .from('api_requests')\n      .select('*', { count: 'exact', head: true })\n      .eq('api_key_id', keyId)\n      .gte('created_at', oneHourAgo.toISOString())\n\n    const { count: dayCount } = await (this.supabase as any)\n      .from('api_requests')\n      .select('*', { count: 'exact', head: true })\n      .eq('api_key_id', keyId)\n      .gte('created_at', oneDayAgo.toISOString())\n\n    // Vérifier les limites\n    if (minuteCount && minuteCount >= (key.rate_limit_per_minute || 60)) {\n      return { allowed: false, remaining: 0, resetAt: new Date(now.getTime() + 60 * 1000) }\n    }\n\n    if (hourCount && hourCount >= (key.rate_limit_per_hour || 1000)) {\n      return { allowed: false, remaining: 0, resetAt: new Date(now.getTime() + 60 * 60 * 1000) }\n    }\n\n    if (dayCount && dayCount >= (key.rate_limit_per_day || 10000)) {\n      return { allowed: false, remaining: 0, resetAt: new Date(now.getTime() + 24 * 60 * 60 * 1000) }\n    }\n\n    const remaining = Math.min(\n      (key.rate_limit_per_minute || 60) - (minuteCount || 0),\n      (key.rate_limit_per_hour || 1000) - (hourCount || 0),\n      (key.rate_limit_per_day || 10000) - (dayCount || 0)\n    )\n\n    return { allowed: true, remaining, resetAt: new Date(now.getTime() + 60 * 1000) }\n  }\n\n  private async checkQuotaRateLimit(\n    organizationId: string\n  ): Promise<{ allowed: boolean; remaining: number; resetAt: Date }> {\n    const { data: quota } = await (this.supabase as any)\n      .from('api_quotas')\n      .select('*')\n      .eq('organization_id', organizationId)\n      .single()\n\n    if (!quota) {\n      // Créer un quota par défaut\n      await this.ensureQuotaExists(organizationId)\n      return { allowed: true, remaining: 10000, resetAt: new Date() }\n    }\n\n    // Vérifier les quotas\n    if (quota.requests_used_minute >= (quota.requests_per_minute || 60)) {\n      return { allowed: false, remaining: 0, resetAt: new Date() }\n    }\n\n    if (quota.requests_used_hour >= (quota.requests_per_hour || 1000)) {\n      return { allowed: false, remaining: 0, resetAt: new Date() }\n    }\n\n    if (quota.requests_used_day >= (quota.requests_per_day || 10000)) {\n      return { allowed: false, remaining: 0, resetAt: new Date() }\n    }\n\n    const remaining = Math.min(\n      (quota.requests_per_minute || 60) - quota.requests_used_minute,\n      (quota.requests_per_hour || 1000) - quota.requests_used_hour,\n      (quota.requests_per_day || 10000) - quota.requests_used_day\n    )\n\n    return { allowed: true, remaining, resetAt: new Date() }\n  }\n\n  /**\n   * Enregistre une requête API\n   */\n  async logAPIRequest(\n    apiKeyId: string | null,\n    organizationId: string | null,\n    method: string,\n    endpoint: string,\n    path: string,\n    statusCode: number,\n    responseTimeMs: number,\n    ipAddress?: string,\n    userAgent?: string,\n    queryParams?: Record<string, string | number | boolean>\n  ) {\n    const { data, error } = await (this.supabase as any)\n      .from('api_requests')\n      .insert({\n        api_key_id: apiKeyId,\n        organization_id: organizationId,\n        method,\n        endpoint,\n        path,\n        status_code: statusCode,\n        response_time_ms: responseTimeMs,\n        ip_address: ipAddress,\n        user_agent: userAgent,\n        query_params: queryParams,\n      })\n      .select()\n      .single()\n\n    if (error) throw error\n    return data\n  }\n\n  /**\n   * Récupère les statistiques d'utilisation API\n   */\n  async getAPIUsageStats(organizationId: string, startDate?: Date, endDate?: Date) {\n    let query = (this.supabase as any)\n      .from('api_requests')\n      .select('method, endpoint, status_code, response_time_ms')\n      .eq('organization_id', organizationId)\n\n    if (startDate) {\n      query = query.gte('created_at', startDate.toISOString())\n    }\n\n    if (endDate) {\n      query = query.lte('created_at', endDate.toISOString())\n    }\n\n    const { data, error } = await query\n\n    if (error) throw error\n\n    const stats = {\n      total_requests: data?.length || 0,\n      by_method: {} as Record<string, number>,\n      by_endpoint: {} as Record<string, number>,\n      by_status: {} as Record<string, number>,\n      average_response_time: 0,\n      error_rate: 0,\n    }\n\n    if (data && data.length > 0) {\n      let totalResponseTime = 0\n      let errorCount = 0\n\n      data.forEach((req: { method: string; [key: string]: unknown }) => {\n        // Par méthode\n        stats.by_method[req.method] = (stats.by_method[req.method] || 0) + 1\n\n        // Par endpoint\n        const endpoint = req.endpoint as string\n        stats.by_endpoint[endpoint] = (stats.by_endpoint[endpoint] || 0) + 1\n\n        // Par statut\n        const statusCode = (req.status_code as number) || 0\n        const statusGroup = Math.floor(statusCode / 100) * 100\n        stats.by_status[statusGroup] = (stats.by_status[statusGroup] || 0) + 1\n\n        // Temps de réponse\n        const responseTime = (req.response_time_ms as number) || 0\n        if (responseTime) {\n          totalResponseTime += responseTime\n        }\n\n        // Erreurs\n        if (statusCode >= 400) {\n          errorCount++\n        }\n      })\n\n      stats.average_response_time = totalResponseTime / data.length\n      stats.error_rate = (errorCount / data.length) * 100\n    }\n\n    return stats\n  }\n\n  // ========== QUOTAS ==========\n\n  async ensureQuotaExists(organizationId: string) {\n    const { data: existing } = await (this.supabase as any)\n      .from('api_quotas')\n      .select('id')\n      .eq('organization_id', organizationId)\n      .maybeSingle()\n\n    if (!existing) {\n      const { error } = await (this.supabase as any)\n        .from('api_quotas')\n        .insert({\n          organization_id: organizationId,\n        })\n\n      if (error) throw error\n    }\n  }\n\n  async getQuota(organizationId: string) {\n    const { data, error } = await (this.supabase as any)\n      .from('api_quotas')\n      .select('*')\n      .eq('organization_id', organizationId)\n      .single()\n\n    if (error) throw error\n    return data\n  }\n\n  async updateQuota(organizationId: string, updates: any) {\n    const { data, error } = await (this.supabase as any)\n      .from('api_quotas')\n      .update(updates)\n      .eq('organization_id', organizationId)\n      .select()\n      .single()\n\n    if (error) throw error\n    return data\n  }\n\n  // ========== WEBHOOKS ==========\n\n  async createWebhook(webhook: any) {\n    // Générer un secret\n    const secret = crypto.randomBytes(32).toString('hex')\n    const { data, error } = await (this.supabase as any)\n      .from('webhooks')\n      .insert({\n        ...webhook,\n        secret,\n      })\n      .select()\n      .single()\n\n    if (error) throw error\n    return { ...data, secret } // Retourner le secret seulement à la création\n  }\n\n  async getWebhooks(organizationId: string) {\n    const { data, error } = await (this.supabase as any)\n      .from('webhooks')\n      .select('*')\n      .eq('organization_id', organizationId)\n      .order('created_at', { ascending: false })\n\n    if (error) throw error\n    return data\n  }\n\n  async updateWebhook(webhookId: string, updates: any) {\n    const { data, error } = await (this.supabase as any)\n      .from('webhooks')\n      .update(updates)\n      .eq('id', webhookId)\n      .select()\n      .single()\n\n    if (error) throw error\n    return data\n  }\n\n  async deleteWebhook(webhookId: string) {\n    const { error } = await (this.supabase as any)\n      .from('webhooks')\n      .delete()\n      .eq('id', webhookId)\n\n    if (error) throw error\n  }\n\n  /**\n   * Déclenche un webhook\n   */\n  async triggerWebhook(webhookId: string, eventType: string, eventData: Record<string, unknown>) {\n    const { data: webhook } = await (this.supabase as any)\n      .from('webhooks')\n      .select('*')\n      .eq('id', webhookId)\n      .eq('is_active', true)\n      .single()\n\n    if (!webhook) throw new Error('Webhook non trouvé ou inactif')\n\n    // Vérifier si l'événement est dans la liste\n    if (!webhook.events.includes(eventType)) {\n      return null\n    }\n\n    // Créer une livraison\n    const { data: delivery, error: deliveryError } = await (this.supabase as any)\n      .from('webhook_deliveries')\n      .insert({\n        webhook_id: webhookId,\n        event_type: eventType,\n        event_data: eventData,\n        status: 'pending',\n      })\n      .select()\n      .single()\n\n    if (deliveryError) throw deliveryError\n\n    // Envoyer le webhook (sera fait par un worker/cron)\n    // Pour l'instant, on retourne juste la livraison\n\n    return delivery\n  }\n\n  /**\n   * Envoie un webhook (appelé par un worker)\n   */\n  async sendWebhook(deliveryId: string) {\n    const { data: delivery } = await (this.supabase as any)\n      .from('webhook_deliveries')\n      .select('*, webhook:webhooks(*)')\n      .eq('id', deliveryId)\n      .single()\n\n    if (!delivery || !delivery.webhook) throw new Error('Livraison non trouvée')\n\n    const webhook = delivery.webhook as { url: string; secret?: string; [key: string]: unknown }\n\n    // Signer le payload\n    const payload = JSON.stringify({\n      event: delivery.event_type,\n      data: delivery.event_data,\n      timestamp: new Date().toISOString(),\n    })\n\n    const secret = (webhook.secret as string) || ''\n    const signature = crypto\n      .createHmac('sha256', secret)\n      .update(payload)\n      .digest('hex')\n\n    try {\n      const response = await fetch(webhook.url, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-Webhook-Signature': signature,\n          'X-Webhook-Event': delivery.event_type,\n        },\n        body: payload,\n        signal: AbortSignal.timeout(((webhook.timeout_seconds as number) || 30) * 1000),\n      })\n\n      const responseBody = await response.text()\n\n      // Mettre à jour la livraison\n      await (this.supabase as any)\n        .from('webhook_deliveries')\n        .update({\n          status: response.ok ? 'success' : 'failed',\n          response_status_code: response.status,\n          response_body: responseBody,\n          delivered_at: new Date().toISOString(),\n        })\n        .eq('id', deliveryId)\n\n      // Mettre à jour les statistiques du webhook\n      await (this.supabase as any)\n        .from('webhooks')\n        .update({\n          success_count: response.ok ? ((webhook.success_count as number) || 0) + 1 : (webhook.success_count as number) || 0,\n          failure_count: response.ok ? (webhook.failure_count as number) || 0 : ((webhook.failure_count as number) || 0) + 1,\n          last_triggered_at: new Date().toISOString(),\n        })\n        .eq('id', webhook.id)\n\n      return { success: response.ok, status: response.status }\n    } catch (error: unknown) {\n      const errorMessage = error instanceof Error ? error.message : 'Erreur inconnue'\n      // Mettre à jour la livraison avec l'erreur\n      await (this.supabase as any)\n        .from('webhook_deliveries')\n        .update({\n          status: 'failed',\n          error_message: errorMessage,\n          attempt_number: delivery.attempt_number + 1,\n          next_retry_at:\n            delivery.attempt_number < delivery.max_attempts\n              ? new Date(Date.now() + 5 * 60 * 1000).toISOString() // Retry dans 5 minutes\n              : null,\n        })\n        .eq('id', deliveryId)\n\n      throw error\n    }\n  }\n\n  async getWebhookDeliveries(webhookId: string) {\n    const { data, error } = await (this.supabase as any)\n      .from('webhook_deliveries')\n      .select('*')\n      .eq('webhook_id', webhookId)\n      .order('created_at', { ascending: false })\n      .limit(100)\n\n    if (error) throw error\n    return data\n  }\n}\n\nexport const apiService = new APIService()\n"],"names":[],"mappings":"0DAEA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QCJA,EAAA,EAAA,CAAA,CAAA,QAEA,EAAA,EAAA,CAAA,CAAA,QAilBO,IAAM,EAAa,IAAI,AAxkBvB,MAAM,AACH,QAAkC,AAG1C,aAAY,CAAyC,CAAE,CAErD,IAAI,CAAC,QAAQ,CAAG,GAAkB,CAAA,EAAA,EAAA,YAAA,AAAY,GAEhD,CAOA,gBAAgE,CAC9D,IAAM,EAAM,CAAC,KAAK,EAAE,EAAA,OAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC,OAAA,CAAQ,CACtD,EAAO,EAAA,OAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,GAAK,MAAM,CAAC,OACtD,EAAS,EAAI,SAAS,CAAC,EAAG,IAAM,MACtC,MAAO,KAAE,OAAK,EAAM,QAAO,CAC7B,CAKA,MAAM,aAAa,CAAc,CAA0B,CACzD,IAAM,EAAO,EAAA,OAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,GAAQ,MAAM,CAAC,OACzD,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACzC,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAY,GACf,EAAE,CAAC,aAAa,GAChB,WAAW,GAEd,GAAI,EAAO,MAAM,EACjB,OAAO,CACT,CAKA,MAAM,aACJ,CAAsB,CACtB,CAAc,CACd,CAAY,CACZ,CASC,CACD,CACA,GAAM,KAAE,CAAG,MAAE,CAAI,CAAE,QAAM,CAAE,CAAG,IAAI,CAAC,cAAc,EAGjD,OAAM,IAAI,CAAC,iBAAiB,CAAC,GAE7B,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACzC,IAAI,CAAC,YACL,MAAM,CAAC,CACN,gBAAiB,EACjB,QAAS,OACT,EACA,SAAU,EACV,WAAY,EACZ,YAAa,GAAS,YACtB,OAAQ,GAAS,QAAU,EAAE,CAC7B,YAAa,GAAS,YAAc,EAAE,CACtC,gBAAiB,GAAS,gBAAkB,EAAE,CAC9C,sBAAuB,GAAS,oBAAsB,GACtD,oBAAqB,GAAS,kBAAoB,IAClD,mBAAoB,GAAS,iBAAmB,IAChD,WAAY,GAAS,WAAW,aAClC,GACC,MAAM,GACN,MAAM,GAET,GAAI,EAAO,MAAM,EAGjB,MAAO,CAAE,GAAG,CAAI,KAAE,CAAI,CACxB,CAKA,MAAM,WAAW,CAAsB,CAAE,CACvC,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACzC,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,kBAAmB,GACtB,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE1C,GAAI,EAAO,MAAM,EACjB,OAAO,CACT,CAKA,MAAM,aAAa,CAAa,CAAE,CAAY,CAAE,CAC9C,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACzC,IAAI,CAAC,YACL,MAAM,CAAC,GACP,EAAE,CAAC,KAAM,GACT,MAAM,GACN,MAAM,GAET,GAAI,EAAO,MAAM,EACjB,OAAO,CACT,CAKA,MAAM,aAAa,CAAa,CAAE,CAChC,OAAO,IAAI,CAAC,YAAY,CAAC,EAAO,CAAE,WAAW,CAAM,EACrD,CAKA,MAAM,aAAa,CAAa,CAAE,CAChC,GAAM,OAAE,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACnC,IAAI,CAAC,YACL,MAAM,GACN,EAAE,CAAC,KAAM,GAEZ,GAAI,EAAO,MAAM,CACnB,CAOA,MAAM,eACJ,CAAc,CACd,CAAsB,CAC2C,CAEjE,IAAM,EAAY,MAAM,IAAI,CAAC,iBAAiB,CAAC,EAAO,EAAE,EACxD,GAAI,CAAC,EAAU,OAAO,CACpB,CADsB,MACf,EAIT,IAAM,EAAc,MAAM,IAAI,CAAC,mBAAmB,CAAC,UACnD,AAAK,EAAY,EAAb,KAAoB,CAIjB,CAAE,AAJiB,SAIR,EAAM,UAAW,KAAK,GAAG,CAAC,EAAU,SAAS,CAAE,EAAY,SAAS,EAAG,QAAS,EAAY,OAAO,AAAC,EAH7G,CAIX,CAEA,MAAc,kBACZ,CAAa,CACoD,CACjE,GAAM,CAAE,KAAM,CAAG,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACvC,IAAI,CAAC,YACL,MAAM,CAAC,kEACP,EAAE,CAAC,KAAM,GACT,MAAM,GAET,GAAI,CAAC,EACH,GADQ,GACD,CAAE,SAAS,EAAO,UAAW,EAAG,QAAS,IAAI,IAAO,EAG7D,IAAM,EAAM,IAAI,KACV,EAAe,IAAI,KAAK,EAAI,OAAO,GAAK,KAAK,AAC7C,EAAa,IAAI,KAAK,EAAI,OAAO,GAAK,KAAK,CAC3C,EAAY,EADoC,EAChC,KAAK,EAAI,OAAO,GAAK,KAAK,EAG1C,CAAE,EAH6C,IAGtC,CAH2C,AAGhC,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CAChD,IAAI,CAAC,gBACL,MAAM,CAAC,IAAK,CAAE,MAAO,QAAS,MAAM,CAAK,GACzC,EAAE,CAAC,aAAc,GACjB,GAAG,CAAC,aAAc,EAAa,WAAW,IAEvC,CAAE,MAAO,CAAS,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CAC9C,IAAI,CAAC,gBACL,MAAM,CAAC,IAAK,CAAE,MAAO,QAAS,KAAM,EAAK,GACzC,EAAE,CAAC,aAAc,GACjB,GAAG,CAAC,aAAc,EAAW,WAAW,IAErC,CAAE,MAAO,CAAQ,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CAC7C,IAAI,CAAC,gBACL,MAAM,CAAC,IAAK,CAAE,MAAO,QAAS,MAAM,CAAK,GACzC,EAAE,CAAC,aAAc,GACjB,GAAG,CAAC,aAAc,EAAU,WAAW,WAG1C,AAAI,GAAe,IAAgB,EAAI,SAAL,YAA0B,EAAI,EAAA,CAAE,CACzD,CAAE,CAD0D,QACjD,EAAO,UAAW,EAAG,QAAS,IAAI,KAAK,EAAI,OAAO,GAAK,IAAW,CAAN,CAG5E,GAAa,IAAc,EAAI,OAAL,YAAwB,EAAI,GAAA,CAAI,CACrD,CAAE,CADsD,QAC7C,EAAO,UAAW,EAAG,QAAS,IAAI,KAAK,EAAI,OAAO,GAAK,KAAgB,AAAX,EAG5E,GAHiF,AAGrE,IAAa,EAAI,MAAL,YAAuB,EAAI,GAAA,CAAK,CACnD,CAAE,CADoD,QAC3C,EAAO,UAAW,EAAG,QAAS,IAAI,KAAK,EAAI,OAAO,GAAK,KAAK,CAAgB,EASzF,CAAE,CAT4E,KAAK,GASxE,EAAM,UANN,KAAK,GAAG,CACxB,CAAC,EAAI,qBAAqB,EAAI,EAAA,CAAE,EAAK,EAAD,EAAgB,CAAC,CACrD,CAAC,EAAI,mBAAmB,EAAI,GAAA,CAAI,EAAK,EAAD,CAAc,CAAC,EACnD,CAAC,EAAI,kBAAkB,EAAI,GAAA,CAAK,EAAK,EAAD,EAAa,CAAC,EAGjB,QAAS,IAAI,KAAK,EAAI,OAAO,GAAK,IAAW,CAAN,AAC5E,CAEA,MAAc,oBACZ,CAAsB,CAC2C,CACjE,GAAM,CAAE,KAAM,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACzC,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,kBAAmB,GACtB,MAAM,UAET,AAAK,EAOD,EAPA,AAOM,GAPE,iBAOkB,GAAK,CAAD,CAAO,mBAAmB,EAAI,EAAA,CAAE,EAI9D,CAJiE,CAI3D,kBAAkB,EAAK,EAAD,CAAO,iBAAiB,EAAI,GAAA,CAAI,EAI5D,CAJ+D,CAIzD,iBAAiB,GAAK,CAAD,CAAO,gBAAgB,EAAI,GAAA,CAAK,CAPtD,CAAE,CAOuD,QAP9C,EAAO,UAAW,EAAG,QAAS,IAAI,IAAO,EAiBtD,CAAE,SAAS,EAAM,UANN,KAAK,GAAG,CACxB,CAAC,EAAM,mBAAmB,EAAI,EAAA,CAAE,CAAI,EAAM,oBAAoB,CAC9D,CAAC,EAAM,iBAAiB,EAAI,GAAA,CAAI,CAAI,EAAM,kBAAkB,CAC5D,CAAC,EAAM,gBAAgB,EAAI,GAAA,CAAK,CAAI,EAAM,iBAAiB,EAG1B,QAAS,IAAI,IAAO,GAvBrD,MAAM,IAAI,CAAC,iBAAiB,CAAC,GACtB,CAAE,QAAS,GAAM,UAAW,IAAO,QAAS,IAAI,IAAO,EAuBlE,CAKA,MAAM,cACJ,CAAuB,CACvB,CAA6B,CAC7B,CAAc,CACd,CAAgB,CAChB,CAAY,CACZ,CAAkB,CAClB,CAAsB,CACtB,CAAkB,CAClB,CAAkB,CAClB,CAAuD,CACvD,CACA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACzC,IAAI,CAAC,gBACL,MAAM,CAAC,CACN,WAAY,EACZ,gBAAiB,SACjB,EACA,WACA,OACA,YAAa,EACb,iBAAkB,EAClB,WAAY,EACZ,WAAY,EACZ,aAAc,CAChB,GACC,MAAM,GACN,MAAM,GAET,GAAI,EAAO,MAAM,EACjB,OAAO,CACT,CAKA,MAAM,iBAAiB,CAAsB,CAAE,CAAgB,CAAE,CAAc,CAAE,CAC/E,IAAI,EAAS,IAAI,CAAC,QAAQ,CACvB,IAAI,CAAC,gBACL,MAAM,CAAC,mDACP,EAAE,CAAC,kBAAmB,GAErB,IACF,EAAQ,EAAM,GAAG,AADJ,CACK,aAAc,EAAU,WAAW,GAAA,EAGnD,IACF,EAAQ,EAAM,CADH,EACM,CAAC,aAAc,EAAQ,WAAW,GAAA,EAGrD,GAAM,CAAE,MAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAE9B,GAAI,EAAO,MAAM,EAEjB,IAAM,EAAQ,CACZ,eAAgB,GAAM,QAAU,EAChC,UAAW,CAAC,EACZ,YAAa,CAAC,EACd,UAAW,CAAC,EACZ,sBAAuB,EACvB,WAAY,CACd,EAEA,GAAI,GAAQ,EAAK,MAAM,CAAG,EAAG,CAC3B,IAAI,EAAoB,EACpB,EAAa,EAEjB,EAAK,OAAO,CAAC,AAAC,IAEZ,EAAM,SAAS,CAAC,EAAI,MAAM,CAAC,CAAG,CAAC,EAAM,SAAS,CAAC,EAAI,MAAM,CAAC,GAAI,CAAC,CAAI,EAGnE,IAAM,EAAW,EAAI,QAAQ,CAC7B,EAAM,WAAW,CAAC,EAAS,CAAG,CAAC,EAAM,WAAW,CAAC,EAAS,GAAI,CAAC,CAAI,EAGnE,IAAM,EAAc,EAAI,WAAW,EAAe,EAC5C,EAA6C,IAA/B,KAAK,KAAK,CAAC,EAAa,KAC5C,EAAM,SAAS,CAAC,EAAY,CAAG,CAAC,EAAM,SAAS,CAAC,EAAY,GAAI,CAAC,CAAI,EAGrE,IAAM,EAAgB,EAAI,gBAAgB,EAAe,EACrD,IACF,GAAqB,CAAA,EAInB,GAAc,CALA,IAKK,AACrB,GAEJ,GAEA,EAAM,qBAAqB,CAAG,EAAoB,EAAK,MAAM,CAC7D,EAAM,UAAU,CAAI,EAAa,EAAK,MAAM,CAAI,GAClD,CAEA,OAAO,CACT,CAIA,MAAM,kBAAkB,CAAsB,CAAE,CAC9C,GAAM,CAAE,KAAM,CAAQ,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CAC5C,IAAI,CAAC,cACL,MAAM,CAAC,MACP,EAAE,CAAC,kBAAmB,GACtB,WAAW,GAEd,GAAI,CAAC,EAAU,CACb,GAAM,OAAE,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACnC,IAAI,CAAC,cACL,MAAM,CAAC,CACN,gBAAiB,CACnB,GAEF,GAAI,EAAO,MAAM,CACnB,CACF,CAEA,MAAM,SAAS,CAAsB,CAAE,CACrC,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACzC,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,kBAAmB,GACtB,MAAM,GAET,GAAI,EAAO,MAAM,EACjB,OAAO,CACT,CAEA,MAAM,YAAY,CAAsB,CAAE,CAAY,CAAE,CACtD,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACzC,IAAI,CAAC,cACL,MAAM,CAAC,GACP,EAAE,CAAC,kBAAmB,GACtB,MAAM,GACN,MAAM,GAET,GAAI,EAAO,MAAM,EACjB,OAAO,CACT,CAIA,MAAM,cAAc,CAAY,CAAE,CAEhC,IAAM,EAAS,EAAA,OAAM,CAAC,WAAW,CAAC,IAAI,QAAQ,CAAC,OACzC,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACzC,IAAI,CAAC,YACL,MAAM,CAAC,CACN,GAAG,CAAO,QACV,CACF,GACC,MAAM,GACN,MAAM,GAET,GAAI,EAAO,MAAM,EACjB,MAAO,CAAE,GAAG,CAAI,QAAE,CAAO,CAC3B,CAD6B,AAG7B,MAAM,YAAY,CAAsB,CAAE,CACxC,GAAM,MAAE,CAAI,CAAE,OAAK,CAAE,CAAG,KAJiD,CAI1C,IAAI,CAAC,QAAQ,CACzC,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,kBAAmB,GACtB,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAE1C,GAAI,EAAO,MAAM,EACjB,OAAO,CACT,CAEA,MAAM,cAAc,CAAiB,CAAE,CAAY,CAAE,CACnD,GAAM,CAAE,MAAI,CAAE,OAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACzC,IAAI,CAAC,YACL,MAAM,CAAC,GACP,EAAE,CAAC,KAAM,GACT,MAAM,GACN,MAAM,GAET,GAAI,EAAO,MAAM,EACjB,OAAO,CACT,CAEA,MAAM,cAAc,CAAiB,CAAE,CACrC,GAAM,OAAE,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACnC,IAAI,CAAC,YACL,MAAM,GACN,EAAE,CAAC,KAAM,GAEZ,GAAI,EAAO,MAAM,CACnB,CAKA,MAAM,eAAe,CAAiB,CAAE,CAAiB,CAAE,CAAkC,CAAE,CAC7F,GAAM,CAAE,KAAM,CAAO,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CAC3C,IAAI,CAAC,YACL,MAAM,CAAC,KACP,EAAE,CAAC,KAAM,GACT,EAAE,CAAC,aAAa,GAChB,MAAM,GAET,GAAI,CAAC,EAAS,MAAU,AAAJ,MAAU,iCAG9B,GAAI,CAAC,EAAQ,MAAM,CAAC,QAAQ,CAAC,GAC3B,OAAO,EADgC,GAKzC,GAAM,CAAE,KAAM,CAAQ,CAAE,MAAO,CAAa,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CAClE,IAAI,CAAC,sBACL,MAAM,CAAC,CACN,WAAY,EACZ,WAAY,EACZ,WAAY,EACZ,OAAQ,SACV,GACC,MAAM,GACN,MAAM,GAET,GAAI,EAAe,MAAM,EAKzB,OAAO,CACT,CAKA,MAAM,YAAY,CAAkB,CAAE,CACpC,GAAM,CAAE,KAAM,CAAQ,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CAC5C,IAAI,CAAC,sBACL,MAAM,CAAC,0BACP,EAAE,CAAC,KAAM,GACT,MAAM,GAET,GAAI,CAAC,GAAY,CAAC,EAAS,OAAO,CAAE,MAAM,AAAI,MAAM,yBAEpD,IAAM,EAAU,EAAS,OAAO,CAG1B,EAAU,KAAK,SAAS,CAAC,CAC7B,MAAO,EAAS,UAAU,CAC1B,KAAM,EAAS,UAAU,CACzB,UAAW,IAAI,OAAO,WAAW,EACnC,GAEM,EAAU,EAAQ,MAAM,EAAe,GACvC,EAAY,EAAA,OAAM,CACrB,UAAU,CAAC,SAAU,GACrB,MAAM,CAAC,GACP,MAAM,CAAC,OAEV,GAAI,CACF,IAAM,EAAW,MAAM,MAAM,EAAQ,GAAG,CAAE,CACxC,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,sBAAuB,EACvB,kBAAmB,EAAS,UAAU,AACxC,EACA,KAAM,EACN,OAAQ,YAAY,OAAO,CAAC,AAA8C,IAA5C,GAAQ,eAAe,EAAe,EAAA,CAAE,CACxE,GAEM,EAAe,MAAM,EAAS,IAAI,GAuBxC,OApBA,MAAO,IAAI,CAAC,QAAQ,CACjB,IAAI,CAAC,sBACL,MAAM,CAAC,CACN,OAAQ,EAAS,EAAE,CAAG,UAAY,SAClC,qBAAsB,EAAS,MAAM,CACrC,cAAe,EACf,aAAc,IAAI,OAAO,WAAW,EACtC,GACC,EAAE,CAAC,KAAM,GAGZ,MAAO,IAAI,CAAC,QAAQ,CACjB,IAAI,CAAC,YACL,MAAM,CAAC,CACN,cAAe,EAAS,EAAE,CAAG,CAAE,EAAQ,aAAa,GAAe,CAAC,CAAI,EAAK,EAAQ,aAAa,EAAe,EACjH,cAAe,EAAS,EAAE,CAAI,EAAQ,aAAa,EAAe,EAAM,AAAF,GAAU,aAAa,EAAe,CAAC,EAAI,EACjH,kBAAmB,IAAI,OAAO,WAAW,EAC3C,GACC,EAAE,CAAC,KAAM,EAAQ,EAAE,EAEf,CAAE,QAAS,EAAS,EAAE,CAAE,OAAQ,EAAS,MAAM,AAAC,CACzD,CAAE,MAAO,EAAgB,CACvB,IAAM,EAAe,aAAiB,MAAQ,EAAM,OAAO,CAAG,iBAe9D,OAbA,MAAO,IAAI,CAAC,QAAQ,CACjB,IAAI,CAAC,sBACL,MAAM,CAAC,CACN,OAAQ,SACR,cAAe,EACf,eAAgB,EAAS,cAAc,CAAG,EAC1C,cACE,EAAS,cAAc,CAAG,EAAS,YAAY,CAC3C,IAAI,KAAK,KAAK,GAAG,GAAK,IAAI,CAAW,IAAN,OAAiB,GAAG,AACnD,IACR,GACC,EAAE,CAAC,KAAM,GAEN,CACR,CACF,CAEA,EATwF,IASlF,qBAAqB,CAAiB,CAAE,CAC5C,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAO,IAAI,CAAC,QAAQ,CACzC,IAAI,CAAC,sBACL,MAAM,CAAC,KACP,EAAE,CAAC,aAAc,GACjB,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GACvC,KAAK,CAAC,KAET,GAAI,EAAO,MAAM,EACjB,OAAO,CACT,CACF,ED3kBA,IAAA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAQA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAAA,EAAA,EAAA,CAAA,CAAA,QAaA,EAAA,EAAA,CAAA,CAAA,QACA,EAAA,EAAA,CAAA,CAAA,QAEe,SAAS,IACtB,GAAM,MAAE,CAAI,CAAE,CAAG,CAAA,EAAA,EAAA,OAAA,AAAO,IAClB,EAAc,CAAA,EAAA,EAAA,cAAA,AAAc,IAC5B,UAAE,CAAQ,CAAE,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,IACf,EAAQ,AAAC,IACb,EAAS,CACP,MAAO,EAAQ,KAAK,CACpB,YAAa,EAAQ,WAAW,CAChC,KAAM,EAAQ,IAAI,EAAI,EAAQ,OAAO,EAAI,SAC3C,EACF,EACM,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACvC,CAAC,EAAmB,EAAqB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACrD,CAAC,EAAc,EAAgB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAW,EAAE,EACvD,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MACtD,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAGjC,CAAE,KAAM,CAAO,CAAE,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CACjC,SAAU,CAAC,WAAY,GAAM,gBAAgB,CAC7C,QAAS,IAAM,EAAW,UAAU,CAAC,GAAM,iBAAmB,IAC9D,QAAS,CAAC,CAAC,GAAM,eACnB,GAGM,CAAE,KAAM,CAAQ,CAAE,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CAClC,SAAU,CAAC,WAAY,GAAM,gBAAgB,CAC7C,QAAS,IAAM,EAAW,WAAW,CAAC,GAAM,iBAAmB,IAC/D,QAAS,CAAC,CAAC,GAAM,eACnB,GAGM,CAAE,KAAM,CAAK,CAAE,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CAC/B,SAAU,CAAC,YAAa,GAAM,gBAAgB,CAC9C,QAAS,IAAM,EAAW,QAAQ,CAAC,GAAM,iBAAmB,IAC5D,QAAS,CAAC,CAAC,GAAM,eACnB,GAGM,EAAoB,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,CACpC,WAAY,IACV,EAAW,YAAY,CAAC,GAAM,iBAAmB,GAAI,GAAM,IAAM,GAAI,EAAY,CAC/E,YAAa,EACb,OAAQ,CACV,GACF,UAAW,AAAC,IACV,EAAc,EAAK,GAAG,EACtB,EAAY,iBAAiB,CAAC,CAAE,SAAU,CAAC,WAAW,AAAC,GACvD,EAAc,IACd,EAAqB,IACrB,EAAgB,EAAE,EAClB,EAAM,CACJ,MAAO,gBACP,YAAa,0FACf,EACF,CACF,GAGM,EAAoB,CAAA,EAAA,EAAA,WAAA,AAAW,EAAC,CACpC,WAAY,AAAC,GAAkB,EAAW,YAAY,CAAC,GACvD,UAAW,KACT,EAAY,iBAAiB,CAAC,CAAE,SAAU,CAAC,WAAW,AAAC,GACvD,EAAM,CACJ,MAAO,mBACP,YAAa,wCACf,EACF,CACF,GAEM,EAAkB,AAAC,IACvB,UAAU,SAAS,CAAC,SAAS,CAAC,GAC9B,EAAM,CACJ,MAAO,QACP,YAAa,iDACf,EACF,EAEM,EAAS,CACb,CAAE,MAAO,gBAAiB,MAAO,oBAAqB,EACtD,CAAE,MAAO,iBAAkB,MAAO,8BAA+B,EACjE,CAAE,MAAO,iBAAkB,MAAO,oBAAqB,EACvD,CAAE,MAAO,kBAAmB,MAAO,8BAA+B,EAClE,CAAE,MAAO,gBAAiB,MAAO,oBAAqB,EACtD,CAAE,MAAO,iBAAkB,MAAO,8BAA+B,EACjE,CAAE,MAAO,IAAK,MAAO,gBAAiB,EACvC,CAED,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iBACb,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,CAAG,UAAU,4DACZ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,GAAG,CAAA,CAAC,UAAU,YAAY,sBAG7B,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAwB,iFAKvC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,CAAC,aAAa,OAAO,UAAU,sBAClC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,QAAQ,CAAA,WACP,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,MAAM,gBAAO,aAC1B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,MAAM,oBAAW,aAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,MAAM,iBAAQ,WAC3B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,MAAM,gBAAO,qBAI5B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,MAAM,gBACjB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,kCAAyB,aACvC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAwB,iEAIvC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,MAAM,CAAA,WACL,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,aAAa,CAAA,CAAC,OAAO,CAAA,CAAA,WACpB,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,MAAM,CAAA,WACL,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,iBAAiB,wBAIrC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,aAAa,CAAA,WACZ,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,YAAY,CAAA,WACX,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,UAAC,+BACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,iBAAiB,CAAA,UAAC,mGAKrB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,QAAQ,oBAAW,QAC1B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CACJ,GAAG,WACH,MAAO,EACP,SAAU,AAAC,GAAM,EAAc,EAAE,MAAM,CAAC,KAAK,EAC7C,YAAY,uCAGhB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,QAAQ,2BAAkB,gBACjC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CACP,GAAG,kBACH,MAAO,EACP,SAAU,AAAC,GAAM,EAAqB,EAAE,MAAM,CAAC,KAAK,EACpD,YAAY,iDAGhB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,UAAC,yBACP,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,0BACZ,EAAO,GAAG,CAAC,AAAC,GACX,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,CAAwB,UAAU,wCACjC,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,KAAK,WACL,QAAS,EAAa,QAAQ,CAAC,EAAM,KAAK,EAC1C,SAAW,AAAD,IACJ,EAAE,MAAM,CAAC,OAAO,CAClB,CADoB,CACJ,IAAI,EAAc,EAAM,KAAK,CAAC,EAE9C,EAAgB,EAAa,MAAM,CAAC,AAAC,GAAM,IAAM,EAAM,KAAK,EAEhE,IAEF,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,mBAAW,EAAM,KAAK,KAZ5B,EAAM,KAAK,QAiB7B,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,QAAS,IAAM,EAAkB,MAAM,GACvC,SAAU,CAAC,GAAc,EAAkB,SAAS,CACpD,UAAU,kBACX,8BAQN,GACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,KAAM,CAAC,CAAC,EAAY,aAAc,IAAM,EAAc,eAC5D,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,aAAa,CAAA,WACZ,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,YAAY,CAAA,WACX,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,UAAC,kBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,iBAAiB,CAAA,UAAC,oGAKrB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CACJ,MAAO,EACP,QAAQ,CAAA,CAAA,EACR,KAAM,EAAU,OAAS,WACzB,UAAU,cAEZ,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,QAAQ,UACR,KAAK,OACL,QAAS,IAAM,EAAW,CAAC,YAE1B,EAAU,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,UAAU,YAAe,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,GAAG,CAAA,CAAC,UAAU,cAE7D,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,QAAQ,UAAU,KAAK,OAAO,QAAS,IAAM,EAAgB,YACnE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,iBAGpB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wFACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,iDACvB,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,oCACX,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,UAAO,gBAAoB,0HAWzC,GAAW,EAAQ,MAAM,CAAG,EAC3B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBACZ,EAAQ,GAAG,CAAC,AAAC,GACZ,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,WACH,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,UACT,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,6CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,mBAAW,EAAI,IAAI,GACvC,EAAI,WAAW,EACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,CAAC,UAAU,gBAAQ,EAAI,WAAW,MAGtD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,mCACZ,EAAI,SAAS,CACZ,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,2DACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,YAAY,YAIrC,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,0DACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,UAAU,YAAY,qBAOvC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,UACV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,mDACb,EAAI,UAAU,GAEjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACL,QAAQ,QACR,KAAK,KACL,QAAS,IAAM,EAAgB,EAAI,UAAU,WAE7C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,iBAGpB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0DACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCAAwB,aACxC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,uBAAe,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAI,UAAU,OAEtD,EAAI,YAAY,EACf,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCAAwB,yBACxC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,uBAAe,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAI,YAAY,OAG3D,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCAAwB,aACxC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,uBAAe,EAAI,aAAa,EAAI,OAElD,EAAI,UAAU,EACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCAAwB,cACxC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,uBAAe,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAI,UAAU,UAI1D,EAAI,MAAM,EAAI,EAAI,MAAM,CAAC,MAAM,CAAG,GACjC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,yCAAgC,kBAChD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qCACZ,EAAI,MAAM,CAAC,GAAG,CAAC,AAAC,GACf,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAEC,UAAU,+DAET,EAAO,IAAI,CAAC,AAAC,GAAM,EAAE,KAAK,GAAK,IAAQ,OAAS,GAH5C,SASf,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,iDACZ,EAAI,SAAS,EACZ,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,MAAM,CAAA,CACL,QAAQ,cACR,KAAK,KACL,QAAS,IAAM,EAAkB,MAAM,CAAC,EAAI,EAAE,YAE9C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CAAC,UAAU,iBAAiB,uBAlFpC,EAAI,EAAE,KA6FrB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,UACH,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,kDAAyC,yEASxE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,MAAM,oBACjB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,kCAAyB,aACvC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAwB,4EAIvC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,MAAM,CAAA,WACL,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,CAAC,UAAU,iBAAiB,wBAKpC,GAAY,EAAS,MAAM,CAAG,EAC7B,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBACZ,EAAS,GAAG,CAAC,AAAC,GACb,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,WACH,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,UACT,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,6CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,CAAC,UAAU,mBAAW,EAAQ,IAAI,GAC5C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,CAAC,UAAU,kCACxB,EAAQ,GAAG,MAGf,EAAQ,SAAS,CAChB,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,2DACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,YAAY,WAIrC,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,0DACd,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,UAAU,YAAY,kBAMrC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,UACV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACZ,EAAQ,MAAM,EAAI,EAAQ,MAAM,CAAC,MAAM,CAAG,GACzC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,yCAAgC,iBAChD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qCACZ,EAAQ,MAAM,CAAC,GAAG,CAAC,AAAC,GACnB,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAEC,UAAU,mEAET,GAHI,SASf,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0DACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCAAwB,WACxC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,uBAAe,EAAQ,aAAa,EAAI,OAEvD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCAAwB,WACxC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,uBAAe,EAAQ,aAAa,EAAI,OAEtD,EAAQ,iBAAiB,EACxB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCAAwB,0BACxC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,uBAAe,CAAA,EAAA,EAAA,UAAA,AAAU,EAAC,EAAQ,iBAAiB,iBAnDjE,EAAQ,EAAE,KA6DzB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,UACH,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,UAAU,kDAAyC,iFASxE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,MAAM,iBACjB,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,WACH,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,UAAU,CAAA,WACT,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UAAC,eACX,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,8DAInB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,UACT,EACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,qBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,kDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,+BAAsB,eACtC,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,0CACZ,EAAc,oBAAoB,EAAI,EAAE,MAAK,EAAc,mBAAmB,EAAI,SAGxF,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,+CACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,UAAU,6CACV,MAAO,CACL,MAAO,CAAA,EACJ,CAAE,EAAc,oBAAoB,EAAI,CAAC,EAAM,EAAF,CAAgB,mBAAmB,EAAI,EAAA,CAAE,CACvF,IACD,CAAC,CAAC,AACL,SAIN,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,+BAAsB,cACtC,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,0CACZ,EAAc,kBAAkB,EAAI,EAAE,MAAK,EAAc,iBAAiB,EAAI,UAGpF,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,+CACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,UAAU,6CACV,MAAO,CACL,MAAO,CAAA,EACJ,CAAE,EAAc,kBAAkB,GAAI,CAAC,EAAM,EAAF,AAAgB,iBAAiB,EAAI,GAAA,CAAI,CACrF,IACD,CAAC,CAAC,AACL,SAIN,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,+BAAsB,aACtC,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,0CACZ,EAAc,iBAAiB,EAAI,EAAE,MAAK,EAAc,gBAAgB,EAAI,UAGlF,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,+CACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,UAAU,6CACV,MAAO,CACL,MAAO,CAAA,EACJ,CAAE,EAAc,iBAAiB,GAAI,CAAC,EAAM,EAAF,AAAgB,gBAAgB,EAAI,GAAA,CAAK,CACpF,IACD,CAAC,CACJ,AADK,SAKX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,+BAAsB,aACtC,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,0CACZ,EAAc,mBAAmB,EAAI,EAAE,MAAK,EAAc,kBAAkB,EAAI,UAGtF,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,+CACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CACC,UAAU,6CACV,MAAO,CACL,MAAO,CAAA,EACJ,CAAE,EAAc,mBAAmB,GAAI,CAAC,EACrC,EAAF,AAAgB,kBAAkB,EAAI,GAAA,CAAM,CAC9C,IACD,CAAC,CAAC,AACL,cAOV,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,6CAAoC,oCAS3D,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,CAAC,MAAM,gBACjB,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,WACH,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,UAAU,CAAA,WACT,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,SAAS,CAAA,UAAC,sBACX,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,UAAC,6DAInB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,WAAW,CAAA,UACV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAwB,oFAGrC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACb,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,kDACb,wBAA2D,IAAxB,cAEtC,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,MAAM,CAAA,CACL,QAAQ,UACR,KAAK,KACL,QAAS,IACP,OAAO,IAAI,CAAC,GAAG,iCAA0E,oBAG3F,CAAA,EAAA,EAAA,GAHoD,AAGpD,EAAC,EAAA,YAAY,CAAA,CAAC,MAH8D,IAGpD,QAHgE,CAAC,QAGhD,eAI7C,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,6DACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,8BAAqB,yBACnC,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,CAAG,UAAU,6EACZ,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,UAAG,gDACJ,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,WAAG,qCAAkC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,cAAgB,sBAC5D,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,UAAG,wEACJ,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,UAAG,4EAUxB"}