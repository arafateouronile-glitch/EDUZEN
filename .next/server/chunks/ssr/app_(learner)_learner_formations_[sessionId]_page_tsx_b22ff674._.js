module.exports=[622554,a=>{"use strict";var b=a.i(187924),c=a.i(433217),d=a.i(572131),e=a.i(323625),f=a.i(913216),g=a.i(727163),h=a.i(219897),i=a.i(340695),j=a.i(254161),k=a.i(621958);a.i(460355);var l=a.i(346271),m=a.i(469769),n=a.i(941675),o=a.i(641710),p=a.i(124987),q=a.i(660246),r=a.i(104720),s=a.i(284505),t=a.i(64791),u=a.i(290821),v=a.i(400210),w=a.i(93518),x=a.i(776803),y=a.i(724669),z=a.i(992258),A=a.i(546842),B=a.i(50429),C=a.i(953722),D=a.i(238246),E=a.i(50944),F=a.i(497895),G=a.i(325383);function H(){let a=(0,E.useParams)().sessionId,{student:H,studentId:I}=(0,e.useLearnerContext)(),J=(0,d.useMemo)(()=>I?(0,g.createLearnerClient)(I):null,[I]),{user:K}=(0,f.useAuth)(),{data:L}=(0,c.useQuery)({queryKey:["learner-student",K?.id],queryFn:async()=>{try{if(!K?.id||!J)return null;let{data:a}=await J.from("students").select("*").eq("id",K.id).maybeSingle();return a}catch(a){return G.logger.warn("Exception fetching student data",{userId:K?.id?(0,G.maskId)(K.id):void 0,error:(0,G.sanitizeError)(a)}),null}},enabled:!!K?.id}),{data:M,isLoading:N}=(0,c.useQuery)({queryKey:["learner-session-detail",a],queryFn:async()=>{if(!J)return null;try{let{data:b,error:c}=await J.from("sessions").select(`
            *,
            formations(
              id,
              name,
              description,
              price
            )
          `).eq("id",a).maybeSingle();if(c){if("400"===c.code||c.message?.includes("relationship")||c.message?.includes("column")||c.message?.includes("does not exist")){let{data:b,error:c}=await J.from("sessions").select("*").eq("id",a).maybeSingle();if(c){if("PGRST116"===c.code||"PGRST301"===c.code||"42P01"===c.code)return G.logger.warn("Session not found or access denied",{sessionId:(0,G.maskId)(a),error:(0,G.sanitizeError)(c)}),null;return G.logger.warn("Error fetching session (simple)",{sessionId:(0,G.maskId)(a),error:(0,G.sanitizeError)(c)}),null}return b}if("PGRST116"===c.code||"PGRST301"===c.code||"42P01"===c.code)return G.logger.warn("Session not found or access denied",{sessionId:(0,G.maskId)(a),error:(0,G.sanitizeError)(c)}),null;return G.logger.warn("Error fetching session",{sessionId:(0,G.maskId)(a),error:(0,G.sanitizeError)(c)}),null}return b}catch(b){return G.logger.error("Unexpected error fetching session",b,{sessionId:(0,G.maskId)(a),error:(0,G.sanitizeError)(b)}),null}},enabled:!!a&&!!J}),{data:O}=(0,c.useQuery)({queryKey:["learner-session-enrollment",a,H?.id],queryFn:async()=>{if(!H?.id||!J)return null;try{let{data:b,error:c}=await J.from("enrollments").select("*").eq("session_id",a).eq("student_id",H.id).maybeSingle();if(c){if("PGRST116"===c.code||"42P01"===c.code||"PGRST301"===c.code)return null;return G.logger.warn("Error fetching enrollment",{sessionId:(0,G.maskId)(a),studentId:H?.id?(0,G.maskId)(H.id):void 0,error:(0,G.sanitizeError)(c)}),null}return b}catch(b){return G.logger.error("Unexpected error fetching enrollment",b,{sessionId:(0,G.maskId)(a),studentId:H?.id?(0,G.maskId)(H.id):void 0,error:(0,G.sanitizeError)(b)}),null}},enabled:!!a&&!!H?.id&&!!J}),{data:P}=(0,c.useQuery)({queryKey:["learner-session-documents",a,H?.id],queryFn:async()=>{if(!H?.id||!J)return[];try{let{data:b,error:c}=await J.from("generated_documents").select("*").eq("related_entity_type","session").eq("related_entity_id",a).order("created_at",{ascending:!1});if(c){let{data:b,error:d}=await J.from("documents").select("*").eq("session_id",a).eq("student_id",H.id).order("created_at",{ascending:!1});if(!d)return b||[];return G.logger.warn("Documents/generated_documents tables may not be accessible",{sessionId:(0,G.maskId)(a),studentId:H?.id?(0,G.maskId)(H.id):void 0,error:(0,G.sanitizeError)(c)}),[]}return(b||[]).filter(a=>a.student_id===H.id||a.related_entity_id===H.id||!!a.metadata&&"object"==typeof a.metadata&&(a.metadata.student_id===H.id||a.metadata.related_entity_id===H.id)||!a.student_id)}catch(b){return G.logger.error("Unexpected error fetching documents",b,{sessionId:(0,G.maskId)(a),studentId:H?.id?(0,G.maskId)(H.id):void 0,error:(0,G.sanitizeError)(b)}),[]}},enabled:!!a&&!!H?.id&&!!J}),{data:Q}=(0,c.useQuery)({queryKey:["learner-session-trainers",a],queryFn:async()=>{if(!J)return[];try{let{data:b,error:c}=await J.from("session_teachers").select("*").eq("session_id",a);if(!c&&b&&b.length>0)try{let a=b.map(a=>a.teacher_id).filter(Boolean);if(a.length>0){let{data:c}=await J.from("users").select("id, first_name, last_name, email, avatar_url").in("id",a);c&&(b=b.map(a=>({...a,users:c.find(b=>b.id===a.teacher_id)||null})))}}catch(b){G.logger.warn("Could not enrich teachers with users data",{sessionId:(0,G.maskId)(a),error:(0,G.sanitizeError)(b)})}if(c){if("PGRST116"===c.code||"42P01"===c.code||"PGRST301"===c.code||"PGRST205"===c.code||"400"===c.code||"404"===c.code||c.message?.includes("relation")||c.message?.includes("does not exist")||c.message?.includes("Could not find the table"))return G.logger.warn("Session teachers table may not exist or be accessible",{sessionId:(0,G.maskId)(a),error:(0,G.sanitizeError)(c)}),[];return G.logger.warn("Error fetching trainers",{sessionId:(0,G.maskId)(a),error:(0,G.sanitizeError)(c)}),[]}return b||[]}catch(b){return G.logger.error("Unexpected error fetching trainers",b,{sessionId:(0,G.maskId)(a),error:(0,G.sanitizeError)(b)}),[]}},enabled:!!a&&!!J}),{data:R}=(0,c.useQuery)({queryKey:["learner-session-grades",a,H?.id],queryFn:async()=>{if(!H?.id||!J)return[];try{let{data:b,error:c}=await J.from("grades").select("*").eq("session_id",a).eq("student_id",H.id).order("graded_at",{ascending:!1});if(c){if("PGRST116"===c.code||"42P01"===c.code||"PGRST301"===c.code||"400"===c.code||c.message?.includes("relation")||c.message?.includes("does not exist"))return[];return G.logger.warn("Error fetching grades",{sessionId:(0,G.maskId)(a),studentId:H?.id?(0,G.maskId)(H.id):void 0,error:(0,G.sanitizeError)(c)}),[]}return b||[]}catch(b){return G.logger.error("Unexpected error fetching grades",b,{sessionId:(0,G.maskId)(a),studentId:H?.id?(0,G.maskId)(H.id):void 0,error:(0,G.sanitizeError)(b)}),[]}},enabled:!!a&&!!H?.id&&!!J}),{data:S}=(0,c.useQuery)({queryKey:["learner-session-attendance",a,H?.id],queryFn:async()=>{if(!H?.id||!J)return[];try{let{data:b,error:c}=await J.from("attendance").select("*").eq("session_id",a).eq("student_id",H.id).order("date",{ascending:!1});if(c){if("PGRST116"===c.code||"42P01"===c.code||"PGRST301"===c.code||"400"===c.code||c.message?.includes("relation")||c.message?.includes("does not exist"))return[];return G.logger.warn("Error fetching attendance",{sessionId:(0,G.maskId)(a),studentId:H?.id?(0,G.maskId)(H.id):void 0,error:(0,G.sanitizeError)(c)}),[]}return b||[]}catch(b){return G.logger.error("Unexpected error fetching attendance",b,{sessionId:(0,G.maskId)(a),studentId:H?.id?(0,G.maskId)(H.id):void 0,error:(0,G.sanitizeError)(b)}),[]}},enabled:!!a&&!!H?.id&&!!J}),T=M?.formations,U=T?.programs,V={total:S?.length||0,present:S?.filter(a=>"present"===a.status).length||0,absent:S?.filter(a=>"absent"===a.status).length||0,late:S?.filter(a=>"late"===a.status).length||0},W=V.total>0?Math.round(V.present/V.total*100):0;return N?(0,b.jsxs)("div",{className:"space-y-6 pb-24 lg:pb-8",children:[(0,b.jsx)("div",{className:"h-12 w-48 bg-gray-100 rounded-lg animate-pulse"}),(0,b.jsx)("div",{className:"h-64 bg-gray-100 rounded-2xl animate-pulse"})]}):M?(0,b.jsxs)(l.motion.div,{className:"space-y-6 pb-24 lg:pb-8",initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)(D.default,{href:"/learner/formations",children:(0,b.jsx)(i.Button,{variant:"ghost",size:"icon",children:(0,b.jsx)(v.ArrowLeft,{className:"h-5 w-5"})})}),(0,b.jsxs)("div",{className:"flex-1",children:[U&&(0,b.jsx)("p",{className:"text-sm text-brand-blue font-medium mb-1",children:U.name}),(0,b.jsx)("h1",{className:"text-xl md:text-2xl font-bold text-gray-900",children:T?.name||M?.name||"Session"}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mt-2",children:[O&&(a=>{if(!a)return null;switch(a){case"completed":return(0,b.jsx)(j.Badge,{className:"bg-green-100 text-green-700",children:"Terminée"});case"confirmed":return(0,b.jsx)(j.Badge,{className:"bg-blue-100 text-blue-700",children:"Confirmée"});case"pending":return(0,b.jsx)(j.Badge,{className:"bg-amber-100 text-amber-700",children:"En attente"});case"cancelled":return(0,b.jsx)(j.Badge,{className:"bg-red-100 text-red-700",children:"Annulée"});default:return(0,b.jsx)(j.Badge,{variant:"secondary",children:a})}})(O.status),M?.is_remote&&(0,b.jsxs)(j.Badge,{variant:"outline",children:[(0,b.jsx)(t.Video,{className:"h-3 w-3 mr-1"}),"À distance"]})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,b.jsxs)(h.GlassCard,{className:"p-4 text-center",children:[(0,b.jsx)(n.Calendar,{className:"h-6 w-6 text-brand-blue mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Dates"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:M.start_date?(0,F.formatDate)(M.start_date):"N/A"})]}),(0,b.jsxs)(h.GlassCard,{className:"p-4 text-center",children:[(0,b.jsx)(o.Clock,{className:"h-6 w-6 text-purple-600 mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Durée"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:"Formation"})]}),(0,b.jsxs)(h.GlassCard,{className:"p-4 text-center",children:[(0,b.jsx)(y.TrendingUp,{className:"h-6 w-6 text-green-600 mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Présence"}),(0,b.jsxs)("p",{className:"font-semibold text-gray-900",children:[W,"%"]})]}),(0,b.jsxs)(h.GlassCard,{className:"p-4 text-center",children:[(0,b.jsx)(x.ClipboardCheck,{className:"h-6 w-6 text-amber-600 mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Évaluations"}),(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:R?.length||0})]})]}),(0,b.jsxs)(k.Tabs,{defaultValue:"overview",className:"space-y-6",children:[(0,b.jsxs)(k.TabsList,{className:"bg-white/50 backdrop-blur-sm border border-gray-200/50 p-1 rounded-xl",children:[(0,b.jsx)(k.TabsTrigger,{value:"overview",className:"rounded-lg",children:"Vue d'ensemble"}),(0,b.jsx)(k.TabsTrigger,{value:"documents",className:"rounded-lg",children:"Documents"}),(0,b.jsx)(k.TabsTrigger,{value:"progress",className:"rounded-lg",children:"Progression"}),(0,b.jsx)(k.TabsTrigger,{value:"trainers",className:"rounded-lg",children:"Intervenants"})]}),(0,b.jsxs)(k.TabsContent,{value:"overview",className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsxs)(h.GlassCard,{className:"p-6",children:[(0,b.jsxs)("h3",{className:"font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(m.GraduationCap,{className:"h-5 w-5 text-brand-blue"}),"Informations"]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(n.Calendar,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:"Dates"}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[M.start_date&&(0,F.formatDate)(M.start_date),M.end_date&&M.end_date!==M.start_date&&` - ${(0,F.formatDate)(M.end_date)}`]})]})]}),(M.start_time||M.end_time)&&(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(o.Clock,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:"Horaires"}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[M.start_time,M.end_time&&` - ${M.end_time}`]})]})]}),M.location&&(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(p.MapPin,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:"Lieu"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:M.location})]})]}),M?.meeting_url&&(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsx)(t.Video,{className:"h-5 w-5 text-gray-400 mt-0.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:"Lien de connexion"}),(0,b.jsx)("a",{href:M.meeting_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-brand-blue hover:underline",children:"Rejoindre la session"})]})]})]})]}),T?.objectives&&(0,b.jsxs)(h.GlassCard,{className:"p-6",children:[(0,b.jsxs)("h3",{className:"font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(B.Target,{className:"h-5 w-5 text-brand-blue"}),"Objectifs pédagogiques"]}),(0,b.jsx)("div",{className:"prose prose-sm max-w-none text-gray-600",dangerouslySetInnerHTML:{__html:T.objectives}})]})]}),T?.description&&(0,b.jsxs)(h.GlassCard,{className:"p-6",children:[(0,b.jsxs)("h3",{className:"font-bold text-gray-900 mb-4 flex items-center gap-2",children:[(0,b.jsx)(C.BookOpen,{className:"h-5 w-5 text-brand-blue"}),"Description de la formation"]}),(0,b.jsx)("p",{className:"text-gray-600",children:T.description})]})]}),(0,b.jsx)(k.TabsContent,{value:"documents",children:(0,b.jsxs)(h.GlassCard,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:"Mes documents"}),P&&P.length>0?(0,b.jsx)("div",{className:"space-y-3",children:P.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors",children:[(0,b.jsx)("div",{className:"p-2 bg-white rounded-lg shadow-sm",children:(a=>{switch(a){case"convocation":return(0,b.jsx)(z.Mail,{className:"h-5 w-5 text-blue-600"});case"convention":return(0,b.jsx)(r.FileText,{className:"h-5 w-5 text-purple-600"});case"attestation":return(0,b.jsx)(w.Award,{className:"h-5 w-5 text-green-600"});case"certificate":return(0,b.jsx)(w.Award,{className:"h-5 w-5 text-amber-600"});default:return(0,b.jsx)(r.FileText,{className:"h-5 w-5 text-gray-600"})}})(a.type)}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:a.name}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:a.created_at&&(0,F.formatDate)(a.created_at)})]}),(0,b.jsxs)(i.Button,{variant:"outline",size:"sm",children:[(0,b.jsx)(s.Download,{className:"h-4 w-4 mr-2"}),"Télécharger"]})]},a.id))}):(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)(r.FileText,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Aucun document disponible"})]})]})}),(0,b.jsxs)(k.TabsContent,{value:"progress",className:"space-y-6",children:[(0,b.jsxs)(h.GlassCard,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:"Suivi des présences"}),(0,b.jsx)("div",{className:"flex items-center gap-6 mb-4",children:(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between text-sm mb-2",children:[(0,b.jsx)("span",{children:"Taux de présence"}),(0,b.jsxs)("span",{className:"font-semibold",children:[W,"%"]})]}),(0,b.jsx)("div",{className:"h-3 bg-gray-100 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-green-500 rounded-full transition-all",style:{width:`${W}%`}})})]})}),(0,b.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,b.jsxs)("div",{className:"p-3 bg-green-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-green-600",children:V.present}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Présent"})]}),(0,b.jsxs)("div",{className:"p-3 bg-red-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-red-600",children:V.absent}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Absent"})]}),(0,b.jsxs)("div",{className:"p-3 bg-amber-50 rounded-lg",children:[(0,b.jsx)("p",{className:"text-2xl font-bold text-amber-600",children:V.late}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Retard"})]})]})]}),(0,b.jsxs)(h.GlassCard,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:"Mes notes"}),R&&R.length>0?(0,b.jsx)("div",{className:"space-y-3",children:R.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:a.subject}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:[a.assessment_type," • ",a.graded_at&&(0,F.formatDate)(a.graded_at)]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("p",{className:"text-xl font-bold text-gray-900",children:[a.score,"/",a.max_score||20]}),a.percentage&&(0,b.jsxs)(j.Badge,{className:a.percentage>=60?"bg-green-100 text-green-700":"bg-red-100 text-red-700",children:[a.percentage,"%"]})]})]},a.id))}):(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)(x.ClipboardCheck,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Aucune note disponible"})]})]})]}),(0,b.jsx)(k.TabsContent,{value:"trainers",children:(0,b.jsxs)(h.GlassCard,{className:"p-6",children:[(0,b.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:"Intervenants"}),Q&&Q.length>0?(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-2",children:Q.map(a=>{let c=a.users;return(0,b.jsxs)("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-xl",children:[(0,b.jsx)("div",{className:"w-14 h-14 rounded-full bg-brand-blue/10 flex items-center justify-center",children:c?.avatar_url?(0,b.jsx)("img",{src:c.avatar_url,alt:"",className:"w-full h-full rounded-full object-cover"}):(0,b.jsx)(A.User,{className:"h-6 w-6 text-brand-blue"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("p",{className:"font-semibold text-gray-900",children:[c?.first_name," ",c?.last_name]}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:a.role||"Formateur"}),c?.email&&(0,b.jsx)("p",{className:"text-xs text-brand-blue",children:c.email})]})]},a.id)})}):(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)(q.Users,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),(0,b.jsx)("p",{className:"text-gray-500",children:"Aucun intervenant assigné"})]})]})})]})]}):(0,b.jsxs)("div",{className:"text-center py-12",children:[(0,b.jsx)(u.AlertCircle,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Session introuvable"}),(0,b.jsx)(D.default,{href:"/learner/formations",children:(0,b.jsxs)(i.Button,{variant:"outline",children:[(0,b.jsx)(v.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour aux formations"]})})]})}a.s(["default",()=>H])}];

//# sourceMappingURL=app_%28learner%29_learner_formations_%5BsessionId%5D_page_tsx_b22ff674._.js.map