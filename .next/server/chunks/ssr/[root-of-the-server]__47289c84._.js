module.exports=[915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},641710,a=>{"use strict";let b=(0,a.i(170106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],641710)},992258,a=>{"use strict";let b=(0,a.i(170106).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);a.s(["Mail",()=>b],992258)},254799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},280281,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(497895);let e=c.forwardRef(({checked:a,onCheckedChange:c,disabled:e,className:f,...g},h)=>(0,b.jsx)("button",{type:"button",role:"switch","aria-checked":a,ref:h,disabled:e,onClick:()=>c?.(!a),className:(0,d.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",a?"bg-brand-blue":"bg-input",f),...g,children:(0,b.jsx)("span",{className:(0,d.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",a?"translate-x-5":"translate-x-0")})}));e.displayName="Switch",a.s(["Switch",0,e])},683245,a=>{"use strict";let b=(0,a.i(170106).default)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);a.s(["Edit",()=>b],683245)},325015,a=>{"use strict";let b=(0,a.i(170106).default)("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);a.s(["Play",()=>b],325015)},591965,a=>{"use strict";let b=(0,a.i(170106).default)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);a.s(["History",()=>b],591965)},792843,a=>{"use strict";var b=a.i(269240);let c=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getAll(a){let{data:b,error:c}=await this.supabase.from("email_templates").select("*").eq("organization_id",a).eq("is_active",!0).order("email_type",{ascending:!0}).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(c)throw c;return b||[]}async getByType(a,b){let{data:c,error:d}=await this.supabase.from("email_templates").select("*").eq("organization_id",a).eq("email_type",b).eq("is_active",!0).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(d)throw d;return c||[]}async getDefault(a,b){let{data:c,error:d}=await this.supabase.from("email_templates").select("*").eq("organization_id",a).eq("email_type",b).eq("is_default",!0).eq("is_active",!0).maybeSingle();if(d)throw d;return c}async getById(a){let{data:b,error:c}=await this.supabase.from("email_templates").select("*").eq("id",a).maybeSingle();if(c)throw c;return b}async create(a,b){a.is_default&&await this.unsetOtherDefaults(a.organization_id,a.email_type);let{data:c,error:d}=await this.supabase.from("email_templates").insert({...a,created_by:b,available_variables:a.available_variables||[]}).select().single();if(d)throw d;return c}async update(a,b){let c=await this.getById(a);if(!c)throw Error("Modèle non trouvé");b.is_default&&await this.unsetOtherDefaults(c.organization_id,c.email_type,a);let{data:d,error:e}=await this.supabase.from("email_templates").update(b).eq("id",a).select().single();if(e)throw e;return d}async delete(a){let{error:b}=await this.supabase.from("email_templates").update({is_active:!1}).eq("id",a);if(b)throw b}async deletePermanently(a){let{error:b}=await this.supabase.from("email_templates").delete().eq("id",a);if(b)throw b}async unsetOtherDefaults(a,b,c){let d=this.supabase.from("email_templates").update({is_default:!1}).eq("organization_id",a).eq("email_type",b).eq("is_default",!0);c&&(d=d.neq("id",c));let{error:e}=await d;if(e)throw e}replaceVariables(a,b){let c=a;for(let[a,d]of Object.entries(b)){let b=RegExp(`\\{${a}\\}`,"g");c=c.replace(b,d?.toString()||"")}return c}getEmailTypes(){return[{value:"document_generated",label:"Document généré",description:"Email envoyé lors de la génération d'un document",defaultVariables:["student_name","document_title","document_type","organization_name","document_url"]},{value:"invoice_sent",label:"Facture envoyée",description:"Email envoyé lors de l'envoi d'une facture",defaultVariables:["student_name","invoice_number","invoice_amount","due_date","organization_name","invoice_url"]},{value:"payment_reminder",label:"Rappel de paiement",description:"Email de rappel pour un paiement en attente",defaultVariables:["student_name","invoice_number","invoice_amount","due_date","days_overdue","organization_name"]},{value:"enrollment_confirmation",label:"Confirmation d'inscription",description:"Email de confirmation d'inscription à une session",defaultVariables:["student_name","session_name","session_start_date","session_location","organization_name"]},{value:"session_reminder",label:"Rappel de session",description:"Email de rappel avant une session",defaultVariables:["student_name","session_name","session_date","session_time","session_location","organization_name"]},{value:"certificate_issued",label:"Certificat délivré",description:"Email lors de la délivrance d'un certificat",defaultVariables:["student_name","certificate_name","certificate_date","organization_name","certificate_url"]},{value:"notification",label:"Notification générale",description:"Notification générale personnalisée",defaultVariables:["recipient_name","message","organization_name","action_url"]},{value:"custom",label:"Personnalisé",description:"Modèle d'email personnalisé",defaultVariables:[]}]}};a.s(["emailTemplateService",0,c])},416117,a=>{"use strict";var b=a.i(269240);let c=new class{supabase;constructor(a){this.supabase=a||(0,b.createClient)()}async getAllSchedules(a,b){let c=this.supabase.from("email_schedules").select("*, email_templates(*)").eq("organization_id",a).order("created_at",{ascending:!1});b?.isActive!==void 0&&(c=c.eq("is_active",b.isActive)),b?.emailType&&(c=c.eq("email_type",b.emailType));let{data:d,error:e}=await c;if(e)throw e;return d||[]}async getScheduleById(a){let{data:b,error:c}=await this.supabase.from("email_schedules").select("*, email_templates(*)").eq("id",a).single();if(c)throw c;return b}async createSchedule(a,b){let{data:c}=await this.supabase.auth.getUser(),d={organization_id:a,name:b.name,email_type:b.email_type,trigger_type:b.trigger_type,target_type:b.target_type,is_active:b.is_active??!0,send_to_students:b.send_to_students??!0,send_to_teachers:b.send_to_teachers??!1,send_to_coordinators:b.send_to_coordinators??!1};void 0!==b.description&&(d.description=b.description||null),void 0!==b.template_id&&(d.template_id=b.template_id||null),void 0!==b.trigger_days&&(d.trigger_days=b.trigger_days??null),void 0!==b.trigger_time&&(d.trigger_time=b.trigger_time||null),void 0!==b.trigger_datetime&&(d.trigger_datetime=b.trigger_datetime||null),void 0!==b.session_status&&(d.session_status=b.session_status||null),void 0!==b.session_id&&(d.session_id=b.session_id||null),void 0!==b.formation_id&&(d.formation_id=b.formation_id||null),void 0!==b.program_id&&(d.program_id=b.program_id||null),void 0!==b.custom_variables&&(d.custom_variables=b.custom_variables||null),void 0!==b.send_document&&(d.send_document=b.send_document??!1),void 0!==b.document_type&&(d.document_type=b.document_type||null),void 0!==b.document_template_id&&(d.document_template_id=b.document_template_id||null),c?.user?.id&&(d.created_by=c.user.id);let{data:e,error:f}=await this.supabase.from("email_schedules").insert(d).select().single();if(f)throw console.error("Error creating email schedule:",f),f;return e}async updateSchedule(a,b){let c={name:b.name,description:b.description,email_type:b.email_type,template_id:b.template_id,trigger_type:b.trigger_type,trigger_days:b.trigger_days,trigger_time:b.trigger_time,trigger_datetime:b.trigger_datetime,target_type:b.target_type,session_status:b.session_status,formation_id:b.formation_id,program_id:b.program_id,is_active:b.is_active,send_to_students:b.send_to_students,send_to_teachers:b.send_to_teachers,send_to_coordinators:b.send_to_coordinators,custom_variables:b.custom_variables,send_document:b.send_document,document_type:b.document_type,document_template_id:b.document_template_id};Object.keys(c).forEach(a=>{void 0===c[a]&&delete c[a]});let{data:d,error:e}=await this.supabase.from("email_schedules").update(c).eq("id",a).select().single();if(e)throw e;return d}async deleteSchedule(a){let{error:b}=await this.supabase.from("email_schedules").delete().eq("id",a);if(b)throw b}async getActiveSchedulesToExecute(){let{data:a,error:b}=await this.supabase.from("email_schedules").select("*, email_templates(*), organizations(*)").eq("is_active",!0);if(b)throw b;return a||[]}async logExecution(a,b,c,d){let e={schedule_id:a,organization_id:b,status:c.status,total_recipients:c.totalRecipients,successful_sends:c.successfulSends,failed_sends:c.failedSends,error_message:c.errorMessage||null,error_details:c.errorDetails||null,trigger_context:d||null},{data:f,error:g}=await this.supabase.from("email_schedule_logs").insert(e).select().single();if(g)throw g;let{data:h}=await this.supabase.from("email_schedules").select("total_sent").eq("id",a).single(),i=(h?.total_sent||0)+c.successfulSends;return await this.supabase.from("email_schedules").update({last_run_at:new Date().toISOString(),last_run_status:c.status,last_run_error:c.errorMessage||null,total_sent:i}).eq("id",a),f}async getScheduleLogs(a,b=50){let{data:c,error:d}=await this.supabase.from("email_schedule_logs").select("*").eq("schedule_id",a).order("executed_at",{ascending:!1}).limit(b);if(d)throw d;return c||[]}};a.s(["emailScheduleService",0,c])},308549,a=>{"use strict";let b=(0,a.i(170106).default)("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);a.s(["Pause",()=>b],308549)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__47289c84._.js.map