module.exports=[641710,a=>{"use strict";let b=(0,a.i(170106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],641710)},495756,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],495756)},54018,a=>{"use strict";let b=(0,a.i(170106).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);a.s(["XCircle",()=>b],54018)},424677,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(433217),e=a.i(913216),f=a.i(269240),g=a.i(703130),h=a.i(495756),i=a.i(54018),j=a.i(641710),k=a.i(290821),l=a.i(941675),m=a.i(497895);function n(){let{user:a}=(0,e.useAuth)(),n=(0,f.createClient)(),[o,p]=(0,c.useState)(new Date().toISOString().slice(0,7)),{data:q}=(0,d.useQuery)({queryKey:["portal-attendance",a?.id,o],queryFn:async()=>{if(!a?.id)return[];let b=[];if(a?.role==="parent"){let{data:c}=await n.from("guardians").select("id").eq("user_id",a.id);if(!c||0===c.length)return[];let{data:d}=await n.from("student_guardians").select("student_id").in("guardian_id",c.map(a=>a.id));if(!d||0===d.length)return[];b=d.map(a=>a.student_id).filter(a=>null!==a)}else a?.role==="student"&&(b=[a.id]);if(0===b.length)return[];let c=`${o}-01`,d=new Date(new Date(o+"-01").getFullYear(),new Date(o+"-01").getMonth()+1,0).toISOString().split("T")[0],{data:e}=await n.from("attendance").select("*, students(first_name, last_name, photo_url), classes(name)").in("student_id",b).gte("date",c).lte("date",d).order("date",{ascending:!1});return e||[]},enabled:!!a?.id}),r=q?{total:q.length,present:q.filter(a=>"present"===a.status).length,absent:q.filter(a=>"absent"===a.status).length,late:q.filter(a=>"late"===a.status).length,excused:q.filter(a=>"excused"===a.status).length,rate:q.length>0?Math.round(q.filter(a=>"present"===a.status).length/q.length*100):0}:null,s=a=>{switch(a){case"present":return(0,b.jsx)(h.CheckCircle,{className:"h-5 w-5 text-success-primary"});case"absent":return(0,b.jsx)(i.XCircle,{className:"h-5 w-5 text-red-600"});case"late":return(0,b.jsx)(j.Clock,{className:"h-5 w-5 text-warning-primary"});case"excused":return(0,b.jsx)(k.AlertCircle,{className:"h-5 w-5 text-blue-600"});default:return null}},t=a=>{switch(a){case"present":return"Présent";case"absent":return"Absent";case"late":return"En retard";case"excused":return"Justifié";default:return a}},u=a?.role==="parent"&&q?q.reduce((a,b)=>{let c=b.student_id;return a[c]||(a[c]={student:b.students,class:b.classes,records:[]}),a[c].records.push(b),a},{}):null;return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Présences"}),(0,b.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Suivez les présences et absences"})]}),(0,b.jsx)("input",{type:"month",value:o,onChange:a=>p(a.target.value),className:"px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"})]}),r&&(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:r.total}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total"})]})})}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-success-primary",children:r.present}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Présents"})]})})}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-red-600",children:r.absent}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Absents"})]})})}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-warning-primary",children:r.late}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"En retard"})]})})}),(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[r.rate,"%"]}),(0,b.jsx)("div",{className:"text-sm text-muted-foreground",children:"Taux"})]})})})]}),(0,b.jsxs)(g.Card,{children:[(0,b.jsx)(g.CardHeader,{children:(0,b.jsx)(g.CardTitle,{children:"Historique des présences"})}),(0,b.jsx)(g.CardContent,{children:q&&q.length>0?a?.role==="parent"&&u?(0,b.jsx)("div",{className:"space-y-6",children:Object.values(u).map(a=>(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("h3",{className:"font-semibold text-lg mb-3",children:[a.student.first_name," ",a.student.last_name,a.class?.name&&` - ${a.class.name}`]}),(0,b.jsx)("div",{className:"space-y-2",children:a.records.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[s(a.status),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:(0,m.formatDate)(a.date)}),a.late_minutes>0&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Retard: ",a.late_minutes," min"]})]})]}),(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"present"===a.status?"bg-success-bg text-success-primary":"absent"===a.status?"bg-red-100 text-red-800":"late"===a.status?"bg-warning-bg text-warning-primary":"bg-blue-100 text-blue-800"}`,children:t(a.status)})]},a.id))})]},a.student.id))}):(0,b.jsx)("div",{className:"space-y-2",children:q.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-4",children:[s(a.status),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:(0,m.formatDate)(a.date)}),a.classes?.name&&(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.classes.name}),a.late_minutes>0&&(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Retard: ",a.late_minutes," min"]})]})]}),(0,b.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"present"===a.status?"bg-success-bg text-success-primary":"absent"===a.status?"bg-red-100 text-red-800":"late"===a.status?"bg-warning-bg text-warning-primary":"bg-blue-100 text-blue-800"}`,children:t(a.status)})]},a.id))}):(0,b.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,b.jsx)(l.Calendar,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,b.jsx)("p",{children:"Aucune donnée de présence disponible"})]})})]})]})}a.s(["default",()=>n])}];

//# sourceMappingURL=_3c22fa66._.js.map