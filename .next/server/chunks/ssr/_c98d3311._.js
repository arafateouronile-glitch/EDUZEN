module.exports=[915618,a=>{"use strict";let b=(0,a.i(170106).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],915618)},495756,a=>{"use strict";let b=(0,a.i(170106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],495756)},491829,a=>{"use strict";var b=a.i(187924),c=a.i(913216),d=a.i(50944),e=a.i(572131);let f=(0,a.i(170106).default)("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var g=a.i(340695),h=a.i(703130),i=a.i(238246);function j({children:a,allowedRoles:j,fallback:k,redirectTo:l="/dashboard"}){let{user:m,isLoading:n}=(0,c.useAuth)(),o=(0,d.useRouter)(),[p,q]=(0,e.useState)(null);return((0,e.useEffect)(()=>{if(!n&&m){let a=m.role||"",b=j.includes(a);q(b),b||!l||k||o.push(l)}},[m,n,j,l,o,k]),n||null===p)?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):p?(0,b.jsx)(b.Fragment,{children:a}):k?(0,b.jsx)(b.Fragment,{children:k}):(0,b.jsx)("div",{className:"container mx-auto py-16 px-4",children:(0,b.jsx)(h.Card,{className:"max-w-md mx-auto",children:(0,b.jsxs)(h.CardContent,{className:"py-12 text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,b.jsx)(f,{className:"h-8 w-8 text-red-600"})}),(0,b.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Accès non autorisé"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Vous n'avez pas les permissions nécessaires pour accéder à cette page."}),(0,b.jsx)(i.default,{href:"/dashboard",children:(0,b.jsx)(g.Button,{children:"Retour au tableau de bord"})})]})})})}a.s(["ADMIN_ROLES",0,["super_admin","admin","secretary","accountant"],"FINANCE_ROLES",0,["super_admin","admin","secretary","accountant"],"FORMATION_MANAGEMENT_ROLES",0,["super_admin","admin","secretary"],"RoleGuard",()=>j],491829)},631553,a=>{"use strict";var b=a.i(187924),c=a.i(433217),d=a.i(937927),e=a.i(913216),f=a.i(269240);let g=new class{supabase;constructor(a){this.supabase=a||(0,f.createClient)()}async getCertifications(a,b){let c=this.supabase.from("rncp_certifications").select("*").eq("organization_id",a);b?.isActive!==void 0&&(c=c.eq("is_active",b.isActive)),b?.type&&(c=c.eq("certification_type",b.type)),b?.search&&(c=c.or(`title.ilike.%${b.search}%,rncp_code.ilike.%${b.search}%,rs_code.ilike.%${b.search}%`));let{data:d,error:e}=await c.order("title",{ascending:!0});if(e)throw e;return d||[]}async getCertificationById(a){let{data:b,error:c}=await this.supabase.from("rncp_certifications").select("*").eq("id",a).single();if(c)throw c;return b}async createCertification(a){let{data:b,error:c}=await this.supabase.from("rncp_certifications").insert(a).select().single();if(c)throw c;return b}async updateCertification(a,b){let{data:c,error:d}=await this.supabase.from("rncp_certifications").update(b).eq("id",a).select().single();if(d)throw d;return c}async getJuries(a,b){let c=this.supabase.from("certification_juries").select("*, rncp_certifications(*), sites(*)").eq("organization_id",a);b?.certificationId&&(c=c.eq("certification_id",b.certificationId)),b?.status&&(c=c.eq("status",b.status)),b?.startDate&&(c=c.gte("jury_date",b.startDate)),b?.endDate&&(c=c.lte("jury_date",b.endDate));let{data:d,error:e}=await c.order("jury_date",{ascending:!1});if(e)throw e;return d||[]}async getJuryById(a){let{data:b,error:c}=await this.supabase.from("certification_juries").select("*, rncp_certifications(*), sites(*), jury_candidates(*, students(*))").eq("id",a).single();if(c)throw c;return b}async createJury(a){let{data:b,error:c}=await this.supabase.from("certification_juries").insert(a).select().single();if(c)throw c;return b}async updateJury(a,b){let{data:c,error:d}=await this.supabase.from("certification_juries").update(b).eq("id",a).select().single();if(d)throw d;return c}async addCandidate(a){let{data:b,error:c}=await this.supabase.from("jury_candidates").insert(a).select().single();if(c)throw c;return b}async updateCandidateResult(a,b){let c={status:b.status,decision_date:new Date().toISOString().split("T")[0]};void 0!==b.finalScore&&(c.final_score=b.finalScore),b.decisionNotes&&(c.decision_notes=b.decisionNotes),b.evaluationDetails&&(c.evaluation_details=b.evaluationDetails);let{data:d,error:e}=await this.supabase.from("jury_candidates").update(c).eq("id",a).select().single();if(e)throw e;return d}async getJuryCandidates(a){let{data:b,error:c}=await this.supabase.from("jury_candidates").select("*, students(*)").eq("jury_id",a).order("created_at",{ascending:!0});if(c)throw c;return b||[]}async getJuryMinutes(a){let{data:b,error:c}=await this.supabase.from("jury_minutes").select("*").eq("jury_id",a).order("created_at",{ascending:!1});if(c)throw c;return b||[]}async createMinute(a){let{data:b,error:c}=await this.supabase.from("jury_minutes").insert(a).select().single();if(c)throw c;return b}async updateMinute(a,b){let{data:c,error:d}=await this.supabase.from("jury_minutes").update(b).eq("id",a).select().single();if(d)throw d;return c}generateCertificateNumber(a,b){let c="RNCP"===a.certification_type?"RNCP":"RS",d=a.rncp_code||a.rs_code||"CERT",e=new Date().getFullYear(),f=b.slice(0,8).toUpperCase();return`${c}-${d}-${e}-${f}-${Date.now().toString(36).toUpperCase()}`}async createCertificate(a){if(!a.certificate_number){let b=await this.getCertificationById(a.certification_id);a.certificate_number=this.generateCertificateNumber(b,a.student_id)}let{data:b,error:c}=await this.supabase.from("certification_certificates").insert(a).select().single();if(c)throw c;return b}async getCertificates(a,b){let c=this.supabase.from("certification_certificates").select("*, rncp_certifications(*), students(*), certification_juries(*)").eq("organization_id",a);b?.certificationId&&(c=c.eq("certification_id",b.certificationId)),b?.studentId&&(c=c.eq("student_id",b.studentId)),b?.status&&(c=c.eq("status",b.status));let{data:d,error:e}=await c.order("issue_date",{ascending:!1});if(e)throw e;return d||[]}async generateCertificatesForJury(a,b){let c=await this.getJuryById(a),d=(await this.getJuryCandidates(a)).filter(a=>"admitted"===a.status),e=[];for(let f of d){let d=await this.getCertificationById(c.certification_id),g=await this.createCertificate({organization_id:c.organization_id,certification_id:c.certification_id,jury_id:a,student_id:f.student_id,session_id:c.session_id||null,issue_date:new Date().toISOString().split("T")[0],certification_level:d.level||null,rncp_code:d.rncp_code||null,status:"issued",issued_by:b});e.push(g)}return e}};var h=a.i(340695),i=a.i(703130),j=a.i(864037),k=a.i(915618),l=a.i(93518),m=a.i(495756),n=a.i(941675),o=a.i(660246),p=a.i(104720),q=a.i(491829),r=a.i(238246);function s(){return(0,b.jsx)(q.RoleGuard,{allowedRoles:q.FORMATION_MANAGEMENT_ROLES,children:(0,b.jsx)(t,{})})}function t(){let{user:a}=(0,e.useAuth)();(0,d.useQueryClient)();let{addToast:f}=(0,j.useToast)(),{data:m,isLoading:q}=(0,c.useQuery)({queryKey:["rncp-certifications",a?.organization_id],queryFn:async()=>a?.organization_id?await g.getCertifications(a.organization_id):[],enabled:!!a?.organization_id}),{data:s}=(0,c.useQuery)({queryKey:["certification-juries",a?.organization_id],queryFn:async()=>a?.organization_id?g.getJuries(a.organization_id,{status:"scheduled"}):[],enabled:!!a?.organization_id});if(!a?.organization_id)return(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("p",{children:"Aucune organisation"})});let t=m?.filter(a=>a.is_active)||[];return(0,b.jsxs)("div",{className:"p-6 space-y-6",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Certifications RNCP/RS"}),(0,b.jsx)("p",{className:"text-gray-600 mt-1",children:"Gérez vos certifications et jurys"})]}),(0,b.jsxs)(h.Button,{className:"bg-brand-blue hover:bg-brand-blue-dark",children:[(0,b.jsx)(k.Plus,{className:"w-4 h-4 mr-2"}),"Nouvelle certification"]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-4 gap-4",children:[(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:m?.length||0}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Total certifications"})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-green-600",children:t.length}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Actives"})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"pt-6",children:[(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:s?.length||0}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Jurys à venir"})]})}),(0,b.jsx)(i.Card,{children:(0,b.jsx)(i.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Award,{className:"w-5 h-5 text-brand-blue"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:"RNCP/RS"}),(0,b.jsx)("div",{className:"text-sm text-gray-600",children:"Certifications"})]})]})})})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,b.jsx)(r.default,{href:"/dashboard/certifications/juries",children:(0,b.jsxs)(i.Card,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Users,{className:"w-5 h-5 text-brand-blue"}),"Jurys"]})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Gérer les jurys de certification"})})]})}),(0,b.jsx)(r.default,{href:"/dashboard/certifications/attestations",children:(0,b.jsxs)(i.Card,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(p.FileText,{className:"w-5 h-5 text-brand-blue"}),"Attestations"]})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Consulter les attestations délivrées"})})]})}),(0,b.jsxs)(i.Card,{className:"hover:shadow-lg transition-shadow",children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(n.Calendar,{className:"w-5 h-5 text-brand-blue"}),"Calendrier"]})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"Voir le calendrier des jurys"})})]})]}),q?(0,b.jsx)("div",{className:"text-center py-12",children:"Chargement..."}):m&&m.length>0?(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Certifications"}),(0,b.jsx)("div",{className:"grid md:grid-cols-2 gap-4",children:m.map(a=>(0,b.jsx)(u,{certification:a},a.id))})]}):(0,b.jsx)(i.Card,{children:(0,b.jsxs)(i.CardContent,{className:"text-center py-12",children:[(0,b.jsx)(l.Award,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"Aucune certification enregistrée"}),(0,b.jsxs)(h.Button,{className:"bg-brand-blue hover:bg-brand-blue-dark",children:[(0,b.jsx)(k.Plus,{className:"w-4 h-4 mr-2"}),"Créer la première certification"]})]})})]})}function u({certification:a}){let c=a=>a?new Date(a).toLocaleDateString("fr-FR"):"Non définie";return(0,b.jsxs)(i.Card,{className:"hover:shadow-lg transition-shadow",children:[(0,b.jsx)(i.CardHeader,{children:(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)(i.CardTitle,{children:a.title}),(0,b.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,b.jsx)("span",{className:`inline-block px-2 py-1 text-xs rounded-full ${"RNCP"===a.certification_type?"bg-blue-100 text-blue-800":"RS"===a.certification_type?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:a.certification_type}),a.rncp_code&&(0,b.jsx)("span",{className:"inline-block px-2 py-1 text-xs bg-gray-100 text-gray-800 rounded-full",children:a.rncp_code}),a.level&&(0,b.jsxs)("span",{className:"inline-block px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded-full",children:["Niveau ",a.level]})]})]}),a.is_active?(0,b.jsx)(m.CheckCircle,{className:"w-5 h-5 text-green-600"}):(0,b.jsx)(m.CheckCircle,{className:"w-5 h-5 text-gray-400"})]})}),(0,b.jsxs)(i.CardContent,{className:"space-y-2",children:[a.validity_start_date&&(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,b.jsx)("strong",{children:"Validité :"})," Du ",c(a.validity_start_date)," au"," ",c(a.validity_end_date)]}),a.description&&(0,b.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:a.description}),(0,b.jsxs)("div",{className:"flex gap-2 pt-2 border-t",children:[(0,b.jsxs)(h.Button,{variant:"outline",size:"sm",className:"flex-1",children:[(0,b.jsx)(p.FileText,{className:"w-3 h-3 mr-1"}),"Détails"]}),(0,b.jsx)(h.Button,{variant:"outline",size:"sm",children:(0,b.jsx)(o.Users,{className:"w-3 h-3"})})]})]})]})}a.s(["default",()=>s],631553)}];

//# sourceMappingURL=_c98d3311._.js.map