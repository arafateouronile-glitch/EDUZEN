module.exports=[284144,a=>{"use strict";function b(a,b){if(!a)return a;let d=a;return(d=(a=>{let c=a,d=!0,e=0;for(;d&&e<10;){d=!1,e++;let a=/\{([a-zA-Z_][a-zA-Z0-9_]*)\s+&&\s+([a-zA-Z_][a-zA-Z0-9_]*)\s+&&\s+([^}]+)\}/g;c=c.replace(a,(a,c,e,f)=>{let g=b[c.trim()],h=b[e.trim()];return g&&""!==g&&h&&""!==h?(d=!0,f):""})}return c})(d=(a=>{let c=a,d=!0,e=0;for(;d&&e<10;){let a;d=!1,e++;let f=/\{([a-zA-Z_][a-zA-Z0-9_]*)\s+&&\s+/g,g=[],h=[];for(;null!==(a=f.exec(c));)h.push({varName:a[1].trim(),start:a.index,varEnd:a.index+a[0].length});for(let a=h.length-1;a>=0;a--){let e=h[a],f=1,i=e.varEnd,j=!1,k="",l=!1,m=-1;for(;i<c.length&&!l;){let a=c[i];j?a===k&&"\\"!==c[i-1]&&(j=!1):'"'===a||"'"===a?(j=!0,k=a):"{"===a?f++:"}"===a&&0==--f&&(l=!0,m=i),i++}if(l&&m>e.start){let a=e.varName,f=c.substring(e.varEnd,m),h=b[a];h&&""!==h&&0!==h&&"0"!==h&&null!=h?g.push({start:e.start,end:m+1,replacement:f}):g.push({start:e.start,end:m+1,replacement:""}),d=!0}}for(let a of g)c=c.substring(0,a.start)+a.replacement+c.substring(a.end)}return c})(d))).replace(/\{IF\s+([^}]+)\}([\s\S]*?)(?:\{ELSE\}([\s\S]*?))?\{ENDIF\}/gi,(a,d,e,f="")=>!function(a,b){if(a=a.trim(),b.hasOwnProperty(a)){let c=b[a];return!!c&&""!==c&&0!==c&&"0"!==c}for(let d of["==","!=",">","<",">=","<="])if(a.includes(d)){let[e,f]=a.split(d).map(a=>a.trim()),g=c(e,b),h=c(f,b);switch(d){case"==":return g==h;case"!=":return g!=h;case">":return Number(g)>Number(h);case"<":return Number(g)<Number(h);case">=":return Number(g)>=Number(h);case"<=":return Number(g)<=Number(h);default:return!1}}return!1}(d.trim(),b)?f:e)}function c(a,b){return(a=a.trim()).startsWith('"')&&a.endsWith('"')||a.startsWith("'")&&a.endsWith("'")?a.slice(1,-1):isNaN(Number(a))?b[a]??a:Number(a)}a.s(["evaluateConditionalContent",0,b,"processConditionals",()=>b])},522734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},500874,(a,b,c)=>{b.exports=a.x("buffer",()=>require("buffer"))},688947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},427699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},716802,a=>{"use strict";var b=a.i(932596),c=a.i(33926),d=a.i(307739);async function e(a,d="document.pdf",f){let g=document.getElementById(a);if(!g)throw Error(`\xc9l\xe9ment avec l'ID "${a}" non trouv\xe9`);try{let a,e=g.getBoundingClientRect();(0===e.width||0===e.height)&&(console.warn("Élément sans dimensions, tentative de correction..."),g instanceof HTMLElement&&(g.style.width=g.style.width||"210mm",g.style.minHeight=g.style.minHeight||"297mm",await new Promise(a=>setTimeout(a,100))));let h=g.querySelectorAll("img");await Promise.all(Array.from(h).map(a=>a.complete&&a.naturalWidth>0?Promise.resolve():new Promise(b=>{a.onload=b,a.onerror=b,setTimeout(b,5e3)})));let i=e.width||g.scrollWidth||794,j=g.scrollHeight||1123,k=await (0,c.default)(g,{scale:2,useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff",removeContainer:!1,imageTimeout:15e3,width:i,height:j,windowWidth:i,windowHeight:j,x:0,y:0,onclone:(a,b)=>{if(a.querySelectorAll("img").forEach(a=>{a.complete&&0!==a.naturalWidth||(a.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2YzZjRmNiIvPjwvc3ZnPg==")}),b instanceof HTMLElement){let a=b.getBoundingClientRect();(0===a.width||0===a.height)&&(b.style.width="210mm",b.style.minHeight="297mm")}}});if(!k)throw Error("Le canvas n'a pas pu être généré");if(0===k.width||0===k.height)throw console.error("Canvas invalide:",{width:k.width,height:k.height}),Error(`Le canvas g\xe9n\xe9r\xe9 est invalide (${k.width}x${k.height})`);try{if(!(a=k.toDataURL("image/png",.95))||a.length<100)throw Error("Data URL invalide")}catch(b){console.error("Erreur lors de la conversion du canvas en data URL:",b),a=k.toDataURL("image/jpeg",.95)}let l=new b.jsPDF({orientation:f?.orientation||"portrait",unit:"mm",format:f?.format||"a4",compress:!0}),m=l.internal.pageSize.getWidth(),n=k.height*m/k.width,o=n,p=0;try{l.addImage(a,"PNG",0,p,m,n,void 0,"FAST")}catch(b){if(console.error("Erreur lors de l'ajout de l'image au PDF:",b),a.startsWith("data:image/png")){let a=k.toDataURL("image/jpeg",.95);l.addImage(a,"JPEG",0,p,m,n,void 0,"FAST")}else throw b}for(o-=l.internal.pageSize.getHeight();o>=0;){p=o-n,l.addPage();try{l.addImage(a,"PNG",0,p,m,n,void 0,"FAST")}catch(b){if(a.startsWith("data:image/png")){let a=k.toDataURL("image/jpeg",.95);l.addImage(a,"JPEG",0,p,m,n,void 0,"FAST")}}o-=l.internal.pageSize.getHeight()}return l.save(d),l.output("blob")}catch(a){throw console.error("Erreur lors de la génération du PDF:",a),Error(`Erreur lors de la g\xe9n\xe9ration du PDF: ${a instanceof Error?a.message:"Erreur inconnue"}`)}}function f(a,b="fr-FR"){let c="string"==typeof a?new Date(a):a;return new Intl.DateTimeFormat(b,{year:"numeric",month:"long",day:"numeric"}).format(c)}async function g(a,d){let e,f=document.getElementById(a);if(!f)throw Error(`\xc9l\xe9ment avec l'ID "${a}" non trouv\xe9`);let g=f.getBoundingClientRect();(0===g.width||0===g.height)&&(console.warn("Élément sans dimensions, tentative de correction..."),f instanceof HTMLElement&&(f.style.width=f.style.width||"794px",f.style.minHeight=f.style.minHeight||"1123px",await new Promise(a=>setTimeout(a,100))));let h=f.querySelectorAll("img");await Promise.all(Array.from(h).map(a=>a.complete&&a.naturalWidth>0?Promise.resolve():new Promise(b=>{a.onload=b,a.onerror=b,setTimeout(b,5e3)})));let i=f.querySelector(".header"),j=f.querySelector(".footer");f.querySelector(".content");let k=i?.getAttribute("data-repeat-on-all-pages")==="true",l=window.getComputedStyle(f),m=parseFloat(l.paddingTop)||75.6,n=parseFloat(l.paddingBottom)||75.6,o=parseFloat(l.paddingLeft)||75.6,p=parseFloat(l.paddingRight)||75.6,q=f.scrollWidth||g.width||794,r=f.scrollHeight||g.height||1123,s=null,t=0;if(j)try{t=j.offsetHeight||60,s=await (0,c.default)(j,{scale:2,useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff",width:q-o-p,height:t}),console.log("[PDF Generator] Footer capturé séparément:",{width:s.width,height:s.height,footerHeight:t})}catch(a){console.warn("[PDF Generator] Erreur lors de la capture du footer:",a)}console.log("[PDF Generator] Capturing element:",{elementId:a,width:q,height:r,scrollWidth:f.scrollWidth,scrollHeight:f.scrollHeight,rectWidth:g.width,rectHeight:g.height,computedPadding:l.padding,paddingTop:m,paddingBottom:n,paddingLeft:o,paddingRight:p});let u=await (0,c.default)(f,{scale:2,useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff",removeContainer:!1,imageTimeout:15e3,width:q,height:r,windowWidth:q,windowHeight:r,x:0,y:0,scrollX:0,scrollY:0,onclone:(a,b)=>{if(a.querySelectorAll("img").forEach(a=>{a.complete&&0!==a.naturalWidth||(a.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2YzZjRmNiIvPjwvc3ZnPg==")}),b instanceof HTMLElement){b.style.width="794px",b.style.minHeight="1123px",b.style.backgroundColor="#ffffff",b.style.boxSizing="border-box",b.style.position="relative",b.style.padding=`${m}px ${p}px ${n}px ${o}px`,b.style.display="flex",b.style.flexDirection="column",console.log("[PDF Generator] Clone styles applied:",{padding:b.style.padding,width:b.style.width,minHeight:b.style.minHeight,display:b.style.display});let a=b.querySelector(".header"),c=b.querySelector(".footer"),d=b.querySelector(".content");a?(a.style.display="block",a.style.visibility="visible",a.style.opacity="1",a.style.width="100%",a.style.marginBottom="20px",a.style.flexShrink="0",a.style.position="relative",a.style.zIndex="1",console.log("[PDF Generator] Header cloné activé:",{display:a.style.display,visibility:a.style.visibility,innerHTML:a.innerHTML.substring(0,100),offsetHeight:a.offsetHeight})):console.warn("[PDF Generator] Header non trouvé dans le clone"),c&&(c.style.display="none",console.log("[PDF Generator] Footer masqué dans le clone principal (sera ajouté séparément)")),d&&(d.style.flex="1",d.style.width="100%",d.style.overflow="visible")}}});if(!u||0===u.width||0===u.height)throw Error(`Le canvas g\xe9n\xe9r\xe9 est invalide (${u?.width||0}x${u?.height||0})`);try{if(!(e=u.toDataURL("image/png",.95))||e.length<100)throw Error("Data URL invalide")}catch(a){console.error("Erreur lors de la conversion du canvas en data URL:",a),e=u.toDataURL("image/jpeg",.95)}let v=null;if(i&&!k){let a=i.style.display;i.style.display="none";try{await new Promise(a=>setTimeout(a,100)),v=(await (0,c.default)(f,{scale:2,useCORS:!0,allowTaint:!0,logging:!1,backgroundColor:"#ffffff",removeContainer:!1,imageTimeout:15e3,width:q,height:r,windowWidth:q,windowHeight:r,x:0,y:0,scrollX:0,scrollY:0,onclone:(a,b)=>{let c=b.querySelector(".header");c&&(c.style.display="none");let d=b.querySelector(".footer");d&&(d.style.display="none")}})).toDataURL("image/png",.95),console.log("[PDF Generator] Canvas sans header créé pour les pages suivantes")}catch(a){console.warn("[PDF Generator] Erreur lors de la création du canvas sans header:",a),v=e}finally{i.style.display=a}}else v=e;let w=new b.jsPDF({orientation:d?.orientation||"portrait",unit:"mm",format:d?.format||"a4",compress:!0}),x=w.internal.pageSize.getWidth(),y=u.height*x/u.width,z=w.internal.pageSize.getHeight(),A=n/3.78,B=y,C=0,D=1,E=Math.ceil(y/z),F=(a,b,c)=>{if(s)try{let d=s.toDataURL("image/png",.95),e=s.height*x/s.width,f=z-e-A;a.addImage(d,"PNG",0,f,x,e,void 0,"FAST"),console.log(`[PDF Generator] Footer ajout\xe9 sur la page ${b}/${c} \xe0 ${f}mm du bas`)}catch(a){console.warn("[PDF Generator] Erreur lors de l'ajout du footer:",a)}},G=e;try{w.addImage(G,"PNG",0,C,x,y,void 0,"FAST"),F(w,D,E)}catch(a){if(console.error("Erreur lors de l'ajout de l'image au PDF:",a),G.startsWith("data:image/png")){let a=u.toDataURL("image/jpeg",.95);w.addImage(a,"JPEG",0,C,x,y,void 0,"FAST"),F(w,D,E)}else throw a}B-=z,D++;let H=v||e;for(;B>=0;){C=B-y,w.addPage();try{w.addImage(H,"PNG",0,C,x,y,void 0,"FAST"),F(w,D,E)}catch(a){if(H.startsWith("data:image/png")){let a=H.replace("data:image/png","data:image/jpeg");w.addImage(a,"JPEG",0,C,x,y,void 0,"FAST"),F(w,D,E)}}B-=z,D++}return w.output("blob")}async function h(a,b="documents.zip"){let c=new d.default;for(let b of a)c.file(b.name,b.blob);let e=await c.generateAsync({type:"blob"}),f=URL.createObjectURL(e),g=document.createElement("a");g.href=f,g.download=b,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(f)}a.s(["createZipFromPDFs",()=>h,"formatDateForDocument",()=>f,"generatePDFBlobFromHTML",()=>g,"generatePDFFromHTML",()=>e])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__20455782._.js.map