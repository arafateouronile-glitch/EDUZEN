{"version":3,"sources":["../../../lib/utils/logger.ts","../../../lib/services/email.service.ts","../../../lib/services/alert.service.ts"],"sourcesContent":["/**\n * Logger centralis√© pour l'application Eduzen\n * \n * Fournit une interface unifi√©e pour le logging avec :\n * - Niveaux de log (error, warn, info, debug)\n * - Support pour services externes (Sentry, LogRocket)\n * - Formatage coh√©rent\n * - Mode d√©veloppement vs production\n */\n\ntype LogLevel = 'error' | 'warn' | 'info' | 'debug'\n\ninterface LogContext {\n  userId?: string\n  organizationId?: string\n  sessionId?: string\n  [key: string]: unknown\n}\n\nclass Logger {\n  private isDevelopment = process.env.NODE_ENV === 'development'\n  private isProduction = process.env.NODE_ENV === 'production'\n  private sentryEnabled = !!process.env.NEXT_PUBLIC_SENTRY_DSN\n\n  /**\n   * Initialise Sentry si disponible\n   */\n  private initSentry() {\n    if (this.sentryEnabled && typeof window !== 'undefined') {\n      // Lazy load Sentry pour √©viter d'augmenter la taille du bundle\n      import('@sentry/nextjs').then((Sentry) => {\n        try {\n          // V√©rifier si Sentry est d√©j√† initialis√© en essayant d'acc√©der au client\n          // Si ce n'est pas le cas, l'initialiser\n          Sentry.init({\n            dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,\n            environment: process.env.NODE_ENV,\n            tracesSampleRate: 0.1, // 10% des transactions\n            beforeSend(event) {\n              // Filtrer les erreurs sensibles\n              if (event.request?.headers) {\n                delete event.request.headers['authorization']\n                delete event.request.headers['cookie']\n              }\n              return event\n            },\n          })\n        } catch (e) {\n          // Sentry d√©j√† initialis√© ou erreur, continuer sans\n        }\n      }).catch(() => {\n        // Sentry non disponible, continuer sans\n      })\n    }\n  }\n\n  constructor() {\n    if (this.sentryEnabled) {\n      this.initSentry()\n    }\n  }\n\n  /**\n   * Log une erreur avec contexte optionnel\n   */\n  error(message: string, error?: Error | unknown, context?: LogContext) {\n    const logData = {\n      message,\n      error: error instanceof Error ? {\n        name: error.name,\n        message: error.message,\n        stack: error.stack,\n      } : error,\n      context,\n      timestamp: new Date().toISOString(),\n      level: 'error' as LogLevel,\n    }\n\n    // En production, envoyer vers Sentry si disponible\n    if (this.isProduction && this.sentryEnabled && typeof window !== 'undefined') {\n      import('@sentry/nextjs').then((Sentry) => {\n        if (error instanceof Error) {\n          Sentry.captureException(error, {\n            extra: {\n              message,\n              context,\n            },\n            tags: {\n              source: 'logger',\n            },\n          })\n        } else {\n          Sentry.captureMessage(message, {\n            level: 'error',\n            extra: {\n              error,\n              context,\n            },\n          })\n        }\n      }).catch(() => {\n        // Sentry non disponible, continuer sans\n      })\n    }\n\n    // Envoyer une alerte pour les erreurs critiques (en production uniquement)\n    if (this.isProduction && message.includes('[CRITICAL]')) {\n      // Import dynamique pour √©viter les d√©pendances circulaires\n      import('@/lib/services/alert.service').then(({ alertService }) => {\n        const errorObj = error instanceof Error ? error : new Error(message)\n        alertService.sendCriticalError(errorObj, {\n          context,\n          timestamp: logData.timestamp,\n        }).catch((err) => {\n          // Ne pas logger l'erreur d'alerte pour √©viter les boucles infinies\n          if (this.isDevelopment) {\n            console.error('Failed to send critical alert:', err)\n          }\n        })\n      }).catch(() => {\n        // Service d'alertes non disponible, continuer sans\n      })\n    }\n\n    // Toujours logger en console pour le d√©veloppement\n    if (this.isDevelopment || !this.isProduction) {\n      console.error('‚ùå [ERROR]', message, {\n        error,\n        context,\n        timestamp: logData.timestamp,\n      })\n    }\n  }\n\n  /**\n   * Log un avertissement\n   */\n  warn(message: string, context?: LogContext) {\n    const logData = {\n      message,\n      context,\n      timestamp: new Date().toISOString(),\n      level: 'warn' as LogLevel,\n    }\n\n    if (this.isDevelopment) {\n      console.warn('‚ö†Ô∏è [WARN]', message, { context, timestamp: logData.timestamp })\n    }\n  }\n\n  /**\n   * Log une information\n   */\n  info(message: string, context?: LogContext) {\n    const logData = {\n      message,\n      context,\n      timestamp: new Date().toISOString(),\n      level: 'info' as LogLevel,\n    }\n\n    if (this.isDevelopment) {\n      console.info('‚ÑπÔ∏è [INFO]', message, { context, timestamp: logData.timestamp })\n    }\n  }\n\n  /**\n   * Log pour le d√©bogage (uniquement en d√©veloppement)\n   */\n  debug(message: string, context?: LogContext) {\n    if (!this.isDevelopment) return\n\n    console.debug('üêõ [DEBUG]', message, {\n      context,\n      timestamp: new Date().toISOString(),\n    })\n  }\n\n  /**\n   * Helper pour logger les erreurs de requ√™te API\n   */\n  apiError(endpoint: string, error: Error | unknown, context?: LogContext) {\n    this.error(`API Error: ${endpoint}`, error, {\n      ...context,\n      endpoint,\n    })\n  }\n\n  /**\n   * Helper pour logger les erreurs de mutation\n   */\n  mutationError(mutationName: string, error: Error | unknown, context?: LogContext) {\n    this.error(`Mutation Error: ${mutationName}`, error, {\n      ...context,\n      mutationName,\n    })\n  }\n\n  /**\n   * Helper pour logger les erreurs de query\n   */\n  queryError(queryKey: string, error: Error | unknown, context?: LogContext) {\n    this.error(`Query Error: ${queryKey}`, error, {\n      ...context,\n      queryKey,\n    })\n  }\n}\n\n// Export d'une instance singleton\nexport const logger = new Logger()\n\n// Export du type pour utilisation dans d'autres fichiers\nexport type { LogContext, LogLevel }\n\n/**\n * Utilitaires pour sanitiser les donn√©es sensibles dans les logs\n */\n\n/**\n * Masque un email (garde 2 premiers caract√®res + domaine)\n */\nexport function maskEmail(email: string | null | undefined): string {\n  if (!email) return '[NO_EMAIL]'\n  const [local, domain] = email.split('@')\n  if (!domain) return '[INVALID_EMAIL]'\n  return `${local.substring(0, 2)}***@${domain}`\n}\n\n/**\n * Masque un ID (garde 8 premiers caract√®res)\n */\nexport function maskId(id: string | null | undefined): string {\n  if (!id) return '[NO_ID]'\n  return id.substring(0, 8) + '...'\n}\n\n/**\n * Masque un token (retourne juste un indicateur)\n */\nexport function maskToken(token: string | null | undefined): string {\n  if (!token) return '[NO_TOKEN]'\n  return '[REDACTED]'\n}\n\n/**\n * Masque un num√©ro de t√©l√©phone (garde 4 derniers chiffres)\n */\nexport function maskPhone(phone: string | null | undefined): string {\n  if (!phone) return '[NO_PHONE]'\n  if (phone.length < 4) return '***'\n  return '***' + phone.slice(-4)\n}\n\n/**\n * Sanitise un objet erreur pour √©viter d'exposer des informations sensibles\n */\nexport function sanitizeError(error: any): Record<string, any> {\n  if (!error) return {}\n\n  return {\n    message: error.message,\n    code: error.code,\n    name: error.name,\n    // Ne pas inclure stack traces en production\n    ...(process.env.NODE_ENV === 'development' ? { stack: error.stack } : {}),\n  }\n}\n\n/**\n * Sanitise un objet utilisateur pour les logs\n */\nexport function sanitizeUser(user: any): Record<string, any> {\n  if (!user) return {}\n\n  return {\n    id: maskId(user.id),\n    email: maskEmail(user.email),\n    role: user.role,\n    organizationId: maskId(user.organization_id),\n  }\n}\n\n/**\n * Sanitise un objet √©tudiant pour les logs\n */\nexport function sanitizeStudent(student: any): Record<string, any> {\n  if (!student) return {}\n\n  return {\n    id: maskId(student.id),\n    email: maskEmail(student.email),\n    firstName: student.first_name ? student.first_name.charAt(0) + '***' : '[NO_NAME]',\n    lastName: student.last_name ? student.last_name.charAt(0) + '***' : '[NO_NAME]',\n  }\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","/**\n * Service d'envoi d'emails\n * \n * Ce service permet d'envoyer des emails avec pi√®ces jointes depuis l'application.\n * \n * Configuration requise :\n * - Installer Resend : npm install resend\n * - Ajouter RESEND_API_KEY dans .env.local\n * - Ou utiliser un autre service d'email (SendGrid, etc.)\n */\n\ninterface EmailAttachment {\n  filename: string\n  content: Blob | ArrayBuffer | string // Base64 ou Blob\n  contentType: string\n}\n\ninterface SendEmailOptions {\n  to: string | string[]\n  subject: string\n  html?: string\n  text?: string\n  attachments?: EmailAttachment[]\n  cc?: string | string[]\n  bcc?: string | string[]\n  replyTo?: string\n}\n\nexport class EmailService {\n  /**\n   * Convertit un Blob en base64\n   */\n  private async blobToBase64(blob: Blob): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const reader = new FileReader()\n      reader.onloadend = () => {\n        const base64 = (reader.result as string).split(',')[1]\n        resolve(base64)\n      }\n      reader.onerror = reject\n      reader.readAsDataURL(blob)\n    })\n  }\n\n  /**\n   * Envoie un email avec pi√®ces jointes\n   */\n  async sendEmail(options: SendEmailOptions): Promise<{ success: boolean; message: string }> {\n    try {\n      // Convertir les pi√®ces jointes en base64 si n√©cessaire\n      const attachments = options.attachments\n        ? await Promise.all(\n            options.attachments.map(async (att) => {\n              let content: string\n              if (att.content instanceof Blob) {\n                content = await this.blobToBase64(att.content)\n              } else if (att.content instanceof ArrayBuffer) {\n                const blob = new Blob([att.content], { type: att.contentType })\n                content = await this.blobToBase64(blob)\n              } else {\n                content = att.content\n              }\n\n              return {\n                filename: att.filename,\n                content,\n                contentType: att.contentType,\n              }\n            })\n          )\n        : undefined\n\n      const response = await fetch('/api/email/send', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include', // Inclure les cookies pour l'authentification\n        body: JSON.stringify({\n          to: options.to,\n          subject: options.subject,\n          html: options.html,\n          text: options.text,\n          attachments,\n          cc: options.cc,\n          bcc: options.bcc,\n          replyTo: options.replyTo,\n        }),\n      })\n\n      if (!response.ok) {\n        const error = await response.json()\n        throw new Error(error.message || 'Erreur lors de l\\'envoi de l\\'email')\n      }\n\n      const data = await response.json()\n      return { success: true, message: data.message || 'Email envoy√© avec succ√®s' }\n    } catch (error) {\n      throw new Error(\n        error instanceof Error\n          ? error.message\n          : 'Erreur lors de l\\'envoi de l\\'email'\n      )\n    }\n  }\n\n  /**\n   * Envoie un document PDF par email\n   */\n  async sendDocument(\n    to: string | string[],\n    subject: string,\n    pdfBlob: Blob,\n    filename: string,\n    htmlBody?: string,\n    textBody?: string\n  ): Promise<{ success: boolean; message: string }> {\n    return this.sendEmail({\n      to,\n      subject,\n      html: htmlBody,\n      text: textBody,\n      attachments: [\n        {\n          filename,\n          content: pdfBlob,\n          contentType: 'application/pdf',\n        },\n      ],\n    })\n  }\n\n  /**\n   * Envoie plusieurs documents par email\n   */\n  async sendMultipleDocuments(\n    to: string | string[],\n    subject: string,\n    documents: Array<{ blob: Blob; filename: string }>,\n    htmlBody?: string,\n    textBody?: string\n  ): Promise<{ success: boolean; message: string }> {\n    return this.sendEmail({\n      to,\n      subject,\n      html: htmlBody,\n      text: textBody,\n      attachments: documents.map((doc) => ({\n        filename: doc.filename,\n        content: doc.blob,\n        contentType: 'application/pdf',\n      })),\n    })\n  }\n}\n\nexport const emailService = new EmailService()\n","/**\n * Service pour g√©rer les alertes syst√®me (email, Slack, etc.)\n * Utilis√© pour notifier les administrateurs en cas d'erreurs critiques ou d'√©v√©nements importants\n */\n\nimport { logger } from '@/lib/utils/logger'\nimport { emailService } from './email.service'\n\nexport type AlertLevel = 'info' | 'warning' | 'error' | 'critical'\nexport type AlertChannel = 'email' | 'slack' | 'both'\n\nexport interface AlertOptions {\n  level: AlertLevel\n  title: string\n  message: string\n  details?: Record<string, any>\n  channel?: AlertChannel\n  recipients?: string[]\n  organizationId?: string\n}\n\nexport class AlertService {\n  /**\n   * Envoie une alerte via les canaux configur√©s\n   */\n  async sendAlert(options: AlertOptions): Promise<void> {\n    const {\n      level,\n      title,\n      message,\n      details = {},\n      channel = 'email',\n      recipients,\n      organizationId,\n    } = options\n\n    try {\n      // Logger l'alerte\n      logger[level === 'critical' || level === 'error' ? 'error' : 'warn'](\n        `[ALERT ${level.toUpperCase()}] ${title}: ${message}`,\n        details\n      )\n\n      // Envoyer via les canaux configur√©s\n      const promises: Promise<void>[] = []\n\n      if (channel === 'email' || channel === 'both') {\n        promises.push(this.sendEmailAlert(options))\n      }\n\n      if (channel === 'slack' || channel === 'both') {\n        promises.push(this.sendSlackAlert(options))\n      }\n\n      await Promise.allSettled(promises)\n    } catch (error) {\n      // Ne pas faire √©chouer l'application si l'alerte √©choue\n      logger.error('Failed to send alert:', error)\n    }\n  }\n\n  /**\n   * Envoie une alerte par email\n   */\n  private async sendEmailAlert(options: AlertOptions): Promise<void> {\n    const { level, title, message, details, recipients, organizationId } = options\n\n    // D√©terminer les destinataires\n    let emailRecipients: string[] = []\n\n    if (recipients && recipients.length > 0) {\n      emailRecipients = recipients\n    } else {\n      // R√©cup√©rer les admins de l'organisation ou les super admins\n      emailRecipients = await this.getAdminEmails(organizationId)\n    }\n\n    if (emailRecipients.length === 0) {\n      logger.warn('No email recipients found for alert')\n      return\n    }\n\n    // Construire le contenu de l'email\n    const subject = `[${level.toUpperCase()}] ${title}`\n    const htmlContent = this.buildEmailContent(level, title, message, details)\n\n    // Envoyer l'email\n    for (const recipient of emailRecipients) {\n      try {\n        await emailService.sendEmail({\n          to: recipient,\n          subject,\n          html: htmlContent,\n        })\n      } catch (error) {\n        logger.error(`Failed to send alert email to ${recipient}:`, error)\n      }\n    }\n  }\n\n  /**\n   * Envoie une alerte via Slack\n   */\n  private async sendSlackAlert(options: AlertOptions): Promise<void> {\n    const { level, title, message, details, organizationId } = options\n\n    const webhookUrl = process.env.SLACK_WEBHOOK_URL\n\n    if (!webhookUrl) {\n      logger.warn('SLACK_WEBHOOK_URL not configured, skipping Slack alert')\n      return\n    }\n\n    try {\n      // D√©terminer la couleur selon le niveau\n      const colorMap: Record<AlertLevel, string> = {\n        info: '#36a64f', // Vert\n        warning: '#ffa500', // Orange\n        error: '#ff0000', // Rouge\n        critical: '#8b0000', // Rouge fonc√©\n      }\n\n      const payload = {\n        text: `*[${level.toUpperCase()}] ${title}*`,\n        attachments: [\n          {\n            color: colorMap[level],\n            fields: [\n              {\n                title: 'Message',\n                value: message,\n                short: false,\n              },\n              ...(organizationId\n                ? [\n                    {\n                      title: 'Organization ID',\n                      value: organizationId,\n                      short: true,\n                    },\n                  ]\n                : []),\n              ...(details && Object.keys(details).length > 0\n                ? [\n                    {\n                      title: 'Details',\n                      value: '```' + JSON.stringify(details, null, 2) + '```',\n                      short: false,\n                    },\n                  ]\n                : []),\n              {\n                title: 'Timestamp',\n                value: new Date().toISOString(),\n                short: true,\n              },\n            ],\n          },\n        ],\n      }\n\n      const response = await fetch(webhookUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(payload),\n      })\n\n      if (!response.ok) {\n        throw new Error(`Slack API returned ${response.status}`)\n      }\n    } catch (error) {\n      logger.error('Failed to send Slack alert:', error)\n      throw error\n    }\n  }\n\n  /**\n   * R√©cup√®re les emails des administrateurs\n   */\n  private async getAdminEmails(organizationId?: string): Promise<string[]> {\n    // Cette fonction devrait √™tre impl√©ment√©e pour r√©cup√©rer les emails des admins\n    // Pour l'instant, on retourne les emails depuis les variables d'environnement\n    const adminEmails = process.env.ADMIN_EMAILS?.split(',') || []\n\n    if (adminEmails.length > 0) {\n      return adminEmails.filter((email) => email.trim().length > 0)\n    }\n\n    // Fallback : utiliser l'email de support\n    const supportEmail = process.env.SUPPORT_EMAIL\n    if (supportEmail) {\n      return [supportEmail]\n    }\n\n    return []\n  }\n\n  /**\n   * Construit le contenu HTML de l'email\n   */\n  private buildEmailContent(\n    level: AlertLevel,\n    title: string,\n    message: string,\n    details?: Record<string, any>\n  ): string {\n    const colorMap: Record<AlertLevel, string> = {\n      info: '#36a64f',\n      warning: '#ffa500',\n      error: '#ff0000',\n      critical: '#8b0000',\n    }\n\n    const color = colorMap[level]\n    const timestamp = new Date().toLocaleString('fr-FR', {\n      dateStyle: 'full',\n      timeStyle: 'long',\n    })\n\n    return `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset=\"UTF-8\">\n          <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n            .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n            .header { background-color: ${color}; color: white; padding: 20px; border-radius: 5px 5px 0 0; }\n            .content { background-color: #f9f9f9; padding: 20px; border: 1px solid #ddd; }\n            .details { background-color: white; padding: 15px; margin-top: 15px; border-radius: 5px; }\n            .footer { text-align: center; margin-top: 20px; color: #666; font-size: 12px; }\n            pre { background-color: #f4f4f4; padding: 10px; border-radius: 3px; overflow-x: auto; }\n          </style>\n        </head>\n        <body>\n          <div class=\"container\">\n            <div class=\"header\">\n              <h2>[${level.toUpperCase()}] ${title}</h2>\n            </div>\n            <div class=\"content\">\n              <p><strong>Message:</strong></p>\n              <p>${message}</p>\n              ${details && Object.keys(details).length > 0 ? `\n                <div class=\"details\">\n                  <p><strong>D√©tails:</strong></p>\n                  <pre>${JSON.stringify(details, null, 2)}</pre>\n                </div>\n              ` : ''}\n            </div>\n            <div class=\"footer\">\n              <p>Alert g√©n√©r√©e le ${timestamp}</p>\n              <p>EDUZEN - Syst√®me de gestion scolaire</p>\n            </div>\n          </div>\n        </body>\n      </html>\n    `\n  }\n\n  /**\n   * Alerte pour erreur critique\n   */\n  async sendCriticalError(\n    error: Error,\n    context?: Record<string, any>\n  ): Promise<void> {\n    await this.sendAlert({\n      level: 'critical',\n      title: 'Erreur Critique',\n      message: error.message,\n      details: {\n        error: error.name,\n        stack: error.stack,\n        ...context,\n      },\n      channel: 'both',\n    })\n  }\n\n  /**\n   * Alerte pour erreur syst√®me\n   */\n  async sendSystemError(\n    message: string,\n    details?: Record<string, any>\n  ): Promise<void> {\n    await this.sendAlert({\n      level: 'error',\n      title: 'Erreur Syst√®me',\n      message,\n      details,\n      channel: 'email',\n    })\n  }\n\n  /**\n   * Alerte pour avertissement\n   */\n  async sendWarning(\n    message: string,\n    details?: Record<string, any>\n  ): Promise<void> {\n    await this.sendAlert({\n      level: 'warning',\n      title: 'Avertissement',\n      message,\n      details,\n      channel: 'email',\n    })\n  }\n\n  /**\n   * Alerte pour information\n   */\n  async sendInfo(\n    message: string,\n    details?: Record<string, any>\n  ): Promise<void> {\n    await this.sendAlert({\n      level: 'info',\n      title: 'Information',\n      message,\n      details,\n      channel: 'email',\n    })\n  }\n}\n\nexport const alertService = new AlertService()\n\n\n\n"],"names":[],"mappings":"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"}