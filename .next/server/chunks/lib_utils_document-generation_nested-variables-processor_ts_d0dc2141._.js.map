{"version":3,"sources":["../../../lib/utils/document-generation/nested-variables-processor.ts"],"sourcesContent":["/**\n * Traitement des variables imbriquées dans les templates\n */\n\nimport type { DocumentVariables } from '@/lib/types/document-templates'\n\n/**\n * Aplatit les variables imbriquées en une structure plate\n * Par exemple : { user: { name: 'John' } } devient { 'user.name': 'John' }\n */\nexport function flattenVariables(variables: DocumentVariables): Record<string, any> {\n  const flattened: Record<string, any> = {}\n  \n  function flatten(obj: any, prefix = ''): void {\n    for (const key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        const newKey = prefix ? `${prefix}.${key}` : key\n        const value = obj[key]\n        \n        if (value !== null && typeof value === 'object' && !Array.isArray(value) && !(value instanceof Date)) {\n          // Récursivement aplatir les objets imbriqués\n          flatten(value, newKey)\n        } else {\n          // Ajouter la valeur aplatie\n          flattened[newKey] = value\n        }\n      }\n    }\n  }\n  \n  flatten(variables)\n  return flattened\n}\n\n/**\n * Traite les variables imbriquées dans le contenu HTML\n * Remplace les références comme {user.name} par leurs valeurs\n */\nexport function processNestedVariables(\n  html: string,\n  variables: Record<string, any>\n): string {\n  let result = html\n  \n  // Remplacer les variables imbriquées au format {object.property}\n  for (const key in variables) {\n    if (variables.hasOwnProperty(key)) {\n      const value = variables[key]\n      if (value !== null && value !== undefined) {\n        // Remplacer {object.property} ou {object_property}\n        const regex = new RegExp(`\\\\{${key.replace(/\\./g, '\\\\.')}\\\\}`, 'g')\n        result = result.replace(regex, String(value))\n      }\n    }\n  }\n  \n  return result\n}\n"],"names":[],"mappings":"wCAUO,SAAS,EAAiB,CAA4B,EAC3D,IAAM,EAAiC,CAAC,EAoBxC,OAlBA,AAiBA,SAjBS,EAAQ,CAAQ,CAAE,EAAS,EAAE,EACpC,IAAK,IAAM,KAAO,EAChB,EADqB,CACjB,EAAI,cAAc,CAAC,GAAM,CAC3B,IAAM,EAAS,EAAS,CAAA,EAAG,EAAO,CAAC,EAAE,EAAA,CAAK,CAAG,EACvC,EAAQ,CAAG,CAAC,EAAI,AAER,QAAV,GAAmC,UAAjB,EAA6B,KAAtB,GAAuB,MAAM,OAAO,CAAC,IAAY,MAAF,CAAC,MAAkB,IAAI,CAKjG,CAAS,CAL2F,AAK1F,EAAO,CAAG,EAHpB,EAAQ,EAAO,EAKnB,CAEJ,EAEQ,GACD,CACT,CAMO,SAAS,EACd,CAAY,CACZ,CAA8B,EAE9B,IAAI,EAAS,EAGb,IAAK,IAAM,KAAO,EAChB,GAAI,EAAU,GADa,WACC,CAAC,GAAM,CACjC,IAAM,EAAQ,CAAS,CAAC,EAAI,CAC5B,SAAI,EAAuC,CAEzC,IAAM,EAAQ,AAAI,CAFN,MAEa,CAAC,CAFN,EAES,EAAE,EAAI,IAFL,GAEY,CAAC,MAAO,OAAO,GAAG,CAAC,CAAE,KAC/D,EAAS,EAAO,OAAO,CAAC,EAAO,OAAO,GACxC,CACF,CAGF,OAAO,CACT"}