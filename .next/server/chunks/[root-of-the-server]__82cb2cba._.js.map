{"version":3,"sources":["../../../node_modules/next/src/server/route-modules/app-page/vendored/rsc/react-jsx-runtime.ts","../../../lib/utils/document-generation/pdf-generator.tsx","../../../lib/utils/document-generation/docx-generator.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-rsc']!.ReactJsxRuntime\n","/**\n * Générateur PDF avec support header/footer répétés sur toutes les pages\n * Utilise @react-pdf/renderer pour les anciens templates (éléments)\n * Utilise Puppeteer pour les nouveaux templates (HTML)\n */\n\nimport * as React from 'react'\nimport { Document, Page, View, Text, Image, StyleSheet, pdf, renderToStream } from '@react-pdf/renderer'\nimport type { DocumentTemplate, DocumentVariables, TemplateElement } from '@/lib/types/document-templates'\nimport puppeteer from 'puppeteer'\nimport { generateHTML } from './html-generator'\n\nexport interface PDFGenerationResult {\n  blob: Blob\n  pageCount: number\n  metadata?: DocumentMetadata\n}\n\n// Styles de base pour le PDF\nconst createStyles = (template: DocumentTemplate) => {\n  const headerHeight = template.header_enabled ? template.header_height : 0\n  const footerHeight = template.footer_enabled ? template.footer_height : 0\n  const margins = template.margins || { top: 20, right: 20, bottom: 20, left: 20 }\n\n  return StyleSheet.create({\n    page: {\n      padding: 0,\n      margin: 0,\n      fontFamily: 'Helvetica',\n    },\n    header: {\n      position: 'absolute',\n      top: 0,\n      left: 0,\n      right: 0,\n      height: headerHeight,\n      backgroundColor: getHeaderBackgroundColor(template.header),\n      paddingTop: 10,\n      paddingLeft: margins.left,\n      paddingRight: margins.right,\n      paddingBottom: 10,\n    },\n    body: {\n      marginTop: headerHeight + margins.top,\n      marginBottom: footerHeight + margins.bottom,\n      marginLeft: margins.left,\n      marginRight: margins.right,\n      padding: 10,\n      minHeight: calculateAvailableHeight(template),\n    },\n    footer: {\n      position: 'absolute',\n      bottom: 0,\n      left: 0,\n      right: 0,\n      height: footerHeight,\n      backgroundColor: template.footer?.backgroundColor || '#F9FAFB',\n      paddingTop: 10,\n      paddingLeft: margins.left,\n      paddingRight: margins.right,\n      paddingBottom: 10,\n      borderTop: template.footer?.border?.top?.enabled\n        ? `${template.footer.border.top.width}px solid ${template.footer.border.top.color}`\n        : 'none',\n    },\n    element: {\n      marginBottom: 10,\n    },\n    text: {\n      fontSize: 12,\n      color: '#000000',\n      lineHeight: 1.5,\n    },\n    textBold: {\n      fontWeight: 'bold',\n    },\n    textItalic: {\n      fontStyle: 'italic',\n    },\n    textCenter: {\n      textAlign: 'center',\n    },\n    textRight: {\n      textAlign: 'right',\n    },\n    pagination: {\n      fontSize: 9,\n      color: '#4D4D4D',\n      textAlign: 'center' as const,\n    },\n  })\n}\n\n/**\n * Génère un PDF à partir d'un template avec header/footer répétés\n */\nexport async function generatePDF(\n  template: DocumentTemplate,\n  variables: DocumentVariables,\n  documentId?: string,\n  organizationId?: string\n): Promise<PDFGenerationResult> {\n  try {\n    // Vérifier si le template a du contenu HTML (nouveau format)\n    const htmlContent = (template.content as any)?.html || ''\n    const headerContent = (template.header as any)?.content || ''\n    const footerContent = (template.footer as any)?.content || ''\n    \n    // Utiliser Puppeteer pour les templates HTML\n    if (htmlContent || headerContent || footerContent) {\n      // Le template utilise le nouveau format HTML - utiliser Puppeteer\n      try {\n        return await generatePDFFromHTML(template, variables, documentId, organizationId)\n      } catch (puppeteerError) {\n        console.error('Erreur Puppeteer:', puppeteerError)\n        const errorMessage = puppeteerError instanceof Error ? puppeteerError.message : String(puppeteerError)\n        throw new Error(\n          `Impossible de générer le PDF avec Puppeteer: ${errorMessage}. ` +\n          `Veuillez vérifier que Chromium est correctement installé.`\n        )\n      }\n    }\n    \n    // Ancien format avec éléments - utiliser React-PDF\n    return await generatePDFFromElements(template, variables)\n  } catch (error) {\n    console.error('Erreur lors de la génération PDF:', error)\n    const errorMessage = error instanceof Error ? error.message : String(error)\n    throw new Error(`Erreur lors de la génération PDF: ${errorMessage}`)\n  }\n}\n\n/**\n * Génère un PDF depuis HTML avec Puppeteer\n */\nasync function generatePDFFromHTML(\n  template: DocumentTemplate,\n  variables: DocumentVariables,\n  documentId?: string,\n  organizationId?: string\n): Promise<PDFGenerationResult> {\n  // Utiliser generateHTML pour bénéficier de toutes les fonctionnalités (API externes, boucles, conditions, etc.)\n  const htmlResult = await generateHTML(template, variables, documentId, organizationId)\n  \n  // Le HTML généré contient déjà tout le document avec header/footer et styles\n  const fullHTML = htmlResult.html\n  \n  // Configuration Puppeteer\n  // Puppeteer nécessite Chromium, ce qui peut poser problème dans certains environnements\n  let browser\n  try {\n    browser = await puppeteer.launch({\n      headless: true,\n      args: [\n        '--no-sandbox',\n        '--disable-setuid-sandbox',\n        '--disable-dev-shm-usage',\n        '--disable-accelerated-2d-canvas',\n        '--no-first-run',\n        '--no-zygote',\n        '--single-process',\n        '--disable-gpu',\n      ],\n      // Essayer d'utiliser le Chromium installé avec Puppeteer\n      executablePath: process.env.PUPPETEER_EXECUTABLE_PATH || undefined,\n    })\n  } catch (launchError) {\n    console.error('Erreur lors du lancement de Puppeteer:', launchError)\n    const errorMessage = launchError instanceof Error ? launchError.message : String(launchError)\n    const errorStack = launchError instanceof Error ? launchError.stack : undefined\n    console.error('Stack trace Puppeteer:', errorStack)\n    throw new Error(\n      `Impossible de lancer Puppeteer. Erreur: ${errorMessage}. ` +\n      `Veuillez vérifier que Chromium est correctement installé.`\n    )\n  }\n  \n  try {\n    const page = await browser.newPage()\n    \n    // Définir la taille de la page\n    const pageSize = template.page_size || 'A4'\n    const pageFormat = pageSize === 'A4' ? 'A4' : pageSize === 'Letter' ? 'Letter' : 'A4'\n    \n    // Charger le HTML\n    await page.setContent(fullHTML, {\n      waitUntil: 'networkidle0',\n    })\n    \n    // Générer le PDF\n    const pdfBuffer = await page.pdf({\n      format: pageFormat,\n      printBackground: true,\n      margin: {\n        top: '0mm',\n        right: '0mm',\n        bottom: '0mm',\n        left: '0mm',\n      },\n      preferCSSPageSize: true,\n    })\n    \n    // Créer un Blob à partir du buffer\n    const pdfBlob = new Blob([pdfBuffer as BlobPart], { type: 'application/pdf' })\n    \n    // Estimer le nombre de pages (approximation basée sur la hauteur du contenu)\n    // Note: Pour un calcul précis, il faudrait générer le PDF deux fois ou utiliser une méthode différente\n    const estimatedPageCount = Math.max(1, Math.ceil(pdfBuffer.length / 50000))\n    \n    return {\n      blob: pdfBlob,\n      pageCount: htmlResult.pageCount || estimatedPageCount,\n    }\n  } finally {\n    await browser.close()\n  }\n}\n\n/**\n * Génère un PDF depuis les éléments de template (ancien format) avec React-PDF\n */\nasync function generatePDFFromElements(\n  template: DocumentTemplate,\n  variables: DocumentVariables\n): Promise<PDFGenerationResult> {\n  const styles = createStyles(template)\n  const pages = calculatePages(template, variables)\n\n  // Composant React pour le document PDF\n  const PDFDocument = () => (\n    <Document>\n      {pages.map((pageElements, pageIndex) => (\n        <Page key={pageIndex} size={(template.page_size || 'A4') as any} style={styles.page}>\n          {/* Header répété sur chaque page si activé */}\n          {template.header_enabled && template.header && (\n            <View style={styles.header} fixed>\n              {renderElements(template.header.elements || [], variables, styles)}\n            </View>\n          )}\n\n          {/* Corps du document */}\n          <View style={styles.body}>\n            {renderElements(pageElements, variables, styles)}\n          </View>\n\n          {/* Footer répété sur chaque page si activé */}\n          {template.footer_enabled && template.footer && (\n            <View style={styles.footer} fixed>\n              {/* Pagination automatique */}\n              {(template.footer as any)?.pagination?.enabled && (\n                <Text\n                  style={[\n                    styles.pagination,\n                    {\n                      textAlign:\n                        (template.footer as any).pagination.position === 'left'\n                          ? 'left'\n                          : (template.footer as any).pagination.position === 'right'\n                          ? 'right'\n                          : 'center',\n                    },\n                  ]}\n                  render={({ pageNumber, totalPages }) =>\n                    replaceVariables((template.footer as any).pagination?.format || 'Page {numero_page} / {total_pages}', {\n                      ...variables,\n                      numero_page: pageNumber,\n                      total_pages: totalPages,\n                    })\n                  }\n                  fixed\n                />\n              )}\n              {/* Éléments du footer */}\n              {renderElements((template.footer as any).elements || [], {\n                ...variables,\n                numero_page: pageIndex + 1,\n                total_pages: pages.length,\n              }, styles)}\n            </View>\n          )}\n        </Page>\n      ))}\n    </Document>\n  )\n  \n  // Générer le PDF avec React-PDF\n  // Note: React-PDF peut être utilisé côté serveur avec renderToStream\n  try {\n    const pdfDoc = <PDFDocument />\n    const pdfBlob = await pdf(pdfDoc).toBlob()\n    \n    return {\n      blob: pdfBlob,\n      pageCount: pages.length,\n    }\n  } catch (reactPdfError) {\n    console.error('Erreur React-PDF:', reactPdfError)\n    const errorMessage = reactPdfError instanceof Error ? reactPdfError.message : String(reactPdfError)\n    throw new Error(`Erreur lors de la génération PDF avec React-PDF: ${errorMessage}`)\n  }\n}\n\n/**\n * Calcule les pages nécessaires pour le contenu\n */\nfunction calculatePages(\n  template: DocumentTemplate,\n  variables: DocumentVariables\n): TemplateElement[][] {\n  const content = template.content || { elements: [], pageSize: 'A4', margins: { top: 20, right: 20, bottom: 20, left: 20 } }\n  const elements = content.elements || []\n\n  if (elements.length === 0) {\n    return [[]]\n  }\n\n  // Calculer l'espace disponible\n  const availableHeight = calculateAvailableHeight(template)\n\n  // Répartir les éléments sur plusieurs pages si nécessaire\n  const pages: TemplateElement[][] = [[]]\n  let currentPageHeight = 0\n  let currentPage = 0\n\n  elements.forEach((element) => {\n    const elementHeight = estimateElementHeight(element, variables)\n\n    // Si l'élément dépasse la hauteur disponible, créer une nouvelle page\n    if (currentPageHeight + elementHeight > availableHeight && currentPageHeight > 0) {\n      currentPage++\n      pages[currentPage] = []\n      currentPageHeight = 0\n    }\n\n    pages[currentPage].push(element)\n    currentPageHeight += elementHeight + 20 // 20pt d'espacement entre éléments\n  })\n\n  return pages\n}\n\n/**\n * Calcule la hauteur disponible pour le contenu (en points)\n */\nfunction calculateAvailableHeight(template: DocumentTemplate): number {\n  const pageHeights = {\n    A4: 792, // points (8.27\" x 11.69\" = 595pt x 842pt, mais on utilise la hauteur)\n    Letter: 792,\n    Legal: 1008,\n  }\n\n  const pageHeight = pageHeights[template.page_size || 'A4']\n  const headerHeight = template.header_enabled ? template.header_height : 0\n  const footerHeight = template.footer_enabled ? template.footer_height : 0\n  const margins = template.margins || { top: 20, right: 20, bottom: 20, left: 20 }\n\n  return pageHeight - headerHeight - footerHeight - margins.top - margins.bottom - 20 // Padding\n}\n\n/**\n * Estime la hauteur d'un élément en points\n */\nfunction estimateElementHeight(element: TemplateElement, variables: DocumentVariables): number {\n  const fontSize = element.style?.fontSize || 12\n  const lineHeight = element.style?.lineHeight || 1.5\n\n  switch (element.type) {\n    case 'text':\n      if (element.content) {\n        const content = replaceVariables(element.content, variables)\n        // Estimation: ~80 caractères par ligne pour une largeur de 500pt\n        const charsPerLine = Math.floor(500 / (fontSize * 0.6))\n        const lines = Math.ceil(content.length / charsPerLine) || 1\n        return lines * fontSize * lineHeight + 10 // Padding\n      }\n      return fontSize * lineHeight + 10\n\n    case 'image':\n      return element.size?.height || 100\n\n    case 'table':\n      const rowCount = element.tableData?.rows?.length || 0\n      return (rowCount + 1) * 30 + 20 // Header + rows\n\n    case 'signature':\n      return element.size?.height || 80\n\n    case 'qrcode':\n    case 'barcode':\n      return element.size?.height || 60\n\n    case 'line':\n      return 1\n\n    case 'spacer':\n      return element.size?.height || 20\n\n    default:\n      return 30\n  }\n}\n\n/**\n * Rend les éléments d'un template\n */\nfunction renderElements(\n  elements: TemplateElement[],\n  variables: DocumentVariables,\n  styles: ReturnType<typeof createStyles>\n): React.ReactNode[] {\n  return elements.map((element, index) => {\n    switch (element.type) {\n      case 'text':\n        return (\n          <View key={element.id || index} style={styles.element}>\n            <Text\n              style={[\n                styles.text,\n                element.style?.fontSize && { fontSize: element.style.fontSize },\n                element.style?.color && { color: element.style.color },\n                element.style?.fontWeight === 'bold' && styles.textBold,\n                element.style?.fontStyle === 'italic' && styles.textItalic,\n                element.style?.textAlign === 'center' && styles.textCenter,\n                element.style?.textAlign === 'right' && styles.textRight,\n              ] as any}\n            >\n              {element.content ? replaceVariables(element.content, variables) : ''}\n            </Text>\n          </View>\n        )\n\n      case 'image':\n        // TODO: Implémenter le rendu d'images (nécessite une URL ou base64)\n        return (\n          <View key={element.id || index} style={styles.element}>\n            <Text style={styles.text}>[Image: {element.source || 'Non définie'}]</Text>\n          </View>\n        )\n\n      case 'table':\n        if (!element.tableData) return null\n        return (\n          <View key={element.id || index} style={styles.element}>\n            {/* TODO: Implémenter le rendu de tableaux */}\n            <Text style={styles.text}>[Tableau: {element.tableData.headers.length} colonnes]</Text>\n          </View>\n        )\n\n      case 'line':\n        return (\n          <View\n            key={element.id || index}\n            style={{\n              height: element.style?.border?.width || 1,\n              backgroundColor: element.style?.color || '#000000',\n              marginVertical: 10,\n            }}\n          />\n        )\n\n      case 'spacer':\n        return (\n          <View\n            key={element.id || index}\n            style={{ height: element.size?.height || 20 }}\n          />\n        )\n\n      case 'signature':\n        return (\n          <View key={element.id || index} style={styles.element}>\n            <View\n              style={{\n                height: element.size?.height || 80,\n                width: element.size?.width || 150,\n                border: '1px solid #000000',\n                padding: 10,\n              }}\n            >\n              {element.label && (\n                <Text style={[styles.text, { fontSize: 10 }]}>{element.label}</Text>\n              )}\n              <Text style={[styles.text, { fontSize: 8, marginTop: 30 }]}>\n                Signature\n              </Text>\n            </View>\n          </View>\n        )\n\n      case 'qrcode':\n      case 'barcode':\n        // TODO: Implémenter le rendu de QR codes et codes-barres\n        return (\n          <View key={element.id || index} style={styles.element}>\n            <Text style={styles.text}>\n              [{element.type === 'qrcode' ? 'QR Code' : 'Code-barres'}: {element.qrData || element.barcodeData || 'Non défini'}]\n            </Text>\n          </View>\n        )\n\n      default:\n        return null\n    }\n  })\n}\n\n/**\n * Remplace les variables dans un texte\n */\nfunction replaceVariables(text: string, variables: DocumentVariables): string {\n  let result = text\n  Object.entries(variables).forEach(([key, value]) => {\n    const regex = new RegExp(`\\\\{${key}\\\\}`, 'g')\n    result = result.replace(regex, String(value || ''))\n  })\n  return result\n}\n\n/**\n * Obtient la couleur de fond du header\n */\nfunction getHeaderBackgroundColor(\n  header: DocumentTemplate['header']\n): string {\n  if (!header?.backgroundColor) return '#FFFFFF'\n\n  if (header.backgroundColor.type === 'solid') {\n    return header.backgroundColor.color || '#FFFFFF'\n  }\n\n  // Pour les gradients, on retourne la première couleur\n  // @react-pdf/renderer supporte les gradients mais c'est plus complexe\n  return header.backgroundColor.from || '#FFFFFF'\n}\nimport { processConditionals } from './conditional-processor'\nimport { processLoops } from './loop-processor'\nimport { processCalculatedVariables } from './calculated-variables'\nimport { processDynamicTables } from './dynamic-table-processor'\nimport { processElementVisibility } from './element-visibility-processor'\nimport { processNestedVariables, flattenVariables } from './nested-variables-processor'\nimport { processDynamicHyperlinks } from './dynamic-hyperlinks-processor'\n// import { extractMetadataFromVariables, formatMetadataForPDF, type DocumentMetadata } from './metadata-processor'\ntype DocumentMetadata = Record<string, unknown>\n\n/**\n * Remplace les variables dans du HTML\n */\n// Fonction pour remplacer les variables dans le HTML (y compris QR codes et codes-barres)\nfunction replaceVariablesInHTML(html: string, variables: DocumentVariables): string {\n  // Aplatir les variables imbriquées pour compatibilité\n  const flattenedVariables = flattenVariables(variables)\n\n  // Traiter dans l'ordre : tableaux dynamiques -> boucles -> conditions -> visibilité -> variables calculées -> variables imbriquées -> remplacement de variables\n  let result = html\n\n  // 1. Traiter les tableaux dynamiques\n  result = processDynamicTables(result, flattenedVariables)\n\n  // 2. Traiter les boucles (FOR/WHILE)\n  result = processLoops(result, flattenedVariables)\n\n  // 3. Traiter les conditions (IF/ELSE)\n  result = processConditionals(result, flattenedVariables)\n\n  // 4. Traiter la visibilité conditionnelle (SHOW_IF/HIDE_IF)\n  result = processElementVisibility(result, flattenedVariables)\n\n  // 5. Traiter les variables calculées (SUM, AVERAGE, etc.)\n  result = processCalculatedVariables(result, flattenedVariables)\n\n  // 6. Traiter les variables imbriquées (object.property, array[index])\n  result = processNestedVariables(result, flattenedVariables)\n  \n  // Traiter les QR codes avec variables dynamiques\n  result = result.replace(/<img([^>]*?)class=\"qr-code-dynamic\"([^>]*?)data-qr-data=\"([^\"]*)\"([^>]*?)>/g, (match, before, middle, data, after) => {\n    let processedData = data\n    Object.entries(variables).forEach(([key, value]) => {\n      const regex = new RegExp(`\\\\{${key}\\\\}`, 'g')\n      processedData = processedData.replace(regex, String(value))\n    })\n    // Extraire la taille depuis le style\n    const sizeMatch = match.match(/max-width:\\s*(\\d+)px/)\n    const size = sizeMatch ? sizeMatch[1] : '200'\n    const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${size}x${size}&data=${encodeURIComponent(processedData)}`\n    return `<img${before}${middle}src=\"${qrCodeUrl}\" data-qr-data=\"${processedData}\"${after}>`\n  })\n  \n  // Traiter les codes-barres avec variables dynamiques\n  result = result.replace(/<img([^>]*?)class=\"barcode-dynamic\"([^>]*?)data-barcode-data=\"([^\"]*)\"([^>]*?)data-barcode-type=\"([^\"]*)\"([^>]*?)>/g, (match, before, middle1, data, middle2, type, after) => {\n    let processedData = data\n    Object.entries(variables).forEach(([key, value]) => {\n      const regex = new RegExp(`\\\\{${key}\\\\}`, 'g')\n      processedData = processedData.replace(regex, String(value))\n    })\n    // Extraire la largeur et hauteur depuis le style\n    const widthMatch = match.match(/max-width:\\s*(\\d+)px/)\n    const heightMatch = match.match(/height:\\s*(\\d+)px/)\n    const width = widthMatch ? widthMatch[1] : '200'\n    const height = heightMatch ? heightMatch[1] : '50'\n    const barcodeUrl = `https://barcode.tec-it.com/barcode.ashx?data=${encodeURIComponent(processedData)}&code=${type}&dpi=96&dataseparator=`\n    return `<img${before}${middle1}src=\"${barcodeUrl}\" data-barcode-data=\"${processedData}\"${middle2}data-barcode-type=\"${type}\"${after}>`\n  })\n  \n  // Ensuite, remplacer les variables restantes dans le texte\n  Object.entries(variables).forEach(([key, value]) => {\n    // Remplacer {variable} dans le HTML (mais pas dans les attributs src déjà traités)\n    const regex = new RegExp(`\\\\{${key}\\\\}`, 'g')\n    const replacement = value ? String(value).replace(/</g, '&lt;').replace(/>/g, '&gt;') : ''\n    result = result.replace(regex, replacement)\n  })\n  return result\n}\n\n/**\n * Extrait et traite les styles du body HTML\n */\nfunction processBodyStyles(html: string): string {\n  // Extrait les styles inline et les convertit en CSS si nécessaire\n  // Pour l'instant, on retourne une chaîne vide car les styles sont déjà dans le HTML\n  return ''\n}\n\n/**\n * Traite la pagination dans le footer\n */\nfunction processFooterPagination(\n  footerHTML: string,\n  template: DocumentTemplate,\n  variables: DocumentVariables\n): string {\n  if (!template.footer?.pagination?.enabled) {\n    return footerHTML\n  }\n  \n  // Remplace {numero_page} et {total_pages} dans le footer\n  // Note: Puppeteer ne gère pas automatiquement la pagination, on doit utiliser du CSS\n  // Pour l'instant, on retourne le footer tel quel et on compte sur le CSS\n  const paginationFormat = (template.footer as any)?.pagination?.format || 'Page {numero_page} / {total_pages}'\n  const paginationText = replaceVariables(paginationFormat, {\n    ...variables,\n    numero_page: 1, // Sera remplacé dynamiquement si nécessaire\n    total_pages: 1,\n  })\n  \n  // Ajouter la pagination au footer si elle n'y est pas déjà\n  if (!footerHTML.includes('{numero_page}') && !footerHTML.includes(paginationText)) {\n    const position = (template.footer as any)?.pagination?.position || 'center'\n    const textAlign = position === 'left' ? 'left' : position === 'right' ? 'right' : 'center'\n    return `${footerHTML}<div style=\"text-align: ${textAlign}; font-size: 9pt; color: #4D4D4D; margin-top: 10px;\">\n      ${paginationText.replace(/\\{numero_page\\}/g, '<span class=\"page-number\"></span>').replace(/\\{total_pages\\}/g, '<span class=\"total-pages\"></span>')}\n    </div>`\n  }\n  \n  return footerHTML\n}\n","/**\n * Générateur Word (.docx) avec support header/footer répétés sur toutes les pages\n * Utilise la bibliothèque docx\n */\n\nimport {\n  Document,\n  Packer,\n  Paragraph,\n  Header,\n  Footer,\n  TextRun,\n  AlignmentType,\n  PageNumber,\n  PageBreak,\n  Table,\n  TableRow,\n  TableCell,\n  WidthType,\n  BorderStyle,\n  ExternalHyperlink,\n  ImageRun,\n  HeadingLevel,\n} from 'docx'\nimport type { DocumentTemplate, DocumentVariables, TemplateElement } from '@/lib/types/document-templates'\n\nexport interface DOCXGenerationResult {\n  blob: Blob\n  pageCount: number\n}\n\n/**\n * Génère un document Word à partir d'un template avec header/footer répétés\n */\nexport async function generateDOCX(\n  template: DocumentTemplate,\n  variables: DocumentVariables,\n  documentId?: string,\n  organizationId?: string\n): Promise<DOCXGenerationResult> {\n  const margins = template.margins || { top: 20, right: 20, bottom: 20, left: 20 }\n  const pages = calculatePages(template, variables)\n\n  // Créer les enfants du document (contenu + sauts de page)\n  const children: (Paragraph | Table)[] = []\n\n  pages.forEach((pageElements, pageIndex) => {\n    // Ajouter les éléments de la page\n    pageElements.forEach((element) => {\n      const rendered = renderElement(element, variables)\n      if (rendered) {\n        if (Array.isArray(rendered)) {\n          children.push(...rendered)\n        } else {\n          children.push(rendered)\n        }\n      }\n    })\n\n    // Ajouter un saut de page sauf pour la dernière page\n    if (pageIndex < pages.length - 1) {\n      children.push(new Paragraph({ children: [new PageBreak()] }))\n    }\n  })\n\n  // Créer le document avec header/footer\n  const doc = new Document({\n    sections: [\n      {\n        properties: {\n          page: {\n            size: {\n              width: getPageWidth(template.page_size || 'A4'),\n              height: getPageHeight(template.page_size || 'A4'),\n            },\n            margin: {\n              top: convertPxToDXA(margins.top + (template.header_enabled ? template.header_height : 0)),\n              right: convertPxToDXA(margins.right),\n              bottom: convertPxToDXA(margins.bottom + (template.footer_enabled ? template.footer_height : 0)),\n              left: convertPxToDXA(margins.left),\n            },\n          },\n        },\n\n        // Header\n        headers: {\n          default:\n            template.header_enabled && template.header\n              ? new Header({\n                  children: renderElements(\n                    template.header.elements || [],\n                    variables\n                  ).filter((el): el is Paragraph => el instanceof Paragraph),\n                })\n              : undefined,\n        },\n\n        // Body\n        children,\n\n        // Footer\n        footers: {\n          default:\n            template.footer_enabled && template.footer\n              ? new Footer({\n                  children: [\n                    // Pagination\n                    ...(template.footer.pagination?.enabled\n                      ? [\n                          new Paragraph({\n                            alignment: getAlignmentType(template.footer.pagination.position),\n                            children: [\n                              new TextRun({\n                                text: replacePaginationFormat(\n                                  template.footer.pagination.format || 'Page {numero_page} / {total_pages}',\n                                  variables,\n                                  pages.length\n                                ),\n                              }),\n                            ],\n                            style: 'footer',\n                          }),\n                        ]\n                      : []),\n                    // Éléments du footer\n                    ...renderElements(template.footer.elements || [], {\n                      ...variables,\n                      numero_page: 1,\n                      total_pages: pages.length,\n                    }).filter((el): el is Paragraph => el instanceof Paragraph),\n                  ],\n                })\n              : undefined,\n        },\n      },\n    ],\n  })\n\n  // Générer le blob DOCX\n  const blob = await Packer.toBlob(doc)\n\n  return {\n    blob,\n    pageCount: pages.length,\n  }\n}\n\n/**\n * Rend un élément en format Word\n */\nfunction renderElement(\n  element: TemplateElement,\n  variables: DocumentVariables\n): Paragraph | Paragraph[] | null {\n  switch (element.type) {\n    case 'text':\n      return new Paragraph({\n        children: [\n          new TextRun({\n            text: element.content ? replaceVariables(element.content, variables) : '',\n            bold: element.style?.fontWeight === 'bold',\n            italics: element.style?.fontStyle === 'italic',\n            color: element.style?.color?.replace('#', '') || '000000',\n            size: element.style?.fontSize ? element.style.fontSize * 2 : 24, // docx utilise des demi-points\n          }),\n        ],\n        alignment: getAlignmentType(element.style?.textAlign),\n        spacing: {\n          after: 200, // 10pt\n        },\n      })\n\n    case 'line':\n      return new Paragraph({\n        children: [\n          new TextRun({\n            text: '─'.repeat(50),\n            color: element.style?.color?.replace('#', '') || '000000',\n          }),\n        ],\n        spacing: {\n          after: 200,\n        },\n      })\n\n    case 'spacer':\n      return new Paragraph({\n        text: '',\n        spacing: {\n          after: (element.size?.height || 20) * 20, // Convertir px en demi-points\n        },\n      })\n\n    case 'table':\n      if (!element.tableData) return null\n      return new Paragraph({\n        children: [\n          // TODO: Créer une vraie table avec Table, TableRow, TableCell\n          new TextRun({\n            text: `[Tableau: ${element.tableData.headers.join(', ')}]`,\n          }),\n        ],\n      })\n\n    default:\n      return null\n  }\n}\n\n/**\n * Rend plusieurs éléments\n */\nfunction renderElements(\n  elements: TemplateElement[],\n  variables: DocumentVariables\n): (Paragraph | Table)[] {\n  const results: (Paragraph | Table)[] = []\n\n  elements.forEach((element) => {\n    const rendered = renderElement(element, variables)\n    if (rendered) {\n      if (Array.isArray(rendered)) {\n        results.push(...rendered)\n      } else {\n        results.push(rendered)\n      }\n    }\n  })\n\n  return results\n}\n\n/**\n * Calcule les pages nécessaires pour le contenu\n */\nfunction calculatePages(\n  template: DocumentTemplate,\n  variables: DocumentVariables\n): TemplateElement[][] {\n  const content = template.content || {\n    elements: [],\n    pageSize: 'A4',\n    margins: { top: 20, right: 20, bottom: 20, left: 20 },\n  }\n  const elements = content.elements || []\n\n  if (elements.length === 0) {\n    return [[]]\n  }\n\n  // Pour l'instant, on met tous les éléments sur une page\n  // TODO: Implémenter la vraie pagination basée sur la hauteur\n  return [elements]\n}\n\n/**\n * Convertit des pixels en DXA (unités Word)\n */\nfunction convertPxToDXA(px: number): number {\n  // 1 DXA = 1/20 point, 1 point = 1/72 inch, 1 inch = 96 px\n  // Donc: px * (1/96) * 72 * 20 = px * 15\n  return Math.round(px * 15)\n}\n\n/**\n * Convertit l'alignement CSS en AlignmentType de docx\n */\nfunction getAlignmentType(\n  align?: 'left' | 'center' | 'right' | 'justify'\n): typeof AlignmentType[keyof typeof AlignmentType] {\n  switch (align) {\n    case 'center':\n      return AlignmentType.CENTER\n    case 'right':\n      return AlignmentType.RIGHT\n    case 'justify':\n      return AlignmentType.JUSTIFIED\n    default:\n      return AlignmentType.LEFT\n  }\n}\n\nimport { processConditionals } from './conditional-processor'\nimport { processLoops } from './loop-processor'\nimport { processCalculatedVariables } from './calculated-variables'\nimport { processDynamicTables } from './dynamic-table-processor'\nimport { processElementVisibility } from './element-visibility-processor'\nimport { processNestedVariables, flattenVariables } from './nested-variables-processor'\nimport { processDynamicHyperlinks } from './dynamic-hyperlinks-processor'\n\n/**\n * Remplace les variables dans un texte et traite les conditions\n */\nfunction replaceVariables(text: string, variables: DocumentVariables): string {\n  // Aplatir les variables imbriquées pour compatibilité\n  const flattenedVariables = flattenVariables(variables)\n\n  // Traiter dans l'ordre : tableaux dynamiques -> boucles -> conditions -> visibilité -> variables calculées -> variables imbriquées -> remplacement de variables\n  let result = text\n\n  // 1. Traiter les tableaux dynamiques\n  result = processDynamicTables(result, flattenedVariables)\n\n  // 2. Traiter les boucles (FOR/WHILE)\n  result = processLoops(result, flattenedVariables)\n\n  // 3. Traiter les conditions (IF/ELSE)\n  result = processConditionals(result, flattenedVariables)\n\n  // 4. Traiter la visibilité conditionnelle (SHOW_IF/HIDE_IF)\n  result = processElementVisibility(result, flattenedVariables)\n\n  // 5. Traiter les variables calculées (SUM, AVERAGE, etc.)\n  result = processCalculatedVariables(result, flattenedVariables)\n\n  // 6. Traiter les variables imbriquées (object.property, array[index])\n  result = processNestedVariables(result, flattenedVariables)\n\n  // 7. Traiter les liens hypertextes dynamiques (LINK, EMAIL, PHONE, SMS)\n  result = processDynamicHyperlinks(result, flattenedVariables)\n\n  // 8. Remplacer les variables restantes\n  Object.entries(flattenedVariables).forEach(([key, value]) => {\n    const regex = new RegExp(`\\\\{${key}\\\\}`, 'g')\n    result = result.replace(regex, String(value || ''))\n  })\n  return result\n}\n\n/**\n * Remplace le format de pagination avec les numéros de page\n */\nfunction replacePaginationFormat(\n  format: string,\n  variables: DocumentVariables,\n  totalPages: number\n): string {\n  // Pour Word, on utilise des champs spéciaux qui seront remplacés lors du rendu\n  // Pour l'instant, on fait une substitution basique\n  let result = format\n    .replace(/\\{numero_page\\}/g, '1') // Sera remplacé par PageNumber.CURRENT dans la vraie implémentation\n    .replace(/\\{total_pages\\}/g, String(totalPages))\n\n  return result\n}\n\n/**\n * Obtient la largeur de page en DXA\n */\nfunction getPageWidth(size: 'A4' | 'Letter' | 'Legal'): number {\n  const widths = {\n    A4: 11906, // 8.27\" * 1440 DXA/inch\n    Letter: 12240, // 8.5\" * 1440\n    Legal: 12240, // 8.5\" * 1440\n  }\n  return widths[size] || widths.A4\n}\n\n/**\n * Obtient la hauteur de page en DXA\n */\nfunction getPageHeight(size: 'A4' | 'Letter' | 'Legal'): number {\n  const heights = {\n    A4: 16838, // 11.69\" * 1440 DXA/inch\n    Letter: 15840, // 11\" * 1440\n    Legal: 20160, // 14\" * 1440\n  }\n  return heights[size] || heights.A4\n}\n"],"names":["module","exports","require","vendored","ReactJsxRuntime"],"mappings":"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","ignoreList":[0]}