(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let t=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],107233)},263488,e=>{"use strict";let t=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>t],263488)},319036,e=>{"use strict";var t=e.i(843476),a=e.i(271645),i=e.i(647163);let s=a.forwardRef(({checked:e,onCheckedChange:a,disabled:s,className:l,...r},n)=>(0,t.jsx)("button",{type:"button",role:"switch","aria-checked":e,ref:n,disabled:s,onClick:()=>a?.(!e),className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e?"bg-brand-blue":"bg-input",l),...r,children:(0,t.jsx)("span",{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",e?"translate-x-5":"translate-x-0")})}));s.displayName="Switch",e.s(["Switch",0,s])},436332,e=>{"use strict";let t=(0,e.i(475254).default)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);e.s(["Edit",()=>t],436332)},62870,e=>{"use strict";var t=e.i(843476),a=e.i(271645),i=e.i(647163);e.i(882205);var s=e.i(846932),l=e.i(88653),r=e.i(664659),n=e.i(898791);a.forwardRef(({className:e,label:o,error:d,helperText:c,variant:u="default",leftIcon:m,id:p,options:h,placeholder:x,value:f,...b},g)=>{let[v,y]=a.useState(!1),[_,j]=a.useState(!1),w=p||`select-${Math.random().toString(36).substr(2,9)}`,N=(0,i.cn)("flex w-full rounded-lg font-medium transition-all duration-300","appearance-none cursor-pointer","focus:outline-none focus:ring-2 focus:ring-primary/20","disabled:cursor-not-allowed disabled:opacity-50",{"border-2 border-input bg-background px-4 py-3 pr-11":"default"===u,"focus:border-primary focus:bg-white":"default"===u&&!d,"border-destructive focus:border-destructive focus:ring-destructive/20":d,"border-2 border-input bg-transparent px-4 py-3 pr-11":"outlined"===u,"focus:border-primary focus:shadow-md focus:shadow-primary/10":"outlined"===u&&!d,"border-0 border-b-2 border-input bg-muted/50 px-4 py-3 pr-11 rounded-b-none":"filled"===u,"focus:bg-muted focus:border-primary":"filled"===u&&!d,"focus:border-destructive bg-destructive/5":"filled"===u&&d},m&&"pl-11",e);return(0,t.jsxs)("div",{className:"w-full space-y-1.5",children:[o&&(0,t.jsxs)(s.motion.label,{htmlFor:w,initial:!1,animate:{color:d?"#EF4444":v?"rgb(37, 99, 235)":"rgb(107, 114, 128)"},className:(0,i.cn)("block text-sm font-medium transition-colors duration-200",d&&"text-destructive"),children:[o,b.required&&(0,t.jsx)("span",{className:"text-destructive ml-1",children:"*"})]}),(0,t.jsxs)("div",{className:"relative",children:[m&&(0,t.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none z-10",children:m}),(0,t.jsxs)(s.motion.select,{ref:g,id:w,value:f,...b,onFocus:e=>{y(!0),b.onFocus?.(e)},onBlur:e=>{y(!1),j(!1),b.onBlur?.(e)},onMouseDown:()=>j(!_),className:N,animate:{scale:v?1.01:1,borderColor:d?"#EF4444":v?"rgb(37, 99, 235)":"rgb(226, 232, 240)"},transition:{duration:.2},children:[x&&(0,t.jsx)("option",{value:"",disabled:!0,children:x}),(h||[]).map(e=>(0,t.jsx)("option",{value:e.value,disabled:e.disabled,children:e.label},e.value))]}),(0,t.jsx)(s.motion.div,{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground",animate:{rotate:180*!!_},transition:{duration:.2},children:(0,t.jsx)(r.ChevronDown,{className:"h-5 w-5"})}),d&&(0,t.jsx)(s.motion.div,{className:"absolute right-11 top-1/2 -translate-y-1/2 pointer-events-none",initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:(0,t.jsx)(n.AlertCircle,{className:"h-5 w-5 text-destructive"})})]}),(0,t.jsx)(l.AnimatePresence,{mode:"wait",children:(d||c)&&(0,t.jsx)(s.motion.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.2},className:(0,i.cn)("text-xs transition-colors duration-200",d?"text-destructive":"text-muted-foreground"),children:d||c})})]})}).displayName="SelectNative";let o=a.createContext({}),d=a.forwardRef(({value:e,onValueChange:i,children:s},l)=>{let[r,n]=a.useState(!1);return(0,t.jsx)(o.Provider,{value:{value:e,onValueChange:i,open:r,setOpen:n},children:(0,t.jsx)("div",{className:"relative",ref:l,children:s})})});d.displayName="SelectRoot";let c=a.forwardRef(({children:e,className:s,...l},n)=>{let{open:d,setOpen:c}=a.useContext(o);return(0,t.jsxs)("button",{ref:n,type:"button",className:(0,i.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),onClick:()=>c?.(!d),...l,children:[e,(0,t.jsx)(r.ChevronDown,{className:(0,i.cn)("h-4 w-4 opacity-50 transition-transform",d&&"rotate-180")})]})});c.displayName="SelectTrigger";let u=a.forwardRef(({placeholder:e},i)=>{let{value:s}=a.useContext(o);return(0,t.jsx)("span",{ref:i,children:s||e})});u.displayName="SelectValue";let m=a.forwardRef(({children:e},i)=>{let s=a.useContext(o);return s?.open&&e?(0,t.jsx)("div",{ref:i,className:"absolute top-full left-0 z-50 mt-1 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md",children:(0,t.jsx)("div",{className:"p-1",children:e})}):null});m.displayName="SelectContent";let p=a.forwardRef(({value:e,children:s,className:l,...r},n)=>{let{value:d,onValueChange:c,setOpen:u}=a.useContext(o),m=d===e;return(0,t.jsx)("div",{ref:n,role:"option","aria-selected":m,className:(0,i.cn)("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 px-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",m&&"bg-accent text-accent-foreground",l),onClick:()=>{c?.(e),u?.(!1)},...r,children:s})});p.displayName="SelectItem",e.s(["Select",0,d,"SelectContent",0,m,"SelectItem",0,p,"SelectRoot",0,d,"SelectTrigger",0,c,"SelectValue",0,u])},910419,e=>{"use strict";var t=e.i(920755);let a=new class{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async getAll(e){let{data:t,error:a}=await this.supabase.from("email_templates").select("*").eq("organization_id",e).eq("is_active",!0).order("email_type",{ascending:!0}).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(a)throw a;return t||[]}async getByType(e,t){let{data:a,error:i}=await this.supabase.from("email_templates").select("*").eq("organization_id",e).eq("email_type",t).eq("is_active",!0).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(i)throw i;return a||[]}async getDefault(e,t){let{data:a,error:i}=await this.supabase.from("email_templates").select("*").eq("organization_id",e).eq("email_type",t).eq("is_default",!0).eq("is_active",!0).maybeSingle();if(i)throw i;return a}async getById(e){let{data:t,error:a}=await this.supabase.from("email_templates").select("*").eq("id",e).maybeSingle();if(a)throw a;return t}async create(e,t){e.is_default&&await this.unsetOtherDefaults(e.organization_id,e.email_type);let{data:a,error:i}=await this.supabase.from("email_templates").insert({...e,created_by:t,available_variables:e.available_variables||[]}).select().single();if(i)throw i;return a}async update(e,t){let a=await this.getById(e);if(!a)throw Error("Modèle non trouvé");t.is_default&&await this.unsetOtherDefaults(a.organization_id,a.email_type,e);let{data:i,error:s}=await this.supabase.from("email_templates").update(t).eq("id",e).select().single();if(s)throw s;return i}async delete(e){let{error:t}=await this.supabase.from("email_templates").update({is_active:!1}).eq("id",e);if(t)throw t}async deletePermanently(e){let{error:t}=await this.supabase.from("email_templates").delete().eq("id",e);if(t)throw t}async unsetOtherDefaults(e,t,a){let i=this.supabase.from("email_templates").update({is_default:!1}).eq("organization_id",e).eq("email_type",t).eq("is_default",!0);a&&(i=i.neq("id",a));let{error:s}=await i;if(s)throw s}replaceVariables(e,t){let a=e;for(let[e,i]of Object.entries(t)){let t=RegExp(`\\{${e}\\}`,"g");a=a.replace(t,i?.toString()||"")}return a}getEmailTypes(){return[{value:"document_generated",label:"Document généré",description:"Email envoyé lors de la génération d'un document",defaultVariables:["student_name","document_title","document_type","organization_name","document_url"]},{value:"invoice_sent",label:"Facture envoyée",description:"Email envoyé lors de l'envoi d'une facture",defaultVariables:["student_name","invoice_number","invoice_amount","due_date","organization_name","invoice_url"]},{value:"payment_reminder",label:"Rappel de paiement",description:"Email de rappel pour un paiement en attente",defaultVariables:["student_name","invoice_number","invoice_amount","due_date","days_overdue","organization_name"]},{value:"enrollment_confirmation",label:"Confirmation d'inscription",description:"Email de confirmation d'inscription à une session",defaultVariables:["student_name","session_name","session_start_date","session_location","organization_name"]},{value:"session_reminder",label:"Rappel de session",description:"Email de rappel avant une session",defaultVariables:["student_name","session_name","session_date","session_time","session_location","organization_name"]},{value:"certificate_issued",label:"Certificat délivré",description:"Email lors de la délivrance d'un certificat",defaultVariables:["student_name","certificate_name","certificate_date","organization_name","certificate_url"]},{value:"notification",label:"Notification générale",description:"Notification générale personnalisée",defaultVariables:["recipient_name","message","organization_name","action_url"]},{value:"custom",label:"Personnalisé",description:"Modèle d'email personnalisé",defaultVariables:[]}]}};e.s(["emailTemplateService",0,a])},333770,e=>{"use strict";var t=e.i(843476),a=e.i(271645),i=e.i(266027),s=e.i(954616),l=e.i(912598),r=e.i(325715),n=e.i(910419),o=e.i(167881),d=e.i(970065),c=e.i(23750),u=e.i(10708),m=e.i(184762),p=e.i(319036),h=e.i(630374),x=e.i(62870),f=e.i(6799),b=e.i(263488),g=e.i(107233),v=e.i(436332),y=e.i(727612);e.i(882205);var _=e.i(846932);function j(){let{user:e}=(0,r.useAuth)(),j=(0,l.useQueryClient)(),{addToast:w}=(0,f.useToast)(),[N,C]=(0,a.useState)("all"),[S,k]=(0,a.useState)(!1),[T,q]=(0,a.useState)(null),[z,E]=(0,a.useState)({email_type:"document_generated",name:"",subject:"",body_html:"",body_text:"",is_default:!1,is_active:!0,description:""}),M=n.emailTemplateService.getEmailTypes(),{data:V,isLoading:F}=(0,i.useQuery)({queryKey:["email-templates",e?.organization_id],queryFn:async()=>e?.organization_id?n.emailTemplateService.getAll(e.organization_id):[],enabled:!!e?.organization_id}),D="all"===N?V||[]:(V||[]).filter(e=>e.email_type===N),L=(0,s.useMutation)({mutationFn:async t=>{if(!e?.organization_id||!e?.id)throw Error("Non authentifié");return n.emailTemplateService.create({organization_id:e.organization_id,...t},e.id)},onSuccess:()=>{j.invalidateQueries({queryKey:["email-templates"]}),k(!1),P(),w({title:"Modèle créé",description:"Le modèle d'email a été créé avec succès.",type:"success"})},onError:e=>{w({title:"Erreur",description:e.message||"Une erreur est survenue lors de la création du modèle.",type:"error"})}}),B=(0,s.useMutation)({mutationFn:async({id:e,data:t})=>n.emailTemplateService.update(e,t),onSuccess:()=>{j.invalidateQueries({queryKey:["email-templates"]}),q(null),P(),w({title:"Modèle mis à jour",description:"Le modèle d'email a été mis à jour avec succès.",type:"success"})},onError:e=>{w({title:"Erreur",description:e.message||"Une erreur est survenue lors de la mise à jour du modèle.",type:"error"})}}),R=(0,s.useMutation)({mutationFn:async e=>n.emailTemplateService.delete(e),onSuccess:()=>{j.invalidateQueries({queryKey:["email-templates"]}),w({title:"Modèle supprimé",description:"Le modèle d'email a été supprimé avec succès.",type:"success"})},onError:e=>{w({title:"Erreur",description:e.message||"Une erreur est survenue lors de la suppression du modèle.",type:"error"})}}),P=()=>{E({email_type:"document_generated",name:"",subject:"",body_html:"",body_text:"",is_default:!1,is_active:!0,description:""})},A=()=>{P(),q(null),k(!0)},I=M.find(e=>e.value===z.email_type),O=D.reduce((e,t)=>(e[t.email_type]||(e[t.email_type]=[]),e[t.email_type].push(t),e),{});return(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Modèles d'emails"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Gérez les modèles d'emails pour chaque type d'envoi"})]}),(0,t.jsxs)(o.Button,{onClick:A,className:"gap-2",children:[(0,t.jsx)(g.Plus,{className:"w-4 h-4"}),"Nouveau modèle"]})]}),(0,t.jsx)(d.Card,{className:"mb-6",children:(0,t.jsx)(d.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(u.Label,{htmlFor:"email-type-filter",children:"Type d'email :"}),(0,t.jsxs)(x.Select,{value:N,onValueChange:e=>C(e),children:[(0,t.jsx)(x.SelectTrigger,{className:"w-64",children:(0,t.jsx)(x.SelectValue,{})}),(0,t.jsxs)(x.SelectContent,{children:[(0,t.jsx)(x.SelectItem,{value:"all",children:"Tous les types"}),M.map(e=>(0,t.jsx)(x.SelectItem,{value:e.value,children:e.label},e.value))]})]})]})})}),F?(0,t.jsx)("div",{className:"text-center py-12 text-gray-500",children:"Chargement..."}):0===D.length?(0,t.jsx)(d.Card,{children:(0,t.jsxs)(d.CardContent,{className:"py-12 text-center",children:[(0,t.jsx)(b.Mail,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"all"===N?"Aucun modèle d'email configuré":`Aucun mod\xe8le pour le type "${M.find(e=>e.value===N)?.label}"`}),(0,t.jsx)(o.Button,{onClick:A,variant:"outline",children:"Créer le premier modèle"})]})}):(0,t.jsx)("div",{className:"space-y-6",children:Object.entries(O).map(([e,a])=>{let i=M.find(t=>t.value===e);return(0,t.jsxs)(d.Card,{children:[(0,t.jsxs)(d.CardHeader,{children:[(0,t.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(b.Mail,{className:"w-5 h-5"}),i?.label||e]}),(0,t.jsx)(d.CardDescription,{children:i?.description})]}),(0,t.jsx)(d.CardContent,{children:(0,t.jsx)("div",{className:"space-y-4",children:a.map(e=>(0,t.jsxs)(_.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"flex items-start justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:e.name}),e.is_default&&(0,t.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full",children:"Par défaut"}),!e.is_active&&(0,t.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-600 rounded-full",children:"Inactif"})]}),(0,t.jsxs)("p",{className:"text-sm text-gray-600 mb-1",children:[(0,t.jsx)("strong",{children:"Sujet :"})," ",e.subject]}),e.description&&(0,t.jsx)("p",{className:"text-sm text-gray-500",children:e.description})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:()=>{E({email_type:e.email_type,name:e.name,subject:e.subject,body_html:e.body_html,body_text:e.body_text||"",is_default:e.is_default,is_active:e.is_active,description:e.description||""}),q(e),k(!0)},children:(0,t.jsx)(v.Edit,{className:"w-4 h-4"})}),(0,t.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:()=>{var t;return t=e.id,void(confirm("Êtes-vous sûr de vouloir supprimer ce modèle ?")&&R.mutate(t))},children:(0,t.jsx)(y.Trash2,{className:"w-4 h-4 text-red-600"})})]})]},e.id))})})]},e)})}),(0,t.jsx)(h.Dialog,{open:S,onOpenChange:k,children:(0,t.jsxs)(h.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(h.DialogHeader,{children:[(0,t.jsx)(h.DialogTitle,{children:T?"Modifier le modèle":"Nouveau modèle d'email"}),(0,t.jsx)(h.DialogDescription,{children:T?"Modifiez les informations du modèle d'email":"Créez un nouveau modèle d'email pour un type d'envoi spécifique"})]}),(0,t.jsxs)("div",{className:"space-y-6 py-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"email_type",children:"Type d'email *"}),(0,t.jsxs)(x.Select,{value:z.email_type,onValueChange:e=>{E({...z,email_type:e})},children:[(0,t.jsx)(x.SelectTrigger,{id:"email_type",children:(0,t.jsx)(x.SelectValue,{})}),(0,t.jsx)(x.SelectContent,{children:M.map(e=>(0,t.jsx)(x.SelectItem,{value:e.value,children:e.label},e.value))})]}),I&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:I.description})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"name",children:"Nom du modèle *"}),(0,t.jsx)(c.Input,{id:"name",value:z.name,onChange:e=>E({...z,name:e.target.value}),placeholder:"Ex: Document généré - Standard"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"description",children:"Description (optionnel)"}),(0,t.jsx)(m.Textarea,{id:"description",value:z.description,onChange:e=>E({...z,description:e.target.value}),placeholder:"Description du modèle...",rows:2})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"subject",children:"Sujet de l'email *"}),(0,t.jsx)(c.Input,{id:"subject",value:z.subject,onChange:e=>E({...z,subject:e.target.value}),placeholder:"Ex: Votre {document_title}"}),I&&I.defaultVariables.length>0&&(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Variables disponibles : ",I.defaultVariables.join(", ")]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"body_html",children:"Corps de l'email (HTML) *"}),(0,t.jsx)(m.Textarea,{id:"body_html",value:z.body_html,onChange:e=>E({...z,body_html:e.target.value}),placeholder:"<p>Bonjour {student_name},</p><p>Votre document {document_title} est prêt.</p>",rows:12,className:"font-mono text-sm"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"body_text",children:"Corps de l'email (texte brut - optionnel)"}),(0,t.jsx)(m.Textarea,{id:"body_text",value:z.body_text,onChange:e=>E({...z,body_text:e.target.value}),placeholder:"Version texte de l'email...",rows:6})]}),(0,t.jsxs)("div",{className:"flex items-center gap-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(p.Switch,{checked:z.is_default,onCheckedChange:e=>E({...z,is_default:e})}),(0,t.jsx)(u.Label,{htmlFor:"is_default",children:"Modèle par défaut pour ce type"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(p.Switch,{checked:z.is_active,onCheckedChange:e=>E({...z,is_active:e})}),(0,t.jsx)(u.Label,{htmlFor:"is_active",children:"Actif"})]})]})]}),(0,t.jsxs)(h.DialogFooter,{children:[(0,t.jsx)(o.Button,{variant:"outline",onClick:()=>{k(!1),P(),q(null)},children:"Annuler"}),(0,t.jsx)(o.Button,{onClick:()=>{T?B.mutate({id:T.id,data:z}):L.mutate(z)},disabled:!z.name||!z.subject||!z.body_html||L.isPending||B.isPending,children:T?"Enregistrer":"Créer"})]})]})})]})}e.s(["default",()=>j])}]);