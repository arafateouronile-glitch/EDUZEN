(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},209372,e=>{"use strict";var t=e.i(50270);let r=t.z.object({first_name:t.z.string().min(1,"Le prénom est requis").max(100,"Le prénom est trop long"),last_name:t.z.string().min(1,"Le nom est requis").max(100,"Le nom est trop long"),date_of_birth:t.z.string().optional().or(t.z.literal("")),gender:t.z.enum(["male","female","other"]).optional().or(t.z.literal("")),email:t.z.string().email("Email invalide").optional().or(t.z.literal("")),phone:t.z.string().optional().or(t.z.literal("")),address:t.z.string().optional().or(t.z.literal("")),city:t.z.string().optional().or(t.z.literal("")),class_id:t.z.string().optional().or(t.z.literal("")),enrollment_date:t.z.string().min(1,"La date d'inscription est requise"),guardian_first_name:t.z.string().min(1,"Le prénom du tuteur est requis"),guardian_last_name:t.z.string().min(1,"Le nom du tuteur est requis"),guardian_relationship:t.z.enum(["parent","guardian","other"]).default("parent"),guardian_phone_primary:t.z.string().min(1,"Le téléphone principal du tuteur est requis"),guardian_phone_secondary:t.z.string().optional().or(t.z.literal("")),guardian_email:t.z.string().email("Email invalide").optional().or(t.z.literal("")),guardian_address:t.z.string().optional().or(t.z.literal(""))});t.z.object({first_name:t.z.string().min(1,"Le prénom est requis").max(100,"Le prénom est trop long"),last_name:t.z.string().min(1,"Le nom est requis").max(100,"Le nom est trop long"),date_of_birth:t.z.string().optional().or(t.z.literal("")),gender:t.z.enum(["male","female","other"]).optional().or(t.z.literal("")),email:t.z.string().email("Email invalide").optional().or(t.z.literal("")),phone:t.z.string().optional().or(t.z.literal("")),address:t.z.string().optional().or(t.z.literal("")),city:t.z.string().optional().or(t.z.literal("")),class_id:t.z.string().optional().or(t.z.literal("")),enrollment_date:t.z.string().min(1,"La date d'inscription est requise"),status:t.z.enum(["active","inactive","graduated"]).default("active")});let a=t.z.object({code:t.z.string().min(1,"Le code est requis").max(50,"Le code est trop long"),name:t.z.string().min(1,"Le nom est requis").max(200,"Le nom est trop long"),subtitle:t.z.string().optional().or(t.z.literal("")),description:t.z.string().optional().or(t.z.literal("")),category:t.z.string().optional().or(t.z.literal("")),program_version:t.z.string().optional().or(t.z.literal("")),version_date:t.z.string().optional().or(t.z.literal("")),duration_hours:t.z.string().optional().or(t.z.literal("")),duration_days:t.z.string().optional().or(t.z.literal("")),photo_url:t.z.string().url("URL invalide").optional().or(t.z.literal("")),price:t.z.string().optional().or(t.z.literal("")),price_enterprise:t.z.string().optional().or(t.z.literal("")),price_individual:t.z.string().optional().or(t.z.literal("")),price_freelance:t.z.string().optional().or(t.z.literal("")),currency:t.z.string().default("XOF"),payment_plan:t.z.enum(["full","installment","free"]).default("full"),published_online:t.z.boolean().default(!1),is_public:t.z.boolean().default(!1),eligible_cpf:t.z.boolean().default(!1),cpf_code:t.z.string().optional().or(t.z.literal("")),modalities:t.z.string().optional().or(t.z.literal("")),training_action_type:t.z.string().optional().or(t.z.literal("")),pedagogical_objectives:t.z.string().optional().or(t.z.literal("")),learner_profile:t.z.string().optional().or(t.z.literal("")),training_content:t.z.string().optional().or(t.z.literal("")),execution_follow_up:t.z.string().optional().or(t.z.literal("")),certification_modalities:t.z.string().optional().or(t.z.literal("")),quality:t.z.string().optional().or(t.z.literal("")),accounting_product_config:t.z.string().optional().or(t.z.literal("")),edof_export_fields:t.z.string().optional().or(t.z.literal("")),competence_domains:t.z.string().optional().or(t.z.literal("")),prerequisites:t.z.string().optional().or(t.z.literal("")),capacity_max:t.z.string().optional().or(t.z.literal("")),age_min:t.z.string().optional().or(t.z.literal("")),age_max:t.z.string().optional().or(t.z.literal("")),certification_issued:t.z.boolean().default(!1),is_active:t.z.boolean().default(!0)}),i=t.z.object({program_id:t.z.string().min(1,"Le programme est requis"),code:t.z.string().min(1,"Le code est requis").max(50,"Le code est trop long"),name:t.z.string().min(1,"Le nom est requis").max(200,"Le nom est trop long"),subtitle:t.z.string().optional().or(t.z.literal("")),photo_url:t.z.string().url("URL invalide").optional().or(t.z.literal("")),category:t.z.string().optional().or(t.z.literal("")),description:t.z.string().optional().or(t.z.literal("")),program_version:t.z.string().optional().or(t.z.literal("")),version_date:t.z.string().optional().or(t.z.literal("")),duration_hours:t.z.string().optional().or(t.z.literal("")),duration_days:t.z.string().optional().or(t.z.literal("")),duration_unit:t.z.enum(["hours","days"]).default("hours"),price:t.z.string().optional().or(t.z.literal("")),currency:t.z.string().default("XOF"),payment_plan:t.z.enum(["full","installment","free"]).default("full"),published_online:t.z.boolean().default(!1),eligible_cpf:t.z.boolean().default(!1),cpf_code:t.z.string().optional().or(t.z.literal("")),modalities:t.z.string().optional().or(t.z.literal("")),training_action_type:t.z.string().optional().or(t.z.literal("")),pedagogical_objectives:t.z.string().optional().or(t.z.literal("")),learner_profile:t.z.string().optional().or(t.z.literal("")),training_content:t.z.string().optional().or(t.z.literal("")),execution_follow_up:t.z.string().optional().or(t.z.literal("")),certification_modalities:t.z.string().optional().or(t.z.literal("")),quality:t.z.string().optional().or(t.z.literal("")),accounting_product_config:t.z.string().optional().or(t.z.literal("")),edof_export_fields:t.z.string().optional().or(t.z.literal("")),competence_domains:t.z.string().optional().or(t.z.literal("")),prerequisites:t.z.string().optional().or(t.z.literal("")),capacity_max:t.z.string().optional().or(t.z.literal("")),age_min:t.z.string().optional().or(t.z.literal("")),age_max:t.z.string().optional().or(t.z.literal("")),certification_issued:t.z.boolean().default(!1),is_active:t.z.boolean().default(!0)}),n=t.z.object({formation_id:t.z.string().min(1,"La formation est requise"),name:t.z.string().min(1,"Le nom est requis").max(200,"Le nom est trop long"),code:t.z.string().optional().or(t.z.literal("")),start_date:t.z.string().min(1,"La date de début est requise"),end_date:t.z.string().min(1,"La date de fin est requise"),start_time:t.z.string().optional().or(t.z.literal("")),end_time:t.z.string().optional().or(t.z.literal("")),location:t.z.string().optional().or(t.z.literal("")),capacity_max:t.z.string().optional().or(t.z.literal("")).refine(e=>{if(!e)return!0;let t=parseInt(e);return!isNaN(t)&&t>0},"La capacité maximale doit être un nombre entier positif"),currency:t.z.string().default("XOF"),status:t.z.enum(["planned","ongoing","completed","cancelled"]).default("planned"),teacher_id:t.z.string().optional().or(t.z.literal("")),manager1_id:t.z.string().optional().or(t.z.literal("")),manager2_id:t.z.string().optional().or(t.z.literal("")),inter_entreprise:t.z.boolean().default(!0),sous_traitance:t.z.boolean().default(!1),timezone:t.z.string().default("Europe/Paris"),program_ids:t.z.array(t.z.string()).default([])}).refine(e=>!e.start_date||!e.end_date||new Date(e.end_date)>=new Date(e.start_date),{message:"La date de fin doit être postérieure à la date de début",path:["end_date"]}),s=t.z.object({student_id:t.z.string().min(1,"L'étudiant est requis"),session_id:t.z.string().optional().or(t.z.literal("")),subject:t.z.string().min(1,"Le sujet est requis").max(200,"Le sujet est trop long"),assessment_type:t.z.enum(["pre_formation","hot","cold","manager","instructor","funder","quiz","exam","project","other"]).default("quiz"),score:t.z.string().min(1,"La note est requise").refine(e=>{let t=parseFloat(e);return!isNaN(t)&&t>=0},"La note doit être un nombre valide"),max_score:t.z.string().optional().or(t.z.literal("")).refine(e=>{if(!e)return!0;let t=parseFloat(e);return!isNaN(t)&&t>0},"La note maximale doit être un nombre valide supérieur à 0"),notes:t.z.string().optional().or(t.z.literal("")),graded_at:t.z.string().min(1,"La date d'évaluation est requise"),coefficient:t.z.string().optional().or(t.z.literal("")).refine(e=>{if(!e)return!0;let t=parseFloat(e);return!isNaN(t)&&t>0},"Le coefficient doit être un nombre valide supérieur à 0"),is_makeup:t.z.boolean().optional().default(!1),original_grade_id:t.z.string().optional().or(t.z.literal("")),appreciation:t.z.string().optional().or(t.z.literal("")),term_period:t.z.enum(["Q1","Q2","Q3","Q4","S1","S2","T1","T2","T3"]).optional().or(t.z.literal("")),academic_year_id:t.z.string().optional().or(t.z.literal(""))}).refine(e=>!e.max_score||!e.score||parseFloat(e.score)<=parseFloat(e.max_score),{message:"La note ne peut pas être supérieure à la note maximale",path:["score"]}),o=t.z.object({student_id:t.z.string().min(1,"L'étudiant est requis"),document_type:t.z.enum(["quote","invoice"]).default("invoice"),invoice_number:t.z.string().optional().or(t.z.literal("")),type:t.z.enum(["tuition","registration","other"]).default("tuition"),issue_date:t.z.string().min(1,"La date d'émission est requise"),due_date:t.z.string().min(1,"La date d'échéance est requise"),amount:t.z.string().min(1,"Le montant est requis").refine(e=>{let t=parseFloat(e);return!isNaN(t)&&t>=0},"Le montant doit être un nombre valide supérieur ou égal à 0"),tax_amount:t.z.string().optional().or(t.z.literal("")).refine(e=>{if(!e)return!0;let t=parseFloat(e);return!isNaN(t)&&t>=0},"Le montant de la taxe doit être un nombre valide supérieur ou égal à 0"),currency:t.z.string().default("XOF"),status:t.z.enum(["draft","sent","partial","paid","overdue","cancelled"]).default("draft"),notes:t.z.string().optional().or(t.z.literal("")),enrollment_id:t.z.string().optional().or(t.z.literal(""))}).refine(e=>!e.issue_date||!e.due_date||new Date(e.due_date)>=new Date(e.issue_date),{message:"La date d'échéance doit être postérieure à la date d'émission",path:["due_date"]});t.z.object({invoice_id:t.z.string().min(1,"La facture est requise"),student_id:t.z.string().min(1,"L'étudiant est requis"),amount:t.z.string().min(1,"Le montant est requis").refine(e=>{let t=parseFloat(e);return!isNaN(t)&&t>0},"Le montant doit être un nombre valide supérieur à 0"),currency:t.z.string().default("XOF"),payment_method:t.z.enum(["cash","mobile_money","card","bank_transfer"]).default("cash"),payment_provider:t.z.enum(["mtn","orange","airtel","wave"]).optional().or(t.z.literal("")),transaction_id:t.z.string().optional().or(t.z.literal("")),paid_at:t.z.string().optional().or(t.z.literal("")),notes:t.z.string().optional().or(t.z.literal(""))});let l=t.z.object({student_id:t.z.string().min(1,"L'étudiant est requis"),session_id:t.z.string().min(1,"La session est requise"),enrollment_date:t.z.string().min(1,"La date d'inscription est requise"),status:t.z.enum(["pending","confirmed","completed","cancelled","failed"]).default("confirmed"),payment_status:t.z.enum(["pending","partial","paid","overdue"]).default("pending"),total_amount:t.z.string().optional().or(t.z.literal("")).refine(e=>{if(!e)return!0;let t=parseFloat(e);return!isNaN(t)&&t>=0},"Le montant total doit être un nombre valide supérieur ou égal à 0"),paid_amount:t.z.string().optional().or(t.z.literal("")).refine(e=>{if(!e)return!0;let t=parseFloat(e);return!isNaN(t)&&t>=0},"Le montant payé doit être un nombre valide supérieur ou égal à 0")}).refine(e=>{if(e.total_amount&&e.paid_amount){let t=parseFloat(e.total_amount),r=parseFloat(e.paid_amount);if(!isNaN(t)&&!isNaN(r)&&r>t)return!1}return!0},{message:"Le montant payé ne peut pas dépasser le montant total",path:["paid_amount"]});e.s(["enrollmentSchema",0,l,"evaluationSchema",0,s,"formationSchema",0,i,"invoiceSchema",0,o,"programSchema",0,a,"sessionSchema",0,n,"studentSchema",0,r])},696856,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(618566),i=e.i(954616),n=e.i(266027),s=e.i(653145),o=e.i(994814),l=e.i(325715),d=e.i(920755),m=e.i(167881),u=e.i(970065),c=e.i(871689),p=e.i(522016),g=e.i(209372);function _(){let e=(0,a.useRouter)(),{user:_,isLoading:f,session:z}=(0,l.useAuth)(),x=(0,d.createClient)(),[h,b]=(0,r.useState)(1),{register:j,handleSubmit:y,formState:{errors:v,isValid:N},setValue:L,trigger:q,watch:w}=(0,s.useForm)({resolver:(0,o.zodResolver)(g.studentSchema),mode:"onChange",defaultValues:{first_name:"",last_name:"",date_of_birth:"",gender:"",email:"",phone:"",address:"",city:"",guardian_first_name:"",guardian_last_name:"",guardian_relationship:"parent",guardian_phone_primary:"",guardian_phone_secondary:"",guardian_email:"",guardian_address:"",class_id:"",enrollment_date:new Date().toISOString().split("T")[0]}}),{data:S}=(0,n.useQuery)({queryKey:["program-sessions-all",_?.organization_id],queryFn:async()=>{if(!_?.organization_id)return[];let{data:e,error:t}=await x.from("sessions").select("id, name, start_date, end_date, formations!inner(id, name, code, organization_id, programs(id, name))").eq("formations.organization_id",_.organization_id).order("start_date",{ascending:!1});if(t)throw t;return e?.map(e=>({id:e.id,name:`${e.name} - ${e.formations.name}${e.formations.programs?` (${e.formations.programs.name})`:""}`,code:e.formations.code,start_date:e.start_date,end_date:e.end_date}))||[]},enabled:!!_?.organization_id&&!f}),k=(0,i.useMutation)({mutationFn:async e=>{if(!_?.organization_id)throw Error("Organization ID manquant");let{data:t,error:r}=await x.from("guardians").insert({organization_id:_.organization_id,first_name:e.guardian_first_name,last_name:e.guardian_last_name,relationship:e.guardian_relationship,phone_primary:e.guardian_phone_primary,phone_secondary:e.guardian_phone_secondary||null,email:e.guardian_email||null,address:e.guardian_address||null}).select().single();if(r)throw r;let{data:a}=await x.from("organizations").select("code").eq("id",_.organization_id).single(),i=a?.code||"EDUZEN",n=new Date().getFullYear().toString().slice(-2),s=`${i}${n}`,{data:o}=await x.from("students").select("student_number").eq("organization_id",_.organization_id).like("student_number",`${s}%`).order("student_number",{ascending:!1}).limit(1).maybeSingle(),l=1;o?.student_number&&(l=(parseInt(o.student_number.slice(-4))||0)+1);let d=`${s}${String(l).padStart(4,"0")}`,{data:m}=await x.from("students").select("id").eq("organization_id",_.organization_id).eq("student_number",d).maybeSingle();if(m){let e=0;for(;e<100;){l++,d=`${s}${String(l).padStart(4,"0")}`;let{data:t}=await x.from("students").select("id").eq("organization_id",_.organization_id).eq("student_number",d).maybeSingle();if(!t)break;e++}if(e>=100)throw Error("Impossible de générer un numéro d'élève unique. Veuillez réessayer.")}let{data:u,error:c}=await x.from("students").insert({organization_id:_.organization_id,student_number:d,first_name:e.first_name,last_name:e.last_name,date_of_birth:e.date_of_birth||null,gender:e.gender||null,email:e.email||null,phone:e.phone||null,address:e.address||null,city:e.city||null,enrollment_date:e.enrollment_date,status:"active"}).select().single();if(c){if(console.error("Student creation error:",c),console.error("Error details:",{code:c.code,message:c.message,details:c.details,hint:c.hint}),"23505"===c.code)throw Error(`Un \xe9l\xe8ve avec le num\xe9ro "${d}" existe d\xe9j\xe0 dans votre organisation. Veuillez r\xe9essayer ou contacter le support.`);throw Error(c.message||"Une erreur est survenue lors de la création de l'élève")}let{error:p}=await x.from("student_guardians").insert({student_id:u.id,guardian_id:t.id,is_primary:!0});if(p)throw console.error("Link guardian error:",p),Error("Erreur lors de la liaison du tuteur à l'élève");if(e.class_id){let{error:t}=await x.from("enrollments").insert({student_id:u.id,session_id:e.class_id,enrollment_date:e.enrollment_date,status:"confirmed",payment_status:"pending",total_amount:0,paid_amount:0});t&&(console.error("Enrollment error:",t),console.warn("L'élève a été créé mais l'inscription à la session a échoué"))}return u},onSuccess:t=>{e.push(`/dashboard/students/${t.id}`)},onError:e=>{console.error("Student creation mutation error:",e)}}),E=async e=>{if(console.log("onSubmit called:",{step:h,data:e}),h<3){let e=[];1===h?e=["first_name","last_name"]:2===h&&(e=["guardian_first_name","guardian_last_name","guardian_phone_primary"]),console.log("Validating fields:",e);let t=await q(e);console.log("Validation result:",{step:h,fieldsToValidate:e,isValidStep:t,errors:v}),t?(console.log("Validation passed, moving to step",h+1),b(h+1)):console.log("Validation failed for step",h,"Errors:",v)}else console.log("Final step, validating all fields"),await q(["first_name","last_name","guardian_first_name","guardian_last_name","guardian_phone_primary","enrollment_date"])?(console.log("All fields valid, creating student"),k.mutate(e)):console.log("Final validation failed, errors:",v)},[F,C]=(0,r.useState)(!1),D=w("first_name"),$=w("last_name"),T=w("enrollment_date"),A=w("guardian_first_name"),I=w("guardian_last_name"),O=w("guardian_phone_primary"),P=async()=>{try{if(1===h){let e=await q(["first_name","last_name"]);return C(e),e}if(2===h){let e=await q(["guardian_first_name","guardian_last_name","guardian_phone_primary"]);return C(e),e}if(3===h){let e=await q(["enrollment_date"]);return C(e),e}return C(!0),!0}catch(e){return console.error("Validation error:",e),C(!1),!1}};return((0,r.useEffect)(()=>{P()},[h,D,$,T,A,I,O]),(0,r.useEffect)(()=>{1===h&&P()},[]),f)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("p",{children:"Chargement..."})}):_?_.organization_id?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)(p.default,{href:"/dashboard/students",children:(0,t.jsx)(m.Button,{variant:"ghost",size:"icon",children:(0,t.jsx)(c.ArrowLeft,{className:"h-4 w-4"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Nouvel élève"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Inscrivez un nouvel élève en quelques étapes"})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[[1,2,3].map(e=>(0,t.jsxs)("div",{className:"flex-1 flex items-center",children:[(0,t.jsx)("div",{className:`flex-1 h-2 rounded ${h>=e?"bg-primary":"bg-gray-200"}`}),e<3&&(0,t.jsx)("div",{className:`w-2 h-2 rounded-full ${h>e?"bg-primary":"bg-gray-200"}`})]},e)),(0,t.jsxs)("div",{className:"ml-4 text-sm text-muted-foreground",children:["Étape ",h," sur 3"]})]}),(0,t.jsxs)(u.Card,{children:[(0,t.jsx)(u.CardHeader,{children:(0,t.jsxs)(u.CardTitle,{children:[1===h&&"Informations personnelles",2===h&&"Informations du tuteur",3===h&&"Informations académiques"]})}),(0,t.jsx)(u.CardContent,{children:(0,t.jsxs)("form",{onSubmit:y(E),className:"space-y-6",children:[1===h&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Prénom *"}),(0,t.jsx)("input",{type:"text",required:!0,...j("first_name"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.first_name&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.first_name.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Nom *"}),(0,t.jsx)("input",{type:"text",required:!0,...j("last_name"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.last_name&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.last_name.message})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date de naissance"}),(0,t.jsx)("input",{type:"date",...j("date_of_birth"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.date_of_birth&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.date_of_birth.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Genre"}),(0,t.jsxs)("select",{...j("gender"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,t.jsx)("option",{value:"",children:"Sélectionner"}),(0,t.jsx)("option",{value:"male",children:"Masculin"}),(0,t.jsx)("option",{value:"female",children:"Féminin"}),(0,t.jsx)("option",{value:"other",children:"Autre"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Email"}),(0,t.jsx)("input",{type:"email",...j("email"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.email&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.email.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Téléphone"}),(0,t.jsx)("input",{type:"tel",...j("phone"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.phone&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.phone.message})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Adresse"}),(0,t.jsx)("input",{type:"text",...j("address"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.address&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.address.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Ville"}),(0,t.jsx)("input",{type:"text",...j("city"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.city&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.city.message})]})]}),2===h&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Prénom du tuteur *"}),(0,t.jsx)("input",{type:"text",required:!0,...j("guardian_first_name"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.guardian_first_name&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.guardian_first_name.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Nom du tuteur *"}),(0,t.jsx)("input",{type:"text",required:!0,...j("guardian_last_name"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.guardian_last_name&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.guardian_last_name.message})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Lien de parenté *"}),(0,t.jsxs)("select",{required:!0,...j("guardian_relationship"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,t.jsx)("option",{value:"parent",children:"Parent"}),(0,t.jsx)("option",{value:"father",children:"Père"}),(0,t.jsx)("option",{value:"mother",children:"Mère"}),(0,t.jsx)("option",{value:"guardian",children:"Tuteur"}),(0,t.jsx)("option",{value:"other",children:"Autre"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Téléphone principal *"}),(0,t.jsx)("input",{type:"tel",required:!0,...j("guardian_phone_primary"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.guardian_phone_primary&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.guardian_phone_primary.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Téléphone secondaire"}),(0,t.jsx)("input",{type:"tel",...j("guardian_phone_secondary"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.guardian_phone_secondary&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.guardian_phone_secondary.message})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Email du tuteur"}),(0,t.jsx)("input",{type:"email",...j("guardian_email"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.guardian_email&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.guardian_email.message})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Adresse du tuteur"}),(0,t.jsx)("input",{type:"text",...j("guardian_address"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.guardian_address&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.guardian_address.message})]})]}),3===h&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Session"}),(0,t.jsxs)("select",{...j("class_id"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,t.jsx)("option",{value:"",children:"Sélectionner une session"}),S?.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date d'inscription"}),(0,t.jsx)("input",{type:"date",required:!0,...j("enrollment_date"),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"}),v.enrollment_date&&(0,t.jsx)("p",{className:"text-red-500 text-sm mt-1",children:v.enrollment_date.message})]})]}),(0,t.jsxs)("div",{className:"flex justify-between pt-4",children:[h>1&&(0,t.jsx)(m.Button,{type:"button",variant:"outline",onClick:()=>b(h-1),children:"Précédent"}),(0,t.jsx)("div",{className:"ml-auto",children:(0,t.jsx)(m.Button,{type:"button",onClick:async e=>{if(e.preventDefault(),console.log("Button clicked manually, step:",h),console.log("Current form data:",w()),1===h){let e=await q(["first_name","last_name"]);console.log("Step 1 validation:",e,"Errors:",v),e&&(console.log("Moving to step 2"),b(2))}else if(2===h){let e=await q(["guardian_first_name","guardian_last_name","guardian_phone_primary"]);console.log("Step 2 validation:",e,"Errors:",v),e&&(console.log("Moving to step 3"),b(3))}else await y(E)(e)},disabled:k.isPending,children:h<3?"Suivant":k.isPending?"Création...":"Créer l'élève"})})]}),k.error&&(0,t.jsxs)("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-lg text-sm space-y-1",children:[(0,t.jsx)("p",{className:"font-semibold",children:"Erreur lors de la création de l'élève :"}),(0,t.jsx)("p",{children:k.error instanceof Error?k.error.message:"Une erreur est survenue"}),k.error&&"code"in k.error&&(0,t.jsxs)("p",{className:"text-xs opacity-75",children:["Code d'erreur: ",String(k.error.code),"23505"===k.error.code&&(0,t.jsx)("span",{className:"block mt-1",children:"❌ Un élève avec ce numéro existe déjà. Le système va générer automatiquement un numéro unique lors de la prochaine tentative."})]})]})]})})]})]}):(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Organization ID manquant"}),(0,t.jsx)("p",{className:"text-red-700 mb-4",children:"Votre compte n'est pas associé à une organisation. Suivez les étapes ci-dessous pour corriger cela."}),(0,t.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,t.jsxs)("p",{className:"text-sm text-red-600",children:["User ID : ",_.id||"Non défini"]}),(0,t.jsxs)("p",{className:"text-sm text-red-600",children:["Email : ",_.email||"Non défini"]}),(0,t.jsxs)("div",{className:"mt-4 p-3 bg-gray-50 rounded",children:[(0,t.jsx)("p",{className:"text-sm font-semibold mb-2",children:"Pour corriger :"}),(0,t.jsxs)("ol",{className:"text-sm text-gray-700 list-decimal list-inside space-y-1",children:[(0,t.jsx)("li",{children:"Allez dans le SQL Editor de Supabase"}),(0,t.jsxs)("li",{children:["Exécutez le script dans ",(0,t.jsx)("code",{className:"bg-gray-200 px-1 rounded",children:"supabase/fix_missing_organization.sql"})]}),(0,t.jsxs)("li",{children:["Ou créez un nouveau compte via ",(0,t.jsx)(p.default,{href:"/auth/register",className:"text-primary underline",children:"/auth/register"})]})]})]})]})]})}):(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)("div",{className:"bg-warning-bg border border-warning-border rounded-lg p-4",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-warning-primary mb-2",children:"Utilisateur non trouvé"}),(0,t.jsx)("p",{className:"text-warning-primary mb-4",children:"Votre compte n'existe pas encore dans la base de données. Cela peut arriver si votre compte a été créé récemment."}),(0,t.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,t.jsxs)("p",{className:"text-sm text-warning-primary",children:["Session ID : ",z?.user?.id||"Non défini"]}),(0,t.jsxs)("p",{className:"text-sm text-warning-primary",children:["Email de session : ",z?.user?.email||"Non défini"]}),(0,t.jsxs)("p",{className:"text-sm text-warning-primary mt-4",children:[(0,t.jsx)("strong",{children:"Solution :"})," Déconnectez-vous et créez un nouveau compte via ",(0,t.jsx)(p.default,{href:"/auth/register",className:"text-primary underline",children:"/auth/register"})]})]})]})})}e.s(["default",()=>_])}]);