(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,503116,e=>{"use strict";let t=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],503116)},605631,e=>{"use strict";let t=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],605631)},738308,e=>{"use strict";let t=(0,e.i(475254).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],738308)},710920,e=>{"use strict";var t=e.i(843476),s=e.i(271645),a=e.i(266027),r=e.i(325715),n=e.i(920755),l=e.i(970065),d=e.i(605631),i=e.i(738308),c=e.i(503116),u=e.i(898791),x=e.i(87316),m=e.i(647163);function o(){let{user:e}=(0,r.useAuth)(),o=(0,n.createClient)(),[h,p]=(0,s.useState)(new Date().toISOString().slice(0,7)),{data:g}=(0,a.useQuery)({queryKey:["portal-attendance",e?.id,h],queryFn:async()=>{if(!e?.id)return[];let t=[];if(e?.role==="parent"){let{data:s}=await o.from("guardians").select("id").eq("user_id",e.id);if(!s||0===s.length)return[];let{data:a}=await o.from("student_guardians").select("student_id").in("guardian_id",s.map(e=>e.id));if(!a||0===a.length)return[];t=a.map(e=>e.student_id).filter(e=>null!==e)}else e?.role==="student"&&(t=[e.id]);if(0===t.length)return[];let s=`${h}-01`,a=new Date(new Date(h+"-01").getFullYear(),new Date(h+"-01").getMonth()+1,0).toISOString().split("T")[0],{data:r}=await o.from("attendance").select("*, students(first_name, last_name, photo_url), classes(name)").in("student_id",t).gte("date",s).lte("date",a).order("date",{ascending:!1});return r||[]},enabled:!!e?.id}),j=g?{total:g.length,present:g.filter(e=>"present"===e.status).length,absent:g.filter(e=>"absent"===e.status).length,late:g.filter(e=>"late"===e.status).length,excused:g.filter(e=>"excused"===e.status).length,rate:g.length>0?Math.round(g.filter(e=>"present"===e.status).length/g.length*100):0}:null,f=e=>{switch(e){case"present":return(0,t.jsx)(d.CheckCircle,{className:"h-5 w-5 text-success-primary"});case"absent":return(0,t.jsx)(i.XCircle,{className:"h-5 w-5 text-red-600"});case"late":return(0,t.jsx)(c.Clock,{className:"h-5 w-5 text-warning-primary"});case"excused":return(0,t.jsx)(u.AlertCircle,{className:"h-5 w-5 text-blue-600"});default:return null}},b=e=>{switch(e){case"present":return"Présent";case"absent":return"Absent";case"late":return"En retard";case"excused":return"Justifié";default:return e}},N=e?.role==="parent"&&g?g.reduce((e,t)=>{let s=t.student_id;return e[s]||(e[s]={student:t.students,class:t.classes,records:[]}),e[s].records.push(t),e},{}):null;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Présences"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Suivez les présences et absences"})]}),(0,t.jsx)("input",{type:"month",value:h,onChange:e=>p(e.target.value),className:"px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"})]}),j&&(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,t.jsx)(l.Card,{children:(0,t.jsx)(l.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:j.total}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total"})]})})}),(0,t.jsx)(l.Card,{children:(0,t.jsx)(l.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-success-primary",children:j.present}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Présents"})]})})}),(0,t.jsx)(l.Card,{children:(0,t.jsx)(l.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-red-600",children:j.absent}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Absents"})]})})}),(0,t.jsx)(l.Card,{children:(0,t.jsx)(l.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-warning-primary",children:j.late}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"En retard"})]})})}),(0,t.jsx)(l.Card,{children:(0,t.jsx)(l.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"text-2xl font-bold text-blue-600",children:[j.rate,"%"]}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Taux"})]})})})]}),(0,t.jsxs)(l.Card,{children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsx)(l.CardTitle,{children:"Historique des présences"})}),(0,t.jsx)(l.CardContent,{children:g&&g.length>0?e?.role==="parent"&&N?(0,t.jsx)("div",{className:"space-y-6",children:Object.values(N).map(e=>(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("h3",{className:"font-semibold text-lg mb-3",children:[e.student.first_name," ",e.student.last_name,e.class?.name&&` - ${e.class.name}`]}),(0,t.jsx)("div",{className:"space-y-2",children:e.records.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[f(e.status),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:(0,m.formatDate)(e.date)}),e.late_minutes>0&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Retard: ",e.late_minutes," min"]})]})]}),(0,t.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"present"===e.status?"bg-success-bg text-success-primary":"absent"===e.status?"bg-red-100 text-red-800":"late"===e.status?"bg-warning-bg text-warning-primary":"bg-blue-100 text-blue-800"}`,children:b(e.status)})]},e.id))})]},e.student.id))}):(0,t.jsx)("div",{className:"space-y-2",children:g.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[f(e.status),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium",children:(0,m.formatDate)(e.date)}),e.classes?.name&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.classes.name}),e.late_minutes>0&&(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Retard: ",e.late_minutes," min"]})]})]}),(0,t.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"present"===e.status?"bg-success-bg text-success-primary":"absent"===e.status?"bg-red-100 text-red-800":"late"===e.status?"bg-warning-bg text-warning-primary":"bg-blue-100 text-blue-800"}`,children:b(e.status)})]},e.id))}):(0,t.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:[(0,t.jsx)(x.Calendar,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,t.jsx)("p",{children:"Aucune donnée de présence disponible"})]})})]})]})}e.s(["default",()=>o])}]);