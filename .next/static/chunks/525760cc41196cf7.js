(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let s=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>s],107233)},503116,e=>{"use strict";let s=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>s],503116)},25652,e=>{"use strict";let s=(0,e.i(475254).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);e.s(["TrendingUp",()=>s],25652)},127341,e=>{"use strict";var s=e.i(843476),t=e.i(271645),i=e.i(647163);let a=t.createContext(void 0);function n({value:e,defaultValue:n,onValueChange:r,children:l,className:c}){let o=void 0!==e,[d,u]=t.useState(n??"");t.useEffect(()=>{o||void 0===n||u(n)},[n]);let m=o?e:d,h=t.useCallback(e=>{o||u(e),r?.(e)},[o,r]);return(0,s.jsx)(a.Provider,{value:{value:m,onValueChange:h},children:(0,s.jsx)("div",{className:(0,i.cn)("w-full",c),children:l})})}function r(){let e=t.useContext(a);if(!e)throw Error("Tabs components must be used within a Tabs component");return e}function l({children:e,className:t}){return(0,s.jsx)("div",{className:(0,i.cn)("inline-flex h-10 items-center justify-center rounded-lg bg-bg-gray-100 p-1 text-text-tertiary",t),children:e})}function c({value:e,children:t,className:a}){let{value:n,onValueChange:l}=r(),c=n===e;return(0,s.jsx)("button",{type:"button",onClick:()=>l(e),className:(0,i.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-outline-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",c?"bg-white text-text-primary shadow-sm":"text-text-tertiary hover:text-text-primary",a),children:t})}function o({value:e,children:t,className:a}){let{value:n}=r();return n!==e?null:(0,s.jsx)("div",{className:(0,i.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),children:t})}e.s(["Tabs",()=>n,"TabsContent",()=>o,"TabsList",()=>l,"TabsTrigger",()=>c])},599811,e=>{"use strict";let s=(0,e.i(475254).default)("Euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]);e.s(["Euro",()=>s],599811)},655536,e=>{"use strict";var s=e.i(920755);let t=new class{supabase;constructor(e){this.supabase=e||(0,s.createClient)()}async getConfiguration(e){let{data:s,error:t}=await this.supabase.from("cpf_configurations").select("*").eq("organization_id",e).single();if(t){if("PGRST116"===t.code)return null;throw t}return s}async upsertConfiguration(e){let{data:s,error:t}=await this.supabase.from("cpf_configurations").upsert(e,{onConflict:"organization_id"}).select().single();if(t)throw t;return s}async getLearnerRights(e,s){let{data:t,error:i}=await this.supabase.from("cpf_learner_rights").select("*").eq("organization_id",e).eq("learner_id",s).single();if(i){if("PGRST116"===i.code)return null;throw i}return t}async syncLearnerRights(e,s){let t=await this.getConfiguration(e);if(!t||!t.is_active)throw Error("Configuration CPF non active");let i={organization_id:e,learner_id:s,total_credits:500,available_credits:450,used_credits:50,last_sync_date:new Date().toISOString(),sync_status:"synced"},{data:a,error:n}=await this.supabase.from("cpf_learner_rights").upsert(i,{onConflict:"organization_id,learner_id"}).select().single();if(n)throw n;return a}async getEligibleTrainings(e){let{data:s,error:t}=await this.supabase.from("cpf_eligible_trainings").select("*").eq("organization_id",e).eq("eligibility_status","eligible").order("cpf_training_title",{ascending:!0});if(t){if("PGRST116"===t.code||"42P01"===t.code||"PGRST301"===t.code||404===t.status||"404"===t.code||t.message?.includes("relation")||t.message?.includes("relationship")||t.message?.includes("does not exist")||t.message?.includes("schema cache"))return console.warn("Table cpf_eligible_trainings does not exist yet or invalid query:",t?.message),[];throw t}return s||[]}async createEligibleTraining(e){let{data:s,error:t}=await this.supabase.from("cpf_eligible_trainings").insert(e).select().single();if(t)throw t;return s}async getEnrollments(e,s){let t=this.supabase.from("cpf_enrollments").select("*").eq("organization_id",e);s?.learnerId&&(t=t.eq("learner_id",s.learnerId)),s?.trainingId&&(t=t.eq("training_id",s.trainingId)),s?.status&&(t=t.eq("status",s.status));let{data:i,error:a}=await t.order("enrollment_date",{ascending:!1});if(a){if("PGRST116"===a.code||"42P01"===a.code||"PGRST301"===a.code||404===a.status||"404"===a.code||a.message?.includes("relation")||a.message?.includes("relationship")||a.message?.includes("does not exist")||a.message?.includes("schema cache"))return console.warn("Table cpf_enrollments does not exist yet or invalid query:",a?.message),[];throw a}return i||[]}async createEnrollment(e){let s=await this.getLearnerRights(e.organization_id,e.learner_id);if(!s||s.available_credits<(e.cpf_funding_amount||0))throw Error("Crédits CPF insuffisants");let{data:t,error:i}=await this.supabase.from("cpf_enrollments").insert(e).select().single();if(i)throw i;return await this.supabase.from("cpf_learner_rights").update({available_credits:s.available_credits-(e.cpf_funding_amount||0),used_credits:s.used_credits+(e.cpf_funding_amount||0),updated_at:new Date().toISOString()}).eq("id",s.id),t}async generateAttestation(e){let s=`CPF-${Date.now()}-${Math.random().toString(36).substr(2,9).toUpperCase()}`,{data:t,error:i}=await this.supabase.from("cpf_attestations").insert({...e,attestation_number:s,issue_date:new Date().toISOString().split("T")[0],status:"issued"}).select().single();if(i)throw i;return t}async getAttestations(e){let{data:s,error:t}=await this.supabase.from("cpf_attestations").select("*").eq("enrollment_id",e).order("issue_date",{ascending:!1});if(t)throw t;return s||[]}async syncCatalogFromXML(e,s,t){let i=await this.getConfiguration(e);if(!i||!i.is_active)throw Error("Configuration CPF non active");let a=new FormData;if(s instanceof File)a.append("file",s);else throw Error("Le fichier XML doit être un objet File");let n=await fetch("/api/cpf/catalog-sync",{method:"POST",body:a});if(!n.ok)throw Error((await n.json().catch(()=>({error:"Erreur inconnue"}))).error||`Erreur HTTP: ${n.status}`);let r=await n.json();return{syncId:r.syncId,result:r}}async syncCatalogFromAPI(e,s){let t=await this.getConfiguration(e);if(!t||!t.is_active)throw Error("Configuration CPF non active");if(!t.api_key||!t.api_secret)throw Error("Clés API CPF non configurées");let{data:i,error:a}=await this.supabase.from("cpf_catalog_sync").insert({organization_id:e,sync_type:s?.syncType||"full",sync_method:"api",sync_status:"in_progress",created_by:s?.createdBy}).select().single();if(a)throw a;try{return await this.supabase.from("cpf_catalog_sync").update({sync_status:"completed",completed_at:new Date().toISOString(),records_total:0,records_created:0,records_updated:0}).eq("id",i.id),{syncId:i.id,result:{success:!0,message:"Synchronisation démarrée (à implémenter)"}}}catch(e){throw await this.supabase.from("cpf_catalog_sync").update({sync_status:"failed",completed_at:new Date().toISOString(),error_message:e.message,error_details:{error:e.toString()}}).eq("id",i.id),e}}async getCatalogSyncHistory(e,s){let t=this.supabase.from("cpf_catalog_sync").select("*").eq("organization_id",e).order("created_at",{ascending:!1});s?.status&&(t=t.eq("sync_status",s.status)),s?.syncMethod&&(t=t.eq("sync_method",s.syncMethod)),s?.limit&&(t=t.limit(s.limit));let{data:i,error:a}=await t;if(a)throw a;return i||[]}async getCatalogSyncById(e){let{data:s,error:t}=await this.supabase.from("cpf_catalog_sync").select("*").eq("id",e).single();if(t)throw t;return s}};e.s(["cpfService",0,t])},410768,e=>{"use strict";var s=e.i(843476),t=e.i(266027),i=e.i(912598),a=e.i(325715),n=e.i(655536),r=e.i(970065),l=e.i(167881),c=e.i(994179),o=e.i(127341),d=e.i(6799),u=e.i(32095),m=e.i(503116),h=e.i(599811),g=e.i(16715),x=e.i(107233),f=e.i(178583),p=e.i(761911),j=e.i(25652),b=e.i(522016),y=e.i(647163);let _={pending:"bg-yellow-100 text-yellow-800",approved:"bg-blue-100 text-blue-800",in_progress:"bg-green-100 text-green-800",completed:"bg-green-100 text-green-800",cancelled:"bg-gray-100 text-gray-800",rejected:"bg-red-100 text-red-800"};function C(){let{user:e}=(0,a.useAuth)();(0,i.useQueryClient)();let{addToast:C}=(0,d.useToast)(),{data:w=[],isLoading:v}=(0,t.useQuery)({queryKey:["cpf-eligible-trainings",e?.organization_id],queryFn:async()=>{try{return await n.cpfService.getEligibleTrainings(e.organization_id)}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===404||e?.code==="404"||e?.message?.includes("relation")||e?.message?.includes("relationship")||e?.message?.includes("does not exist")||e?.message?.includes("schema cache"))return console.warn("Error fetching CPF eligible trainings:",e?.message),[];throw e}},enabled:!!e?.organization_id,retry:!1}),{data:N=[],isLoading:T}=(0,t.useQuery)({queryKey:["cpf-enrollments",e?.organization_id],queryFn:async()=>{try{return await n.cpfService.getEnrollments(e.organization_id)}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===404||e?.code==="404"||e?.message?.includes("relation")||e?.message?.includes("relationship")||e?.message?.includes("does not exist")||e?.message?.includes("schema cache"))return console.warn("Error fetching CPF enrollments:",e?.message),[];throw e}},enabled:!!e?.organization_id,retry:!1}),P={totalTrainings:w.length,totalEnrollments:N.length,activeEnrollments:N.filter(e=>"in_progress"===e.status).length,completedEnrollments:N.filter(e=>"completed"===e.status).length,totalFunding:N.reduce((e,s)=>e+s.cpf_funding_amount,0)};return v||T?(0,s.jsx)("div",{className:"container mx-auto py-8 px-4",children:(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)(g.RefreshCw,{className:"h-8 w-8 animate-spin text-brand-blue"})})}):(0,s.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-2",children:[(0,s.jsx)(u.GraduationCap,{className:"h-8 w-8 text-brand-blue"}),"Compte Personnel de Formation (CPF)"]}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Gérez les formations éligibles CPF et les inscriptions de vos stagiaires"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Formations éligibles"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:P.totalTrainings})]}),(0,s.jsx)(u.GraduationCap,{className:"h-8 w-8 text-blue-500"})]})})}),(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Inscriptions"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:P.totalEnrollments})]}),(0,s.jsx)(p.Users,{className:"h-8 w-8 text-green-500"})]})})}),(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"En cours"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:P.activeEnrollments})]}),(0,s.jsx)(m.Clock,{className:"h-8 w-8 text-blue-500"})]})})}),(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Financement CPF"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:(0,y.formatCurrency)(P.totalFunding)})]}),(0,s.jsx)(h.Euro,{className:"h-8 w-8 text-green-500"})]})})})]}),(0,s.jsxs)(o.Tabs,{defaultValue:"trainings",className:"space-y-6",children:[(0,s.jsxs)(o.TabsList,{children:[(0,s.jsx)(o.TabsTrigger,{value:"trainings",children:"Formations éligibles"}),(0,s.jsx)(o.TabsTrigger,{value:"enrollments",children:"Inscriptions"}),(0,s.jsx)(o.TabsTrigger,{value:"learners",children:"Droits des stagiaires"})]}),(0,s.jsx)(o.TabsContent,{value:"trainings",children:(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(r.CardTitle,{children:"Formations éligibles CPF"}),(0,s.jsx)(r.CardDescription,{children:"Liste des formations éligibles au financement CPF"})]}),(0,s.jsx)(l.Button,{asChild:!0,children:(0,s.jsxs)(b.default,{href:"/dashboard/cpf/trainings/new",children:[(0,s.jsx)(x.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une formation"]})})]})}),(0,s.jsx)(r.CardContent,{children:0===w.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(u.GraduationCap,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"Aucune formation éligible CPF configurée"}),(0,s.jsx)(l.Button,{asChild:!0,children:(0,s.jsxs)(b.default,{href:"/dashboard/cpf/trainings/new",children:[(0,s.jsx)(x.Plus,{className:"h-4 w-4 mr-2"}),"Créer la première formation"]})})]}):(0,s.jsx)("div",{className:"space-y-4",children:w.map(e=>(0,s.jsx)(r.Card,{className:"hover:shadow-md transition-shadow",children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:e.cpf_training_title}),(0,s.jsx)(c.Badge,{className:"bg-green-100 text-green-800",children:"Éligible CPF"}),e.cpf_training_code&&(0,s.jsx)(c.Badge,{variant:"outline",children:e.cpf_training_code})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:e.description}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm",children:[(0,s.jsx)("span",{className:"font-semibold",children:(0,y.formatCurrency)(e.price,e.currency)}),e.duration_hours&&(0,s.jsxs)("span",{className:"text-muted-foreground",children:[e.duration_hours,"h"]}),e.certification_level&&(0,s.jsxs)("span",{className:"text-muted-foreground",children:["Niveau ",e.certification_level]}),(0,s.jsxs)("span",{className:"text-muted-foreground",children:[e.current_learners," / ",e.max_learners||"∞"," stagiaires"]})]})]}),(0,s.jsx)(l.Button,{variant:"outline",asChild:!0,children:(0,s.jsx)(b.default,{href:`/dashboard/cpf/trainings/${e.id}`,children:"Voir les détails"})})]})})},e.id))})})]})}),(0,s.jsx)(o.TabsContent,{value:"enrollments",children:(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(r.CardTitle,{children:"Inscriptions CPF"}),(0,s.jsx)(r.CardDescription,{children:"Liste des inscriptions aux formations CPF"})]}),(0,s.jsx)(l.Button,{asChild:!0,children:(0,s.jsxs)(b.default,{href:"/dashboard/cpf/enrollments/new",children:[(0,s.jsx)(x.Plus,{className:"h-4 w-4 mr-2"}),"Nouvelle inscription"]})})]})}),(0,s.jsx)(r.CardContent,{children:0===N.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(p.Users,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"Aucune inscription CPF enregistrée"}),(0,s.jsx)(l.Button,{asChild:!0,children:(0,s.jsxs)(b.default,{href:"/dashboard/cpf/enrollments/new",children:[(0,s.jsx)(x.Plus,{className:"h-4 w-4 mr-2"}),"Créer une inscription"]})})]}):(0,s.jsx)("div",{className:"space-y-4",children:N.map(e=>(0,s.jsx)(r.Card,{className:"hover:shadow-md transition-shadow",children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold",children:["Inscription #",e.id.slice(0,8)]}),(0,s.jsx)(c.Badge,{className:_[e.status],children:e.status.replace(/_/g," ")})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Date d'inscription"}),(0,s.jsx)("p",{className:"font-medium",children:new Date(e.enrollment_date).toLocaleDateString("fr-FR")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Financement CPF"}),(0,s.jsx)("p",{className:"font-medium",children:(0,y.formatCurrency)(e.cpf_funding_amount)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Participation"}),(0,s.jsx)("p",{className:"font-medium",children:(0,y.formatCurrency)(e.learner_contribution)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Total"}),(0,s.jsx)("p",{className:"font-medium",children:(0,y.formatCurrency)(e.total_amount)})]})]}),e.cpf_attestation_number&&(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Attestation: ",e.cpf_attestation_number]})})]}),(0,s.jsx)(l.Button,{variant:"outline",asChild:!0,children:(0,s.jsxs)(b.default,{href:`/dashboard/cpf/enrollments/${e.id}`,children:[(0,s.jsx)(f.FileText,{className:"h-4 w-4 mr-2"}),"Voir les détails"]})})]})})},e.id))})})]})}),(0,s.jsx)(o.TabsContent,{value:"learners",children:(0,s.jsxs)(r.Card,{children:[(0,s.jsxs)(r.CardHeader,{children:[(0,s.jsx)(r.CardTitle,{children:"Droits CPF des stagiaires"}),(0,s.jsx)(r.CardDescription,{children:"Consultez et synchronisez les droits CPF de vos stagiaires"})]}),(0,s.jsx)(r.CardContent,{children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(j.TrendingUp,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"Fonctionnalité en cours de développement"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"La synchronisation avec Mon Compte Formation sera disponible prochainement"})]})})]})})]}),(0,s.jsxs)("div",{className:"mt-8 flex gap-4",children:[(0,s.jsx)(l.Button,{variant:"outline",asChild:!0,children:(0,s.jsxs)(b.default,{href:"/dashboard/cpf/configuration",children:[(0,s.jsx)(u.GraduationCap,{className:"h-4 w-4 mr-2"}),"Configuration CPF"]})}),(0,s.jsx)(l.Button,{variant:"outline",asChild:!0,children:(0,s.jsxs)(b.default,{href:"/dashboard/cpf/catalog-sync",children:[(0,s.jsx)(g.RefreshCw,{className:"h-4 w-4 mr-2"}),"Synchronisation Catalogue"]})}),(0,s.jsx)(l.Button,{variant:"outline",asChild:!0,children:(0,s.jsxs)(b.default,{href:"/dashboard/cpf/attestations",children:[(0,s.jsx)(f.FileText,{className:"h-4 w-4 mr-2"}),"Attestations"]})}),(0,s.jsx)(l.Button,{variant:"outline",asChild:!0,children:(0,s.jsxs)(b.default,{href:"/dashboard/cpf/reports",children:[(0,s.jsx)(f.FileText,{className:"h-4 w-4 mr-2"}),"Rapports"]})})]})]})}e.s(["default",()=>C])}]);