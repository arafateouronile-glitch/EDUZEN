(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,728231,762687,e=>{"use strict";let t,r,n,s,i;var l=e.i(843476),o=e.i(271645),c=e.i(981140),h=e.i(820783),a=e.i(30030),u=e.i(726330),d=e.i(610772),g=e.i(853660),f=e.i(774606),p=e.i(296626),w=e.i(248425),m=e.i(991918),y=e.i(369340),b=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),_=o.forwardRef((e,t)=>(0,l.jsx)(w.Primitive.span,{...e,ref:t,style:{...b,...e.style}}));_.displayName="VisuallyHidden";var[k,v]=(0,a.createContextScope)("Tooltip",[g.createPopperScope]),C=(0,g.createPopperScope)(),E="TooltipProvider",S="tooltip.open",[x,D]=k(E),A=e=>{let{__scopeTooltip:t,delayDuration:r=700,skipDelayDuration:n=300,disableHoverableContent:s=!1,children:i}=e,c=o.useRef(!0),h=o.useRef(!1),a=o.useRef(0);return o.useEffect(()=>{let e=a.current;return()=>window.clearTimeout(e)},[]),(0,l.jsx)(x,{scope:t,isOpenDelayedRef:c,delayDuration:r,onOpen:o.useCallback(()=>{window.clearTimeout(a.current),c.current=!1},[]),onClose:o.useCallback(()=>{window.clearTimeout(a.current),a.current=window.setTimeout(()=>c.current=!0,n)},[n]),isPointerInTransitRef:h,onPointerInTransitChange:o.useCallback(e=>{h.current=e},[]),disableHoverableContent:s,children:i})};A.displayName=E;var I="Tooltip",[L,M]=k(I),T=e=>{let{__scopeTooltip:t,children:r,open:n,defaultOpen:s,onOpenChange:i,disableHoverableContent:c,delayDuration:h}=e,a=D(I,e.__scopeTooltip),u=C(t),[f,p]=o.useState(null),w=(0,d.useId)(),m=o.useRef(0),b=c??a.disableHoverableContent,_=h??a.delayDuration,k=o.useRef(!1),[v,E]=(0,y.useControllableState)({prop:n,defaultProp:s??!1,onChange:e=>{e?(a.onOpen(),document.dispatchEvent(new CustomEvent(S))):a.onClose(),i?.(e)},caller:I}),x=o.useMemo(()=>v?k.current?"delayed-open":"instant-open":"closed",[v]),A=o.useCallback(()=>{window.clearTimeout(m.current),m.current=0,k.current=!1,E(!0)},[E]),M=o.useCallback(()=>{window.clearTimeout(m.current),m.current=0,E(!1)},[E]),T=o.useCallback(()=>{window.clearTimeout(m.current),m.current=window.setTimeout(()=>{k.current=!0,E(!0),m.current=0},_)},[_,E]);return o.useEffect(()=>()=>{m.current&&(window.clearTimeout(m.current),m.current=0)},[]),(0,l.jsx)(g.Root,{...u,children:(0,l.jsx)(L,{scope:t,contentId:w,open:v,stateAttribute:x,trigger:f,onTriggerChange:p,onTriggerEnter:o.useCallback(()=>{a.isOpenDelayedRef.current?T():A()},[a.isOpenDelayedRef,T,A]),onTriggerLeave:o.useCallback(()=>{b?M():(window.clearTimeout(m.current),m.current=0)},[M,b]),onOpen:A,onClose:M,disableHoverableContent:b,children:r})})};T.displayName=I;var O="TooltipTrigger",U=o.forwardRef((e,t)=>{let{__scopeTooltip:r,...n}=e,s=M(O,r),i=D(O,r),a=C(r),u=o.useRef(null),d=(0,h.useComposedRefs)(t,u,s.onTriggerChange),f=o.useRef(!1),p=o.useRef(!1),m=o.useCallback(()=>f.current=!1,[]);return o.useEffect(()=>()=>document.removeEventListener("pointerup",m),[m]),(0,l.jsx)(g.Anchor,{asChild:!0,...a,children:(0,l.jsx)(w.Primitive.button,{"aria-describedby":s.open?s.contentId:void 0,"data-state":s.stateAttribute,...n,ref:d,onPointerMove:(0,c.composeEventHandlers)(e.onPointerMove,e=>{"touch"!==e.pointerType&&(p.current||i.isPointerInTransitRef.current||(s.onTriggerEnter(),p.current=!0))}),onPointerLeave:(0,c.composeEventHandlers)(e.onPointerLeave,()=>{s.onTriggerLeave(),p.current=!1}),onPointerDown:(0,c.composeEventHandlers)(e.onPointerDown,()=>{s.open&&s.onClose(),f.current=!0,document.addEventListener("pointerup",m,{once:!0})}),onFocus:(0,c.composeEventHandlers)(e.onFocus,()=>{f.current||s.onOpen()}),onBlur:(0,c.composeEventHandlers)(e.onBlur,s.onClose),onClick:(0,c.composeEventHandlers)(e.onClick,s.onClose)})})});U.displayName=O;var R="TooltipPortal",[N,j]=k(R,{forceMount:void 0}),P=e=>{let{__scopeTooltip:t,forceMount:r,children:n,container:s}=e,i=M(R,t);return(0,l.jsx)(N,{scope:t,forceMount:r,children:(0,l.jsx)(p.Presence,{present:r||i.open,children:(0,l.jsx)(f.Portal,{asChild:!0,container:s,children:n})})})};P.displayName=R;var F="TooltipContent",B=o.forwardRef((e,t)=>{let r=j(F,e.__scopeTooltip),{forceMount:n=r.forceMount,side:s="top",...i}=e,o=M(F,e.__scopeTooltip);return(0,l.jsx)(p.Presence,{present:n||o.open,children:o.disableHoverableContent?(0,l.jsx)(V,{side:s,...i,ref:t}):(0,l.jsx)($,{side:s,...i,ref:t})})}),$=o.forwardRef((e,t)=>{let r=M(F,e.__scopeTooltip),n=D(F,e.__scopeTooltip),s=o.useRef(null),i=(0,h.useComposedRefs)(t,s),[c,a]=o.useState(null),{trigger:u,onClose:d}=r,g=s.current,{onPointerInTransitChange:f}=n,p=o.useCallback(()=>{a(null),f(!1)},[f]),w=o.useCallback((e,t)=>{let r,n=e.currentTarget,s={x:e.clientX,y:e.clientY},i=function(e,t){let r=Math.abs(t.top-e.y),n=Math.abs(t.bottom-e.y),s=Math.abs(t.right-e.x),i=Math.abs(t.left-e.x);switch(Math.min(r,n,s,i)){case i:return"left";case s:return"right";case r:return"top";case n:return"bottom";default:throw Error("unreachable")}}(s,n.getBoundingClientRect());a(((r=[...function(e,t,r=5){let n=[];switch(t){case"top":n.push({x:e.x-r,y:e.y+r},{x:e.x+r,y:e.y+r});break;case"bottom":n.push({x:e.x-r,y:e.y-r},{x:e.x+r,y:e.y-r});break;case"left":n.push({x:e.x+r,y:e.y-r},{x:e.x+r,y:e.y+r});break;case"right":n.push({x:e.x-r,y:e.y-r},{x:e.x-r,y:e.y+r})}return n}(s,i),...function(e){let{top:t,right:r,bottom:n,left:s}=e;return[{x:s,y:t},{x:r,y:t},{x:r,y:n},{x:s,y:n}]}(t.getBoundingClientRect())].slice()).sort((e,t)=>e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:1*!!(e.y>t.y)),function(e){if(e.length<=1)return e.slice();let t=[];for(let r=0;r<e.length;r++){let n=e[r];for(;t.length>=2;){let e=t[t.length-1],r=t[t.length-2];if((e.x-r.x)*(n.y-r.y)>=(e.y-r.y)*(n.x-r.x))t.pop();else break}t.push(n)}t.pop();let r=[];for(let t=e.length-1;t>=0;t--){let n=e[t];for(;r.length>=2;){let e=r[r.length-1],t=r[r.length-2];if((e.x-t.x)*(n.y-t.y)>=(e.y-t.y)*(n.x-t.x))r.pop();else break}r.push(n)}return(r.pop(),1===t.length&&1===r.length&&t[0].x===r[0].x&&t[0].y===r[0].y)?t:t.concat(r)}(r))),f(!0)},[f]);return o.useEffect(()=>()=>p(),[p]),o.useEffect(()=>{if(u&&g){let e=e=>w(e,g),t=e=>w(e,u);return u.addEventListener("pointerleave",e),g.addEventListener("pointerleave",t),()=>{u.removeEventListener("pointerleave",e),g.removeEventListener("pointerleave",t)}}},[u,g,w,p]),o.useEffect(()=>{if(c){let e=e=>{let t=e.target,r={x:e.clientX,y:e.clientY},n=u?.contains(t)||g?.contains(t),s=!function(e,t){let{x:r,y:n}=e,s=!1;for(let e=0,i=t.length-1;e<t.length;i=e++){let l=t[e],o=t[i],c=l.x,h=l.y,a=o.x,u=o.y;h>n!=u>n&&r<(a-c)*(n-h)/(u-h)+c&&(s=!s)}return s}(r,c);n?p():s&&(p(),d())};return document.addEventListener("pointermove",e),()=>document.removeEventListener("pointermove",e)}},[u,g,c,d,p]),(0,l.jsx)(V,{...e,ref:i})}),[H,W]=k(I,{isInside:!1}),z=(0,m.createSlottable)("TooltipContent"),V=o.forwardRef((e,t)=>{let{__scopeTooltip:r,children:n,"aria-label":s,onEscapeKeyDown:i,onPointerDownOutside:c,...h}=e,a=M(F,r),d=C(r),{onClose:f}=a;return o.useEffect(()=>(document.addEventListener(S,f),()=>document.removeEventListener(S,f)),[f]),o.useEffect(()=>{if(a.trigger){let e=e=>{let t=e.target;t?.contains(a.trigger)&&f()};return window.addEventListener("scroll",e,{capture:!0}),()=>window.removeEventListener("scroll",e,{capture:!0})}},[a.trigger,f]),(0,l.jsx)(u.DismissableLayer,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:i,onPointerDownOutside:c,onFocusOutside:e=>e.preventDefault(),onDismiss:f,children:(0,l.jsxs)(g.Content,{"data-state":a.stateAttribute,...d,...h,ref:t,style:{...h.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[(0,l.jsx)(z,{children:n}),(0,l.jsx)(H,{scope:r,isInside:!0,children:(0,l.jsx)(_,{id:a.contentId,role:"tooltip",children:s||n})})]})})});B.displayName=F;var J="TooltipArrow";o.forwardRef((e,t)=>{let{__scopeTooltip:r,...n}=e,s=C(r);return W(J,r).isInside?null:(0,l.jsx)(g.Arrow,{...s,...n,ref:t})}).displayName=J;var K=e.i(647163);let X=o.forwardRef(({className:e,sideOffset:t=4,...r},n)=>(0,l.jsx)(P,{children:(0,l.jsx)(B,{ref:n,sideOffset:t,className:(0,K.cn)("z-50 overflow-hidden rounded-lg border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-lg","glass-morphism border-white/20","animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95","data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...r})}));X.displayName=B.displayName,e.s(["Tooltip",()=>T,"TooltipContent",()=>X,"TooltipProvider",()=>A,"TooltipTrigger",()=>U],728231);var Y=e.i(247167),q=e.i(920755);let G=()=>new Map,Z=e=>{let t=G();return e.forEach((e,r)=>{t.set(r,e)}),t},Q=(e,t,r)=>{let n=e.get(t);return void 0===n&&e.set(t,n=r()),n},ee=()=>new Set,et=e=>e[e.length-1],er=(e,t)=>{for(let r=0;r<t.length;r++)e.push(t[r])},en=Array.from,es=(e,t)=>{for(let r=0;r<e.length;r++)if(!t(e[r],r,e))return!1;return!0},ei=(e,t)=>{for(let r=0;r<e.length;r++)if(t(e[r],r,e))return!0;return!1},el=Array.isArray;class eo{constructor(){this._observers=G()}on(e,t){return Q(this._observers,e,ee).add(t),t}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);void 0!==r&&(r.delete(t),0===r.size&&this._observers.delete(e))}emit(e,t){return en((this._observers.get(e)||G()).values()).forEach(e=>e(...t))}destroy(){this._observers=G()}}class ec{constructor(){this._observers=G()}on(e,t){Q(this._observers,e,ee).add(t)}once(e,t){let r=(...n)=>{this.off(e,r),t(...n)};this.on(e,r)}off(e,t){let r=this._observers.get(e);void 0!==r&&(r.delete(t),0===r.size&&this._observers.delete(e))}emit(e,t){return en((this._observers.get(e)||G()).values()).forEach(e=>e(...t))}destroy(){this._observers=G()}}let eh=Math.floor,ea=Math.abs,eu=(e,t)=>e<t?e:t,ed=(e,t)=>e>t?e:t,eg=Math.pow,ef=e=>0!==e?e<0:1/e<0,ep=Number.MAX_SAFE_INTEGER,ew=Number.MIN_SAFE_INTEGER,em=Number.isInteger||(e=>"number"==typeof e&&isFinite(e)&&eh(e)===e),ey=String.fromCharCode;ey(65535);let eb=/^\s*/g,e_=/([A-Z])/g,ek=(e,t)=>e.replace(e_,e=>`${t}${e.toLowerCase()}`).replace(eb,""),ev="undefined"!=typeof TextEncoder?new TextEncoder:null,eC=ev?e=>ev.encode(e):e=>{let t=unescape(encodeURIComponent(e)),r=t.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=t.codePointAt(e);return n},eE="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});eE&&1===eE.decode(new Uint8Array).length&&(eE=null);let eS=(e,t)=>((e,t)=>{let r=Array(e);for(let n=0;n<e;n++)r[n]=t(n,r);return r})(t,()=>e).join("");class ex{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}let eD=()=>new ex,eA=e=>{let t=e.cpos;for(let r=0;r<e.bufs.length;r++)t+=e.bufs[r].length;return t},eI=e=>{let t=new Uint8Array(eA(e)),r=0;for(let n=0;n<e.bufs.length;n++){let s=e.bufs[n];t.set(s,r),r+=s.length}return t.set(new Uint8Array(e.cbuf.buffer,0,e.cpos),r),t},eL=(e,t)=>{let r=e.cbuf.length;e.cpos===r&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*r),e.cpos=0),e.cbuf[e.cpos++]=t},eM=(e,t)=>{for(;t>127;)eL(e,128|127&t),t=eh(t/128);eL(e,127&t)},eT=(e,t)=>{let r=ef(t);for(r&&(t=-t),eL(e,128*(t>63)|64*!!r|63&t),t=eh(t/64);t>0;)eL(e,128*(t>127)|127&t),t=eh(t/128)},eO=new Uint8Array(3e4),eU=eO.length/3,eR=ev&&ev.encodeInto?(e,t)=>{if(t.length<eU){let r=ev.encodeInto(t,eO).written||0;eM(e,r);for(let t=0;t<r;t++)eL(e,eO[t])}else ej(e,eC(t))}:(e,t)=>{let r=unescape(encodeURIComponent(t)),n=r.length;eM(e,n);for(let t=0;t<n;t++)eL(e,r.codePointAt(t))},eN=(e,t)=>{let r=e.cbuf.length,n=e.cpos,s=eu(r-n,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),n),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(ed(2*r,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},ej=(e,t)=>{eM(e,t.byteLength),eN(e,t)},eP=(e,t)=>{let r;(r=e.cbuf.length)-e.cpos<t&&(e.bufs.push(new Uint8Array(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(2*ed(r,t)),e.cpos=0);let n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},eF=new DataView(new ArrayBuffer(4)),eB=(e,t)=>{switch(typeof t){case"string":eL(e,119),eR(e,t);break;case"number":if(em(t)&&0x7fffffff>=ea(t))eL(e,125),eT(e,t);else if(eF.setFloat32(0,t),eF.getFloat32(0)===t)eL(e,124),eP(e,4).setFloat32(0,t,!1);else eL(e,123),eP(e,8).setFloat64(0,t,!1);break;case"bigint":eL(e,122),eP(e,8).setBigInt64(0,t,!1);break;case"object":if(null===t)eL(e,126);else if(el(t)){eL(e,117),eM(e,t.length);for(let r=0;r<t.length;r++)eB(e,t[r])}else if(t instanceof Uint8Array)eL(e,116),ej(e,t);else{eL(e,118);let r=Object.keys(t);eM(e,r.length);for(let n=0;n<r.length;n++){let s=r[n];eR(e,s),eB(e,t[s])}}break;case"boolean":eL(e,t?120:121);break;default:eL(e,127)}};class e$ extends ex{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&eM(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}let eH=e=>{e.count>0&&(eT(e.encoder,1===e.count?e.s:-e.s),e.count>1&&eM(e.encoder,e.count-2))};class eW{constructor(){this.encoder=new ex,this.s=0,this.count=0}write(e){this.s===e?this.count++:(eH(this),this.count=1,this.s=e)}toUint8Array(){return eH(this),eI(this.encoder)}}let ez=e=>{if(e.count>0){let t=2*e.diff+ +(1!==e.count);eT(e.encoder,t),e.count>1&&eM(e.encoder,e.count-2)}};class eV{constructor(){this.encoder=new ex,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(ez(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return ez(this),eI(this.encoder)}}class eJ{constructor(){this.sarr=[],this.s="",this.lensE=new eW}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){let e=new ex;return this.sarr.push(this.s),this.s="",eR(e,this.sarr.join("")),eN(e,this.lensE.toUint8Array()),eI(e)}}let eK=()=>{throw Error("Method unimplemented")},eX=()=>{throw Error("Unexpected case")},eY=Error("Unexpected end of array"),eq=Error("Integer out of Range");class eG{constructor(e){this.arr=e,this.pos=0}}let eZ=e=>new eG(e),eQ=e=>{var t;let r;return t=e1(e),r=new Uint8Array(e.arr.buffer,e.pos+e.arr.byteOffset,t),e.pos+=t,r},e0=e=>e.arr[e.pos++],e1=e=>{let t=0,r=1,n=e.arr.length;for(;e.pos<n;){let n=e.arr[e.pos++];if(t+=(127&n)*r,r*=128,n<128)return t;if(t>ep)throw eq}throw eY},e2=e=>{let t=e.arr[e.pos++],r=63&t,n=64,s=(64&t)>0?-1:1;if((128&t)==0)return s*r;let i=e.arr.length;for(;e.pos<i;){if(r+=(127&(t=e.arr[e.pos++]))*n,n*=128,t<128)return s*r;if(r>ep)throw eq}throw eY},e8=eE?e=>eE.decode(eQ(e)):e=>{let t=e1(e);if(0===t)return"";{let r=String.fromCodePoint(e0(e));if(--t<100)for(;t--;)r+=String.fromCodePoint(e0(e));else for(;t>0;){let n=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+n);e.pos+=n,r+=String.fromCodePoint.apply(null,s),t-=n}return decodeURIComponent(escape(r))}},e3=(e,t)=>{let r=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,r},e4=[e=>void 0,e=>null,e2,e=>e3(e,4).getFloat32(0,!1),e=>e3(e,8).getFloat64(0,!1),e=>e3(e,8).getBigInt64(0,!1),e=>!1,e=>!0,e8,e=>{let t=e1(e),r={};for(let n=0;n<t;n++)r[e8(e)]=e6(e);return r},e=>{let t=e1(e),r=[];for(let n=0;n<t;n++)r.push(e6(e));return r},eQ],e6=e=>e4[127-e0(e)](e);class e7 extends eG{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){0===this.count&&(this.s=this.reader(this),this.pos!==this.arr.length?this.count=e1(this)+1:this.count=-1);return this.count--,this.s}}class e5 extends eG{constructor(e){super(e),this.s=0,this.count=0}read(){if(0===this.count){this.s=e2(this);let e=ef(this.s);this.count=1,e&&(this.s=-this.s,this.count=e1(this)+2)}return this.count--,this.s}}class e9 extends eG{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){let e=e2(this);this.diff=eh(e/2),this.count=1,1&e&&(this.count=e1(this)+2)}return this.s+=this.diff,this.count--,this.s}}class te{constructor(e){this.decoder=new e5(e),this.str=e8(this.decoder),this.spos=0}read(){let e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}crypto.subtle;let tt=crypto.getRandomValues.bind(crypto),tr=()=>tt(new Uint32Array(1))[0],tn=Date.now,ts=e=>new Promise(e);Promise.all.bind(Promise);var ti=e.i(467034);let tl=e=>void 0===e?null:e,to=new class{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}},tc=!0;try{"undefined"!=typeof localStorage&&localStorage&&(to=localStorage,tc=!1)}catch(e){}let th=to,ta=Symbol("Equality"),tu=(e,t)=>e===t||!!e?.[ta]?.(t),td=Object.assign,tg=Object.keys,tf=(e,t)=>{for(let r in e)if(!t(e[r],r))return!1;return!0},tp=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),tw=Object.freeze,tm=e=>{for(let t in e){let r=e[t];("object"==typeof r||"function"==typeof r)&&tm(e[t])}return tw(e)},ty=(e,t,r=0)=>{try{for(;r<e.length;r++)e[r](...t)}finally{r<e.length&&ty(e,t,r+1)}},tb=e=>e,t_=(e,t)=>{if(e===t)return!0;if(null==e||null==t||e.constructor!==t.constructor&&(e.constructor||Object)!==(t.constructor||Object))return!1;if(null!=e[ta])return e[ta](t);switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;break;case Set:if(e.size!==t.size)return!1;for(let r of e)if(!t.has(r))return!1;break;case Map:if(e.size!==t.size)return!1;for(let r of e.keys())if(!t.has(r)||!t_(e.get(r),t.get(r)))return!1;break;case void 0:case Object:if(tg(e).length!==tg(t).length)return!1;for(let r in e)if(!tp(e,r)||!t_(e[r],t[r]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!t_(e[r],t[r]))return!1;break;default:return!1}return!0},tk=void 0!==Y.default&&Y.default.release&&/node|io\.js/.test(Y.default.release.name)&&"[object process]"===Object.prototype.toString.call(void 0!==Y.default?Y.default:0),tv="undefined"!=typeof window&&"undefined"!=typeof document&&!tk;"undefined"!=typeof navigator&&/Mac/.test(navigator.platform);let tC=[],tE=e=>(()=>{if(void 0===t)if(tk){t=G();let e=Y.default.argv,r=null;for(let n=0;n<e.length;n++){let s=e[n];"-"===s[0]?(null!==r&&t.set(r,""),r=s):null!==r?(t.set(r,s),r=null):tC.push(s)}null!==r&&t.set(r,"")}else"object"==typeof location?(t=G(),(location.search||"?").slice(1).split("&").forEach(e=>{if(0!==e.length){let[r,n]=e.split("=");t.set(`--${ek(r,"-")}`,n),t.set(`-${ek(r,"-")}`,n)}})):t=G();return t})().has(e),tS=e=>tk?tl(Y.default.env[e.toUpperCase().replaceAll("-","_")]):tl(th.getItem(e)),tx=e=>tE("--"+e)||null!==tS(e),tD=tx("production"),tA=tk&&["true","1","2"].includes(Y.default.env.FORCE_COLOR)||!tE("--no-colors")&&!tx("no-color")&&(!tk||Y.default.stdout.isTTY)&&(!tk||tE("--color")||null!==tS("COLORTERM")||(tS("TERM")||"").includes("color")),tI=e=>new Uint8Array(e),tL=tv?e=>{let t="";for(let r=0;r<e.byteLength;r++)t+=ey(e[r]);return btoa(t)}:e=>ti.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),tM=tv?e=>{let t=atob(e),r=tI(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}:e=>{let t,r=ti.Buffer.from(e,"base64");return t=r.buffer,new Uint8Array(t,r.byteOffset,r.byteLength)};class tT{constructor(e,t){this.left=e,this.right=t}}let tO=(e,t)=>new tT(e,t),tU=e=>e.next()>=.5,tR=(e,t,r)=>eh(e.next()*(r+1-t)+t),tN=(e,t,r)=>eh(e.next()*(r+1-t)+t),tj=e=>ey(tN(e,97,122)),tP=(e,t)=>t[tN(e,0,t.length-1)],tF=Symbol("0schema");class tB{constructor(){this._rerrs=[]}extend(e,t,r,n=null){this._rerrs.push({path:e,expected:t,has:r,message:n})}toString(){let e=[];for(let t=this._rerrs.length-1;t>0;t--){let r=this._rerrs[t];e.push(eS(" ",(this._rerrs.length-t)*2)+`${null!=r.path?`[${r.path}] `:""}${r.has} doesn't match ${r.expected}. ${r.message}`)}return e.join("\n")}}let t$=(e,t)=>e===t||null!=e&&null!=t&&e.constructor===t.constructor&&(e[ta]?tu(e,t):el(e)?es(e,e=>ei(t,t=>t$(e,t))):"object"==typeof e&&tf(e,(e,r)=>t$(e,t[r])));class tH{static _dilutes=!1;extends(e){let[t,r]=[this.shape,e.shape];return this.constructor._dilutes&&([r,t]=[t,r]),t$(t,r)}equals(e){return this.constructor===e.constructor&&t_(this.shape,e.shape)}[tF](){return!0}[ta](e){return this.equals(e)}validate(e){return this.check(e)}check(e,t){eK()}get nullable(){return rc(this,rC)}get optional(){return new tQ(this)}cast(e){return rD(e,this),e}expect(e){return rD(e,this),e}}class tW extends tH{constructor(e,t){super(),this.shape=e,this._c=t}check(e,t){let r=e?.constructor===this.shape&&(null==this._c||this._c(e));return r||t?.extend(null,this.shape.name,e?.constructor.name,e?.constructor!==this.shape?"Constructor match failed":"Check failed"),r}}let tz=(e,t=null)=>new tW(e,t);tz(tW);class tV extends tH{constructor(e){super(),this.shape=e}check(e,t){let r=this.shape(e);return r||t?.extend(null,"custom prop",e?.constructor.name,"failed to check custom prop"),r}}let tJ=e=>new tV(e);tz(tV);class tK extends tH{constructor(e){super(),this.shape=e}check(e,t){let r=this.shape.some(t=>t===e);return r||t?.extend(null,this.shape.join(" | "),e.toString()),r}}let tX=(...e)=>new tK(e),tY=tz(tK),tq=RegExp.escape||(e=>e.replace(/[().|&,$^[\]]/g,e=>"\\"+e)),tG=e=>ry.check(e)?[tq(e)]:tY.check(e)?e.shape.map(e=>e+""):rm.check(e)?["[+-]?\\d+.?\\d*"]:rb.check(e)?[".*"]:rh.check(e)?e.shape.map(tG).flat(1):void eX();tz(class extends tH{constructor(e){super(),this.shape=e,this._r=RegExp("^"+e.map(tG).map(e=>`(${e.join("|")})`).join("")+"$")}check(e,t){let r=null!=this._r.exec(e);return r||t?.extend(null,this._r.toString(),e.toString(),"String doesn't match string template."),r}});let tZ=Symbol("optional");class tQ extends tH{constructor(e){super(),this.shape=e}check(e,t){let r=void 0===e||this.shape.check(e);return r||t?.extend(null,"undefined (optional)","()"),r}get[tZ](){return!0}}let t0=tz(tQ);class t1 extends tH{check(e,t){return t?.extend(null,"never",typeof e),!1}}new t1,tz(t1);class t2 extends tH{constructor(e,t=!1){super(),this.shape=e,this._isPartial=t}static _dilutes=!0;get partial(){return new t2(this.shape,!0)}check(e,t){return null==e?(t?.extend(null,"object","null"),!1):tf(this.shape,(r,n)=>{let s=this._isPartial&&!tp(e,n)||r.check(e[n],t);return s||t?.extend(n.toString(),r.toString(),typeof e[n],"Object property does not match"),s})}}let t8=tz(t2),t3=tJ(e=>null!=e&&(e.constructor===Object||null==e.constructor));class t4 extends tH{constructor(e,t){super(),this.shape={keys:e,values:t}}check(e,t){return null!=e&&tf(e,(r,n)=>{let s=this.shape.keys.check(n,t);return s||t?.extend(n+"","Record",typeof e,s?"Key doesn't match schema":"Value doesn't match value"),s&&this.shape.values.check(r,t)})}}let t6=(e,t)=>new t4(e,t),t7=tz(t4);class t5 extends tH{constructor(e){super(),this.shape=e}check(e,t){return null!=e&&tf(this.shape,(r,n)=>{let s=r.check(e[n],t);return s||t?.extend(n.toString(),"Tuple",typeof r),s})}}tz(t5);class t9 extends tH{constructor(e){super(),this.shape=1===e.length?e[0]:new ro(e)}check(e,t){let r=el(e)&&es(e,e=>this.shape.check(e));return r||t?.extend(null,"Array",""),r}}let re=(...e)=>new t9(e),rt=tz(t9),rr=tJ(e=>el(e));class rn extends tH{constructor(e,t){super(),this.shape=e,this._c=t}check(e,t){let r=e instanceof this.shape&&(null==this._c||this._c(e));return r||t?.extend(null,this.shape.name,e?.constructor.name),r}}tz(rn);let rs=((e,t=null)=>new rn(e,t))(tH),ri=tz(class extends tH{constructor(e){super(),this.len=e.length-1,this.args=((...e)=>new t5(e))(...e.slice(-1)),this.res=e[this.len]}check(e,t){let r=e.constructor===Function&&e.length<=this.len;return r||t?.extend(null,"function",typeof e),r}}),rl=tJ(e=>"function"==typeof e);tz(class extends tH{constructor(e){super(),this.shape=e}check(e,t){let r=es(this.shape,r=>r.check(e,t));return r||t?.extend(null,"Intersectinon",typeof e),r}},e=>e.shape.length>0);class ro extends tH{static _dilutes=!0;constructor(e){super(),this.shape=e}check(e,t){let r=ei(this.shape,r=>r.check(e,t));return t?.extend(null,"Union",typeof e),r}}let rc=(...e)=>e.findIndex(e=>rh.check(e))>=0?rc(...e.map(e=>rx(e)).map(e=>rh.check(e)?e.shape:[e]).flat(1)):1===e.length?e[0]:new ro(e),rh=tz(ro),ra=()=>!0,ru=tJ(ra),rd=tz(tV,e=>e.shape===ra),rg=tJ(e=>"bigint"==typeof e),rf=tJ(e=>e===rg),rp=tJ(e=>"symbol"==typeof e);tJ(e=>e===rp);let rw=tJ(e=>"number"==typeof e),rm=tJ(e=>e===rw),ry=tJ(e=>"string"==typeof e),rb=tJ(e=>e===ry),r_=tJ(e=>"boolean"==typeof e),rk=tJ(e=>e===r_),rv=tX(void 0);tz(tK,e=>1===e.shape.length&&void 0===e.shape[0]),tX(void 0);let rC=tX(null),rE=tz(tK,e=>1===e.shape.length&&null===e.shape[0]);tz(Uint8Array),tz(tW,e=>e.shape===Uint8Array);let rS=rc(rw,ry,rC,rv,rg,r_,rp);r=re(ru),n=t6(ry,ru),s=rc(rw,ry,rC,r_,r,n),r.shape=s,n.shape.values=s;let rx=e=>{if(rs.check(e))return e;if(t3.check(e)){let t={};for(let r in e)t[r]=rx(e[r]);return new t2(t)}if(rr.check(e))return rc(...e.map(rx));if(rS.check(e))return tX(e);if(rl.check(e))return tz(e);eX()},rD=tD?()=>{}:(e,t)=>{let r=new tB;if(!t.check(e,r))throw Error(`Expected value to be of type ${t.constructor.name}.
${r.toString()}`)},rA=new class e{constructor(e){this.patterns=[],this.$state=e}if(e,t){return this.patterns.push({if:rx(e),h:t}),this}else(e){return this.if(ru,e)}done(){return(e,t)=>{for(let r=0;r<this.patterns.length;r++){let n=this.patterns[r];if(n.if.check(e))return n.h(e,t)}throw Error("Unhandled pattern")}}}(ru).if(rm,(e,t)=>tR(t,ew,ep)).if(rb,(e,t)=>((e,t=0,r=20)=>{let n=tN(e,t,r),s="";for(let t=0;t<n;t++)s+=tj(e);return s})(t)).if(rk,(e,t)=>tU(t)).if(rf,(e,t)=>BigInt(tR(t,ew,ep))).if(rh,(e,t)=>rI(t,tP(t,e.shape))).if(t8,(e,t)=>{let r={};for(let n in e.shape){let s=e.shape[n];if(t0.check(s)){if(tU(t))continue;s=s.shape}r[n]=rA(s,t)}return r}).if(rt,(e,t)=>{let r=[],n=tN(t,0,42);for(let s=0;s<n;s++)r.push(rI(t,e.shape));return r}).if(tY,(e,t)=>tP(t,e.shape)).if(rE,(e,t)=>null).if(ri,(e,t)=>{let r=rI(t,e.res);return()=>r}).if(rd,(e,t)=>rI(t,tP(t,[rw,ry,rC,rv,rg,r_,re(rw),t6(rc("a","b","c"),rw)]))).if(t7,(e,t)=>{let r={},n=tR(t,0,3);for(let s=0;s<n;s++){let n=rI(t,e.shape.keys),s=rI(t,e.shape.values);r[n]=s}return r}).done(),rI=(e,t)=>rA(rx(t),e),rL="undefined"!=typeof document?document:{};tJ(e=>e.nodeType===rR),"undefined"!=typeof DOMParser&&new DOMParser,tJ(e=>e.nodeType===rT),tJ(e=>e.nodeType===rO);let rM=e=>((e,t)=>{let r=[];for(let[n,s]of e)r.push(t(s,n));return r})(e,(e,t)=>`${t}:${e};`).join(""),rT=rL.ELEMENT_NODE,rO=rL.TEXT_NODE;rL.CDATA_SECTION_NODE,rL.COMMENT_NODE;let rU=rL.DOCUMENT_NODE;rL.DOCUMENT_TYPE_NODE;let rR=rL.DOCUMENT_FRAGMENT_NODE;tJ(e=>e.nodeType===rU);let rN=e=>class{constructor(e){this._=e}destroy(){e(this._)}};rN(clearTimeout),rN(clearInterval),rN(e=>"undefined"!=typeof requestAnimationFrame&&cancelAnimationFrame(e)),rN(e=>"undefined"!=typeof cancelIdleCallback&&cancelIdleCallback(e));let rj=Symbol,rP=rj(),rF=rj(),rB=rj(),r$=rj(),rH=rj(),rW=rj(),rz=rj(),rV=rj(),rJ=rj();tn();let rK={[rP]:tO("font-weight","bold"),[rF]:tO("font-weight","normal"),[rB]:tO("color","blue"),[rH]:tO("color","green"),[r$]:tO("color","grey"),[rW]:tO("color","red"),[rz]:tO("color","purple"),[rV]:tO("color","orange"),[rJ]:tO("color","black")},rX=tA?e=>{1===e.length&&e[0]?.constructor===Function&&(e=e[0]());let t=[],r=[],n=G(),s=[],i=0;for(;i<e.length;i++){let s=e[i],l=rK[s];if(void 0!==l)n.set(l.left,l.right);else{if(void 0===s)break;if(s.constructor===String||s.constructor===Number){let e=rM(n);i>0||e.length>0?(t.push("%c"+s),r.push(e)):t.push(s)}else break}}for(i>0&&(s=r).unshift(t.join(""));i<e.length;i++){let t=e[i];t instanceof Symbol||s.push(t)}return s}:e=>{1===e.length&&e[0]?.constructor===Function&&(e=e[0]());let t=[],r=[],n=0;for(;n<e.length;n++){let r=e[n];if(void 0===r)break;if(r.constructor===String||r.constructor===Number)t.push(r);else if(r.constructor===Object)break}for(n>0&&r.push(t.join(""));n<e.length;n++){let t=e[n];t instanceof Symbol||r.push(t)}return r},rY=ee(),rq=e=>({[Symbol.iterator](){return this},next:e}),rG=(e,t)=>rq(()=>{let{done:r,value:n}=e.next();return{done:r,value:r?void 0:t(n)}});class rZ{constructor(e,t){this.clock=e,this.len=t}}class rQ{constructor(){this.clients=new Map}}let r0=(e,t,r)=>t.clients.forEach((t,n)=>{let s=e.doc.store.clients.get(n);if(null!=s){let n=s[s.length-1],i=n.id.clock+n.length;for(let n=0,l=t[n];n<t.length&&l.clock<i;l=t[++n])nI(e,s,l.clock,l.len,r)}}),r1=(e,t)=>{let r=e.clients.get(t.client);return void 0!==r&&null!==((e,t)=>{let r=0,n=e.length-1;for(;r<=n;){let s=eh((r+n)/2),i=e[s],l=i.clock;if(l<=t){if(t<l+i.len)return s;r=s+1}else n=s-1}return null})(r,t.clock)},r2=e=>{e.clients.forEach(e=>{let t,r;for(e.sort((e,t)=>e.clock-t.clock),t=1,r=1;t<e.length;t++){let n=e[r-1],s=e[t];n.clock+n.len>=s.clock?n.len=ed(n.len,s.clock+s.len-n.clock):(r<t&&(e[r]=s),r++)}e.length=r})},r8=(e,t,r,n)=>{Q(e.clients,t,()=>[]).push(new rZ(r,n))},r3=()=>new rQ,r4=(e,t)=>{eM(e.restEncoder,t.clients.size),en(t.clients.entries()).sort((e,t)=>t[0]-e[0]).forEach(([t,r])=>{e.resetDsCurVal(),eM(e.restEncoder,t);let n=r.length;eM(e.restEncoder,n);for(let t=0;t<n;t++){let n=r[t];e.writeDsClock(n.clock),e.writeDsLen(n.len)}})},r6=e=>{let t=new rQ,r=e1(e.restDecoder);for(let n=0;n<r;n++){e.resetDsCurVal();let r=e1(e.restDecoder),n=e1(e.restDecoder);if(n>0){let s=Q(t.clients,r,()=>[]);for(let t=0;t<n;t++)s.push(new rZ(e.readDsClock(),e.readDsLen()))}}return t},r7=(e,t,r)=>{let n=new rQ,s=e1(e.restDecoder);for(let i=0;i<s;i++){e.resetDsCurVal();let s=e1(e.restDecoder),i=e1(e.restDecoder),l=r.clients.get(s)||[],o=nv(r,s);for(let r=0;r<i;r++){let r=e.readDsClock(),i=r+e.readDsLen();if(r<o){o<i&&r8(n,s,o,i-o);let e=nE(l,r),c=l[e];for(!c.deleted&&c.id.clock<r&&(l.splice(e+1,0,sG(t,c,r-c.id.clock)),e++);e<l.length;)if((c=l[e++]).id.clock<i)c.deleted||(i<c.id.clock+c.length&&l.splice(e,0,sG(t,c,i-c.id.clock)),c.delete(t));else break}else r8(n,s,r,i-r)}}if(n.clients.size>0){let e=new nl;return eM(e.restEncoder,0),r4(e,n),e.toUint8Array()}return null};class r5 extends eo{constructor({guid:e="10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^tr()&15>>e/4).toString(16)),collectionid:t=null,gc:r=!0,gcFilter:n=()=>!0,meta:s=null,autoLoad:i=!1,shouldLoad:l=!0}={}){super(),this.gc=r,this.gcFilter=n,this.clientID=tr(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new n_,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=l,this.autoLoad=i,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=ts(e=>{this.on("load",()=>{this.isLoaded=!0,e(this)})});const o=()=>ts(e=>{let t=r=>{(void 0===r||!0===r)&&(this.off("sync",t),e())};this.on("sync",t)});this.on("sync",e=>{!1===e&&this.isSynced&&(this.whenSynced=o()),this.isSynced=void 0===e||!0===e,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=o()}load(){let e=this._item;null===e||this.shouldLoad||nR(e.parent.doc,e=>{e.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(en(this.subdocs).map(e=>e.guid))}transact(e,t=null){return nR(this,e,t)}get(e,t=nQ){let r=Q(this.share,e,()=>{let e=new t;return e._integrate(this,null),e}),n=r.constructor;if(t!==nQ&&n!==t)if(n===nQ){let n=new t;n._map=r._map,r._map.forEach(e=>{for(;null!==e;e=e.left)e.parent=n}),n._start=r._start;for(let e=n._start;null!==e;e=e.right)e.parent=n;return n._length=r._length,this.share.set(e,n),n._integrate(this,null),n}else throw Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,si)}getText(e=""){return this.get(e,sC)}getMap(e=""){return this.get(e,so)}getXmlElement(e=""){return this.get(e,sx)}getXmlFragment(e=""){return this.get(e,sS)}toJSON(){let e={};return this.share.forEach((t,r)=>{e[r]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,en(this.subdocs).forEach(e=>e.destroy());let e=this._item;if(null!==e){this._item=null;let t=e.content;t.doc=new r5({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,nR(e.parent.doc,r=>{let n=t.doc;e.deleted||r.subdocsAdded.add(n),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class r9{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return e1(this.restDecoder)}readDsLen(){return e1(this.restDecoder)}}class ne extends r9{readLeftID(){return nm(e1(this.restDecoder),e1(this.restDecoder))}readRightID(){return nm(e1(this.restDecoder),e1(this.restDecoder))}readClient(){return e1(this.restDecoder)}readInfo(){return e0(this.restDecoder)}readString(){return e8(this.restDecoder)}readParentInfo(){return 1===e1(this.restDecoder)}readTypeRef(){return e1(this.restDecoder)}readLen(){return e1(this.restDecoder)}readAny(){return e6(this.restDecoder)}readBuf(){var e;let t;return(t=tI((e=eQ(this.restDecoder)).byteLength)).set(e),t}readJSON(){return JSON.parse(e8(this.restDecoder))}readKey(){return e8(this.restDecoder)}}class nt{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=e1(this.restDecoder),this.dsCurrVal}readDsLen(){let e=e1(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class nr extends nt{constructor(e){super(e),this.keys=[],e1(e),this.keyClockDecoder=new e9(eQ(e)),this.clientDecoder=new e5(eQ(e)),this.leftClockDecoder=new e9(eQ(e)),this.rightClockDecoder=new e9(eQ(e)),this.infoDecoder=new e7(eQ(e),e0),this.stringDecoder=new te(eQ(e)),this.parentInfoDecoder=new e7(eQ(e),e0),this.typeRefDecoder=new e5(eQ(e)),this.lenDecoder=new e5(eQ(e))}readLeftID(){return new np(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new np(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return e6(this.restDecoder)}readBuf(){return eQ(this.restDecoder)}readJSON(){return e6(this.restDecoder)}readKey(){let e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{let e=this.stringDecoder.read();return this.keys.push(e),e}}}class nn{constructor(){this.restEncoder=eD()}toUint8Array(){return eI(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){eM(this.restEncoder,e)}writeDsLen(e){eM(this.restEncoder,e)}}class ns extends nn{writeLeftID(e){eM(this.restEncoder,e.client),eM(this.restEncoder,e.clock)}writeRightID(e){eM(this.restEncoder,e.client),eM(this.restEncoder,e.clock)}writeClient(e){eM(this.restEncoder,e)}writeInfo(e){eL(this.restEncoder,e)}writeString(e){eR(this.restEncoder,e)}writeParentInfo(e){eM(this.restEncoder,+!!e)}writeTypeRef(e){eM(this.restEncoder,e)}writeLen(e){eM(this.restEncoder,e)}writeAny(e){eB(this.restEncoder,e)}writeBuf(e){ej(this.restEncoder,e)}writeJSON(e){eR(this.restEncoder,JSON.stringify(e))}writeKey(e){eR(this.restEncoder,e)}}class ni{constructor(){this.restEncoder=eD(),this.dsCurrVal=0}toUint8Array(){return eI(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){let t=e-this.dsCurrVal;this.dsCurrVal=e,eM(this.restEncoder,t)}writeDsLen(e){0===e&&eX(),eM(this.restEncoder,e-1),this.dsCurrVal+=e}}class nl extends ni{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new eV,this.clientEncoder=new eW,this.leftClockEncoder=new eV,this.rightClockEncoder=new eV,this.infoEncoder=new e$(eL),this.stringEncoder=new eJ,this.parentInfoEncoder=new e$(eL),this.typeRefEncoder=new eW,this.lenEncoder=new eW}toUint8Array(){let e=eD();return eM(e,0),ej(e,this.keyClockEncoder.toUint8Array()),ej(e,this.clientEncoder.toUint8Array()),ej(e,this.leftClockEncoder.toUint8Array()),ej(e,this.rightClockEncoder.toUint8Array()),ej(e,eI(this.infoEncoder)),ej(e,this.stringEncoder.toUint8Array()),ej(e,eI(this.parentInfoEncoder)),ej(e,this.typeRefEncoder.toUint8Array()),ej(e,this.lenEncoder.toUint8Array()),eN(e,eI(this.restEncoder)),eI(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(+!!e)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){eB(this.restEncoder,e)}writeBuf(e){ej(this.restEncoder,e)}writeJSON(e){eB(this.restEncoder,e)}writeKey(e){let t=this.keyMap.get(e);void 0===t?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}let no=(e,t,r)=>{let n=new Map;r.forEach((e,r)=>{nv(t,r)>e&&n.set(r,e)}),nk(t).forEach((e,t)=>{r.has(t)||n.set(t,0)}),eM(e.restEncoder,n.size),en(n.entries()).sort((e,t)=>t[0]-e[0]).forEach(([r,n])=>{((e,t,r,n)=>{n=ed(n,t[0].id.clock);let s=nE(t,n);eM(e.restEncoder,t.length-s),e.writeClient(r),eM(e.restEncoder,n);let i=t[s];i.write(e,n-i.id.clock);for(let r=s+1;r<t.length;r++)t[r].write(e,0)})(e,t.clients.get(r),r,n)})},nc=(e,t,r,n=nr)=>{let s=eZ(t);((e,t,r,n=new nr(e))=>nR(t,e=>{e.local=!1;let t=!1,r=e.doc,s=r.store,i=((e,t,r)=>{let n=[],s=en(r.keys()).sort((e,t)=>e-t);if(0===s.length)return null;let i=()=>{if(0===s.length)return null;let e=r.get(s[s.length-1]);for(;e.refs.length===e.i;){if(s.pop(),!(s.length>0))return null;e=r.get(s[s.length-1])}return e},l=i();if(null===l)return null;let o=new n_,c=new Map,h=(e,t)=>{let r=c.get(e);(null==r||r>t)&&c.set(e,t)},a=l.refs[l.i++],u=new Map,d=()=>{for(let e of n){let t=e.id.client,n=r.get(t);n?(n.i--,o.clients.set(t,n.refs.slice(n.i)),r.delete(t),n.i=0,n.refs=[]):o.clients.set(t,[e]),s=s.filter(e=>e!==t)}n.length=0};for(;;){if(a.constructor!==s1){let s=Q(u,a.id.client,()=>nv(t,a.id.client))-a.id.clock;if(s<0)n.push(a),h(a.id.client,a.id.clock-1),d();else{let i=a.getMissing(e,t);if(null!==i){n.push(a);let e=r.get(i)||{refs:[],i:0};if(e.refs.length===e.i)h(i,nv(t,i)),d();else{a=e.refs[e.i++];continue}}else(0===s||s<a.length)&&(a.integrate(e,s),u.set(a.id.client,a.id.clock+a.length))}}if(n.length>0)a=n.pop();else if(null!==l&&l.i<l.refs.length)a=l.refs[l.i++];else{if(null===(l=i()))break;a=l.refs[l.i++]}}if(o.clients.size>0){let e=new nl;return no(e,o,new Map),eM(e.restEncoder,0),{missing:c,update:e.toUint8Array()}}return null})(e,s,((e,t)=>{let r=G(),n=e1(e.restDecoder);for(let s=0;s<n;s++){let n=e1(e.restDecoder),s=Array(n),i=e.readClient(),l=e1(e.restDecoder);r.set(i,{i:0,refs:s});for(let r=0;r<n;r++){let n=e.readInfo();switch(31&n){case 0:{let t=e.readLen();s[r]=new sM(nm(i,l),t),l+=t;break}case 10:{let t=e1(e.restDecoder);s[r]=new s1(nm(i,l),t),l+=t;break}default:{let o=(192&n)==0,c=new sZ(nm(i,l),null,(128&n)==128?e.readLeftID():null,null,(64&n)==64?e.readRightID():null,o?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,o&&(32&n)==32?e.readString():null,sQ(e,n));s[r]=c,l+=c.length}}}}return r})(n,r)),l=s.pendingStructs;if(l){for(let[e,r]of l.missing)if(r<nv(s,e)){t=!0;break}if(i){for(let[e,t]of i.missing){let r=l.missing.get(e);(null==r||r>t)&&l.missing.set(e,t)}l.update=nF([l.update,i.update])}}else s.pendingStructs=i;let o=r7(n,e,s);if(s.pendingDs){let t=new nr(eZ(s.pendingDs));e1(t.restDecoder);let r=r7(t,e,s);o&&r?s.pendingDs=nF([o,r]):s.pendingDs=o||r}else s.pendingDs=o;if(t){let t=s.pendingStructs.update;s.pendingStructs=null,nc(e.doc,t)}},r,!1))(s,e,r,new n(s))},nh=e=>(e=>{let t=new Map,r=e1(e.restDecoder);for(let n=0;n<r;n++){let r=e1(e.restDecoder),n=e1(e.restDecoder);t.set(r,n)}return t})(new r9(eZ(e))),na=(e,t)=>(eM(e.restEncoder,t.size),en(t.entries()).sort((e,t)=>t[0]-e[0]).forEach(([t,r])=>{eM(e.restEncoder,t),eM(e.restEncoder,r)}),e);class nu{constructor(){this.l=[]}}let nd=()=>new nu,ng=(e,t)=>{let r=e.l,n=r.length;e.l=r.filter(e=>t!==e),n===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},nf=(e,t,r)=>ty(e.l,[t,r]);class np{constructor(e,t){this.client=e,this.clock=t}}let nw=(e,t)=>e===t||null!==e&&null!==t&&e.client===t.client&&e.clock===t.clock,nm=(e,t)=>new np(e,t);i=r3(),new class e{constructor(e,t){this.ds=e,this.sv=t}}(i,new Map);let ny=(e,t)=>void 0===t?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!r1(t.ds,e.id),nb=(e,t)=>{let r=Q(e.meta,nb,ee),n=e.doc.store;r.has(t)||(t.sv.forEach((t,r)=>{t<nv(n,r)&&nD(e,nm(r,t))}),r0(e,t.ds,e=>{}),r.add(t))};class n_{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}let nk=e=>{let t=new Map;return e.clients.forEach((e,r)=>{let n=e[e.length-1];t.set(r,n.id.clock+n.length)}),t},nv=(e,t)=>{let r=e.clients.get(t);if(void 0===r)return 0;let n=r[r.length-1];return n.id.clock+n.length},nC=(e,t)=>{let r=e.clients.get(t.id.client);if(void 0===r)r=[],e.clients.set(t.id.client,r);else{let e=r[r.length-1];if(e.id.clock+e.length!==t.id.clock)throw eX()}r.push(t)},nE=(e,t)=>{let r=0,n=e.length-1,s=e[n],i=s.id.clock;if(i===t)return n;let l=eh(t/(i+s.length-1)*n);for(;r<=n;){if((i=(s=e[l]).id.clock)<=t){if(t<i+s.length)return l;r=l+1}else n=l-1;l=eh((r+n)/2)}throw eX()},nS=(e,t)=>{let r=e.clients.get(t.client);return r[nE(r,t.clock)]},nx=(e,t,r)=>{let n=nE(t,r),s=t[n];return s.id.clock<r&&s instanceof sZ?(t.splice(n+1,0,sG(e,s,r-s.id.clock)),n+1):n},nD=(e,t)=>{let r=e.doc.store.clients.get(t.client);return r[nx(e,r,t.clock)]},nA=(e,t,r)=>{let n=t.clients.get(r.client),s=nE(n,r.clock),i=n[s];return r.clock!==i.id.clock+i.length-1&&i.constructor!==sM&&n.splice(s+1,0,sG(e,i,r.clock-i.id.clock+1)),i},nI=(e,t,r,n,s)=>{let i;if(0===n)return;let l=r+n,o=nx(e,t,r);do l<(i=t[o++]).id.clock+i.length&&nx(e,t,l),s(i);while(o<t.length&&t[o].id.clock<l)};class nL{constructor(e,t,r){this.doc=e,this.deleteSet=new rQ,this.beforeState=nk(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}let nM=(e,t)=>(0!==t.deleteSet.clients.size||!!((e,t)=>{for(let[r,n]of e)if(t(n,r))return!0;return!1})(t.afterState,(e,r)=>t.beforeState.get(r)!==e))&&(r2(t.deleteSet),no(e,t.doc.store,t.beforeState),r4(e,t.deleteSet),!0),nT=(e,t,r)=>{let n=t._item;(null===n||n.id.clock<(e.beforeState.get(n.id.client)||0)&&!n.deleted)&&Q(e.changed,t,ee).add(r)},nO=(e,t)=>{let r=e[t],n=e[t-1],s=t;for(;s>0;r=n,n=e[--s-1]){if(n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)){r instanceof sZ&&null!==r.parentSub&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n);continue}break}let i=t-s;return i&&e.splice(t+1-i,i),i},nU=(e,t)=>{if(t<e.length){let r=e[t],n=r.doc,s=n.store,i=r.deleteSet,l=r._mergeStructs;try{r2(i),r.afterState=nk(r.doc.store),n.emit("beforeObserverCalls",[r,n]);let e=[];r.changed.forEach((t,n)=>e.push(()=>{null!==n._item&&n._item.deleted||n._callObserver(r,t)})),e.push(()=>{r.changedParentTypes.forEach((t,n)=>{n._dEH.l.length>0&&(null===n._item||!n._item.deleted)&&((t=t.filter(e=>null===e.target._item||!e.target._item.deleted)).forEach(e=>{e.currentTarget=n,e._path=null}),t.sort((e,t)=>e.path.length-t.path.length),e.push(()=>{nf(n._dEH,t,r)}))}),e.push(()=>n.emit("afterTransaction",[r,n])),e.push(()=>{r._needFormattingCleanup&&s_(r)})}),ty(e,[])}finally{n.gc&&((e,t,r)=>{for(let[n,s]of e.clients.entries()){let e=t.clients.get(n);for(let n=s.length-1;n>=0;n--){let i=s[n],l=i.clock+i.len;for(let n=nE(e,i.clock),s=e[n];n<e.length&&s.id.clock<l;s=e[++n]){let s=e[n];if(i.clock+i.len<=s.id.clock)break;s instanceof sZ&&s.deleted&&!s.keep&&r(s)&&s.gc(t,!1)}}}})(i,s,n.gcFilter),i.clients.forEach((e,t)=>{let r=s.clients.get(t);for(let t=e.length-1;t>=0;t--){let n=e[t],s=eu(r.length-1,1+nE(r,n.clock+n.len-1));for(let e=s,t=r[e];e>0&&t.id.clock>=n.clock;t=r[e])e-=1+nO(r,e)}}),r.afterState.forEach((e,t)=>{let n=r.beforeState.get(t)||0;if(n!==e){let e=s.clients.get(t),r=ed(nE(e,n),1);for(let t=e.length-1;t>=r;)t-=1+nO(e,t)}});for(let e=l.length-1;e>=0;e--){let{client:t,clock:r}=l[e].id,n=s.clients.get(t),i=nE(n,r);!(i+1<n.length&&nO(n,i+1)>1)&&i>0&&nO(n,i)}if(r.local||r.afterState.get(n.clientID)===r.beforeState.get(n.clientID)||(((...e)=>{console.log(...rX(e)),rY.forEach(t=>t.print(e))})(rV,rP,"[yjs] ",rF,rW,"Changed the client-id because another client seems to be using it."),n.clientID=tr()),n.emit("afterTransactionCleanup",[r,n]),n._observers.has("update")){let e=new ns;nM(e,r)&&n.emit("update",[e.toUint8Array(),r.origin,n,r])}if(n._observers.has("updateV2")){let e=new nl;nM(e,r)&&n.emit("updateV2",[e.toUint8Array(),r.origin,n,r])}let{subdocsAdded:o,subdocsLoaded:c,subdocsRemoved:h}=r;(o.size>0||h.size>0||c.size>0)&&(o.forEach(e=>{e.clientID=n.clientID,null==e.collectionid&&(e.collectionid=n.collectionid),n.subdocs.add(e)}),h.forEach(e=>n.subdocs.delete(e)),n.emit("subdocs",[{loaded:c,added:o,removed:h},n,r]),h.forEach(e=>e.destroy())),e.length<=t+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,e])):nU(e,t+1)}}},nR=(e,t,r=null,n=!0)=>{let s=e._transactionCleanups,i=!1,l=null;null===e._transaction&&(i=!0,e._transaction=new nL(e,r,n),s.push(e._transaction),1===s.length&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{l=t(e._transaction)}finally{if(i){let t=e._transaction===s[0];e._transaction=null,t&&nU(s,0)}}return l};class nN{constructor(e,t){this.gen=function*(e){let t=e1(e.restDecoder);for(let r=0;r<t;r++){let t=e1(e.restDecoder),r=e.readClient(),n=e1(e.restDecoder);for(let s=0;s<t;s++){let t=e.readInfo();if(10===t){let t=e1(e.restDecoder);yield new s1(nm(r,n),t),n+=t}else if((31&t)!=0){let s=(192&t)==0,i=new sZ(nm(r,n),null,(128&t)==128?e.readLeftID():null,null,(64&t)==64?e.readRightID():null,s?e.readParentInfo()?e.readString():e.readLeftID():null,s&&(32&t)==32?e.readString():null,sQ(e,t));yield i,n+=i.length}else{let t=e.readLen();yield new sM(nm(r,n),t),n+=t}}}}(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&null!==this.curr&&this.curr.constructor===s1)return this.curr}}class nj{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}let nP=(e,t)=>{if(e.constructor===sM){let{client:r,clock:n}=e.id;return new sM(nm(r,n+t),e.length-t)}if(e.constructor===s1){let{client:r,clock:n}=e.id;return new s1(nm(r,n+t),e.length-t)}{let{client:r,clock:n}=e.id;return new sZ(nm(r,n+t),null,nm(r,n+t-1),null,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t))}},nF=(e,t=nr,r=nl)=>{if(1===e.length)return e[0];let n=e.map(e=>new t(eZ(e))),s=n.map(e=>new nN(e,!0)),i=null,l=new r,o=new nj(l);for(;(s=s.filter(e=>null!==e.curr)).sort((e,t)=>{if(e.curr.id.client!==t.curr.id.client)return t.curr.id.client-e.curr.id.client;{let r=e.curr.id.clock-t.curr.id.clock;return 0===r?e.curr.constructor===t.curr.constructor?0:e.curr.constructor===s1?1:-1:r}}),0!==s.length;){let e=s[0],t=e.curr.id.client;if(null!==i){let r=e.curr,n=!1;for(;null!==r&&r.id.clock+r.length<=i.struct.id.clock+i.struct.length&&r.id.client>=i.struct.id.client;)r=e.next(),n=!0;if(null===r||r.id.client!==t||n&&r.id.clock>i.struct.id.clock+i.struct.length)continue;if(t!==i.struct.id.client)n$(o,i.struct,i.offset),i={struct:r,offset:0},e.next();else if(i.struct.id.clock+i.struct.length<r.id.clock)if(i.struct.constructor===s1)i.struct.length=r.id.clock+r.length-i.struct.id.clock;else{n$(o,i.struct,i.offset);let e=r.id.clock-i.struct.id.clock-i.struct.length;i={struct:new s1(nm(t,i.struct.id.clock+i.struct.length),e),offset:0}}else{let t=i.struct.id.clock+i.struct.length-r.id.clock;t>0&&(i.struct.constructor===s1?i.struct.length-=t:r=nP(r,t)),i.struct.mergeWith(r)||(n$(o,i.struct,i.offset),i={struct:r,offset:0},e.next())}}else i={struct:e.curr,offset:0},e.next();for(let r=e.curr;null!==r&&r.id.client===t&&r.id.clock===i.struct.id.clock+i.struct.length&&r.constructor!==s1;r=e.next())n$(o,i.struct,i.offset),i={struct:r,offset:0}}return null!==i&&(n$(o,i.struct,i.offset),i=null),nH(o),r4(l,(e=>{let t=new rQ;for(let r=0;r<e.length;r++)e[r].clients.forEach((n,s)=>{if(!t.clients.has(s)){let i=n.slice();for(let t=r+1;t<e.length;t++)er(i,e[t].clients.get(s)||[]);t.clients.set(s,i)}});return r2(t),t})(n.map(e=>r6(e)))),l.toUint8Array()},nB=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:eI(e.encoder.restEncoder)}),e.encoder.restEncoder=eD(),e.written=0)},n$=(e,t,r)=>{e.written>0&&e.currClient!==t.id.client&&nB(e),0===e.written&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),eM(e.encoder.restEncoder,t.id.clock+r)),t.write(e.encoder,r),e.written++},nH=e=>{nB(e);let t=e.encoder.restEncoder;eM(t,e.clientStructs.length);for(let r=0;r<e.clientStructs.length;r++){let n=e.clientStructs[r];eM(t,n.written),eN(t,n.restEncoder)}},nW="You must not compute changes after the event-handler fired.";class nz{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=nV(this.currentTarget,this.target))}deletes(e){return r1(this.transaction.deleteSet,e.id)}get keys(){if(null===this._keys){if(0===this.transaction.doc._transactionCleanups.length)throw Error(nW);let e=new Map,t=this.target;this.transaction.changed.get(t).forEach(r=>{if(null!==r){let n,s,i=t._map.get(r);if(this.adds(i)){let e=i.left;for(;null!==e&&this.adds(e);)e=e.left;if(this.deletes(i))if(!(null!==e&&this.deletes(e)))return;else n="delete",s=et(e.content.getContent());else null!==e&&this.deletes(e)?(n="update",s=et(e.content.getContent())):(n="add",s=void 0)}else{if(!this.deletes(i))return;n="delete",s=et(i.content.getContent())}e.set(r,{action:n,oldValue:s})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(null===e){if(0===this.transaction.doc._transactionCleanups.length)throw Error(nW);let t=this.target,r=ee(),n=ee(),s=[];if(e={added:r,deleted:n,delta:s,keys:this.keys},this.transaction.changed.get(t).has(null)){let e=null,i=()=>{e&&s.push(e)};for(let s=t._start;null!==s;s=s.right)s.deleted?this.deletes(s)&&!this.adds(s)&&((null===e||void 0===e.delete)&&(i(),e={delete:0}),e.delete+=s.length,n.add(s)):this.adds(s)?((null===e||void 0===e.insert)&&(i(),e={insert:[]}),e.insert=e.insert.concat(s.content.getContent()),r.add(s)):((null===e||void 0===e.retain)&&(i(),e={retain:0}),e.retain+=s.length);null!==e&&void 0===e.retain&&i()}this._changes=e}return e}}let nV=(e,t)=>{let r=[];for(;null!==t._item&&t!==e;){if(null!==t._item.parentSub)r.unshift(t._item.parentSub);else{let e=0,n=t._item.parent._start;for(;n!==t._item&&null!==n;)!n.deleted&&n.countable&&(e+=n.length),n=n.right;r.unshift(e)}t=t._item.parent}return r},nJ=()=>{((...e)=>{console.warn(...rX(e)),e.unshift(rV),rY.forEach(t=>t.print(e))})("Invalid access: Add Yjs type to a document before reading data.")},nK=0;class nX{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=nK++}}let nY=(e,t,r)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=r,e.timestamp=nK++},nq=(e,t)=>{if(null===e._start||0===t||null===e._searchMarker)return null;let r=0===e._searchMarker.length?null:e._searchMarker.reduce((e,r)=>ea(t-e.index)<ea(t-r.index)?e:r),n=e._start,s=0;for(null!==r&&(n=r.p,s=r.index,r.timestamp=nK++);null!==n.right&&s<t;){if(!n.deleted&&n.countable){if(t<s+n.length)break;s+=n.length}n=n.right}for(;null!==n.left&&s>t;)!(n=n.left).deleted&&n.countable&&(s-=n.length);for(;null!==n.left&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)!(n=n.left).deleted&&n.countable&&(s-=n.length);if(null!==r&&ea(r.index-s)<n.parent.length/80)return nY(r,n,s),r;var i=e._searchMarker,l=n,o=s;if(i.length>=80){let e=i.reduce((e,t)=>e.timestamp<t.timestamp?e:t);return nY(e,l,o),e}{let e=new nX(l,o);return i.push(e),e}},nG=(e,t,r)=>{for(let n=e.length-1;n>=0;n--){let s=e[n];if(r>0){let t=s.p;for(t.marker=!1;t&&(t.deleted||!t.countable);)(t=t.left)&&!t.deleted&&t.countable&&(s.index-=t.length);if(null===t||!0===t.marker){e.splice(n,1);continue}s.p=t,t.marker=!0}(t<s.index||r>0&&t===s.index)&&(s.index=ed(t,s.index+r))}},nZ=(e,t,r)=>{let n=e,s=t.changedParentTypes;for(;Q(s,e,()=>[]).push(r),null!==e._item;)e=e._item.parent;nf(n._eH,r,t)};class nQ{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=nd(),this._dEH=nd(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw eK()}clone(){throw eK()}_write(e){}get _first(){let e=this._start;for(;null!==e&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){let t;t=this._eH,t.l.push(e)}observeDeep(e){let t;t=this._dEH,t.l.push(e)}unobserve(e){ng(this._eH,e)}unobserveDeep(e){ng(this._dEH,e)}toJSON(){}}let n0=(e,t,r)=>{e.doc??nJ(),t<0&&(t=e._length+t),r<0&&(r=e._length+r);let n=r-t,s=[],i=e._start;for(;null!==i&&n>0;){if(i.countable&&!i.deleted){let e=i.content.getContent();if(e.length<=t)t-=e.length;else{for(let r=t;r<e.length&&n>0;r++)s.push(e[r]),n--;t=0}}i=i.right}return s},n1=e=>{e.doc??nJ();let t=[],r=e._start;for(;null!==r;){if(r.countable&&!r.deleted){let e=r.content.getContent();for(let r=0;r<e.length;r++)t.push(e[r])}r=r.right}return t},n2=(e,t)=>{let r=0,n=e._start;for(e.doc??nJ();null!==n;){if(n.countable&&!n.deleted){let s=n.content.getContent();for(let n=0;n<s.length;n++)t(s[n],r++,e)}n=n.right}},n8=(e,t)=>{let r=[];return n2(e,(n,s)=>{r.push(t(n,s,e))}),r},n3=(e,t)=>{e.doc??nJ();let r=nq(e,t),n=e._start;for(null!==r&&(n=r.p,t-=r.index);null!==n;n=n.right)if(!n.deleted&&n.countable){if(t<n.length)return n.content.getContent()[t];t-=n.length}},n4=(e,t,r,n)=>{let s=r,i=e.doc,l=i.clientID,o=i.store,c=null===r?t._start:r.right,h=[],a=()=>{h.length>0&&((s=new sZ(nm(l,nv(o,l)),s,s&&s.lastId,c,c&&c.id,t,null,new sB(h))).integrate(e,0),h=[])};n.forEach(r=>{if(null===r)h.push(r);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:h.push(r);break;default:switch(a(),r.constructor){case Uint8Array:case ArrayBuffer:(s=new sZ(nm(l,nv(o,l)),s,s&&s.lastId,c,c&&c.id,t,null,new sT(new Uint8Array(r)))).integrate(e,0);break;case r5:(s=new sZ(nm(l,nv(o,l)),s,s&&s.lastId,c,c&&c.id,t,null,new sR(r))).integrate(e,0);break;default:if(r instanceof nQ)(s=new sZ(nm(l,nv(o,l)),s,s&&s.lastId,c,c&&c.id,t,null,new sq(r))).integrate(e,0);else throw Error("Unexpected content type in insert operation")}}}),a()},n6=(e,t,r,n)=>{if(r>t._length)throw Error("Length exceeded!");if(0===r)return t._searchMarker&&nG(t._searchMarker,r,n.length),n4(e,t,null,n);let s=r,i=nq(t,r),l=t._start;for(null!==i&&(l=i.p,0==(r-=i.index)&&(r+=(l=l.prev)&&l.countable&&!l.deleted?l.length:0));null!==l;l=l.right)if(!l.deleted&&l.countable){if(r<=l.length){r<l.length&&nD(e,nm(l.id.client,l.id.clock+r));break}r-=l.length}return t._searchMarker&&nG(t._searchMarker,s,n.length),n4(e,t,l,n)},n7=(e,t,r,n)=>{if(0===n)return;let s=r,i=n,l=nq(t,r),o=t._start;for(null!==l&&(o=l.p,r-=l.index);null!==o&&r>0;o=o.right)!o.deleted&&o.countable&&(r<o.length&&nD(e,nm(o.id.client,o.id.clock+r)),r-=o.length);for(;n>0&&null!==o;)o.deleted||(n<o.length&&nD(e,nm(o.id.client,o.id.clock+n)),o.delete(e),n-=o.length),o=o.right;if(n>0)throw Error("Length exceeded!");t._searchMarker&&nG(t._searchMarker,s,-i+n)},n5=(e,t,r)=>{let n=t._map.get(r);void 0!==n&&n.delete(e)},n9=(e,t,r,n)=>{let s,i=t._map.get(r)||null,l=e.doc,o=l.clientID;if(null==n)s=new sB([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:s=new sB([n]);break;case Uint8Array:s=new sT(n);break;case r5:s=new sR(n);break;default:if(n instanceof nQ)s=new sq(n);else throw Error("Unexpected content type")}new sZ(nm(o,nv(l.store,o)),i,i&&i.lastId,null,null,t,r,s).integrate(e,0)},se=(e,t)=>{e.doc??nJ();let r=e._map.get(t);return void 0===r||r.deleted?void 0:r.content.getContent()[r.length-1]},st=e=>{let t={};return e.doc??nJ(),e._map.forEach((e,r)=>{e.deleted||(t[r]=e.content.getContent()[e.length-1])}),t},sr=(e,t)=>{e.doc??nJ();let r=e._map.get(t);return void 0!==r&&!r.deleted},sn=e=>{let t,r;return e.doc??nJ(),t=e._map.entries(),r=e=>!e[1].deleted,rq(()=>{let e;do e=t.next();while(!e.done&&!r(e.value))return e})};class ss extends nz{}class si extends nQ{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){let t=new si;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new si}clone(){let e=new si;return e.insert(0,this.toArray().map(e=>e instanceof nQ?e.clone():e)),e}get length(){return this.doc??nJ(),this._length}_callObserver(e,t){super._callObserver(e,t),nZ(this,e,new ss(this,e))}insert(e,t){null!==this.doc?nR(this.doc,r=>{n6(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){null!==this.doc?nR(this.doc,t=>{((e,t,r)=>{let n=(t._searchMarker||[]).reduce((e,t)=>t.index>e.index?t:e,{index:0,p:t._start}).p;if(n)for(;n.right;)n=n.right;return n4(e,t,n,r)})(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){null!==this.doc?nR(this.doc,r=>{n7(r,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return n3(this,e)}toArray(){return n1(this)}slice(e=0,t=this.length){return n0(this,e,t)}toJSON(){return this.map(e=>e instanceof nQ?e.toJSON():e)}map(e){return n8(this,e)}forEach(e){n2(this,e)}[Symbol.iterator](){let e,t,r;return e=this._start,t=null,r=0,{[Symbol.iterator](){return this},next:()=>{if(null===t){for(;null!==e&&e.deleted;)e=e.right;if(null===e)return{done:!0,value:void 0};t=e.content.getContent(),r=0,e=e.right}let n=t[r++];return t.length<=r&&(t=null),{done:!1,value:n}}}}_write(e){e.writeTypeRef(sW)}}class sl extends nz{constructor(e,t,r){super(e,t),this.keysChanged=r}}class so extends nQ{constructor(e){super(),this._prelimContent=null,void 0===e?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((e,t)=>{this.set(t,e)}),this._prelimContent=null}_copy(){return new so}clone(){let e=new so;return this.forEach((t,r)=>{e.set(r,t instanceof nQ?t.clone():t)}),e}_callObserver(e,t){nZ(this,e,new sl(this,e,t))}toJSON(){this.doc??nJ();let e={};return this._map.forEach((t,r)=>{if(!t.deleted){let n=t.content.getContent()[t.length-1];e[r]=n instanceof nQ?n.toJSON():n}}),e}get size(){return[...sn(this)].length}keys(){return rG(sn(this),e=>e[0])}values(){return rG(sn(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return rG(sn(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??nJ(),this._map.forEach((t,r)=>{t.deleted||e(t.content.getContent()[t.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){null!==this.doc?nR(this.doc,t=>{n5(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return null!==this.doc?nR(this.doc,r=>{n9(r,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return se(this,e)}has(e){return sr(this,e)}clear(){null!==this.doc?nR(this.doc,e=>{this.forEach(function(t,r,n){n5(e,n,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(sz)}}let sc=(e,t)=>{let r,n;return e===t||"object"==typeof e&&"object"==typeof t&&e&&t&&((r=e)===(n=t)||tg(r).length===tg(n).length&&tf(r,(e,t)=>(void 0!==e||tp(n,t))&&tu(n[t],e)))};class sh{constructor(e,t,r,n){this.left=e,this.right=t,this.index=r,this.currentAttributes=n}forward(){null===this.right&&eX(),this.right.content.constructor===sj?this.right.deleted||sg(this.currentAttributes,this.right.content):this.right.deleted||(this.index+=this.right.length),this.left=this.right,this.right=this.right.right}}let sa=(e,t,r)=>{for(;null!==t.right&&r>0;)t.right.content.constructor===sj?t.right.deleted||sg(t.currentAttributes,t.right.content):t.right.deleted||(r<t.right.length&&nD(e,nm(t.right.id.client,t.right.id.clock+r)),t.index+=t.right.length,r-=t.right.length),t.left=t.right,t.right=t.right.right;return t},su=(e,t,r,n)=>{let s=new Map,i=n?nq(t,r):null;return i?sa(e,new sh(i.p.left,i.p,i.index,s),r-i.index):sa(e,new sh(null,t._start,0,s),r)},sd=(e,t,r,n)=>{for(;null!==r.right&&(!0===r.right.deleted||r.right.content.constructor===sj&&sc(n.get(r.right.content.key),r.right.content.value));)r.right.deleted||n.delete(r.right.content.key),r.forward();let s=e.doc,i=s.clientID;n.forEach((n,l)=>{let o=r.left,c=r.right,h=new sZ(nm(i,nv(s.store,i)),o,o&&o.lastId,c,c&&c.id,t,null,new sj(l,n));h.integrate(e,0),r.right=h,r.forward()})},sg=(e,t)=>{let{key:r,value:n}=t;null===n?e.delete(r):e.set(r,n)},sf=(e,t)=>{for(;null!==e.right&&(e.right.deleted||e.right.content.constructor===sj&&sc(t[e.right.content.key]??null,e.right.content.value));){;e.forward()}},sp=(e,t,r,n)=>{let s=e.doc,i=s.clientID,l=new Map;for(let o in n){let c=n[o],h=r.currentAttributes.get(o)??null;if(!sc(h,c)){l.set(o,h);let{left:n,right:a}=r;r.right=new sZ(nm(i,nv(s.store,i)),n,n&&n.lastId,a,a&&a.id,t,null,new sj(o,c)),r.right.integrate(e,0),r.forward()}}return l},sw=(e,t,r,n,s)=>{r.currentAttributes.forEach((e,t)=>{void 0===s[t]&&(s[t]=null)});let i=e.doc,l=i.clientID;sf(r,s);let o=sp(e,t,r,s),c=n.constructor===String?new s$(n):n instanceof nQ?new sq(n):new sN(n),{left:h,right:a,index:u}=r;t._searchMarker&&nG(t._searchMarker,r.index,c.getLength()),(a=new sZ(nm(l,nv(i.store,l)),h,h&&h.lastId,a,a&&a.id,t,null,c)).integrate(e,0),r.right=a,r.index=u,r.forward(),sd(e,t,r,o)},sm=(e,t,r,n,s)=>{let i=e.doc,l=i.clientID;sf(r,s);let o=sp(e,t,r,s);for(;null!==r.right&&(n>0||o.size>0&&(r.right.deleted||r.right.content.constructor===sj));){if(!r.right.deleted)if(r.right.content.constructor===sj){let{key:t,value:i}=r.right.content,l=s[t];if(void 0!==l){if(sc(l,i))o.delete(t);else{if(0===n)break;o.set(t,i)}r.right.delete(e)}else r.currentAttributes.set(t,i)}else n<r.right.length&&nD(e,nm(r.right.id.client,r.right.id.clock+n)),n-=r.right.length;r.forward()}if(n>0){let s="";for(;n>0;n--)s+="\n";r.right=new sZ(nm(l,nv(i.store,l)),r.left,r.left&&r.left.lastId,r.right,r.right&&r.right.id,t,null,new s$(s)),r.right.integrate(e,0),r.forward()}sd(e,t,r,o)},sy=(e,t,r,n,s)=>{let i=t,l=G();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===sj){let e=i.content;l.set(e.key,e)}i=i.right}let o=0,c=!1;for(;t!==i;){if(r===t&&(c=!0),!t.deleted){let r=t.content;if(r.constructor===sj){let{key:i,value:h}=r,a=n.get(i)??null;(l.get(i)!==r||a===h)&&(t.delete(e),o++,c||(s.get(i)??null)!==h||a===h||(null===a?s.delete(i):s.set(i,a))),c||t.deleted||sg(s,r)}}t=t.right}return o},sb=e=>{let t=0;return nR(e.doc,r=>{let n=e._start,s=e._start,i=G(),l=Z(i);for(;s;)!1===s.deleted&&(s.content.constructor===sj?sg(l,s.content):(t+=sy(r,n,s,i,l),i=Z(l),n=s)),s=s.right}),t},s_=e=>{let t=new Set,r=e.doc;for(let[n,s]of e.afterState.entries()){let i=e.beforeState.get(n)||0;s!==i&&nI(e,r.store.clients.get(n),i,s,e=>{e.deleted||e.content.constructor!==sj||e.constructor===sM||t.add(e.parent)})}nR(r,r=>{for(let n of(r0(e,e.deleteSet,e=>{if(e instanceof sM||!e.parent._hasFormatting||t.has(e.parent))return;let n=e.parent;if(e.content.constructor===sj)t.add(n);else{for(var s=e;s&&s.right&&(s.right.deleted||!s.right.countable);)s=s.right;let t=new Set;for(;s&&(s.deleted||!s.countable);){if(!s.deleted&&s.content.constructor===sj){let e=s.content.key;t.has(e)?s.delete(r):t.add(e)}s=s.left}}}),t))sb(n)})},sk=(e,t,r)=>{let n=r,s=Z(t.currentAttributes),i=t.right;for(;r>0&&null!==t.right;){if(!1===t.right.deleted)switch(t.right.content.constructor){case sq:case sN:case s$:r<t.right.length&&nD(e,nm(t.right.id.client,t.right.id.clock+r)),r-=t.right.length,t.right.delete(e)}t.forward()}i&&sy(e,i,t.right,s,t.currentAttributes);let l=(t.left||t.right).parent;return l._searchMarker&&nG(l._searchMarker,t.index,-n+r),t};class sv extends nz{constructor(e,t,r){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(e=>{null===e?this.childListChanged=!0:this.keysChanged.add(e)})}get changes(){if(null===this._changes){let e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(null===this._delta){let e=this.target.doc,t=[];nR(e,e=>{let r=new Map,n=new Map,s=this.target._start,i=null,l={},o="",c=0,h=0,a=()=>{if(null!==i){let e=null;switch(i){case"delete":h>0&&(e={delete:h}),h=0;break;case"insert":("object"==typeof o||o.length>0)&&(e={insert:o},r.size>0&&(e.attributes={},r.forEach((t,r)=>{null!==t&&(e.attributes[r]=t)}))),o="";break;case"retain":c>0&&(e={retain:c},(e=>{for(let t in e)return!1;return!0})(l)||(e.attributes=td({},l))),c=0}e&&t.push(e),i=null}};for(;null!==s;){switch(s.content.constructor){case sq:case sN:this.adds(s)?this.deletes(s)||(a(),i="insert",o=s.content.getContent()[0],a()):this.deletes(s)?("delete"!==i&&(a(),i="delete"),h+=1):s.deleted||("retain"!==i&&(a(),i="retain"),c+=1);break;case s$:this.adds(s)?this.deletes(s)||("insert"!==i&&(a(),i="insert"),o+=s.content.str):this.deletes(s)?("delete"!==i&&(a(),i="delete"),h+=s.length):s.deleted||("retain"!==i&&(a(),i="retain"),c+=s.length);break;case sj:{let{key:t,value:o}=s.content;if(this.adds(s))this.deletes(s)||(sc(r.get(t)??null,o)?null!==o&&s.delete(e):("retain"===i&&a(),sc(o,n.get(t)??null)?delete l[t]:l[t]=o));else if(this.deletes(s)){n.set(t,o);let e=r.get(t)??null;sc(e,o)||("retain"===i&&a(),l[t]=e)}else if(!s.deleted){n.set(t,o);let r=l[t];void 0!==r&&(sc(r,o)?null!==r&&s.delete(e):("retain"===i&&a(),null===o?delete l[t]:l[t]=o))}s.deleted||("insert"===i&&a(),sg(r,s.content))}}s=s.right}for(a();t.length>0;){let e=t[t.length-1];if(void 0!==e.retain&&void 0===e.attributes)t.pop();else break}}),this._delta=t}return this._delta}}class sC extends nQ{constructor(e){super(),this._pending=void 0!==e?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??nJ(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(e=>e())}catch(e){console.error(e)}this._pending=null}_copy(){return new sC}clone(){let e=new sC;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);let r=new sv(this,e,t);nZ(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??nJ();let e="",t=this._start;for(;null!==t;)!t.deleted&&t.countable&&t.content.constructor===s$&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){null!==this.doc?nR(this.doc,r=>{let n=new sh(null,this._start,0,new Map);for(let s=0;s<e.length;s++){let i=e[s];if(void 0!==i.insert){let l=t||"string"!=typeof i.insert||s!==e.length-1||null!==n.right||"\n"!==i.insert.slice(-1)?i.insert:i.insert.slice(0,-1);("string"!=typeof l||l.length>0)&&sw(r,this,n,l,i.attributes||{})}else void 0!==i.retain?sm(r,this,n,i.retain,i.attributes||{}):void 0!==i.delete&&sk(r,n,i.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,r){this.doc??nJ();let n=[],s=new Map,i=this.doc,l="",o=this._start;function c(){if(l.length>0){let e={},t=!1;s.forEach((r,n)=>{t=!0,e[n]=r});let r={insert:l};t&&(r.attributes=e),n.push(r),l=""}}let h=()=>{for(;null!==o;){if(ny(o,e)||void 0!==t&&ny(o,t))switch(o.content.constructor){case s$:{let n=s.get("ychange");void 0===e||ny(o,e)?void 0===t||ny(o,t)?void 0!==n&&(c(),s.delete("ychange")):(void 0===n||n.user!==o.id.client||"added"!==n.type)&&(c(),s.set("ychange",r?r("added",o.id):{type:"added"})):(void 0===n||n.user!==o.id.client||"removed"!==n.type)&&(c(),s.set("ychange",r?r("removed",o.id):{type:"removed"})),l+=o.content.str;break}case sq:case sN:{c();let e={insert:o.content.getContent()[0]};if(s.size>0){let t={};e.attributes=t,s.forEach((e,r)=>{t[r]=e})}n.push(e);break}case sj:ny(o,e)&&(c(),sg(s,o.content))}o=o.right}c()};return e||t?nR(i,r=>{e&&nb(r,e),t&&nb(r,t),h()},"cleanup"):h(),n}insert(e,t,r){if(t.length<=0)return;let n=this.doc;null!==n?nR(n,n=>{let s=su(n,this,e,!r);r||(r={},s.currentAttributes.forEach((e,t)=>{r[t]=e})),sw(n,this,s,t,r)}):this._pending.push(()=>this.insert(e,t,r))}insertEmbed(e,t,r){let n=this.doc;null!==n?nR(n,n=>{let s=su(n,this,e,!r);sw(n,this,s,t,r||{})}):this._pending.push(()=>this.insertEmbed(e,t,r||{}))}delete(e,t){if(0===t)return;let r=this.doc;null!==r?nR(r,r=>{sk(r,su(r,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,r){if(0===t)return;let n=this.doc;null!==n?nR(n,n=>{let s=su(n,this,e,!1);null!==s.right&&sm(n,this,s,t,r)}):this._pending.push(()=>this.format(e,t,r))}removeAttribute(e){null!==this.doc?nR(this.doc,t=>{n5(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){null!==this.doc?nR(this.doc,r=>{n9(r,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return se(this,e)}getAttributes(){return st(this)}_write(e){e.writeTypeRef(sV)}}class sE{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??nJ()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(null!==e&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,e.deleted||t.constructor!==sx&&t.constructor!==sS||null===t._start)for(;null!==e;){let t=e.next;if(null!==t){e=t;break}e=e.parent===this._root?null:e.parent._item}else e=t._start;while(null!==e&&(e.deleted||!this._filter(e.content.type)))return(this._firstCall=!1,null===e)?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class sS extends nQ{constructor(){super(),this._prelimContent=[]}get firstChild(){let e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new sS}clone(){let e=new sS;return e.insert(0,this.toArray().map(e=>e instanceof nQ?e.clone():e)),e}get length(){return this.doc??nJ(),null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(e){return new sE(this,e)}querySelector(e){e=e.toUpperCase();let t=new sE(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e).next();return t.done?null:t.value}querySelectorAll(e){return e=e.toUpperCase(),en(new sE(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){nZ(this,e,new sD(this,t,e))}toString(){return n8(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},r){let n=e.createDocumentFragment();return void 0!==r&&r._createAssociation(n,this),n2(this,s=>{n.insertBefore(s.toDOM(e,t,r),null)}),n}insert(e,t){null!==this.doc?nR(this.doc,r=>{n6(r,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(null!==this.doc)nR(this.doc,r=>{n4(r,this,e&&e instanceof nQ?e._item:e,t)});else{let r=this._prelimContent,n=null===e?0:r.findIndex(t=>t===e)+1;if(0===n&&null!==e)throw Error("Reference item not found");r.splice(n,0,...t)}}delete(e,t=1){null!==this.doc?nR(this.doc,r=>{n7(r,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return n1(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return n3(this,e)}slice(e=0,t=this.length){return n0(this,e,t)}forEach(e){n2(this,e)}_write(e){e.writeTypeRef(sK)}}class sx extends sS{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((e,t)=>{this.setAttribute(t,e)}),this._prelimAttrs=null}_copy(){return new sx(this.nodeName)}clone(){let e=new sx(this.nodeName);var t=this.getAttributes(),r=(t,r)=>{e.setAttribute(r,t)};for(let e in t)r(t[e],e);return e.insert(0,this.toArray().map(e=>e instanceof nQ?e.clone():e)),e}toString(){let e=this.getAttributes(),t=[],r=[];for(let t in e)r.push(t);r.sort();let n=r.length;for(let s=0;s<n;s++){let n=r[s];t.push(n+'="'+e[n]+'"')}let s=this.nodeName.toLocaleLowerCase(),i=t.length>0?" "+t.join(" "):"";return`<${s}${i}>${super.toString()}</${s}>`}removeAttribute(e){null!==this.doc?nR(this.doc,t=>{n5(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){null!==this.doc?nR(this.doc,r=>{n9(r,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return se(this,e)}hasAttribute(e){return sr(this,e)}getAttributes(e){let t;return e?(t={},this._map.forEach((r,n)=>{let s=r;for(;null!==s&&(!e.sv.has(s.id.client)||s.id.clock>=(e.sv.get(s.id.client)||0));)s=s.left;null!==s&&ny(s,e)&&(t[n]=s.content.getContent()[s.length-1])}),t):st(this)}toDOM(e=document,t={},r){let n=e.createElement(this.nodeName),s=this.getAttributes();for(let e in s){let t=s[e];"string"==typeof t&&n.setAttribute(e,t)}return n2(this,s=>{n.appendChild(s.toDOM(e,t,r))}),void 0!==r&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(sJ),e.writeKey(this.nodeName)}}class sD extends nz{constructor(e,t,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(e=>{null===e?this.childListChanged=!0:this.attributesChanged.add(e)})}}class sA extends so{constructor(e){super(),this.hookName=e}_copy(){return new sA(this.hookName)}clone(){let e=new sA(this.hookName);return this.forEach((t,r)=>{e.set(r,t)}),e}toDOM(e=document,t={},r){let n,s=t[this.hookName];return(n=void 0!==s?s.createDom(this):document.createElement(this.hookName)).setAttribute("data-yjs-hook",this.hookName),void 0!==r&&r._createAssociation(n,this),n}_write(e){e.writeTypeRef(sX),e.writeKey(this.hookName)}}class sI extends sC{get nextSibling(){let e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){let e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new sI}clone(){let e=new sI;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,r){let n=e.createTextNode(this.toString());return void 0!==r&&r._createAssociation(n,this),n}toString(){return this.toDelta().map(e=>{let t=[];for(let r in e.attributes){let n=[];for(let t in e.attributes[r])n.push({key:t,value:e.attributes[r][t]});n.sort((e,t)=>e.key<t.key?-1:1),t.push({nodeName:r,attrs:n})}t.sort((e,t)=>e.nodeName<t.nodeName?-1:1);let r="";for(let e=0;e<t.length;e++){let n=t[e];r+=`<${n.nodeName}`;for(let e=0;e<n.attrs.length;e++){let t=n.attrs[e];r+=` ${t.key}="${t.value}"`}r+=">"}r+=e.insert;for(let e=t.length-1;e>=0;e--)r+=`</${t[e].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(sY)}}class sL{constructor(e,t){this.id=e,this.length=t}get deleted(){throw eK()}mergeWith(e){return!1}write(e,t,r){throw eK()}integrate(e,t){throw eK()}}class sM extends sL{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor===e.constructor&&(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),nC(e.doc.store,this)}write(e,t){e.writeInfo(0),e.writeLen(this.length-t)}getMissing(e,t){return null}}class sT{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new sT(this.content)}splice(e){throw eK()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}class sO{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new sO(this.len)}splice(e){let t=new sO(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){r8(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}let sU=(e,t)=>new r5({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class sR{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),null!==e.meta&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new sR(sU(this.doc.guid,this.opts))}splice(e){throw eK()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}class sN{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new sN(this.embed)}splice(e){throw eK()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}class sj{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new sj(this.key,this.value)}splice(e){throw eK()}mergeWith(e){return!1}integrate(e,t){let r=t.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}class sP{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new sP(this.arr)}splice(e){let t=new sP(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let t=this.arr[n];e.writeString(void 0===t?"undefined":JSON.stringify(t))}}getRef(){return 2}}let sF="development"===tS("node_env");class sB{constructor(e){this.arr=e,sF&&tm(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new sB(this.arr)}splice(e){let t=new sB(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){let r=this.arr.length;e.writeLen(r-t);for(let n=t;n<r;n++){let t=this.arr[n];e.writeAny(t)}}getRef(){return 8}}class s${constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new s$(this.str)}splice(e){let t=new s$(this.str.slice(e));this.str=this.str.slice(0,e);let r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",t.str=""+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(0===t?this.str:this.str.slice(t))}getRef(){return 4}}let sH=[e=>new si,e=>new so,e=>new sC,e=>new sx(e.readKey()),e=>new sS,e=>new sA(e.readKey()),e=>new sI],sW=0,sz=1,sV=2,sJ=3,sK=4,sX=5,sY=6;class sq{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new sq(this.type._copy())}splice(e){throw eK()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;null!==t;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(t=>{t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;null!==t;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(t=>{for(;null!==t;)t.gc(e,!0),t=t.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}let sG=(e,t,r)=>{let{client:n,clock:s}=t.id,i=new sZ(nm(n,s+r),t,nm(n,s+r-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(r));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),null!==t.redone&&(i.redone=nm(t.redone.client,t.redone.clock+r)),t.right=i,null!==i.right&&(i.right.left=i),e._mergeStructs.push(i),null!==i.parentSub&&null===i.right&&i.parent._map.set(i.parentSub,i),t.length=r,i};class sZ extends sL{constructor(e,t,r,n,s,i,l,o){super(e,o.getLength()),this.origin=r,this.left=t,this.right=n,this.rightOrigin=s,this.parent=i,this.parentSub=l,this.redone=null,this.content=o,this.info=2*!!this.content.isCountable()}set marker(e){(8&this.info)>0!==e&&(this.info^=8)}get marker(){return(8&this.info)>0}get keep(){return(1&this.info)>0}set keep(e){this.keep!==e&&(this.info^=1)}get countable(){return(2&this.info)>0}get deleted(){return(4&this.info)>0}set deleted(e){this.deleted!==e&&(this.info^=4)}markDeleted(){this.info|=4}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=nv(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=nv(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===np&&this.id.client!==this.parent.client&&this.parent.clock>=nv(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=nA(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=nD(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===sM||this.right&&this.right.constructor===sM)this.parent=null;else if(this.parent){if(this.parent.constructor===np){let e=nS(t,this.parent);e.constructor===sM?this.parent=null:this.parent=e.content.type}}else this.left&&this.left.constructor===sZ?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===sZ&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=nA(e,e.doc.store,nm(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let t,r=this.left;if(null!==r)t=r.right;else if(null!==this.parentSub)for(t=this.parent._map.get(this.parentSub)||null;null!==t&&null!==t.left;)t=t.left;else t=this.parent._start;let n=new Set,s=new Set;for(;null!==t&&t!==this.right;){if(s.add(t),n.add(t),nw(this.origin,t.origin)){if(t.id.client<this.id.client)r=t,n.clear();else if(nw(this.rightOrigin,t.rightOrigin))break}else if(null!==t.origin&&s.has(nS(e.doc.store,t.origin)))n.has(nS(e.doc.store,t.origin))||(r=t,n.clear());else break;t=t.right}this.left=r}if(null!==this.left){let e=this.left.right;this.right=e,this.left.right=this}else{let e;if(null!==this.parentSub)for(e=this.parent._map.get(this.parentSub)||null;null!==e&&null!==e.left;)e=e.left;else e=this.parent._start,this.parent._start=this;this.right=e}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(e)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),nC(e.doc.store,this),this.content.integrate(e,this),nT(e,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(e)}else new sM(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;null!==e&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;null!==e&&e.deleted;)e=e.left;return e}get lastId(){return 1===this.length?this.id:nm(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&nw(e.origin,this.lastId)&&this.right===e&&nw(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&null===this.redone&&null===e.redone&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){let t=this.parent._searchMarker;return t&&t.forEach(t=>{t.p===e&&(t.p=this,!this.deleted&&this.countable&&(t.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,null!==this.right&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){let t=this.parent;this.countable&&null===this.parentSub&&(t._length-=this.length),this.markDeleted(),r8(e.deleteSet,this.id.client,this.id.clock,this.length),nT(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw eX();if(this.content.gc(e),t){var r;let t;r=new sM(this.id,this.length),(t=e.clients.get(this.id.client))[nE(t,this.id.clock)]=r}else this.content=new sO(this.length)}write(e,t){let r=t>0?nm(this.id.client,this.id.clock+t-1):this.origin,n=this.rightOrigin,s=this.parentSub,i=31&this.content.getRef()|128*(null!==r)|64*(null!==n)|32*(null!==s);if(e.writeInfo(i),null!==r&&e.writeLeftID(r),null!==n&&e.writeRightID(n),null===r&&null===n){let t=this.parent;if(void 0!==t._item){let r=t._item;if(null===r){let r=(e=>{for(let[t,r]of e.doc.share.entries())if(r===e)return t;throw eX()})(t);e.writeParentInfo(!0),e.writeString(r)}else e.writeParentInfo(!1),e.writeLeftID(r.id)}else t.constructor===String?(e.writeParentInfo(!0),e.writeString(t)):t.constructor===np?(e.writeParentInfo(!1),e.writeLeftID(t)):eX();null!==s&&e.writeString(s)}this.content.write(e,t)}}let sQ=(e,t)=>s0[31&t](e),s0=[()=>{eX()},e=>new sO(e.readLen()),e=>{let t=e.readLen(),r=[];for(let n=0;n<t;n++){let t=e.readString();"undefined"===t?r.push(void 0):r.push(JSON.parse(t))}return new sP(r)},e=>new sT(e.readBuf()),e=>new s$(e.readString()),e=>new sN(e.readJSON()),e=>new sj(e.readKey(),e.readJSON()),e=>new sq(sH[e.readTypeRef()](e)),e=>{let t=e.readLen(),r=[];for(let n=0;n<t;n++)r.push(e.readAny());return new sB(r)},e=>new sR(sU(e.readString(),e.readAny())),()=>{eX()}];class s1 extends sL{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor===e.constructor&&(this.length+=e.length,!0)}integrate(e,t){eX()}write(e,t){e.writeInfo(10),eM(e.restEncoder,this.length-t)}getMissing(e,t){return null}}let s2="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,s8="__ $YJS$ __";!0===s2[s8]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),s2[s8]=!0;let s3=new Map,s4="undefined"==typeof BroadcastChannel?class{constructor(e){let t;this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:tM(t.newValue||"")}),t=this._onChange,tc||addEventListener("storage",t)}postMessage(e){th.setItem(this.room,tL(new Uint8Array(e)))}close(){let e;e=this._onChange,tc||removeEventListener("storage",e)}}:BroadcastChannel,s6=e=>Q(s3,e,()=>{let t=ee(),r=new s4(e);return r.onmessage=e=>t.forEach(t=>t(e.data,"broadcastchannel")),{bc:r,subs:t}}),s7=(e,t,r=null)=>{let n=s6(e);n.bc.postMessage(t),n.subs.forEach(e=>e(t,r))},s5=(e,t)=>{eM(e,0),ej(e,((e,t=new ni)=>(e instanceof Map?na(t,e):na(t,nk(e.store)),t.toUint8Array()))(t,new nn))},s9=(e,t,r)=>{eM(e,1),ej(e,((e,t=new Uint8Array([0]),r=new nl)=>{((e,t,r=new Map)=>{var n;let s;no(e,t.store,r),r4(e,(n=t.store,s=r3(),n.clients.forEach((e,t)=>{let r=[];for(let t=0;t<e.length;t++){let n=e[t];if(n.deleted){let s=n.id.clock,i=n.length;if(t+1<e.length)for(let r=e[t+1];t+1<e.length&&r.deleted;r=e[++t+1])i+=r.length;r.push(new rZ(s,i))}}r.length>0&&s.clients.set(t,r)}),s))})(r,e,nh(t));let n=[r.toUint8Array()];if(e.store.pendingDs&&n.push(e.store.pendingDs),e.store.pendingStructs&&n.push(((e,t,r=nr,n=nl)=>{let s=nh(t),i=new n,l=new nj(i),o=new r(eZ(e)),c=new nN(o,!1);for(;c.curr;){let e=c.curr,t=e.id.client,r=s.get(t)||0;if(c.curr.constructor===s1){c.next();continue}if(e.id.clock+e.length>r)for(n$(l,e,ed(r-e.id.clock,0)),c.next();c.curr&&c.curr.id.client===t;)n$(l,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===t&&c.curr.id.clock+c.curr.length<=r;)c.next()}return nH(l),r4(i,r6(o)),i.toUint8Array()})(e.store.pendingStructs.update,t)),n.length>1){if(r.constructor===ns)return nF(n.map((e,t)=>0===t?e:((e,t,r,n)=>{let s=new r(eZ(e)),i=new nN(s,!1),l=new n,o=new nj(l);for(let e=i.curr;null!==e;e=i.next())n$(o,t(e),0);return nH(o),r4(l,r6(s)),l.toUint8Array()})(e,tb,nr,ns)),ne,ns);else if(r.constructor===nl)return nF(n)}return n[0]})(t,r,new ns))};class ie extends ec{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{let e=tn();null!==this.getLocalState()&&15e3<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());let t=[];this.meta.forEach((r,n)=>{n!==this.clientID&&3e4<=e-r.lastUpdated&&this.states.has(n)&&t.push(n)}),t.length>0&&it(this,t,"timeout")},eh(3e3)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){let t=this.clientID,r=this.meta.get(t),n=void 0===r?0:r.clock+1,s=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:n,lastUpdated:tn()});let i=[],l=[],o=[],c=[];null===e?c.push(t):null==s?null!=e&&i.push(t):(l.push(t),t_(s,e)||o.push(t)),(i.length>0||o.length>0||c.length>0)&&this.emit("change",[{added:i,updated:o,removed:c},"local"]),this.emit("update",[{added:i,updated:l,removed:c},"local"])}setLocalStateField(e,t){let r=this.getLocalState();null!==r&&this.setLocalState({...r,[e]:t})}getStates(){return this.states}}let it=(e,t,r)=>{let n=[];for(let r=0;r<t.length;r++){let s=t[r];if(e.states.has(s)){if(e.states.delete(s),s===e.clientID){let t=e.meta.get(s);e.meta.set(s,{clock:t.clock+1,lastUpdated:tn()})}n.push(s)}}n.length>0&&(e.emit("change",[{added:[],updated:[],removed:n},r]),e.emit("update",[{added:[],updated:[],removed:n},r]))},ir=(e,t,r=e.states)=>{let n=t.length,s=eD();eM(s,n);for(let i=0;i<n;i++){let n=t[i],l=r.get(n)||null,o=e.meta.get(n).clock;eM(s,n),eM(s,o),eR(s,JSON.stringify(l))}return eI(s)},is=[];is[0]=(e,t,r,n,s)=>{eM(e,0);let i=((e,t,r,n,s)=>{let i=e1(e);switch(i){case 0:s9(t,r,eQ(e));break;case 1:case 2:var l=e,o=r,c=n,h=void 0;try{let e;e=eQ(l),nc(o,e,c,ne)}catch(e){null!=h&&h(e),console.error("Caught error while handling a Yjs update",e)}break;default:throw Error("Unknown message type")}return i})(t,e,r.doc,r);n&&1===i&&!r.synced&&(r.synced=!0)},is[3]=(e,t,r,n,s)=>{eM(e,1),ej(e,ir(r.awareness,Array.from(r.awareness.getStates().keys())))},is[1]=(e,t,r,n,s)=>{((e,t,r)=>{let n=eZ(t),s=tn(),i=[],l=[],o=[],c=[],h=e1(n);for(let t=0;t<h;t++){let t=e1(n),r=e1(n),h=JSON.parse(e8(n)),a=e.meta.get(t),u=e.states.get(t),d=void 0===a?0:a.clock;(d<r||d===r&&null===h&&e.states.has(t))&&(null===h?t===e.clientID&&null!=e.getLocalState()?r++:e.states.delete(t):e.states.set(t,h),e.meta.set(t,{clock:r,lastUpdated:s}),void 0===a&&null!==h?i.push(t):void 0!==a&&null===h?c.push(t):null!==h&&(t_(h,u)||o.push(t),l.push(t)))}(i.length>0||o.length>0||c.length>0)&&e.emit("change",[{added:i,updated:o,removed:c},r]),(i.length>0||l.length>0||c.length>0)&&e.emit("update",[{added:i,updated:l,removed:c},r])})(r.awareness,eQ(t),r)},is[2]=(e,t,r,n,s)=>{var i;i=r.doc,0===e1(t)&&((e,t)=>ii(r,t))(i,e8(t))};let ii=(e,t)=>console.warn(`Permission denied to access ${e.url}.
${t}`),il=(e,t,r)=>{let n=eZ(t),s=eD(),i=e1(n),l=e.messageHandlers[i];return l?l(s,n,e,r,i):console.error("Unable to compute message"),s},io=(e,t,r)=>{t===e.ws&&(e.emit("connection-close",[r,e]),e.ws=null,t.close(),e.wsconnecting=!1,e.wsconnected?(e.wsconnected=!1,e.synced=!1,it(e.awareness,Array.from(e.awareness.getStates().keys()).filter(t=>t!==e.doc.clientID),e),e.emit("status",[{status:"disconnected"}])):e.wsUnsuccessfulReconnects++,setTimeout(ic,eu(100*eg(2,e.wsUnsuccessfulReconnects),e.maxBackoffTime),e))},ic=e=>{if(e.shouldConnect&&null===e.ws){let t=new e._WS(e.url,e.protocols);t.binaryType="arraybuffer",e.ws=t,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,t.onmessage=r=>{e.wsLastMessageReceived=tn();let n=il(e,new Uint8Array(r.data),!0);eA(n)>1&&t.send(eI(n))},t.onerror=t=>{e.emit("connection-error",[t,e])},t.onclose=r=>{io(e,t,r)},t.onopen=()=>{e.wsLastMessageReceived=tn(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);let r=eD();if(eM(r,0),s5(r,e.doc),t.send(eI(r)),null!==e.awareness.getLocalState()){let r=eD();eM(r,1),ej(r,ir(e.awareness,[e.doc.clientID])),t.send(eI(r))}},e.emit("status",[{status:"connecting"}])}},ih=(e,t)=>{let r=e.ws;e.wsconnected&&r&&r.readyState===r.OPEN&&r.send(t),e.bcconnected&&s7(e.bcChannel,t,e)};class ia extends eo{constructor(e,t,r,{connect:n=!0,awareness:s=new ie(r),params:i={},protocols:l=[],WebSocketPolyfill:o=WebSocket,resyncInterval:c=-1,maxBackoffTime:h=2500,disableBc:a=!1}={}){for(super();"/"===e[e.length-1];)e=e.slice(0,e.length-1);this.serverUrl=e,this.bcChannel=e+"/"+t,this.maxBackoffTime=h,this.params=i,this.protocols=l,this.roomname=t,this.doc=r,this._WS=o,this.awareness=s,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=a,this.wsUnsuccessfulReconnects=0,this.messageHandlers=is.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=n,this._resyncInterval=0,c>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){let e=eD();eM(e,0),s5(e,r),this.ws.send(eI(e))}},c)),this._bcSubscriber=(e,t)=>{if(t!==this){let t=il(this,new Uint8Array(e),!1);eA(t)>1&&s7(this.bcChannel,eI(t),this)}},this._updateHandler=(e,t)=>{if(t!==this){let t=eD();eM(t,0),eM(t,2),ej(t,e),ih(this,eI(t))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:e,updated:t,removed:r},n)=>{let i=e.concat(t).concat(r),l=eD();eM(l,1),ej(l,ir(s,i)),ih(this,eI(l))},this._exitHandler=()=>{it(this.awareness,[r.clientID],"app closed")},tk&&void 0!==Y.default&&Y.default.on("exit",this._exitHandler),s.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&3e4<tn()-this.wsLastMessageReceived&&io(this,this.ws,null)},3e3),n&&this.connect()}get url(){let e=((e,t)=>{let r=[];for(let n in e)r.push(t(e[n],n));return r})(this.params,(e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`).join("&");return this.serverUrl+"/"+this.roomname+(0===e.length?"":"?"+e)}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this._resyncInterval&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),tk&&void 0!==Y.default&&Y.default.off("exit",this._exitHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;if(!this.bcconnected){var e,t;e=this.bcChannel,t=this._bcSubscriber,s6(e).subs.add(t),this.bcconnected=!0}let r=eD();eM(r,0),s5(r,this.doc),s7(this.bcChannel,eI(r),this);let n=eD();eM(n,0),s9(n,this.doc),s7(this.bcChannel,eI(n),this);let s=eD();eM(s,3),s7(this.bcChannel,eI(s),this);let i=eD();eM(i,1),ej(i,ir(this.awareness,[this.doc.clientID])),s7(this.bcChannel,eI(i),this)}disconnectBc(){let e=eD();if(eM(e,1),ej(e,ir(this.awareness,[this.doc.clientID],new Map)),ih(this,eI(e)),this.bcconnected){var t,r;let e;t=this.bcChannel,r=this._bcSubscriber,(e=s6(t)).subs.delete(r)&&0===e.subs.size&&(e.bc.close(),s3.delete(t)),this.bcconnected=!1}}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&io(this,this.ws,null)}connect(){this.shouldConnect=!0,this.wsconnected||null!==this.ws||(ic(this),this.connectBc())}}class iu{supabase;constructor(e){this.supabase=e||(0,q.createClient)()}providers=new Map;ydocs=new Map;activeUsers=new Map;async initializeCollaboration(e,t,r,n,s){let i=this.ydocs.get(e);i||(i=new r5,this.ydocs.set(e,i));let l=this.providers.get(e);if(!l){let r=Y.default.env.NEXT_PUBLIC_WS_URL;if(!r)throw Error("Collaboration dsactive: aucun serveur WebSocket configur (NEXT_PUBLIC_WS_URL)");try{l=new ia(r,`template-${e}`,i,{params:{userId:t,templateId:e},resyncInterval:-1});let n=0;l.on("status",t=>{if("connected"===t.status)n=0,console.log("Collaboration status: connected");else if("disconnected"===t.status)if(++n<=3)console.warn(`WebSocket disconnected (tentative ${n}/3)`);else throw console.warn("WebSocket: trop de tentatives de connexion, collaboration dsactive"),l&&(l.destroy(),this.providers.delete(e)),Error("Impossible de se connecter au serveur de collaboration aprs plusieurs tentatives")}),l.on("connection-error",(e,t)=>{let r=e?.message||e?.error?.message||String(e);console.warn("Erreur de connexion WebSocket:",r)}),l.awareness.on("change",()=>{this.updateActiveUsers(e,l)}),this.providers.set(e,l)}catch(e){if(console.warn("Erreur lors de la cration du provider WebSocket:",e),l)try{l.destroy()}catch(e){}throw e}}let o=this.generateUserColor(t),c={id:t,name:r,email:n,avatarUrl:s,color:o};return this.activeUsers.has(e)||this.activeUsers.set(e,new Map),this.activeUsers.get(e).set(t,c),l.awareness.setLocalStateField("user",c),{ydoc:i,provider:l}}updateCursor(e,t,r,n){let s=this.providers.get(e);if(!s)return;let i=this.activeUsers.get(e);if(!i)return;let l=i.get(t);l&&(l.cursor={position:r,selection:n},s.awareness.setLocalStateField("user",l))}getActiveUsers(e){let t=this.activeUsers.get(e);return t?Array.from(t.values()):[]}updateActiveUsers(e,t){let r=t.awareness.getStates(),n=new Map;r.forEach((e,t)=>{if(e.user){let t=e.user;n.set(t.id,t)}}),this.activeUsers.set(e,n)}generateUserColor(e){let t=["#335ACF","#10B981","#F59E0B","#EF4444","#8B5CF6","#EC4899","#06B6D4","#84CC16"],r=0;for(let t=0;t<e.length;t++)r=e.charCodeAt(t)+((r<<5)-r);return t[Math.abs(r)%t.length]}disconnect(e,t){let r=this.providers.get(e);r&&r.awareness.setLocalStateField("user",null);let n=this.activeUsers.get(e);n&&n.delete(t)}cleanup(e){let t=this.providers.get(e);t&&(t.destroy(),this.providers.delete(e));let r=this.ydocs.get(e);r&&(r.destroy(),this.ydocs.delete(e)),this.activeUsers.delete(e)}async syncToSupabase(e,t,r){let n=t.getXmlFragment(r).toString(),s={};"header"===r?s.header={html:n,elements:[]}:"body"===r?s.content={html:n,elements:[]}:"footer"===r&&(s.footer={html:n,elements:[]});let{error:i}=await this.supabase.from("document_templates").update(s).eq("id",e);if(i)throw console.error("Erreur lors de la synchronisation:",i),i}async loadFromSupabase(e,t,r){let{data:n,error:s}=await this.supabase.from("document_templates").select("header, content, footer").eq("id",e).single();if(s)throw s;let i="";"header"===r?i=n.header?.html||"":"body"===r?i=n.content?.html||"":"footer"===r&&(i=n.footer?.html||"");let l=t.getXmlFragment(r),o=new sI;o.insert(0,i),l.insert(0,[o])}}let id=new iu;e.s(["realtimeCollaborationService",0,id],762687)}]);