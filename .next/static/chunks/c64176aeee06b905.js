(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let r=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>r],107233)},645760,e=>{"use strict";var r=e.i(843476),t=e.i(271645),a=e.i(647163);e.i(882205);var s=e.i(846932);let i=t.forwardRef(({className:e,variant:t="default",hoverable:i=!1,glow:n=!1,glowColor:l="rgba(51, 90, 207, 0.3)",...o},d)=>(0,r.jsxs)(s.motion.div,{ref:d,className:(0,a.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===t,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===t,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===t,"cursor-pointer":i,"hover:shadow-2xl hover:scale-[1.02]":i,"hover:bg-white/90 dark:hover:bg-gray-900/90":i},e),whileHover:i?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...o,children:[n&&(0,r.jsx)(s.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${l} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,r.jsx)("div",{className:"relative z-10",children:o.children})]}));i.displayName="GlassCard",e.s(["GlassCard",()=>i])},263488,e=>{"use strict";let r=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>r],263488)},286536,e=>{"use strict";let r=(0,e.i(475254).default)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>r],286536)},569074,e=>{"use strict";let r=(0,e.i(475254).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>r],569074)},514764,e=>{"use strict";let r=(0,e.i(475254).default)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);e.s(["Send",()=>r],514764)},785817,e=>{"use strict";var r=e.i(843476),t=e.i(271645),a=e.i(647163);e.i(882205);var s=e.i(846932);let i=t.forwardRef(({className:e,columns:t=4,gap:s="md",children:i,...n},l)=>(0,r.jsx)("div",{ref:l,className:(0,a.cn)("grid",{1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 md:grid-cols-2 lg:grid-cols-4"}[t],{sm:"gap-4",md:"gap-6",lg:"gap-8"}[s],e),...n,children:i}));i.displayName="BentoGrid";let n=t.forwardRef(({className:e,span:t=1,rowSpan:i=1,children:n,...l},o)=>(0,r.jsx)(s.motion.div,{ref:o,className:(0,a.cn)({1:"col-span-1",2:"col-span-1 md:col-span-2",3:"col-span-1 md:col-span-2 lg:col-span-3",4:"col-span-1 md:col-span-2 lg:col-span-4"}[t],{1:"row-span-1",2:"row-span-1 md:row-span-2",3:"row-span-1 md:row-span-3"}[i],e),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:[.16,1,.3,1]},...l,children:n}));n.displayName="BentoCard",e.s(["BentoCard",()=>n,"BentoGrid",()=>i])},671428,e=>{"use strict";var r=e.i(843476),t=e.i(647163);function a({className:e,...a}){return(0,r.jsx)("div",{className:(0,t.cn)("animate-pulse rounded-md bg-gray-200",e),...a})}function s(){return(0,r.jsxs)("div",{className:"rounded-2xl p-6 border-2 border-gray-200 bg-white",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,r.jsx)(a,{className:"h-12 w-12 rounded-2xl"}),(0,r.jsx)(a,{className:"h-6 w-20"})]}),(0,r.jsx)(a,{className:"h-8 w-24 mb-2"}),(0,r.jsx)(a,{className:"h-4 w-32"})]})}function i(){return(0,r.jsxs)("div",{className:"rounded-2xl p-6 border-2 border-gray-200 bg-white",children:[(0,r.jsx)(a,{className:"h-6 w-48 mb-4"}),(0,r.jsx)(a,{className:"h-64 w-full"})]})}function n({count:e=3}){return(0,r.jsx)("div",{className:"space-y-3",children:Array.from({length:e}).map((e,t)=>(0,r.jsxs)("div",{className:"flex items-center gap-4 p-4 border rounded-lg",children:[(0,r.jsx)(a,{className:"h-12 w-12 rounded-full"}),(0,r.jsxs)("div",{className:"flex-1 space-y-2",children:[(0,r.jsx)(a,{className:"h-4 w-3/4"}),(0,r.jsx)(a,{className:"h-3 w-1/2"})]}),(0,r.jsx)(a,{className:"h-8 w-20"})]},t))})}function l({count:e=3}){return(0,r.jsx)(n,{count:e})}function o({items:e=4}){return(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:e}).map((e,t)=>(0,r.jsx)(s,{},t))})}e.s(["ChartSkeleton",()=>i,"Skeleton",()=>a,"SkeletonBentoGrid",()=>o,"SkeletonList",()=>l,"StatsCardSkeleton",()=>s])},246704,779478,e=>{"use strict";var r,t,a=e.i(790224),s=((r={}).AUTH_REQUIRED="AUTH_1001",r.AUTH_INVALID_CREDENTIALS="AUTH_1002",r.AUTH_SESSION_EXPIRED="AUTH_1003",r.AUTH_INSUFFICIENT_PERMISSIONS="AUTH_1004",r.AUTH_2FA_REQUIRED="AUTH_1005",r.AUTH_2FA_INVALID="AUTH_1006",r.VALIDATION_ERROR="VALID_2001",r.VALIDATION_REQUIRED_FIELD="VALID_2002",r.VALIDATION_INVALID_FORMAT="VALID_2003",r.VALIDATION_UNIQUE_CONSTRAINT="VALID_2004",r.DB_CONNECTION_ERROR="DB_3001",r.DB_QUERY_ERROR="DB_3002",r.DB_NOT_FOUND="DB_3003",r.DB_CONSTRAINT_VIOLATION="DB_3004",r.DB_FOREIGN_KEY_CONSTRAINT="DB_3006",r.DB_RLS_POLICY_VIOLATION="DB_3005",r.NETWORK_ERROR="NET_4001",r.API_TIMEOUT="NET_4002",r.API_RATE_LIMIT="NET_4003",r.API_SERVER_ERROR="NET_4004",r.API_NOT_FOUND="NET_4005",r.API_BAD_REQUEST="NET_4006",r.BUSINESS_LOGIC_ERROR="BIZ_5001",r.RESOURCE_LOCKED="BIZ_5002",r.OPERATION_NOT_ALLOWED="BIZ_5003",r.QUOTA_EXCEEDED="BIZ_5004",r.INTERNAL_ERROR="SYS_6001",r.CONFIGURATION_ERROR="SYS_6002",r.SERVICE_UNAVAILABLE="SYS_6003",r);(t={}).LOW="low",t.MEDIUM="medium",t.HIGH="high",t.CRITICAL="critical";class i extends Error{code;severity;userMessage;retryable;context;originalError;constructor(e,r="SYS_6001",t="medium",a={},s){super(e),this.name="AppError",this.code=r,this.severity=t,this.userMessage=a.userMessage||this.getDefaultUserMessage(r),this.retryable=a.retryable??this.isRetryable(r),this.context={...a,code:r,severity:t,timestamp:new Date().toISOString()},this.originalError=s,Error.captureStackTrace&&Error.captureStackTrace(this,i)}getDefaultUserMessage(e){return({AUTH_1001:"Vous devez être connecté pour effectuer cette action.",AUTH_1002:"Email ou mot de passe incorrect.",AUTH_1003:"Votre session a expiré. Veuillez vous reconnecter.",AUTH_1004:"Vous n'avez pas les permissions nécessaires.",AUTH_1005:"Authentification à deux facteurs requise.",AUTH_1006:"Code d'authentification invalide.",VALID_2001:"Les données fournies ne sont pas valides.",VALID_2002:"Certains champs obligatoires sont manquants.",VALID_2003:"Le format des données est incorrect.",VALID_2004:"Cette valeur existe déjà.",DB_3001:"Impossible de se connecter à la base de données.",DB_3002:"Erreur lors de l'exécution de la requête.",DB_3003:"Ressource introuvable.",DB_3004:"Cette opération viole une contrainte de la base de données.",DB_3006:"Cette opération viole une contrainte de clé étrangère.",DB_3005:"Vous n'avez pas accès à cette ressource.",NET_4001:"Erreur de connexion réseau. Vérifiez votre connexion internet.",NET_4002:"La requête a pris trop de temps. Veuillez réessayer.",NET_4003:"Trop de requêtes. Veuillez patienter quelques instants.",NET_4004:"Erreur serveur. Veuillez réessayer plus tard.",NET_4005:"Ressource introuvable.",NET_4006:"Requête invalide.",BIZ_5001:"Cette opération n'est pas autorisée dans le contexte actuel.",BIZ_5002:"Cette ressource est actuellement verrouillée.",BIZ_5003:"Cette opération n'est pas autorisée.",BIZ_5004:"Vous avez atteint la limite autorisée.",SYS_6001:"Une erreur interne est survenue. Veuillez réessayer.",SYS_6002:"Erreur de configuration du système.",SYS_6003:"Service temporairement indisponible."})[e]||"Une erreur inattendue est survenue."}isRetryable(e){return["NET_4001","NET_4002","NET_4004","DB_3001","SYS_6003"].includes(e)}toJSON(){return{name:this.name,message:this.message,code:this.code,severity:this.severity,userMessage:this.userMessage,retryable:this.retryable,context:this.context,stack:this.stack,originalError:this.originalError instanceof Error?{name:this.originalError.name,message:this.originalError.message,stack:this.originalError.stack}:this.originalError}}}let n=new class{handleError(e,r={}){if(e instanceof i)return this.logError(e),e;if(e instanceof Error)return this.handleStandardError(e,r);if(this.isSupabaseError(e))return this.handleSupabaseError(e,r);let t=new i("Une erreur inattendue est survenue.","SYS_6001","high",r,e);return this.logError(t),t}handleStandardError(e,r){let t=e.message.toLowerCase(),a="SYS_6001",s="medium";t.includes("network")||t.includes("fetch")?(a="NET_4001",s="medium"):t.includes("timeout")?(a="NET_4002",s="medium"):t.includes("unauthorized")||t.includes("401")?(a="AUTH_1001",s="high"):t.includes("forbidden")||t.includes("403")?(a="AUTH_1004",s="high"):t.includes("not found")||t.includes("404")?(a="DB_3003",s="low"):(t.includes("validation")||t.includes("invalid"))&&(a="VALID_2001",s="low");let n=new i(e.message,a,s,r,e);return this.logError(n),n}handleSupabaseError(e,r){let t=e.code||e.status,a=e.message||"Erreur Supabase",s=r.code||"DB_3002",n="medium";if(!r.code)switch(t){case"PGRST116":case"42P01":s="DB_3003",n="low";break;case"42501":s="DB_3005",n="high";break;case"23505":s="VALID_2004",n="low";break;case"23503":s="DB_3004",n="medium";break;case"PGRST301":case"400":s="NET_4006",n="low";break;case"401":s="AUTH_1001",n="high";break;case"403":s="AUTH_1004",n="high";break;case"404":s="NET_4005",n="low";break;case"500":s="NET_4004",n="high"}"DB_3006"===s&&(n="medium");let l=new i(a,s,n,r,e);return this.logError(l),l}isSupabaseError(e){return e&&(e.code||e.status||e.message)&&("string"==typeof e.code||"number"==typeof e.status)}logError(e){let r={...e.context,code:e.code,severity:e.severity,retryable:e.retryable};switch(e.severity){case"critical":case"high":a.logger.error(e.message,e.originalError||e,r);break;case"medium":a.logger.warn(e.message,r);break;case"low":a.logger.info(`Error: ${e.message}`,r)}}createValidationError(e,r){return new i(e,"VALID_2001","low",{field:r,userMessage:e})}createAuthError(e,r){return new i(r||"Erreur d'authentification",e,"high")}createDatabaseError(e,r){return new i(e,"DB_3002","medium",{},r)}createNotFoundError(e,r){return new i(e,"DB_3003","low",r)}};e.s(["AppError",()=>i,"ErrorCode",()=>s,"errorHandler",0,n],779478),e.s([],246704)},627404,e=>{"use strict";e.i(246704);var r=e.i(779478);async function t(e,t,a,s){try{let i=e.from(t).select(s?.select||"*").eq("organization_id",a);s?.filters&&Object.entries(s.filters).forEach(([e,r])=>{null!=r&&(i=i.eq(e,r))}),s?.search&&(i=i.ilike(s.search.field,`%${s.search.value}%`)),i=s?.orderBy?i.order(s.orderBy.column,{ascending:s.orderBy.ascending??!1}):i.order("created_at",{ascending:!1});let{data:n,error:l}=await i;if(l)throw r.errorHandler.handleError(l,{organizationId:a,operation:"getAllByOrganization",table:t});return n||[]}catch(e){if(e instanceof r.AppError)throw e;throw r.errorHandler.handleError(e,{organizationId:a,operation:"getAllByOrganization",table:t})}}async function a(e,t,a,s){try{let{data:i,error:n}=await e.from(t).select(s||"*").eq("id",a).single();if(n){if("PGRST116"===n.code||"42P01"===n.code)throw r.errorHandler.handleError(n,{code:r.ErrorCode.DB_NOT_FOUND,operation:"getById",id:a,table:t});throw r.errorHandler.handleError(n,{operation:"getById",id:a,table:t})}if(!i)throw r.errorHandler.createDatabaseError(`Enregistrement avec l'ID ${a} introuvable dans ${t}`,{id:a,table:t});return i}catch(e){if(e instanceof r.AppError)throw e;throw r.errorHandler.handleError(e,{operation:"getById",id:a,table:t})}}e.s(["getAllByOrganization",()=>t,"getById",()=>a])},34458,e=>{"use strict";e.i(246704);var r=e.i(779478);function t(e,t){for(let a of t)if(!e[a])throw r.errorHandler.createValidationError(`Le champ ${String(a)} est obligatoire`,String(a))}e.s(["validateRequired",()=>t])},163454,e=>{"use strict";var r=e.i(920755);e.i(246704);var t=e.i(779478),a=e.i(790224),s=e.i(627404);async function i(e,r,a,s){try{let i=s.year||new Date().getFullYear().toString().slice(-2),n=s.padding||6,l=s.fieldName||"number",o=`${s.prefix}-${s.orgCode}-${i}-%`,{data:d,error:c}=await e.from(r).select(l).eq("organization_id",a).like(l,o).order(l,{ascending:!1}).limit(1).maybeSingle();if(c&&"PGRST116"!==c.code&&"42P01"!==c.code)throw t.errorHandler.handleError(c,{operation:"generateUniqueNumber",table:r,organizationId:a});let u=1;if(d&&d[l]){let e=String(d[l]).split("-");u=parseInt(e[e.length-1]||"0",10)+1}return`${s.prefix}-${s.orgCode}-${i}-${String(u).padStart(n,"0")}`}catch(e){throw t.errorHandler.handleError(e,{operation:"generateUniqueNumber",table:r,organizationId:a})}}var n=e.i(34458);let l=new class{supabase;constructor(e){this.supabase=e||(0,r.createClient)()}async getAll(e,r){try{let a=r?.page||1,s=r?.limit||50,i=(a-1)*s;if(r?.search){let n=this.supabase.from("students").select("*, classes(id, name, level)",{count:"exact"}).eq("organization_id",e).or(`first_name.ilike.%${r.search}%,last_name.ilike.%${r.search}%,student_number.ilike.%${r.search}%`);r?.classId&&(n=n.eq("class_id",r.classId)),r?.status&&(n=n.eq("status",r.status));let{data:l,error:o,count:d}=await n.order("last_name",{ascending:!0}).range(i,i+s-1);if(o)throw t.errorHandler.handleError(o,{organizationId:e,operation:"getAll",filters:r});return{data:l||[],total:d||0,page:a,limit:s,totalPages:Math.ceil((d||0)/s)}}let n=this.supabase.from("students").select("*, classes(id, name, level)",{count:"exact"}).eq("organization_id",e);r?.classId&&(n=n.eq("class_id",r.classId)),r?.status&&(n=n.eq("status",r.status));let{data:l,error:o,count:d}=await n.order("last_name",{ascending:!0}).range(i,i+s-1);if(o)throw t.errorHandler.handleError(o,{organizationId:e,operation:"getAll",filters:r});return{data:l||[],total:d||0,page:a,limit:s,totalPages:Math.ceil((d||0)/s)}}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{organizationId:e,operation:"getAll"})}}async getById(e){try{return(0,s.getById)(this.supabase,"students",e,"*, classes(id, name, level)")}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"getById",id:e})}}async getByNumber(e,r){try{let{data:a,error:s}=await this.supabase.from("students").select("*").eq("organization_id",e).eq("student_number",r).single();if(s){if("PGRST116"===s.code||"42P01"===s.code)throw t.errorHandler.handleError(s,{code:t.ErrorCode.DB_NOT_FOUND,operation:"getByNumber",organizationId:e,studentNumber:r});throw t.errorHandler.handleError(s,{operation:"getByNumber",organizationId:e,studentNumber:r})}return a}catch(a){if(a instanceof t.AppError)throw a;throw t.errorHandler.handleError(a,{operation:"getByNumber",organizationId:e,studentNumber:r})}}async create(e){try{(0,n.validateRequired)(e,["first_name","last_name","organization_id"]);let r=e.student_number;if(!r||""===r.trim()){let t=e.organization_id;if(!t)throw Error("organization_id is required");let{data:a}=await this.supabase.from("organizations").select("code").eq("id",t).single(),s=a?.code||"ORG",n=new Date().getFullYear().toString().slice(-2);r=await i(this.supabase,"students",t,{prefix:"EDU",orgCode:s,year:n,padding:6,fieldName:"student_number"})}let s={...e,student_number:r},{data:l,error:o}=await this.supabase.from("students").insert(s).select().single();if(o){if("23505"===o.code)throw t.errorHandler.handleError(o,{code:t.ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,operation:"create",field:"student_number"});if("42501"===o.code)throw t.errorHandler.handleError(o,{code:t.ErrorCode.DB_RLS_POLICY_VIOLATION,operation:"create"});throw t.errorHandler.handleError(o,{operation:"create",student:e})}return a.logger.info("Étudiant créé avec succès",{id:l?.id,organizationId:e.organization_id||void 0,studentNumber:l?.student_number}),l}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"create",student:e})}}async update(e,r){try{let s={...r};if("class_id"in s)if(""!==s.class_id&&s.class_id){let{data:e,error:r}=await this.supabase.from("classes").select("id").eq("id",s.class_id).maybeSingle();e||r||(s.class_id=null)}else s.class_id=null;let{data:i,error:n}=await this.supabase.from("students").update(s).eq("id",e).select().single();if(n){if("PGRST116"===n.code||"42P01"===n.code)throw t.errorHandler.handleError(n,{code:t.ErrorCode.DB_NOT_FOUND,operation:"update",id:e});if("42501"===n.code)throw t.errorHandler.handleError(n,{code:t.ErrorCode.DB_RLS_POLICY_VIOLATION,operation:"update",id:e});throw t.errorHandler.handleError(n,{operation:"update",id:e,updates:r})}if(!i)throw t.errorHandler.createDatabaseError(`\xc9tudiant avec l'ID ${e} introuvable pour la mise \xe0 jour`,{id:e});return a.logger.info("Étudiant mis à jour avec succès",{id:e,updates:r}),i}catch(a){if(a instanceof t.AppError)throw a;throw t.errorHandler.handleError(a,{operation:"update",id:e,updates:r})}}async delete(e){return this.update(e,{status:"inactive"})}async import(e,r){try{if(!r||0===r.length)throw t.errorHandler.createValidationError("Aucun étudiant à importer","students");let{data:s}=await this.supabase.from("organizations").select("code").eq("id",e).single(),n=s?.code||"ORG",l=new Date().getFullYear().toString().slice(-2),o=await Promise.all(r.map(async r=>{if(r.student_number&&""!==r.student_number.trim())return r;let t=await i(this.supabase,"students",e,{prefix:"EDU",orgCode:n,year:l,padding:6,fieldName:"student_number"});return{...r,student_number:t}})),{data:d,error:c}=await this.supabase.from("students").insert(o).select();if(c){if("23505"===c.code)throw t.errorHandler.handleError(c,{code:t.ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,operation:"import",field:"student_number"});throw t.errorHandler.handleError(c,{operation:"import",organizationId:e,count:r.length})}return a.logger.info("Étudiants importés avec succès",{organizationId:e,count:d?.length||0}),d||[]}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"import",organizationId:e})}}};e.s(["studentService",0,l],163454)},649582,e=>{"use strict";let r=(0,e.i(475254).default)("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);e.s(["SlidersHorizontal",()=>r],649582)},794008,e=>{"use strict";let r=(0,e.i(475254).default)("File",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}]]);e.s(["File",()=>r],794008)},598203,e=>{"use strict";var r=e.i(920755);e.i(246704);var t=e.i(779478),a=e.i(790224);let s=new class{supabase;constructor(e){this.supabase=e||(0,r.createClient)()}async getAll(e,r){try{let a=r?.page||1,s=r?.limit||50,i=(a-1)*s,n=this.supabase.from("documents").select("*, students(*)",{count:"exact"}).eq("organization_id",e);r?.studentId&&(n=n.eq("student_id",r.studentId)),r?.type&&(n=n.eq("type",r.type));let{data:l,error:o,count:d}=await n.order("created_at",{ascending:!1}).range(i,i+s-1);if(o)throw t.errorHandler.handleError(o,{operation:"getAll",organizationId:e,filters:r});return{data:l||[],total:d||0,page:a,limit:s,totalPages:Math.ceil((d||0)/s)}}catch(a){if(a instanceof t.AppError)throw a;throw t.errorHandler.handleError(a,{operation:"getAll",organizationId:e,filters:r})}}async getById(e){try{let{data:r,error:a}=await this.supabase.from("documents").select("*, students(*)").eq("id",e).single();if(a){if("PGRST116"===a.code)throw t.errorHandler.handleError(a,{code:t.ErrorCode.DB_NOT_FOUND,operation:"getById",id:e});throw t.errorHandler.handleError(a,{operation:"getById",id:e})}if(!r)throw t.errorHandler.createNotFoundError(`Document avec l'ID ${e} introuvable`,{id:e});return r}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"getById",id:e})}}async create(e){try{if(!e.title)throw t.errorHandler.createValidationError("Le titre est obligatoire","title");if(!e.file_url)throw t.errorHandler.createValidationError("L'URL du fichier est obligatoire","file_url");let{data:r,error:s}=await this.supabase.from("documents").insert(e).select().single();if(s){if("23505"===s.code)throw t.errorHandler.handleError(s,{code:t.ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,operation:"create",field:"title"});throw t.errorHandler.handleError(s,{operation:"create",document:e})}return a.logger.info("Document created successfully",{id:r?.id,organizationId:e.organization_id||void 0}),r}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"create",document:e})}}async uploadFile(e,r){try{if(!e)throw t.errorHandler.createValidationError("Le fichier est obligatoire","file");if(!r)throw t.errorHandler.createValidationError("Le chemin est obligatoire","path");let{data:s,error:i}=await this.supabase.storage.from("documents").upload(r,e,{cacheControl:"3600",upsert:!1});if(i){if(i.message?.includes("already exists"))throw t.errorHandler.handleError(i,{code:t.ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,operation:"uploadFile",path:r});throw t.errorHandler.handleError(i,{operation:"uploadFile",path:r,fileName:e.name})}return a.logger.info("File uploaded successfully",{path:r,fileName:e.name,size:e.size}),s}catch(a){if(a instanceof t.AppError)throw a;throw t.errorHandler.handleError(a,{operation:"uploadFile",path:r,fileName:e?.name})}}async getPublicUrl(e){let{data:r}=this.supabase.storage.from("documents").getPublicUrl(e);return r.publicUrl}async delete(e){try{if(!e)throw t.errorHandler.createValidationError("L'ID du document est obligatoire","id");let{error:r}=await this.supabase.from("documents").delete().eq("id",e);if(r){if("23503"===r.code)throw t.errorHandler.handleError(r,{code:t.ErrorCode.DB_FOREIGN_KEY_CONSTRAINT,operation:"delete",id:e});throw t.errorHandler.handleError(r,{operation:"delete",id:e})}a.logger.info("Document deleted successfully",{id:e})}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"delete",id:e})}}};e.s(["documentService",0,s])},294918,e=>{"use strict";let r=(0,e.i(475254).default)("FileSpreadsheet",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M14 17h2",key:"10kma7"}]]);e.s(["FileSpreadsheet",()=>r],294918)},41966,e=>{"use strict";let r=(0,e.i(475254).default)("PenTool",[["path",{d:"m12 19 7-7 3 3-7 7-3-3z",key:"rklqx2"}],["path",{d:"m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z",key:"1et58u"}],["path",{d:"m2 2 7.586 7.586",key:"etlp93"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);e.s(["PenTool",()=>r],41966)},712617,e=>{"use strict";var r=e.i(843476),t=e.i(271645),a=e.i(266027),s=e.i(954616),i=e.i(912598),n=e.i(325715),l=e.i(598203),o=e.i(920755),d=e.i(163454),c=e.i(167881),u=e.i(645760),h=e.i(785817),m=e.i(107233),g=e.i(555436),b=e.i(178583),p=e.i(440160),x=e.i(569074),f=e.i(37727),y=e.i(286536),v=e.i(727612),_=e.i(794008),w=e.i(626912),N=e.i(761911),j=e.i(294918),E=e.i(475254);let I=(0,E.default)("FileOutput",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4",key:"702lig"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M2 15h10",key:"jfw4w8"}],["path",{d:"m5 12-3 3 3 3",key:"oke12k"}]]),T=(0,E.default)("FileInput",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v4",key:"702lig"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"M2 15h10",key:"jfw4w8"}],["path",{d:"m9 18 3-3-3-3",key:"112psh"}]]);var A=e.i(649582),C=e.i(263488),S=e.i(514764),k=e.i(41966),D=e.i(522016),B=e.i(647163);e.i(882205);var z=e.i(846932),R=e.i(88653),H=e.i(671428);function O(){let{user:e}=(0,n.useAuth)(),E=(0,o.createClient)(),O=(0,i.useQueryClient)(),U=(0,t.useRef)(null),[L,F]=(0,t.useState)(""),[V,q]=(0,t.useState)("all"),[P,M]=(0,t.useState)(!1),[$,G]=(0,t.useState)(!1),[Y,Q]=(0,t.useState)(null),[K,Z]=(0,t.useState)(!1),[W,X]=(0,t.useState)(!1),[J,ee]=(0,t.useState)(null),[er,et]=(0,t.useState)({to:"",subject:"",message:""}),[ea,es]=(0,t.useState)(!1),[ei,en]=(0,t.useState)({title:"",type:"other",studentId:"",file:null}),[el,eo]=(0,t.useState)(1),ed=[{value:"all",label:"Tous les documents",icon:b.FileText},{value:"attestation",label:"Attestations de scolarité",icon:w.FileCheck},{value:"certificate",label:"Certificats de formation",icon:w.FileCheck},{value:"transcript",label:"Relevés de notes",icon:b.FileText},{value:"report_card",label:"Bulletins scolaires",icon:j.FileSpreadsheet},{value:"invoice",label:"Factures",icon:I},{value:"receipt",label:"Reçus de paiement",icon:T},{value:"convocation",label:"Convocations",icon:b.FileText},{value:"contract",label:"Contrats de scolarité",icon:b.FileText}],{data:ec,isLoading:eu}=(0,a.useQuery)({queryKey:["documents",e?.organization_id,L,V,el],queryFn:async()=>{if(!e?.organization_id)return{data:[],total:0,page:1,limit:20,totalPages:0};let r=await l.documentService.getAll(e.organization_id,{type:"all"!==V?V:void 0,page:el,limit:20});if(L&&r.data){let e=r.data?.filter(e=>e.title?.toLowerCase().includes(L.toLowerCase())||e.type?.toLowerCase().includes(L.toLowerCase())||e.students?.first_name?.toLowerCase().includes(L.toLowerCase())||e.students?.last_name?.toLowerCase().includes(L.toLowerCase()))||[];return{...r,data:e,total:e.length,totalPages:Math.ceil(e.length/20)}}return r},enabled:!!e?.organization_id}),eh=ec?.data||[];ec?.total,ec?.totalPages,(0,t.useEffect)(()=>{eo(1)},[L,V]);let{data:em}=(0,a.useQuery)({queryKey:["expected-documents",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)return[];let r=new Date;r.setMonth(r.getMonth()-3);let{data:t,error:a}=await E.from("sessions").select(`
          id,
          name,
          start_date,
          end_date,
          status,
          formations!inner(
            id,
            name,
            organization_id,
            programs(id, name)
          )
        `).eq("formations.organization_id",e.organization_id).or(`status.eq.ongoing,status.eq.completed,end_date.gte.${r.toISOString().split("T")[0]}`).order("end_date",{ascending:!1});if(a)return console.error("Erreur lors de la récupération des sessions:",a),[];if(!t||0===t.length)return[];let s=[];for(let e of t){let r=e.id,t=await E.from("enrollments").select(`
            student_id,
            status,
            students!inner(id, first_name, last_name, student_number)
          `).eq("session_id",r).in("status",["confirmed","completed"]),a=t.data||null,i=t.error;if(i){console.error("Erreur lors de la récupération des inscriptions:",i);continue}if(a&&0!==a.length)for(let r of a){let t=r.students;if(!t)continue;let a=eh?.find(r=>"certificate"===r.type&&r.student_id===t.id&&r.session_id===e.id);if(s.push({id:`expected-cert-${e.id}-${t.id}`,title:`Certificat de formation - ${t.first_name} ${t.last_name}`,type:"certificate",student_id:t.id,student:{first_name:t.first_name,last_name:t.last_name,student_number:t.student_number},session_id:e.id,session_name:e.name,isGenerated:!!a,document_id:a?.id||void 0,created_at:a?.created_at||void 0}),"ongoing"===e.status||new Date(e.end_date)>=new Date){let r=eh?.find(r=>"attestation"===r.type&&r.student_id===t.id&&r.session_id===e.id);s.push({id:`expected-attest-${e.id}-${t.id}`,title:`Attestation de scolarit\xe9 - ${t.first_name} ${t.last_name}`,type:"attestation",student_id:t.id,student:{first_name:t.first_name,last_name:t.last_name,student_number:t.student_number},session_id:e.id,session_name:e.name,isGenerated:!!r,document_id:r?.id||void 0,created_at:r?.created_at||void 0})}}}return s},enabled:!!e?.organization_id}),eg=[...(eh||[]).map(e=>({...e,isExpected:!1})),...(em||[]).map(e=>({...e,isExpected:!0}))],eb="all"!==V?eg.filter(e=>e.type===V):eg,{data:ep}=(0,a.useQuery)({queryKey:["students-all",e?.organization_id],queryFn:async()=>e?.organization_id?d.studentService.getAll(e.organization_id):[],enabled:!!e?.organization_id&&P}),ex=(0,s.useMutation)({mutationFn:async e=>{await l.documentService.delete(e)},onSuccess:()=>{O.invalidateQueries({queryKey:["documents",e?.organization_id]})}}),ef=async()=>{if(!e?.organization_id||!ei.file||!ei.title)return void alert("Veuillez remplir tous les champs requis");G(!0);try{let r=ei.file.name.split(".").pop(),t=`${Date.now()}_${Math.random().toString(36).substring(7)}.${r}`,a=`${e.organization_id}/${t}`,{data:s,error:i}=await E.storage.from("documents").upload(a,ei.file,{cacheControl:"3600",upsert:!1});if(i)throw i;let{data:n}=E.storage.from("documents").getPublicUrl(a);await l.documentService.create({organization_id:e.organization_id,title:ei.title,type:ei.type,file_url:n.publicUrl,student_id:ei.studentId||void 0}),en({title:"",type:"other",studentId:"",file:null}),M(!1),U.current&&(U.current.value=""),O.invalidateQueries({queryKey:["documents",e?.organization_id]})}catch(e){console.error("Erreur lors de l'upload:",e),alert("Erreur lors de l'upload du document")}finally{G(!1)}},ey=async()=>{if(!J||!er.to)return void alert("Veuillez renseigner l'adresse email du destinataire");es(!0);try{if(!(await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:er.to,subject:er.subject,message:er.message,attachmentUrl:J.file_url,attachmentName:J.title})})).ok)throw Error("Erreur lors de l'envoi de l'email");alert("Email envoyé avec succès !"),X(!1),ee(null),et({to:"",subject:"",message:""})}catch(e){console.error("Erreur lors de l'envoi de l'email:",e),alert("Erreur lors de l'envoi de l'email")}finally{es(!1)}},ev=(0,s.useMutation)({mutationFn:async r=>{if(!r.student_id)throw Error("Ce document n'est pas lié à un étudiant");let{error:t}=await E.from("learner_documents").insert({student_id:r.student_id,document_id:r.id,title:r.title,file_url:r.file_url,type:r.type,organization_id:e?.organization_id,sent_at:new Date().toISOString()});if(t)throw t},onSuccess:()=>{alert("Document envoyé dans l'espace apprenant avec succès !")},onError:e=>{console.error("Erreur lors de l'envoi vers l'espace apprenant:",e),alert(e.message||"Erreur lors de l'envoi vers l'espace apprenant")}}),e_=e=>{let r=ed.find(r=>r.value===e);return r?.label||e},ew={total:eh.length,generated:eh.filter(e=>e.file_path).length,toGenerate:em?.filter(e=>!e.isGenerated).length||0,uploaded:eh.filter(e=>e.uploaded_by).length},eN={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5,ease:[.16,1,.3,1]}}};return(0,r.jsxs)(z.motion.div,{className:"space-y-8 p-6 pb-8 max-w-[1600px] mx-auto",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",children:[(0,r.jsxs)(z.motion.div,{variants:eN,className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"inline-flex items-center gap-3 mb-2",children:[(0,r.jsx)("div",{className:"p-2.5 bg-gradient-to-br from-brand-blue to-brand-cyan rounded-xl shadow-lg",children:(0,r.jsx)(b.FileText,{className:"h-7 w-7 text-white"})}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("h1",{className:"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-brand-blue to-brand-cyan bg-clip-text text-transparent",children:"Documents"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:"px-3 py-1 bg-gradient-to-r from-brand-blue-ghost to-brand-cyan-ghost text-brand-blue rounded-full text-sm font-medium border border-brand-blue/20",children:[eb?.length||0," total"]}),em&&em.filter(e=>!e.isGenerated).length>0&&(0,r.jsxs)("span",{className:"px-3 py-1 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-full text-sm font-bold border border-amber-600 shadow-md",children:[em.filter(e=>!e.isGenerated).length," à générer"]})]})]})]}),(0,r.jsx)("p",{className:"text-gray-600 text-sm lg:text-base ml-1",children:"Gérez, générez et organisez tous vos documents administratifs"})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,r.jsx)(D.default,{href:"/dashboard/settings/document-templates",children:(0,r.jsxs)(c.Button,{variant:"outline",className:"hover:bg-brand-blue-ghost hover:border-brand-blue/30 hover:text-brand-blue transition-all",children:[(0,r.jsx)(b.FileText,{className:"mr-2 h-4 w-4"}),"Templates"]})}),(0,r.jsxs)(c.Button,{onClick:()=>M(!0),variant:"outline",className:"hover:bg-brand-cyan-ghost hover:border-brand-cyan/30 hover:text-brand-cyan transition-all",children:[(0,r.jsx)(x.Upload,{className:"mr-2 h-4 w-4"}),"Uploader"]}),(0,r.jsx)(D.default,{href:"/dashboard/documents/generate",children:(0,r.jsxs)(c.Button,{variant:"outline",className:"hover:bg-brand-blue-ghost hover:border-brand-blue/30 hover:text-brand-blue transition-all",children:[(0,r.jsx)(m.Plus,{className:"mr-2 h-4 w-4"}),"Générer"]})}),(0,r.jsx)(D.default,{href:"/dashboard/documents/generate-batch",children:(0,r.jsxs)(c.Button,{className:"bg-gradient-to-r from-brand-blue to-brand-cyan hover:from-brand-blue-dark hover:to-brand-cyan shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",children:[(0,r.jsx)(N.Users,{className:"mr-2 h-4 w-4"}),"Génération en masse"]})})]})]}),(0,r.jsx)(h.BentoGrid,{columns:4,gap:"md",children:[{title:"Total Documents",value:ew.total,icon:b.FileText,color:"text-brand-blue",bg:"bg-gradient-to-br from-brand-blue-ghost to-brand-blue-ghost/50",borderColor:"border-brand-blue/20",desc:"Documents existants"},{title:"Documents Générés",value:ew.generated,icon:w.FileCheck,color:"text-brand-cyan",bg:"bg-gradient-to-br from-brand-cyan-ghost to-brand-cyan-ghost/50",borderColor:"border-brand-cyan/20",desc:"Depuis les templates"},{title:"À Générer",value:ew.toGenerate,icon:I,color:"text-amber-600",bg:"bg-gradient-to-br from-amber-50 to-amber-100/50",borderColor:"border-amber-200",desc:"Documents attendus",urgent:ew.toGenerate>0},{title:"Uploadés",value:ew.uploaded,icon:x.Upload,color:"text-brand-blue",bg:"bg-gradient-to-br from-brand-blue-ghost to-brand-blue-ghost/50",borderColor:"border-brand-blue/20",desc:"Importés manuellement"}].map((e,t)=>(0,r.jsx)(h.BentoCard,{span:1,className:"min-w-[200px]",children:(0,r.jsxs)(u.GlassCard,{variant:"premium",hoverable:!0,className:(0,B.cn)("h-full p-5 border-2 transition-all duration-300",e.borderColor),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,r.jsx)(z.motion.div,{className:(0,B.cn)("p-2.5 rounded-xl transition-all duration-300 border",e.bg,e.borderColor),whileHover:{scale:1.1,rotate:5},children:(0,r.jsx)(e.icon,{className:(0,B.cn)("h-5 w-5",e.color)})}),(0,r.jsx)("span",{className:(0,B.cn)("text-2xl font-bold",0===t||3===t?"text-brand-blue":1===t?"text-brand-cyan":"text-amber-600"),children:e.value})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-900",children:e.title}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:e.desc})]})]})},e.title))}),(0,r.jsx)(z.motion.div,{variants:eN,children:(0,r.jsxs)(u.GlassCard,{variant:"default",className:"p-2 border-2 border-brand-blue/20 bg-gradient-to-br from-brand-blue-ghost/20 to-brand-cyan-ghost/20",children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row gap-2",children:[(0,r.jsxs)("div",{className:"relative flex-1 group",children:[(0,r.jsx)(g.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-brand-blue group-focus-within:text-brand-cyan transition-colors"}),(0,r.jsx)("input",{type:"text",placeholder:"Rechercher un document...",value:L,onChange:e=>F(e.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-lg bg-white border-2 border-brand-blue/20 focus:border-brand-blue focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm"})]}),(0,r.jsxs)(c.Button,{variant:"ghost",onClick:()=>Z(!K),className:(0,B.cn)("gap-2 transition-all",K?"bg-gradient-to-r from-brand-blue-ghost to-brand-cyan-ghost text-brand-blue border-2 border-brand-blue/30":"text-gray-600 hover:bg-brand-blue-ghost hover:text-brand-blue"),children:[(0,r.jsx)(A.SlidersHorizontal,{className:"h-4 w-4"}),"Filtres","all"!==V&&(0,r.jsx)("span",{className:"w-5 h-5 bg-gradient-to-r from-brand-blue to-brand-cyan text-white text-[10px] font-bold flex items-center justify-center rounded-full ml-1",children:"!"})]})]}),(0,r.jsx)(R.AnimatePresence,{children:K&&(0,r.jsx)(z.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:(0,r.jsx)("div",{className:"p-4 border-t border-brand-blue/20 mt-2",children:(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsx)("label",{className:"text-xs font-semibold text-brand-blue uppercase tracking-wider",children:"Type de document"}),(0,r.jsx)("select",{value:V,onChange:e=>q(e.target.value),className:"w-full px-3 py-2 rounded-lg bg-white border-2 border-brand-blue/20 focus:border-brand-blue focus:ring-4 focus:ring-brand-blue/10 outline-none text-sm transition-all",children:ed.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))})]})})})})]})}),(0,r.jsx)(z.motion.div,{variants:eN,children:eu?(0,r.jsx)(H.SkeletonList,{count:5}):eh&&eh.length>0?(0,r.jsx)(u.GlassCard,{variant:"default",className:"overflow-hidden p-0 border-2 border-brand-blue/10 bg-gradient-to-br from-white to-brand-blue-ghost/5",children:(0,r.jsx)("div",{className:"divide-y divide-brand-blue/10",children:eh.map(e=>{var t;let a,s=(t=e.type,a=ed.find(e=>e.value===t),a?.icon||b.FileText);return(0,r.jsxs)(z.motion.div,{initial:{opacity:0},whileInView:{opacity:1},viewport:{once:!0},className:"p-4 hover:bg-gradient-to-r hover:from-brand-blue-ghost/30 hover:to-brand-cyan-ghost/20 transition-all duration-300 flex items-center justify-between group",children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,r.jsx)(z.motion.div,{whileHover:{scale:1.05,rotate:3},className:"h-12 w-12 rounded-xl bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost flex items-center justify-center text-brand-blue border border-brand-blue/20 shadow-sm",children:(0,r.jsx)(s,{className:"h-6 w-6"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("h3",{className:"font-bold text-gray-900 truncate group-hover:text-brand-blue transition-colors",children:e.title}),(0,r.jsx)("span",{className:"px-2.5 py-0.5 text-xs bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost text-brand-blue rounded-lg font-semibold uppercase tracking-wide border border-brand-blue/20",children:e_(e.type)})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.students&&(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)(N.Users,{className:"h-3.5 w-3.5 text-brand-cyan"}),(0,r.jsxs)("span",{className:"font-medium text-gray-700",children:[e.students.first_name," ",e.students.last_name]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsx)(b.FileText,{className:"h-3.5 w-3.5 text-brand-blue"}),(0,r.jsxs)("span",{className:"font-medium",children:["Généré le ",(0,B.formatDate)(e.created_at)]})]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.file_url&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(D.default,{href:`/dashboard/documents/${e.id}`,children:(0,r.jsxs)(c.Button,{variant:"ghost",size:"sm",className:"text-gray-600 hover:text-brand-blue hover:bg-brand-blue-ghost transition-all",children:[(0,r.jsx)(y.Eye,{className:"mr-2 h-4 w-4"}),"Voir"]})}),(0,r.jsx)("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",download:!0,children:(0,r.jsxs)(c.Button,{variant:"ghost",size:"sm",className:"text-gray-600 hover:text-brand-cyan hover:bg-brand-cyan-ghost transition-all",children:[(0,r.jsx)(p.Download,{className:"mr-2 h-4 w-4"}),"Télécharger"]})}),(0,r.jsx)(D.default,{href:`/dashboard/documents/${e.id}/sign`,children:(0,r.jsxs)(c.Button,{variant:"ghost",size:"sm",className:"text-gray-600 hover:text-purple-600 hover:bg-purple-50 transition-all",children:[(0,r.jsx)(k.PenTool,{className:"mr-2 h-4 w-4"}),"Signer"]})}),(0,r.jsxs)(c.Button,{variant:"ghost",size:"sm",onClick:()=>{let r;return ee(e),r=e.students?.email||"",void(et({to:r,subject:`${e_(e.type)} - ${e.title}`,message:`Bonjour ${e.students?.first_name||""} ${e.students?.last_name||""},

Veuillez trouver ci-joint votre ${e_(e.type).toLowerCase()}.

Cordialement,
L'\xe9quipe EDUZEN`}),X(!0))},className:"text-gray-600 hover:text-brand-blue hover:bg-brand-blue-ghost transition-all",children:[(0,r.jsx)(C.Mail,{className:"mr-2 h-4 w-4"}),"Email"]}),e.student_id&&(0,r.jsxs)(c.Button,{variant:"ghost",size:"sm",onClick:()=>ev.mutate(e),disabled:ev.isPending,className:"text-gray-600 hover:text-brand-cyan hover:bg-brand-cyan-ghost transition-all",children:[(0,r.jsx)(S.Send,{className:"mr-2 h-4 w-4"}),"Espace"]})]}),(0,r.jsx)(c.Button,{variant:"ghost",size:"icon",onClick:()=>{confirm("Êtes-vous sûr de vouloir supprimer ce document ?")&&ex.mutate(e.id)},className:"text-gray-400 hover:text-red-600 hover:bg-red-50 transition-all",children:(0,r.jsx)(v.Trash2,{className:"h-4 w-4"})})]})]},e.id)})})}):(0,r.jsxs)(u.GlassCard,{variant:"default",className:"p-12 text-center border-2 border-brand-blue/20 bg-gradient-to-br from-brand-blue-ghost/30 to-brand-cyan-ghost/30",children:[(0,r.jsxs)("div",{className:"relative inline-block mb-6",children:[(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)("div",{className:"w-24 h-24 bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost rounded-full opacity-50 blur-2xl"})}),(0,r.jsx)("div",{className:"relative p-6 bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost rounded-2xl inline-block",children:(0,r.jsx)(b.FileText,{className:"h-16 w-16 mx-auto text-brand-blue"})})]}),(0,r.jsxs)("div",{className:"space-y-2 mb-6",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:"Aucun document trouvé"}),(0,r.jsx)("p",{className:"text-gray-600",children:L||"all"!==V?"Aucun document ne correspond à vos critères.":"Commencez par générer ou uploader votre premier document."})]}),!L&&"all"===V&&(0,r.jsx)(D.default,{href:"/dashboard/documents/generate",children:(0,r.jsxs)(c.Button,{className:"bg-gradient-to-r from-brand-blue to-brand-cyan hover:from-brand-blue-dark hover:to-brand-cyan shadow-md hover:shadow-lg transition-all",children:[(0,r.jsx)(m.Plus,{className:"mr-2 h-4 w-4"}),"Générer un document"]})})]})}),(0,r.jsx)(R.AnimatePresence,{children:P&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,r.jsxs)(z.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-6 border-b border-gray-100 flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Uploader un document"}),(0,r.jsx)(c.Button,{variant:"ghost",size:"icon",onClick:()=>{M(!1),en({title:"",type:"other",studentId:"",file:null})},children:(0,r.jsx)(f.X,{className:"h-5 w-5"})})]}),(0,r.jsxs)("div",{className:"p-6 space-y-6 max-h-[80vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Titre du document *"}),(0,r.jsx)("input",{type:"text",value:ei.title,onChange:e=>en(r=>({...r,title:e.target.value})),className:"w-full px-4 py-2.5 rounded-lg border border-gray-200 focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue outline-none transition-all",placeholder:"Ex: Certificat de formation"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Type de document *"}),(0,r.jsxs)("select",{value:ei.type,onChange:e=>en(r=>({...r,type:e.target.value})),className:"w-full px-4 py-2.5 rounded-lg border border-gray-200 focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue outline-none transition-all",children:[ed.filter(e=>"all"!==e.value).map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value)),(0,r.jsx)("option",{value:"other",children:"Autre"})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Étudiant (optionnel)"}),(0,r.jsxs)("select",{value:ei.studentId||"",onChange:e=>en(r=>({...r,studentId:e.target.value||void 0})),className:"w-full px-4 py-2.5 rounded-lg border border-gray-200 focus:ring-2 focus:ring-brand-blue/20 focus:border-brand-blue outline-none transition-all",children:[(0,r.jsx)("option",{value:"",children:"Aucun étudiant spécifique"}),ep?.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.first_name," ",e.last_name]},e.id))]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Fichier *"}),(0,r.jsxs)("div",{className:(0,B.cn)("border-2 border-dashed rounded-xl p-8 text-center transition-all cursor-pointer hover:border-brand-blue hover:bg-brand-blue-ghost/10",ei.file?"border-success-primary bg-success-bg/10":"border-gray-300"),onClick:()=>!ei.file&&U.current?.click(),children:[(0,r.jsx)("input",{ref:U,type:"file",onChange:e=>{let r=e.target.files?.[0];r&&en(e=>({...e,file:r}))},accept:".pdf,.jpg,.jpeg,.png,.gif,.doc,.docx,.xls,.xlsx",className:"hidden"}),ei.file?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-success-bg rounded-full flex items-center justify-center mx-auto",children:(0,r.jsx)(w.FileCheck,{className:"h-6 w-6 text-success-primary"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:ei.file.name}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[(ei.file.size/1024/1024).toFixed(2)," MB"]})]}),(0,r.jsx)(c.Button,{variant:"outline",size:"sm",onClick:e=>{e.stopPropagation(),en(e=>({...e,file:null})),U.current&&(U.current.value="")},className:"mt-2",children:"Changer de fichier"})]}):(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto group-hover:bg-brand-blue-ghost group-hover:text-brand-blue transition-colors",children:(0,r.jsx)(x.Upload,{className:"h-6 w-6 text-gray-400 group-hover:text-brand-blue"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-gray-900",children:"Cliquez pour sélectionner un fichier"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"PDF, Images, Word, Excel (max 10MB)"})]})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-100",children:[(0,r.jsx)(c.Button,{variant:"ghost",onClick:()=>{M(!1),en({title:"",type:"other",studentId:"",file:null})},children:"Annuler"}),(0,r.jsx)(c.Button,{onClick:ef,disabled:$||!ei.file||!ei.title,className:"shadow-lg shadow-brand-blue/20",children:$?"Upload en cours...":"Uploader"})]})]})]})})}),(0,r.jsx)(R.AnimatePresence,{children:W&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,r.jsxs)(z.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden",children:[(0,r.jsxs)("div",{className:"p-6 border-b border-gray-100 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-2 bg-blue-50 rounded-lg",children:(0,r.jsx)(C.Mail,{className:"h-5 w-5 text-blue-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Envoyer par email"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:J?.title})]})]}),(0,r.jsx)(c.Button,{variant:"ghost",size:"icon",onClick:()=>{X(!1),ee(null),et({to:"",subject:"",message:""})},children:(0,r.jsx)(f.X,{className:"h-5 w-5"})})]}),(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Destinataire *"}),(0,r.jsx)("input",{type:"email",value:er.to,onChange:e=>et(r=>({...r,to:e.target.value})),className:"w-full px-4 py-2.5 rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",placeholder:"email@example.com"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Objet *"}),(0,r.jsx)("input",{type:"text",value:er.subject,onChange:e=>et(r=>({...r,subject:e.target.value})),className:"w-full px-4 py-2.5 rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all",placeholder:"Objet de l'email"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Message"}),(0,r.jsx)("textarea",{value:er.message,onChange:e=>et(r=>({...r,message:e.target.value})),rows:6,className:"w-full px-4 py-2.5 rounded-lg border border-gray-200 focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 outline-none transition-all resize-none",placeholder:"Votre message..."})]}),J?.file_url&&(0,r.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)(b.FileText,{className:"h-5 w-5 text-gray-400"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Pièce jointe"}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:J.title})]})]})}),(0,r.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-100",children:[(0,r.jsx)(c.Button,{variant:"ghost",onClick:()=>{X(!1),ee(null),et({to:"",subject:"",message:""})},children:"Annuler"}),(0,r.jsx)(c.Button,{onClick:ey,disabled:ea||!er.to||!er.subject,className:"bg-blue-600 hover:bg-blue-700 shadow-lg shadow-blue-600/20",children:ea?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"animate-spin mr-2",children:"⏳"}),"Envoi en cours..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(C.Mail,{className:"mr-2 h-4 w-4"}),"Envoyer"]})})]})]})]})})}),(0,r.jsx)(R.AnimatePresence,{children:Y&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,r.jsxs)(z.motion.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"w-full max-w-5xl h-[90vh] bg-white rounded-2xl shadow-2xl overflow-hidden flex flex-col",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-100 flex items-center justify-between bg-gray-50/50",children:[(0,r.jsx)("h3",{className:"font-bold text-gray-900",children:Y.title}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[Y.file_url&&(0,r.jsx)("a",{href:Y.file_url,target:"_blank",rel:"noopener noreferrer",download:!0,children:(0,r.jsxs)(c.Button,{variant:"outline",size:"sm",children:[(0,r.jsx)(p.Download,{className:"mr-2 h-4 w-4"}),"Télécharger"]})}),(0,r.jsx)(c.Button,{variant:"ghost",size:"icon",onClick:()=>Q(null),children:(0,r.jsx)(f.X,{className:"h-5 w-5"})})]})]}),(0,r.jsx)("div",{className:"flex-1 bg-gray-100 p-4 overflow-auto flex items-center justify-center",children:Y.file_url&&(0,r.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:Y.file_url.toLowerCase().endsWith(".pdf")?(0,r.jsx)("iframe",{src:Y.file_url,className:"w-full h-full rounded-lg shadow-lg bg-white",title:"Prévisualisation PDF"}):["jpg","jpeg","png","gif","webp"].some(e=>Y.file_url?.toLowerCase().endsWith(`.${e}`))?(0,r.jsx)("img",{src:Y.file_url,alt:Y.title,className:"max-w-full max-h-full rounded-lg shadow-lg object-contain"}):(0,r.jsxs)("div",{className:"text-center p-12 bg-white rounded-2xl shadow-sm max-w-md",children:[(0,r.jsx)("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,r.jsx)(_.File,{className:"h-10 w-10 text-gray-400"})}),(0,r.jsx)("h4",{className:"text-xl font-bold text-gray-900 mb-2",children:"Aperçu non disponible"}),(0,r.jsx)("p",{className:"text-gray-500 mb-6",children:"Ce type de fichier ne peut pas être prévisualisé directement."}),(0,r.jsx)("a",{href:Y.file_url,target:"_blank",rel:"noopener noreferrer",download:!0,children:(0,r.jsxs)(c.Button,{className:"shadow-lg shadow-brand-blue/20",children:[(0,r.jsx)(p.Download,{className:"mr-2 h-4 w-4"}),"Télécharger pour voir"]})})]})})})]})})})]})}e.s(["default",()=>O],712617)}]);