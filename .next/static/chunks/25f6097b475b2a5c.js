(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},286536,e=>{"use strict";let t=(0,e.i(475254).default)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],286536)},870273,e=>{"use strict";let t=(0,e.i(475254).default)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);e.s(["Star",()=>t],870273)},790597,e=>{"use strict";let t=(0,e.i(475254).default)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);e.s(["Heart",()=>t],790597)},527985,e=>{"use strict";var t=e.i(920755);let a=new class{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async getCategories(e,t=!0){let a=this.supabase.from("documentation_categories").select("*").order("order_index",{ascending:!0});e?a=a.or(`organization_id.eq.${e},is_public.eq.true`):t&&(a=a.eq("is_public",!0));let{data:i,error:s}=await a;if(s)throw s;return i}async getCategoryBySlug(e,t){let a=this.supabase.from("documentation_categories").select("*").eq("slug",e).single();a=t?a.or(`organization_id.eq.${t},is_public.eq.true`):a.eq("is_public",!0);let{data:i,error:s}=await a;if(s)throw s;return i}async createCategory(e){let{data:t,error:a}=await this.supabase.from("documentation_categories").insert(e).select().single();if(a)throw a;return t}async updateCategory(e,t){let{data:a,error:i}=await this.supabase.from("documentation_categories").update(t).eq("id",e).select().single();if(i)throw i;return a}async deleteCategory(e){let{error:t}=await this.supabase.from("documentation_categories").delete().eq("id",e);if(t)throw t}async getArticlesByCategory(e,t="published"){let{data:a,error:i}=await this.supabase.from("documentation_articles").select("*, author:users(id, full_name, email)").eq("category_id",e).eq("status",t).order("order_index",{ascending:!0}).order("published_at",{ascending:!1});if(i)throw i;return a}async getArticleBySlug(e,t){let{data:a,error:i}=await this.supabase.from("documentation_articles").select(`
        *,
        category:documentation_categories(*),
        sections:documentation_sections(*),
        author:users(id, full_name, email)
      `).eq("slug",e).eq("category.slug",t).eq("status","published").single();if(i)throw i;return a&&await this.supabase.rpc("increment_article_view_count",{article_uuid:a.id}),a}async searchArticles(e,t){let a=this.supabase.from("documentation_articles").select("*, category:documentation_categories(*), author:users(id, full_name)").eq("status","published").or(`title.ilike.%${e}%,content.ilike.%${e}%,excerpt.ilike.%${e}%`);a=t?a.or(`organization_id.eq.${t},category.is_public.eq.true`):a.eq("category.is_public",!0);let{data:i,error:s}=await a.order("view_count",{ascending:!1}).limit(50);if(s)throw s;return i}async getPopularArticles(e=10,t){let a=this.supabase.from("documentation_articles").select("*, category:documentation_categories(*), author:users(id, full_name)").eq("status","published").order("view_count",{ascending:!1}).limit(e);a=t?a.or(`organization_id.eq.${t},category.is_public.eq.true`):a.eq("category.is_public",!0);let{data:i,error:s}=await a;if(s)throw s;return i}async getRecentArticles(e=10,t){let a=this.supabase.from("documentation_articles").select("*, category:documentation_categories(*), author:users(id, full_name)").eq("status","published").order("published_at",{ascending:!1}).limit(e);a=t?a.or(`organization_id.eq.${t},category.is_public.eq.true`):a.eq("category.is_public",!0);let{data:i,error:s}=await a;if(s)throw s;return i}async getFeaturedArticles(e=5,t){let a=this.supabase.from("documentation_articles").select("*, category:documentation_categories(*), author:users(id, full_name)").eq("status","published").eq("is_featured",!0).order("published_at",{ascending:!1}).limit(e);a=t?a.or(`organization_id.eq.${t},category.is_public.eq.true`):a.eq("category.is_public",!0);let{data:i,error:s}=await a;if(s)throw s;return i}async createArticle(e){let{data:t,error:a}=await this.supabase.from("documentation_articles").insert(e).select().single();if(a)throw a;return t}async updateArticle(e,t){let{data:a,error:i}=await this.supabase.from("documentation_articles").update(t).eq("id",e).select().single();if(i)throw i;return a}async deleteArticle(e){let{error:t}=await this.supabase.from("documentation_articles").delete().eq("id",e);if(t)throw t}async getArticleSections(e){let{data:t,error:a}=await this.supabase.from("documentation_sections").select("*").eq("article_id",e).order("order_index",{ascending:!0});if(a)throw a;return t}async createSection(e){let{data:t,error:a}=await this.supabase.from("documentation_sections").insert(e).select().single();if(a)throw a;return t}async updateSection(e,t){let{data:a,error:i}=await this.supabase.from("documentation_sections").update(t).eq("id",e).select().single();if(i)throw i;return a}async deleteSection(e){let{error:t}=await this.supabase.from("documentation_sections").delete().eq("id",e);if(t)throw t}async getUserFavorites(e){let{data:t,error:a}=await this.supabase.from("documentation_favorites").select("*, article:documentation_articles(*, category:documentation_categories(*))").eq("user_id",e).order("created_at",{ascending:!1});if(a)throw a;return t}async addFavorite(e,t){let{data:a,error:i}=await this.supabase.from("documentation_favorites").insert({user_id:e,article_id:t}).select().single();if(i)throw i;return a}async removeFavorite(e,t){let{error:a}=await this.supabase.from("documentation_favorites").delete().eq("user_id",e).eq("article_id",t);if(a)throw a}async isFavorite(e,t){let{data:a,error:i}=await this.supabase.from("documentation_favorites").select("id").eq("user_id",e).eq("article_id",t).maybeSingle();if(i)throw i;return!!a}async getUserNotes(e,t){let{data:a,error:i}=await this.supabase.from("documentation_notes").select("*").eq("user_id",e).eq("article_id",t).order("created_at",{ascending:!1}).maybeSingle();if(i)throw i;return a}async upsertNote(e,t,a){let i=await this.getUserNotes(e,t);if(i){let{data:e,error:t}=await this.supabase.from("documentation_notes").update({content:a}).eq("id",i.id).select().single();if(t)throw t;return e}{let{data:i,error:s}=await this.supabase.from("documentation_notes").insert({user_id:e,article_id:t,content:a}).select().single();if(s)throw s;return i}}async deleteNote(e,t){let{error:a}=await this.supabase.from("documentation_notes").delete().eq("user_id",e).eq("article_id",t);if(a)throw a}async createFeedback(e){let{data:t,error:a}=await this.supabase.from("documentation_feedback").insert(e).select().single();if(a)throw a;return t}async getArticleFeedback(e){let{data:t,error:a}=await this.supabase.from("documentation_feedback").select("*, user:users(id, full_name)").eq("article_id",e).order("created_at",{ascending:!1});if(a)throw a;return t}async getArticleFeedbackStats(e){let{data:t,error:a}=await this.supabase.from("documentation_feedback").select("rating, is_helpful").eq("article_id",e);if(a)throw a;let i={total:t.length,averageRating:0,helpfulCount:0,notHelpfulCount:0,ratings:{1:0,2:0,3:0,4:0,5:0}};if(t.length>0){let e=t.filter(e=>e.rating).map(e=>e.rating);e.length>0&&(i.averageRating=e.reduce((e,t)=>e+t,0)/e.length),t.forEach(e=>{e.rating&&i.ratings[e.rating]++,!0===e.is_helpful&&i.helpfulCount++,!1===e.is_helpful&&i.notHelpfulCount++})}return i}async recordSearch(e,t,a){let{error:i}=await this.supabase.from("documentation_search_history").insert({user_id:e,query:t,results_count:a});if(i)throw i}async getSearchHistory(e,t=10){let{data:a,error:i}=await this.supabase.from("documentation_search_history").select("*").eq("user_id",e).order("created_at",{ascending:!1}).limit(t);if(i)throw i;return a}async clearSearchHistory(e){let{error:t}=await this.supabase.from("documentation_search_history").delete().eq("user_id",e);if(t)throw t}};e.s(["documentationService",0,a])},400417,e=>{"use strict";let t=(0,e.i(475254).default)("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]);e.s(["ThumbsUp",()=>t],400417)},365582,e=>{"use strict";let t=(0,e.i(475254).default)("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);e.s(["ThumbsDown",()=>t],365582)},213228,e=>{"use strict";var t=e.i(843476),a=e.i(271645),i=e.i(618566),s=e.i(266027),r=e.i(954616),n=e.i(325715),o=e.i(527985),l=e.i(970065),c=e.i(167881),d=e.i(184762),u=e.i(10708),h=e.i(871689),m=e.i(870273),f=e.i(790597),p=e.i(400417),g=e.i(365582),_=e.i(286536),y=e.i(522016),b=e.i(918789),w=e.i(716158);function x(){let e=(0,i.useParams)(),x=e.categorySlug,v=e.articleSlug,{user:j}=(0,n.useAuth)(),[q,S]=(0,a.useState)(null),[C,N]=(0,a.useState)(""),[k,A]=(0,a.useState)(null),{data:F}=(0,s.useQuery)({queryKey:["documentation-article",x,v],queryFn:async()=>await o.documentationService.getArticleBySlug(v,x),enabled:!!x&&!!v}),{data:T}=(0,s.useQuery)({queryKey:["documentation-favorite",j?.id,F?.id],queryFn:()=>o.documentationService.isFavorite(j?.id||"",F?.id||""),enabled:!!j?.id&&!!F?.id}),{data:H}=(0,s.useQuery)({queryKey:["documentation-feedback-stats",F?.id],queryFn:()=>o.documentationService.getArticleFeedbackStats(F?.id||""),enabled:!!F?.id}),z=(0,r.useMutation)({mutationFn:async()=>{j?.id&&F?.id&&(T?await o.documentationService.removeFavorite(j.id,F.id):await o.documentationService.addFavorite(j.id,F.id))},onSuccess:()=>{window.location.reload()}}),B=(0,r.useMutation)({mutationFn:async()=>{if(!j?.id||!F?.id)return;let e=await fetch("/api/documentation/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({article_id:F.id,rating:q,comment:C,is_helpful:k})});if(!e.ok)throw Error("Erreur lors de l'envoi du feedback");return e.json()},onSuccess:()=>{S(null),N(""),A(null),alert("Merci pour votre feedback !")}});return(0,t.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-4xl",children:[(0,t.jsx)("div",{className:"mb-6",children:(0,t.jsx)(y.default,{href:`/dashboard/documentation/category/${x}`,children:(0,t.jsxs)(c.Button,{variant:"ghost",size:"sm",className:"mb-4",children:[(0,t.jsx)(h.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour à la catégorie"]})})}),F&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.Card,{className:"mb-6",children:(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(l.CardTitle,{className:"text-3xl mb-2",children:F.title}),F.excerpt&&(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:F.excerpt}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(_.Eye,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:[F.view_count," vues"]})]}),F.author&&(0,t.jsxs)("span",{children:["Par ",F.author.full_name||F.author.email]}),F.published_at&&(0,t.jsxs)("span",{children:["Publié le ",new Date(F.published_at).toLocaleDateString("fr-FR")]})]})]}),(0,t.jsxs)(c.Button,{variant:"outline",size:"sm",onClick:()=>z.mutate(),disabled:z.isPending,children:[(0,t.jsx)(f.Heart,{className:`h-4 w-4 mr-2 ${T?"fill-red-500 text-red-500":""}`}),T?"Retirer des favoris":"Ajouter aux favoris"]})]})})}),(0,t.jsx)(l.Card,{className:"mb-6",children:(0,t.jsx)(l.CardContent,{className:"pt-6",children:(0,t.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,t.jsx)(b.default,{children:F.content})})})}),F.sections&&F.sections.length>0&&(0,t.jsx)("div",{className:"space-y-6 mb-6",children:F.sections.map(e=>(0,t.jsxs)(l.Card,{children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsx)(l.CardTitle,{children:e.title})}),(0,t.jsx)(l.CardContent,{children:(0,t.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,t.jsx)(b.default,{children:e.content})})})]},e.id))}),(0,t.jsxs)(l.Card,{className:"mb-6",children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsx)(l.CardTitle,{children:"Votre avis"})}),(0,t.jsxs)(l.CardContent,{children:[(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(q||C||null!==k)&&B.mutate()},className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{children:"Note (optionnel)"}),(0,t.jsxs)(w.Select,{value:q?.toString()||"",onValueChange:e=>S(parseInt(e)),children:[(0,t.jsx)(w.SelectTrigger,{children:(0,t.jsx)(w.SelectValue,{placeholder:"Sélectionner une note"})}),(0,t.jsx)(w.SelectContent,{children:[1,2,3,4,5].map(e=>(0,t.jsxs)(w.SelectItem,{value:e.toString(),children:[e," étoile",e>1?"s":""]},e))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{children:"Commentaire (optionnel)"}),(0,t.jsx)(d.Textarea,{value:C,onChange:e=>N(e.target.value),placeholder:"Partagez votre avis...",rows:4})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{children:"Cet article vous a-t-il été utile ?"}),(0,t.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,t.jsxs)(c.Button,{type:"button",variant:!0===k?"default":"outline",onClick:()=>A(!0),children:[(0,t.jsx)(p.ThumbsUp,{className:"h-4 w-4 mr-2"}),"Oui"]}),(0,t.jsxs)(c.Button,{type:"button",variant:!1===k?"default":"outline",onClick:()=>A(!1),children:[(0,t.jsx)(g.ThumbsDown,{className:"h-4 w-4 mr-2"}),"Non"]})]})]}),(0,t.jsx)(c.Button,{type:"submit",disabled:B.isPending,children:"Envoyer le feedback"})]}),H&&H.total>0&&(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t",children:[(0,t.jsx)("h3",{className:"font-semibold mb-2",children:"Avis des utilisateurs"}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)(m.Star,{className:"h-5 w-5 text-yellow-500 fill-yellow-500"}),(0,t.jsxs)("span",{className:"font-semibold",children:[H.averageRating.toFixed(1)," / 5"]}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["(",H.total," avis)"]})]}),(0,t.jsxs)("div",{className:"text-sm text-muted-foreground",children:[H.helpfulCount," personne",H.helpfulCount>1?"s":""," ","ont trouvé cet article utile"]})]})]})]})]})]})}e.s(["default",()=>x])}]);