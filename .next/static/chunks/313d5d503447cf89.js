(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},503116,e=>{"use strict";let t=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],503116)},645760,e=>{"use strict";var t=e.i(843476),r=e.i(271645),s=e.i(647163);e.i(882205);var a=e.i(846932);let i=r.forwardRef(({className:e,variant:r="default",hoverable:i=!1,glow:n=!1,glowColor:l="rgba(51, 90, 207, 0.3)",...o},c)=>(0,t.jsxs)(a.motion.div,{ref:c,className:(0,s.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===r,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===r,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===r,"cursor-pointer":i,"hover:shadow-2xl hover:scale-[1.02]":i,"hover:bg-white/90 dark:hover:bg-gray-900/90":i},e),whileHover:i?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...o,children:[n&&(0,t.jsx)(a.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${l} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,t.jsx)("div",{className:"relative z-10",children:o.children})]}));i.displayName="GlassCard",e.s(["GlassCard",()=>i])},225913,e=>{"use strict";var t=e.i(207670);let r=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,s=t.clsx;e.s(["cva",0,(e,t)=>a=>{var i;if((null==t?void 0:t.variants)==null)return s(e,null==a?void 0:a.class,null==a?void 0:a.className);let{variants:n,defaultVariants:l}=t,o=Object.keys(n).map(e=>{let t=null==a?void 0:a[e],s=null==l?void 0:l[e];if(null===t)return null;let i=r(t)||r(s);return n[e][i]}),c=a&&Object.entries(a).reduce((e,t)=>{let[r,s]=t;return void 0===s||(e[r]=s),e},{});return s(e,o,null==t||null==(i=t.compoundVariants)?void 0:i.reduce((e,t)=>{let{class:r,className:s,...a}=t;return Object.entries(a).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...l,...c}[t]):({...l,...c})[t]===r})?[...e,r,s]:e},[]),null==a?void 0:a.class,null==a?void 0:a.className)}])},994179,e=>{"use strict";var t=e.i(843476),r=e.i(225913),s=e.i(647163);let a=(0,r.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground border-border hover:bg-accent hover:text-accent-foreground",success:"border-transparent bg-success-primary text-white shadow hover:bg-brand-blue-dark",warning:"border-transparent bg-warning-primary text-white shadow hover:bg-brand-cyan-dark",premium:"border-transparent bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white shadow-lg shadow-purple-500/50 hover:shadow-xl hover:shadow-purple-500/60",glass:"border-white/20 bg-white/10 backdrop-blur-md text-foreground shadow-lg"},size:{default:"px-2.5 py-0.5 text-xs",sm:"px-2 py-0.5 text-xs",lg:"px-3 py-1 text-sm"}},defaultVariants:{variant:"default",size:"default"}});function i({className:e,variant:r,size:i,dot:n,pulse:l,children:o,...c}){return(0,t.jsxs)("div",{className:(0,s.cn)(a({variant:r,size:i}),e),...c,children:[n&&(0,t.jsx)("span",{className:(0,s.cn)("mr-1.5 h-1.5 w-1.5 rounded-full","success"===r&&"bg-white/80","warning"===r&&"bg-white/80","default"===r&&"bg-white/80",l&&"animate-pulse")}),o]})}e.s(["Badge",()=>i])},738308,e=>{"use strict";let t=(0,e.i(475254).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],738308)},972520,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);e.s(["ArrowRight",()=>t],972520)},367240,e=>{"use strict";let t=(0,e.i(475254).default)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);e.s(["RotateCcw",()=>t],367240)},986619,e=>{"use strict";var t=e.i(843476),r=e.i(266027),s=e.i(912598),a=e.i(383801),i=e.i(267824),n=e.i(645760),l=e.i(167881),o=e.i(994179),c=e.i(6799);e.i(882205);var d=e.i(846932),u=e.i(88653),x=e.i(354385),m=e.i(503116),h=e.i(465286),p=e.i(738308),g=e.i(871689),b=e.i(972520),f=e.i(898791),y=e.i(842009),v=e.i(367240),w=e.i(215186),j=e.i(522016),N=e.i(618566),C=e.i(271645),k=e.i(790224);function _(){let e,_=(0,N.useParams)();(0,N.useRouter)();let q=_.quizId,{student:A,studentId:z}=(0,a.useLearnerContext)(),S=(0,C.useMemo)(()=>z?(0,i.createLearnerClient)(z):null,[z]);(0,s.useQueryClient)();let{addToast:B}=(0,c.useToast)(),[R,$]=(0,C.useState)(0),[L,P]=(0,C.useState)({}),[Q,G]=(0,C.useState)(null),[O,D]=(0,C.useState)(!1),[I,M]=(0,C.useState)(!1),[T,E]=(0,C.useState)(null),[V,F]=(0,C.useState)(0),X=(0,C.useRef)(!1),{data:K,isLoading:H,error:U}=(0,r.useQuery)({queryKey:["learner-quiz",q],queryFn:async()=>{if(!S)return null;let{data:e,error:t}=await S.from("quizzes").select(`
          *,
          lessons(title, courses(title)),
          quiz_questions(*)
        `).eq("id",q).maybeSingle();if(t){if("PGRST116"===t.code||"PGRST301"===t.code)return k.logger.warn("Quiz not found or access denied",{quizId:(0,k.maskId)(q),error:(0,k.sanitizeError)(t)}),null;throw t}return e},enabled:!!q&&!!S}),{data:J,isLoading:W}=(0,r.useQuery)({queryKey:["learner-quiz-fallback-lesson",q],queryFn:async()=>{if(!S)return null;let{data:e,error:t}=await S.from("lessons").select("id, title, content").eq("id",q).maybeSingle();if(t||!e?.content)return null;try{let t=JSON.parse(e.content);if(!Array.isArray(t))return null;let r=t.filter(e=>e?.type==="quiz");if(!r.length)return null;let s=r.map((e,t)=>{let r=e?.data?.question||`Question ${t+1}`,s=(e?.data?.options||[]).map(e=>String(e?.text??"")).filter(Boolean),a=(e?.data?.options||[]).filter(e=>e?.isCorrect).map(e=>String(e?.text??"")).filter(Boolean),i=a.length>1?a:a[0]||"";return{id:String(e?.id||`block-${t}`),question:r,type:"multiple_choice",options:s,correct_answer:i,points:1,explanation:e?.data?.explanation||void 0}});return{lessonTitle:e.title,questions:s,isGraded:s.some(e=>Array.isArray(e.correct_answer)?e.correct_answer.length>0:!!e.correct_answer)}}catch(e){return null}},enabled:!!q&&!!S&&!H&&!K}),Y=K?(K?.quiz_questions||[]).sort((e,t)=>(e.order_index||0)-(t.order_index||0)).map(e=>{let t,r=e.question_type||e.type||"multiple_choice",s=e.question_text||e.question||"",a=e.explanation||void 0,i=e.points||1,n=e.correct_answer;if("multiple_choice"===r){let r=e.options;if(Array.isArray(r))if(r.length&&"object"==typeof r[0]){t=r.map(e=>String(e?.text??"")).filter(Boolean);let e=r.filter(e=>e?.is_correct).map(e=>String(e?.text??"")).filter(Boolean);1===e.length&&(n=e[0]),e.length>1&&(n=e)}else t=r.map(e=>String(e)).filter(Boolean)}if("true_false"===r){let e=String(n??"").toLowerCase();["true","vrai","1","t","yes","oui"].includes(e)&&(n="vrai"),["false","faux","0","f","no","non"].includes(e)&&(n="faux")}return null==n&&(n=""),{id:e.id,question:s,type:r,options:t,correct_answer:n,points:i,explanation:a}}).filter(e=>e?.id)||[]:J?.questions||[];(0,C.useEffect)(()=>{K?.time_limit_minutes&&!I&&G(60*K.time_limit_minutes)},[K,I]),(0,C.useEffect)(()=>{if(null===Q||Q<=0||I)return;let e=setInterval(()=>{G(e=>e&&e<=1?(ea(),0):e?e-1:null)},1e3);return()=>clearInterval(e)},[Q,I]);let Z=Y[R],ee=Y.length,et=Object.keys(L).length,er=(e,t)=>{P(r=>({...r,[e]:t}))},es=(0,C.useCallback)((e,t,r)=>{if(e){if(!r)return void er(e,t);P(r=>{let s=r[e],a=Array.isArray(s)?[...s]:[],i=a.indexOf(t);return i>=0?a.splice(i,1):a.push(t),{...r,[e]:a}})}},[P]),ea=async()=>{if(!O){D(!0);try{let e=0,t=0,r={};Y.forEach(s=>{t+=s.points||1;let a=L[s.id],i=s.correct_answer,n=!1;(n=Array.isArray(i)?Array.isArray(a)?i.every(e=>a.includes(e))&&a.length===i.length:i.includes(a):a===i)&&(e+=s.points||1),r[s.id]={correct:n,correctAnswer:i}});let s=Y.some(e=>Array.isArray(e.correct_answer)?e.correct_answer.length>0:!!e.correct_answer),a=s?Math.round(e/t*100):0,i=!s||a>=(K?.passing_score||70);if(z&&S)try{await S.from("lesson_quiz_responses").insert({student_id:z,lesson_id:K?.lesson_id,quiz_id:q,answers:L,score:a,passed:i,completed_at:new Date().toISOString()})}catch(e){}E({score:a,total:t,passed:i,answers:r}),M(!0),B({type:i?"success":"error",title:i?"Félicitations !":"Quiz terminé",description:s?i?`Vous avez r\xe9ussi avec ${a}% !`:`Score: ${a}%. Le seuil de r\xe9ussite est de ${K?.passing_score||70}%.`:"Quiz non noté : réponses enregistrées."})}catch(e){B({type:"error",title:"Erreur",description:"Impossible de soumettre le quiz."})}finally{D(!1)}}};return H||W?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[60vh]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(x.ClipboardCheck,{className:"h-12 w-12 text-gray-300 mx-auto mb-4 animate-pulse"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Chargement du quiz..."})]})}):K||J?I&&T?(0,t.jsxs)("div",{className:"max-w-2xl mx-auto space-y-6 pb-24 lg:pb-8",children:[(0,t.jsxs)(n.GlassCard,{className:"p-8 text-center",children:[(0,t.jsx)(d.motion.div,{initial:{scale:0},animate:{scale:1},transition:{type:"spring",damping:15},children:T.passed?(0,t.jsx)("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-green-100 flex items-center justify-center",children:(0,t.jsx)(y.Award,{className:"h-12 w-12 text-green-600"})}):(0,t.jsx)("div",{className:"w-24 h-24 mx-auto mb-6 rounded-full bg-red-100 flex items-center justify-center",children:(0,t.jsx)(p.XCircle,{className:"h-12 w-12 text-red-600"})})}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:T.passed?"Félicitations !":"Quiz terminé"}),(0,t.jsx)("p",{className:"text-gray-500 mb-6",children:K?.title||""}),(0,t.jsxs)("div",{className:"flex justify-center gap-8 mb-8",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:`text-4xl font-bold ${T.passed?"text-green-600":"text-red-600"}`,children:[T.score,"%"]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Votre score"})]}),(0,t.jsx)("div",{className:"w-px bg-gray-200"}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("div",{className:"text-4xl font-bold text-gray-400",children:[K?.passing_score||70,"%"]}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Score requis"})]})]}),T.passed?(0,t.jsxs)(o.Badge,{className:"bg-green-100 text-green-700 text-base px-4 py-2",children:[(0,t.jsx)(h.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Quiz réussi"]}):(0,t.jsxs)(o.Badge,{className:"bg-red-100 text-red-700 text-base px-4 py-2",children:[(0,t.jsx)(p.XCircle,{className:"h-4 w-4 mr-2"}),"Score insuffisant"]})]}),(0,t.jsxs)(n.GlassCard,{className:"p-6",children:[(0,t.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:"Résumé des réponses"}),(0,t.jsx)("div",{className:"space-y-3",children:Y.map((e,r)=>{let s=T.answers[e.id];return(0,t.jsx)("div",{className:`p-4 rounded-xl ${s?.correct?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[s?.correct?(0,t.jsx)(h.CheckCircle2,{className:"h-5 w-5 text-green-600 flex-shrink-0 mt-0.5"}):(0,t.jsx)(p.XCircle,{className:"h-5 w-5 text-red-600 flex-shrink-0 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium text-gray-900",children:["Question ",r+1]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.question}),!s?.correct&&(0,t.jsxs)("p",{className:"text-sm text-green-600 mt-2",children:["Réponse correcte : ",Array.isArray(s?.correctAnswer)?s?.correctAnswer.join(", "):s?.correctAnswer]}),e.explanation&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-2 italic",children:e.explanation})]})]})},e.id)})})]}),(0,t.jsxs)("div",{className:"flex gap-4",children:[!T.passed&&(0,t.jsxs)(l.Button,{onClick:()=>{P({}),$(0),M(!1),E(null),K?.time_limit_minutes&&G(60*K.time_limit_minutes)},className:"flex-1",children:[(0,t.jsx)(v.RotateCcw,{className:"h-4 w-4 mr-2"}),"Réessayer"]}),(0,t.jsx)(j.default,{href:"/learner/evaluations",className:"flex-1",children:(0,t.jsxs)(l.Button,{variant:"outline",className:"w-full",children:[(0,t.jsx)(w.Home,{className:"h-4 w-4 mr-2"}),"Retour aux évaluations"]})})]})]}):(0,t.jsxs)("div",{className:"max-w-3xl mx-auto space-y-6 pb-24 lg:pb-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(j.default,{href:"/learner/evaluations",children:(0,t.jsxs)(l.Button,{variant:"ghost",size:"sm",children:[(0,t.jsx)(g.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Quitter"]})}),null!==Q&&(0,t.jsxs)(o.Badge,{className:`text-base px-4 py-2 ${Q<60?"bg-red-100 text-red-700":"bg-gray-100 text-gray-700"}`,children:[(0,t.jsx)(m.Clock,{className:"h-4 w-4 mr-2"}),(e=Math.floor(Q/60),`${e}:${(Q%60).toString().padStart(2,"0")}`)]})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 flex items-center justify-between",children:[(0,t.jsxs)("span",{children:["version: ","quiz-ui-2025-12-17-01"]}),(0,t.jsxs)("span",{children:["taps: ",V]})]}),(0,t.jsxs)(n.GlassCard,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsxs)("span",{className:"text-sm font-medium text-gray-600",children:["Question ",R+1," sur ",ee]}),(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:[et," répondu",et>1?"es":"e"]})]}),(0,t.jsx)("div",{className:"w-full h-2 bg-gray-100 rounded-full overflow-hidden",children:(0,t.jsx)(d.motion.div,{className:"h-full bg-brand-blue",initial:{width:0},animate:{width:`${(R+1)/ee*100}%`}})})]}),(0,t.jsx)(u.AnimatePresence,{mode:"wait",children:(0,t.jsx)(d.motion.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:(0,t.jsx)(n.GlassCard,{className:"p-6",children:(0,t.jsxs)("div",{onPointerDownCapture:()=>F(e=>e+1),onClickCapture:()=>F(e=>e+1),children:[(0,t.jsx)("h2",{className:"text-lg font-bold text-gray-900 mb-6",children:Z?.question}),Z?.type==="multiple_choice"&&Z.options&&(0,t.jsx)("div",{className:"space-y-3",children:Z.options.map((e,r)=>{let s=Array.isArray(Z.correct_answer),a=L[Z.id],i=s?Array.isArray(a)&&a.includes(e):a===e;return(0,t.jsx)("button",{type:"button",onPointerDown:t=>{X.current=!0,t.preventDefault(),t.stopPropagation(),es(Z.id,e,s)},onClick:t=>{if(t.preventDefault(),t.stopPropagation(),X.current){X.current=!1;return}es(Z.id,e,s)},className:`w-full p-4 rounded-xl text-left transition-all ${i?"bg-brand-blue text-white ring-2 ring-brand-blue":"bg-gray-50 hover:bg-gray-100 text-gray-700"}`,children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${i?"border-white bg-white":"border-gray-300"}`,children:i&&(0,t.jsx)("div",{className:"w-3 h-3 rounded-full bg-brand-blue"})}),(0,t.jsx)("span",{className:"font-medium",children:e})]})},r)})}),Z?.type==="true_false"&&(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4",children:["Vrai","Faux"].map(e=>{let r=L[Z.id]===e.toLowerCase();return(0,t.jsx)("button",{type:"button",onPointerDown:t=>{X.current=!0,t.preventDefault(),t.stopPropagation(),er(Z.id,e.toLowerCase())},onClick:t=>{if(t.preventDefault(),t.stopPropagation(),X.current){X.current=!1;return}er(Z.id,e.toLowerCase())},className:`p-6 rounded-xl text-center transition-all ${r?"bg-brand-blue text-white ring-2 ring-brand-blue":"bg-gray-50 hover:bg-gray-100 text-gray-700"}`,children:(0,t.jsx)("span",{className:"text-lg font-semibold",children:e})},e)})}),!1]})})},R)}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(l.Button,{variant:"outline",onClick:()=>$(Math.max(0,R-1)),disabled:0===R,children:[(0,t.jsx)(g.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Précédent"]}),R<ee-1?(0,t.jsxs)(l.Button,{onClick:()=>$(R+1),children:["Suivant",(0,t.jsx)(b.ArrowRight,{className:"h-4 w-4 ml-2"})]}):(0,t.jsxs)(l.Button,{onClick:ea,disabled:O||et<ee,className:"bg-green-600 hover:bg-green-700",children:[O?"Envoi...":"Soumettre",(0,t.jsx)(h.CheckCircle2,{className:"h-4 w-4 ml-2"})]})]}),(0,t.jsxs)(n.GlassCard,{className:"p-4",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-3",children:"Navigation rapide"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:Y.map((e,r)=>{let s=!!L[e.id],a=r===R;return(0,t.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),$(r)},className:`w-10 h-10 rounded-lg font-medium transition-all ${a?"bg-brand-blue text-white":s?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:r+1},e.id)})})]})]}):(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(f.AlertCircle,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Quiz introuvable"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Ce quiz n’existe pas encore, ou l’accès n’est pas autorisé côté apprenant. Vérifie qu’un quiz est bien créé pour la leçon, et que la migration `20251217000013_learner_header_access_quizzes.sql` est appliquée."}),(0,t.jsx)(j.default,{href:"/learner/evaluations",children:(0,t.jsxs)(l.Button,{variant:"outline",children:[(0,t.jsx)(g.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour aux évaluations"]})})]})}e.s(["default",()=>_])}]);