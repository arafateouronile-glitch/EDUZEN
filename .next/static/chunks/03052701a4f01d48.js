(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,605631,e=>{"use strict";let r=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>r],605631)},356909,e=>{"use strict";let r=(0,e.i(475254).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);e.s(["Save",()=>r],356909)},319036,e=>{"use strict";var r=e.i(843476),t=e.i(271645),i=e.i(647163);let a=t.forwardRef(({checked:e,onCheckedChange:t,disabled:a,className:s,...n},c)=>(0,r.jsx)("button",{type:"button",role:"switch","aria-checked":e,ref:c,disabled:a,onClick:()=>t?.(!e),className:(0,i.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e?"bg-brand-blue":"bg-input",s),...n,children:(0,r.jsx)("span",{className:(0,i.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",e?"translate-x-5":"translate-x-0")})}));a.displayName="Switch",e.s(["Switch",0,a])},89850,e=>{"use strict";var r=e.i(843476),t=e.i(271645),i=e.i(266027),a=e.i(954616),s=e.i(912598),n=e.i(325715),c=e.i(920755),o=e.i(167881),d=e.i(970065),l=e.i(23750),m=e.i(10708),u=e.i(319036),p=e.i(6799),h=e.i(561659),x=e.i(356909),b=e.i(605631),g=e.i(898791),f=e.i(952571);class v{config;constructor(e){this.config=e}async createTransfer(e){let r=await fetch("/api/payments/sepa/create-transfer",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e.amount,currency:e.currency,description:e.description,debtor_name:e.debtorName,debtor_iban:e.debtorIban,debtor_bic:e.debtorBic,debtor_email:e.debtorEmail,reference:e.reference,creditor_name:this.config.creditorName,creditor_iban:this.config.creditorIban,creditor_bic:this.config.creditorBic})});if(!r.ok)throw Error((await r.json()).message||"Erreur lors de la création du virement SEPA");return r.json()}async createDirectDebit(e){if(!e.mandateId)throw Error("Le mandat SEPA est requis pour un prélèvement");let r=await fetch("/api/payments/sepa/create-direct-debit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:e.amount,currency:e.currency,description:e.description,debtor_name:e.debtorName,debtor_iban:e.debtorIban,debtor_bic:e.debtorBic,reference:e.reference,due_date:e.dueDate,mandate_id:e.mandateId,creditor_name:this.config.creditorName,creditor_iban:this.config.creditorIban,creditor_id:this.config.creditorId})});if(!r.ok)throw Error((await r.json()).message||"Erreur lors de la création du prélèvement SEPA");return r.json()}async getPaymentStatus(e){let r=await fetch(`/api/payments/sepa/status/${e}`);if(!r.ok)throw Error((await r.json()).message||"Erreur lors de la vérification du paiement SEPA");return r.json()}validateIBAN(e){let r=e.replace(/\s/g,"").toUpperCase();return!(r.length<15)&&!(r.length>34)&&!!/^[A-Z]{2}\d{2}[A-Z0-9]+$/.test(r)}validateBIC(e){let r=e.replace(/\s/g,"").toUpperCase();return(8===r.length||11===r.length)&&/^[A-Z]{4}[A-Z]{2}[A-Z0-9]{2}([A-Z0-9]{3})?$/.test(r)}}function j(){let{user:e}=(0,n.useAuth)(),j=(0,s.useQueryClient)();(0,c.createClient)();let{addToast:N}=(0,p.useToast)(),[C,_]=(0,t.useState)({creditor_name:"",creditor_iban:"",creditor_bic:"",creditor_id:"",is_active:!1}),[y,A]=(0,t.useState)(null),[E,w]=(0,t.useState)(null),{data:S,isLoading:I}=(0,i.useQuery)({queryKey:["sepa-config",e?.organization_id],queryFn:async()=>e?.organization_id?{creditor_name:"",creditor_iban:"",creditor_bic:"",creditor_id:"",is_active:!1}:null,enabled:!!e?.organization_id}),X=e=>{let r=new v({creditorName:C.creditor_name,creditorIban:e,creditorBic:C.creditor_bic}).validateIBAN(e);return A(r),r},B=e=>{let r=new v({creditorName:C.creditor_name,creditorIban:C.creditor_iban,creditorBic:e}).validateBIC(e);return w(r),r},P=(0,a.useMutation)({mutationFn:async e=>{if(!e.creditor_name)throw Error("Le nom du créancier est requis");if(!e.creditor_iban)throw Error("L'IBAN créancier est requis");if(!X(e.creditor_iban))throw Error("IBAN invalide");if(e.creditor_bic&&!B(e.creditor_bic))throw Error("BIC invalide");return await new Promise(e=>setTimeout(e,500)),e},onSuccess:()=>{j.invalidateQueries({queryKey:["sepa-config"]}),N({title:"Configuration sauvegardée",description:"Les paramètres SEPA ont été enregistrés avec succès.",type:"success"})},onError:e=>{N({title:"Erreur",description:e.message||"Erreur lors de la sauvegarde",type:"error"})}});return I?(0,r.jsx)("div",{className:"container mx-auto py-8",children:(0,r.jsx)("div",{className:"text-center",children:"Chargement..."})}):(0,r.jsxs)("div",{className:"container mx-auto py-8 space-y-6 max-w-4xl",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-2",children:[(0,r.jsx)(h.CreditCard,{className:"h-8 w-8"}),"Configuration SEPA"]}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"Configurez les paiements par virement bancaire SEPA et prélèvements automatiques"})]}),(0,r.jsxs)(d.Card,{children:[(0,r.jsx)(d.CardHeader,{children:(0,r.jsxs)(d.CardTitle,{className:"flex items-center gap-2",children:[(0,r.jsx)(f.Info,{className:"h-5 w-5"}),"À propos de SEPA"]})}),(0,r.jsxs)(d.CardContent,{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"SEPA (Single Euro Payments Area) permet d'effectuer des virements bancaires et des prélèvements automatiques dans toute la zone euro. Vous devez fournir les informations bancaires de votre organisation."}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Virements SEPA :"})," Les clients effectuent des virements manuels vers votre compte"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Prélèvements SEPA :"})," Vous pouvez prélever automatiquement les montants dus (nécessite un mandat)"]})]})]})]}),(0,r.jsxs)(d.Card,{children:[(0,r.jsxs)(d.CardHeader,{children:[(0,r.jsx)(d.CardTitle,{children:"Informations bancaires"}),(0,r.jsx)(d.CardDescription,{children:"Entrez les informations bancaires de votre organisation (créancier)"})]}),(0,r.jsxs)(d.CardContent,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(m.Label,{htmlFor:"creditor_name",children:"Nom du créancier"}),(0,r.jsx)(l.Input,{id:"creditor_name",type:"text",placeholder:"Nom de votre organisation",value:C.creditor_name,onChange:e=>_({...C,creditor_name:e.target.value}),className:"mt-1"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Nom qui apparaîtra sur les relevés bancaires des clients"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(m.Label,{htmlFor:"creditor_iban",children:"IBAN créancier"}),(0,r.jsx)(l.Input,{id:"creditor_iban",type:"text",placeholder:"FR76 XXXX XXXX XXXX XXXX XXXX XXX",value:C.creditor_iban,onChange:e=>{let r=e.target.value.toUpperCase().replace(/\s/g,"");_({...C,creditor_iban:r}),r.length>4?X(r):A(null)},className:"mt-1"}),!1===y&&(0,r.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"IBAN invalide"}),!0===y&&(0,r.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"IBAN valide"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"IBAN de votre compte bancaire (format: FR76 XXXX XXXX...)"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(m.Label,{htmlFor:"creditor_bic",children:"BIC créancier (optionnel mais recommandé)"}),(0,r.jsx)(l.Input,{id:"creditor_bic",type:"text",placeholder:"ABCDEFGH",value:C.creditor_bic,onChange:e=>{let r=e.target.value.toUpperCase().replace(/\s/g,"");_({...C,creditor_bic:r}),r.length>0?B(r):w(null)},className:"mt-1"}),!1===E&&(0,r.jsx)("p",{className:"text-xs text-red-600 mt-1",children:"BIC invalide"}),!0===E&&(0,r.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"BIC valide"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Code BIC/SWIFT de votre banque (8 ou 11 caractères)"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(m.Label,{htmlFor:"creditor_id",children:"Identifiant créancier (pour prélèvements)"}),(0,r.jsx)(l.Input,{id:"creditor_id",type:"text",placeholder:"FR98Z123456789",value:C.creditor_id,onChange:e=>_({...C,creditor_id:e.target.value.toUpperCase()}),className:"mt-1"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Identifiant unique délivré par votre banque pour les prélèvements SEPA"})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between pt-2",children:[(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsx)(m.Label,{htmlFor:"is_active",children:"Activer SEPA"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground",children:"Activez les paiements SEPA pour votre organisation"})]}),(0,r.jsx)(u.Switch,{checked:C.is_active,onCheckedChange:e=>_({...C,is_active:e})})]})]})]}),(0,r.jsx)("div",{className:"flex gap-4",children:(0,r.jsxs)(o.Button,{onClick:()=>P.mutate(C),disabled:P.isPending||!C.creditor_name||!C.creditor_iban,children:[(0,r.jsx)(x.Save,{className:"h-4 w-4 mr-2"}),P.isPending?"Sauvegarde...":"Sauvegarder"]})}),P.isSuccess&&(0,r.jsx)(d.Card,{className:"border-green-200 bg-green-50",children:(0,r.jsx)(d.CardContent,{className:"pt-6",children:(0,r.jsxs)("div",{className:"flex items-center gap-2 text-green-800",children:[(0,r.jsx)(b.CheckCircle,{className:"h-5 w-5"}),(0,r.jsx)("span",{className:"font-semibold",children:"Configuration sauvegardée"})]})})}),P.isError&&(0,r.jsx)(d.Card,{className:"border-red-200 bg-red-50",children:(0,r.jsxs)(d.CardContent,{className:"pt-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 text-red-800",children:[(0,r.jsx)(g.AlertCircle,{className:"h-5 w-5"}),(0,r.jsx)("span",{className:"font-semibold",children:"Erreur"})]}),(0,r.jsx)("p",{className:"text-sm text-red-700 mt-2",children:P.error instanceof Error?P.error.message:"Erreur inconnue"})]})})]})}e.s(["default",()=>j],89850)}]);