(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let t=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],107233)},871689,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},605631,e=>{"use strict";let t=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],605631)},62870,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(647163);e.i(882205);var n=e.i(846932),i=e.i(88653),s=e.i(664659),o=e.i(898791);r.forwardRef(({className:e,label:l,error:d,helperText:c,variant:u="default",leftIcon:m,id:p,options:f,placeholder:h,value:x,...g},_)=>{let[y,b]=r.useState(!1),[v,j]=r.useState(!1),N=p||`select-${Math.random().toString(36).substr(2,9)}`,w=(0,a.cn)("flex w-full rounded-lg font-medium transition-all duration-300","appearance-none cursor-pointer","focus:outline-none focus:ring-2 focus:ring-primary/20","disabled:cursor-not-allowed disabled:opacity-50",{"border-2 border-input bg-background px-4 py-3 pr-11":"default"===u,"focus:border-primary focus:bg-white":"default"===u&&!d,"border-destructive focus:border-destructive focus:ring-destructive/20":d,"border-2 border-input bg-transparent px-4 py-3 pr-11":"outlined"===u,"focus:border-primary focus:shadow-md focus:shadow-primary/10":"outlined"===u&&!d,"border-0 border-b-2 border-input bg-muted/50 px-4 py-3 pr-11 rounded-b-none":"filled"===u,"focus:bg-muted focus:border-primary":"filled"===u&&!d,"focus:border-destructive bg-destructive/5":"filled"===u&&d},m&&"pl-11",e);return(0,t.jsxs)("div",{className:"w-full space-y-1.5",children:[l&&(0,t.jsxs)(n.motion.label,{htmlFor:N,initial:!1,animate:{color:d?"#EF4444":y?"rgb(37, 99, 235)":"rgb(107, 114, 128)"},className:(0,a.cn)("block text-sm font-medium transition-colors duration-200",d&&"text-destructive"),children:[l,g.required&&(0,t.jsx)("span",{className:"text-destructive ml-1",children:"*"})]}),(0,t.jsxs)("div",{className:"relative",children:[m&&(0,t.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none z-10",children:m}),(0,t.jsxs)(n.motion.select,{ref:_,id:N,value:x,...g,onFocus:e=>{b(!0),g.onFocus?.(e)},onBlur:e=>{b(!1),j(!1),g.onBlur?.(e)},onMouseDown:()=>j(!v),className:w,animate:{scale:y?1.01:1,borderColor:d?"#EF4444":y?"rgb(37, 99, 235)":"rgb(226, 232, 240)"},transition:{duration:.2},children:[h&&(0,t.jsx)("option",{value:"",disabled:!0,children:h}),(f||[]).map(e=>(0,t.jsx)("option",{value:e.value,disabled:e.disabled,children:e.label},e.value))]}),(0,t.jsx)(n.motion.div,{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground",animate:{rotate:180*!!v},transition:{duration:.2},children:(0,t.jsx)(s.ChevronDown,{className:"h-5 w-5"})}),d&&(0,t.jsx)(n.motion.div,{className:"absolute right-11 top-1/2 -translate-y-1/2 pointer-events-none",initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:(0,t.jsx)(o.AlertCircle,{className:"h-5 w-5 text-destructive"})})]}),(0,t.jsx)(i.AnimatePresence,{mode:"wait",children:(d||c)&&(0,t.jsx)(n.motion.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.2},className:(0,a.cn)("text-xs transition-colors duration-200",d?"text-destructive":"text-muted-foreground"),children:d||c})})]})}).displayName="SelectNative";let l=r.createContext({}),d=r.forwardRef(({value:e,onValueChange:a,children:n},i)=>{let[s,o]=r.useState(!1);return(0,t.jsx)(l.Provider,{value:{value:e,onValueChange:a,open:s,setOpen:o},children:(0,t.jsx)("div",{className:"relative",ref:i,children:n})})});d.displayName="SelectRoot";let c=r.forwardRef(({children:e,className:n,...i},o)=>{let{open:d,setOpen:c}=r.useContext(l);return(0,t.jsxs)("button",{ref:o,type:"button",className:(0,a.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),onClick:()=>c?.(!d),...i,children:[e,(0,t.jsx)(s.ChevronDown,{className:(0,a.cn)("h-4 w-4 opacity-50 transition-transform",d&&"rotate-180")})]})});c.displayName="SelectTrigger";let u=r.forwardRef(({placeholder:e},a)=>{let{value:n}=r.useContext(l);return(0,t.jsx)("span",{ref:a,children:n||e})});u.displayName="SelectValue";let m=r.forwardRef(({children:e},a)=>{let n=r.useContext(l);return n?.open&&e?(0,t.jsx)("div",{ref:a,className:"absolute top-full left-0 z-50 mt-1 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md",children:(0,t.jsx)("div",{className:"p-1",children:e})}):null});m.displayName="SelectContent";let p=r.forwardRef(({value:e,children:n,className:i,...s},o)=>{let{value:d,onValueChange:c,setOpen:u}=r.useContext(l),m=d===e;return(0,t.jsx)("div",{ref:o,role:"option","aria-selected":m,className:(0,a.cn)("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 px-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",m&&"bg-accent text-accent-foreground",i),onClick:()=>{c?.(e),u?.(!1)},...s,children:n})});p.displayName="SelectItem",e.s(["Select",0,d,"SelectContent",0,m,"SelectItem",0,p,"SelectRoot",0,d,"SelectTrigger",0,c,"SelectValue",0,u])},174886,e=>{"use strict";let t=(0,e.i(475254).default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);e.s(["Copy",()=>t],174886)},330293,e=>{"use strict";function t(e){let{student:t,organization:a,session:n,invoice:i,program:s,academicYear:o,language:l="fr",issueDate:d=new Date().toISOString()}=e;return{date_emission:new Date().toLocaleDateString("fr-FR"),date_aujourd_hui:new Date().toLocaleDateString("fr-FR"),date_jour:new Date().toLocaleDateString("fr-FR"),annee_courante:new Date().getFullYear().toString(),annee_actuelle:new Date().getFullYear().toString(),date_generation:new Date().toLocaleDateString("fr-FR"),heure:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),ecole_nom:a?.name||"",ecole_logo:a?.logo_url||"",ecole_adresse:a?.address||"",ecole_ville:(a?.address||"").split(",").pop()?.trim()||"",ecole_telephone:a?.phone||"",ecole_email:a?.email||"",ecole_site_web:a?.website||"",ecole_code_postal:(a?.address||"").match(/\d{5}/)?.[0]||"",organisation_nom:a?.name||"",organisation_adresse:a?.address||"",organisation_telephone:a?.phone||"",organisation_email:a?.email||"",organisation_logo:a?.logo_url||"",organisation_site_web:a?.website||"",eleve_nom:t?.last_name||"",eleve_prenom:t?.first_name||"",eleve_numero:t?.student_number||"",eleve_date_naissance:t?.date_of_birth?new Date(t.date_of_birth).toLocaleDateString("fr-FR"):"",eleve_classe:t?.classes?t.classes.name:"",eleve_photo:t?.photo_url||"",eleve_adresse:t?.address||"",eleve_telephone:t?.phone||"",eleve_email:t?.email||"",etudiant_nom:t?.last_name||"",etudiant_prenom:t?.first_name||"",etudiant_nom_complet:t?`${t.first_name} ${t.last_name}`:"",etudiant_numero:t?.student_number||"",etudiant_date_naissance:t?.date_of_birth?new Date(t.date_of_birth).toLocaleDateString("fr-FR"):"",etudiant_adresse:t?.address||"",etudiant_telephone:t?.phone||"",etudiant_email:t?.email||"",etudiant_photo:t?.photo_url||"",classe_nom:t?.classes?t.classes.name:"",annee_academique:o?.name||new Date().getFullYear().toString(),annee_scolaire:o?.name||new Date().getFullYear().toString(),session_nom:n?.name||"",session_debut:n?.start_date?new Date(n.start_date).toLocaleDateString("fr-FR"):"",session_fin:n?.end_date?new Date(n.end_date).toLocaleDateString("fr-FR"):"",session_date_debut:n?.start_date?new Date(n.start_date).toLocaleDateString("fr-FR"):"",session_date_fin:n?.end_date?new Date(n.end_date).toLocaleDateString("fr-FR"):"",formation_nom:n?.formations?.name||"",formation_duree:n?.formations?.duration_hours?`${n.formations?.duration_hours} heures`:"",formation_objectifs:n?.formations?.objectives||s?.objectives||"",formation_public_concerne:n?.formations?.target_audience||s?.target_audience||"",formation_prerequis:n?.formations?.prerequisites||s?.prerequisites||"",formation_qualite_et_resultats:n?.formations?.quality_indicators||s?.quality_indicators||"",formation_contenu:n?.formations?.content||s?.content||"",formation_equipe_pedagogique:n?.formations?.pedagogical_team||s?.pedagogical_team||"",formation_ressources:n?.formations?.resources||s?.resources||"",formation_supports:n?.formations?.materials||s?.materials||"",session_lieu:n?.location||n?.venue||"",session_effectif:n?.enrollment_count?.toString()||n?.student_count?.toString()||"",diplome_ou_certification:n?.formations?.certification||s?.certification||"",ecole_region:a?.region||a?.administrative_region||"",programme_nom:s?.name||n?.formations?.programs?.name||"",programme_code:s?.code||"",programme_description:s?.description||"",programme_objectifs:s?.objectives||"",programme_duree_totale:s?.formations?`${s.formations.reduce((e,t)=>e+(t.duration_hours||0),0)} heures`:"",programme_nombre_formations:s?.formations?`${s.formations.length}`:"",programme_nombre_sessions:"",programme_public_concerne:s?.target_audience||"",programme_modalites:s?.modalities||"",programme_certification:s?.certification||"",numero_facture:i?.invoice_number||"",facture_numero:i?.invoice_number||"",facture_date_emission:i?.issue_date?new Date(i.issue_date).toLocaleDateString("fr-FR"):"",facture_date_echeance:i?.due_date?new Date(i.due_date).toLocaleDateString("fr-FR"):"",date_echeance:i?.due_date?new Date(i.due_date).toLocaleDateString("fr-FR"):"",montant:i?.amount?Number(i.amount).toFixed(2):"0.00",montant_ht:i?.amount?Number(i.amount).toFixed(2):"0.00",montant_ttc:i?.total_amount?Number(i.total_amount).toFixed(2):"0.00",tva:i?.tax_amount?Number(i.tax_amount).toFixed(2):"0.00",taux_tva:i?.tax_amount&&i?.amount?(Number(i.tax_amount)/Number(i.amount)*100).toFixed(2):"0.00",facture_montant:i?.amount?Number(i.amount).toFixed(2):"0.00",facture_tva:i?.tax_amount?Number(i.tax_amount).toFixed(2):"0.00",facture_total:i?.total_amount?Number(i.total_amount).toFixed(2):"0.00",facture_devise:i?.currency||"EUR",facture_items:i?.items?JSON.stringify(i.items):"[]",montant_lettres:i?.total_amount?function(e,t="fr"){return"en"===t?e.toFixed(2)+" euros":function e(t){if(0===t)return"zéro euro";if(t<0)return"moins "+e(-t);let a=Math.floor(t),n=Math.round((t-a)*100),i=r(a);return n>0&&(i+=" virgule "+r(n)),i+(a>1?" euros":" euro")}(e)}(Number(i.total_amount),l):"",mode_paiement:i?.payment_method||"",date_paiement:i?.paid_at?new Date(i.paid_at).toLocaleDateString("fr-FR"):"",ecole_siret:a?.siret||"",ecole_numero_declaration:a?.declaration_number||"",ecole_representant:a?.representative_name||"",langue:l}}function r(e){if(0===e)return"";if(e<10)return["","un","deux","trois","quatre","cinq","six","sept","huit","neuf"][e];if(e<20)return["dix","onze","douze","treize","quatorze","quinze","seize","dix-sept","dix-huit","dix-neuf"][e-10];if(e<100){let t=Math.floor(e/10),a=e%10,n=["","","vingt","trente","quarante","cinquante","soixante","soixante","quatre-vingt","quatre-vingt"][t];return 7===t||9===t?n+="-"+(1===a?"et-":"")+r(10+a):a>0?n+=(1===a&&8!==t?"-et-":"-")+r(a):8===t&&(n+="s"),n}if(e<1e3){let t=Math.floor(e/100),a=e%100,n=1===t?"cent":r(t)+"-cent";return a>0?n+="-"+r(a):t>1&&(n+="s"),n}if(e<1e6){let t=Math.floor(e/1e3),a=e%1e3,n=1===t?"mille":r(t)+"-mille";return a>0&&(n+="-"+r(a)),n}return e.toString()}function a(e){return({attestation:"attestation_reussite",certificate:"certificat_scolarite",invoice:"facture",receipt:"facture",transcript:"releve_notes",report_card:"releve_notes",convocation:"convocation",contract:"contrat"})[e]||e}e.s(["extractDocumentVariables",()=>t,"mapDocumentTypeToTemplateType",()=>a])},137652,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(266027),n=e.i(69319),i=e.i(325715),s=e.i(167881),o=e.i(970065),l=e.i(10708),d=e.i(62870),c=e.i(178583),u=e.i(174886),m=e.i(107233),p=e.i(643531);function f({documentType:e,selectedTemplateId:f,onTemplateSelect:h,onCreateNew:x,onDuplicate:g}){let{user:_}=(0,i.useAuth)(),[y,b]=(0,r.useState)(!1),{data:v,isLoading:j}=(0,a.useQuery)({queryKey:["document-templates-by-type",_?.organization_id,e],queryFn:async()=>{if(!_?.organization_id||!e)return[];try{return await n.documentTemplateService.getTemplatesByType(e,_.organization_id)}catch(e){return console.error("Erreur lors de la récupération des templates:",e),[]}},enabled:!!_?.organization_id&&!!e}),N=v?.filter(e=>e.is_active)||[],w=N.find(e=>e.is_default),C=N.filter(e=>!e.is_default),S=y?N:[w,...C.slice(0,2)].filter(Boolean);return j?(0,t.jsx)(o.Card,{children:(0,t.jsx)(o.CardContent,{className:"pt-6",children:(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Chargement des modèles..."})})}):N&&0!==N.length?(0,t.jsxs)(o.Card,{children:[(0,t.jsx)(o.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(o.CardTitle,{className:"text-lg",children:"Modèle de document"}),x&&(0,t.jsxs)(s.Button,{onClick:x,variant:"outline",size:"sm",children:[(0,t.jsx)(m.Plus,{className:"h-4 w-4 mr-2"}),"Nouveau"]})]})}),(0,t.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{htmlFor:"template-select",children:"Sélectionner un modèle"}),(0,t.jsxs)(d.Select,{value:f||w?.id||"",onValueChange:h,children:[(0,t.jsx)(d.SelectTrigger,{id:"template-select",className:"mt-2",children:(0,t.jsx)(d.SelectValue,{placeholder:"Choisir un modèle"})}),(0,t.jsx)(d.SelectContent,{children:N.map(e=>(0,t.jsx)(d.SelectItem,{value:e.id,children:(0,t.jsx)("div",{className:"flex items-center justify-between w-full",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c.FileText,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:e.name}),e.is_default&&(0,t.jsx)("span",{className:"text-xs text-primary font-medium",children:"(Par défaut)"})]})})},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Modèles disponibles"}),(0,t.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:S.map(e=>(0,t.jsxs)("div",{className:`flex items-center justify-between p-3 border rounded-lg transition-colors ${f===e.id?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,t.jsx)(c.FileText,{className:"h-4 w-4 text-gray-400"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-medium text-sm",children:e.name}),e.is_default&&(0,t.jsx)("span",{className:"text-xs px-2 py-0.5 bg-primary/10 text-primary rounded-full",children:"Par défaut"}),f===e.id&&(0,t.jsx)(p.Check,{className:"h-4 w-4 text-primary"})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:["Modifié le ",new Date(e.updated_at).toLocaleDateString("fr-FR")]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[f!==e.id&&(0,t.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>h(e.id),children:"Sélectionner"}),g&&(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:()=>g(e.id),title:"Dupliquer ce modèle",children:(0,t.jsx)(u.Copy,{className:"h-4 w-4"})})]})]},e.id))}),N.length>S.length&&(0,t.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>b(!y),className:"w-full",children:y?`Afficher moins (${N.length-3} autres)`:`Afficher tous les mod\xe8les (${N.length-S.length} autres)`})]})]})]}):(0,t.jsxs)(o.Card,{children:[(0,t.jsx)(o.CardHeader,{children:(0,t.jsx)(o.CardTitle,{className:"text-lg",children:"Modèle de document"})}),(0,t.jsxs)(o.CardContent,{children:[(0,t.jsx)("div",{className:"text-sm text-gray-500 mb-4",children:"Aucun modèle disponible pour ce type de document."}),x&&(0,t.jsxs)(s.Button,{onClick:x,variant:"outline",size:"sm",children:[(0,t.jsx)(m.Plus,{className:"h-4 w-4 mr-2"}),"Créer un modèle"]})]})]})}e.s(["TemplateSelector",()=>f])},721179,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(618566),n=e.i(266027),i=e.i(325715),s=e.i(920755),o=e.i(674824),l=e.i(875976),d=e.i(330293),c=e.i(69319),u=e.i(137652),m=e.i(167881),p=e.i(970065),f=e.i(871689),h=e.i(440160),x=e.i(178583),g=e.i(761911),_=e.i(605631),y=e.i(522016),b=e.i(6799);function v(){let e=(0,a.useRouter)(),{user:v}=(0,i.useAuth)(),j=(0,s.createClient)(),{addToast:N}=(0,b.useToast)(),[w,C]=(0,r.useState)("attestation"),[S,T]=(0,r.useState)(""),[D,F]=(0,r.useState)(""),[z,q]=(0,r.useState)([]),[k,L]=(0,r.useState)("fr"),[R,$]=(0,r.useState)(!1),[M,E]=(0,r.useState)(null),{data:A}=(0,n.useQuery)({queryKey:["organization",v?.organization_id],queryFn:async()=>{if(!v?.organization_id)return null;let{data:e,error:t}=await j.from("organizations").select("*").eq("id",v.organization_id).single();if(t)throw t;return e},enabled:!!v?.organization_id}),{data:H}=(0,n.useQuery)({queryKey:["sessions",v?.organization_id],queryFn:async()=>{if(!v?.organization_id)return[];let{data:e,error:t}=await j.from("sessions").select("id, name, formation_id, formations(name, duration_hours, programs(name)), start_date, end_date, enrollments(*, students(*))").eq("formations.organization_id",v.organization_id).order("start_date",{ascending:!1}).limit(50);if(t)throw t;return e||[]},enabled:!!v?.organization_id}),P=H?.find(e=>e.id===S),B=P?.enrollments?.map(e=>e.students).filter(e=>e&&"active"===e.status)||[],{data:I}=(0,n.useQuery)({queryKey:["academic-year",v?.organization_id],queryFn:async()=>{if(!v?.organization_id)return null;let{data:e,error:t}=await j.from("academic_years").select("*").eq("organization_id",v.organization_id).eq("is_current",!0).maybeSingle();return t?(console.warn("Erreur lors de la récupération de l'année académique:",t),null):e||null},enabled:!!v?.organization_id}),{data:V}=(0,n.useQuery)({queryKey:["document-template",D],queryFn:async()=>D?c.documentTemplateService.getTemplateById(D):null,enabled:!!D}),K=async()=>{if(!w||!A||!V||!S)return void N({type:"error",title:"Erreur",description:"Veuillez sélectionner un type de document, un modèle, et une session."});let e=z.length>0?B.filter(e=>z.includes(e.id)):B;if(0===e.length)return void N({type:"error",title:"Erreur",description:"Aucun étudiant sélectionné pour la génération."});$(!0),E({current:0,total:e.length});let t=[];try{for(let r=0;r<e.length;r++){let a=e[r];E({current:r+1,total:e.length,currentStudent:`${a.first_name} ${a.last_name}`});try{let e=(0,d.extractDocumentVariables)({student:a,organization:A,session:P,invoice:void 0,academicYear:I,language:k,issueDate:new Date().toISOString()}),r=await (0,l.generateHTML)(V,e,void 0,v?.organization_id||""),n=`${w}_${a.last_name}_${a.first_name}.pdf`,i=document.createElement("div");i.style.position="absolute",i.style.left="-9999px",i.style.top="0",i.style.width="794px",i.style.minHeight="1123px",i.style.backgroundColor="#ffffff",i.style.overflow="visible",i.style.fontFamily="Arial, sans-serif",document.body.appendChild(i),i.innerHTML=new DOMParser().parseFromString(r.html,"text/html").body.innerHTML;let s=i.querySelector(".document-container")||i.querySelector('[id$="-document"]')||i.firstElementChild;s&&s instanceof HTMLElement||(s=i);let c=`temp-pdf-batch-${a.id}-${Date.now()}`;if(s instanceof HTMLElement&&(s.id=c,s.style.width||(s.style.width="794px"),s.style.minHeight||(s.style.minHeight="1123px"),s.style.backgroundColor="#ffffff"),await new Promise(e=>setTimeout(e,500)),s instanceof HTMLElement){let e=s.getBoundingClientRect();(0===e.width||0===e.height)&&(s=i,i.id=c,i.style.width="794px",i.style.minHeight="1123px")}let u=await (0,o.generatePDFFromHTML)(c,n);t.push({blob:u,filename:n}),i.parentNode===document.body&&document.body.removeChild(i)}catch(e){console.error(`Erreur lors de la g\xe9n\xe9ration pour ${a.first_name} ${a.last_name}:`,e)}}if(t.length>0){let e=`documents_${w}_${P?.name||"batch"}_${Date.now()}.zip`;await (0,o.createZipFromPDFs)(t.map(e=>({name:e.filename,blob:e.blob})),e),N({type:"success",title:"Génération terminée",description:`${t.length} document(s) g\xe9n\xe9r\xe9(s) avec succ\xe8s.`})}else N({type:"error",title:"Erreur",description:"Aucun document n'a pu être généré."})}catch(e){console.error("Erreur lors de la génération en masse:",e),N({type:"error",title:"Erreur",description:"Une erreur est survenue lors de la génération en masse."})}finally{$(!1),E(null),document.querySelectorAll('[id^="temp-pdf-batch-"]').forEach(e=>{e.parentNode===document.body&&document.body.removeChild(e)})}},O=[{value:"attestation",label:"Attestation de scolarité",icon:x.FileText},{value:"certificate",label:"Certificat de formation",icon:x.FileText}];return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)(y.default,{href:"/dashboard/documents",children:(0,t.jsx)(m.Button,{variant:"ghost",size:"icon",children:(0,t.jsx)(f.ArrowLeft,{className:"h-4 w-4"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Génération en masse"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Générez plusieurs documents à la fois pour une session"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,t.jsxs)(p.Card,{children:[(0,t.jsx)(p.CardHeader,{children:(0,t.jsx)(p.CardTitle,{children:"Type de document"})}),(0,t.jsx)(p.CardContent,{children:(0,t.jsx)("div",{className:"grid grid-cols-2 gap-4",children:O.map(e=>{let r=e.icon;return(0,t.jsxs)("button",{type:"button",onClick:()=>C(e.value),className:`p-4 border-2 rounded-lg text-left transition-colors ${w===e.value?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[(0,t.jsx)(r,{className:"h-6 w-6 mb-2 text-primary"}),(0,t.jsx)("div",{className:"font-medium",children:e.label})]},e.value)})})})]}),w&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.TemplateSelector,{documentType:(0,d.mapDocumentTypeToTemplateType)(w),selectedTemplateId:D,onTemplateSelect:F,onCreateNew:()=>{e.push(`/dashboard/settings/document-templates/${(0,d.mapDocumentTypeToTemplateType)(w)}/edit`)},onDuplicate:async e=>{try{let t=await c.documentTemplateService.duplicateTemplate(e);F(t.id),N({type:"success",title:"Modèle dupliqué",description:"Le modèle a été dupliqué avec succès."})}catch(e){console.error("Erreur lors de la duplication:",e),N({type:"error",title:"Erreur",description:"Erreur lors de la duplication du modèle."})}}}),(0,t.jsxs)(p.Card,{children:[(0,t.jsx)(p.CardHeader,{children:(0,t.jsx)(p.CardTitle,{children:"Session de formation"})}),(0,t.jsx)(p.CardContent,{children:(0,t.jsxs)("select",{value:S,onChange:e=>{T(e.target.value),q([])},className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Sélectionner une session"}),H?.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," - ",e.formations?.programs?.name]},e.id))]})})]}),S&&B.length>0&&(0,t.jsxs)(p.Card,{children:[(0,t.jsx)(p.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(p.CardTitle,{children:["Étudiants (",B.length,")"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(m.Button,{variant:"outline",size:"sm",onClick:()=>{q(B.map(e=>e.id))},children:"Tout sélectionner"}),(0,t.jsx)(m.Button,{variant:"outline",size:"sm",onClick:()=>{q([])},children:"Tout désélectionner"})]})]})}),(0,t.jsxs)(p.CardContent,{children:[(0,t.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:B.map(e=>(0,t.jsxs)("label",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-gray-50 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:z.includes(e.id),onChange:()=>{var t;return t=e.id,void q(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("p",{className:"font-medium",children:[e.first_name," ",e.last_name]}),e.student_number&&(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["N° ",e.student_number]})]})]},e.id))}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-4",children:z.length>0?`${z.length} \xe9tudiant(s) s\xe9lectionn\xe9(s)`:"Aucun étudiant sélectionné (tous seront générés)"})]})]}),(0,t.jsxs)(p.Card,{children:[(0,t.jsx)(p.CardHeader,{children:(0,t.jsx)(p.CardTitle,{children:"Options"})}),(0,t.jsx)(p.CardContent,{children:(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Langue"}),(0,t.jsxs)("select",{value:k,onChange:e=>L(e.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,t.jsx)("option",{value:"fr",children:"Français"}),(0,t.jsx)("option",{value:"en",children:"English"})]})]})})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,t.jsx)(y.default,{href:"/dashboard/documents",children:(0,t.jsx)(m.Button,{variant:"outline",children:"Annuler"})}),(0,t.jsxs)(m.Button,{onClick:K,disabled:R||!D||!S||0===B.length,children:[(0,t.jsx)(h.Download,{className:"mr-2 h-4 w-4"}),R?"Génération...":"Générer en masse"]})]})]})]}),(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)(p.Card,{children:[(0,t.jsx)(p.CardHeader,{children:(0,t.jsx)(p.CardTitle,{children:"Informations"})}),(0,t.jsxs)(p.CardContent,{className:"space-y-4",children:[M&&(0,t.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:"Progression"}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:[M.current," / ",M.total]})]}),(0,t.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${M.current/M.total*100}%`}})}),M.currentStudent&&(0,t.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["En cours: ",M.currentStudent]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(g.Users,{className:"h-4 w-4 text-gray-400"}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:[B.length," étudiant(s) dans la session"]})]}),z.length>0&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(_.CheckCircle,{className:"h-4 w-4 text-success-primary"}),(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:[z.length," étudiant(s) sélectionné(s)"]})]})]}),(0,t.jsx)("div",{className:"pt-4 border-t",children:(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Les documents générés seront regroupés dans un fichier ZIP."})})]})]})})]})]})}e.s(["default",()=>v])},48503,e=>{e.v(e=>Promise.resolve().then(()=>e(915833)))},870653,e=>{e.v(t=>Promise.all(["static/chunks/e551d4a510c7c3c6.js"].map(t=>e.l(t))).then(()=>t(424154)))},195111,e=>{e.v(t=>Promise.all(["static/chunks/9fc253a1d558cb4a.js"].map(t=>e.l(t))).then(()=>t(38201)))}]);