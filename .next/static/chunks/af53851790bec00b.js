(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,503116,e=>{"use strict";let t=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],503116)},25652,e=>{"use strict";let t=(0,e.i(475254).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);e.s(["TrendingUp",()=>t],25652)},115057,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);e.s(["ArrowUpRight",()=>t],115057)},299023,e=>{"use strict";let t=(0,e.i(475254).default)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);e.s(["Minus",()=>t],299023)},620278,e=>{"use strict";let t=(0,e.i(475254).default)("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);e.s(["Target",()=>t],620278)},389704,e=>{"use strict";var t=e.i(920755);class a{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async create(e){try{let{data:t,error:a}=await this.supabase.from("export_history").insert({organization_id:e.organizationId,user_id:e.userId,export_type:e.exportType,entity_type:e.entityType,filename:e.filename,record_count:e.recordCount||0,file_size_bytes:e.fileSizeBytes,filters:e.filters?JSON.stringify(e.filters):null}).select().single();if(a){if("PGRST205"===a.code||a.message?.includes("Could not find the table"))return null;throw a}return t}catch(e){if(e?.code==="PGRST205"||e?.message?.includes("Could not find the table"))return null;throw e}}async getByOrganization(e,t){try{let a=t?.page||1,r=t?.limit||50,s=(a-1)*r,n=this.supabase.from("export_history").select("*, users(full_name, email)",{count:"exact"}).eq("organization_id",e).order("created_at",{ascending:!1});t?.userId&&(n=n.eq("user_id",t.userId)),t?.exportType&&(n=n.eq("export_type",t.exportType)),t?.entityType&&(n=n.eq("entity_type",t.entityType));let{data:i,error:o,count:l}=await n.range(s,s+r-1);if(o){if("PGRST116"===o.code||"PGRST200"===o.code||"42P01"===o.code||"PGRST301"===o.code||400===o.status||404===o.status||"400"===o.code||"404"===o.code||o.message?.includes("relation")||o.message?.includes("does not exist"))return{data:[],total:0,page:a,limit:r,totalPages:0};throw o}return{data:i||[],total:l||0,page:a,limit:r,totalPages:Math.ceil((l||0)/r)}}catch(e){if(e?.code==="PGRST116"||e?.code==="PGRST200"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===400||e?.status===404||e?.code==="400"||e?.code==="404"||e?.message?.includes("relation")||e?.message?.includes("does not exist"))return{data:[],total:0,page:t?.page||1,limit:t?.limit||50,totalPages:0};throw e}}async getStats(e){try{let{data:t,error:a}=await this.supabase.from("export_history").select("export_type, entity_type, record_count, file_size_bytes").eq("organization_id",e);if(a){if("PGRST116"===a.code||"PGRST200"===a.code||"42P01"===a.code||"PGRST301"===a.code||400===a.status||404===a.status||"400"===a.code||"404"===a.code||a.message?.includes("relation")||a.message?.includes("does not exist"))return{total:0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};throw a}let r={total:t?.length||0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};return t?.forEach(e=>{r.byType[e.export_type]=(r.byType[e.export_type]||0)+1,r.byEntity[e.entity_type]=(r.byEntity[e.entity_type]||0)+1,r.totalRecords+=e.record_count||0,r.totalSizeBytes+=e.file_size_bytes||0}),r}catch(e){if(e?.code==="PGRST116"||e?.code==="PGRST200"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===400||e?.status===404||e?.code==="400"||e?.code==="404"||e?.message?.includes("relation")||e?.message?.includes("does not exist"))return{total:0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};throw e}}async delete(e,t){let{error:a}=await this.supabase.from("export_history").delete().eq("id",e).eq("user_id",t);if(a)throw a}async deleteByUser(e,t){let{error:a}=await this.supabase.from("export_history").delete().eq("user_id",e).eq("organization_id",t);if(a)throw a}}let r=new a;e.s(["ExportHistoryService",()=>a,"exportHistoryService",0,r])},686896,e=>{"use strict";var t=e.i(479370),a=e.i(377545),r=e.i(172431),s=e.i(389704);async function n(e,a={}){if(!e||0===e.length)throw Error("Aucune donnée à exporter");let{filename:i=`export_${new Date().toISOString().split("T")[0]}`,sheetName:o="Données",format:l="xlsx",entityType:d="other",organizationId:c,userId:u}=a,m=`${i}.${"csv"===l?"csv":"xlsx"}`;if("csv"===l)(0,t.exportToCSV)(m,e),r.analytics.export.csv(o,e.length);else{let a=Object.keys(e[0]||{}).map(e=>({header:e,key:e,width:20}));await (0,t.exportToExcel)({filename:m,sheetName:o,columns:a,data:e}),r.analytics.export.excel(o,e.length)}if(c&&u)try{await s.exportHistoryService.create({organizationId:c,userId:u,exportType:"csv"===l?"csv":"excel",entityType:d||"other",filename:m,recordCount:e.length})}catch(e){if(e?.code==="PGRST205"||e?.message?.includes("Could not find the table"))return}}function i(e){return e.map(e=>({Numéro:e.student_number||"",Prénom:e.first_name||"",Nom:e.last_name||"",Email:e.email||"",Téléphone:e.phone||"","Date de naissance":e.date_of_birth?(0,a.formatDate)(e.date_of_birth):"",Statut:"active"===e.status?"Actif":"Inactif","Date d'inscription":e.enrollment_date?(0,a.formatDate)(e.enrollment_date):"",Classe:e.classes?.name||"",Niveau:e.classes?.level||""}))}e.s(["exportData",()=>n,"prepareStudentsExport",()=>i])},780737,e=>{"use strict";var t=e.i(843476),a=e.i(271645),r=e.i(266027),s=e.i(920755),n=e.i(325715),i=e.i(970065),o=e.i(167881);e.i(882205);var l=e.i(846932),d=e.i(88653),c=e.i(647163),u=e.i(377545),m=e.i(686896),p=e.i(6799),x=e.i(770703),y=e.i(25652),g=e.i(761911),h=e.i(87316),f=e.i(561659),v=e.i(503116),b=e.i(465286),j=e.i(898791),_=e.i(178583),C=e.i(440160),w=e.i(16715),T=e.i(555436),N=e.i(115057),k=e.i(475254);let S=(0,k.default)("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]);var z=e.i(299023),A=e.i(620278);let P=(0,k.default)("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);var R=e.i(260289);let q=(0,x.default)(()=>e.A(353888).then(e=>({default:e.PremiumLineChart})),{loadableGenerated:{modules:[967339]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"h-64 bg-gray-100 animate-pulse rounded-lg"})}),M=(0,x.default)(()=>e.A(986809).then(e=>({default:e.PremiumPieChart})),{loadableGenerated:{modules:[307353]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"h-64 bg-gray-100 animate-pulse rounded-lg"})});function D({title:e,value:a,change:r,changeType:s,icon:n,color:i,description:o}){let d={blue:"bg-blue-50 text-blue-600 border-blue-200",green:"bg-green-50 text-green-600 border-green-200",purple:"bg-purple-50 text-purple-600 border-purple-200",orange:"bg-orange-50 text-orange-600 border-orange-200",red:"bg-red-50 text-red-600 border-red-200",teal:"bg-teal-50 text-teal-600 border-teal-200"};return(0,t.jsx)(l.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:(0,c.cn)("rounded-xl border-2 p-5",d[i]),children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600",children:e}),(0,t.jsx)("p",{className:"text-3xl font-bold mt-1",children:a}),void 0!==r&&(0,t.jsxs)("div",{className:(0,c.cn)("flex items-center gap-1 mt-2 text-sm font-medium","increase"===s?"text-green-600":"decrease"===s?"text-red-600":"text-gray-500"),children:["increase"===s?(0,t.jsx)(N.ArrowUpRight,{className:"h-4 w-4"}):"decrease"===s?(0,t.jsx)(S,{className:"h-4 w-4"}):(0,t.jsx)(z.Minus,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:[r>0?"+":"",r,"%"]}),(0,t.jsx)("span",{className:"text-gray-400 font-normal",children:"vs période précédente"})]}),o&&(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:o})]}),(0,t.jsx)("div",{className:(0,c.cn)("p-3 rounded-xl",d[i]),children:(0,t.jsx)(n,{className:"h-6 w-6"})})]})})}function E({columns:e,data:a,emptyMessage:r="Aucune donnée",onRowClick:s}){return(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{children:(0,t.jsx)("tr",{className:"border-b border-gray-200",children:e.map(e=>(0,t.jsx)("th",{className:"text-left py-3 px-4 text-xs font-semibold text-gray-500 uppercase tracking-wider",children:e.label},e.key))})}),(0,t.jsx)("tbody",{children:0===a.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:e.length,className:"text-center py-8 text-gray-500",children:r})}):a.map((a,r)=>(0,t.jsx)(l.motion.tr,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05*r},onClick:()=>s?.(a),className:(0,c.cn)("border-b border-gray-100 hover:bg-gray-50 transition-colors",s&&"cursor-pointer"),children:e.map(e=>(0,t.jsx)("td",{className:"py-3 px-4 text-sm text-gray-900",children:e.render?e.render(a[e.key],a):a[e.key]},e.key))},a.id||r))})]})})}function I({filters:e,onChange:a,sessions:r,formations:s}){return(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-3 p-4 bg-gray-50 rounded-xl",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(h.Calendar,{className:"h-4 w-4 text-gray-400"}),(0,t.jsxs)("select",{value:e.dateRange,onChange:t=>a({...e,dateRange:t.target.value}),className:"text-sm border border-gray-200 rounded-lg px-3 py-2 bg-white focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[(0,t.jsx)("option",{value:"week",children:"Cette semaine"}),(0,t.jsx)("option",{value:"month",children:"Ce mois"}),(0,t.jsx)("option",{value:"quarter",children:"Ce trimestre"}),(0,t.jsx)("option",{value:"year",children:"Cette année"}),(0,t.jsx)("option",{value:"custom",children:"Personnalisé"})]})]}),"custom"===e.dateRange&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("input",{type:"date",value:e.customStart||"",onChange:t=>a({...e,customStart:t.target.value}),className:"text-sm border border-gray-200 rounded-lg px-3 py-2 bg-white"}),(0,t.jsx)("span",{className:"text-gray-400",children:"à"}),(0,t.jsx)("input",{type:"date",value:e.customEnd||"",onChange:t=>a({...e,customEnd:t.target.value}),className:"text-sm border border-gray-200 rounded-lg px-3 py-2 bg-white"})]}),s&&s.length>0&&(0,t.jsxs)("select",{value:e.formationId||"",onChange:t=>a({...e,formationId:t.target.value||void 0}),className:"text-sm border border-gray-200 rounded-lg px-3 py-2 bg-white",children:[(0,t.jsx)("option",{value:"",children:"Toutes les formations"}),s.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]}),r&&r.length>0&&(0,t.jsxs)("select",{value:e.sessionId||"",onChange:t=>a({...e,sessionId:t.target.value||void 0}),className:"text-sm border border-gray-200 rounded-lg px-3 py-2 bg-white",children:[(0,t.jsx)("option",{value:"",children:"Toutes les sessions"}),r.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,t.jsxs)("select",{value:e.status||"",onChange:t=>a({...e,status:t.target.value||void 0}),className:"text-sm border border-gray-200 rounded-lg px-3 py-2 bg-white",children:[(0,t.jsx)("option",{value:"",children:"Tous les statuts"}),(0,t.jsx)("option",{value:"active",children:"Actif"}),(0,t.jsx)("option",{value:"completed",children:"Terminé"}),(0,t.jsx)("option",{value:"cancelled",children:"Annulé"})]}),(0,t.jsx)("div",{className:"flex-1 min-w-[200px]",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(T.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,t.jsx)("input",{type:"text",placeholder:"Rechercher...",value:e.search||"",onChange:t=>a({...e,search:t.target.value||void 0}),className:"w-full text-sm border border-gray-200 rounded-lg pl-9 pr-3 py-2 bg-white"})]})}),(0,t.jsxs)(o.Button,{variant:"ghost",size:"sm",onClick:()=>a({dateRange:"month"}),className:"text-gray-500",children:[(0,t.jsx)(w.RefreshCw,{className:"h-4 w-4 mr-1"}),"Réinitialiser"]})]})}function F(){let{user:e}=(0,n.useAuth)(),x=(0,s.createClient)(),{addToast:T}=(0,p.useToast)(),[N,k]=(0,a.useState)("overview"),[S,z]=(0,a.useState)({dateRange:"month"}),[F,B]=(0,a.useState)(!1),V=(0,a.useMemo)(()=>{let e,t=new Date,a=t;switch(S.dateRange){case"week":e=new Date(t.setDate(t.getDate()-7));break;case"month":default:e=new Date(t.getFullYear(),t.getMonth(),1);break;case"quarter":let r=Math.floor(t.getMonth()/3);e=new Date(t.getFullYear(),3*r,1);break;case"year":e=new Date(t.getFullYear(),0,1);break;case"custom":e=S.customStart?new Date(S.customStart):new Date(t.getFullYear(),0,1),a=S.customEnd?new Date(S.customEnd):t}return{start:e.toISOString(),end:a.toISOString()}},[S.dateRange,S.customStart,S.customEnd]),{data:$,isLoading:G}=(0,r.useQuery)({queryKey:["report-stats",e?.organization_id,V],queryFn:async()=>{if(!e?.organization_id)return null;let[t,a,r,s,n,i]=await Promise.all([x.from("students").select("*",{count:"exact",head:!0}).eq("organization_id",e.organization_id).eq("status","active"),x.from("sessions").select("*, formations!inner(organization_id)",{count:"exact"}).eq("formations.organization_id",e.organization_id).gte("start_date",V.start).lte("end_date",V.end),x.from("enrollments").select("*, sessions!inner(formations!inner(organization_id))",{count:"exact"}).eq("sessions.formations.organization_id",e.organization_id).gte("created_at",V.start),x.from("attendance").select("status").eq("organization_id",e.organization_id).gte("date",V.start.split("T")[0]),x.from("payments").select("amount").eq("organization_id",e.organization_id).eq("status","completed").gte("paid_at",V.start),x.from("invoices").select("total_amount").eq("organization_id",e.organization_id).eq("status","overdue")]),o=s.data||[],l=o.length,d=o.filter(e=>"present"===e.status||"late"===e.status).length,c=l>0?Math.round(d/l*100):0,u=(n.data||[]).reduce((e,t)=>e+(t.amount||0),0),m=(i.data||[]).reduce((e,t)=>e+(t.total_amount||0),0);return{students:t.count||0,sessions:a.count||0,enrollments:r.count||0,attendanceRate:c,totalPayments:u,totalOverdue:m}},enabled:!!e?.organization_id}),{data:O}=(0,r.useQuery)({queryKey:["report-sessions",e?.organization_id,V,S.formationId],queryFn:async()=>{if(!e?.organization_id)return[];let t=x.from("sessions").select(`
          *,
          formations!inner(id, name, organization_id),
          enrollments(count),
          session_slots(count)
        `).eq("formations.organization_id",e.organization_id).order("start_date",{ascending:!1});S.formationId&&(t=t.eq("formation_id",S.formationId));let{data:a,error:r}=await t;if(r)throw r;return a||[]},enabled:!!e?.organization_id}),{data:U}=(0,r.useQuery)({queryKey:["report-formations",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)return[];let{data:t,error:a}=await x.from("formations").select("id, name").eq("organization_id",e.organization_id).eq("is_active",!0).order("name");if(a)throw a;return t||[]},enabled:!!e?.organization_id}),{data:K}=(0,r.useQuery)({queryKey:["report-students",e?.organization_id,V,S.sessionId],queryFn:async()=>{if(!e?.organization_id)return[];let t=x.from("students").select(`
          *,
          enrollments(
            id,
            status,
            sessions(id, name)
          )
        `).eq("organization_id",e.organization_id).order("created_at",{ascending:!1}).limit(50),{data:a,error:r}=await t;if(r)throw r;return a||[]},enabled:!!e?.organization_id&&"students"===N}),H=[{id:"overview",label:"Vue d'ensemble",icon:R.LayoutDashboard},{id:"sessions",label:"Sessions",icon:h.Calendar},{id:"students",label:"Apprenants",icon:g.Users},{id:"attendance",label:"Présences",icon:b.CheckCircle2},{id:"finances",label:"Finances",icon:f.CreditCard}],J=(0,a.useMemo)(()=>({enrollmentsTrend:[{name:"Jan",value:45},{name:"Fév",value:52},{name:"Mar",value:48},{name:"Avr",value:61},{name:"Mai",value:55},{name:"Juin",value:67}],attendanceDistribution:[{name:"Présent",value:$?.attendanceRate||0,color:"#10B981"},{name:"Absent",value:100-($?.attendanceRate||0),color:"#EF4444"}],paymentsTrend:[{name:"Jan",value:12500},{name:"Fév",value:15e3},{name:"Mar",value:18200},{name:"Avr",value:14800},{name:"Mai",value:21e3},{name:"Juin",value:$?.totalPayments||0}]}),[$]),L=async()=>{if(!e?.organization_id)return void T({type:"error",title:"Erreur",description:"Vous devez être connecté pour exporter les données"});B(!0);try{let t=(0,u.formatDate)(new Date,"yyyy-MM-dd"),a=[],r="",s="";switch(N){case"overview":a=[{Métrique:"Apprenants actifs",Valeur:$?.students||0},{Métrique:"Sessions en cours",Valeur:$?.sessions||0},{Métrique:"Inscriptions",Valeur:$?.enrollments||0},{Métrique:"Taux de présence",Valeur:`${$?.attendanceRate||0}%`},{Métrique:"Chiffre d'affaires",Valeur:(0,c.formatCurrency)($?.totalPayments||0)},{Métrique:"Impayés",Valeur:(0,c.formatCurrency)($?.totalOverdue||0)}],r=`rapport-vue-ensemble-${t}`,s="Vue d'ensemble";break;case"sessions":if(!O||0===O.length){T({type:"warning",title:"Aucune donnée",description:"Aucune session à exporter"}),B(!1);return}a=(O||[]).map(e=>({Session:e.name||"",Formation:e.formations?.name||"","Date de début":e.start_date?(0,u.formatDate)(e.start_date,"dd/MM/yyyy"):"","Date de fin":e.end_date?(0,u.formatDate)(e.end_date,"dd/MM/yyyy"):"",Statut:"ongoing"===e.status?"En cours":"completed"===e.status?"Terminée":"planned"===e.status?"Planifiée":e.status||"",Inscrits:e.enrollments?.[0]?.count||0})),r=`rapport-sessions-${t}`,s="Sessions";break;case"students":if(!K||0===K.length){T({type:"warning",title:"Aucune donnée",description:"Aucun apprenant à exporter"}),B(!1);return}a=(K||[]).map(e=>({Nom:`${e.first_name||""} ${e.last_name||""}`.trim()||"-",Email:e.email||"",Téléphone:e.phone||"",Statut:"active"===e.status?"Actif":"inactive"===e.status?"Inactif":e.status||"",Inscriptions:e.enrollments?.length||0,"Date d'inscription":e.created_at?(0,u.formatDate)(e.created_at,"dd/MM/yyyy"):""})),r=`rapport-apprenants-${t}`,s="Apprenants";break;case"attendance":a=[{Métrique:"Taux de présence global",Valeur:`${$?.attendanceRate||0}%`},{Métrique:"Présences totales",Valeur:$?.attendanceRate?Math.round($.attendanceRate/100*($.enrollments||0)):0},{Métrique:"Absences",Valeur:$?.attendanceRate?Math.round((100-$.attendanceRate)/100*($.enrollments||0)):0}],r=`rapport-presences-${t}`,s="Présences";break;case"finances":a=[{Métrique:"Chiffre d'affaires",Valeur:(0,c.formatCurrency)($?.totalPayments||0)},{Métrique:"Factures en attente",Valeur:(0,c.formatCurrency)(0)},{Métrique:"Impayés",Valeur:(0,c.formatCurrency)($?.totalOverdue||0)},{Métrique:"Taux de recouvrement",Valeur:$?.totalPayments&&$?.totalOverdue?`${Math.round(($.totalPayments-$.totalOverdue)/$.totalPayments*100)}%`:"0%"}],r=`rapport-finances-${t}`,s="Finances";break;default:T({type:"error",title:"Erreur",description:"Onglet non supporté pour l'export"}),B(!1);return}if(0===a.length){T({type:"warning",title:"Aucune donnée",description:"Aucune donnée à exporter pour cet onglet"}),B(!1);return}await (0,m.exportData)(a,{filename:r,sheetName:s,format:"xlsx",entityType:"other",organizationId:e.organization_id,userId:e.id}),T({type:"success",title:"Export réussi",description:`Les donn\xe9es ont \xe9t\xe9 export\xe9es avec succ\xe8s (${a.length} ligne(s))`})}catch(e){console.error("Erreur lors de l'export:",e),T({type:"error",title:"Erreur d'export",description:e instanceof Error?e.message:"Une erreur est survenue lors de l'export"})}finally{B(!1)}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Rapports & Analytics"}),(0,t.jsx)("p",{className:"text-gray-500 mt-1",children:"Suivez l'activité de votre organisation"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsxs)(o.Button,{variant:"outline",className:"gap-2",onClick:L,disabled:F,children:[(0,t.jsx)(C.Download,{className:"h-4 w-4"}),F?"Export en cours...":"Exporter"]}),(0,t.jsxs)(o.Button,{className:"gap-2",onClick:()=>window.location.reload(),children:[(0,t.jsx)(w.RefreshCw,{className:"h-4 w-4"}),"Actualiser"]})]})]}),(0,t.jsx)("div",{className:"flex items-center gap-2 border-b border-gray-200 pb-4",children:H.map(e=>{let a=e.icon;return(0,t.jsxs)("button",{onClick:()=>k(e.id),className:(0,c.cn)("flex items-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-all",N===e.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[(0,t.jsx)(a,{className:"h-4 w-4"}),e.label]},e.id)})}),(0,t.jsx)(I,{filters:S,onChange:z,sessions:O?.map(e=>({id:e.id,name:e.name})),formations:U}),(0,t.jsxs)(d.AnimatePresence,{mode:"wait",children:["overview"===N&&(0,t.jsxs)(l.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsx)(D,{title:"Apprenants actifs",value:$?.students||0,change:12,changeType:"increase",icon:g.Users,color:"blue"}),(0,t.jsx)(D,{title:"Sessions en cours",value:$?.sessions||0,change:5,changeType:"increase",icon:h.Calendar,color:"purple"}),(0,t.jsx)(D,{title:"Taux de présence",value:`${$?.attendanceRate||0}%`,change:-2,changeType:"decrease",icon:b.CheckCircle2,color:"green"}),(0,t.jsx)(D,{title:"Chiffre d'affaires",value:(0,c.formatCurrency)($?.totalPayments||0),change:18,changeType:"increase",icon:f.CreditCard,color:"teal"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(y.TrendingUp,{className:"h-5 w-5 text-blue-600"}),"Évolution des inscriptions"]})}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)(q,{data:J.enrollmentsTrend,dataKey:"value",xAxisKey:"name",color:"#3B82F6",showArea:!0,gradientColors:{from:"#3B82F6",to:"#60A5FA"}})})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsxs)(i.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(P,{className:"h-5 w-5 text-green-600"}),"Répartition des présences"]})}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)(M,{data:J.attendanceDistribution})})]})]}),$?.totalOverdue&&$.totalOverdue>0&&(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-center gap-3",children:[(0,t.jsx)(j.AlertCircle,{className:"h-6 w-6 text-red-600"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-red-800",children:"Attention : Factures impayées"}),(0,t.jsxs)("p",{className:"text-sm text-red-600",children:[(0,c.formatCurrency)($.totalOverdue)," en factures impayées"]})]}),(0,t.jsx)(o.Button,{variant:"outline",size:"sm",className:"ml-auto border-red-300 text-red-600 hover:bg-red-100",children:"Voir les détails"})]})]},"overview"),"sessions"===N&&(0,t.jsx)(l.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsx)(i.CardTitle,{children:"Suivi des Sessions"})}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)(E,{columns:[{key:"name",label:"Session"},{key:"formations",label:"Formation",render:(e,t)=>t.formations?.name||"-"},{key:"start_date",label:"Début",render:e=>e?(0,u.formatDate)(e):"-"},{key:"end_date",label:"Fin",render:e=>e?(0,u.formatDate)(e):"-"},{key:"status",label:"Statut",render:e=>(0,t.jsx)("span",{className:(0,c.cn)("px-2 py-1 rounded-full text-xs font-medium","ongoing"===e?"bg-green-100 text-green-700":"completed"===e?"bg-blue-100 text-blue-700":"planned"===e?"bg-orange-100 text-orange-700":"bg-gray-100 text-gray-700"),children:"ongoing"===e?"En cours":"completed"===e?"Terminée":"planned"===e?"Planifiée":e})},{key:"enrollments",label:"Inscrits",render:e=>e?.[0]?.count||0}],data:O||[],emptyMessage:"Aucune session trouvée"})})]})},"sessions"),"students"===N&&(0,t.jsx)(l.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsx)(i.CardTitle,{children:"Suivi des Apprenants"})}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)(E,{columns:[{key:"full_name",label:"Nom",render:(e,t)=>`${t.first_name||""} ${t.last_name||""}`.trim()||"-"},{key:"email",label:"Email"},{key:"status",label:"Statut",render:e=>(0,t.jsx)("span",{className:(0,c.cn)("px-2 py-1 rounded-full text-xs font-medium","active"===e?"bg-green-100 text-green-700":"inactive"===e?"bg-gray-100 text-gray-700":"bg-blue-100 text-blue-700"),children:"active"===e?"Actif":"inactive"===e?"Inactif":e})},{key:"enrollments",label:"Inscriptions",render:e=>e?.length||0},{key:"created_at",label:"Inscrit le",render:e=>e?(0,u.formatDate)(e):"-"}],data:K||[],emptyMessage:"Aucun apprenant trouvé"})})]})},"students"),"attendance"===N&&(0,t.jsxs)(l.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsx)(D,{title:"Taux de présence global",value:`${$?.attendanceRate||0}%`,icon:b.CheckCircle2,color:"green"}),(0,t.jsx)(D,{title:"Présences ce mois",value:"1,245",icon:g.Users,color:"blue"}),(0,t.jsx)(D,{title:"Absences non justifiées",value:"23",icon:j.AlertCircle,color:"red"}),(0,t.jsx)(D,{title:"Retards",value:"45",icon:v.Clock,color:"orange"})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsx)(i.CardTitle,{children:"Évolution du taux de présence"})}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)(q,{data:[{name:"Sem 1",value:92},{name:"Sem 2",value:88},{name:"Sem 3",value:95},{name:"Sem 4",value:91}],dataKey:"value",xAxisKey:"name",color:"#10B981",showArea:!0,gradientColors:{from:"#10B981",to:"#34D399"}})})]})]},"attendance"),"finances"===N&&(0,t.jsxs)(l.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsx)(D,{title:"Chiffre d'affaires",value:(0,c.formatCurrency)($?.totalPayments||0),change:18,changeType:"increase",icon:y.TrendingUp,color:"green"}),(0,t.jsx)(D,{title:"Factures en attente",value:(0,c.formatCurrency)(12500),icon:_.FileText,color:"orange"}),(0,t.jsx)(D,{title:"Impayés",value:(0,c.formatCurrency)($?.totalOverdue||0),icon:j.AlertCircle,color:"red"}),(0,t.jsx)(D,{title:"Taux de recouvrement",value:"94%",icon:A.Target,color:"teal"})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsx)(i.CardTitle,{children:"Évolution du chiffre d'affaires"})}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)(q,{data:J.paymentsTrend,dataKey:"value",xAxisKey:"name",color:"#8B5CF6",showArea:!0,gradientColors:{from:"#8B5CF6",to:"#A78BFA"}})})]})]},"finances")]})]})}e.s(["default",()=>F],780737)},353888,e=>{e.v(t=>Promise.all(["static/chunks/f742288b40e0a4b3.js","static/chunks/518ec66d848ebc0c.js","static/chunks/41086c9be2ebf101.js"].map(t=>e.l(t))).then(()=>t(967339)))},986809,e=>{e.v(t=>Promise.all(["static/chunks/b12a8cf496cc0d22.js","static/chunks/518ec66d848ebc0c.js","static/chunks/35e9d40a3003c45b.js"].map(t=>e.l(t))).then(()=>t(307353)))}]);