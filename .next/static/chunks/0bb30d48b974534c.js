(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let r=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>r],871689)},263488,e=>{"use strict";let r=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>r],263488)},569074,e=>{"use strict";let r=(0,e.i(475254).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>r],569074)},246704,779478,e=>{"use strict";var r,t,s=e.i(790224),a=((r={}).AUTH_REQUIRED="AUTH_1001",r.AUTH_INVALID_CREDENTIALS="AUTH_1002",r.AUTH_SESSION_EXPIRED="AUTH_1003",r.AUTH_INSUFFICIENT_PERMISSIONS="AUTH_1004",r.AUTH_2FA_REQUIRED="AUTH_1005",r.AUTH_2FA_INVALID="AUTH_1006",r.VALIDATION_ERROR="VALID_2001",r.VALIDATION_REQUIRED_FIELD="VALID_2002",r.VALIDATION_INVALID_FORMAT="VALID_2003",r.VALIDATION_UNIQUE_CONSTRAINT="VALID_2004",r.DB_CONNECTION_ERROR="DB_3001",r.DB_QUERY_ERROR="DB_3002",r.DB_NOT_FOUND="DB_3003",r.DB_CONSTRAINT_VIOLATION="DB_3004",r.DB_FOREIGN_KEY_CONSTRAINT="DB_3006",r.DB_RLS_POLICY_VIOLATION="DB_3005",r.NETWORK_ERROR="NET_4001",r.API_TIMEOUT="NET_4002",r.API_RATE_LIMIT="NET_4003",r.API_SERVER_ERROR="NET_4004",r.API_NOT_FOUND="NET_4005",r.API_BAD_REQUEST="NET_4006",r.BUSINESS_LOGIC_ERROR="BIZ_5001",r.RESOURCE_LOCKED="BIZ_5002",r.OPERATION_NOT_ALLOWED="BIZ_5003",r.QUOTA_EXCEEDED="BIZ_5004",r.INTERNAL_ERROR="SYS_6001",r.CONFIGURATION_ERROR="SYS_6002",r.SERVICE_UNAVAILABLE="SYS_6003",r);(t={}).LOW="low",t.MEDIUM="medium",t.HIGH="high",t.CRITICAL="critical";class n extends Error{code;severity;userMessage;retryable;context;originalError;constructor(e,r="SYS_6001",t="medium",s={},a){super(e),this.name="AppError",this.code=r,this.severity=t,this.userMessage=s.userMessage||this.getDefaultUserMessage(r),this.retryable=s.retryable??this.isRetryable(r),this.context={...s,code:r,severity:t,timestamp:new Date().toISOString()},this.originalError=a,Error.captureStackTrace&&Error.captureStackTrace(this,n)}getDefaultUserMessage(e){return({AUTH_1001:"Vous devez être connecté pour effectuer cette action.",AUTH_1002:"Email ou mot de passe incorrect.",AUTH_1003:"Votre session a expiré. Veuillez vous reconnecter.",AUTH_1004:"Vous n'avez pas les permissions nécessaires.",AUTH_1005:"Authentification à deux facteurs requise.",AUTH_1006:"Code d'authentification invalide.",VALID_2001:"Les données fournies ne sont pas valides.",VALID_2002:"Certains champs obligatoires sont manquants.",VALID_2003:"Le format des données est incorrect.",VALID_2004:"Cette valeur existe déjà.",DB_3001:"Impossible de se connecter à la base de données.",DB_3002:"Erreur lors de l'exécution de la requête.",DB_3003:"Ressource introuvable.",DB_3004:"Cette opération viole une contrainte de la base de données.",DB_3006:"Cette opération viole une contrainte de clé étrangère.",DB_3005:"Vous n'avez pas accès à cette ressource.",NET_4001:"Erreur de connexion réseau. Vérifiez votre connexion internet.",NET_4002:"La requête a pris trop de temps. Veuillez réessayer.",NET_4003:"Trop de requêtes. Veuillez patienter quelques instants.",NET_4004:"Erreur serveur. Veuillez réessayer plus tard.",NET_4005:"Ressource introuvable.",NET_4006:"Requête invalide.",BIZ_5001:"Cette opération n'est pas autorisée dans le contexte actuel.",BIZ_5002:"Cette ressource est actuellement verrouillée.",BIZ_5003:"Cette opération n'est pas autorisée.",BIZ_5004:"Vous avez atteint la limite autorisée.",SYS_6001:"Une erreur interne est survenue. Veuillez réessayer.",SYS_6002:"Erreur de configuration du système.",SYS_6003:"Service temporairement indisponible."})[e]||"Une erreur inattendue est survenue."}isRetryable(e){return["NET_4001","NET_4002","NET_4004","DB_3001","SYS_6003"].includes(e)}toJSON(){return{name:this.name,message:this.message,code:this.code,severity:this.severity,userMessage:this.userMessage,retryable:this.retryable,context:this.context,stack:this.stack,originalError:this.originalError instanceof Error?{name:this.originalError.name,message:this.originalError.message,stack:this.originalError.stack}:this.originalError}}}let i=new class{handleError(e,r={}){if(e instanceof n)return this.logError(e),e;if(e instanceof Error)return this.handleStandardError(e,r);if(this.isSupabaseError(e))return this.handleSupabaseError(e,r);let t=new n("Une erreur inattendue est survenue.","SYS_6001","high",r,e);return this.logError(t),t}handleStandardError(e,r){let t=e.message.toLowerCase(),s="SYS_6001",a="medium";t.includes("network")||t.includes("fetch")?(s="NET_4001",a="medium"):t.includes("timeout")?(s="NET_4002",a="medium"):t.includes("unauthorized")||t.includes("401")?(s="AUTH_1001",a="high"):t.includes("forbidden")||t.includes("403")?(s="AUTH_1004",a="high"):t.includes("not found")||t.includes("404")?(s="DB_3003",a="low"):(t.includes("validation")||t.includes("invalid"))&&(s="VALID_2001",a="low");let i=new n(e.message,s,a,r,e);return this.logError(i),i}handleSupabaseError(e,r){let t=e.code||e.status,s=e.message||"Erreur Supabase",a=r.code||"DB_3002",i="medium";if(!r.code)switch(t){case"PGRST116":case"42P01":a="DB_3003",i="low";break;case"42501":a="DB_3005",i="high";break;case"23505":a="VALID_2004",i="low";break;case"23503":a="DB_3004",i="medium";break;case"PGRST301":case"400":a="NET_4006",i="low";break;case"401":a="AUTH_1001",i="high";break;case"403":a="AUTH_1004",i="high";break;case"404":a="NET_4005",i="low";break;case"500":a="NET_4004",i="high"}"DB_3006"===a&&(i="medium");let o=new n(s,a,i,r,e);return this.logError(o),o}isSupabaseError(e){return e&&(e.code||e.status||e.message)&&("string"==typeof e.code||"number"==typeof e.status)}logError(e){let r={...e.context,code:e.code,severity:e.severity,retryable:e.retryable};switch(e.severity){case"critical":case"high":s.logger.error(e.message,e.originalError||e,r);break;case"medium":s.logger.warn(e.message,r);break;case"low":s.logger.info(`Error: ${e.message}`,r)}}createValidationError(e,r){return new n(e,"VALID_2001","low",{field:r,userMessage:e})}createAuthError(e,r){return new n(r||"Erreur d'authentification",e,"high")}createDatabaseError(e,r){return new n(e,"DB_3002","medium",{},r)}createNotFoundError(e,r){return new n(e,"DB_3003","low",r)}};e.s(["AppError",()=>n,"ErrorCode",()=>a,"errorHandler",0,i],779478),e.s([],246704)},232189,(e,r,t)=>{"use strict";r.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},865156,(e,r,t)=>{"use strict";var s=e.r(232189);function a(){}function n(){}n.resetWarningCache=a,r.exports=function(){function e(e,r,t,a,n,i){if(i!==s){var o=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function r(){return e}e.isRequired=e;var t={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:r,element:e,elementType:e,instanceOf:r,node:e,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:n,resetWarningCache:a};return t.PropTypes=t,t}},745009,(e,r,t)=>{r.exports=e.r(865156)()},514764,e=>{"use strict";let r=(0,e.i(475254).default)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);e.s(["Send",()=>r],514764)},62870,e=>{"use strict";var r=e.i(843476),t=e.i(271645),s=e.i(647163);e.i(882205);var a=e.i(846932),n=e.i(88653),i=e.i(664659),o=e.i(898791);t.forwardRef(({className:e,label:l,error:d,helperText:c,variant:u="default",leftIcon:m,id:h,options:p,placeholder:g,value:x,...f},_)=>{let[b,N]=t.useState(!1),[E,y]=t.useState(!1),v=h||`select-${Math.random().toString(36).substr(2,9)}`,j=(0,s.cn)("flex w-full rounded-lg font-medium transition-all duration-300","appearance-none cursor-pointer","focus:outline-none focus:ring-2 focus:ring-primary/20","disabled:cursor-not-allowed disabled:opacity-50",{"border-2 border-input bg-background px-4 py-3 pr-11":"default"===u,"focus:border-primary focus:bg-white":"default"===u&&!d,"border-destructive focus:border-destructive focus:ring-destructive/20":d,"border-2 border-input bg-transparent px-4 py-3 pr-11":"outlined"===u,"focus:border-primary focus:shadow-md focus:shadow-primary/10":"outlined"===u&&!d,"border-0 border-b-2 border-input bg-muted/50 px-4 py-3 pr-11 rounded-b-none":"filled"===u,"focus:bg-muted focus:border-primary":"filled"===u&&!d,"focus:border-destructive bg-destructive/5":"filled"===u&&d},m&&"pl-11",e);return(0,r.jsxs)("div",{className:"w-full space-y-1.5",children:[l&&(0,r.jsxs)(a.motion.label,{htmlFor:v,initial:!1,animate:{color:d?"#EF4444":b?"rgb(37, 99, 235)":"rgb(107, 114, 128)"},className:(0,s.cn)("block text-sm font-medium transition-colors duration-200",d&&"text-destructive"),children:[l,f.required&&(0,r.jsx)("span",{className:"text-destructive ml-1",children:"*"})]}),(0,r.jsxs)("div",{className:"relative",children:[m&&(0,r.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none z-10",children:m}),(0,r.jsxs)(a.motion.select,{ref:_,id:v,value:x,...f,onFocus:e=>{N(!0),f.onFocus?.(e)},onBlur:e=>{N(!1),y(!1),f.onBlur?.(e)},onMouseDown:()=>y(!E),className:j,animate:{scale:b?1.01:1,borderColor:d?"#EF4444":b?"rgb(37, 99, 235)":"rgb(226, 232, 240)"},transition:{duration:.2},children:[g&&(0,r.jsx)("option",{value:"",disabled:!0,children:g}),(p||[]).map(e=>(0,r.jsx)("option",{value:e.value,disabled:e.disabled,children:e.label},e.value))]}),(0,r.jsx)(a.motion.div,{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground",animate:{rotate:180*!!E},transition:{duration:.2},children:(0,r.jsx)(i.ChevronDown,{className:"h-5 w-5"})}),d&&(0,r.jsx)(a.motion.div,{className:"absolute right-11 top-1/2 -translate-y-1/2 pointer-events-none",initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:(0,r.jsx)(o.AlertCircle,{className:"h-5 w-5 text-destructive"})})]}),(0,r.jsx)(n.AnimatePresence,{mode:"wait",children:(d||c)&&(0,r.jsx)(a.motion.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.2},className:(0,s.cn)("text-xs transition-colors duration-200",d?"text-destructive":"text-muted-foreground"),children:d||c})})]})}).displayName="SelectNative";let l=t.createContext({}),d=t.forwardRef(({value:e,onValueChange:s,children:a},n)=>{let[i,o]=t.useState(!1);return(0,r.jsx)(l.Provider,{value:{value:e,onValueChange:s,open:i,setOpen:o},children:(0,r.jsx)("div",{className:"relative",ref:n,children:a})})});d.displayName="SelectRoot";let c=t.forwardRef(({children:e,className:a,...n},o)=>{let{open:d,setOpen:c}=t.useContext(l);return(0,r.jsxs)("button",{ref:o,type:"button",className:(0,s.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),onClick:()=>c?.(!d),...n,children:[e,(0,r.jsx)(i.ChevronDown,{className:(0,s.cn)("h-4 w-4 opacity-50 transition-transform",d&&"rotate-180")})]})});c.displayName="SelectTrigger";let u=t.forwardRef(({placeholder:e},s)=>{let{value:a}=t.useContext(l);return(0,r.jsx)("span",{ref:s,children:a||e})});u.displayName="SelectValue";let m=t.forwardRef(({children:e},s)=>{let a=t.useContext(l);return a?.open&&e?(0,r.jsx)("div",{ref:s,className:"absolute top-full left-0 z-50 mt-1 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md",children:(0,r.jsx)("div",{className:"p-1",children:e})}):null});m.displayName="SelectContent";let h=t.forwardRef(({value:e,children:a,className:n,...i},o)=>{let{value:d,onValueChange:c,setOpen:u}=t.useContext(l),m=d===e;return(0,r.jsx)("div",{ref:o,role:"option","aria-selected":m,className:(0,s.cn)("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 px-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",m&&"bg-accent text-accent-foreground",n),onClick:()=>{c?.(e),u?.(!1)},...i,children:a})});h.displayName="SelectItem",e.s(["Select",0,d,"SelectContent",0,m,"SelectItem",0,h,"SelectRoot",0,d,"SelectTrigger",0,c,"SelectValue",0,u])},598203,e=>{"use strict";var r=e.i(920755);e.i(246704);var t=e.i(779478),s=e.i(790224);let a=new class{supabase;constructor(e){this.supabase=e||(0,r.createClient)()}async getAll(e,r){try{let s=r?.page||1,a=r?.limit||50,n=(s-1)*a,i=this.supabase.from("documents").select("*, students(*)",{count:"exact"}).eq("organization_id",e);r?.studentId&&(i=i.eq("student_id",r.studentId)),r?.type&&(i=i.eq("type",r.type));let{data:o,error:l,count:d}=await i.order("created_at",{ascending:!1}).range(n,n+a-1);if(l)throw t.errorHandler.handleError(l,{operation:"getAll",organizationId:e,filters:r});return{data:o||[],total:d||0,page:s,limit:a,totalPages:Math.ceil((d||0)/a)}}catch(s){if(s instanceof t.AppError)throw s;throw t.errorHandler.handleError(s,{operation:"getAll",organizationId:e,filters:r})}}async getById(e){try{let{data:r,error:s}=await this.supabase.from("documents").select("*, students(*)").eq("id",e).single();if(s){if("PGRST116"===s.code)throw t.errorHandler.handleError(s,{code:t.ErrorCode.DB_NOT_FOUND,operation:"getById",id:e});throw t.errorHandler.handleError(s,{operation:"getById",id:e})}if(!r)throw t.errorHandler.createNotFoundError(`Document avec l'ID ${e} introuvable`,{id:e});return r}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"getById",id:e})}}async create(e){try{if(!e.title)throw t.errorHandler.createValidationError("Le titre est obligatoire","title");if(!e.file_url)throw t.errorHandler.createValidationError("L'URL du fichier est obligatoire","file_url");let{data:r,error:a}=await this.supabase.from("documents").insert(e).select().single();if(a){if("23505"===a.code)throw t.errorHandler.handleError(a,{code:t.ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,operation:"create",field:"title"});throw t.errorHandler.handleError(a,{operation:"create",document:e})}return s.logger.info("Document created successfully",{id:r?.id,organizationId:e.organization_id||void 0}),r}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"create",document:e})}}async uploadFile(e,r){try{if(!e)throw t.errorHandler.createValidationError("Le fichier est obligatoire","file");if(!r)throw t.errorHandler.createValidationError("Le chemin est obligatoire","path");let{data:a,error:n}=await this.supabase.storage.from("documents").upload(r,e,{cacheControl:"3600",upsert:!1});if(n){if(n.message?.includes("already exists"))throw t.errorHandler.handleError(n,{code:t.ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,operation:"uploadFile",path:r});throw t.errorHandler.handleError(n,{operation:"uploadFile",path:r,fileName:e.name})}return s.logger.info("File uploaded successfully",{path:r,fileName:e.name,size:e.size}),a}catch(s){if(s instanceof t.AppError)throw s;throw t.errorHandler.handleError(s,{operation:"uploadFile",path:r,fileName:e?.name})}}async getPublicUrl(e){let{data:r}=this.supabase.storage.from("documents").getPublicUrl(e);return r.publicUrl}async delete(e){try{if(!e)throw t.errorHandler.createValidationError("L'ID du document est obligatoire","id");let{error:r}=await this.supabase.from("documents").delete().eq("id",e);if(r){if("23503"===r.code)throw t.errorHandler.handleError(r,{code:t.ErrorCode.DB_FOREIGN_KEY_CONSTRAINT,operation:"delete",id:e});throw t.errorHandler.handleError(r,{operation:"delete",id:e})}s.logger.info("Document deleted successfully",{id:e})}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"delete",id:e})}}};e.s(["documentService",0,a])},41966,e=>{"use strict";let r=(0,e.i(475254).default)("PenTool",[["path",{d:"m12 19 7-7 3 3-7 7-3-3z",key:"rklqx2"}],["path",{d:"m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z",key:"1et58u"}],["path",{d:"m2 2 7.586 7.586",key:"etlp93"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);e.s(["PenTool",()=>r],41966)},197902,e=>{"use strict";var r=e.i(843476),t=e.i(618566),s=e.i(266027),a=e.i(325715),n=e.i(598203),i=e.i(51483),o=e.i(167881),l=e.i(970065),d=e.i(6799),c=e.i(871689),u=e.i(440160),m=e.i(41966),h=e.i(514764),p=e.i(522016),g=e.i(647163);e.i(424403);var x=e.i(67146);function f(){let e=(0,t.useParams)();(0,t.useRouter)();let{user:f}=(0,a.useAuth)(),{addToast:_}=(0,d.useToast)(),b=e.id,{data:N,isLoading:E}=(0,s.useQuery)({queryKey:["document",b],queryFn:()=>n.documentService.getById(b),enabled:!!b}),{data:y,isLoading:v}=(0,s.useQuery)({queryKey:["document-signatures",b],queryFn:()=>i.signatureService.getSignaturesByDocument(b),enabled:!!b});if(E)return(0,r.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-6xl",children:(0,r.jsx)("div",{className:"text-center py-12",children:"Chargement..."})});if(!N)return(0,r.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-6xl",children:(0,r.jsx)(l.Card,{children:(0,r.jsxs)(l.CardContent,{className:"pt-6 text-center",children:[(0,r.jsx)("p",{className:"text-muted-foreground mb-4",children:"Document introuvable"}),(0,r.jsx)(p.default,{href:"/dashboard/documents",children:(0,r.jsx)(o.Button,{variant:"outline",children:"Retour aux documents"})})]})})});let j=y?.some(e=>e.signer?.id===f?.id);return(0,r.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-6xl",children:[(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)(p.default,{href:"/dashboard/documents",children:(0,r.jsxs)(o.Button,{variant:"ghost",size:"sm",className:"mb-4",children:[(0,r.jsx)(c.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour aux documents"]})}),(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-2",children:N.title||"Document sans titre"}),(0,r.jsxs)("p",{className:"text-muted-foreground",children:["Type : ",N.type||"Non spécifié"," • Créé le ",N.created_at?(0,g.formatDate)(N.created_at):"Date inconnue"]})]}),(0,r.jsx)("div",{className:"flex gap-2",children:N.file_url&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(x.SendSignatureRequestDialog,{documentId:b,documentTitle:N.title||"Document",onSuccess:()=>{_({type:"success",title:"Demande de signature envoyée",description:"Les destinataires ont reçu un email avec le lien de signature."})},trigger:(0,r.jsxs)(o.Button,{variant:"outline",children:[(0,r.jsx)(h.Send,{className:"h-4 w-4 mr-2"}),"Envoyer pour signature"]})}),(0,r.jsx)("a",{href:N.file_url,target:"_blank",rel:"noopener noreferrer",download:!0,children:(0,r.jsxs)(o.Button,{variant:"outline",children:[(0,r.jsx)(u.Download,{className:"h-4 w-4 mr-2"}),"Télécharger"]})}),(0,r.jsx)(p.default,{href:`/dashboard/documents/${b}/sign`,children:(0,r.jsxs)(o.Button,{variant:j?"outline":"default",children:[(0,r.jsx)(m.PenTool,{className:"h-4 w-4 mr-2"}),j?"Re-signer":"Signer"]})})]})})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[N.file_url&&(0,r.jsxs)(l.Card,{children:[(0,r.jsx)(l.CardHeader,{children:(0,r.jsx)(l.CardTitle,{children:"Aperçu du document"})}),(0,r.jsx)(l.CardContent,{children:(0,r.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,r.jsx)("iframe",{src:N.file_url,className:"w-full h-[600px]",title:"Aperçu du document"})})})]}),(0,r.jsxs)(l.Card,{children:[(0,r.jsx)(l.CardHeader,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(l.CardTitle,{children:"Signatures"}),(0,r.jsx)(l.CardDescription,{children:v?"Chargement...":y&&y.length>0?`${y.length} signature(s) enregistr\xe9e(s)`:"Aucune signature"})]}),!j&&(0,r.jsx)(p.default,{href:`/dashboard/documents/${b}/sign`,children:(0,r.jsxs)(o.Button,{size:"sm",children:[(0,r.jsx)(m.PenTool,{className:"h-4 w-4 mr-2"}),"Ajouter une signature"]})})]})}),(0,r.jsx)(l.CardContent,{children:v?(0,r.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Chargement des signatures..."}):y&&y.length>0?(0,r.jsx)("div",{className:"space-y-4",children:y.map(e=>(0,r.jsxs)("div",{className:"flex items-start gap-4 p-4 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-32 h-20 border rounded bg-white p-2 flex items-center justify-center",children:(0,r.jsx)("img",{src:e.signature_data,alt:`Signature de ${e.signer_name}`,className:"max-w-full max-h-full object-contain"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-semibold text-lg",children:e.signer_name||e.signer?.full_name||"Signataire inconnu"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:e.signer_role||e.signer?.role||"Rôle non spécifié"}),e.signer_email&&(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.signer_email}),e.signed_at&&(0,r.jsxs)("p",{className:"text-xs text-muted-foreground mt-2",children:["Signé le ",(0,g.formatDate)(e.signed_at)]}),e.comment&&(0,r.jsxs)("p",{className:"text-sm text-muted-foreground mt-2 italic",children:['"',e.comment,'"']})]}),e.signer_id===f?.id&&(0,r.jsx)("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded font-medium whitespace-nowrap",children:"Votre signature"})]}),"revoked"===e.status&&(0,r.jsx)("div",{className:"mt-2 p-2 bg-red-50 border border-red-200 rounded text-sm text-red-800",children:"Signature révoquée"})]})]},e.id))}):(0,r.jsxs)("div",{className:"text-center py-8 border-2 border-dashed rounded-lg",children:[(0,r.jsx)(m.PenTool,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,r.jsx)("p",{className:"text-muted-foreground mb-4",children:"Aucune signature enregistrée pour ce document"}),(0,r.jsx)(p.default,{href:`/dashboard/documents/${b}/sign`,children:(0,r.jsxs)(o.Button,{children:[(0,r.jsx)(m.PenTool,{className:"h-4 w-4 mr-2"}),"Ajouter la première signature"]})})]})})]})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)(l.Card,{children:[(0,r.jsx)(l.CardHeader,{children:(0,r.jsx)(l.CardTitle,{children:"Informations"})}),(0,r.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Type"}),(0,r.jsx)("p",{className:"font-medium",children:N.type||"Non spécifié"})]}),N.created_at&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Date de création"}),(0,r.jsx)("p",{className:"font-medium",children:(0,g.formatDate)(N.created_at)})]}),N.students&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Étudiant"}),(0,r.jsxs)("p",{className:"font-medium",children:[N.students.first_name," ",N.students.last_name]})]})]})]}),y&&y.length>0&&(0,r.jsxs)(l.Card,{children:[(0,r.jsx)(l.CardHeader,{children:(0,r.jsx)(l.CardTitle,{children:"Statistiques"})}),(0,r.jsxs)(l.CardContent,{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total de signatures"}),(0,r.jsx)("span",{className:"font-semibold",children:y.length})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-sm text-muted-foreground",children:"Signatures valides"}),(0,r.jsx)("span",{className:"font-semibold text-green-600",children:y.filter(e=>e.is_valid&&"signed"===e.status).length})]}),j&&(0,r.jsx)("div",{className:"pt-2 mt-2 border-t",children:(0,r.jsx)("span",{className:"text-sm text-blue-600 font-medium",children:"✓ Vous avez signé ce document"})})]})]})]})]}),f?.organization_id&&(0,r.jsx)(x.SendSignatureRequestDialog,{documentId:b,documentTitle:N?.title||"Document",onSuccess:()=>{_({type:"success",title:"Demande de signature envoyée",description:"Les destinataires ont reçu un email avec le lien de signature."})},trigger:(0,r.jsxs)(o.Button,{variant:"outline",size:"sm",children:[(0,r.jsx)(h.Send,{className:"h-4 w-4 mr-2"}),"Demander une signature"]})})]})}e.s(["default",()=>f])}]);