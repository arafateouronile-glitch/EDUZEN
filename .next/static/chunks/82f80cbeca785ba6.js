(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,503116,e=>{"use strict";let s=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>s],503116)},645760,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(647163);e.i(882205);var i=e.i(846932);let r=a.forwardRef(({className:e,variant:a="default",hoverable:r=!1,glow:n=!1,glowColor:l="rgba(51, 90, 207, 0.3)",...d},c)=>(0,s.jsxs)(i.motion.div,{ref:c,className:(0,t.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===a,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===a,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===a,"cursor-pointer":r,"hover:shadow-2xl hover:scale-[1.02]":r,"hover:bg-white/90 dark:hover:bg-gray-900/90":r},e),whileHover:r?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...d,children:[n&&(0,s.jsx)(i.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${l} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,s.jsx)("div",{className:"relative z-10",children:d.children})]}));r.displayName="GlassCard",e.s(["GlassCard",()=>r])},356909,e=>{"use strict";let s=(0,e.i(475254).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);e.s(["Save",()=>s],356909)},263488,e=>{"use strict";let s=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>s],263488)},319036,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(647163);let i=a.forwardRef(({checked:e,onCheckedChange:a,disabled:i,className:r,...n},l)=>(0,s.jsx)("button",{type:"button",role:"switch","aria-checked":e,ref:l,disabled:i,onClick:()=>a?.(!e),className:(0,t.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e?"bg-brand-blue":"bg-input",r),...n,children:(0,s.jsx)("span",{className:(0,t.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",e?"translate-x-5":"translate-x-0")})}));i.displayName="Switch",e.s(["Switch",0,i])},514764,e=>{"use strict";let s=(0,e.i(475254).default)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);e.s(["Send",()=>s],514764)},182774,e=>{"use strict";var s=e.i(843476),a=e.i(325715),t=e.i(618566),i=e.i(271645);let r=(0,e.i(475254).default)("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var n=e.i(167881),l=e.i(970065),d=e.i(522016);function c({children:e,allowedRoles:c,fallback:o,redirectTo:m="/dashboard"}){let{user:h,isLoading:u}=(0,a.useAuth)(),x=(0,t.useRouter)(),[p,b]=(0,i.useState)(null);return((0,i.useEffect)(()=>{if(!u&&h){let e=h.role||"",s=c.includes(e);b(s),s||!m||o||x.push(m)}},[h,u,c,m,x,o]),u||null===p)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):p?(0,s.jsx)(s.Fragment,{children:e}):o?(0,s.jsx)(s.Fragment,{children:o}):(0,s.jsx)("div",{className:"container mx-auto py-16 px-4",children:(0,s.jsx)(l.Card,{className:"max-w-md mx-auto",children:(0,s.jsxs)(l.CardContent,{className:"py-12 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,s.jsx)(r,{className:"h-8 w-8 text-red-600"})}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Accès non autorisé"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Vous n'avez pas les permissions nécessaires pour accéder à cette page."}),(0,s.jsx)(d.default,{href:"/dashboard",children:(0,s.jsx)(n.Button,{children:"Retour au tableau de bord"})})]})})})}e.s(["ADMIN_ROLES",0,["super_admin","admin","secretary","accountant"],"FINANCE_ROLES",0,["super_admin","admin","secretary","accountant"],"FORMATION_MANAGEMENT_ROLES",0,["super_admin","admin","secretary"],"RoleGuard",()=>c],182774)},238491,e=>{"use strict";let s=(0,e.i(475254).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);e.s(["Phone",()=>s],238491)},243553,e=>{"use strict";let s=(0,e.i(475254).default)("Crown",[["path",{d:"m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14",key:"zkxr6b"}]]);e.s(["Crown",()=>s],243553)},126564,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(266027),i=e.i(954616),r=e.i(912598),n=e.i(325715),l=e.i(920755),d=e.i(167881),c=e.i(645760),o=e.i(23750),m=e.i(10708),h=e.i(319036),u=e.i(994179),x=e.i(6799),p=e.i(182774);e.i(882205);var b=e.i(846932),g=e.i(226691),j=e.i(263488),f=e.i(686311),y=e.i(238491),v=e.i(503116),N=e.i(356909),w=e.i(16715),_=e.i(243553),k=e.i(465286),C=e.i(859607),S=e.i(514764);let z=(0,e.i(475254).default)("CalendarCheck",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}],["path",{d:"m9 16 2 2 4-4",key:"19s6y9"}]]);function A(){let{user:e}=(0,n.useAuth)(),A=(0,l.createClient)(),q=(0,r.useQueryClient)(),{addToast:M}=(0,x.useToast)(),[E,B]=(0,a.useState)(!1),[R,P]=(0,a.useState)({reminder_enabled:!0,reminder_hours_before:24,email_enabled:!0,whatsapp_enabled:!1,sms_enabled:!1}),[F,L]=(0,a.useState)({account_sid:"",auth_token:"",from_number:""}),{data:I,isLoading:T}=(0,t.useQuery)({queryKey:["organization-settings",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)return null;let{data:s,error:a}=await A.from("organizations").select("id, name, settings, subscription_tier").eq("id",e.organization_id).single();if(a)throw a;return s},enabled:!!e?.organization_id}),O=["premium","enterprise"].includes(I?.subscription_tier||"");(0,a.useEffect)(()=>{if(I?.settings){let e=I.settings,s=e.notifications||{};P({reminder_enabled:!1!==s.reminder_enabled,reminder_hours_before:s.reminder_hours_before||24,email_enabled:!1!==s.email_enabled,whatsapp_enabled:s.whatsapp_enabled||!1,sms_enabled:s.sms_enabled||!1}),e.whatsapp&&L({account_sid:e.whatsapp.account_sid||"",auth_token:e.whatsapp.auth_token?"••••••••":"",from_number:e.whatsapp.from_number||""})}},[I]);let G=(0,i.useMutation)({mutationFn:async()=>{if(!e?.organization_id)throw Error("Organization non trouvée");let s=I?.settings||{},a={...s,notifications:{...R}};F.account_sid&&"••••••••"!==F.auth_token?a.whatsapp={account_sid:F.account_sid,auth_token:F.auth_token,from_number:F.from_number}:F.account_sid&&"••••••••"===F.auth_token&&(a.whatsapp={...s.whatsapp,account_sid:F.account_sid,from_number:F.from_number});let{error:t}=await A.from("organizations").update({settings:a}).eq("id",e.organization_id);if(t)throw t},onSuccess:()=>{q.invalidateQueries({queryKey:["organization-settings"]}),M({type:"success",title:"Succès",description:"Paramètres de notifications sauvegardés"})},onError:e=>{M({type:"error",title:"Erreur",description:e instanceof Error?e.message:"Erreur lors de la sauvegarde"})}}),{data:W}=(0,t.useQuery)({queryKey:["recent-notifications",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)return[];let{data:s}=await A.from("scheduled_notifications").select("*").eq("organization_id",e.organization_id).order("created_at",{ascending:!1}).limit(10);return s||[]},enabled:!!e?.organization_id}),D={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5}}};return T?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,s.jsx)(w.RefreshCw,{className:"h-8 w-8 animate-spin text-brand-blue"})}):(0,s.jsx)(p.RoleGuard,{allowedRoles:p.ADMIN_ROLES,children:(0,s.jsxs)(b.motion.div,{className:"container mx-auto py-8 px-4 max-w-4xl space-y-8",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",children:[(0,s.jsx)(b.motion.div,{variants:D,children:(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("div",{className:"p-2 bg-brand-blue/10 rounded-xl",children:(0,s.jsx)(g.Bell,{className:"h-8 w-8 text-brand-blue"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Notifications automatiques"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Configurez les rappels et notifications pour vos enseignants et apprenants"})]})]})}),!O&&(0,s.jsx)(b.motion.div,{variants:D,children:(0,s.jsx)(c.GlassCard,{className:"p-6 bg-gradient-to-r from-amber-50 to-orange-50 border-amber-200",children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("div",{className:"p-3 bg-amber-100 rounded-xl",children:(0,s.jsx)(_.Crown,{className:"h-6 w-6 text-amber-600"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"font-bold text-amber-900 mb-1",children:"Fonctionnalité Premium"}),(0,s.jsx)("p",{className:"text-amber-700 text-sm mb-3",children:"Les notifications WhatsApp sont disponibles uniquement avec un abonnement Premium ou Enterprise. Les rappels par email restent disponibles pour tous."}),(0,s.jsxs)(d.Button,{size:"sm",className:"bg-amber-600 hover:bg-amber-700",children:[(0,s.jsx)(_.Crown,{className:"h-4 w-4 mr-2"}),"Passer à Premium"]})]})]})})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsx)(b.motion.div,{variants:D,children:(0,s.jsxs)(c.GlassCard,{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,s.jsx)(z,{className:"h-5 w-5 text-brand-blue"}),(0,s.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Rappels de sessions"})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{className:"text-base font-medium",children:"Rappels automatiques"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Envoyer des rappels avant chaque session"})]}),(0,s.jsx)(h.Switch,{checked:R.reminder_enabled,onCheckedChange:e=>P({...R,reminder_enabled:e})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"reminder_hours",children:"Délai avant la session"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,s.jsx)(o.Input,{id:"reminder_hours",type:"number",min:1,max:72,value:R.reminder_hours_before,onChange:e=>P({...R,reminder_hours_before:parseInt(e.target.value)||24}),className:"w-24",disabled:!R.reminder_enabled}),(0,s.jsx)("span",{className:"text-gray-500",children:"heures avant"})]}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Par défaut : 24h (la veille)"})]}),(0,s.jsxs)("div",{className:"space-y-4 pt-4 border-t",children:[(0,s.jsx)(m.Label,{className:"text-base font-medium",children:"Canaux de notification"}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(j.Mail,{className:"h-5 w-5 text-blue-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"Email"}),(0,s.jsx)(u.Badge,{variant:"outline",className:"ml-2 text-xs",children:"Inclus"})]})]}),(0,s.jsx)(h.Switch,{checked:R.email_enabled,onCheckedChange:e=>P({...R,email_enabled:e}),disabled:!R.reminder_enabled})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(f.MessageSquare,{className:"h-5 w-5 text-green-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"WhatsApp"}),(0,s.jsx)(u.Badge,{className:"ml-2 text-xs bg-amber-100 text-amber-700",children:"Premium"})]})]}),(0,s.jsx)(h.Switch,{checked:R.whatsapp_enabled,onCheckedChange:e=>P({...R,whatsapp_enabled:e}),disabled:!O||!R.reminder_enabled})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg opacity-50",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(y.Phone,{className:"h-5 w-5 text-purple-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-medium",children:"SMS"}),(0,s.jsx)(u.Badge,{variant:"outline",className:"ml-2 text-xs",children:"Bientôt"})]})]}),(0,s.jsx)(h.Switch,{checked:!1,disabled:!0})]})]})]})]})}),(0,s.jsx)(b.motion.div,{variants:D,children:(0,s.jsxs)(c.GlassCard,{className:`p-6 ${!O?"opacity-60":""}`,children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,s.jsx)(f.MessageSquare,{className:"h-5 w-5 text-green-600"}),(0,s.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Configuration WhatsApp"}),!O&&(0,s.jsx)(u.Badge,{className:"bg-amber-100 text-amber-700",children:"Premium requis"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"account_sid",children:"Account SID (Twilio)"}),(0,s.jsx)(o.Input,{id:"account_sid",type:"text",value:F.account_sid,onChange:e=>L({...F,account_sid:e.target.value}),placeholder:"AC...",disabled:!O,className:"mt-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"auth_token",children:"Auth Token"}),(0,s.jsx)(o.Input,{id:"auth_token",type:"password",value:F.auth_token,onChange:e=>L({...F,auth_token:e.target.value}),placeholder:"••••••••",disabled:!O,className:"mt-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"from_number",children:"Numéro WhatsApp"}),(0,s.jsx)(o.Input,{id:"from_number",type:"text",value:F.from_number,onChange:e=>L({...F,from_number:e.target.value}),placeholder:"+14155238886",disabled:!O,className:"mt-2"}),(0,s.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Numéro WhatsApp Business configuré dans Twilio"})]}),(0,s.jsx)("div",{className:"pt-4 border-t",children:(0,s.jsxs)("p",{className:"text-sm text-gray-600 mb-3",children:["Pour configurer WhatsApp, vous avez besoin d'un compte"," ",(0,s.jsx)("a",{href:"https://www.twilio.com/whatsapp",target:"_blank",rel:"noopener noreferrer",className:"text-brand-blue hover:underline",children:"Twilio WhatsApp Business"})]})})]})]})})]}),(0,s.jsx)(b.motion.div,{variants:D,children:(0,s.jsxs)(c.GlassCard,{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(S.Send,{className:"h-5 w-5 text-brand-blue"}),(0,s.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:"Notifications récentes"})]}),(0,s.jsxs)(u.Badge,{variant:"outline",children:[W?.length||0," notifications"]})]}),W&&W.length>0?(0,s.jsx)("div",{className:"space-y-3",children:W.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:["email"===e.type?(0,s.jsx)(j.Mail,{className:"h-4 w-4 text-blue-600"}):"whatsapp"===e.type?(0,s.jsx)(f.MessageSquare,{className:"h-4 w-4 text-green-600"}):(0,s.jsx)(y.Phone,{className:"h-4 w-4 text-purple-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.metadata?.recipient_name||"Destinataire"}),(0,s.jsxs)("p",{className:"text-xs text-gray-500",children:[e.subject||e.message?.substring(0,50),"..."]})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:"sent"===e.status?(0,s.jsxs)(u.Badge,{className:"bg-green-100 text-green-700",children:[(0,s.jsx)(k.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Envoyé"]}):"failed"===e.status?(0,s.jsxs)(u.Badge,{className:"bg-red-100 text-red-700",children:[(0,s.jsx)(C.AlertTriangle,{className:"h-3 w-3 mr-1"}),"Échoué"]}):(0,s.jsxs)(u.Badge,{className:"bg-amber-100 text-amber-700",children:[(0,s.jsx)(v.Clock,{className:"h-3 w-3 mr-1"}),"En attente"]})})]},e.id))}):(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)(g.Bell,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),(0,s.jsx)("p",{className:"text-gray-500",children:"Aucune notification envoyée"})]})]})}),(0,s.jsx)(b.motion.div,{variants:D,className:"flex justify-end",children:(0,s.jsx)(d.Button,{onClick:()=>{B(!0),G.mutate(void 0,{onSettled:()=>B(!1)})},disabled:E,size:"lg",className:"shadow-lg shadow-brand-blue/25",children:E?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(w.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}),"Sauvegarde..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.Save,{className:"h-4 w-4 mr-2"}),"Sauvegarder les paramètres"]})})})]})})}e.s(["default",()=>A],126564)}]);