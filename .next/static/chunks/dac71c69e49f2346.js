(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,389704,e=>{"use strict";var t=e.i(920755);class s{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async create(e){try{let{data:t,error:s}=await this.supabase.from("export_history").insert({organization_id:e.organizationId,user_id:e.userId,export_type:e.exportType,entity_type:e.entityType,filename:e.filename,record_count:e.recordCount||0,file_size_bytes:e.fileSizeBytes,filters:e.filters?JSON.stringify(e.filters):null}).select().single();if(s){if("PGRST205"===s.code||s.message?.includes("Could not find the table"))return null;throw s}return t}catch(e){if(e?.code==="PGRST205"||e?.message?.includes("Could not find the table"))return null;throw e}}async getByOrganization(e,t){try{let s=t?.page||1,o=t?.limit||50,i=(s-1)*o,r=this.supabase.from("export_history").select("*, users(full_name, email)",{count:"exact"}).eq("organization_id",e).order("created_at",{ascending:!1});t?.userId&&(r=r.eq("user_id",t.userId)),t?.exportType&&(r=r.eq("export_type",t.exportType)),t?.entityType&&(r=r.eq("entity_type",t.entityType));let{data:a,error:n,count:c}=await r.range(i,i+o-1);if(n){if("PGRST116"===n.code||"PGRST200"===n.code||"42P01"===n.code||"PGRST301"===n.code||400===n.status||404===n.status||"400"===n.code||"404"===n.code||n.message?.includes("relation")||n.message?.includes("does not exist"))return{data:[],total:0,page:s,limit:o,totalPages:0};throw n}return{data:a||[],total:c||0,page:s,limit:o,totalPages:Math.ceil((c||0)/o)}}catch(e){if(e?.code==="PGRST116"||e?.code==="PGRST200"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===400||e?.status===404||e?.code==="400"||e?.code==="404"||e?.message?.includes("relation")||e?.message?.includes("does not exist"))return{data:[],total:0,page:t?.page||1,limit:t?.limit||50,totalPages:0};throw e}}async getStats(e){try{let{data:t,error:s}=await this.supabase.from("export_history").select("export_type, entity_type, record_count, file_size_bytes").eq("organization_id",e);if(s){if("PGRST116"===s.code||"PGRST200"===s.code||"42P01"===s.code||"PGRST301"===s.code||400===s.status||404===s.status||"400"===s.code||"404"===s.code||s.message?.includes("relation")||s.message?.includes("does not exist"))return{total:0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};throw s}let o={total:t?.length||0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};return t?.forEach(e=>{o.byType[e.export_type]=(o.byType[e.export_type]||0)+1,o.byEntity[e.entity_type]=(o.byEntity[e.entity_type]||0)+1,o.totalRecords+=e.record_count||0,o.totalSizeBytes+=e.file_size_bytes||0}),o}catch(e){if(e?.code==="PGRST116"||e?.code==="PGRST200"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===400||e?.status===404||e?.code==="400"||e?.code==="404"||e?.message?.includes("relation")||e?.message?.includes("does not exist"))return{total:0,byType:{},byEntity:{},totalRecords:0,totalSizeBytes:0};throw e}}async delete(e,t){let{error:s}=await this.supabase.from("export_history").delete().eq("id",e).eq("user_id",t);if(s)throw s}async deleteByUser(e,t){let{error:s}=await this.supabase.from("export_history").delete().eq("user_id",e).eq("organization_id",t);if(s)throw s}}let o=new s;e.s(["ExportHistoryService",()=>s,"exportHistoryService",0,o])}]);