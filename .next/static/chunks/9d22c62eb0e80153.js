(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let s=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>s],107233)},263488,e=>{"use strict";let s=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>s],263488)},738308,e=>{"use strict";let s=(0,e.i(475254).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>s],738308)},436332,e=>{"use strict";let s=(0,e.i(475254).default)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);e.s(["Edit",()=>s],436332)},182774,e=>{"use strict";var s=e.i(843476),t=e.i(325715),a=e.i(618566),r=e.i(271645);let i=(0,e.i(475254).default)("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var l=e.i(167881),n=e.i(970065),d=e.i(522016);function c({children:e,allowedRoles:c,fallback:o,redirectTo:u="/dashboard"}){let{user:x,isLoading:m}=(0,t.useAuth)(),h=(0,a.useRouter)(),[j,g]=(0,r.useState)(null);return((0,r.useEffect)(()=>{if(!m&&x){let e=x.role||"",s=c.includes(e);g(s),s||!u||o||h.push(u)}},[x,m,c,u,h,o]),m||null===j)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):j?(0,s.jsx)(s.Fragment,{children:e}):o?(0,s.jsx)(s.Fragment,{children:o}):(0,s.jsx)("div",{className:"container mx-auto py-16 px-4",children:(0,s.jsx)(n.Card,{className:"max-w-md mx-auto",children:(0,s.jsxs)(n.CardContent,{className:"py-12 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,s.jsx)(i,{className:"h-8 w-8 text-red-600"})}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"AccÃ¨s non autorisÃ©"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Vous n'avez pas les permissions nÃ©cessaires pour accÃ©der Ã  cette page."}),(0,s.jsx)(d.default,{href:"/dashboard",children:(0,s.jsx)(l.Button,{children:"Retour au tableau de bord"})})]})})})}e.s(["ADMIN_ROLES",0,["super_admin","admin","secretary","accountant"],"FINANCE_ROLES",0,["super_admin","admin","secretary","accountant"],"FORMATION_MANAGEMENT_ROLES",0,["super_admin","admin","secretary"],"RoleGuard",()=>c],182774)},238491,e=>{"use strict";let s=(0,e.i(475254).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);e.s(["Phone",()=>s],238491)},367606,e=>{"use strict";var s=e.i(843476),t=e.i(271645),a=e.i(266027),r=e.i(954616),i=e.i(912598),l=e.i(325715),n=e.i(920755),d=e.i(167881),c=e.i(970065),o=e.i(23750),u=e.i(994179),x=e.i(6799),m=e.i(182774),h=e.i(761911),j=e.i(107233),g=e.i(555436),p=e.i(263488),f=e.i(238491),N=e.i(465286),b=e.i(738308),v=e.i(16715),y=e.i(436332),C=e.i(522016),_=e.i(647163);let w={super_admin:"Super Administrateur",admin:"Administrateur",teacher:"Enseignant",secretary:"SecrÃ©taire",accountant:"Comptable",parent:"Parent",student:"Ã‰tudiant"},S={super_admin:"bg-purple-100 text-purple-800",admin:"bg-blue-100 text-blue-800",teacher:"bg-green-100 text-green-800",secretary:"bg-orange-100 text-orange-800",accountant:"bg-yellow-100 text-yellow-800",parent:"bg-gray-100 text-gray-800",student:"bg-cyan-100 text-cyan-800"};function R(){let{user:e}=(0,l.useAuth)(),m=(0,n.createClient)(),R=(0,i.useQueryClient)(),{addToast:E}=(0,x.useToast)(),[z,k]=(0,t.useState)(""),[A,M]=(0,t.useState)(null);(0,t.useEffect)(()=>{let e=()=>{R.invalidateQueries({queryKey:["organization-users"]})};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[R]);let{data:U=[],isLoading:q}=(0,a.useQuery)({queryKey:["organization-users",e?.organization_id,z,A],queryFn:async()=>{if(!e?.organization_id)return console.log("âš ï¸ [USERS] Pas d'organization_id pour l'utilisateur:",e?.id),[];console.log("ðŸ” [USERS] RÃ©cupÃ©ration des utilisateurs pour organization_id:",e.organization_id),console.log("ðŸ” [USERS] Utilisateur actuel:",{id:e.id,email:e.email,role:e.role,organization_id:e.organization_id});let s=m.from("users").select("id, email, full_name, phone, role, is_active, last_login_at, created_at, updated_at, organization_id").eq("organization_id",e.organization_id).order("created_at",{ascending:!1});console.log("ðŸ” [USERS] RequÃªte Supabase construite, exÃ©cution..."),z&&(s=s.or(`full_name.ilike.%${z}%,email.ilike.%${z}%`)),A&&(s=s.eq("role",A),console.log("ðŸ” [USERS] Filtre par rÃ´le appliquÃ©:",A));let{data:t,error:a}=await s;if(a)throw console.error("âŒ [USERS] Erreur lors de la rÃ©cupÃ©ration:",a),a;if(console.log("âœ… [USERS] Utilisateurs rÃ©cupÃ©rÃ©s:",t?.length||0),t&&t.length>0){let e=t.map(e=>({id:e.id,email:e.email,full_name:e.full_name,role:e.role,organization_id:e.organization_id,is_active:e.is_active}));console.log("ðŸ“‹ [USERS] DÃ©tails des utilisateurs:",e),console.log("ðŸ“‹ [USERS] DÃ©tails complets (pour debug):",JSON.stringify(e,null,2)),console.log("ðŸ“Š [USERS] RÃ©partition par rÃ´le:",{teachers:t.filter(e=>"teacher"===e.role).length,admins:t.filter(e=>"admin"===e.role||"super_admin"===e.role).length,secretaries:t.filter(e=>"secretary"===e.role).length,accountants:t.filter(e=>"accountant"===e.role).length,others:t.filter(e=>!["teacher","admin","super_admin","secretary","accountant"].includes(e.role)).length})}else console.warn("âš ï¸ [USERS] Aucun utilisateur trouvÃ© pour organization_id:",e.organization_id);return t||[]},enabled:!!e?.organization_id,refetchOnMount:!0,refetchOnWindowFocus:!0,staleTime:0}),P=(0,r.useMutation)({mutationFn:async({userId:e,isActive:s})=>{let{error:t}=await m.from("users").update({is_active:!s}).eq("id",e);if(t)throw t},onSuccess:()=>{R.invalidateQueries({queryKey:["organization-users"]}),E({title:"SuccÃ¨s",description:"Le statut de l'utilisateur a Ã©tÃ© mis Ã  jour",type:"success"})},onError:e=>{E({title:"Erreur",description:e.message||"Erreur lors de la mise Ã  jour",type:"error"})}}),B={total:U.length,active:U.filter(e=>e.is_active).length,inactive:U.filter(e=>!e.is_active).length,byRole:Object.keys(w).reduce((e,s)=>(e[s]=U.filter(e=>e.role===s).length,e),{})};return q?(0,s.jsx)("div",{className:"container mx-auto py-8 px-4",children:(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)(v.RefreshCw,{className:"h-8 w-8 animate-spin text-brand-blue"})})}):(0,s.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-2",children:[(0,s.jsx)(h.Users,{className:"h-8 w-8 text-brand-blue"}),"Gestion des utilisateurs"]}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"GÃ©rez les utilisateurs de votre organisation"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,s.jsx)(c.Card,{children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total utilisateurs"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:B.total})]}),(0,s.jsx)(h.Users,{className:"h-8 w-8 text-blue-500"})]})})}),(0,s.jsx)(c.Card,{children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Actifs"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-green-600",children:B.active})]}),(0,s.jsx)(N.CheckCircle2,{className:"h-8 w-8 text-green-500"})]})})}),(0,s.jsx)(c.Card,{children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Inactifs"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-red-600",children:B.inactive})]}),(0,s.jsx)(b.XCircle,{className:"h-8 w-8 text-red-500"})]})})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-8",children:[(0,s.jsx)(c.Card,{children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Administrateurs"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-purple-600",children:(B.byRole.admin||0)+(B.byRole.super_admin||0)})]})})}),(0,s.jsx)(c.Card,{children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Enseignants"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-green-600",children:B.byRole.teacher||0})]})})}),(0,s.jsx)(c.Card,{children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"SecrÃ©taires"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:B.byRole.secretary||0})]})})}),(0,s.jsx)(c.Card,{children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Comptables"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:B.byRole.accountant||0})]})})}),(0,s.jsx)(c.Card,{children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Parents"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-600",children:B.byRole.parent||0})]})})}),(0,s.jsx)(c.Card,{children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-1",children:"Ã‰tudiants"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-cyan-600",children:B.byRole.student||0})]})})})]}),(0,s.jsx)(c.Card,{className:"mb-6",children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex flex-col md:flex-row gap-4",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(g.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),(0,s.jsx)(o.Input,{placeholder:"Rechercher par nom ou email...",value:z,onChange:e=>k(e.target.value),className:"pl-10"})]})}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(d.Button,{variant:null===A?"default":"outline",onClick:()=>M(null),children:"Tous"}),Object.keys(w).map(e=>(0,s.jsx)(d.Button,{variant:A===e?"default":"outline",onClick:()=>M(A===e?null:e),children:w[e]},e))]}),(0,s.jsxs)(d.Button,{variant:"outline",onClick:()=>{R.invalidateQueries({queryKey:["organization-users"]}),R.refetchQueries({queryKey:["organization-users"]}),E({type:"info",title:"Actualisation",description:"Liste des utilisateurs actualisÃ©e"})},disabled:q,children:[(0,s.jsx)(v.RefreshCw,{className:`h-4 w-4 mr-2 ${q?"animate-spin":""}`}),"Actualiser"]}),(0,s.jsx)(d.Button,{asChild:!0,children:(0,s.jsxs)(C.default,{href:"/dashboard/settings/users/new",children:[(0,s.jsx)(j.Plus,{className:"h-4 w-4 mr-2"}),"Nouvel utilisateur"]})})]})})}),(0,s.jsxs)(c.Card,{children:[(0,s.jsxs)(c.CardHeader,{children:[(0,s.jsx)(c.CardTitle,{children:"Liste des utilisateurs"}),(0,s.jsxs)(c.CardDescription,{children:[U.length," utilisateur",U.length>1?"s":""," trouvÃ©",U.length>1?"s":""]})]}),(0,s.jsx)(c.CardContent,{children:0===U.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(h.Users,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:z||A?"Aucun utilisateur ne correspond Ã  vos critÃ¨res":"Aucun utilisateur trouvÃ©"}),!z&&!A&&(0,s.jsx)(d.Button,{asChild:!0,children:(0,s.jsxs)(C.default,{href:"/dashboard/settings/users/new",children:[(0,s.jsx)(j.Plus,{className:"h-4 w-4 mr-2"}),"CrÃ©er le premier utilisateur"]})})]}):(0,s.jsx)("div",{className:"space-y-4",children:U.map(e=>(0,s.jsx)(c.Card,{className:"hover:shadow-md transition-shadow",children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:e.full_name||"Sans nom"}),(0,s.jsx)(u.Badge,{className:S[e.role]||"bg-gray-100 text-gray-800",children:w[e.role]||e.role}),e.is_active?(0,s.jsxs)(u.Badge,{className:"bg-green-100 text-green-800",children:[(0,s.jsx)(N.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Actif"]}):(0,s.jsxs)(u.Badge,{className:"bg-red-100 text-red-800",children:[(0,s.jsx)(b.XCircle,{className:"h-3 w-3 mr-1"}),"Inactif"]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,s.jsx)(p.Mail,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:e.email})]}),e.phone&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,s.jsx)(f.Phone,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:e.phone})]}),e.last_login_at&&(0,s.jsxs)("div",{className:"text-muted-foreground",children:["DerniÃ¨re connexion: ",(0,_.formatDate)(e.last_login_at)]}),(0,s.jsxs)("div",{className:"text-muted-foreground",children:["CrÃ©Ã© le: ",(0,_.formatDate)(e.created_at||"")]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(d.Button,{variant:"outline",size:"sm",onClick:()=>P.mutate({userId:e.id,isActive:e.is_active??!1}),disabled:P.isPending,children:e.is_active?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.XCircle,{className:"h-4 w-4 mr-2"}),"DÃ©sactiver"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Activer"]})}),(0,s.jsx)(d.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,s.jsxs)(C.default,{href:`/dashboard/settings/users/${e.id}`,children:[(0,s.jsx)(y.Edit,{className:"h-4 w-4 mr-2"}),"Modifier"]})})]})]})})},e.id))})})]})]})}function E(){return(0,s.jsx)(m.RoleGuard,{allowedRoles:m.ADMIN_ROLES,children:(0,s.jsx)(R,{})})}e.s(["default",()=>E])}]);