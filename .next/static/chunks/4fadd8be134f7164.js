(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let s=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>s],107233)},503116,e=>{"use strict";let s=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>s],503116)},286536,e=>{"use strict";let s=(0,e.i(475254).default)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>s],286536)},127341,e=>{"use strict";var s=e.i(843476),t=e.i(271645),a=e.i(647163);let r=t.createContext(void 0);function i({value:e,defaultValue:i,onValueChange:n,children:d,className:l}){let c=void 0!==e,[o,u]=t.useState(i??"");t.useEffect(()=>{c||void 0===i||u(i)},[i]);let m=c?e:o,x=t.useCallback(e=>{c||u(e),n?.(e)},[c,n]);return(0,s.jsx)(r.Provider,{value:{value:m,onValueChange:x},children:(0,s.jsx)("div",{className:(0,a.cn)("w-full",l),children:d})})}function n(){let e=t.useContext(r);if(!e)throw Error("Tabs components must be used within a Tabs component");return e}function d({children:e,className:t}){return(0,s.jsx)("div",{className:(0,a.cn)("inline-flex h-10 items-center justify-center rounded-lg bg-bg-gray-100 p-1 text-text-tertiary",t),children:e})}function l({value:e,children:t,className:r}){let{value:i,onValueChange:d}=n(),l=i===e;return(0,s.jsx)("button",{type:"button",onClick:()=>d(e),className:(0,a.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-outline-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",l?"bg-white text-text-primary shadow-sm":"text-text-tertiary hover:text-text-primary",r),children:t})}function c({value:e,children:t,className:r}){let{value:i}=n();return i!==e?null:(0,s.jsx)("div",{className:(0,a.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",r),children:t})}e.s(["Tabs",()=>i,"TabsContent",()=>c,"TabsList",()=>d,"TabsTrigger",()=>l])},658041,e=>{"use strict";let s=(0,e.i(475254).default)("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);e.s(["Database",()=>s],658041)},172815,e=>{"use strict";var s=e.i(843476),t=e.i(266027),a=e.i(912598),r=e.i(325715),i=e.i(920755);let n=new class{supabase;constructor(e){this.supabase=e||(0,i.createClient)()}async getUserConsents(e,s){let{data:t,error:a}=await this.supabase.from("gdpr_consents").select("*").eq("organization_id",e).eq("user_id",s).order("created_at",{ascending:!1});if(a)throw a;return t||[]}async updateConsent(e){let s={...e,updated_at:new Date().toISOString()};e.granted?(s.granted_at=new Date().toISOString(),s.withdrawn_at=null):s.withdrawn_at=new Date().toISOString();let{data:t,error:a}=await this.supabase.from("gdpr_consents").upsert(s,{onConflict:"organization_id,user_id,consent_type"}).select().single();if(a)throw a;return t}async getProcessingRegistry(e){let{data:s,error:t}=await this.supabase.from("gdpr_processing_registry").select("*").eq("organization_id",e).eq("status","active").order("processing_name",{ascending:!0});if(t){if("PGRST200"===t.code||404===t.status||t.message?.includes("does not exist"))return[];throw t}return s||[]}async upsertProcessingRegistry(e){let{data:s,error:t}=await this.supabase.from("gdpr_processing_registry").upsert(e,{onConflict:"id"}).select().single();if(t)throw t;return s}async createDataSubjectRequest(e){let{data:s,error:t}=await this.supabase.from("gdpr_data_subject_requests").insert(e).select().single();if(t)throw t;return s}async getDataSubjectRequests(e,s){let t=this.supabase.from("gdpr_data_subject_requests").select("*").eq("organization_id",e);s?.userId&&(t=t.eq("user_id",s.userId)),s?.requestType&&(t=t.eq("request_type",s.requestType)),s?.status&&(t=t.eq("request_status",s.status));let{data:a,error:r}=await t.order("request_date",{ascending:!1});if(r){if("PGRST200"===r.code||404===r.status||r.message?.includes("does not exist"))return[];throw r}return a||[]}async exportUserData(e,s){let t={profile:await this.getUserProfile(s),enrollments:await this.getUserEnrollments(s),payments:await this.getUserPayments(e,s),documents:await this.getUserDocuments(e,s),consents:await this.getUserConsents(e,s)},{data:a,error:r}=await this.supabase.from("gdpr_data_exports").insert({organization_id:e,user_id:s,export_format:"json",file_url:"",data_categories:Object.keys(t),created_by:(await this.supabase.auth.getUser()).data.user?.id||""}).select().single();if(r)throw r;return{exportId:a.id,fileUrl:a.file_url||""}}async deleteUserData(e,s,t="anonymization"){let{data:a,error:r}=await this.supabase.from("gdpr_data_deletions").insert({organization_id:e,user_id:s,deletion_type:t,data_categories:["all"],deletion_status:"pending",performed_by:(await this.supabase.auth.getUser()).data.user?.id||""}).select().single();if(r)throw r;return{deletionId:a.id,status:a.deletion_status}}async getDataBreaches(e){let{data:s,error:t}=await this.supabase.from("gdpr_data_breaches").select("*").eq("organization_id",e).order("breach_date",{ascending:!1});if(t){if("PGRST200"===t.code||404===t.status||t.message?.includes("does not exist"))return[];throw t}return s||[]}async createDataBreach(e){let{data:s,error:t}=await this.supabase.from("gdpr_data_breaches").insert(e).select().single();if(t)throw t;return s}async notifyCNIL(e){let{error:s}=await this.supabase.from("gdpr_data_breaches").update({cnil_notified:!0,cnil_notification_date:new Date().toISOString(),updated_at:new Date().toISOString()}).eq("id",e);if(s)throw s}async getUserProfile(e){let{data:s}=await this.supabase.from("users").select("*").eq("id",e).single();return s}async getUserEnrollments(e){let{data:s}=await this.supabase.from("enrollments").select("*").eq("student_id",e);return s||[]}async getUserPayments(e,s){let{data:t}=await this.supabase.from("payments").select("*").eq("organization_id",e).eq("student_id",s);return t||[]}async getUserDocuments(e,s){let{data:t}=await this.supabase.from("generated_documents").select("*").eq("organization_id",e).eq("student_id",s);return t||[]}};var d=e.i(970065),l=e.i(167881),c=e.i(994179),o=e.i(127341),u=e.i(6799),m=e.i(98919),x=e.i(465286),h=e.i(503116),g=e.i(898791),j=e.i(178583),p=e.i(16715),f=e.i(107233),b=e.i(286536),y=e.i(658041),N=e.i(270756),v=e.i(522016),_=e.i(647163);let w={pending:"bg-yellow-100 text-yellow-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",cancelled:"bg-gray-100 text-gray-800",open:"bg-red-100 text-red-800",investigating:"bg-yellow-100 text-yellow-800",remediated:"bg-green-100 text-green-800",closed:"bg-gray-100 text-gray-800"},C={low:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",high:"bg-orange-100 text-orange-800",critical:"bg-red-100 text-red-800"};function q(){let{user:e}=(0,r.useAuth)();(0,a.useQueryClient)();let{addToast:i}=(0,u.useToast)(),{data:q=[],isLoading:D}=(0,t.useQuery)({queryKey:["gdpr-data-requests",e?.organization_id],queryFn:()=>n.getDataSubjectRequests(e.organization_id),enabled:!!e?.organization_id}),{data:T=[],isLoading:P}=(0,t.useQuery)({queryKey:["gdpr-data-breaches",e?.organization_id],queryFn:()=>n.getDataBreaches(e.organization_id),enabled:!!e?.organization_id}),{data:z=[],isLoading:R}=(0,t.useQuery)({queryKey:["gdpr-processing-registry",e?.organization_id],queryFn:()=>n.getProcessingRegistry(e.organization_id),enabled:!!e?.organization_id}),B={totalRequests:q.length,pendingRequests:q.filter(e=>"pending"===e.request_status||"in_progress"===e.request_status).length,totalBreaches:T.length,openBreaches:T.filter(e=>"open"===e.status||"investigating"===e.status).length,totalProcessings:z.length};return D||P||R?(0,s.jsx)("div",{className:"container mx-auto py-8 px-4",children:(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)(p.RefreshCw,{className:"h-8 w-8 animate-spin text-brand-blue"})})}):(0,s.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-2",children:[(0,s.jsx)(m.Shield,{className:"h-8 w-8 text-brand-blue"}),"Conformité RGPD"]}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Gérez la conformité RGPD : consentements, registre des traitements, demandes des personnes concernées"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,s.jsx)(d.Card,{children:(0,s.jsx)(d.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Demandes en attente"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:B.pendingRequests})]}),(0,s.jsx)(h.Clock,{className:"h-8 w-8 text-yellow-500"})]})})}),(0,s.jsx)(d.Card,{children:(0,s.jsx)(d.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Violations ouvertes"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:B.openBreaches})]}),(0,s.jsx)(g.AlertCircle,{className:"h-8 w-8 text-red-500"})]})})}),(0,s.jsx)(d.Card,{children:(0,s.jsx)(d.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Traitements actifs"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:B.totalProcessings})]}),(0,s.jsx)(y.Database,{className:"h-8 w-8 text-blue-500"})]})})}),(0,s.jsx)(d.Card,{children:(0,s.jsx)(d.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total demandes"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:B.totalRequests})]}),(0,s.jsx)(j.FileText,{className:"h-8 w-8 text-green-500"})]})})})]}),(0,s.jsxs)(o.Tabs,{defaultValue:"requests",className:"space-y-6",children:[(0,s.jsxs)(o.TabsList,{children:[(0,s.jsx)(o.TabsTrigger,{value:"requests",children:"Demandes de droits"}),(0,s.jsx)(o.TabsTrigger,{value:"breaches",children:"Violations de données"}),(0,s.jsx)(o.TabsTrigger,{value:"registry",children:"Registre des traitements"}),(0,s.jsx)(o.TabsTrigger,{value:"consents",children:"Consentements"})]}),(0,s.jsx)(o.TabsContent,{value:"requests",children:(0,s.jsxs)(d.Card,{children:[(0,s.jsx)(d.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d.CardTitle,{children:"Demandes des personnes concernées"}),(0,s.jsx)(d.CardDescription,{children:"Gestion des demandes d'accès, rectification, effacement et portabilité"})]}),(0,s.jsx)(l.Button,{asChild:!0,children:(0,s.jsxs)(v.default,{href:"/dashboard/gdpr/requests/new",children:[(0,s.jsx)(f.Plus,{className:"h-4 w-4 mr-2"}),"Nouvelle demande"]})})]})}),(0,s.jsx)(d.CardContent,{children:0===q.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(j.FileText,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"Aucune demande de droits RGPD enregistrée"})]}):(0,s.jsx)("div",{className:"space-y-4",children:q.map(e=>(0,s.jsx)(d.Card,{className:"hover:shadow-md transition-shadow",children:(0,s.jsx)(d.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:e.request_type.replace(/_/g," ").toUpperCase()}),(0,s.jsx)(c.Badge,{className:w[e.request_status],children:e.request_status.replace(/_/g," ")}),!e.identity_verified&&(0,s.jsx)(c.Badge,{variant:"outline",className:"bg-yellow-50",children:"Vérification requise"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Demandeur"}),(0,s.jsx)("p",{className:"font-medium",children:e.requested_by_name}),(0,s.jsx)("p",{className:"text-muted-foreground",children:e.requested_by_email})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Date de demande"}),(0,s.jsx)("p",{className:"font-medium",children:(0,_.formatDateTime)(e.request_date)})]}),e.completed_at&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Date de traitement"}),(0,s.jsx)("p",{className:"font-medium",children:(0,_.formatDateTime)(e.completed_at)})]})]}),e.description&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:e.description})]}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsx)(l.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,s.jsxs)(v.default,{href:`/dashboard/gdpr/requests/${e.id}`,children:[(0,s.jsx)(b.Eye,{className:"h-4 w-4 mr-2"}),"Voir"]})})})]})})},e.id))})})]})}),(0,s.jsx)(o.TabsContent,{value:"breaches",children:(0,s.jsxs)(d.Card,{children:[(0,s.jsx)(d.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d.CardTitle,{children:"Violations de données"}),(0,s.jsx)(d.CardDescription,{children:"Gestion des violations de données personnelles (Article 33-34 RGPD)"})]}),(0,s.jsx)(l.Button,{asChild:!0,children:(0,s.jsxs)(v.default,{href:"/dashboard/gdpr/breaches/new",children:[(0,s.jsx)(f.Plus,{className:"h-4 w-4 mr-2"}),"Déclarer une violation"]})})]})}),(0,s.jsx)(d.CardContent,{children:0===T.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(N.Lock,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"Aucune violation de données déclarée"})]}):(0,s.jsx)("div",{className:"space-y-4",children:T.map(e=>(0,s.jsx)(d.Card,{className:"hover:shadow-md transition-shadow",children:(0,s.jsx)(d.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold",children:["Violation ",e.breach_type]}),(0,s.jsx)(c.Badge,{className:C[e.severity],children:e.severity}),(0,s.jsx)(c.Badge,{className:w[e.status],children:e.status})]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:e.description}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Date de violation"}),(0,s.jsx)("p",{className:"font-medium",children:(0,_.formatDate)(e.breach_date)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Découverte"}),(0,s.jsx)("p",{className:"font-medium",children:(0,_.formatDate)(e.discovery_date)})]}),e.affected_data_subjects_count&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Personnes concernées"}),(0,s.jsx)("p",{className:"font-medium",children:e.affected_data_subjects_count})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"CNIL notifiée"}),(0,s.jsx)("p",{className:"font-medium",children:e.cnil_notified?(0,s.jsx)(x.CheckCircle2,{className:"h-4 w-4 text-green-500 inline"}):(0,s.jsx)(g.AlertCircle,{className:"h-4 w-4 text-red-500 inline"})})]})]})]}),(0,s.jsx)(l.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,s.jsx)(v.default,{href:`/dashboard/gdpr/breaches/${e.id}`,children:"Voir les détails"})})]})})},e.id))})})]})}),(0,s.jsx)(o.TabsContent,{value:"registry",children:(0,s.jsxs)(d.Card,{children:[(0,s.jsx)(d.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(d.CardTitle,{children:"Registre des traitements"}),(0,s.jsx)(d.CardDescription,{children:"Article 30 RGPD - Registre des activités de traitement"})]}),(0,s.jsx)(l.Button,{asChild:!0,children:(0,s.jsxs)(v.default,{href:"/dashboard/gdpr/registry/new",children:[(0,s.jsx)(f.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter un traitement"]})})]})}),(0,s.jsx)(d.CardContent,{children:0===z.length?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(y.Database,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"Aucun traitement enregistré"}),(0,s.jsx)(l.Button,{asChild:!0,children:(0,s.jsxs)(v.default,{href:"/dashboard/gdpr/registry/new",children:[(0,s.jsx)(f.Plus,{className:"h-4 w-4 mr-2"}),"Créer le premier traitement"]})})]}):(0,s.jsx)("div",{className:"space-y-4",children:z.map(e=>(0,s.jsx)(d.Card,{className:"hover:shadow-md transition-shadow",children:(0,s.jsx)(d.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:e.processing_name}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:e.processing_purpose}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Base légale"}),(0,s.jsx)("p",{className:"font-medium",children:e.legal_basis.replace(/_/g," ")})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Catégories de données"}),(0,s.jsx)("p",{className:"font-medium",children:e.data_categories.length})]}),e.retention_period&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Conservation"}),(0,s.jsx)("p",{className:"font-medium",children:e.retention_period})]})]})]}),(0,s.jsx)(l.Button,{variant:"outline",size:"sm",asChild:!0,children:(0,s.jsx)(v.default,{href:`/dashboard/gdpr/registry/${e.id}`,children:"Voir les détails"})})]})})},e.id))})})]})}),(0,s.jsx)(o.TabsContent,{value:"consents",children:(0,s.jsxs)(d.Card,{children:[(0,s.jsxs)(d.CardHeader,{children:[(0,s.jsx)(d.CardTitle,{children:"Gestion des consentements"}),(0,s.jsx)(d.CardDescription,{children:"Consultez et gérez les consentements RGPD des utilisateurs"})]}),(0,s.jsx)(d.CardContent,{children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(m.Shield,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"Fonctionnalité en cours de développement"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"La gestion détaillée des consentements sera disponible prochainement"})]})})]})})]}),(0,s.jsxs)("div",{className:"mt-8 flex gap-4",children:[(0,s.jsx)(l.Button,{variant:"outline",asChild:!0,children:(0,s.jsxs)(v.default,{href:"/dashboard/gdpr/reports",children:[(0,s.jsx)(j.FileText,{className:"h-4 w-4 mr-2"}),"Rapports de conformité"]})}),(0,s.jsx)(l.Button,{variant:"outline",asChild:!0,children:(0,s.jsxs)(v.default,{href:"/dashboard/gdpr/settings",children:[(0,s.jsx)(m.Shield,{className:"h-4 w-4 mr-2"}),"Paramètres RGPD"]})})]})]})}e.s(["default",()=>q],172815)}]);