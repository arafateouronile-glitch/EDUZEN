(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let s=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>s],107233)},871689,e=>{"use strict";let s=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],871689)},645760,e=>{"use strict";var s=e.i(843476),t=e.i(271645),r=e.i(647163);e.i(882205);var a=e.i(846932);let i=t.forwardRef(({className:e,variant:t="default",hoverable:i=!1,glow:n=!1,glowColor:o="rgba(51, 90, 207, 0.3)",...l},d)=>(0,s.jsxs)(a.motion.div,{ref:d,className:(0,r.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===t,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===t,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===t,"cursor-pointer":i,"hover:shadow-2xl hover:scale-[1.02]":i,"hover:bg-white/90 dark:hover:bg-gray-900/90":i},e),whileHover:i?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...l,children:[n&&(0,s.jsx)(a.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${o} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,s.jsx)("div",{className:"relative z-10",children:l.children})]}));i.displayName="GlassCard",e.s(["GlassCard",()=>i])},356909,e=>{"use strict";let s=(0,e.i(475254).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);e.s(["Save",()=>s],356909)},569074,e=>{"use strict";let s=(0,e.i(475254).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>s],569074)},186156,e=>{"use strict";var s=e.i(920755);let t=new class{supabase;constructor(e){this.supabase=e||(0,s.createClient)()}async getCourses(e,s){try{let t=this.supabase.from("courses").select("*, instructor:users(id, full_name, email), formation:formations(*)").eq("organization_id",e);s?.instructorId&&(t=t.eq("instructor_id",s.instructorId)),s?.isPublished!==void 0&&(t=t.eq("is_published",s.isPublished)),s?.isFeatured&&(t=t.eq("is_featured",!0)),s?.difficulty&&(t=t.eq("difficulty_level",s.difficulty)),s?.search&&(t=t.or(`title.ilike.%${s.search}%,description.ilike.%${s.search}%`));let{data:r,error:a}=await t.order("created_at",{ascending:!1});if(a){if("PGRST116"===a.code||"42P01"===a.code||"PGRST301"===a.code||400===a.status||"400"===a.code||a.message?.includes("relation")||a.message?.includes("relationship")||a.message?.includes("does not exist")||a.message?.includes("schema cache"))return console.warn("Table courses does not exist yet or invalid query:",a.message),[];throw a}return r||[]}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===400||e?.code==="400"||e?.message?.includes("relation")||e?.message?.includes("relationship")||e?.message?.includes("does not exist")||e?.message?.includes("schema cache"))return console.warn("Table courses does not exist yet or invalid query:",e?.message||String(e)),[];throw e}}async getCourseBySlug(e,s){try{let t=this.supabase.from("courses").select(`
          *,
          instructor:users(id, full_name, email),
          formation:formations(*),
          sections:course_sections(*),
          lessons:lessons(*)
        `).eq("slug",e).eq("organization_id",s),{data:r,error:a}=await t.maybeSingle();if(a){if("PGRST116"===a.code||"42P01"===a.code||"PGRST301"===a.code||400===a.status||"400"===a.code||a.message?.includes("relation")||a.message?.includes("relationship")||a.message?.includes("does not exist")||a.message?.includes("schema cache"))return console.warn("Table courses or relations do not exist yet or invalid query:",a.message),null;throw a}return r}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===400||e?.code==="400"||e?.message?.includes("relation")||e?.message?.includes("relationship")||e?.message?.includes("does not exist")||e?.message?.includes("schema cache"))return console.warn("Table courses or relations do not exist yet or invalid query:",e?.message),null;throw e}}async createCourse(e){let{data:s,error:t}=await this.supabase.from("courses").insert(e).select().single();if(t)throw t;return s}async updateCourse(e,s){let{data:t,error:r}=await this.supabase.from("courses").update(s).eq("id",e).select().single();if(r)throw r;return t}async deleteCourse(e){let{error:s}=await this.supabase.from("courses").delete().eq("id",e);if(s)throw s}async getCourseSections(e){let{data:s,error:t}=await this.supabase.from("course_sections").select("*").eq("course_id",e).order("order_index",{ascending:!0});if(t)throw t;return s}async createSection(e){let{data:s,error:t}=await this.supabase.from("course_sections").insert(e).select().single();if(t)throw t;return s}async updateSection(e,s){let{data:t,error:r}=await this.supabase.from("course_sections").update(s).eq("id",e).select().single();if(r)throw r;return t}async deleteSection(e){let{error:s}=await this.supabase.from("lessons").update({section_id:null}).eq("section_id",e);if(s)throw s;let{error:t}=await this.supabase.from("course_sections").delete().eq("id",e);if(t)throw t}async getCourseLessons(e){let{data:s,error:t}=await this.supabase.from("lessons").select("*").eq("course_id",e).order("order_index",{ascending:!0});if(t)throw t;return s}async getLessonById(e){let{data:s,error:t}=await this.supabase.from("lessons").select("*, course:courses(*), section:course_sections(*)").eq("id",e).single();if(t)throw t;return s}async getLessonBySlug(e,s){let{data:t,error:r}=await this.supabase.from("lessons").select("*, course:courses(*), section:course_sections(*)").eq("slug",e).eq("course_id",s).single();if(r)throw r;return t}async createLesson(e){let{data:s,error:t}=await this.supabase.from("lessons").insert(e).select().single();if(t)throw t;return await this.updateCourseLessonCount(e.course_id),s}async updateLesson(e,s){let{data:t,error:r}=await this.supabase.from("lessons").update(s).eq("id",e).select().single();if(r)throw r;return t}async deleteLesson(e){let{data:s}=await this.supabase.from("lessons").select("course_id").eq("id",e).single(),{error:t}=await this.supabase.from("lessons").delete().eq("id",e);if(t)throw t;s&&await this.updateCourseLessonCount(s.course_id)}async updateCourseLessonCount(e){let{count:s}=await this.supabase.from("lessons").select("*",{count:"exact",head:!0}).eq("course_id",e);await this.supabase.from("courses").update({total_lessons:s||0}).eq("id",e)}async enrollInCourse(e,s){let{data:t,error:r}=await this.supabase.from("course_enrollments").insert({course_id:e,student_id:s,enrollment_status:"enrolled"}).select().single();if(r)throw r;return await this.incrementCourseStudentCount(e),t}async getStudentEnrollments(e){try{let{data:s,error:t}=await this.supabase.from("course_enrollments").select(`
          *,
          course:courses(*, instructor:users(id, full_name, email))
        `).eq("student_id",e).order("enrolled_at",{ascending:!1});if(t){if("PGRST116"===t.code||"42P01"===t.code||"PGRST301"===t.code||400===t.status||"400"===t.code||t.message?.includes("relation")||t.message?.includes("relationship")||t.message?.includes("does not exist")||t.message?.includes("schema cache"))return console.warn("Table course_enrollments does not exist yet or invalid query:",t.message),[];throw t}return s||[]}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===400||e?.code==="400"||e?.message?.includes("relation")||e?.message?.includes("relationship")||e?.message?.includes("does not exist")||e?.message?.includes("schema cache"))return console.warn("Table course_enrollments does not exist yet or invalid query:",e?.message||String(e)),[];throw e}}async getCourseEnrollments(e){let{data:s,error:t}=await this.supabase.from("course_enrollments").select(`
        *,
        student:users(id, full_name, email)
      `).eq("course_id",e).order("enrolled_at",{ascending:!1});if(t)throw t;return s}async updateEnrollment(e,s){let{data:t,error:r}=await this.supabase.from("course_enrollments").update(s).eq("id",e).select().single();if(r)throw r;return t}async incrementCourseStudentCount(e){let{data:s}=await this.supabase.from("courses").select("total_students").eq("id",e).single();s&&await this.supabase.from("courses").update({total_students:(s.total_students||0)+1}).eq("id",e)}async getLessonProgress(e,s){let{data:t,error:r}=await this.supabase.from("lesson_progress").select("*").eq("lesson_id",e).eq("student_id",s).maybeSingle();if(r)throw r;return t}async updateLessonProgress(e,s,t){let r=await this.getLessonProgress(e,s);if(r){let{data:e,error:s}=await this.supabase.from("lesson_progress").update({...t,last_accessed_at:new Date().toISOString()}).eq("id",r.id).select().single();if(s)throw s;return e}{let{data:r,error:a}=await this.supabase.from("lesson_progress").insert({lesson_id:e,student_id:s,...t,started_at:new Date().toISOString(),last_accessed_at:new Date().toISOString()}).select().single();if(a)throw a;return r}}async markLessonAsCompleted(e,s){return this.updateLessonProgress(e,s,{is_completed:!0,completion_percentage:100,completed_at:new Date().toISOString()})}async getQuiz(e){let{data:s,error:t}=await this.supabase.from("quizzes").select("*, questions:quiz_questions(*)").eq("id",e).single();if(t)throw t;return s}async createQuiz(e){let{data:s,error:t}=await this.supabase.from("quizzes").insert(e).select().single();if(t)throw t;return s}async createQuizQuestion(e){let{data:s,error:t}=await this.supabase.from("quiz_questions").insert(e).select().single();if(t)throw t;return s}async submitQuizAttempt(e){let s=await this.getQuiz(e.quiz_id);if(!s||!s.questions)throw Error("Quiz non trouvé");let t=s.questions,r=e.answers,a=0,i=t.length;t.forEach(e=>{let s=r[e.id],t={question_type:e.question_type,options:e.options,correct_answer:e.correct_answer};this.isAnswerCorrect(t,s)&&a++});let n=i>0?a/i*100:0,o=n>=(s.passing_score||70),{data:l,error:d}=await this.supabase.from("quiz_attempts").insert({...e,score:n,total_questions:i,correct_answers:a,is_passed:o,completed_at:new Date().toISOString()}).select().single();if(d)throw d;return l}isAnswerCorrect(e,s){switch(e.question_type){case"multiple_choice":let t=e.options,r=t?.find(e=>e.is_correct);return s===r?.text;case"true_false":return s===e.correct_answer;case"short_answer":return String(s||"").toLowerCase().trim()===String(e.correct_answer||"").toLowerCase().trim();default:return!1}}async getStudentQuizAttempts(e,s){let{data:t,error:r}=await this.supabase.from("quiz_attempts").select("*").eq("quiz_id",e).eq("student_id",s).order("started_at",{ascending:!1});if(r)throw r;return t}async getCourseAssignments(e){let{data:s,error:t}=await this.supabase.from("assignments").select("*").eq("course_id",e).order("created_at",{ascending:!1});if(t)throw t;return s}async createAssignment(e){let{data:s,error:t}=await this.supabase.from("assignments").insert(e).select().single();if(t)throw t;return s}async submitAssignment(e){let{data:s,error:t}=await this.supabase.from("assignment_submissions").insert(e).select().single();if(t)throw t;return s}async gradeAssignment(e,s,t,r){let{data:a,error:i}=await this.supabase.from("assignment_submissions").update({score:s,feedback:t,graded_by:r,graded_at:new Date().toISOString(),status:"graded"}).eq("id",e).select().single();if(i)throw i;return a}async generateCertificate(e,s){let{data:t}=await this.supabase.from("course_enrollments").select("*").eq("course_id",e).eq("student_id",s).eq("enrollment_status","completed").maybeSingle();if(!t)throw Error("Le cours doit être complété pour générer un certificat");let{data:r}=await this.supabase.from("course_certificates").select("*").eq("course_id",e).eq("student_id",s).maybeSingle();if(r)return r;let{data:a,error:i}=await this.supabase.from("course_certificates").insert({course_id:e,student_id:s,enrollment_id:t.id,certificate_number:""}).select().single();if(i)throw i;return a}async getStudentCertificates(e){let{data:s,error:t}=await this.supabase.from("course_certificates").select("*, course:courses(*)").eq("student_id",e).order("issued_at",{ascending:!1});if(t)throw t;return s}async createReview(e){let{data:s,error:t}=await this.supabase.from("course_reviews").insert(e).select().single();if(t)throw t;return s}async getCourseReviews(e){let{data:s,error:t}=await this.supabase.from("course_reviews").select("*, student:users(id, full_name, email)").eq("course_id",e).order("created_at",{ascending:!1});if(t)throw t;return s}async getCourseRatingStats(e){let{data:s,error:t}=await this.supabase.from("course_reviews").select("rating").eq("course_id",e);if(t)throw t;let r={total:s.length,average:0,distribution:{1:0,2:0,3:0,4:0,5:0}};if(s.length>0){let e=s.map(e=>e.rating).filter(Boolean);r.average=e.reduce((e,s)=>e+s,0)/e.length,e.forEach(e=>{r.distribution[e]++})}return r}};e.s(["elearningService",0,t])},771649,e=>{"use strict";let s=(0,e.i(475254).default)("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);e.s(["Type",()=>s],771649)},750570,e=>{"use strict";let s=(0,e.i(475254).default)("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);e.s(["GripVertical",()=>s],750570)},195469,e=>{"use strict";var s=e.i(843476),t=e.i(271645),r=e.i(618566),a=e.i(266027),i=e.i(954616),n=e.i(912598),o=e.i(653145),l=e.i(994814),d=e.i(50270),c=e.i(325715),u=e.i(186156),m=e.i(920755),p=e.i(167881),g=e.i(645760),h=e.i(871689),b=e.i(356909),x=e.i(107233),y=e.i(771649),f=e.i(473708),w=e.i(520958),v=e.i(101523),j=e.i(37727),_=e.i(750570),N=e.i(569074),q=e.i(629377),C=e.i(522016),S=e.i(6799);e.i(882205);var k=e.i(846932),z=e.i(88653),L=e.i(647163);let P=d.z.object({title:d.z.string().min(3,"Le titre doit contenir au moins 3 caractères"),slug:d.z.string().min(3,"Le slug doit contenir au moins 3 caractères").regex(/^[a-z0-9-]+$/,"Le slug ne peut contenir que des lettres minuscules, chiffres et tirets"),description:d.z.string().optional(),section_id:d.z.string().optional(),order_index:d.z.number().min(0).default(0)});function T(){let e=(0,r.useParams)(),d=(0,r.useRouter)(),T=e.slug,A=e.lessonSlug,{user:O}=(0,c.useAuth)(),{addToast:R}=(0,S.useToast)(),Q=(0,n.useQueryClient)(),E=(0,m.createClient)(),[G,I]=(0,t.useState)([]),[U,M]=(0,t.useState)(!1),[B,$]=(0,t.useState)({}),{data:D}=(0,a.useQuery)({queryKey:["course",T,O?.organization_id],queryFn:async()=>await u.elearningService.getCourseBySlug(T,O?.organization_id||""),enabled:!!T&&!!O?.organization_id}),{data:F,isLoading:K}=(0,a.useQuery)({queryKey:["lesson",A,D?.id],queryFn:async()=>{if(!D?.id)throw Error("Course ID manquant");return await u.elearningService.getLessonBySlug(A,D.id)},enabled:!!A&&!!D?.id}),{data:V}=(0,a.useQuery)({queryKey:["course-sections",D?.id],queryFn:async()=>await u.elearningService.getCourseSections(D?.id||""),enabled:!!D?.id}),{register:H,handleSubmit:X,formState:{errors:J},watch:W,setValue:Y,reset:Z}=(0,o.useForm)({resolver:(0,l.zodResolver)(P),mode:"onChange",defaultValues:{order_index:0}});(0,t.useEffect)(()=>{if(F&&(Z({title:F.title,slug:F.slug,description:F.description||"",section_id:F.section_id||"",order_index:F.order_index||0}),F.content))try{let e=JSON.parse(F.content);Array.isArray(e)&&I(e)}catch(e){console.error("Erreur lors du parsing du contenu:",e),F.content&&I([{id:Math.random().toString(36).substr(2,9),type:"text",data:{content:F.content}}])}},[F,Z]),W("title");let ee=e=>{I([...G,{id:Math.random().toString(36).substr(2,9),type:e,data:{content:"text"===e?"":void 0,mediaType:"media"===e?"image":void 0,question:"quiz"===e?"":void 0,pollQuestion:"poll"===e?"":void 0,options:"quiz"===e?[{id:"1",text:"",isCorrect:!1}]:void 0,pollOptions:"poll"===e?[{id:"1",text:""}]:void 0,points:"quiz"===e?1:void 0}}]),M(!1)},es=(e,s)=>{I(G.map(t=>t.id===e?{...t,data:{...t.data,...s}}:t))},et=async(e,s)=>{if(!O?.organization_id)return void R({type:"error",title:"Erreur",description:"Organisation manquante"});$(s=>({...s,[e]:!0}));try{let t=s.name.split(".").pop(),r=`${O.organization_id}/elearning/lessons/${Date.now()}-${Math.random().toString(36).substring(7)}.${t}`,a=null,i=null;for(let e of["elearning-media","course-media","course-thumbnails"]){let{error:t}=await E.storage.from(e).upload(r,s,{cacheControl:"3600",upsert:!1});if(!t){a=e,i=null;break}i=t}if(!a)throw i||Error("Échec de l'upload sur tous les buckets disponibles.");let{data:n}=E.storage.from(a).getPublicUrl(r);es(e,{mediaUrl:n.publicUrl}),R({type:"success",title:"Image uploadée",description:"L'image a été uploadée avec succès."})}catch(e){console.error("Erreur lors de l'upload:",e),R({type:"error",title:"Erreur d'upload",description:e?.message||"Une erreur est survenue lors de l'upload de l'image."})}finally{$(s=>({...s,[e]:!1}))}},er=(0,i.useMutation)({mutationFn:async e=>{if(!F?.id)throw Error("Lesson ID manquant");let s=JSON.stringify(G);return u.elearningService.updateLesson(F.id,{title:e.title,slug:e.slug,description:e.description||null,section_id:e.section_id||null,order_index:e.order_index,content:s})},onSuccess:()=>{R({type:"success",title:"Leçon mise à jour",description:"Votre leçon a été mise à jour avec succès."}),Q.invalidateQueries({queryKey:["course",T]}),Q.invalidateQueries({queryKey:["lesson",A]}),d.push(`/dashboard/elearning/courses/${T}`)},onError:e=>{R({type:"error",title:"Erreur",description:e.message||"Une erreur est survenue lors de la mise à jour de la leçon"})}});return K||!D?(0,s.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:(0,s.jsx)("div",{className:"text-center py-12",children:"Chargement..."})}):F?(0,s.jsxs)(k.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"space-y-8 pb-8 max-w-6xl mx-auto p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(C.default,{href:`/dashboard/elearning/courses/${T}`,children:(0,s.jsx)(p.Button,{variant:"ghost",size:"icon",children:(0,s.jsx)(h.ArrowLeft,{className:"h-4 w-4"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Modifier la leçon"}),(0,s.jsxs)("p",{className:"text-gray-500 mt-1",children:['Modifiez la leçon "',F.title,'" du cours "',D.title,'"']})]})]}),(0,s.jsxs)("form",{onSubmit:X(e=>{er.mutate(e)}),className:"space-y-6",children:[(0,s.jsxs)(g.GlassCard,{variant:"premium",className:"p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:"Informations de base"}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Titre de la leçon *"}),(0,s.jsx)("input",{type:"text",...H("title"),onChange:e=>{let s=e.target.value;Y("title",s),s&&Y("slug",s.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))},className:(0,L.cn)("w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",J.title?"border-red-500":"border-gray-200"),placeholder:"Ex: Introduction à React"}),J.title&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-1",children:J.title.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Slug (URL) *"}),(0,s.jsx)("input",{type:"text",...H("slug"),className:(0,L.cn)("w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all bg-gray-50",J.slug?"border-red-500":"border-gray-200"),placeholder:"introduction-a-react"}),J.slug&&(0,s.jsx)("p",{className:"text-sm text-red-600 mt-1",children:J.slug.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Description"}),(0,s.jsx)("textarea",{...H("description"),rows:3,className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all resize-none",placeholder:"Description courte de la leçon..."})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Section (optionnel)"}),(0,s.jsxs)("select",{...H("section_id"),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",children:[(0,s.jsx)("option",{value:"",children:"Aucune section"}),V?.map(e=>(0,s.jsx)("option",{value:e.id,children:e.title},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Ordre"}),(0,s.jsx)("input",{type:"number",...H("order_index",{valueAsNumber:!0}),min:"0",className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all"})]})]})]})]}),(0,s.jsxs)(g.GlassCard,{variant:"premium",className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:"Contenu de la leçon"}),(0,s.jsxs)(p.Button,{type:"button",onClick:()=>M(!U),className:"bg-brand-blue hover:bg-brand-blue/90 text-white",children:[(0,s.jsx)(x.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter un élément"]})]}),(0,s.jsx)(z.AnimatePresence,{children:U&&(0,s.jsxs)(k.motion.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-6 p-4 bg-gray-50 rounded-lg border border-gray-200",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-3",children:"Choisir un type de contenu :"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>ee("text"),className:"flex flex-col items-center gap-2 p-4 border border-gray-200 rounded-lg hover:border-brand-blue hover:bg-brand-blue-ghost transition-colors",children:[(0,s.jsx)(y.Type,{className:"h-6 w-6 text-brand-blue"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Texte"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>ee("media"),className:"flex flex-col items-center gap-2 p-4 border border-gray-200 rounded-lg hover:border-brand-blue hover:bg-brand-blue-ghost transition-colors",children:[(0,s.jsx)(f.Image,{className:"h-6 w-6 text-brand-blue"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Média"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>ee("quiz"),className:"flex flex-col items-center gap-2 p-4 border border-gray-200 rounded-lg hover:border-brand-blue hover:bg-brand-blue-ghost transition-colors",children:[(0,s.jsx)(w.HelpCircle,{className:"h-6 w-6 text-brand-blue"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Quiz"})]}),(0,s.jsxs)("button",{type:"button",onClick:()=>ee("poll"),className:"flex flex-col items-center gap-2 p-4 border border-gray-200 rounded-lg hover:border-brand-blue hover:bg-brand-blue-ghost transition-colors",children:[(0,s.jsx)(v.BarChart3,{className:"h-6 w-6 text-brand-blue"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Sondage"})]})]})]})}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(z.AnimatePresence,{children:G.map((e,t)=>(0,s.jsxs)(k.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"border border-gray-200 rounded-lg p-4 bg-white",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(_.GripVertical,{className:"h-4 w-4 text-gray-400"}),(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["text"===e.type&&"Texte","media"===e.type&&"Média","quiz"===e.type&&"Quiz (évaluable)","poll"===e.type&&"Sondage (non évaluable)"]})]}),(0,s.jsx)("button",{type:"button",onClick:()=>{var s;return s=e.id,void I(G.filter(e=>e.id!==s))},className:"p-1 text-red-500 hover:bg-red-50 rounded transition-colors",children:(0,s.jsx)(j.X,{className:"h-4 w-4"})})]}),"text"===e.type&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Contenu"}),(0,s.jsx)("textarea",{value:e.data.content||"",onChange:s=>es(e.id,{content:s.target.value}),rows:6,className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all resize-none",placeholder:"Saisissez votre texte ici (Markdown supporté)..."})]}),"media"===e.type&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Type de média"}),(0,s.jsxs)("select",{value:e.data.mediaType||"image",onChange:s=>es(e.id,{mediaType:s.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",children:[(0,s.jsx)("option",{value:"image",children:"Image"}),(0,s.jsx)("option",{value:"video",children:"Vidéo"}),(0,s.jsx)("option",{value:"audio",children:"Audio"}),(0,s.jsx)("option",{value:"file",children:"Fichier"})]})]}),"image"===e.data.mediaType&&(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Uploader une image"}),(0,s.jsx)("div",{className:"flex items-center gap-4",children:(0,s.jsxs)("label",{className:"flex-1 cursor-pointer",children:[(0,s.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>{let t=s.target.files?.[0];t&&et(e.id,t)},disabled:B[e.id]}),(0,s.jsx)("div",{className:(0,L.cn)("flex items-center justify-center gap-2 px-4 py-3 border-2 border-dashed rounded-lg transition-colors",B[e.id]?"border-gray-300 bg-gray-50":"border-brand-blue/30 hover:border-brand-blue hover:bg-brand-blue-ghost"),children:B[e.id]?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(q.Loader2,{className:"h-5 w-5 text-brand-blue animate-spin"}),(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"Upload en cours..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.Upload,{className:"h-5 w-5 text-brand-blue"}),(0,s.jsx)("span",{className:"text-sm font-medium text-brand-blue",children:"Choisir un fichier"})]})})]})}),e.data.mediaUrl&&(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)("img",{src:e.data.mediaUrl,alt:"Aperçu",className:"max-w-full h-auto max-h-64 rounded-lg border border-gray-200"})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"image"===e.data.mediaType?"URL de l'image (ou laisser vide si uploadée ci-dessus)":"URL du média"}),(0,s.jsx)("input",{type:"url",value:e.data.mediaUrl||"",onChange:s=>es(e.id,{mediaUrl:s.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:"https://..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Légende (optionnel)"}),(0,s.jsx)("input",{type:"text",value:e.data.caption||"",onChange:s=>es(e.id,{caption:s.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:"Légende du média..."})]})]}),"quiz"===e.type&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question *"}),(0,s.jsx)("input",{type:"text",value:e.data.question||"",onChange:s=>es(e.id,{question:s.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:"Quelle est la question ?"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Points"}),(0,s.jsx)("input",{type:"number",value:e.data.points||1,onChange:s=>es(e.id,{points:parseInt(s.target.value)||1}),min:"1",className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Options de réponse *"}),(0,s.jsx)("button",{type:"button",onClick:()=>(e=>{let s=G.find(s=>s.id===e);if(s&&"quiz"===s.type){let t={id:Math.random().toString(36).substr(2,9),text:"",isCorrect:!1};es(e,{options:[...s.data.options||[],t]})}})(e.id),className:"text-sm text-brand-blue hover:underline",children:"+ Ajouter une option"})]}),(0,s.jsx)("div",{className:"space-y-2",children:e.data.options?.map((t,r)=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"checkbox",checked:t.isCorrect,onChange:s=>{let r=e.data.options?.map(e=>e.id===t.id?{...e,isCorrect:s.target.checked}:e);es(e.id,{options:r})},className:"w-4 h-4 text-brand-blue border-gray-300 rounded focus:ring-brand-blue"}),(0,s.jsx)("input",{type:"text",value:t.text,onChange:s=>{let r=e.data.options?.map(e=>e.id===t.id?{...e,text:s.target.value}:e);es(e.id,{options:r})},className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:`Option ${r+1}`}),e.data.options&&e.data.options.length>1&&(0,s.jsx)("button",{type:"button",onClick:()=>{let s=e.data.options?.filter(e=>e.id!==t.id);es(e.id,{options:s})},className:"p-1 text-red-500 hover:bg-red-50 rounded transition-colors",children:(0,s.jsx)(j.X,{className:"h-4 w-4"})})]},t.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Explication (optionnel)"}),(0,s.jsx)("textarea",{value:e.data.explanation||"",onChange:s=>es(e.id,{explanation:s.target.value}),rows:2,className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all resize-none",placeholder:"Explication de la réponse correcte..."})]})]}),"poll"===e.type&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Question du sondage *"}),(0,s.jsx)("input",{type:"text",value:e.data.pollQuestion||"",onChange:s=>es(e.id,{pollQuestion:s.target.value}),className:"w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:"Quelle est votre question ?"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Options de réponse *"}),(0,s.jsx)("button",{type:"button",onClick:()=>(e=>{let s=G.find(s=>s.id===e);if(s&&"poll"===s.type){let t={id:Math.random().toString(36).substr(2,9),text:""};es(e,{pollOptions:[...s.data.pollOptions||[],t]})}})(e.id),className:"text-sm text-brand-blue hover:underline",children:"+ Ajouter une option"})]}),(0,s.jsx)("div",{className:"space-y-2",children:e.data.pollOptions?.map((t,r)=>(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"text",value:t.text,onChange:s=>{let r=e.data.pollOptions?.map(e=>e.id===t.id?{...e,text:s.target.value}:e);es(e.id,{pollOptions:r})},className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent transition-all",placeholder:`Option ${r+1}`}),e.data.pollOptions&&e.data.pollOptions.length>1&&(0,s.jsx)("button",{type:"button",onClick:()=>{let s=e.data.pollOptions?.filter(e=>e.id!==t.id);es(e.id,{pollOptions:s})},className:"p-1 text-red-500 hover:bg-red-50 rounded transition-colors",children:(0,s.jsx)(j.X,{className:"h-4 w-4"})})]},t.id))})]})]})]},e.id))}),0===G.length&&(0,s.jsxs)("div",{className:"text-center py-12 border-2 border-dashed border-gray-300 rounded-lg",children:[(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:"Aucun contenu ajouté"}),(0,s.jsxs)(p.Button,{type:"button",onClick:()=>M(!0),variant:"outline",children:[(0,s.jsx)(x.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter votre premier élément"]})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,s.jsx)(C.default,{href:`/dashboard/elearning/courses/${T}`,children:(0,s.jsx)(p.Button,{variant:"ghost",type:"button",children:"Annuler"})}),(0,s.jsx)(p.Button,{type:"submit",disabled:er.isPending,className:"bg-brand-blue hover:bg-brand-blue/90 text-white shadow-lg shadow-brand-blue/20",children:er.isPending?(0,s.jsx)(s.Fragment,{children:"Enregistrement..."}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.Save,{className:"h-4 w-4 mr-2"}),"Enregistrer les modifications"]})})]})]})]}):(0,s.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:"Leçon introuvable"}),(0,s.jsx)(C.default,{href:`/dashboard/elearning/courses/${T}`,children:(0,s.jsx)(p.Button,{variant:"outline",children:"Retour au cours"})})]})})}e.s(["default",()=>T])}]);