(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let s=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],871689)},645760,e=>{"use strict";var s=e.i(843476),t=e.i(271645),a=e.i(647163);e.i(882205);var r=e.i(846932);let i=t.forwardRef(({className:e,variant:t="default",hoverable:i=!1,glow:n=!1,glowColor:l="rgba(51, 90, 207, 0.3)",...o},d)=>(0,s.jsxs)(r.motion.div,{ref:d,className:(0,a.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===t,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===t,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===t,"cursor-pointer":i,"hover:shadow-2xl hover:scale-[1.02]":i,"hover:bg-white/90 dark:hover:bg-gray-900/90":i},e),whileHover:i?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...o,children:[n&&(0,s.jsx)(r.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${l} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,s.jsx)("div",{className:"relative z-10",children:o.children})]}));i.displayName="GlassCard",e.s(["GlassCard",()=>i])},605631,e=>{"use strict";let s=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>s],605631)},436332,e=>{"use strict";let s=(0,e.i(475254).default)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);e.s(["Edit",()=>s],436332)},373375,e=>{"use strict";let s=(0,e.i(475254).default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>s],373375)},186156,e=>{"use strict";var s=e.i(920755);let t=new class{supabase;constructor(e){this.supabase=e||(0,s.createClient)()}async getCourses(e,s){try{let t=this.supabase.from("courses").select("*, instructor:users(id, full_name, email), formation:formations(*)").eq("organization_id",e);s?.instructorId&&(t=t.eq("instructor_id",s.instructorId)),s?.isPublished!==void 0&&(t=t.eq("is_published",s.isPublished)),s?.isFeatured&&(t=t.eq("is_featured",!0)),s?.difficulty&&(t=t.eq("difficulty_level",s.difficulty)),s?.search&&(t=t.or(`title.ilike.%${s.search}%,description.ilike.%${s.search}%`));let{data:a,error:r}=await t.order("created_at",{ascending:!1});if(r){if("PGRST116"===r.code||"42P01"===r.code||"PGRST301"===r.code||400===r.status||"400"===r.code||r.message?.includes("relation")||r.message?.includes("relationship")||r.message?.includes("does not exist")||r.message?.includes("schema cache"))return console.warn("Table courses does not exist yet or invalid query:",r.message),[];throw r}return a||[]}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===400||e?.code==="400"||e?.message?.includes("relation")||e?.message?.includes("relationship")||e?.message?.includes("does not exist")||e?.message?.includes("schema cache"))return console.warn("Table courses does not exist yet or invalid query:",e?.message||String(e)),[];throw e}}async getCourseBySlug(e,s){try{let t=this.supabase.from("courses").select(`
          *,
          instructor:users(id, full_name, email),
          formation:formations(*),
          sections:course_sections(*),
          lessons:lessons(*)
        `).eq("slug",e).eq("organization_id",s),{data:a,error:r}=await t.maybeSingle();if(r){if("PGRST116"===r.code||"42P01"===r.code||"PGRST301"===r.code||400===r.status||"400"===r.code||r.message?.includes("relation")||r.message?.includes("relationship")||r.message?.includes("does not exist")||r.message?.includes("schema cache"))return console.warn("Table courses or relations do not exist yet or invalid query:",r.message),null;throw r}return a}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===400||e?.code==="400"||e?.message?.includes("relation")||e?.message?.includes("relationship")||e?.message?.includes("does not exist")||e?.message?.includes("schema cache"))return console.warn("Table courses or relations do not exist yet or invalid query:",e?.message),null;throw e}}async createCourse(e){let{data:s,error:t}=await this.supabase.from("courses").insert(e).select().single();if(t)throw t;return s}async updateCourse(e,s){let{data:t,error:a}=await this.supabase.from("courses").update(s).eq("id",e).select().single();if(a)throw a;return t}async deleteCourse(e){let{error:s}=await this.supabase.from("courses").delete().eq("id",e);if(s)throw s}async getCourseSections(e){let{data:s,error:t}=await this.supabase.from("course_sections").select("*").eq("course_id",e).order("order_index",{ascending:!0});if(t)throw t;return s}async createSection(e){let{data:s,error:t}=await this.supabase.from("course_sections").insert(e).select().single();if(t)throw t;return s}async updateSection(e,s){let{data:t,error:a}=await this.supabase.from("course_sections").update(s).eq("id",e).select().single();if(a)throw a;return t}async deleteSection(e){let{error:s}=await this.supabase.from("lessons").update({section_id:null}).eq("section_id",e);if(s)throw s;let{error:t}=await this.supabase.from("course_sections").delete().eq("id",e);if(t)throw t}async getCourseLessons(e){let{data:s,error:t}=await this.supabase.from("lessons").select("*").eq("course_id",e).order("order_index",{ascending:!0});if(t)throw t;return s}async getLessonById(e){let{data:s,error:t}=await this.supabase.from("lessons").select("*, course:courses(*), section:course_sections(*)").eq("id",e).single();if(t)throw t;return s}async getLessonBySlug(e,s){let{data:t,error:a}=await this.supabase.from("lessons").select("*, course:courses(*), section:course_sections(*)").eq("slug",e).eq("course_id",s).single();if(a)throw a;return t}async createLesson(e){let{data:s,error:t}=await this.supabase.from("lessons").insert(e).select().single();if(t)throw t;return await this.updateCourseLessonCount(e.course_id),s}async updateLesson(e,s){let{data:t,error:a}=await this.supabase.from("lessons").update(s).eq("id",e).select().single();if(a)throw a;return t}async deleteLesson(e){let{data:s}=await this.supabase.from("lessons").select("course_id").eq("id",e).single(),{error:t}=await this.supabase.from("lessons").delete().eq("id",e);if(t)throw t;s&&await this.updateCourseLessonCount(s.course_id)}async updateCourseLessonCount(e){let{count:s}=await this.supabase.from("lessons").select("*",{count:"exact",head:!0}).eq("course_id",e);await this.supabase.from("courses").update({total_lessons:s||0}).eq("id",e)}async enrollInCourse(e,s){let{data:t,error:a}=await this.supabase.from("course_enrollments").insert({course_id:e,student_id:s,enrollment_status:"enrolled"}).select().single();if(a)throw a;return await this.incrementCourseStudentCount(e),t}async getStudentEnrollments(e){try{let{data:s,error:t}=await this.supabase.from("course_enrollments").select(`
          *,
          course:courses(*, instructor:users(id, full_name, email))
        `).eq("student_id",e).order("enrolled_at",{ascending:!1});if(t){if("PGRST116"===t.code||"42P01"===t.code||"PGRST301"===t.code||400===t.status||"400"===t.code||t.message?.includes("relation")||t.message?.includes("relationship")||t.message?.includes("does not exist")||t.message?.includes("schema cache"))return console.warn("Table course_enrollments does not exist yet or invalid query:",t.message),[];throw t}return s||[]}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===400||e?.code==="400"||e?.message?.includes("relation")||e?.message?.includes("relationship")||e?.message?.includes("does not exist")||e?.message?.includes("schema cache"))return console.warn("Table course_enrollments does not exist yet or invalid query:",e?.message||String(e)),[];throw e}}async getCourseEnrollments(e){let{data:s,error:t}=await this.supabase.from("course_enrollments").select(`
        *,
        student:users(id, full_name, email)
      `).eq("course_id",e).order("enrolled_at",{ascending:!1});if(t)throw t;return s}async updateEnrollment(e,s){let{data:t,error:a}=await this.supabase.from("course_enrollments").update(s).eq("id",e).select().single();if(a)throw a;return t}async incrementCourseStudentCount(e){let{data:s}=await this.supabase.from("courses").select("total_students").eq("id",e).single();s&&await this.supabase.from("courses").update({total_students:(s.total_students||0)+1}).eq("id",e)}async getLessonProgress(e,s){let{data:t,error:a}=await this.supabase.from("lesson_progress").select("*").eq("lesson_id",e).eq("student_id",s).maybeSingle();if(a)throw a;return t}async updateLessonProgress(e,s,t){let a=await this.getLessonProgress(e,s);if(a){let{data:e,error:s}=await this.supabase.from("lesson_progress").update({...t,last_accessed_at:new Date().toISOString()}).eq("id",a.id).select().single();if(s)throw s;return e}{let{data:a,error:r}=await this.supabase.from("lesson_progress").insert({lesson_id:e,student_id:s,...t,started_at:new Date().toISOString(),last_accessed_at:new Date().toISOString()}).select().single();if(r)throw r;return a}}async markLessonAsCompleted(e,s){return this.updateLessonProgress(e,s,{is_completed:!0,completion_percentage:100,completed_at:new Date().toISOString()})}async getQuiz(e){let{data:s,error:t}=await this.supabase.from("quizzes").select("*, questions:quiz_questions(*)").eq("id",e).single();if(t)throw t;return s}async createQuiz(e){let{data:s,error:t}=await this.supabase.from("quizzes").insert(e).select().single();if(t)throw t;return s}async createQuizQuestion(e){let{data:s,error:t}=await this.supabase.from("quiz_questions").insert(e).select().single();if(t)throw t;return s}async submitQuizAttempt(e){let s=await this.getQuiz(e.quiz_id);if(!s||!s.questions)throw Error("Quiz non trouvé");let t=s.questions,a=e.answers,r=0,i=t.length;t.forEach(e=>{let s=a[e.id],t={question_type:e.question_type,options:e.options,correct_answer:e.correct_answer};this.isAnswerCorrect(t,s)&&r++});let n=i>0?r/i*100:0,l=n>=(s.passing_score||70),{data:o,error:d}=await this.supabase.from("quiz_attempts").insert({...e,score:n,total_questions:i,correct_answers:r,is_passed:l,completed_at:new Date().toISOString()}).select().single();if(d)throw d;return o}isAnswerCorrect(e,s){switch(e.question_type){case"multiple_choice":let t=e.options,a=t?.find(e=>e.is_correct);return s===a?.text;case"true_false":return s===e.correct_answer;case"short_answer":return String(s||"").toLowerCase().trim()===String(e.correct_answer||"").toLowerCase().trim();default:return!1}}async getStudentQuizAttempts(e,s){let{data:t,error:a}=await this.supabase.from("quiz_attempts").select("*").eq("quiz_id",e).eq("student_id",s).order("started_at",{ascending:!1});if(a)throw a;return t}async getCourseAssignments(e){let{data:s,error:t}=await this.supabase.from("assignments").select("*").eq("course_id",e).order("created_at",{ascending:!1});if(t)throw t;return s}async createAssignment(e){let{data:s,error:t}=await this.supabase.from("assignments").insert(e).select().single();if(t)throw t;return s}async submitAssignment(e){let{data:s,error:t}=await this.supabase.from("assignment_submissions").insert(e).select().single();if(t)throw t;return s}async gradeAssignment(e,s,t,a){let{data:r,error:i}=await this.supabase.from("assignment_submissions").update({score:s,feedback:t,graded_by:a,graded_at:new Date().toISOString(),status:"graded"}).eq("id",e).select().single();if(i)throw i;return r}async generateCertificate(e,s){let{data:t}=await this.supabase.from("course_enrollments").select("*").eq("course_id",e).eq("student_id",s).eq("enrollment_status","completed").maybeSingle();if(!t)throw Error("Le cours doit être complété pour générer un certificat");let{data:a}=await this.supabase.from("course_certificates").select("*").eq("course_id",e).eq("student_id",s).maybeSingle();if(a)return a;let{data:r,error:i}=await this.supabase.from("course_certificates").insert({course_id:e,student_id:s,enrollment_id:t.id,certificate_number:""}).select().single();if(i)throw i;return r}async getStudentCertificates(e){let{data:s,error:t}=await this.supabase.from("course_certificates").select("*, course:courses(*)").eq("student_id",e).order("issued_at",{ascending:!1});if(t)throw t;return s}async createReview(e){let{data:s,error:t}=await this.supabase.from("course_reviews").insert(e).select().single();if(t)throw t;return s}async getCourseReviews(e){let{data:s,error:t}=await this.supabase.from("course_reviews").select("*, student:users(id, full_name, email)").eq("course_id",e).order("created_at",{ascending:!1});if(t)throw t;return s}async getCourseRatingStats(e){let{data:s,error:t}=await this.supabase.from("course_reviews").select("rating").eq("course_id",e);if(t)throw t;let a={total:s.length,average:0,distribution:{1:0,2:0,3:0,4:0,5:0}};if(s.length>0){let e=s.map(e=>e.rating).filter(Boolean);a.average=e.reduce((e,s)=>e+s,0)/e.length,e.forEach(e=>{a.distribution[e]++})}return a}};e.s(["elearningService",0,t])},464643,e=>{"use strict";var s=e.i(843476),t=e.i(271645),a=e.i(618566),r=e.i(266027),i=e.i(954616),n=e.i(912598),l=e.i(325715),o=e.i(186156),d=e.i(970065),c=e.i(167881),u=e.i(645760),m=e.i(871689),h=e.i(605631),g=e.i(114683),p=e.i(463059),b=e.i(373375),f=e.i(810980),x=e.i(520958),y=e.i(101523),w=e.i(436332),v=e.i(178583),_=e.i(522016),j=e.i(918789);e.i(882205);var N=e.i(846932),q=e.i(647163);function C(){let e=(0,a.useParams)();(0,a.useRouter)();let C=e.slug,S=e.lessonSlug,{user:k}=(0,l.useAuth)(),L=(0,n.useQueryClient)(),T=(0,t.useRef)(null),[z,P]=(0,t.useState)([]),[R,A]=(0,t.useState)({}),[E,Q]=(0,t.useState)({}),{data:G}=(0,r.useQuery)({queryKey:["course",C,k?.organization_id],queryFn:async()=>await o.elearningService.getCourseBySlug(C,k?.organization_id||""),enabled:!!C&&!!k?.organization_id}),{data:B,isLoading:O}=(0,r.useQuery)({queryKey:["lesson",C,S],queryFn:async()=>{if(!G?.id)throw Error("Course ID manquant");return await o.elearningService.getLessonBySlug(S,G.id)},enabled:!!G?.id&&!!S});(0,t.useEffect)(()=>{if(B?.content)try{let e=JSON.parse(B.content);Array.isArray(e)?P(e):P([{id:"1",type:"text",data:{content:B.content}}])}catch(e){B.content&&P([{id:"1",type:"text",data:{content:B.content}}])}},[B]);let{data:$,refetch:I}=(0,r.useQuery)({queryKey:["lesson-progress",B?.id,k?.id],queryFn:async()=>await o.elearningService.getLessonProgress(B?.id||"",k?.id||""),enabled:!!B?.id&&!!k?.id});(0,t.useEffect)(()=>{if($){let e=$.quiz_responses||{},s=$.poll_votes||{},t={};Object.entries(e).forEach(([e,s])=>{t[e]=s.answer}),A(t);let a={};Object.entries(s).forEach(([e,s])=>{a[e]=s.option_id}),Q(a)}},[$]);let U=(0,i.useMutation)({mutationFn:async e=>{if(B?.id&&k?.id)return o.elearningService.updateLessonProgress(B.id,k.id,{completion_percentage:e})},onSuccess:()=>{L.invalidateQueries({queryKey:["lesson-progress"]}),L.invalidateQueries({queryKey:["course-enrollment"]})}}),F=(0,i.useMutation)({mutationFn:async()=>{if(B?.id&&k?.id)return o.elearningService.markLessonAsCompleted(B.id,k.id)},onSuccess:()=>{L.invalidateQueries({queryKey:["lesson-progress"]}),L.invalidateQueries({queryKey:["course-enrollment"]})}});(0,t.useEffect)(()=>{let e=T.current;if(!e||B?.lesson_type!=="video")return;let s=()=>{if(e.duration){let s=e.currentTime/e.duration*100;U.mutate(s)}};return e.addEventListener("timeupdate",s),()=>e.removeEventListener("timeupdate",s)},[B,U]);let K=G?.lessons||[],M=K.findIndex(e=>e.id===B?.id),D=M>0?K[M-1]:null,H=M<K.length-1?K[M+1]:null,J=$?.is_completed||!1,V=["super_admin","admin","secretary","teacher"].includes(k?.role||""),Z=G?.scores_enabled!==!1,W=(0,i.useMutation)({mutationFn:async({blockId:e,answer:s,type:t})=>{if(!B?.id)throw Error("Lesson ID manquant");let a=await fetch(`/api/elearning/lessons/${B.id}/responses`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({block_id:e,answer:s,type:t})});if(!a.ok)throw Error((await a.json()).error||"Erreur lors de la sauvegarde");return a.json()},onSuccess:()=>{I(),L.invalidateQueries({queryKey:["lesson-progress",B?.id]})}});return O||!G?(0,s.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:(0,s.jsx)("div",{className:"text-center py-12",children:"Chargement..."})}):B?(0,s.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,s.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,s.jsx)(_.default,{href:`/dashboard/elearning/courses/${C}`,children:(0,s.jsxs)(c.Button,{variant:"ghost",size:"sm",children:[(0,s.jsx)(m.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour au cours"]})}),V&&(0,s.jsx)(_.default,{href:`/dashboard/elearning/courses/${C}/lessons/${S}/edit`,children:(0,s.jsxs)(c.Button,{variant:"outline",size:"sm",children:[(0,s.jsx)(w.Edit,{className:"h-4 w-4 mr-2"}),"Modifier"]})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-3",children:(0,s.jsxs)(u.GlassCard,{variant:"premium",className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:B.title}),B.description&&(0,s.jsx)("p",{className:"text-gray-600",children:B.description})]}),J&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-green-600",children:[(0,s.jsx)(h.CheckCircle,{className:"h-5 w-5"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Complété"})]})]}),B.video_url&&(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)("div",{className:"aspect-video bg-black rounded-lg overflow-hidden shadow-lg",children:B.video_url.includes("youtube.com")||B.video_url.includes("youtu.be")?(0,s.jsx)("iframe",{src:B.video_url.replace("watch?v=","embed/").replace("youtu.be/","youtube.com/embed/"),className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):(0,s.jsx)("video",{ref:T,src:B.video_url,controls:!0,className:"w-full h-full"})})}),(0,s.jsx)("div",{className:"space-y-6",children:z.length>0?z.map((e,t)=>((e,t)=>{switch(e.type){case"text":return(0,s.jsx)(N.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"prose prose-sm max-w-none mb-6 p-4 bg-gray-50 rounded-lg",children:(0,s.jsx)(j.default,{children:e.data.content||""})},e.id);case"media":return(0,s.jsx)(N.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"mb-6",children:(0,s.jsxs)(u.GlassCard,{variant:"premium",className:"p-4",children:["image"===e.data.mediaType&&e.data.mediaUrl&&(0,s.jsxs)("div",{children:[(0,s.jsx)("img",{src:e.data.mediaUrl,alt:e.data.caption||"Média",className:"w-full rounded-lg mb-2"}),e.data.caption&&(0,s.jsx)("p",{className:"text-sm text-gray-600 italic text-center",children:e.data.caption})]}),"video"===e.data.mediaType&&e.data.mediaUrl&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"aspect-video bg-black rounded-lg overflow-hidden",children:e.data.mediaUrl.includes("youtube.com")||e.data.mediaUrl.includes("youtu.be")?(0,s.jsx)("iframe",{src:e.data.mediaUrl.replace("watch?v=","embed/").replace("youtu.be/","youtube.com/embed/"),className:"w-full h-full",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}):(0,s.jsx)("video",{src:e.data.mediaUrl,controls:!0,className:"w-full h-full"})}),e.data.caption&&(0,s.jsx)("p",{className:"text-sm text-gray-600 italic text-center mt-2",children:e.data.caption})]}),"audio"===e.data.mediaType&&e.data.mediaUrl&&(0,s.jsxs)("div",{children:[(0,s.jsx)("audio",{src:e.data.mediaUrl,controls:!0,className:"w-full"}),e.data.caption&&(0,s.jsx)("p",{className:"text-sm text-gray-600 italic text-center mt-2",children:e.data.caption})]}),"file"===e.data.mediaType&&e.data.mediaUrl&&(0,s.jsxs)("div",{className:"flex items-center gap-3 p-4 border border-gray-200 rounded-lg",children:[(0,s.jsx)(v.FileText,{className:"h-8 w-8 text-brand-blue"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-medium",children:e.data.caption||"Fichier"}),(0,s.jsx)("a",{href:e.data.mediaUrl,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-brand-blue hover:underline",children:"Télécharger"})]})]})]})},e.id);case"quiz":let a=R[e.id];return(0,s.jsx)(N.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"mb-6",children:(0,s.jsxs)(u.GlassCard,{variant:"premium",className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)(x.HelpCircle,{className:"h-5 w-5 text-brand-blue"}),(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:Z?"Quiz (évaluable)":"Quiz"}),Z&&e.data.points&&(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:["(",e.data.points," point",e.data.points>1?"s":"",")"]})]}),(0,s.jsx)("p",{className:"text-gray-700 mb-4 font-medium",children:e.data.question}),(0,s.jsx)("div",{className:"space-y-2 mb-4",children:e.data.options?.map(t=>{let r=a===t.id,i=t.isCorrect;return(0,s.jsx)("button",{onClick:()=>{var s,a;return s=e.id,a=t.id,void(A({...R,[s]:a}),W.mutate({blockId:s,answer:a,type:"quiz"}))},className:(0,q.cn)("w-full text-left p-3 border rounded-lg transition-all",r?Z?i?"bg-green-50 border-green-500 text-green-900":"bg-red-50 border-red-500 text-red-900":"bg-brand-blue-ghost border-brand-blue text-brand-blue":"bg-white border-gray-200 hover:border-brand-blue hover:bg-brand-blue-ghost"),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:(0,q.cn)("w-4 h-4 rounded-full border-2 flex items-center justify-center",r?Z?i?"border-green-500 bg-green-500":"border-red-500 bg-red-500":"border-brand-blue bg-brand-blue":"border-gray-300"),children:r&&(0,s.jsx)(h.CheckCircle,{className:"h-3 w-3 text-white"})}),(0,s.jsx)("span",{children:t.text}),Z&&r&&i&&(0,s.jsx)(h.CheckCircle,{className:"h-4 w-4 text-green-600 ml-auto"})]})},t.id)})}),Z&&a&&e.data.explanation&&(0,s.jsx)("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,s.jsxs)("p",{className:"text-sm text-blue-900",children:[(0,s.jsx)("strong",{children:"Explication :"})," ",e.data.explanation]})})]})},e.id);case"poll":let r=E[e.id];return(0,s.jsx)(N.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*t},className:"mb-6",children:(0,s.jsxs)(u.GlassCard,{variant:"premium",className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,s.jsx)(y.BarChart3,{className:"h-5 w-5 text-brand-blue"}),(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"Sondage (non évaluable)"})]}),(0,s.jsx)("p",{className:"text-gray-700 mb-4 font-medium",children:e.data.pollQuestion}),(0,s.jsx)("div",{className:"space-y-2",children:e.data.pollOptions?.map(t=>{let a=r===t.id;return(0,s.jsx)("button",{onClick:()=>{var s,a;return s=e.id,a=t.id,void(Q({...E,[s]:a}),W.mutate({blockId:s,answer:a,type:"poll"}))},disabled:!!r,className:(0,q.cn)("w-full text-left p-3 border rounded-lg transition-all",a?"bg-brand-blue-ghost border-brand-blue text-brand-blue":"bg-white border-gray-200 hover:border-brand-blue hover:bg-brand-blue-ghost",r&&!a&&"opacity-50 cursor-not-allowed"),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:(0,q.cn)("w-4 h-4 rounded-full border-2",a?"border-brand-blue bg-brand-blue":"border-gray-300")}),(0,s.jsx)("span",{children:t.text}),a&&(0,s.jsx)(h.CheckCircle,{className:"h-4 w-4 text-brand-blue ml-auto"})]})},t.id)})})]})},e.id);default:return null}})(e,t)):(0,s.jsx)("div",{className:"text-center py-12 text-gray-500",children:(0,s.jsx)("p",{children:"Aucun contenu disponible pour cette leçon"})})}),B.attachments&&Array.isArray(B.attachments)&&B.attachments.length>0&&(0,s.jsxs)("div",{className:"mt-8 pt-6 border-t border-gray-200",children:[(0,s.jsx)("h3",{className:"font-semibold mb-4 text-gray-900",children:"Ressources supplémentaires"}),(0,s.jsx)("div",{className:"space-y-2",children:B.attachments.map((e,t)=>(0,s.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[(0,s.jsx)(f.BookOpen,{className:"h-4 w-4 text-brand-blue"}),(0,s.jsx)("span",{className:"text-sm",children:e.filename||"Télécharger"})]},t))})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between pt-6 mt-6 border-t border-gray-200",children:[(0,s.jsx)("div",{children:D&&(0,s.jsx)(_.default,{href:`/dashboard/elearning/courses/${C}/lessons/${D.slug}`,children:(0,s.jsxs)(c.Button,{variant:"outline",children:[(0,s.jsx)(b.ChevronLeft,{className:"h-4 w-4 mr-2"}),"Leçon précédente"]})})}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[!J&&(0,s.jsxs)(c.Button,{onClick:()=>F.mutate(),disabled:F.isPending,className:"bg-brand-blue hover:bg-brand-blue/90 text-white",children:[(0,s.jsx)(h.CheckCircle,{className:"h-4 w-4 mr-2"}),"Marquer comme complété"]}),H&&(0,s.jsx)(_.default,{href:`/dashboard/elearning/courses/${C}/lessons/${H.slug}`,children:(0,s.jsxs)(c.Button,{className:"bg-brand-blue hover:bg-brand-blue/90 text-white",children:["Leçon suivante",(0,s.jsx)(p.ChevronRight,{className:"h-4 w-4 ml-2"})]})}),!H&&(0,s.jsx)(_.default,{href:`/dashboard/elearning/courses/${C}`,children:(0,s.jsxs)(c.Button,{className:"bg-brand-blue hover:bg-brand-blue/90 text-white",children:["Retour au cours",(0,s.jsx)(p.ChevronRight,{className:"h-4 w-4 ml-2"})]})})]})]})]})}),(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)(d.Card,{className:"sticky top-4",children:[(0,s.jsx)(d.CardHeader,{children:(0,s.jsx)(d.CardTitle,{className:"text-lg",children:"Leçons"})}),(0,s.jsx)(d.CardContent,{children:(0,s.jsx)("div",{className:"space-y-2",children:K.map((e,t)=>{let a=e.id===B.id;return(0,s.jsx)(_.default,{href:`/dashboard/elearning/courses/${C}/lessons/${e.slug}`,children:(0,s.jsxs)("button",{className:(0,q.cn)("w-full text-left p-2 rounded-lg transition-colors",a?"bg-brand-blue text-white":"bg-gray-50 hover:bg-gray-100"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(g.Circle,{className:"h-4 w-4 flex-shrink-0"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:[t+1,". ",e.title]})]}),e.video_duration_minutes&&(0,s.jsxs)("p",{className:"text-xs mt-1 opacity-70",children:[e.video_duration_minutes," min"]})]})},e.id)})})})]})})]})]}):(0,s.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:"Leçon introuvable"}),(0,s.jsx)(_.default,{href:`/dashboard/elearning/courses/${C}`,children:(0,s.jsx)(c.Button,{variant:"outline",children:"Retour au cours"})})]})})}e.s(["default",()=>C])}]);