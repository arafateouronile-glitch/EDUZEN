(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,263488,e=>{"use strict";let s=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>s],263488)},879002,e=>{"use strict";let s=(0,e.i(475254).default)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);e.s(["UserPlus",()=>s],879002)},669671,e=>{"use strict";let s=new class{async blobToBase64(e){return new Promise((s,t)=>{let n=new FileReader;n.onloadend=()=>{s(n.result.split(",")[1])},n.onerror=t,n.readAsDataURL(e)})}async sendEmail(e){try{let s=e.attachments?await Promise.all(e.attachments.map(async e=>{let s;if(e.content instanceof Blob)s=await this.blobToBase64(e.content);else if(e.content instanceof ArrayBuffer){let t=new Blob([e.content],{type:e.contentType});s=await this.blobToBase64(t)}else s=e.content;return{filename:e.filename,content:s,contentType:e.contentType}})):void 0,t=await fetch("/api/email/send",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({to:e.to,subject:e.subject,html:e.html,text:e.text,attachments:s,cc:e.cc,bcc:e.bcc,replyTo:e.replyTo})});if(!t.ok){let e=await t.json();throw Error(e.message||"Erreur lors de l'envoi de l'email")}let n=await t.json();return{success:!0,message:n.message||"Email envoyé avec succès"}}catch(e){throw Error(e instanceof Error?e.message:"Erreur lors de l'envoi de l'email")}}async sendDocument(e,s,t,n,a,l){return this.sendEmail({to:e,subject:s,html:a,text:l,attachments:[{filename:n,content:t,contentType:"application/pdf"}]})}async sendMultipleDocuments(e,s,t,n,a){return this.sendEmail({to:e,subject:s,html:n,text:a,attachments:t.map(e=>({filename:e.filename,content:e.blob,contentType:"application/pdf"}))})}};e.s(["emailService",0,s])},373578,e=>{"use strict";var s=e.i(843476),t=e.i(271645),n=e.i(970065),a=e.i(167881),l=e.i(178583),i=e.i(440160),r=e.i(263488),c=e.i(898791),o=e.i(647163),d=e.i(348572),m=e.i(630374),x=e.i(23750),u=e.i(184762),h=e.i(10708),j=e.i(879002);function p({sessionData:e,formation:p,program:g,organization:b,enrollments:v=[],isLoading:f=!1,onShowEnrollmentForm:N,onSwitchTab:y}){let{isGeneratingZip:w,zipGenerationProgress:C,lastZipGeneration:T,handleGenerateConvention:k,handleGenerateContract:B,handleGenerateAllConventionsZip:D,handleGenerateProgram:P,handleGenerateTerms:z,handleGeneratePrivacyPolicy:F,handleSendContractByEmail:E,handleSendContractByEmailWithCustomContent:S,prepareContractEmail:A}=(0,d.useDocumentGeneration)({sessionData:e,formation:p,program:g,organization:b}),[G,M]=(0,t.useState)(null),[L,U]=(0,t.useState)(null);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(n.Card,{children:[(0,s.jsx)(n.CardHeader,{children:(0,s.jsx)(n.CardTitle,{children:"Conventions et contrats"})}),(0,s.jsxs)(n.CardContent,{className:"space-y-4",children:[v.length>0&&(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-blue-900",children:"Génération en masse"}),(0,s.jsx)("p",{className:"text-sm text-blue-700",children:"Générer toutes les conventions et contrats en un fichier ZIP"}),T&&(0,s.jsxs)("span",{className:"text-xs text-blue-600",children:["Dernière génération : ",(0,o.formatDate)(T.toISOString())]})]}),(0,s.jsxs)(a.Button,{variant:"outline",size:"sm",onClick:()=>D(v),disabled:w,children:[(0,s.jsx)(i.Download,{className:"mr-2 h-4 w-4"}),w?`G\xe9n\xe9ration... (${C.current}/${C.total})`:"Générer un ZIP des conventions et contrats"]})]}),w&&(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsx)("div",{className:"w-full bg-blue-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${C.total>0?C.current/C.total*100:0}%`}})}),(0,s.jsxs)("p",{className:"text-xs text-blue-700 mt-1 text-center",children:["Génération en cours... ",C.current," sur ",C.total," document",C.total>1?"s":""]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(l.FileText,{className:"h-5 w-5 text-gray-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"Convention"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Convention générale de formation"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:k,children:(0,s.jsx)(i.Download,{className:"h-4 w-4"})}),(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",children:(0,s.jsx)(r.Mail,{className:"h-4 w-4"})})]})]}),f?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Chargement des inscriptions..."}):v.length>0?v.map(e=>{let t=e.students;return t?(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(l.FileText,{className:"h-5 w-5 text-gray-400"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"font-medium",children:[t.first_name," ",t.last_name]}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Contrat particulier"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Contrat"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground mt-1 inline-block",children:"Jamais généré"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:"text-xs bg-brand-blue-ghost text-brand-blue px-2 py-1 rounded",children:"Signé"}),(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:()=>B(e),children:(0,s.jsx)(i.Download,{className:"h-4 w-4"})}),(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:()=>{let s=A(e);s&&(M(s),U({to:s.to,subject:s.subject,body:s.body}))},title:"Envoyer par email",disabled:!t.email,children:(0,s.jsx)(r.Mail,{className:"h-4 w-4"})}),(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",children:"⋯"})]})]},e.id):null}):(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)("p",{className:"text-sm",children:"Aucune inscription pour le moment."}),(0,s.jsxs)(a.Button,{variant:"outline",className:"mt-4",onClick:()=>{y("convocations"),N()},children:[(0,s.jsx)(j.UserPlus,{className:"mr-2 h-4 w-4"}),"Inscrire un apprenant"]})]})]})]}),(0,s.jsxs)(n.Card,{children:[(0,s.jsx)(n.CardHeader,{children:(0,s.jsx)(n.CardTitle,{children:"Autres documents contractuels"})}),(0,s.jsx)(n.CardContent,{className:"space-y-4",children:g?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(l.FileText,{className:"h-5 w-5 text-gray-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"Programme"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Programme"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground mt-1 inline-block",children:"Jamais généré"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:P,children:(0,s.jsx)(i.Download,{className:"h-4 w-4"})}),(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",children:"⋯"})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(l.FileText,{className:"h-5 w-5 text-gray-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"CGV"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"CGV"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground mt-1 inline-block",children:"Jamais généré"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:z,children:(0,s.jsx)(i.Download,{className:"h-4 w-4"})}),(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",children:"⋯"})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(l.FileText,{className:"h-5 w-5 text-gray-400"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"Politique de confidentialité"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Politique de confidentialité"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground mt-1 inline-block",children:"Jamais généré"})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:F,children:(0,s.jsx)(i.Download,{className:"h-4 w-4"})}),(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",children:(0,s.jsx)(r.Mail,{className:"h-4 w-4"})}),(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",children:"⋯"})]})]})]}):(0,s.jsx)("div",{className:"bg-warning-bg border border-warning-border rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,s.jsx)(c.AlertCircle,{className:"h-5 w-5 text-warning-primary mt-0.5"}),(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)("p",{className:"text-sm text-warning-primary font-medium",children:"Votre session n'est pas associée à un programme, il n'est pas possible de générer de programme."})})]})})})]}),(0,s.jsx)(m.Dialog,{open:!!G,onOpenChange:e=>{e||(M(null),U(null))},children:(0,s.jsxs)(m.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)(m.DialogHeader,{children:[(0,s.jsx)(m.DialogTitle,{children:"Aperçu de l'email"}),(0,s.jsx)(m.DialogDescription,{children:"Vérifiez le contenu et le destinataire avant d'envoyer"})]}),G&&L&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(h.Label,{htmlFor:"email-to",children:"Destinataire"}),(0,s.jsx)(x.Input,{id:"email-to",type:"email",value:L.to,onChange:e=>U({...L,to:e.target.value}),className:"mt-1",placeholder:"email@example.com"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(h.Label,{htmlFor:"email-subject",children:"Sujet"}),(0,s.jsx)(x.Input,{id:"email-subject",type:"text",value:L.subject,onChange:e=>U({...L,subject:e.target.value}),className:"mt-1",placeholder:"Sujet de l'email"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(h.Label,{htmlFor:"email-body",children:"Contenu"}),(0,s.jsx)(u.Textarea,{id:"email-body",value:L.body.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim(),onChange:e=>U({...L,body:e.target.value}),className:"mt-1 min-h-[200px] font-mono text-sm",placeholder:"Contenu de l'email"}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Le formatage HTML sera préservé lors de l'envoi"})]}),(0,s.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3",children:(0,s.jsxs)("p",{className:"text-xs text-blue-800",children:[(0,s.jsx)("strong",{children:"Pièce jointe :"})," Un PDF du contrat sera joint à cet email."]})})]}),(0,s.jsxs)(m.DialogFooter,{children:[(0,s.jsx)(a.Button,{variant:"outline",onClick:()=>{M(null),U(null)},children:"Annuler"}),(0,s.jsxs)(a.Button,{onClick:async()=>{if(G&&L){let e={...G.enrollment,students:{...G.enrollment.students,email:L.to}};await S(e,L.subject,L.body),M(null),U(null)}},disabled:!L?.to||!L?.subject||!L?.body,children:[(0,s.jsx)(r.Mail,{className:"h-4 w-4 mr-2"}),"Envoyer l'email"]})]})]})})]})}e.s(["GestionConventions",()=>p])},48503,e=>{e.v(e=>Promise.resolve().then(()=>e(915833)))},870653,e=>{e.v(s=>Promise.all(["static/chunks/e551d4a510c7c3c6.js"].map(s=>e.l(s))).then(()=>s(424154)))},195111,e=>{e.v(s=>Promise.all(["static/chunks/9fc253a1d558cb4a.js"].map(s=>e.l(s))).then(()=>s(38201)))}]);