(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,503116,e=>{"use strict";let t=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],503116)},25652,e=>{"use strict";let t=(0,e.i(475254).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);e.s(["TrendingUp",()=>t],25652)},212426,e=>{"use strict";let t=(0,e.i(475254).default)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>t],212426)},882293,e=>{"use strict";let t=(0,e.i(475254).default)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);e.s(["UserCheck",()=>t],882293)},129228,555706,e=>{"use strict";var t=e.i(883966),n=e.i(271645),i=e.i(273050),a=e.i(771223),r=e.i(629873),o=e.i(898892),s=e.i(207670),l=e.i(372733),c=e.i(238279),d=e.i(997865),u=e.i(969212),m=e.i(734251),p=e.i(794395),f=e.i(781977),h=e.i(562728),g=e.i(198770),y=["type","layout","connectNulls","ref"],v=["key"];function x(e){return(x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n={};for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){if(t.indexOf(i)>=0)continue;n[i]=e[i]}return n}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function w(){return(w=Object.assign.bind()).apply(this,arguments)}function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach(function(t){F(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function A(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return S(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function E(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,k(i.key),i)}}function z(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(z=function(){return!!e})()}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e,t){return(P=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function F(e,t,n){return(t=k(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function k(e){var t=function(e,t){if("object"!=x(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=x(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==x(t)?t:t+""}var D=function(e){var t,h;function _(){var e,t,n;if(!(this instanceof _))throw TypeError("Cannot call a class as a function");for(var i=arguments.length,a=Array(i),r=0;r<i;r++)a[r]=arguments[r];return t=_,n=[].concat(a),t=C(t),F(e=function(e,t){if(t&&("object"===x(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");var n=e;if(void 0===n)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return n}(this,z()?Reflect.construct(t,n||[],C(this).constructor):t.apply(this,n)),"state",{isAnimationFinished:!0,totalLength:0}),F(e,"generateSimpleStrokeDasharray",function(e,t){return"".concat(t,"px ").concat(e-t,"px")}),F(e,"getStrokeDasharray",function(t,n,i){var a=i.reduce(function(e,t){return e+t});if(!a)return e.generateSimpleStrokeDasharray(n,t);for(var r=Math.floor(t/a),o=t%a,s=n-t,l=[],c=0,d=0;c<i.length;d+=i[c],++c)if(d+i[c]>o){l=[].concat(A(i.slice(0,c)),[o-d]);break}var u=l.length%2==0?[0,s]:[s];return[].concat(A(_.repeat(i,r)),A(l),u).map(function(e){return"".concat(e,"px")}).join(", ")}),F(e,"id",(0,p.uniqueId)("recharts-line-")),F(e,"pathRef",function(t){e.mainCurve=t}),F(e,"handleAnimationEnd",function(){e.setState({isAnimationFinished:!0}),e.props.onAnimationEnd&&e.props.onAnimationEnd()}),F(e,"handleAnimationStart",function(){e.setState({isAnimationFinished:!1}),e.props.onAnimationStart&&e.props.onAnimationStart()}),e}if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");return _.prototype=Object.create(e&&e.prototype,{constructor:{value:_,writable:!0,configurable:!0}}),Object.defineProperty(_,"prototype",{writable:!1}),e&&P(_,e),t=[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var e=this.getTotalLength();this.setState({totalLength:e})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var e=this.getTotalLength();e!==this.state.totalLength&&this.setState({totalLength:e})}}},{key:"getTotalLength",value:function(){var e=this.mainCurve;try{return e&&e.getTotalLength&&e.getTotalLength()||0}catch(e){return 0}}},{key:"renderErrorBar",value:function(e,t){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var i=this.props,a=i.points,r=i.xAxis,o=i.yAxis,s=i.layout,l=i.children,c=(0,f.findAllByType)(l,m.ErrorBar);if(!c)return null;var u=function(e,t){return{x:e.x,y:e.y,value:e.value,errorVal:(0,g.getValueByDataKey)(e.payload,t)}};return n.default.createElement(d.Layer,{clipPath:e?"url(#clipPath-".concat(t,")"):null},c.map(function(e){return n.default.cloneElement(e,{key:"bar-".concat(e.props.dataKey),data:a,xAxis:r,yAxis:o,layout:s,dataPointFormatter:u})}))}},{key:"renderDots",value:function(e,t,i){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var a=this.props,r=a.dot,o=a.points,s=a.dataKey,l=(0,f.filterProps)(this.props,!1),c=(0,f.filterProps)(r,!0),u=o.map(function(e,t){var n=j(j(j({key:"dot-".concat(t),r:3},l),c),{},{index:t,cx:e.x,cy:e.y,value:e.value,dataKey:s,payload:e.payload,points:o});return _.renderDotItem(r,n)}),m={clipPath:e?"url(#clipPath-".concat(t?"":"dots-").concat(i,")"):null};return n.default.createElement(d.Layer,w({className:"recharts-line-dots",key:"dots"},m),u)}},{key:"renderCurveStatically",value:function(e,t,i,a){var r=this.props,o=r.type,s=r.layout,c=r.connectNulls,d=(r.ref,b(r,y)),u=j(j(j({},(0,f.filterProps)(d,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:t?"url(#clipPath-".concat(i,")"):null,points:e},a),{},{type:o,layout:s,connectNulls:c});return n.default.createElement(l.Curve,w({},u,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(e,t){var a=this,r=this.props,o=r.points,s=r.strokeDasharray,l=r.isAnimationActive,c=r.animationBegin,d=r.animationDuration,u=r.animationEasing,m=r.animationId,f=r.animateNewValues,h=r.width,g=r.height,y=this.state,v=y.prevPoints,x=y.totalLength;return n.default.createElement(i.default,{begin:c,duration:d,isActive:l,easing:u,from:{t:0},to:{t:1},key:"line-".concat(m),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(n){var i,r=n.t;if(v){var l=v.length/o.length,c=o.map(function(e,t){var n=Math.floor(t*l);if(v[n]){var i=v[n],a=(0,p.interpolateNumber)(i.x,e.x),o=(0,p.interpolateNumber)(i.y,e.y);return j(j({},e),{},{x:a(r),y:o(r)})}if(f){var s=(0,p.interpolateNumber)(2*h,e.x),c=(0,p.interpolateNumber)(g/2,e.y);return j(j({},e),{},{x:s(r),y:c(r)})}return j(j({},e),{},{x:e.x,y:e.y})});return a.renderCurveStatically(c,e,t)}var d=(0,p.interpolateNumber)(0,x)(r);if(s){var u="".concat(s).split(/[,\s]+/gim).map(function(e){return parseFloat(e)});i=a.getStrokeDasharray(d,x,u)}else i=a.generateSimpleStrokeDasharray(x,d);return a.renderCurveStatically(o,e,t,{strokeDasharray:i})})}},{key:"renderCurve",value:function(e,t){var n=this.props,i=n.points,a=n.isAnimationActive,r=this.state,s=r.prevPoints,l=r.totalLength;return a&&i&&i.length&&(!s&&l>0||!(0,o.default)(s,i))?this.renderCurveWithAnimation(e,t):this.renderCurveStatically(i,e,t)}},{key:"render",value:function(){var e,t=this.props,i=t.hide,a=t.dot,o=t.points,l=t.className,c=t.xAxis,m=t.yAxis,p=t.top,h=t.left,g=t.width,y=t.height,v=t.isAnimationActive,x=t.id;if(i||!o||!o.length)return null;var b=this.state.isAnimationFinished,w=1===o.length,_=(0,s.default)("recharts-line",l),j=c&&c.allowDataOverflow,A=m&&m.allowDataOverflow,S=j||A,E=(0,r.default)(x)?this.id:x,z=null!=(e=(0,f.filterProps)(a,!1))?e:{r:3,strokeWidth:2},C=z.r,P=z.strokeWidth,F=((0,f.hasClipDot)(a)?a:{}).clipDot,k=void 0===F||F,D=2*(void 0===C?3:C)+(void 0===P?2:P);return n.default.createElement(d.Layer,{className:_},j||A?n.default.createElement("defs",null,n.default.createElement("clipPath",{id:"clipPath-".concat(E)},n.default.createElement("rect",{x:j?h:h-g/2,y:A?p:p-y/2,width:j?g:2*g,height:A?y:2*y})),!k&&n.default.createElement("clipPath",{id:"clipPath-dots-".concat(E)},n.default.createElement("rect",{x:h-D/2,y:p-D/2,width:g+D,height:y+D}))):null,!w&&this.renderCurve(S,E),this.renderErrorBar(S,E),(w||a)&&this.renderDots(S,k,E),(!v||b)&&u.LabelList.renderCallByParent(this.props,o))}}],h=[{key:"getDerivedStateFromProps",value:function(e,t){return e.animationId!==t.prevAnimationId?{prevAnimationId:e.animationId,curPoints:e.points,prevPoints:t.curPoints}:e.points!==t.curPoints?{curPoints:e.points}:null}},{key:"repeat",value:function(e,t){for(var n=e.length%2!=0?[].concat(A(e),[0]):e,i=[],a=0;a<t;++a)i=[].concat(A(i),A(n));return i}},{key:"renderDotItem",value:function(e,t){var i;if(n.default.isValidElement(e))i=n.default.cloneElement(e,t);else if((0,a.default)(e))i=e(t);else{var r=t.key,o=b(t,v),l=(0,s.default)("recharts-line-dot","boolean"!=typeof e?e.className:"");i=n.default.createElement(c.Dot,w({key:r},o,{className:l}))}return i}}],t&&E(_.prototype,t),h&&E(_,h),Object.defineProperty(_,"prototype",{writable:!1}),_}(n.PureComponent);F(D,"displayName","Line"),F(D,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!h.Global.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1}),F(D,"getComposedData",function(e){var t=e.props,n=e.xAxis,i=e.yAxis,a=e.xAxisTicks,o=e.yAxisTicks,s=e.dataKey,l=e.bandSize,c=e.displayedData,d=e.offset,u=t.layout;return j({points:c.map(function(e,t){var c=(0,g.getValueByDataKey)(e,s);return"horizontal"===u?{x:(0,g.getCateCoordinateOfLine)({axis:n,ticks:a,bandSize:l,entry:e,index:t}),y:(0,r.default)(c)?null:i.scale(c),value:c,payload:e}:{x:(0,r.default)(c)?null:n.scale(c),y:(0,g.getCateCoordinateOfLine)({axis:i,ticks:o,bandSize:l,entry:e,index:t}),value:c,payload:e}}),layout:u},d)}),e.s(["Line",()=>D],555706);var O=e.i(785183),N=e.i(93230),q=e.i(844171),I=(0,t.generateCategoricalChart)({chartName:"LineChart",GraphicalChild:D,axisComponents:[{axisType:"xAxis",AxisComp:O.XAxis},{axisType:"yAxis",AxisComp:N.YAxis}],formatAxisMap:q.formatAxisMap});e.s(["LineChart",()=>I],129228)},529253,e=>{"use strict";let t=new class{metrics=[];maxMetrics=1e3;async measure(e,t,n){let i=performance.now();try{let a=await t(),r=performance.now()-i;return this.recordMetric({name:e,value:r,unit:"ms",timestamp:new Date().toISOString(),context:n}),a}catch(a){let t=performance.now()-i;throw this.recordMetric({name:e,value:t,unit:"ms",timestamp:new Date().toISOString(),context:{...n,error:a instanceof Error?a.message:"Unknown error"}}),a}}recordMetric(e){this.metrics.push(e),this.metrics.length>this.maxMetrics&&(this.metrics=this.metrics.slice(-this.maxMetrics))}getMetrics(e,t=100){return this.metrics.filter(t=>t.name===e).slice(-t)}getStats(e){let t=this.getMetrics(e);if(0===t.length)return null;let n=t.map(e=>e.value),i=n.reduce((e,t)=>e+t,0)/n.length,a=Math.min(...n),r=Math.max(...n),o=[...n].sort((e,t)=>e-t),s=o[Math.floor(o.length/2)],l=o[Math.floor(.95*o.length)],c=o[Math.floor(.99*o.length)];return{count:t.length,avg:i,min:a,max:r,median:s,p95:l,p99:c}}getAllMetrics(){return[...this.metrics]}clear(){this.metrics=[]}getMetricsByGroup(){let e={};for(let t of this.metrics)e[t.name]||(e[t.name]=[]),e[t.name].push(t);return e}};e.s(["performanceMonitor",0,t])},275691,e=>{"use strict";var t=e.i(843476),n=e.i(266027),i=e.i(920755),a=e.i(325715),r=e.i(770703),o=e.i(761911),s=e.i(212426),l=e.i(25652),c=e.i(87316),d=e.i(503116),u=e.i(21218),m=e.i(882293),p=e.i(167881),f=e.i(647163);e.i(882205);var h=e.i(846932),g=e.i(255749),y=e.i(377545);async function v(e){let t=new g.jsPDF({orientation:"portrait",unit:"mm",format:"a4"}),n=t.internal.pageSize.getWidth(),i=t.internal.pageSize.getHeight(),a=20,r=[31,41,55],o=[243,244,246];e.organization.logo,t.setFontSize(24),t.setTextColor(37,99,235),t.setFont("helvetica","bold"),t.text(e.title,20,a),a+=10,t.setFontSize(12),t.setTextColor(...r),t.setFont("helvetica","normal"),t.text(e.organization.name,20,a),a+=5,e.organization.address&&(t.setFontSize(10),t.setTextColor(107,114,128),t.text(e.organization.address,20,a),a+=5),e.period?(t.setFontSize(10),t.setTextColor(107,114,128),t.text(`P\xe9riode: ${(0,y.formatDate)(e.period.start)} - ${(0,y.formatDate)(e.period.end)}`,20,a),a+=8):a+=5,t.setDrawColor(...o),t.setLineWidth(.5),t.line(20,a,n-20,a),a+=10,t.setFontSize(16),t.setTextColor(...r),t.setFont("helvetica","bold"),t.text("Statistiques Principales",20,a),a+=10;let s=[{label:"Étudiants totaux",value:e.stats.totalStudents.toString()},{label:"Sessions actives",value:e.stats.activeSessions.toString()},{label:"Revenus mensuels",value:(0,y.formatCurrency)(e.stats.monthlyRevenue)},{label:"Factures en attente",value:e.stats.pendingInvoices.toString()}];void 0!==e.stats.attendanceRate&&s.push({label:"Taux de présence",value:`${e.stats.attendanceRate}%`}),void 0!==e.stats.completedPayments&&s.push({label:"Paiements complétés",value:e.stats.completedPayments.toString()});let l=(n-40)/2,c=0,d=0;return s.forEach((e,n)=>{let i=20+c*l,s=a+15*d;t.setFillColor(...o),t.roundedRect(i,s-8,l-5,12,2,2,"F"),t.setFontSize(9),t.setTextColor(107,114,128),t.setFont("helvetica","normal"),t.text(e.label,i+3,s-2),t.setFontSize(14),t.setTextColor(...r),t.setFont("helvetica","bold"),t.text(e.value,i+3,s+4),++c>=2&&(c=0,d++)}),(a+=15*d+15)>i-40&&(t.addPage(),a=20),t.setFontSize(8),t.setTextColor(156,163,175),t.setFont("helvetica","italic"),t.text(`G\xe9n\xe9r\xe9 le ${(0,y.formatDate)(e.generatedAt)}`,20,i-15),t.output("blob")}async function x(t,n,i){let a=await v(t),r=URL.createObjectURL(a),o=document.createElement("a"),s=n||`rapport_${new Date().toISOString().split("T")[0]}.pdf`;if(o.href=r,o.download=s,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(r),i?.organizationId&&i?.userId)try{let{exportHistoryService:t}=await e.A(874073);await t.create({organizationId:i.organizationId,userId:i.userId,exportType:"pdf",entityType:"dashboard_report",filename:s,recordCount:0,fileSizeBytes:a.size})}catch(e){console.warn("Erreur lors de l'enregistrement de l'historique d'export:",e)}}var b=e.i(27365),w=e.i(6799),_=e.i(129228),j=e.i(555706),A=e.i(785183),S=e.i(93230),E=e.i(872526),z=e.i(234239),C=e.i(731195),P=e.i(529253);function F(){let r=(0,i.createClient)(),{user:g}=(0,a.useAuth)(),{addToast:y}=(0,w.useToast)(),{data:v}=(0,n.useQuery)({queryKey:["dashboard-stats",g?.organization_id],staleTime:12e4,gcTime:6e5,refetchOnWindowFocus:!1,refetchOnMount:!1,queryFn:async()=>{if(!g?.organization_id)return null;let e=g.organization_id;return await P.performanceMonitor.measure("dashboard_stats",async()=>{let t=new Date;t.setDate(1);let n=new Date().toISOString().split("T")[0],[i,a,o,s,l,c,d,u,m,p]=await Promise.all([r.from("students").select("*",{count:"exact",head:!0}).eq("organization_id",e).eq("status","active"),r.from("payments").select("amount, currency, paid_at").eq("organization_id",g.organization_id).eq("status","completed").gte("paid_at",t.toISOString()),r.from("invoices").select("total_amount, document_type").eq("organization_id",g.organization_id).eq("status","overdue").or("document_type.eq.invoice,document_type.is.null"),r.from("attendance").select("status").eq("organization_id",g.organization_id).eq("date",n),r.from("users").select("*",{count:"exact",head:!0}).eq("organization_id",g.organization_id).eq("role","teacher").eq("is_active",!0),r.from("sessions").select("*, formations!inner(organization_id)",{count:"exact",head:!0}).eq("formations.organization_id",g.organization_id).eq("status","ongoing"),r.from("formations").select("*",{count:"exact",head:!0}).eq("organization_id",g.organization_id).eq("is_active",!0),r.from("programs").select("*",{count:"exact",head:!0}).eq("organization_id",g.organization_id).eq("is_active",!0),r.from("formations").select("id").eq("organization_id",g.organization_id),r.from("sessions").select("*, formations!inner(organization_id)",{count:"exact",head:!0}).eq("formations.organization_id",g.organization_id).eq("status","completed")]),f=i.count||0,h=(a.data||[]).reduce((e,t)=>e+Number(t.amount),0),y=(o.data||[]).reduce((e,t)=>e+Number(t.total_amount),0),v=s.data||[],x=v.length,b=v.filter(e=>"present"===e.status).length,w=l.count||0,_=c.count||0,j=d.count||0,A=u.count||0,S=p.count||0,E=0;if(m.data&&m.data.length>0){let e=m.data.map(e=>e.id),{data:t}=await r.from("sessions").select("id").in("formation_id",e);if(t&&t.length>0){let e=t.map(e=>e.id),{count:n}=await r.from("enrollments").select("*",{count:"exact",head:!0}).in("session_id",e);E=n||0}}return{studentsCount:f||0,monthlyRevenue:h,overdueAmount:y,avgAttendance:Math.round(x>0?b/x*100:0),teachersCount:w||0,activeSessionsCount:_||0,activeFormationsCount:j||0,activeProgramsCount:A||0,totalEnrollments:E||0,completedSessions:S||0}},{organizationId:g.organization_id})},enabled:!!g?.organization_id}),{data:F}=(0,n.useQuery)({queryKey:["revenue-evolution",g?.organization_id],queryFn:async()=>{if(!g?.organization_id)return[];let e=[],t=new Date;for(let n=5;n>=0;n--){let i=new Date(t.getFullYear(),t.getMonth()-n,1),a=new Date(t.getFullYear(),t.getMonth()-n+1,1),{data:o}=await r.from("payments").select("amount").eq("organization_id",g.organization_id).eq("status","completed").gte("paid_at",i.toISOString()).lt("paid_at",a.toISOString()),s=(o||[]).reduce((e,t)=>e+Number(t.amount),0);e.push({month:i.toLocaleDateString("fr-FR",{month:"short",year:"numeric"}),revenue:Math.round(s)})}return e},enabled:!!g?.organization_id}),{data:k}=(0,n.useQuery)({queryKey:["students-by-session",g?.organization_id],queryFn:async()=>{if(!g?.organization_id)return[];let{data:e}=await r.from("sessions").select("id, name, formations!inner(id, name, organization_id, programs(id, name))").eq("formations.organization_id",g.organization_id);return e?(await Promise.all(e.map(async e=>{let{count:t}=await r.from("students").select("*",{count:"exact",head:!0}).eq("class_id",e.id).eq("status","active"),n=e.formations?.name||"",i=e.formations?.programs?.name;return{name:i?`${e.name} - ${n} (${i})`:`${e.name} - ${n}`,students:t||0}}))).filter(e=>e.students>0):[]},enabled:!!g?.organization_id}),{data:D}=(0,n.useQuery)({queryKey:["invoice-status",g?.organization_id],queryFn:async()=>{if(!g?.organization_id)return[];let{data:e}=await r.from("invoices").select("status, document_type").eq("organization_id",g.organization_id).or("document_type.eq.invoice,document_type.is.null");if(!e)return[];let t=0,n=0,i=0,a=0,o=0;return e.forEach(e=>{let r=e.status;"paid"===r?t++:"sent"===r?n++:"partial"===r?i++:"overdue"===r?a++:"draft"===r&&o++}),[{name:"Payées",value:t,color:"#335ACF"},{name:"Envoyées",value:n,color:"#3B82F6"},{name:"Partielles",value:i,color:"#34B9EE"},{name:"En retard",value:a,color:"#EF4444"},{name:"Brouillons",value:o,color:"#6B7280"}].filter(e=>e.value>0)},enabled:!!g?.organization_id}),{data:O}=(0,n.useQuery)({queryKey:["recent-enrollments",g?.organization_id],queryFn:async()=>{if(!g?.organization_id)return[];let{data:e}=await r.from("formations").select("id").eq("organization_id",g.organization_id);if(!e||0===e.length)return[];let t=e.map(e=>e.id),{data:n}=await r.from("sessions").select("id").in("formation_id",t);if(!n||0===n.length)return[];let i=n.map(e=>e.id),{data:a,error:o}=await r.from("enrollments").select("*, students(first_name, last_name), sessions(name, formations(name, programs(name)))").in("session_id",i).order("created_at",{ascending:!1}).limit(5);return o?(console.error("Erreur lors de la récupération des inscriptions:",o),[]):a||[]},enabled:!!g?.organization_id}),{data:N}=(0,n.useQuery)({queryKey:["upcoming-events",g?.organization_id],queryFn:async()=>{if(!g?.organization_id)return[];let e=new Date().toISOString().split("T")[0],{data:t}=await r.from("sessions").select("*, formations!inner(name, organization_id, programs(name))").eq("formations.organization_id",g.organization_id).gte("start_date",e).in("status",["planned","ongoing"]).order("start_date",{ascending:!0}).limit(5);return(t||[]).map(e=>({id:e.id,name:e.name,formation:e.formations?.name||"",program:e.formations?.programs?.name||"",start_date:e.start_date,end_date:e.end_date,status:e.status}))},enabled:!!g?.organization_id}),{data:q}=(0,n.useQuery)({queryKey:["top-programs",g?.organization_id],queryFn:async()=>{if(!g?.organization_id)return[];let{data:e}=await r.from("programs").select("id, name, code, formations(id)").eq("organization_id",g.organization_id).eq("is_active",!0);return e?(await Promise.all(e.map(async e=>{let t=0;for(let n of e.formations||[]){let{data:e}=await r.from("sessions").select("id").eq("formation_id",n.id),i=(e||[]).map(e=>e.id).filter(e=>!!e);if(i&&i.length>0){let{count:e,error:n}=await r.from("enrollments").select("*",{count:"exact",head:!0}).in("session_id",i);if(n)throw n;t+=e||0}}return{id:e.id,name:e.name,code:e.code,enrollments:t}}))).filter(e=>e.enrollments>0).sort((e,t)=>t.enrollments-e.enrollments).slice(0,5):[]},enabled:!!g?.organization_id}),I=[{title:"Inscriptions",value:v?.totalEnrollments||0,icon:m.UserCheck,gradient:"from-[#34B9EE] to-[#335ACF]",neon:"#34B9EE"},{title:"Chiffre d'affaires",value:(0,f.formatCurrency)(v?.monthlyRevenue||0,"XOF"),icon:s.DollarSign,gradient:"from-[#335ACF] to-[#34B9EE]",neon:"#335ACF"},{title:"Apprenants",value:v?.studentsCount||0,icon:o.Users,gradient:"from-[#34B9EE] via-[#335ACF] to-[#34B9EE]",neon:"#34B9EE"},{title:"Sessions en cours",value:v?.activeSessionsCount||0,icon:u.Activity,gradient:"from-[#335ACF] to-[#34B9EE]",neon:"#335ACF"},{title:"Taux de présence",value:`${v?.avgAttendance||0}%`,icon:l.TrendingUp,gradient:"from-[#34B9EE] to-[#335ACF]",neon:"#34B9EE"}];return(0,t.jsxs)("div",{className:"fixed inset-0 bg-[#0A0A0F] overflow-y-auto",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-[#1A1A2E] via-[#0A0A0F] to-[#16213E] opacity-100"}),(0,t.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_30%_20%,rgba(51,90,207,0.15),transparent_50%),radial-gradient(circle_at_70%_80%,rgba(52,185,238,0.15),transparent_50%)]"}),(0,t.jsxs)("div",{className:"relative z-10 space-y-8 p-6 md:p-8 min-h-full",children:[(0,t.jsxs)(h.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-5xl font-light tracking-tight text-white mb-2",style:{fontFamily:"Inter, sans-serif",fontWeight:200},children:"Dashboard"}),(0,t.jsx)("p",{className:"text-white/60 text-sm font-light",style:{fontFamily:"Inter, sans-serif",fontWeight:300},children:"Vue d'ensemble en temps réel"})]}),(0,t.jsxs)(p.Button,{onClick:async()=>{try{if(!v||!g?.organization_id)return void y({type:"warning",title:"Données indisponibles",description:"Les statistiques ne sont pas encore chargées."});let{data:t}=await r.from("organizations").select("name, address").eq("id",g.organization_id).single();await x({title:"Rapport du Dashboard",organization:{name:t?.name||"Organisation",address:t?.address||void 0},stats:{totalStudents:v.studentsCount||0,activeSessions:v.activeSessionsCount||0,monthlyRevenue:v.monthlyRevenue||0,pendingInvoices:v.pendingInvoices||0,attendanceRate:v.avgAttendance,completedPayments:v.completedPayments||0},generatedAt:new Date().toISOString()},void 0,{organizationId:g.organization_id,userId:g.id}),y({type:"success",title:"Export réussi",description:"Le rapport PDF a été téléchargé avec succès."});{let{analytics:t}=await e.A(165059);t.export.pdf("dashboard_report")}}catch(e){console.error("Erreur lors de l'export PDF:",e),y({type:"error",title:"Erreur d'export",description:"Une erreur est survenue lors de la génération du PDF."})}},variant:"outline",className:"bg-white/5 backdrop-blur-xl border-white/10 text-white hover:bg-white/10",children:[(0,t.jsx)(b.FileDown,{className:"mr-2 h-4 w-4"}),"Exporter en PDF"]}),(0,t.jsxs)(p.Button,{onClick:async()=>{try{if(!v||!g?.organization_id)return void y({type:"warning",title:"Données indisponibles",description:"Les statistiques ne sont pas encore chargées."});let{data:t}=await r.from("organizations").select("name, address").eq("id",g.organization_id).single();await x({title:"Rapport du Dashboard",organization:{name:t?.name||"Organisation",address:t?.address||void 0},stats:{totalStudents:v.studentsCount||0,activeSessions:v.activeSessionsCount||0,monthlyRevenue:v.monthlyRevenue||0,pendingInvoices:v.pendingInvoices||0,attendanceRate:v.avgAttendance,completedPayments:v.completedPayments||0},generatedAt:new Date().toISOString()}),y({type:"success",title:"Export réussi",description:"Le rapport PDF a été téléchargé avec succès."});{let{analytics:t}=await e.A(165059);t.export.pdf("dashboard_report")}}catch(e){console.error("Erreur lors de l'export PDF:",e),y({type:"error",title:"Erreur d'export",description:"Une erreur est survenue lors de la génération du PDF."})}},variant:"outline",className:"bg-white/5 backdrop-blur-xl border-white/10 text-white hover:bg-white/10",children:[(0,t.jsx)(b.FileDown,{className:"mr-2 h-4 w-4"}),"Exporter en PDF"]})]}),(0,t.jsx)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5",children:I.map((e,n)=>(0,t.jsx)(h.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1*n},children:(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("div",{className:`absolute -inset-0.5 bg-gradient-to-r ${e.gradient} rounded-2xl opacity-75 group-hover:opacity-100 blur-sm transition-opacity`}),(0,t.jsxs)("div",{className:"relative bg-white/5 backdrop-blur-xl rounded-2xl border border-white/10 p-6 hover:bg-white/[0.08] transition-all duration-300",children:[(0,t.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,t.jsx)("div",{className:`p-3 rounded-xl bg-gradient-to-br ${e.gradient} opacity-90`,children:(0,t.jsx)(e.icon,{className:"h-5 w-5 text-white"})})}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-white/60 text-xs font-light uppercase tracking-wider",style:{fontFamily:"Inter, sans-serif",fontWeight:300},children:e.title}),(0,t.jsx)("p",{className:"text-3xl font-light text-white",style:{fontFamily:"Inter, sans-serif",fontWeight:200,textShadow:`0 0 20px ${e.neon}, 0 0 40px ${e.neon}40`},children:e.value})]}),(0,t.jsx)("div",{className:"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300",style:{boxShadow:`0 0 30px ${e.neon}40, inset 0 0 30px ${e.neon}20`}})]})]})},e.title))}),(0,t.jsxs)(h.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},className:"relative group",children:[(0,t.jsx)("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-[#335ACF] via-[#34B9EE] to-[#335ACF] rounded-2xl opacity-50 group-hover:opacity-75 blur-sm transition-opacity"}),(0,t.jsxs)("div",{className:"relative bg-white/5 backdrop-blur-xl rounded-2xl border border-white/10 p-6 hover:bg-white/[0.08] transition-all duration-300",children:[(0,t.jsx)("h3",{className:"text-white/90 text-lg font-light mb-6",style:{fontFamily:"Inter, sans-serif",fontWeight:300},children:"Évolution du chiffre d'affaires"}),F&&F.length>0?(0,t.jsx)(C.ResponsiveContainer,{width:"100%",height:300,...{},children:(0,t.jsxs)(_.LineChart,{data:F,...{},children:[(0,t.jsx)("defs",{children:(0,t.jsxs)("linearGradient",{id:"revenueGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,t.jsx)("stop",{offset:"5%",stopColor:"#34B9EE",stopOpacity:.8}),(0,t.jsx)("stop",{offset:"95%",stopColor:"#335ACF",stopOpacity:.1})]})}),(0,t.jsx)(E.CartesianGrid,{strokeDasharray:"3 3",stroke:"#ffffff20"}),(0,t.jsx)(A.XAxis,{dataKey:"month",stroke:"#ffffff60",style:{fontFamily:"Inter, sans-serif",fontSize:"12px",fontWeight:300}}),(0,t.jsx)(S.YAxis,{stroke:"#ffffff60",style:{fontFamily:"Inter, sans-serif",fontSize:"12px",fontWeight:300}}),(0,t.jsx)(z.Tooltip,{contentStyle:{backgroundColor:"rgba(10, 10, 15, 0.95)",border:"1px solid rgba(52, 185, 238, 0.5)",borderRadius:"12px",backdropFilter:"blur(20px)",color:"#fff",fontFamily:"Inter, sans-serif",fontWeight:300},formatter:e=>(0,f.formatCurrency)(e,"XOF")}),(0,t.jsx)(j.Line,{type:"monotone",dataKey:"revenue",stroke:"#34B9EE",strokeWidth:3,dot:{fill:"#34B9EE",r:5,filter:"drop-shadow(0 0 6px #34B9EE)"},activeDot:{r:7,fill:"#34B9EE",filter:"drop-shadow(0 0 12px #34B9EE)"},strokeDasharray:"0"})]})}):(0,t.jsx)("div",{className:"text-center py-12 text-white/40 text-sm font-light",style:{fontFamily:"Inter, sans-serif",fontWeight:300},children:"Aucune donnée disponible"})]})]}),(0,t.jsxs)(h.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},className:"relative group",children:[(0,t.jsx)("div",{className:"absolute -inset-0.5 bg-gradient-to-r from-[#34B9EE] via-[#335ACF] to-[#34B9EE] rounded-2xl opacity-50 group-hover:opacity-75 blur-sm transition-opacity"}),(0,t.jsxs)("div",{className:"relative bg-white/5 backdrop-blur-xl rounded-2xl border border-white/10 p-6 hover:bg-white/[0.08] transition-all duration-300",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)("h3",{className:"text-white/90 text-lg font-light",style:{fontFamily:"Inter, sans-serif",fontWeight:300},children:"Événements à venir"}),(0,t.jsx)(c.Calendar,{className:"h-5 w-5 text-[#34B9EE]"})]}),N&&N.length>0?(0,t.jsx)("div",{className:"space-y-4",children:N.map((e,n)=>(0,t.jsxs)(h.motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.4,delay:.5+.1*n},className:"flex items-center justify-between p-4 bg-white/5 rounded-xl border border-white/10 hover:bg-white/[0.08] transition-all group/item",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg bg-gradient-to-br from-[#34B9EE] to-[#335ACF] opacity-80",children:(0,t.jsx)(d.Clock,{className:"h-4 w-4 text-white"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:"text-white/90 font-light text-sm truncate",style:{fontFamily:"Inter, sans-serif",fontWeight:400},children:e.name}),(0,t.jsxs)("p",{className:"text-white/50 text-xs font-light mt-1",style:{fontFamily:"Inter, sans-serif",fontWeight:300},children:[e.program&&`${e.program} - `,e.formation]}),(0,t.jsx)("p",{className:"text-white/40 text-xs font-light mt-1",style:{fontFamily:"Inter, sans-serif",fontWeight:300},children:new Date(e.start_date).toLocaleDateString("fr-FR",{day:"numeric",month:"short"})})]})]}),(0,t.jsx)("div",{className:"px-3 py-1 rounded-lg text-xs font-light border",style:{backgroundColor:"ongoing"===e.status?"rgba(52, 185, 238, 0.2)":"rgba(51, 90, 207, 0.2)",borderColor:"ongoing"===e.status?"rgba(52, 185, 238, 0.5)":"rgba(51, 90, 207, 0.5)",color:"ongoing"===e.status?"#34B9EE":"#335ACF",fontFamily:"Inter, sans-serif",fontWeight:300},children:"ongoing"===e.status?"En cours":"Planifié"})]},e.id))}):(0,t.jsx)("div",{className:"text-center py-12 text-white/40 text-sm font-light",style:{fontFamily:"Inter, sans-serif",fontWeight:300},children:"Aucun événement à venir"})]})]})]})]})}(0,r.default)(()=>e.A(353888).then(e=>e.PremiumLineChart),{loadableGenerated:{modules:[967339]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"h-64 bg-gray-100 rounded-lg animate-pulse"})}),(0,r.default)(()=>e.A(249116).then(e=>e.PremiumBarChart),{loadableGenerated:{modules:[238249]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"h-64 bg-gray-100 rounded-lg animate-pulse"})}),(0,r.default)(()=>e.A(986809).then(e=>e.PremiumPieChart),{loadableGenerated:{modules:[307353]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"h-64 bg-gray-100 rounded-lg animate-pulse"})}),e.s(["default",()=>F],275691)},48503,e=>{e.v(t=>Promise.all(["static/chunks/2988bfaf82a45b76.js"].map(t=>e.l(t))).then(()=>t(915833)))},870653,e=>{e.v(t=>Promise.all(["static/chunks/e551d4a510c7c3c6.js"].map(t=>e.l(t))).then(()=>t(424154)))},195111,e=>{e.v(t=>Promise.all(["static/chunks/9fc253a1d558cb4a.js"].map(t=>e.l(t))).then(()=>t(38201)))},874073,e=>{e.v(t=>Promise.all(["static/chunks/dac71c69e49f2346.js"].map(t=>e.l(t))).then(()=>t(389704)))},353888,e=>{e.v(t=>Promise.all(["static/chunks/6a0cf8cf62eb8248.js"].map(t=>e.l(t))).then(()=>t(967339)))},249116,e=>{e.v(t=>Promise.all(["static/chunks/59e7a0e871f73508.js"].map(t=>e.l(t))).then(()=>t(238249)))},986809,e=>{e.v(t=>Promise.all(["static/chunks/15014c725e640a7b.js","static/chunks/35e9d40a3003c45b.js"].map(t=>e.l(t))).then(()=>t(307353)))},165059,e=>{e.v(e=>Promise.resolve().then(()=>e(172431)))}]);