(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let t=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],107233)},503116,e=>{"use strict";let t=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],503116)},605631,e=>{"use strict";let t=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],605631)},738308,e=>{"use strict";let t=(0,e.i(475254).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],738308)},797548,e=>{"use strict";let t=(0,e.i(475254).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);e.s(["Filter",()=>t],797548)},562369,e=>{"use strict";var t=e.i(920755);let s=new class{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async getCategories(e){let{data:t,error:s}=await this.supabase.from("support_categories").select("*").eq("organization_id",e).eq("is_active",!0).order("order_index",{ascending:!0});if(s){if("PGRST116"===s.code||"42P01"===s.code||"PGRST301"===s.code||404===s.status||"404"===s.code||s.message?.includes("relation")||s.message?.includes("relationship")||s.message?.includes("does not exist")||s.message?.includes("schema cache"))return console.warn("Table support_categories does not exist yet or invalid query:",s?.message),[];throw s}return t||[]}async createCategory(e){let{data:t,error:s}=await this.supabase.from("support_categories").insert(e).select().single();if(s)throw s;return t}async updateCategory(e,t){let{data:s,error:r}=await this.supabase.from("support_categories").update(t).eq("id",e).select().single();if(r)throw r;return s}async deleteCategory(e){let{error:t}=await this.supabase.from("support_categories").delete().eq("id",e);if(t)throw t}async getTickets(e,t){let s=this.supabase.from("support_tickets").select(`
        *,
        user:users(id, full_name, email),
        assigned_user:users!support_tickets_assigned_to_fkey(id, full_name, email),
        category:support_categories(*)
      `).eq("organization_id",e);t?.userId&&(s=s.eq("user_id",t.userId)),t?.status&&(s=s.eq("status",t.status)),t?.priority&&(s=s.eq("priority",t.priority)),t?.categoryId&&(s=s.eq("category_id",t.categoryId)),t?.assignedTo&&(s=s.eq("assigned_to",t.assignedTo));let{data:r,error:a}=await s.order("created_at",{ascending:!1});if(a){if("PGRST116"===a.code||"42P01"===a.code||"PGRST301"===a.code||404===a.status||400===a.status||"404"===a.code||"400"===a.code||a.message?.includes("relation")||a.message?.includes("relationship")||a.message?.includes("does not exist")||a.message?.includes("schema cache")||a.message?.includes("Could not find a relationship"))return[];throw a}return r||[]}async getTicketById(e){let{data:t,error:s}=await this.supabase.from("support_tickets").select(`
        *,
        user:users(id, full_name, email),
        assigned_user:users!support_tickets_assigned_to_fkey(id, full_name, email),
        category:support_categories(*)
      `).eq("id",e).single();if(s)throw s;return t}async createTicket(e){let{data:t,error:s}=await this.supabase.from("support_tickets").insert(e).select().single();if(s)throw s;return t}async updateTicket(e,t){let{data:s,error:r}=await this.supabase.from("support_tickets").update(t).eq("id",e).select().single();if(r)throw r;return s}async assignTicket(e,t){return this.updateTicket(e,{assigned_to:t,assigned_at:new Date().toISOString(),status:"in_progress"})}async resolveTicket(e){return this.updateTicket(e,{status:"resolved",resolved_at:new Date().toISOString()})}async closeTicket(e){return this.updateTicket(e,{status:"closed",closed_at:new Date().toISOString()})}async getTicketMessages(e){let{data:t,error:s}=await this.supabase.from("support_ticket_messages").select(`
        *,
        user:users(id, full_name, email)
      `).eq("ticket_id",e).order("created_at",{ascending:!0});if(s)throw s;return t}async createMessage(e){let{data:t,error:s}=await this.supabase.from("support_ticket_messages").insert(e).select(`
        *,
        user:users(id, full_name, email)
      `).single();if(s)throw s;return t}async markMessageAsRead(e){let{data:t,error:s}=await this.supabase.from("support_ticket_messages").update({is_read:!0,read_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw s;return t}async getTicketNotes(e){let{data:t,error:s}=await this.supabase.from("support_ticket_notes").select(`
        *,
        user:users(id, full_name, email)
      `).eq("ticket_id",e).order("created_at",{ascending:!1});if(s)throw s;return t}async createNote(e){let{data:t,error:s}=await this.supabase.from("support_ticket_notes").insert(e).select(`
        *,
        user:users(id, full_name, email)
      `).single();if(s)throw s;return t}async updateNote(e,t){let{data:s,error:r}=await this.supabase.from("support_ticket_notes").update(t).eq("id",e).select().single();if(r)throw r;return s}async deleteNote(e){let{error:t}=await this.supabase.from("support_ticket_notes").delete().eq("id",e);if(t)throw t}async createRating(e){let{data:t,error:s}=await this.supabase.from("support_ticket_ratings").insert(e).select().single();if(s)throw s;return t}async getTicketRating(e){let{data:t,error:s}=await this.supabase.from("support_ticket_ratings").select("*").eq("ticket_id",e).maybeSingle();if(s)throw s;return t}async getTemplates(e){let{data:t,error:s}=await this.supabase.from("support_response_templates").select("*").eq("organization_id",e).eq("is_active",!0).order("name",{ascending:!0});if(s)throw s;return t}async createTemplate(e){let{data:t,error:s}=await this.supabase.from("support_response_templates").insert(e).select().single();if(s)throw s;return t}async updateTemplate(e,t){let{data:s,error:r}=await this.supabase.from("support_response_templates").update(t).eq("id",e).select().single();if(r)throw r;return s}async deleteTemplate(e){let{error:t}=await this.supabase.from("support_response_templates").delete().eq("id",e);if(t)throw t}async getStatistics(e,t){let s=this.supabase.from("support_tickets").select("status, priority, created_at, resolved_at, first_response_at").eq("organization_id",e);t?.startDate&&(s=s.gte("created_at",t.startDate)),t?.endDate&&(s=s.lte("created_at",t.endDate));let{data:r,error:a}=await s;if(a)throw a;let i=r||[],l={total:i.length,byStatus:{open:0,in_progress:0,waiting_customer:0,resolved:0,closed:0},byPriority:{low:0,medium:0,high:0,urgent:0},averageResponseTime:0,averageResolutionTime:0,resolutionRate:0},n=0,c=0,o=0,u=0,d=0;return i.forEach(e=>{if(e.status&&e.status in l.byStatus&&l.byStatus[e.status]++,e.priority&&e.priority in l.byPriority&&l.byPriority[e.priority]++,e.first_response_at&&e.created_at){let t=new Date(e.first_response_at).getTime()-new Date(e.created_at).getTime();n+=t,c++}if(e.resolved_at&&e.created_at){let t=new Date(e.resolved_at).getTime()-new Date(e.created_at).getTime();o+=t,u++}("resolved"===e.status||"closed"===e.status)&&d++}),c>0&&(l.averageResponseTime=n/c/6e4),u>0&&(l.averageResolutionTime=o/u/36e5),r.length>0&&(l.resolutionRate=d/r.length*100),l}};e.s(["supportService",0,s])},506642,e=>{"use strict";var t=e.i(843476),s=e.i(271645),r=e.i(266027),a=e.i(954616),i=e.i(912598),l=e.i(325715),n=e.i(562369),c=e.i(970065),o=e.i(167881),u=e.i(23750),d=e.i(10708),p=e.i(184762),m=e.i(630374),g=e.i(716158),h=e.i(107233),x=e.i(686311),y=e.i(503116),_=e.i(605631),f=e.i(738308),j=e.i(898791),w=e.i(797548),v=e.i(522016),b=e.i(647163);function S(){let{user:e}=(0,l.useAuth)(),S=(0,i.useQueryClient)(),[k,T]=(0,s.useState)(!1),[C,N]=(0,s.useState)("all"),[q,I]=(0,s.useState)("all"),{data:D=[]}=(0,r.useQuery)({queryKey:["support-categories",e?.organization_id],queryFn:async()=>{try{return await n.supportService.getCategories(e?.organization_id||"")}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===404||e?.code==="404"||e?.message?.includes("relation")||e?.message?.includes("relationship")||e?.message?.includes("does not exist")||e?.message?.includes("schema cache"))return console.warn("Error fetching support categories:",e?.message),[];throw e}},enabled:!!e?.organization_id,retry:!1}),{data:P=[]}=(0,r.useQuery)({queryKey:["support-tickets",e?.organization_id,C,q],queryFn:async()=>{try{let t={};return"all"!==C&&(t.status=C),"all"!==q&&(t.priority=q),e?.role!=="admin"&&e?.role!=="super_admin"&&e?.role!=="support"&&(t.userId=e?.id),await n.supportService.getTickets(e?.organization_id||"",t)}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===404||e?.status===400||e?.code==="404"||e?.code==="400"||e?.message?.includes("relation")||e?.message?.includes("relationship")||e?.message?.includes("does not exist")||e?.message?.includes("schema cache")||e?.message?.includes("Could not find a relationship"))return[];throw e}},enabled:!!e?.organization_id,retry:!1}),R=(0,a.useMutation)({mutationFn:async t=>n.supportService.createTicket({...t,organization_id:e?.organization_id,user_id:e?.id}),onSuccess:()=>{S.invalidateQueries({queryKey:["support-tickets"]}),T(!1)}});return(0,t.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Support client"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Gérez vos demandes de support et suivez vos tickets"})]}),(0,t.jsxs)(m.Dialog,{open:k,onOpenChange:T,children:[(0,t.jsx)(m.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(o.Button,{children:[(0,t.jsx)(h.Plus,{className:"h-4 w-4 mr-2"}),"Nouveau ticket"]})}),(0,t.jsxs)(m.DialogContent,{className:"max-w-2xl",children:[(0,t.jsxs)(m.DialogHeader,{children:[(0,t.jsx)(m.DialogTitle,{children:"Nouveau ticket de support"}),(0,t.jsx)(m.DialogDescription,{children:"Créez un nouveau ticket pour obtenir de l'aide"})]}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault();let t=new FormData(e.currentTarget),s={category_id:t.get("category_id")||null,subject:t.get("subject"),description:t.get("description"),priority:t.get("priority")||"medium",tags:t.get("tags")?.split(",").map(e=>e.trim()).filter(Boolean)||[]};R.mutate(s)},children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"category_id",children:"Catégorie"}),(0,t.jsxs)(g.Select,{children:[(0,t.jsx)(g.SelectTrigger,{children:(0,t.jsx)(g.SelectValue,{placeholder:"Sélectionner une catégorie"})}),(0,t.jsx)(g.SelectContent,{children:D?.map(e=>(0,t.jsx)(g.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"subject",children:"Sujet *"}),(0,t.jsx)(u.Input,{id:"subject",name:"subject",required:!0,placeholder:"Décrivez brièvement votre problème"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"description",children:"Description *"}),(0,t.jsx)(p.Textarea,{id:"description",name:"description",required:!0,rows:6,placeholder:"Décrivez votre problème en détail..."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"priority",children:"Priorité"}),(0,t.jsxs)(g.Select,{children:[(0,t.jsx)(g.SelectTrigger,{children:(0,t.jsx)(g.SelectValue,{})}),(0,t.jsxs)(g.SelectContent,{children:[(0,t.jsx)(g.SelectItem,{value:"low",children:"Basse"}),(0,t.jsx)(g.SelectItem,{value:"medium",children:"Moyenne"}),(0,t.jsx)(g.SelectItem,{value:"high",children:"Élevée"}),(0,t.jsx)(g.SelectItem,{value:"urgent",children:"Urgente"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"tags",children:"Tags (séparés par des virgules)"}),(0,t.jsx)(u.Input,{id:"tags",name:"tags",placeholder:"bug, facturation, fonctionnalité"})]})]}),(0,t.jsxs)(m.DialogFooter,{className:"mt-6",children:[(0,t.jsx)(o.Button,{type:"button",variant:"outline",onClick:()=>T(!1),children:"Annuler"}),(0,t.jsx)(o.Button,{type:"submit",disabled:R.isPending,children:"Créer le ticket"})]})]})]})]})]})}),(0,t.jsx)(c.Card,{className:"mb-6",children:(0,t.jsx)(c.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(w.Filter,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsx)(d.Label,{children:"Statut:"}),(0,t.jsxs)(g.Select,{value:C,onValueChange:N,children:[(0,t.jsx)(g.SelectTrigger,{className:"w-40",children:(0,t.jsx)(g.SelectValue,{})}),(0,t.jsxs)(g.SelectContent,{children:[(0,t.jsx)(g.SelectItem,{value:"all",children:"Tous"}),(0,t.jsx)(g.SelectItem,{value:"open",children:"Ouvert"}),(0,t.jsx)(g.SelectItem,{value:"in_progress",children:"En cours"}),(0,t.jsx)(g.SelectItem,{value:"waiting_customer",children:"En attente"}),(0,t.jsx)(g.SelectItem,{value:"resolved",children:"Résolu"}),(0,t.jsx)(g.SelectItem,{value:"closed",children:"Fermé"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Label,{children:"Priorité:"}),(0,t.jsxs)(g.Select,{value:q,onValueChange:I,children:[(0,t.jsx)(g.SelectTrigger,{className:"w-40",children:(0,t.jsx)(g.SelectValue,{})}),(0,t.jsxs)(g.SelectContent,{children:[(0,t.jsx)(g.SelectItem,{value:"all",children:"Toutes"}),(0,t.jsx)(g.SelectItem,{value:"urgent",children:"Urgente"}),(0,t.jsx)(g.SelectItem,{value:"high",children:"Élevée"}),(0,t.jsx)(g.SelectItem,{value:"medium",children:"Moyenne"}),(0,t.jsx)(g.SelectItem,{value:"low",children:"Basse"})]})]})]})]})})}),(0,t.jsxs)(c.Card,{children:[(0,t.jsx)(c.CardHeader,{children:(0,t.jsx)(c.CardTitle,{children:"Mes tickets"})}),(0,t.jsx)(c.CardContent,{children:P&&P.length>0?(0,t.jsx)("div",{className:"space-y-4",children:P.map(e=>(0,t.jsx)(v.default,{href:`/dashboard/support/${e.id}`,className:"block",children:(0,t.jsx)(c.Card,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:(0,t.jsx)(c.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("span",{className:"font-mono text-sm text-muted-foreground",children:e.ticket_number}),(0,t.jsx)("h3",{className:"font-semibold text-lg",children:e.subject}),(0,t.jsx)("span",{className:`text-xs px-2 py-1 rounded ${(e=>{switch(e){case"urgent":return"bg-red-100 text-red-800";case"high":return"bg-orange-100 text-orange-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}})(e.priority)}`,children:(e=>{switch(e){case"urgent":return"Urgent";case"high":return"Élevée";case"medium":return"Moyenne";case"low":return"Basse";default:return e}})(e.priority)})]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mb-3 line-clamp-2",children:e.description}),(0,t.jsxs)("div",{className:"flex items-center gap-4 text-xs text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(e=>{switch(e){case"open":return(0,t.jsx)(j.AlertCircle,{className:"h-4 w-4 text-blue-600"});case"in_progress":return(0,t.jsx)(y.Clock,{className:"h-4 w-4 text-yellow-600"});case"waiting_customer":return(0,t.jsx)(y.Clock,{className:"h-4 w-4 text-orange-600"});case"resolved":return(0,t.jsx)(_.CheckCircle,{className:"h-4 w-4 text-green-600"});case"closed":return(0,t.jsx)(f.XCircle,{className:"h-4 w-4 text-gray-600"});default:return null}})(e.status),(0,t.jsx)("span",{children:(e=>{switch(e){case"open":return"Ouvert";case"in_progress":return"En cours";case"waiting_customer":return"En attente client";case"resolved":return"Résolu";case"closed":return"Fermé";default:return e}})(e.status)})]}),(0,t.jsxs)("span",{children:["Créé le ",(0,b.formatDate)(e.created_at)]}),e.category&&(0,t.jsx)("span",{children:e.category.name}),e.assigned_user&&(0,t.jsxs)("span",{children:["Assigné à ",e.assigned_user.full_name]})]})]}),(0,t.jsx)(x.MessageSquare,{className:"h-5 w-5 text-muted-foreground"})]})})})},e.id))}):(0,t.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"Aucun ticket trouvé"})})]})]})}e.s(["default",()=>S])}]);