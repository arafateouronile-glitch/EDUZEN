(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let i=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>i],107233)},503116,e=>{"use strict";let i=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>i],503116)},738308,e=>{"use strict";let i=(0,e.i(475254).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>i],738308)},25652,e=>{"use strict";let i=(0,e.i(475254).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);e.s(["TrendingUp",()=>i],25652)},127341,e=>{"use strict";var i=e.i(843476),s=e.i(271645),t=e.i(647163);let a=s.createContext(void 0);function n({value:e,defaultValue:n,onValueChange:r,children:c,className:o}){let l=void 0!==e,[d,u]=s.useState(n??"");s.useEffect(()=>{l||void 0===n||u(n)},[n]);let m=l?e:d,h=s.useCallback(e=>{l||u(e),r?.(e)},[l,r]);return(0,i.jsx)(a.Provider,{value:{value:m,onValueChange:h},children:(0,i.jsx)("div",{className:(0,t.cn)("w-full",o),children:c})})}function r(){let e=s.useContext(a);if(!e)throw Error("Tabs components must be used within a Tabs component");return e}function c({children:e,className:s}){return(0,i.jsx)("div",{className:(0,t.cn)("inline-flex h-10 items-center justify-center rounded-lg bg-bg-gray-100 p-1 text-text-tertiary",s),children:e})}function o({value:e,children:s,className:a}){let{value:n,onValueChange:c}=r(),o=n===e;return(0,i.jsx)("button",{type:"button",onClick:()=>c(e),className:(0,t.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-outline-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",o?"bg-white text-text-primary shadow-sm":"text-text-tertiary hover:text-text-primary",a),children:s})}function l({value:e,children:s,className:a}){let{value:n}=r();return n!==e?null:(0,i.jsx)("div",{className:(0,t.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),children:s})}e.s(["Tabs",()=>n,"TabsContent",()=>l,"TabsList",()=>c,"TabsTrigger",()=>o])},784173,e=>{"use strict";var i=e.i(843476),s=e.i(271645),t=e.i(266027),a=e.i(954616),n=e.i(912598),r=e.i(325715);e.i(247167);var c=e.i(920755);let o=new class{supabase;constructor(e){this.supabase=e||(0,c.createClient)()}async getIndicators(e){let{data:i,error:s}=await this.supabase.from("qualiopi_indicators").select("*").eq("organization_id",e).order("indicator_code",{ascending:!0});if(s){if("PGRST116"===s.code||"42P01"===s.code||"PGRST301"===s.code||404===s.status||"404"===s.code||s.message?.includes("relation")||s.message?.includes("relationship")||s.message?.includes("does not exist")||s.message?.includes("schema cache"))return console.warn("Table qualiopi_indicators does not exist yet or invalid query:",s?.message),[];throw s}return i||[]}async getIndicatorByCode(e,i){let{data:s,error:t}=await this.supabase.from("qualiopi_indicators").select("*").eq("organization_id",e).eq("indicator_code",i).single();if(t){if("PGRST116"===t.code)return null;throw t}return s}async upsertIndicator(e){let{data:i,error:s}=await this.supabase.from("qualiopi_indicators").upsert(e,{onConflict:"organization_id,indicator_code"}).select().single();if(s)throw s;return i}async updateIndicatorStatus(e,i,s){let t={status:i,updated_at:new Date().toISOString()};void 0!==s&&(t.compliance_rate=s,t.last_evaluation_date=new Date().toISOString());let{error:a}=await this.supabase.from("qualiopi_indicators").update(t).eq("id",e);if(a)throw a}async getEvidence(e){let{data:i,error:s}=await this.supabase.from("qualiopi_evidence").select("*").eq("indicator_id",e).order("upload_date",{ascending:!1});if(s)throw s;return i||[]}async addEvidence(e){let{data:i,error:s}=await this.supabase.from("qualiopi_evidence").insert(e).select().single();if(s)throw s;return i}async getCorrectiveActions(e,i){let s=this.supabase.from("qualiopi_corrective_actions").select("*").eq("organization_id",e);i?.indicatorId&&(s=s.eq("indicator_id",i.indicatorId)),i?.status&&(s=s.eq("status",i.status)),i?.priority&&(s=s.eq("priority",i.priority));let{data:t,error:a}=await s.order("created_at",{ascending:!1});if(a)throw a;return t||[]}async createCorrectiveAction(e){let{data:i,error:s}=await this.supabase.from("qualiopi_corrective_actions").insert(e).select().single();if(s)throw s;return i}async getAudits(e){let{data:i,error:s}=await this.supabase.from("qualiopi_audits").select("*").eq("organization_id",e).order("audit_date",{ascending:!1});if(s)throw s;return i||[]}async createAudit(e){let{data:i,error:s}=await this.supabase.from("qualiopi_audits").insert(e).select().single();if(s)throw s;return i}async calculateComplianceRate(e){try{let{data:i,error:s}=await this.supabase.rpc("calculate_qualiopi_compliance_rate",{org_id:e});if(s){if("PGRST116"===s.code||"42883"===s.code||"PGRST301"===s.code||404===s.status||"404"===s.code||"404"===String(s.status)||"404"===String(s.code)||s.message?.toLowerCase().includes("function")||s.message?.toLowerCase().includes("does not exist")||s.message?.toLowerCase().includes("schema cache")||s.message?.toLowerCase().includes("not found")||s.message?.toLowerCase().includes("404"))return 0;throw s}return i||0}catch(e){if(e?.status===404||e?.code==="404"||"404"===String(e?.status)||e?.message?.toLowerCase().includes("not found")||e?.message?.toLowerCase().includes("404")||e?.message?.toLowerCase().includes("function")||e?.message?.toLowerCase().includes("does not exist"))return 0;throw e}}async initializeIndicators(e){let i=[{code:"1.1",name:"Information préalable",category:"conditions_reception"},{code:"1.2",name:"Accueil et accompagnement",category:"conditions_reception"},{code:"1.3",name:"Accessibilité",category:"conditions_reception"},{code:"2.1",name:"Identification des besoins",category:"identification_objectifs"},{code:"2.2",name:"Définition des objectifs",category:"identification_objectifs"},{code:"3.1",name:"Adaptation pédagogique",category:"adaptation_parcours"},{code:"3.2",name:"Suivi individualisé",category:"adaptation_parcours"},{code:"4.1",name:"Ressources pédagogiques",category:"adéquation_ressources"},{code:"4.2",name:"Ressources techniques",category:"adéquation_ressources"},{code:"4.3",name:"Ressources humaines",category:"adéquation_ressources"},{code:"5.1",name:"Compétences pédagogiques",category:"compétences_formateurs"},{code:"5.2",name:"Compétences techniques",category:"compétences_formateurs"},{code:"5.3",name:"Formation continue",category:"compétences_formateurs"},{code:"6.1",name:"Processus d'inscription",category:"inscription"},{code:"6.2",name:"Contrat de formation",category:"inscription"},{code:"7.1",name:"Évaluation des acquis",category:"evaluation"},{code:"7.2",name:"Certification",category:"evaluation"},{code:"8.1",name:"Accessibilité physique",category:"accessibilite"},{code:"8.2",name:"Accessibilité numérique",category:"accessibilite"},{code:"9.1",name:"Transparence de l'information",category:"information_public"},{code:"9.2",name:"Publicité",category:"information_public"},{code:"10.1",name:"Gouvernance et pilotage",category:"gouvernance"},{code:"10.2",name:"Amélioration continue",category:"gouvernance"}].map(i=>({organization_id:e,indicator_code:i.code,indicator_name:i.name,category:i.category,status:"not_started",compliance_rate:0})),{error:s}=await this.supabase.from("qualiopi_indicators").upsert(i,{onConflict:"organization_id,indicator_code",ignoreDuplicates:!1});if(s){if("PGRST116"===s.code||"42P01"===s.code||"PGRST301"===s.code||404===s.status||"404"===s.code||s.message?.includes("relation")||s.message?.includes("relationship")||s.message?.includes("does not exist")||s.message?.includes("schema cache"))throw console.warn("Table qualiopi_indicators does not exist yet. Please create the table first:",s?.message),Error("La table qualiopi_indicators n'existe pas encore. Veuillez créer la table dans la base de données.");throw s}}};var l=e.i(970065),d=e.i(167881),u=e.i(994179),m=e.i(127341),h=e.i(6799),g=e.i(98919),x=e.i(465286),p=e.i(738308),f=e.i(898791),b=e.i(503116),j=e.i(178583),y=e.i(25652),w=e.i(107233),v=e.i(16715),C=e.i(482751),_=e.i(522016);let N={not_started:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800",compliant:"bg-green-100 text-green-800",non_compliant:"bg-red-100 text-red-800",needs_improvement:"bg-yellow-100 text-yellow-800"},q={not_started:b.Clock,in_progress:v.RefreshCw,compliant:x.CheckCircle2,non_compliant:p.XCircle,needs_improvement:f.AlertCircle};function T(){let{user:e}=(0,r.useAuth)(),c=(0,n.useQueryClient)(),{addToast:T}=(0,h.useToast)(),[S,P]=(0,s.useState)("all"),{data:A=[],isLoading:z}=(0,t.useQuery)({queryKey:["qualiopi-indicators",e?.organization_id],queryFn:async()=>{try{return await o.getIndicators(e.organization_id)}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===404||e?.code==="404"||e?.message?.includes("relation")||e?.message?.includes("relationship")||e?.message?.includes("does not exist")||e?.message?.includes("schema cache"))return console.warn("Error fetching qualiopi indicators:",e?.message),[];throw e}},enabled:!!e?.organization_id,retry:!1}),{data:R=0}=(0,t.useQuery)({queryKey:["qualiopi-compliance-rate",e?.organization_id],queryFn:async()=>{try{return await o.calculateComplianceRate(e.organization_id)}catch(e){if(e?.code==="PGRST116"||e?.code==="42883"||e?.code==="PGRST301"||e?.status===404||e?.code==="404"||"404"===String(e?.status)||e?.message?.toLowerCase().includes("function")||e?.message?.toLowerCase().includes("does not exist")||e?.message?.toLowerCase().includes("schema cache")||e?.message?.toLowerCase().includes("not found")||e?.message?.toLowerCase().includes("404"))return 0;throw e}},enabled:!!e?.organization_id,retry:!1}),k=(0,a.useMutation)({mutationFn:()=>o.initializeIndicators(e.organization_id),onSuccess:()=>{c.invalidateQueries({queryKey:["qualiopi-indicators"]}),T({title:"Indicateurs initialisés",description:"Les indicateurs Qualiopi ont été initialisés avec succès.",type:"success"})},onError:e=>{console.error("Error initializing indicators:",e),T({type:"error",title:"Erreur",description:e?.message||"Une erreur est survenue lors de l'initialisation des indicateurs."})}}),I=Array.from(new Set(A.map(e=>e.category))),L="all"===S?A:A.filter(e=>e.category===S),G={total:A.length,compliant:A.filter(e=>"compliant"===e.status).length,inProgress:A.filter(e=>"in_progress"===e.status).length,nonCompliant:A.filter(e=>"non_compliant"===e.status).length};return z?(0,i.jsx)("div",{className:"container mx-auto py-8 px-4",children:(0,i.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,i.jsx)(v.RefreshCw,{className:"h-8 w-8 animate-spin text-brand-blue"})})}):0===A.length?(0,i.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-4xl",children:(0,i.jsxs)(l.Card,{children:[(0,i.jsxs)(l.CardHeader,{children:[(0,i.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,i.jsx)(g.Shield,{className:"h-6 w-6"}),"Module Qualiopi"]}),(0,i.jsx)(l.CardDescription,{children:"Initialisez les indicateurs Qualiopi pour commencer la gestion de votre certification qualité"})]}),(0,i.jsx)(l.CardContent,{children:(0,i.jsxs)("div",{className:"text-center py-8",children:[(0,i.jsx)("p",{className:"text-muted-foreground mb-6",children:"Aucun indicateur Qualiopi n'a été configuré pour votre organisation."}),(0,i.jsx)(d.Button,{onClick:()=>k.mutate(),disabled:k.isPending,children:k.isPending?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(v.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}),"Initialisation..."]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(w.Plus,{className:"h-4 w-4 mr-2"}),"Initialiser les indicateurs Qualiopi"]})})]})})]})}):(0,i.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,i.jsxs)("div",{className:"mb-8",children:[(0,i.jsxs)("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-2",children:[(0,i.jsx)(g.Shield,{className:"h-8 w-8 text-brand-blue"}),"Certification Qualiopi"]}),(0,i.jsx)("p",{className:"text-muted-foreground",children:"Gérez votre certification qualité et vos indicateurs de conformité"})]}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,i.jsx)(l.Card,{children:(0,i.jsx)(l.CardContent,{className:"pt-6",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Taux de conformité"}),(0,i.jsxs)("p",{className:"text-2xl font-bold",children:[R.toFixed(1),"%"]})]}),(0,i.jsx)(y.TrendingUp,{className:"h-8 w-8 text-green-500"})]})})}),(0,i.jsx)(l.Card,{children:(0,i.jsx)(l.CardContent,{className:"pt-6",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Conformes"}),(0,i.jsx)("p",{className:"text-2xl font-bold",children:G.compliant})]}),(0,i.jsx)(x.CheckCircle2,{className:"h-8 w-8 text-green-500"})]})})}),(0,i.jsx)(l.Card,{children:(0,i.jsx)(l.CardContent,{className:"pt-6",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"En cours"}),(0,i.jsx)("p",{className:"text-2xl font-bold",children:G.inProgress})]}),(0,i.jsx)(b.Clock,{className:"h-8 w-8 text-blue-500"})]})})}),(0,i.jsx)(l.Card,{children:(0,i.jsx)(l.CardContent,{className:"pt-6",children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Non conformes"}),(0,i.jsx)("p",{className:"text-2xl font-bold",children:G.nonCompliant})]}),(0,i.jsx)(p.XCircle,{className:"h-8 w-8 text-red-500"})]})})})]}),(0,i.jsxs)(l.Card,{className:"mb-8 border-blue-200 bg-blue-50/50",children:[(0,i.jsxs)(l.CardHeader,{children:[(0,i.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,i.jsx)(C.Accessibility,{className:"h-5 w-5 text-blue-600"}),"Critère 8 - Accessibilité Handicap"]}),(0,i.jsx)(l.CardDescription,{children:"Gestion de l'accessibilité conforme aux exigences Qualiopi (indicateurs 8.1 et 8.2)"})]}),(0,i.jsx)(l.CardContent,{children:(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsxs)("div",{className:"flex-1",children:[(0,i.jsx)("p",{className:"text-sm text-muted-foreground mb-2",children:"Assurez-vous de désigner un référent handicap, définir une politique d'accessibilité, et mettre en place des aménagements pour les stagiaires en situation de handicap."}),(0,i.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,i.jsx)(u.Badge,{variant:"outline",className:"bg-white",children:"Indicateur 8.1 : Accessibilité physique"}),(0,i.jsx)(u.Badge,{variant:"outline",className:"bg-white",children:"Indicateur 8.2 : Accessibilité numérique"})]})]}),(0,i.jsx)(_.default,{href:"/dashboard/accessibility",children:(0,i.jsx)(d.Button,{className:"ml-4",children:"Gérer l'accessibilité"})})]})})]}),(0,i.jsx)(m.Tabs,{value:S,onValueChange:P,className:"mb-6",children:(0,i.jsxs)(m.TabsList,{children:[(0,i.jsxs)(m.TabsTrigger,{value:"all",children:["Tous (",A.length,")"]}),I.map(e=>(0,i.jsx)(m.TabsTrigger,{value:e,children:e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())},e))]})}),(0,i.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:L.map(e=>{let s=q[e.status];return(0,i.jsxs)(l.Card,{className:"hover:shadow-lg transition-shadow",children:[(0,i.jsx)(l.CardHeader,{children:(0,i.jsxs)("div",{className:"flex items-start justify-between",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(l.CardTitle,{className:"text-lg",children:e.indicator_code}),(0,i.jsx)(l.CardDescription,{className:"mt-1",children:e.indicator_name})]}),(0,i.jsx)(s,{className:`h-5 w-5 ${N[e.status].split(" ")[1]}`})]})}),(0,i.jsx)(l.CardContent,{children:(0,i.jsxs)("div",{className:"space-y-3",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:"Statut"}),(0,i.jsx)(u.Badge,{className:N[e.status],children:e.status.replace(/_/g," ")})]}),(0,i.jsxs)("div",{className:"flex items-center justify-between",children:[(0,i.jsx)("span",{className:"text-sm text-muted-foreground",children:"Conformité"}),(0,i.jsxs)("span",{className:"font-semibold",children:[e.compliance_rate,"%"]})]}),(0,i.jsx)(d.Button,{variant:"outline",className:"w-full",asChild:!0,children:(0,i.jsxs)(_.default,{href:`/dashboard/qualiopi/indicators/${e.id}`,children:[(0,i.jsx)(j.FileText,{className:"h-4 w-4 mr-2"}),"Voir les détails"]})})]})})]},e.id)})}),(0,i.jsxs)("div",{className:"mt-8 flex gap-4",children:[(0,i.jsx)(d.Button,{asChild:!0,children:(0,i.jsxs)(_.default,{href:"/dashboard/qualiopi/audits",children:[(0,i.jsx)(j.FileText,{className:"h-4 w-4 mr-2"}),"Audits"]})}),(0,i.jsx)(d.Button,{variant:"outline",asChild:!0,children:(0,i.jsxs)(_.default,{href:"/dashboard/qualiopi/actions",children:[(0,i.jsx)(f.AlertCircle,{className:"h-4 w-4 mr-2"}),"Actions correctives"]})}),(0,i.jsx)(d.Button,{variant:"outline",asChild:!0,children:(0,i.jsxs)(_.default,{href:"/dashboard/qualiopi/reports",children:[(0,i.jsx)(j.FileText,{className:"h-4 w-4 mr-2"}),"Rapports"]})})]})]})}e.s(["default",()=>T],784173)}]);