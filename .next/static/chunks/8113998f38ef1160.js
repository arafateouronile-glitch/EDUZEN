(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let t=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],107233)},871689,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},605631,e=>{"use strict";let t=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],605631)},263488,e=>{"use strict";let t=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>t],263488)},514764,e=>{"use strict";let t=(0,e.i(475254).default)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);e.s(["Send",()=>t],514764)},62870,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(647163);e.i(882205);var n=e.i(846932),i=e.i(88653),s=e.i(664659),o=e.i(898791);r.forwardRef(({className:e,label:l,error:d,helperText:c,variant:u="default",leftIcon:m,id:p,options:f,placeholder:g,value:h,...x},_)=>{let[v,y]=r.useState(!1),[b,j]=r.useState(!1),w=p||`select-${Math.random().toString(36).substr(2,9)}`,C=(0,a.cn)("flex w-full rounded-lg font-medium transition-all duration-300","appearance-none cursor-pointer","focus:outline-none focus:ring-2 focus:ring-primary/20","disabled:cursor-not-allowed disabled:opacity-50",{"border-2 border-input bg-background px-4 py-3 pr-11":"default"===u,"focus:border-primary focus:bg-white":"default"===u&&!d,"border-destructive focus:border-destructive focus:ring-destructive/20":d,"border-2 border-input bg-transparent px-4 py-3 pr-11":"outlined"===u,"focus:border-primary focus:shadow-md focus:shadow-primary/10":"outlined"===u&&!d,"border-0 border-b-2 border-input bg-muted/50 px-4 py-3 pr-11 rounded-b-none":"filled"===u,"focus:bg-muted focus:border-primary":"filled"===u&&!d,"focus:border-destructive bg-destructive/5":"filled"===u&&d},m&&"pl-11",e);return(0,t.jsxs)("div",{className:"w-full space-y-1.5",children:[l&&(0,t.jsxs)(n.motion.label,{htmlFor:w,initial:!1,animate:{color:d?"#EF4444":v?"rgb(37, 99, 235)":"rgb(107, 114, 128)"},className:(0,a.cn)("block text-sm font-medium transition-colors duration-200",d&&"text-destructive"),children:[l,x.required&&(0,t.jsx)("span",{className:"text-destructive ml-1",children:"*"})]}),(0,t.jsxs)("div",{className:"relative",children:[m&&(0,t.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none z-10",children:m}),(0,t.jsxs)(n.motion.select,{ref:_,id:w,value:h,...x,onFocus:e=>{y(!0),x.onFocus?.(e)},onBlur:e=>{y(!1),j(!1),x.onBlur?.(e)},onMouseDown:()=>j(!b),className:C,animate:{scale:v?1.01:1,borderColor:d?"#EF4444":v?"rgb(37, 99, 235)":"rgb(226, 232, 240)"},transition:{duration:.2},children:[g&&(0,t.jsx)("option",{value:"",disabled:!0,children:g}),(f||[]).map(e=>(0,t.jsx)("option",{value:e.value,disabled:e.disabled,children:e.label},e.value))]}),(0,t.jsx)(n.motion.div,{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground",animate:{rotate:180*!!b},transition:{duration:.2},children:(0,t.jsx)(s.ChevronDown,{className:"h-5 w-5"})}),d&&(0,t.jsx)(n.motion.div,{className:"absolute right-11 top-1/2 -translate-y-1/2 pointer-events-none",initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:(0,t.jsx)(o.AlertCircle,{className:"h-5 w-5 text-destructive"})})]}),(0,t.jsx)(i.AnimatePresence,{mode:"wait",children:(d||c)&&(0,t.jsx)(n.motion.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.2},className:(0,a.cn)("text-xs transition-colors duration-200",d?"text-destructive":"text-muted-foreground"),children:d||c})})]})}).displayName="SelectNative";let l=r.createContext({}),d=r.forwardRef(({value:e,onValueChange:a,children:n},i)=>{let[s,o]=r.useState(!1);return(0,t.jsx)(l.Provider,{value:{value:e,onValueChange:a,open:s,setOpen:o},children:(0,t.jsx)("div",{className:"relative",ref:i,children:n})})});d.displayName="SelectRoot";let c=r.forwardRef(({children:e,className:n,...i},o)=>{let{open:d,setOpen:c}=r.useContext(l);return(0,t.jsxs)("button",{ref:o,type:"button",className:(0,a.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),onClick:()=>c?.(!d),...i,children:[e,(0,t.jsx)(s.ChevronDown,{className:(0,a.cn)("h-4 w-4 opacity-50 transition-transform",d&&"rotate-180")})]})});c.displayName="SelectTrigger";let u=r.forwardRef(({placeholder:e},a)=>{let{value:n}=r.useContext(l);return(0,t.jsx)("span",{ref:a,children:n||e})});u.displayName="SelectValue";let m=r.forwardRef(({children:e},a)=>{let n=r.useContext(l);return n?.open&&e?(0,t.jsx)("div",{ref:a,className:"absolute top-full left-0 z-50 mt-1 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md",children:(0,t.jsx)("div",{className:"p-1",children:e})}):null});m.displayName="SelectContent";let p=r.forwardRef(({value:e,children:n,className:i,...s},o)=>{let{value:d,onValueChange:c,setOpen:u}=r.useContext(l),m=d===e;return(0,t.jsx)("div",{ref:o,role:"option","aria-selected":m,className:(0,a.cn)("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 px-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",m&&"bg-accent text-accent-foreground",i),onClick:()=>{c?.(e),u?.(!1)},...s,children:n})});p.displayName="SelectItem",e.s(["Select",0,d,"SelectContent",0,m,"SelectItem",0,p,"SelectRoot",0,d,"SelectTrigger",0,c,"SelectValue",0,u])},683909,e=>{"use strict";var t=e.i(920755);let r=new class{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async getAllPrograms(e,t){let r=this.supabase.from("programs").select("*").eq("organization_id",e);t?.isActive!==void 0&&(r=r.eq("is_active",t.isActive)),t?.search&&(r=r.or(`name.ilike.%${t.search}%,code.ilike.%${t.search}%,description.ilike.%${t.search}%`));let{data:a,error:n}=await r.order("created_at",{ascending:!1});if(n)throw n;return a}async getProgramById(e){let{data:t,error:r}=await this.supabase.from("programs").select(`
        *,
        formations(*)
      `).eq("id",e).single();if(r)throw r;return t}async createProgram(e){let{data:t,error:r}=await this.supabase.from("programs").insert(e).select().single();if(r)throw r;return t}async updateProgram(e,t){let{data:r,error:a}=await this.supabase.from("programs").update(t).eq("id",e).select().single();if(a)throw a;return r}async deleteProgram(e){return this.updateProgram(e,{is_active:!1})}async getFormationsByProgram(e){let{data:t,error:r}=await this.supabase.from("formations").select("*").eq("program_id",e).order("created_at",{ascending:!1});if(r)throw r;return t}async getGlobalStats(e){let{data:t,error:r}=await this.supabase.from("programs").select("id, is_active, created_at").eq("organization_id",e);if(r)throw r;let a=t||[],n=a.length,i=a.filter(e=>e.is_active).length,s=a.filter(e=>!e.is_active).length,o=0,l=a.map(e=>e.id);if(l.length>0){let{count:e,error:t}=await this.supabase.from("formations").select("*",{count:"exact",head:!0}).in("program_id",l);if(t)throw t;o=e||0}let d=0;if(l.length>0){let{data:e,error:t}=await this.supabase.from("formations").select("id").in("program_id",l);if(t)throw t;let r=e?.map(e=>e.id)||[];if(r.length>0){let{count:e,error:t}=await this.supabase.from("sessions").select("*",{count:"exact",head:!0}).in("formation_id",r);if(t)throw t;d=e||0}}let c=0;if(l.length>0){let{data:e,error:t}=await this.supabase.from("formations").select("id").in("program_id",l);if(t)throw t;let r=e?.map(e=>e.id)||[];if(r.length>0){let{data:e,error:t}=await this.supabase.from("sessions").select("id").in("formation_id",r);if(t)throw t;let a=e?.map(e=>e.id)||[];if(a.length>0){let{count:e,error:t}=await this.supabase.from("enrollments").select("*",{count:"exact",head:!0}).in("session_id",a);if(t)throw t;c=e||0}}}let u=[{name:"Actifs",value:i,color:"#335ACF"},{name:"Inactifs",value:s,color:"#6B7280"}].filter(e=>e.value>0),m={};return a.forEach(e=>{if(e.created_at){let t=new Date(e.created_at),r=`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}`;m[r]=(m[r]||0)+1}}),{total:n,active:i,inactive:s,totalFormations:o,totalSessions:d,totalEnrollments:c,statusData:u,monthlyData:Object.entries(m).sort(([e],[t])=>e.localeCompare(t)).slice(-6).map(([e,t])=>({month:new Date(e+"-01").toLocaleDateString("fr-FR",{month:"short",year:"numeric"}),programmes:t}))}}};e.s(["programService",0,r])},174886,e=>{"use strict";let t=(0,e.i(475254).default)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);e.s(["Copy",()=>t],174886)},350627,e=>{"use strict";let t=(0,e.i(475254).default)("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]);e.s(["Receipt",()=>t],350627)},882293,e=>{"use strict";let t=(0,e.i(475254).default)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);e.s(["UserCheck",()=>t],882293)},203496,173998,e=>{"use strict";var t=e.i(475254);let r=(0,t.default)("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]);e.s(["Scale",()=>r],203496);let a=(0,t.default)("Book",[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20",key:"t4utmx"}]]);e.s(["Book",()=>a],173998)},330293,e=>{"use strict";function t(e){let{student:t,organization:a,session:n,invoice:i,program:s,academicYear:o,language:l="fr",issueDate:d=new Date().toISOString()}=e;return{date_emission:new Date().toLocaleDateString("fr-FR"),date_aujourd_hui:new Date().toLocaleDateString("fr-FR"),date_jour:new Date().toLocaleDateString("fr-FR"),annee_courante:new Date().getFullYear().toString(),annee_actuelle:new Date().getFullYear().toString(),date_generation:new Date().toLocaleDateString("fr-FR"),heure:new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}),ecole_nom:a?.name||"",ecole_logo:a?.logo_url||"",ecole_adresse:a?.address||"",ecole_ville:(a?.address||"").split(",").pop()?.trim()||"",ecole_telephone:a?.phone||"",ecole_email:a?.email||"",ecole_site_web:a?.website||"",ecole_code_postal:(a?.address||"").match(/\d{5}/)?.[0]||"",organisation_nom:a?.name||"",organisation_adresse:a?.address||"",organisation_telephone:a?.phone||"",organisation_email:a?.email||"",organisation_logo:a?.logo_url||"",organisation_site_web:a?.website||"",eleve_nom:t?.last_name||"",eleve_prenom:t?.first_name||"",eleve_numero:t?.student_number||"",eleve_date_naissance:t?.date_of_birth?new Date(t.date_of_birth).toLocaleDateString("fr-FR"):"",eleve_classe:t?.classes?t.classes.name:"",eleve_photo:t?.photo_url||"",eleve_adresse:t?.address||"",eleve_telephone:t?.phone||"",eleve_email:t?.email||"",etudiant_nom:t?.last_name||"",etudiant_prenom:t?.first_name||"",etudiant_nom_complet:t?`${t.first_name} ${t.last_name}`:"",etudiant_numero:t?.student_number||"",etudiant_date_naissance:t?.date_of_birth?new Date(t.date_of_birth).toLocaleDateString("fr-FR"):"",etudiant_adresse:t?.address||"",etudiant_telephone:t?.phone||"",etudiant_email:t?.email||"",etudiant_photo:t?.photo_url||"",classe_nom:t?.classes?t.classes.name:"",annee_academique:o?.name||new Date().getFullYear().toString(),annee_scolaire:o?.name||new Date().getFullYear().toString(),session_nom:n?.name||"",session_debut:n?.start_date?new Date(n.start_date).toLocaleDateString("fr-FR"):"",session_fin:n?.end_date?new Date(n.end_date).toLocaleDateString("fr-FR"):"",session_date_debut:n?.start_date?new Date(n.start_date).toLocaleDateString("fr-FR"):"",session_date_fin:n?.end_date?new Date(n.end_date).toLocaleDateString("fr-FR"):"",formation_nom:n?.formations?.name||"",formation_duree:n?.formations?.duration_hours?`${n.formations?.duration_hours} heures`:"",formation_objectifs:n?.formations?.objectives||s?.objectives||"",formation_public_concerne:n?.formations?.target_audience||s?.target_audience||"",formation_prerequis:n?.formations?.prerequisites||s?.prerequisites||"",formation_qualite_et_resultats:n?.formations?.quality_indicators||s?.quality_indicators||"",formation_contenu:n?.formations?.content||s?.content||"",formation_equipe_pedagogique:n?.formations?.pedagogical_team||s?.pedagogical_team||"",formation_ressources:n?.formations?.resources||s?.resources||"",formation_supports:n?.formations?.materials||s?.materials||"",session_lieu:n?.location||n?.venue||"",session_effectif:n?.enrollment_count?.toString()||n?.student_count?.toString()||"",diplome_ou_certification:n?.formations?.certification||s?.certification||"",ecole_region:a?.region||a?.administrative_region||"",programme_nom:s?.name||n?.formations?.programs?.name||"",programme_code:s?.code||"",programme_description:s?.description||"",programme_objectifs:s?.objectives||"",programme_duree_totale:s?.formations?`${s.formations.reduce((e,t)=>e+(t.duration_hours||0),0)} heures`:"",programme_nombre_formations:s?.formations?`${s.formations.length}`:"",programme_nombre_sessions:"",programme_public_concerne:s?.target_audience||"",programme_modalites:s?.modalities||"",programme_certification:s?.certification||"",numero_facture:i?.invoice_number||"",facture_numero:i?.invoice_number||"",facture_date_emission:i?.issue_date?new Date(i.issue_date).toLocaleDateString("fr-FR"):"",facture_date_echeance:i?.due_date?new Date(i.due_date).toLocaleDateString("fr-FR"):"",date_echeance:i?.due_date?new Date(i.due_date).toLocaleDateString("fr-FR"):"",montant:i?.amount?Number(i.amount).toFixed(2):"0.00",montant_ht:i?.amount?Number(i.amount).toFixed(2):"0.00",montant_ttc:i?.total_amount?Number(i.total_amount).toFixed(2):"0.00",tva:i?.tax_amount?Number(i.tax_amount).toFixed(2):"0.00",taux_tva:i?.tax_amount&&i?.amount?(Number(i.tax_amount)/Number(i.amount)*100).toFixed(2):"0.00",facture_montant:i?.amount?Number(i.amount).toFixed(2):"0.00",facture_tva:i?.tax_amount?Number(i.tax_amount).toFixed(2):"0.00",facture_total:i?.total_amount?Number(i.total_amount).toFixed(2):"0.00",facture_devise:i?.currency||"EUR",facture_items:i?.items?JSON.stringify(i.items):"[]",montant_lettres:i?.total_amount?function(e,t="fr"){return"en"===t?e.toFixed(2)+" euros":function e(t){if(0===t)return"zéro euro";if(t<0)return"moins "+e(-t);let a=Math.floor(t),n=Math.round((t-a)*100),i=r(a);return n>0&&(i+=" virgule "+r(n)),i+(a>1?" euros":" euro")}(e)}(Number(i.total_amount),l):"",mode_paiement:i?.payment_method||"",date_paiement:i?.paid_at?new Date(i.paid_at).toLocaleDateString("fr-FR"):"",ecole_siret:a?.siret||"",ecole_numero_declaration:a?.declaration_number||"",ecole_representant:a?.representative_name||"",langue:l}}function r(e){if(0===e)return"";if(e<10)return["","un","deux","trois","quatre","cinq","six","sept","huit","neuf"][e];if(e<20)return["dix","onze","douze","treize","quatorze","quinze","seize","dix-sept","dix-huit","dix-neuf"][e-10];if(e<100){let t=Math.floor(e/10),a=e%10,n=["","","vingt","trente","quarante","cinquante","soixante","soixante","quatre-vingt","quatre-vingt"][t];return 7===t||9===t?n+="-"+(1===a?"et-":"")+r(10+a):a>0?n+=(1===a&&8!==t?"-et-":"-")+r(a):8===t&&(n+="s"),n}if(e<1e3){let t=Math.floor(e/100),a=e%100,n=1===t?"cent":r(t)+"-cent";return a>0?n+="-"+r(a):t>1&&(n+="s"),n}if(e<1e6){let t=Math.floor(e/1e3),a=e%1e3,n=1===t?"mille":r(t)+"-mille";return a>0&&(n+="-"+r(a)),n}return e.toString()}function a(e){return({attestation:"attestation_reussite",certificate:"certificat_scolarite",invoice:"facture",receipt:"facture",transcript:"releve_notes",report_card:"releve_notes",convocation:"convocation",contract:"contrat"})[e]||e}e.s(["extractDocumentVariables",()=>t,"mapDocumentTypeToTemplateType",()=>a])},137652,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(266027),n=e.i(69319),i=e.i(325715),s=e.i(167881),o=e.i(970065),l=e.i(10708),d=e.i(62870),c=e.i(178583),u=e.i(174886),m=e.i(107233),p=e.i(643531);function f({documentType:e,selectedTemplateId:f,onTemplateSelect:g,onCreateNew:h,onDuplicate:x}){let{user:_}=(0,i.useAuth)(),[v,y]=(0,r.useState)(!1),{data:b,isLoading:j}=(0,a.useQuery)({queryKey:["document-templates-by-type",_?.organization_id,e],queryFn:async()=>{if(!_?.organization_id||!e)return[];try{return await n.documentTemplateService.getTemplatesByType(e,_.organization_id)}catch(e){return console.error("Erreur lors de la récupération des templates:",e),[]}},enabled:!!_?.organization_id&&!!e}),w=b?.filter(e=>e.is_active)||[],C=w.find(e=>e.is_default),N=w.filter(e=>!e.is_default),S=v?w:[C,...N.slice(0,2)].filter(Boolean);return j?(0,t.jsx)(o.Card,{children:(0,t.jsx)(o.CardContent,{className:"pt-6",children:(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Chargement des modèles..."})})}):w&&0!==w.length?(0,t.jsxs)(o.Card,{children:[(0,t.jsx)(o.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(o.CardTitle,{className:"text-lg",children:"Modèle de document"}),h&&(0,t.jsxs)(s.Button,{onClick:h,variant:"outline",size:"sm",children:[(0,t.jsx)(m.Plus,{className:"h-4 w-4 mr-2"}),"Nouveau"]})]})}),(0,t.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{htmlFor:"template-select",children:"Sélectionner un modèle"}),(0,t.jsxs)(d.Select,{value:f||C?.id||"",onValueChange:g,children:[(0,t.jsx)(d.SelectTrigger,{id:"template-select",className:"mt-2",children:(0,t.jsx)(d.SelectValue,{placeholder:"Choisir un modèle"})}),(0,t.jsx)(d.SelectContent,{children:w.map(e=>(0,t.jsx)(d.SelectItem,{value:e.id,children:(0,t.jsx)("div",{className:"flex items-center justify-between w-full",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(c.FileText,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:e.name}),e.is_default&&(0,t.jsx)("span",{className:"text-xs text-primary font-medium",children:"(Par défaut)"})]})})},e.id))})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-700",children:"Modèles disponibles"}),(0,t.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:S.map(e=>(0,t.jsxs)("div",{className:`flex items-center justify-between p-3 border rounded-lg transition-colors ${f===e.id?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,t.jsx)(c.FileText,{className:"h-4 w-4 text-gray-400"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"font-medium text-sm",children:e.name}),e.is_default&&(0,t.jsx)("span",{className:"text-xs px-2 py-0.5 bg-primary/10 text-primary rounded-full",children:"Par défaut"}),f===e.id&&(0,t.jsx)(p.Check,{className:"h-4 w-4 text-primary"})]}),(0,t.jsxs)("div",{className:"text-xs text-gray-500 mt-0.5",children:["Modifié le ",new Date(e.updated_at).toLocaleDateString("fr-FR")]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[f!==e.id&&(0,t.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>g(e.id),children:"Sélectionner"}),x&&(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",onClick:()=>x(e.id),title:"Dupliquer ce modèle",children:(0,t.jsx)(u.Copy,{className:"h-4 w-4"})})]})]},e.id))}),w.length>S.length&&(0,t.jsx)(s.Button,{variant:"ghost",size:"sm",onClick:()=>y(!v),className:"w-full",children:v?`Afficher moins (${w.length-3} autres)`:`Afficher tous les mod\xe8les (${w.length-S.length} autres)`})]})]})]}):(0,t.jsxs)(o.Card,{children:[(0,t.jsx)(o.CardHeader,{children:(0,t.jsx)(o.CardTitle,{className:"text-lg",children:"Modèle de document"})}),(0,t.jsxs)(o.CardContent,{children:[(0,t.jsx)("div",{className:"text-sm text-gray-500 mb-4",children:"Aucun modèle disponible pour ce type de document."}),h&&(0,t.jsxs)(s.Button,{onClick:h,variant:"outline",size:"sm",children:[(0,t.jsx)(m.Plus,{className:"h-4 w-4 mr-2"}),"Créer un modèle"]})]})]})}e.s(["TemplateSelector",()=>f])},805987,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(618566),n=e.i(266027),i=e.i(954616),s=e.i(912598),o=e.i(325715),l=e.i(920755),d=e.i(683909),c=e.i(330293),u=e.i(69319),m=e.i(137652),p=e.i(167881),f=e.i(62870),g=e.i(970065),h=e.i(630374),x=e.i(871689),_=e.i(440160),v=e.i(178583),y=e.i(350627),b=e.i(626912),j=e.i(87316),w=e.i(191741),C=e.i(842009),N=e.i(32095),S=e.i(810980),q=e.i(882293),D=e.i(98919),z=e.i(203496),F=e.i(173998),k=e.i(605631),T=e.i(263488),E=e.i(514764),$=e.i(37727),R=e.i(465286),A=e.i(522016);function B(){let e=(0,a.useRouter)(),{user:B}=(0,o.useAuth)(),L=(0,l.createClient)(),[M,I]=(0,r.useState)(""),[P,U]=(0,r.useState)(""),[O,V]=(0,r.useState)(""),[H,G]=(0,r.useState)(""),[K,Q]=(0,r.useState)(""),[Z,J]=(0,r.useState)(""),[W,Y]=(0,r.useState)(""),[X,ee]=(0,r.useState)("fr"),[et,er]=(0,r.useState)("pdf"),[ea,en]=(0,r.useState)(!1),[ei,es]=(0,r.useState)(!1),[eo,el]=(0,r.useState)(null),[ed,ec]=(0,r.useState)(null),[eu,em]=(0,r.useState)(null),[ep,ef]=(0,r.useState)(!1),[eg,eh]=(0,r.useState)({to:"",subject:"",message:""}),[ex,e_]=(0,r.useState)(""),[ev,ey]=(0,r.useState)(!1),eb=(0,s.useQueryClient)(),{data:ej}=(0,n.useQuery)({queryKey:["students",B?.organization_id,K],queryFn:async()=>{if(!B?.organization_id)return[];if(K){let{data:e,error:t}=await L.from("enrollments").select("student_id").eq("session_id",K).in("status",["confirmed","completed","active"]);if(t)console.warn("Erreur lors de la récupération des inscriptions:",t);else if(e&&e.length>0){let t=e.map(e=>e.student_id).filter(Boolean);if(t.length>0){let{data:e,error:r}=await L.from("students").select("id, first_name, last_name, student_number, date_of_birth, photo_url, class_id, classes(name)").eq("organization_id",B.organization_id).eq("status","active").in("id",t).order("last_name");if(r)throw r;return e||[]}}}let{data:e,error:t}=await L.from("students").select("id, first_name, last_name, student_number, date_of_birth, photo_url, class_id, classes(name)").eq("organization_id",B.organization_id).eq("status","active").order("last_name");if(t)throw t;return e||[]},enabled:!!B?.organization_id}),{data:ew}=(0,n.useQuery)({queryKey:["invoices",B?.organization_id],queryFn:async()=>{if(!B?.organization_id)return[];let e=L.from("invoices").select("id, invoice_number, student_id, issue_date, due_date, amount, tax_amount, total_amount, currency, items, students(first_name, last_name, student_number)").eq("organization_id",B.organization_id).order("created_at",{ascending:!1}).limit(100),{data:t,error:r}=await e;if(r&&("PGRST116"===r.code||r.message?.includes("400")||r.message?.includes("relationship"))){console.warn("Erreur récupération factures avec jointure, réessai sans jointure:",r);let{data:e,error:t}=await L.from("invoices").select("id, invoice_number, student_id, issue_date, due_date, amount, tax_amount, total_amount, currency, items").eq("organization_id",B.organization_id).order("created_at",{ascending:!1}).limit(100);if(t)return console.error("Erreur récupération factures:",t),[];if(e&&e.length>0){let t=e.map(e=>e.student_id).filter(Boolean);if(t.length>0){let{data:r}=await L.from("students").select("id, first_name, last_name, student_number").in("id",t);if(r){let t=new Map(r.map(e=>[e.id,e]));return e.map(e=>({...e,students:e.student_id&&t.get(e.student_id)||null}))}}}return e||[]}return r?(console.error("Erreur récupération factures:",r),[]):t||[]},enabled:!!B?.organization_id&&("facture"===M||"devis"===M)}),{data:eC}=(0,n.useQuery)({queryKey:["current-user",B?.id],queryFn:async()=>{if(!B?.id)return null;let{data:e,error:t}=await L.from("users").select("role").eq("id",B.id).single();if(t)throw t;return e},enabled:!!B?.id});(0,r.useEffect)(()=>{eC&&ec(eC.role)},[eC]);let{data:eN}=(0,n.useQuery)({queryKey:["organization",B?.organization_id],queryFn:async()=>{if(!B?.organization_id)return null;let{data:e,error:t}=await L.from("organizations").select("*").eq("id",B.organization_id).single();if(t)throw t;return e},enabled:!!B?.organization_id}),{data:eS}=(0,n.useQuery)({queryKey:["programs",B?.organization_id],queryFn:async()=>B?.organization_id?d.programService.getAllPrograms(B.organization_id,{isActive:!0}):[],enabled:!!B?.organization_id&&"programme"===M}),{data:eq}=(0,n.useQuery)({queryKey:["program",Z],queryFn:async()=>Z?d.programService.getProgramById(Z):null,enabled:!!Z&&"programme"===M}),{data:eD}=(0,n.useQuery)({queryKey:["sessions",B?.organization_id],queryFn:async()=>{if(!B?.organization_id)return[];let{data:e,error:t}=await L.from("sessions").select("id, name, formation_id, formations(name, duration_hours, programs(name)), start_date, end_date").eq("formations.organization_id",B.organization_id).order("start_date",{ascending:!1}).limit(50);if(t)throw t;return e||[]},enabled:!!B?.organization_id&&!!M});(0,r.useEffect)(()=>{K&&P&&(ej?.some(e=>e.id===P)||U(""))},[K,ej,P]);let{data:ez}=(0,n.useQuery)({queryKey:["academic-year",B?.organization_id],queryFn:async()=>{if(!B?.organization_id)return null;let{data:e,error:t}=await L.from("academic_years").select("*").eq("organization_id",B.organization_id).eq("is_current",!0).maybeSingle();return t?(console.warn("Erreur lors de la récupération de l'année académique:",t),null):e||null},enabled:!!B?.organization_id}),{data:eF}=(0,n.useQuery)({queryKey:["document-template",W],queryFn:async()=>W?u.documentTemplateService.getTemplateById(W):null,enabled:!!W}),ek=async()=>{if(M&&eN){if(!W||!eF)return void alert("Veuillez sélectionner un modèle de document");en(!0);try{let e,t,r,a,n,i=null;P&&(e=ej?.find(e=>e.id===P)),K&&(t=eD?.find(e=>e.id===K)),Z&&eq&&(i=eq),O&&(r=ew?.find(e=>e.id===O))&&r.students&&!e&&(e=r.students);let s=(0,c.extractDocumentVariables)({student:e,organization:eN,session:t,invoice:r,program:i,academicYear:ez,language:X,issueDate:new Date().toISOString()});console.log("[Generate] Variables extraites:",{hasStudent:!!e,studentName:e?`${e.first_name} ${e.last_name}`:"N/A",hasInvoice:!!r,invoiceNumber:r?.invoice_number,hasSession:!!t,sessionName:t?.name,variablesCount:Object.keys(s).length,sampleVariables:{eleve_nom:s.eleve_nom,eleve_prenom:s.eleve_prenom,numero_facture:s.numero_facture,formation_nom:s.formation_nom,session_nom:s.session_nom}});let o="word"===et?".docx":".pdf",l=`document${o}`;l=e?`${M}_${e.last_name}_${e.first_name}${o}`:r?`facture_${r.invoice_number}${o}`:`${M}_${Date.now()}${o}`;let d=null;"word"===et?(a="/api/documents/generate-docx",n={templateId:W,variables:s,filename:l},console.log("[Generate] Génération Word automatique depuis template HTML")):(a="/api/documents/generate-pdf",n={template:eF,variables:s,documentId:void 0,organizationId:eN?.id});let u="word"===et?"application/vnd.openxmlformats-officedocument.wordprocessingml.document":"application/pdf";try{let i=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){let e=i.headers.get("content-type");if(e&&e.includes("application/json")){let e=await i.json();throw console.error(`[Generate ${et.toUpperCase()}] Erreur d\xe9taill\xe9e:`,e),e.templateInfo&&console.error(`[Generate ${et.toUpperCase()}] Template info:`,e.templateInfo),e.stack&&console.error(`[Generate ${et.toUpperCase()}] Stack trace:`,e.stack),Error(e.error||e.message||e.details||`Erreur lors de la g\xe9n\xe9ration du ${"word"===et?"document Word":"PDF"}`)}{let e=await i.text();throw console.error("Erreur HTML reçue:",e.substring(0,500)),Error(`Erreur serveur (${i.status}): ${i.statusText}`)}}d=await i.blob();let s=URL.createObjectURL(d),o=document.createElement("a");if(o.href=s,o.download=l,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),d&&B?.organization_id&&eF)try{let a=r?.student_id||r?.students?.id,n=`documents/${B.organization_id}/${Date.now()}_${l}`,{data:i,error:s}=await L.storage.from("documents").upload(n,d,{cacheControl:"3600",upsert:!1,contentType:u});if(s){console.error("Erreur lors de l'upload du document:",s);let t={fileUrl:URL.createObjectURL(d),filename:l,title:eF.name||l,studentId:e?.id||a,student:e||(a?r?.students:void 0)};em(t),console.log("[Generate] Document généré stocké (upload échoué):",t)}else if(i){let{data:i}=L.storage.from("documents").getPublicUrl(n),s={fileUrl:i.publicUrl,filename:l,title:eF.name||l,studentId:e?.id||a,student:e||(a?r?.students:void 0)};em(s),console.log("[Generate] Document généré stocké (upload réussi):",s);let o={organization_id:B.organization_id,template_id:eF.id,type:(0,c.mapDocumentTypeToTemplateType)(M),file_name:l,file_url:i.publicUrl,format:et,page_count:"pdf"===et?1:void 0,metadata:{student:e?{id:e.id,name:`${e.first_name} ${e.last_name}`}:null,session:t?{id:t.id,name:t.name}:null,invoice:r?{id:r.id,invoice_number:r.invoice_number}:null,language:X,generated_at:new Date().toISOString()},generated_by:B.id},d=!!(e||a||t);e?(o.related_entity_type="student",o.related_entity_id=e.id):a?(o.related_entity_type="student",o.related_entity_id=a):t&&(o.related_entity_type="session",o.related_entity_id=t.id);let u=(0,c.mapDocumentTypeToTemplateType)(M),m=ed&&["super_admin","admin","comptable","secretaire"].includes(ed);if(d&&m)if("releve_notes"===u){el(o),es(!0);return}else console.log("Document partagé automatiquement avec l'apprenant");else d&&m||(delete o.related_entity_type,delete o.related_entity_id);let{error:p}=await L.from("generated_documents").insert(o);p?console.error("Erreur lors de la sauvegarde du document:",p):console.log("Document sauvegardé avec succès dans generated_documents")}}catch(e){console.error("Erreur lors de la sauvegarde du document:",e)}}catch(e){console.error("Erreur lors de la génération du PDF:",e),alert("Une erreur est survenue lors de la génération du document")}finally{en(!1)}}catch(e){console.error("Erreur lors de la génération du document:",e),alert("Une erreur est survenue lors de la génération du document"),en(!1)}}},eT=async e=>{if(!eo)return;es(!1);let t={...eo};e?console.log("Document partagé avec l'apprenant"):(delete t.related_entity_type,delete t.related_entity_id,console.log("Document non partagé avec l'apprenant (relevé de notes)"));let{error:r}=await L.from("generated_documents").insert(t);r?(console.error("Erreur lors de la sauvegarde du document:",r),alert("Erreur lors de la sauvegarde du document")):console.log("Document sauvegardé avec succès dans generated_documents"),el(null),en(!1)};(0,r.useEffect)(()=>{Y(""),em(null)},[M]);let eE=async()=>{if(!eu)return;let e=[];if(eu.studentId){let{data:t,error:r}=await L.from("students").select("email, first_name, last_name").eq("id",eu.studentId).single();if(!r&&t){t.email&&e.push(t.email);let{data:r,error:a}=await L.from("student_guardians").select("*, guardians(email)").eq("student_id",eu.studentId);!a&&r&&r.forEach(t=>{t.guardians?.email&&e.push(t.guardians.email)}),e=[...new Set(e)];let n=`${eu.title}`,i=`${t.first_name||""} ${t.last_name||""}`.trim(),s=`Bonjour ${i||"Madame, Monsieur"},

Veuillez trouver ci-joint votre document.

Cordialement,
L'\xe9quipe EDUZEN`;eh({to:e.join(", "),subject:n,message:s})}else{let e=eu.student?.email||"";eh({to:e,subject:`${eu.title}`,message:`Bonjour ${eu.student?.first_name||""} ${eu.student?.last_name||""},

Veuillez trouver ci-joint votre document.

Cordialement,
L'\xe9quipe EDUZEN`})}}else eh({to:"",subject:eu.title,message:"Bonjour,\n\nVeuillez trouver ci-joint votre document.\n\nCordialement,\nL'équipe EDUZEN"});ef(!0)},e$=async()=>{if(!eu||!eg.to)return void alert("Veuillez renseigner l'adresse email du destinataire");ey(!0);try{if(!(await fetch("/api/send-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:eg.to,subject:eg.subject,message:eg.message,attachmentUrl:eu.fileUrl,attachmentName:eu.filename})})).ok)throw Error("Erreur lors de l'envoi de l'email");alert("Email envoyé avec succès !"),ef(!1),eh({to:"",subject:"",message:""})}catch(e){console.error("Erreur lors de l'envoi de l'email:",e),alert("Erreur lors de l'envoi de l'email")}finally{ey(!1)}},eR=(0,i.useMutation)({mutationFn:async()=>{if(!eu||!eu.studentId)throw Error("Ce document n'est pas lié à un étudiant");if(!B?.organization_id)throw Error("Organisation ID manquant");let e=eu.fileUrl;if(e.startsWith("blob:")||e.startsWith("data:")){let t=await fetch(eu.fileUrl);if(!t.ok)throw Error("Impossible de télécharger le fichier");let r=new File([await t.blob()],eu.filename,{type:"application/pdf"}),a=`learner_documents/${B.organization_id}/${eu.studentId}/${Date.now()}_${eu.filename}`,{data:n,error:i}=await L.storage.from("documents").upload(a,r,{cacheControl:"3600",upsert:!1,contentType:"application/pdf"});if(i)throw i;let{data:s}=L.storage.from("documents").getPublicUrl(a);e=s.publicUrl}let t=(0,c.mapDocumentTypeToTemplateType)(M),{error:r}=await L.from("learner_documents").insert({student_id:eu.studentId,title:eu.title,file_url:e,type:t||M||"other",organization_id:B.organization_id,sent_at:new Date().toISOString(),sent_by:B.id});if(r)throw console.error("Erreur lors de l'insertion dans learner_documents:",r),r},onSuccess:()=>{alert("Document envoyé dans l'espace apprenant avec succès !"),eb.invalidateQueries({queryKey:["learner-documents"]})},onError:e=>{console.error("Erreur lors de l'envoi vers l'espace apprenant:",e),alert(e.message||"Erreur lors de l'envoi vers l'espace apprenant")}}),eA=[{type:"convention",name:"Convention de formation",description:"Contrat entre l'établissement et l'apprenant",icon:v.FileText,color:"#335ACF",requiresStudent:!0},{type:"facture",name:"Facture",description:"Document comptable de facturation",icon:y.Receipt,color:"#335ACF",requiresInvoice:!0},{type:"devis",name:"Devis",description:"Estimation de prix avant formation",icon:b.FileCheck,color:"#34B9EE",requiresInvoice:!0},{type:"convocation",name:"Convocation",description:"Invitation à une session ou examen",icon:j.Calendar,color:"#335ACF",requiresSession:!0},{type:"contrat",name:"Contrat de scolarité",description:"Accord de scolarisation officiel",icon:w.ClipboardList,color:"#335ACF",requiresStudent:!0},{type:"attestation_reussite",name:"Attestation de réussite",description:"Certificat de réussite à une formation",icon:C.Award,color:"#335ACF",requiresStudent:!0,requiresSession:!0},{type:"certificat_scolarite",name:"Certificat de scolarité",description:"Justificatif d'inscription dans l'établissement",icon:N.GraduationCap,color:"#335ACF",requiresStudent:!0},{type:"releve_notes",name:"Relevé de notes",description:"Bulletin de notes et appréciations",icon:S.BookOpen,color:"#34B9EE",requiresStudent:!0,requiresSession:!0},{type:"attestation_entree",name:"Attestation d'entrée en formation",description:"Certificat d'inscription à une formation",icon:q.UserCheck,color:"#335ACF",requiresStudent:!0,requiresSession:!0},{type:"reglement_interieur",name:"Règlement intérieur",description:"Règles et procédures de l'établissement",icon:D.Shield,color:"#335ACF"},{type:"cgv",name:"Conditions Générales de Vente",description:"CGV et conditions d'utilisation",icon:z.Scale,color:"#34B9EE"},{type:"programme",name:"Programme de formation",description:"Détails du contenu pédagogique",icon:F.Book,color:"#335ACF"},{type:"attestation_assiduite",name:"Attestation d'assiduité",description:"Justificatif de présence aux cours",icon:k.CheckCircle,color:"#335ACF",requiresStudent:!0,requiresSession:!0}];return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)(A.default,{href:"/dashboard/documents",children:(0,t.jsx)(p.Button,{variant:"ghost",size:"icon",children:(0,t.jsx)(x.ArrowLeft,{className:"h-4 w-4"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Générer un document"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Créez et téléchargez vos documents PDF"})]})]}),(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(g.Card,{children:[(0,t.jsx)(g.CardHeader,{children:(0,t.jsx)(g.CardTitle,{children:"Type de document"})}),(0,t.jsx)(g.CardContent,{children:(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:eA.map(e=>{let r=e.icon;return(0,t.jsxs)("button",{type:"button",onClick:()=>I(e.type),className:`p-4 border-2 rounded-lg text-left transition-colors ${M===e.type?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("div",{className:"p-2 rounded-lg",style:{backgroundColor:`${e.color}15`},children:(0,t.jsx)(r,{className:"h-5 w-5",style:{color:e.color}})}),(0,t.jsx)("div",{className:"font-medium text-sm",children:e.name})]}),(0,t.jsx)("div",{className:"text-xs text-gray-600",children:e.description})]},e.type)})})})]}),M&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(m.TemplateSelector,{documentType:M,selectedTemplateId:W,onTemplateSelect:Y,onCreateNew:()=>{e.push(`/dashboard/settings/document-templates/${M}/edit`)},onDuplicate:async e=>{try{let t=await u.documentTemplateService.duplicateTemplate(e);Y(t.id),alert("Modèle dupliqué avec succès")}catch(e){console.error("Erreur lors de la duplication:",e),alert("Erreur lors de la duplication du modèle")}}}),"programme"===M&&(0,t.jsxs)(g.Card,{children:[(0,t.jsx)(g.CardHeader,{children:(0,t.jsx)(g.CardTitle,{children:"Programme"})}),(0,t.jsx)(g.CardContent,{children:(0,t.jsxs)("select",{value:Z,onChange:e=>J(e.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Sélectionner un programme"}),eS?.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," ",e.code?`(${e.code})`:""]},e.id))]})})]}),(0,t.jsxs)(g.Card,{children:[(0,t.jsx)(g.CardHeader,{children:(0,t.jsxs)(g.CardTitle,{children:["Session de formation ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]})}),(0,t.jsxs)(g.CardContent,{children:[(0,t.jsxs)("select",{value:K,onChange:e=>{Q(e.target.value),U("")},className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",required:!0,children:[(0,t.jsx)("option",{value:"",children:"Sélectionner une session"}),eD?.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," - ",e.formations?.programs?.name]},e.id))]}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-2",children:"La sélection de la session est obligatoire pour récupérer toutes les données personnalisées."})]})]}),eA.find(e=>e.type===M)?.requiresStudent&&(0,t.jsxs)(g.Card,{children:[(0,t.jsx)(g.CardHeader,{children:(0,t.jsxs)(g.CardTitle,{children:["Apprenant ",(0,t.jsx)("span",{className:"text-red-500",children:"*"})]})}),(0,t.jsxs)(g.CardContent,{children:[(0,t.jsxs)("select",{value:P,onChange:e=>U(e.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",required:eA.find(e=>e.type===M)?.requiresStudent,disabled:!K,children:[(0,t.jsx)("option",{value:"",children:K?"Sélectionner un apprenant":"Veuillez d'abord sélectionner une session"}),K&&ej?.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.last_name," ",e.first_name," (",e.student_number,")"]},e.id))]}),K&&ej&&0===ej.length&&(0,t.jsx)("p",{className:"text-sm text-amber-600 mt-2",children:"Aucun apprenant inscrit à cette session."})]})]}),("facture"===M||"devis"===M)&&(0,t.jsxs)(g.Card,{children:[(0,t.jsx)(g.CardHeader,{children:(0,t.jsx)(g.CardTitle,{children:"facture"===M?"Facture":"Devis"})}),(0,t.jsx)(g.CardContent,{children:(0,t.jsxs)("select",{value:O,onChange:e=>V(e.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",required:!0,children:[(0,t.jsxs)("option",{value:"",children:["Sélectionner une ","facture"===M?"facture":"devis"]}),ew?.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.invoice_number," - ",e.students?.first_name," ",e.students?.last_name]},e.id))]})})]}),(0,t.jsxs)(g.Card,{children:[(0,t.jsx)(g.CardHeader,{children:(0,t.jsx)(g.CardTitle,{children:"Options"})}),(0,t.jsxs)(g.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Langue"}),(0,t.jsxs)("select",{value:X,onChange:e=>ee(e.target.value),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,t.jsx)("option",{value:"fr",children:"Français"}),(0,t.jsx)("option",{value:"en",children:"English"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Format d'export"}),(0,t.jsxs)(f.Select,{value:et,onValueChange:e=>er(e),children:[(0,t.jsx)(f.SelectTrigger,{className:"w-full",children:(0,t.jsx)(f.SelectValue,{placeholder:"Sélectionner un format"})}),(0,t.jsxs)(f.SelectContent,{children:[(0,t.jsx)(f.SelectItem,{value:"pdf",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v.FileText,{className:"h-4 w-4 text-red-600"}),(0,t.jsx)("span",{children:"PDF (.pdf)"})]})}),(0,t.jsx)(f.SelectItem,{value:"word",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(v.FileText,{className:"h-4 w-4 text-blue-600"}),(0,t.jsx)("span",{children:"Word (.docx)"})]})})]})]})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,t.jsx)(A.default,{href:"/dashboard/documents",children:(0,t.jsx)(p.Button,{variant:"outline",children:"Annuler"})}),(0,t.jsxs)(p.Button,{onClick:ek,disabled:ea||!W||!K||eA.find(e=>e.type===M)?.requiresStudent&&!P||eA.find(e=>e.type===M)?.requiresInvoice&&!O||"programme"===M&&!Z,children:[(0,t.jsx)(_.Download,{className:"mr-2 h-4 w-4"}),ea?"Génération...":"Générer et télécharger"]})]}),eu&&!ea&&(0,t.jsxs)(g.Card,{className:"border-2 border-green-200 bg-green-50/50",children:[(0,t.jsx)(g.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,t.jsx)(R.CheckCircle2,{className:"h-5 w-5 text-green-600"})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(g.CardTitle,{className:"text-green-900",children:"Document généré avec succès !"}),(0,t.jsx)("p",{className:"text-sm text-green-700 mt-1",children:eu.title})]})]})}),(0,t.jsx)(g.CardContent,{children:(0,t.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,t.jsxs)(p.Button,{onClick:()=>{if(!eu)return;let e=document.createElement("a");e.href=eu.fileUrl,e.download=eu.filename,document.body.appendChild(e),e.click(),document.body.removeChild(e)},variant:"outline",className:"border-green-300 text-green-700 hover:bg-green-100",children:[(0,t.jsx)(_.Download,{className:"mr-2 h-4 w-4"}),"Télécharger à nouveau"]}),(0,t.jsxs)(p.Button,{onClick:eE,variant:"outline",className:"border-blue-300 text-blue-700 hover:bg-blue-100",children:[(0,t.jsx)(T.Mail,{className:"mr-2 h-4 w-4"}),"Envoyer par email"]}),eu.studentId&&(0,t.jsxs)(p.Button,{onClick:()=>eR.mutate(),disabled:eR.isPending,variant:"outline",className:"border-purple-300 text-purple-700 hover:bg-purple-100",children:[(0,t.jsx)(E.Send,{className:"mr-2 h-4 w-4"}),eR.isPending?"Envoi...":"Espace apprenant"]}),(0,t.jsx)(p.Button,{onClick:()=>em(null),variant:"ghost",size:"sm",className:"ml-auto",children:(0,t.jsx)($.X,{className:"h-4 w-4"})})]})})]})]})]})}),(0,t.jsx)(h.Dialog,{open:ep,onOpenChange:ef,children:(0,t.jsxs)(h.DialogContent,{className:"max-w-2xl",children:[(0,t.jsxs)(h.DialogHeader,{children:[(0,t.jsx)(h.DialogTitle,{children:"Envoyer par email"}),(0,t.jsx)(h.DialogDescription,{children:eu?.title})]}),(0,t.jsxs)("div",{className:"space-y-4 py-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Destinataire *"}),(0,t.jsx)("input",{type:"text",value:eg.to,onChange:e=>eh(t=>({...t,to:e.target.value})),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary",placeholder:"email@example.com, email2@example.com"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Objet *"}),(0,t.jsx)("input",{type:"text",value:eg.subject,onChange:e=>eh(t=>({...t,subject:e.target.value})),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary",placeholder:"Objet de l'email"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"text-sm font-medium",children:"Message"}),(0,t.jsx)("textarea",{value:eg.message,onChange:e=>eh(t=>({...t,message:e.target.value})),rows:6,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary resize-none",placeholder:"Votre message..."})]}),eu?.fileUrl&&(0,t.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(v.FileText,{className:"h-5 w-5 text-gray-400"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Pièce jointe"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:eu.filename})]})]})})]}),(0,t.jsxs)(h.DialogFooter,{children:[(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>ef(!1),children:"Annuler"}),(0,t.jsx)(p.Button,{onClick:e$,disabled:ev||!eg.to||!eg.subject,children:ev?"Envoi...":"Envoyer"})]})]})}),(0,t.jsx)(h.Dialog,{open:ei,onOpenChange:e=>{!e&&ei?eT(!1):es(e)},children:(0,t.jsxs)(h.DialogContent,{children:[(0,t.jsxs)(h.DialogHeader,{children:[(0,t.jsx)(h.DialogTitle,{children:"Partager le relevé de notes avec l'apprenant ?"}),(0,t.jsxs)(h.DialogDescription,{children:["Souhaitez-vous que ce relevé de notes soit visible dans l'espace personnel de l'apprenant ?",(0,t.jsx)("br",{}),(0,t.jsx)("br",{}),'Si vous choisissez "Non", le document sera sauvegardé mais ne sera pas accessible par l\'apprenant.']})]}),(0,t.jsxs)(h.DialogFooter,{children:[(0,t.jsx)(p.Button,{variant:"outline",onClick:()=>eT(!1),children:"Non, ne pas partager"}),(0,t.jsx)(p.Button,{onClick:()=>eT(!0),children:"Oui, partager avec l'apprenant"})]})]})})]})}e.s(["default",()=>B])}]);