(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let t=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],107233)},503116,e=>{"use strict";let t=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],503116)},263488,e=>{"use strict";let t=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>t],263488)},319036,e=>{"use strict";var t=e.i(843476),i=e.i(271645),s=e.i(647163);let a=i.forwardRef(({checked:e,onCheckedChange:i,disabled:a,className:r,...n},l)=>(0,t.jsx)("button",{type:"button",role:"switch","aria-checked":e,ref:l,disabled:a,onClick:()=>i?.(!e),className:(0,s.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e?"bg-brand-blue":"bg-input",r),...n,children:(0,t.jsx)("span",{className:(0,s.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",e?"translate-x-5":"translate-x-0")})}));a.displayName="Switch",e.s(["Switch",0,a])},436332,e=>{"use strict";let t=(0,e.i(475254).default)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);e.s(["Edit",()=>t],436332)},431343,e=>{"use strict";let t=(0,e.i(475254).default)("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);e.s(["Play",()=>t],431343)},227516,e=>{"use strict";let t=(0,e.i(475254).default)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]);e.s(["History",()=>t],227516)},910419,e=>{"use strict";var t=e.i(920755);let i=new class{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async getAll(e){let{data:t,error:i}=await this.supabase.from("email_templates").select("*").eq("organization_id",e).eq("is_active",!0).order("email_type",{ascending:!0}).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(i)throw i;return t||[]}async getByType(e,t){let{data:i,error:s}=await this.supabase.from("email_templates").select("*").eq("organization_id",e).eq("email_type",t).eq("is_active",!0).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(s)throw s;return i||[]}async getDefault(e,t){let{data:i,error:s}=await this.supabase.from("email_templates").select("*").eq("organization_id",e).eq("email_type",t).eq("is_default",!0).eq("is_active",!0).maybeSingle();if(s)throw s;return i}async getById(e){let{data:t,error:i}=await this.supabase.from("email_templates").select("*").eq("id",e).maybeSingle();if(i)throw i;return t}async create(e,t){e.is_default&&await this.unsetOtherDefaults(e.organization_id,e.email_type);let{data:i,error:s}=await this.supabase.from("email_templates").insert({...e,created_by:t,available_variables:e.available_variables||[]}).select().single();if(s)throw s;return i}async update(e,t){let i=await this.getById(e);if(!i)throw Error("Modèle non trouvé");t.is_default&&await this.unsetOtherDefaults(i.organization_id,i.email_type,e);let{data:s,error:a}=await this.supabase.from("email_templates").update(t).eq("id",e).select().single();if(a)throw a;return s}async delete(e){let{error:t}=await this.supabase.from("email_templates").update({is_active:!1}).eq("id",e);if(t)throw t}async deletePermanently(e){let{error:t}=await this.supabase.from("email_templates").delete().eq("id",e);if(t)throw t}async unsetOtherDefaults(e,t,i){let s=this.supabase.from("email_templates").update({is_default:!1}).eq("organization_id",e).eq("email_type",t).eq("is_default",!0);i&&(s=s.neq("id",i));let{error:a}=await s;if(a)throw a}replaceVariables(e,t){let i=e;for(let[e,s]of Object.entries(t)){let t=RegExp(`\\{${e}\\}`,"g");i=i.replace(t,s?.toString()||"")}return i}getEmailTypes(){return[{value:"document_generated",label:"Document généré",description:"Email envoyé lors de la génération d'un document",defaultVariables:["student_name","document_title","document_type","organization_name","document_url"]},{value:"invoice_sent",label:"Facture envoyée",description:"Email envoyé lors de l'envoi d'une facture",defaultVariables:["student_name","invoice_number","invoice_amount","due_date","organization_name","invoice_url"]},{value:"payment_reminder",label:"Rappel de paiement",description:"Email de rappel pour un paiement en attente",defaultVariables:["student_name","invoice_number","invoice_amount","due_date","days_overdue","organization_name"]},{value:"enrollment_confirmation",label:"Confirmation d'inscription",description:"Email de confirmation d'inscription à une session",defaultVariables:["student_name","session_name","session_start_date","session_location","organization_name"]},{value:"session_reminder",label:"Rappel de session",description:"Email de rappel avant une session",defaultVariables:["student_name","session_name","session_date","session_time","session_location","organization_name"]},{value:"certificate_issued",label:"Certificat délivré",description:"Email lors de la délivrance d'un certificat",defaultVariables:["student_name","certificate_name","certificate_date","organization_name","certificate_url"]},{value:"notification",label:"Notification générale",description:"Notification générale personnalisée",defaultVariables:["recipient_name","message","organization_name","action_url"]},{value:"custom",label:"Personnalisé",description:"Modèle d'email personnalisé",defaultVariables:[]}]}};e.s(["emailTemplateService",0,i])},696381,e=>{"use strict";var t=e.i(920755);let i=new class{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async getAllSchedules(e,t){let i=this.supabase.from("email_schedules").select("*, email_templates(*)").eq("organization_id",e).order("created_at",{ascending:!1});t?.isActive!==void 0&&(i=i.eq("is_active",t.isActive)),t?.emailType&&(i=i.eq("email_type",t.emailType));let{data:s,error:a}=await i;if(a)throw a;return s||[]}async getScheduleById(e){let{data:t,error:i}=await this.supabase.from("email_schedules").select("*, email_templates(*)").eq("id",e).single();if(i)throw i;return t}async createSchedule(e,t){let{data:i}=await this.supabase.auth.getUser(),s={organization_id:e,name:t.name,email_type:t.email_type,trigger_type:t.trigger_type,target_type:t.target_type,is_active:t.is_active??!0,send_to_students:t.send_to_students??!0,send_to_teachers:t.send_to_teachers??!1,send_to_coordinators:t.send_to_coordinators??!1};void 0!==t.description&&(s.description=t.description||null),void 0!==t.template_id&&(s.template_id=t.template_id||null),void 0!==t.trigger_days&&(s.trigger_days=t.trigger_days??null),void 0!==t.trigger_time&&(s.trigger_time=t.trigger_time||null),void 0!==t.trigger_datetime&&(s.trigger_datetime=t.trigger_datetime||null),void 0!==t.session_status&&(s.session_status=t.session_status||null),void 0!==t.session_id&&(s.session_id=t.session_id||null),void 0!==t.formation_id&&(s.formation_id=t.formation_id||null),void 0!==t.program_id&&(s.program_id=t.program_id||null),void 0!==t.custom_variables&&(s.custom_variables=t.custom_variables||null),void 0!==t.send_document&&(s.send_document=t.send_document??!1),void 0!==t.document_type&&(s.document_type=t.document_type||null),void 0!==t.document_template_id&&(s.document_template_id=t.document_template_id||null),i?.user?.id&&(s.created_by=i.user.id);let{data:a,error:r}=await this.supabase.from("email_schedules").insert(s).select().single();if(r)throw console.error("Error creating email schedule:",r),r;return a}async updateSchedule(e,t){let i={name:t.name,description:t.description,email_type:t.email_type,template_id:t.template_id,trigger_type:t.trigger_type,trigger_days:t.trigger_days,trigger_time:t.trigger_time,trigger_datetime:t.trigger_datetime,target_type:t.target_type,session_status:t.session_status,formation_id:t.formation_id,program_id:t.program_id,is_active:t.is_active,send_to_students:t.send_to_students,send_to_teachers:t.send_to_teachers,send_to_coordinators:t.send_to_coordinators,custom_variables:t.custom_variables,send_document:t.send_document,document_type:t.document_type,document_template_id:t.document_template_id};Object.keys(i).forEach(e=>{void 0===i[e]&&delete i[e]});let{data:s,error:a}=await this.supabase.from("email_schedules").update(i).eq("id",e).select().single();if(a)throw a;return s}async deleteSchedule(e){let{error:t}=await this.supabase.from("email_schedules").delete().eq("id",e);if(t)throw t}async getActiveSchedulesToExecute(){let{data:e,error:t}=await this.supabase.from("email_schedules").select("*, email_templates(*), organizations(*)").eq("is_active",!0);if(t)throw t;return e||[]}async logExecution(e,t,i,s){let a={schedule_id:e,organization_id:t,status:i.status,total_recipients:i.totalRecipients,successful_sends:i.successfulSends,failed_sends:i.failedSends,error_message:i.errorMessage||null,error_details:i.errorDetails||null,trigger_context:s||null},{data:r,error:n}=await this.supabase.from("email_schedule_logs").insert(a).select().single();if(n)throw n;let{data:l}=await this.supabase.from("email_schedules").select("total_sent").eq("id",e).single(),d=(l?.total_sent||0)+i.successfulSends;return await this.supabase.from("email_schedules").update({last_run_at:new Date().toISOString(),last_run_status:i.status,last_run_error:i.errorMessage||null,total_sent:d}).eq("id",e),r}async getScheduleLogs(e,t=50){let{data:i,error:s}=await this.supabase.from("email_schedule_logs").select("*").eq("schedule_id",e).order("executed_at",{ascending:!1}).limit(t);if(s)throw s;return i||[]}};e.s(["emailScheduleService",0,i])},495242,e=>{"use strict";let t=(0,e.i(475254).default)("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);e.s(["Pause",()=>t],495242)},907307,e=>{"use strict";var t=e.i(843476),i=e.i(271645),s=e.i(266027),a=e.i(954616),r=e.i(912598),n=e.i(325715),l=e.i(696381),d=e.i(910419),o=e.i(69319),c=e.i(167881),u=e.i(970065),m=e.i(23750),p=e.i(10708),h=e.i(184762),g=e.i(319036),_=e.i(6799),x=e.i(263488),v=e.i(107233),y=e.i(436332),j=e.i(727612),f=e.i(431343),b=e.i(495242),N=e.i(503116),w=e.i(87316),C=e.i(761911),S=e.i(239616),q=e.i(227516);e.i(882205);var k=e.i(846932),E=e.i(88653),z=e.i(647163);function F(){let{user:e}=(0,n.useAuth)(),m=(0,r.useQueryClient)(),{addToast:p}=(0,_.useToast)(),[h,g]=(0,i.useState)("schedules"),[y,j]=(0,i.useState)(null),[N,w]=(0,i.useState)(!1),{data:C,isLoading:k}=(0,s.useQuery)({queryKey:["email-schedules",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)throw Error("Organization ID manquant");return l.emailScheduleService.getAllSchedules(e.organization_id)},enabled:!!e?.organization_id}),{data:F}=(0,s.useQuery)({queryKey:["email-templates",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)throw Error("Organization ID manquant");return d.emailTemplateService.getAll(e.organization_id)},enabled:!!e?.organization_id}),{data:A}=(0,s.useQuery)({queryKey:["document-templates",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)throw Error("Organization ID manquant");return o.documentTemplateService.getAllTemplates(e.organization_id)},enabled:!!e?.organization_id}),D=(0,a.useMutation)({mutationFn:async t=>{if(!e?.organization_id)throw Error("Organization ID manquant");return l.emailScheduleService.createSchedule(e.organization_id,t)},onSuccess:()=>{m.invalidateQueries({queryKey:["email-schedules"]}),w(!1),p({title:"Règle créée",description:"La règle de planification a été créée avec succès.",type:"success"})},onError:e=>{p({title:"Erreur",description:e.message||"Erreur lors de la création de la règle.",type:"error"})}}),M=(0,a.useMutation)({mutationFn:async({id:e,input:t})=>l.emailScheduleService.updateSchedule(e,t),onSuccess:()=>{m.invalidateQueries({queryKey:["email-schedules"]}),j(null),p({title:"Règle mise à jour",description:"La règle de planification a été mise à jour avec succès.",type:"success"})},onError:e=>{p({title:"Erreur",description:e.message||"Erreur lors de la mise à jour de la règle.",type:"error"})}}),P=(0,a.useMutation)({mutationFn:async e=>l.emailScheduleService.deleteSchedule(e),onSuccess:()=>{m.invalidateQueries({queryKey:["email-schedules"]}),p({title:"Règle supprimée",description:"La règle de planification a été supprimée avec succès.",type:"success"})},onError:e=>{p({title:"Erreur",description:e.message||"Erreur lors de la suppression de la règle.",type:"error"})}}),R=(0,a.useMutation)({mutationFn:async({id:e,isActive:t})=>l.emailScheduleService.updateSchedule(e,{is_active:t}),onSuccess:()=>{m.invalidateQueries({queryKey:["email-schedules"]}),p({title:"Règle mise à jour",description:`La r\xe8gle a \xe9t\xe9 ${y?"activée":"désactivée"}.`,type:"success"})},onError:e=>{p({title:"Erreur",description:e.message||"Erreur lors de la mise à jour de la règle.",type:"error"})}}),I=C?.filter(e=>e.is_active)||[],B=C?.filter(e=>!e.is_active)||[];return(0,t.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-7xl",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[(0,t.jsx)(x.Mail,{className:"h-8 w-8 text-brand-blue"}),"Planification d'emails automatiques"]}),(0,t.jsx)("p",{className:"text-gray-600 mt-2",children:"Configurez et gérez les règles d'envoi automatique d'emails (convocation, rappels, etc.)"})]}),(0,t.jsxs)(c.Button,{onClick:()=>w(!0),className:"bg-brand-blue hover:bg-brand-blue/90",children:[(0,t.jsx)(v.Plus,{className:"h-4 w-4 mr-2"}),"Nouvelle règle"]})]}),(0,t.jsxs)("div",{className:"flex gap-4 border-b border-gray-200 mb-6",children:[(0,t.jsxs)("button",{onClick:()=>g("schedules"),className:(0,z.cn)("px-4 py-2 font-medium text-sm border-b-2 transition-colors","schedules"===h?"border-brand-blue text-brand-blue":"border-transparent text-gray-600 hover:text-gray-900"),children:[(0,t.jsx)(S.Settings,{className:"h-4 w-4 inline mr-2"}),"Règles de planification (",C?.length||0,")"]}),(0,t.jsxs)("button",{onClick:()=>g("history"),className:(0,z.cn)("px-4 py-2 font-medium text-sm border-b-2 transition-colors","history"===h?"border-brand-blue text-brand-blue":"border-transparent text-gray-600 hover:text-gray-900"),children:[(0,t.jsx)(q.History,{className:"h-4 w-4 inline mr-2"}),"Historique"]})]})]}),(0,t.jsx)(E.AnimatePresence,{children:N&&(0,t.jsx)(L,{emailTemplates:F||[],documentTemplates:A||[],onCreate:e=>{D.mutate(e)},onCancel:()=>w(!1),isLoading:D.isPending})}),"schedules"===h&&(0,t.jsx)("div",{className:"space-y-6",children:k?(0,t.jsx)("div",{className:"text-center py-12",children:(0,t.jsx)("p",{className:"text-gray-500",children:"Chargement des règles..."})}):C&&C.length>0?(0,t.jsxs)(t.Fragment,{children:[I.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,t.jsx)(f.Play,{className:"h-5 w-5 text-green-600"}),"Règles actives (",I.length,")"]}),(0,t.jsx)("div",{className:"grid gap-4",children:I.map(e=>(0,t.jsx)(T,{schedule:e,emailTemplates:F||[],documentTemplates:A||[],onEdit:()=>j(e.id),onDelete:e=>{confirm("Êtes-vous sûr de vouloir supprimer cette règle ?")&&P.mutate(e)},onToggleActive:(e,t)=>{R.mutate({id:e,isActive:t})},isEditing:y===e.id,onCancelEdit:()=>j(null),onUpdate:t=>{M.mutate({id:e.id,input:t})},isUpdating:M.isPending},e.id))})]}),B.length>0&&(0,t.jsxs)("div",{className:"mt-8",children:[(0,t.jsxs)("h2",{className:"text-xl font-semibold text-gray-900 mb-4 flex items-center gap-2",children:[(0,t.jsx)(b.Pause,{className:"h-5 w-5 text-gray-400"}),"Règles inactives (",B.length,")"]}),(0,t.jsx)("div",{className:"grid gap-4",children:B.map(e=>(0,t.jsx)(T,{schedule:e,emailTemplates:F||[],documentTemplates:A||[],onEdit:()=>j(e.id),onDelete:e=>{confirm("Êtes-vous sûr de vouloir supprimer cette règle ?")&&P.mutate(e)},onToggleActive:(e,t)=>{R.mutate({id:e,isActive:t})},isEditing:y===e.id,onCancelEdit:()=>j(null),onUpdate:t=>{M.mutate({id:e.id,input:t})},isUpdating:M.isPending},e.id))})]})]}):(0,t.jsx)(u.Card,{children:(0,t.jsxs)(u.CardContent,{className:"py-12 text-center",children:[(0,t.jsx)(x.Mail,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Aucune règle de planification"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"Créez votre première règle pour automatiser l'envoi d'emails."}),(0,t.jsxs)(c.Button,{onClick:()=>w(!0),className:"bg-brand-blue hover:bg-brand-blue/90",children:[(0,t.jsx)(v.Plus,{className:"h-4 w-4 mr-2"}),"Créer une règle"]})]})})}),"history"===h&&(0,t.jsx)("div",{className:"space-y-4",children:(0,t.jsxs)(u.Card,{children:[(0,t.jsxs)(u.CardHeader,{children:[(0,t.jsx)(u.CardTitle,{children:"Historique d'exécution"}),(0,t.jsx)(u.CardDescription,{children:"Consultez l'historique des envois automatiques d'emails"})]}),(0,t.jsx)(u.CardContent,{children:(0,t.jsx)("p",{className:"text-gray-500 text-center py-8",children:"L'historique sera disponible une fois que les règles commenceront à s'exécuter."})})]})})]})}function L({emailTemplates:e,documentTemplates:s,onCreate:a,onCancel:r,isLoading:n}){let[l,d]=(0,i.useState)({name:"",description:"",email_type:"session_reminder",template_id:void 0,trigger_type:"before_session_start",trigger_days:1,trigger_time:"09:00",target_type:"session",is_active:!0,send_to_students:!0,send_to_teachers:!1,send_to_coordinators:!1,send_document:!1,document_type:void 0,document_template_id:void 0});return(0,t.jsx)(k.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},children:(0,t.jsxs)(u.Card,{className:"mb-6",children:[(0,t.jsxs)(u.CardHeader,{children:[(0,t.jsx)(u.CardTitle,{children:"Nouvelle règle de planification"}),(0,t.jsx)(u.CardDescription,{children:"Configurez une nouvelle règle pour l'envoi automatique d'emails"})]}),(0,t.jsx)(u.CardContent,{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),a(l)},className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"name",children:"Nom de la règle *"}),(0,t.jsx)(m.Input,{id:"name",value:l.name,onChange:e=>d({...l,name:e.target.value}),required:!0,placeholder:"Ex: Rappel session 24h avant"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"email_type",children:"Type d'email *"}),(0,t.jsxs)("select",{id:"email_type",value:l.email_type,onChange:e=>d({...l,email_type:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:!0,children:[(0,t.jsx)("option",{value:"session_reminder",children:"Rappel de session"}),(0,t.jsx)("option",{value:"evaluation_reminder",children:"Rappel d'évaluation"}),(0,t.jsx)("option",{value:"session_cancellation",children:"Annulation de session"}),(0,t.jsx)("option",{value:"evaluation_available",children:"Évaluation disponible"}),(0,t.jsx)("option",{value:"certificate_issued",children:"Certificat délivré"}),(0,t.jsx)("option",{value:"custom",children:"Personnalisé"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"template_id",children:"Modèle de mail d'accompagnement"}),(0,t.jsxs)("select",{id:"template_id",value:l.template_id||"",onChange:e=>d({...l,template_id:e.target.value||void 0}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"Template par défaut"}),e.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.email_type,")"]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"trigger_type",children:"Type de déclencheur *"}),(0,t.jsxs)("select",{id:"trigger_type",value:l.trigger_type,onChange:e=>d({...l,trigger_type:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:!0,children:[(0,t.jsx)("option",{value:"before_session_start",children:"Avant le début de session"}),(0,t.jsx)("option",{value:"after_session_end",children:"Après la fin de session"}),(0,t.jsx)("option",{value:"before_evaluation_start",children:"Avant le début d'évaluation"}),(0,t.jsx)("option",{value:"after_evaluation_end",children:"Après la fin d'évaluation"}),(0,t.jsx)("option",{value:"fixed_date",children:"Date/heure fixe"})]})]}),"fixed_date"!==l.trigger_type&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"trigger_days",children:"Jours avant/après *"}),(0,t.jsx)(m.Input,{id:"trigger_days",type:"number",value:l.trigger_days||"",onChange:e=>d({...l,trigger_days:parseInt(e.target.value)||void 0}),placeholder:"Ex: 1 (pour 1 jour avant)"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"trigger_time",children:"Heure d'envoi *"}),(0,t.jsx)(m.Input,{id:"trigger_time",type:"time",value:l.trigger_time||"",onChange:e=>d({...l,trigger_time:e.target.value})})]})]}),"fixed_date"===l.trigger_type&&(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"trigger_datetime",children:"Date/heure d'envoi *"}),(0,t.jsx)(m.Input,{id:"trigger_datetime",type:"datetime-local",value:l.trigger_datetime||"",onChange:e=>d({...l,trigger_datetime:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"target_type",children:"Type de cible *"}),(0,t.jsxs)("select",{id:"target_type",value:l.target_type,onChange:e=>d({...l,target_type:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:!0,children:[(0,t.jsx)("option",{value:"session",children:"Session"}),(0,t.jsx)("option",{value:"evaluation",children:"Évaluation"}),(0,t.jsx)("option",{value:"student",children:"Étudiant"}),(0,t.jsx)("option",{value:"teacher",children:"Enseignant"}),(0,t.jsx)("option",{value:"all",children:"Tous"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"description",children:"Description"}),(0,t.jsx)(h.Textarea,{id:"description",value:l.description||"",onChange:e=>d({...l,description:e.target.value}),rows:3,placeholder:"Description de la règle..."})]}),(0,t.jsxs)("div",{className:"space-y-4 border-t pt-6",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:"Document à joindre"}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(p.Label,{htmlFor:"send_document",className:"cursor-pointer",children:"Joindre un document à l'email"}),(0,t.jsx)(g.Switch,{checked:l.send_document??!1,onCheckedChange:e=>d({...l,send_document:e})})]}),l.send_document&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"document_type",children:"Type de document *"}),(0,t.jsxs)("select",{id:"document_type",value:l.document_type||"",onChange:e=>d({...l,document_type:e.target.value||void 0}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:l.send_document,children:[(0,t.jsx)("option",{value:"",children:"Sélectionner un type"}),(0,t.jsx)("option",{value:"convocation",children:"Convocation"}),(0,t.jsx)("option",{value:"certificat_realisation",children:"Certificat de réalisation"}),(0,t.jsx)("option",{value:"evaluation_pre_formation",children:"Évaluation pré-formation"}),(0,t.jsx)("option",{value:"evaluation_post_formation",children:"Évaluation post-formation"}),(0,t.jsx)("option",{value:"attestation",children:"Attestation"}),(0,t.jsx)("option",{value:"bulletin",children:"Bulletin"}),(0,t.jsx)("option",{value:"releve_notes",children:"Relevé de notes"}),(0,t.jsx)("option",{value:"certificat_presence",children:"Certificat de présence"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"document_template_id",children:"Modèle de document"}),(0,t.jsxs)("select",{id:"document_template_id",value:l.document_template_id||"",onChange:e=>d({...l,document_template_id:e.target.value||void 0}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"Modèle par défaut"}),s.filter(e=>!l.document_type||e.type===l.document_type).map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Sélectionnez un modèle personnalisé ou laissez vide pour utiliser le modèle par défaut"})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4 border-t pt-6",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:"Destinataires"}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(p.Label,{htmlFor:"send_to_students",className:"cursor-pointer",children:"Envoyer aux étudiants"}),(0,t.jsx)(g.Switch,{checked:l.send_to_students??!0,onCheckedChange:e=>d({...l,send_to_students:e})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(p.Label,{htmlFor:"send_to_teachers",className:"cursor-pointer",children:"Envoyer aux enseignants"}),(0,t.jsx)(g.Switch,{checked:l.send_to_teachers??!1,onCheckedChange:e=>d({...l,send_to_teachers:e})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(p.Label,{htmlFor:"send_to_coordinators",className:"cursor-pointer",children:"Envoyer aux coordinateurs"}),(0,t.jsx)(g.Switch,{checked:l.send_to_coordinators??!1,onCheckedChange:e=>d({...l,send_to_coordinators:e})})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(g.Switch,{checked:l.is_active??!0,onCheckedChange:e=>d({...l,is_active:e})}),(0,t.jsx)(p.Label,{htmlFor:"is_active",className:"cursor-pointer",children:"Activer la règle"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(c.Button,{type:"button",variant:"outline",onClick:r,disabled:n,children:"Annuler"}),(0,t.jsx)(c.Button,{type:"submit",disabled:n,className:"bg-brand-blue hover:bg-brand-blue/90",children:n?"Création...":"Créer la règle"})]})]})]})})]})})}function T({schedule:e,emailTemplates:i,documentTemplates:s,onEdit:a,onDelete:r,onToggleActive:n,isEditing:l,onCancelEdit:d,onUpdate:o,isUpdating:m}){let p=i.find(t=>t.id===e.template_id);return l?(0,t.jsx)(A,{schedule:e,emailTemplates:i,documentTemplates:s,onUpdate:o,onCancel:d,isLoading:m}):(0,t.jsx)(u.Card,{className:(0,z.cn)(!e.is_active&&"opacity-60"),children:(0,t.jsx)(u.CardContent,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:e.name}),e.is_active?(0,t.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded-full",children:"Active"}):(0,t.jsx)("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 text-gray-600 rounded-full",children:"Inactive"})]}),e.description&&(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,t.jsx)(x.Mail,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["Type: ",(0,t.jsx)("span",{className:"font-medium text-gray-900",children:e.email_type})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,t.jsx)(N.Clock,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["Déclencheur: ",(0,t.jsx)("span",{className:"font-medium text-gray-900",children:e.trigger_type})]})]}),e.trigger_days&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,t.jsx)(w.Calendar,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:[e.trigger_days>0?"+":"",e.trigger_days," jour(s)",e.trigger_time&&` \xe0 ${e.trigger_time}`]})]}),p&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,t.jsx)(S.Settings,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["Template: ",p.name]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,t.jsx)(C.Users,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["Cible: ",(0,t.jsx)("span",{className:"font-medium text-gray-900",children:e.target_type})]})]}),e.total_sent>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-gray-600",children:[(0,t.jsx)(x.Mail,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:[e.total_sent," email(s) envoyé(s)"]})]})]}),(0,t.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[e.send_to_students&&(0,t.jsx)("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:"Étudiants"}),e.send_to_teachers&&(0,t.jsx)("span",{className:"px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded",children:"Enseignants"}),e.send_to_coordinators&&(0,t.jsx)("span",{className:"px-2 py-1 text-xs bg-orange-100 text-orange-800 rounded",children:"Coordinateurs"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,t.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>n(e.id,!e.is_active),children:e.is_active?(0,t.jsx)(b.Pause,{className:"h-4 w-4"}):(0,t.jsx)(f.Play,{className:"h-4 w-4"})}),(0,t.jsx)(c.Button,{variant:"outline",size:"sm",onClick:a,children:(0,t.jsx)(y.Edit,{className:"h-4 w-4"})}),(0,t.jsx)(c.Button,{variant:"outline",size:"sm",onClick:()=>r(e.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,t.jsx)(j.Trash2,{className:"h-4 w-4"})})]})]})})})}function A({schedule:e,emailTemplates:s,documentTemplates:a,onUpdate:r,onCancel:n,isLoading:l}){let[d,o]=(0,i.useState)({name:e.name,description:e.description||"",email_type:e.email_type,template_id:e.template_id||void 0,trigger_type:e.trigger_type,trigger_days:e.trigger_days||void 0,trigger_time:e.trigger_time||void 0,trigger_datetime:e.trigger_datetime||void 0,target_type:e.target_type,is_active:e.is_active,send_to_students:e.send_to_students,send_to_teachers:e.send_to_teachers,send_to_coordinators:e.send_to_coordinators,send_document:e.send_document??!1,document_type:e.document_type||void 0,document_template_id:e.document_template_id||void 0});return(0,t.jsx)(u.Card,{className:"border-brand-blue",children:(0,t.jsx)(u.CardContent,{className:"p-6",children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r(d)},className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"edit-name",children:"Nom de la règle *"}),(0,t.jsx)(m.Input,{id:"edit-name",value:d.name||"",onChange:e=>o({...d,name:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"edit-email_type",children:"Type d'email *"}),(0,t.jsxs)("select",{id:"edit-email_type",value:d.email_type||"",onChange:e=>o({...d,email_type:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:!0,children:[(0,t.jsx)("option",{value:"session_reminder",children:"Rappel de session"}),(0,t.jsx)("option",{value:"evaluation_reminder",children:"Rappel d'évaluation"}),(0,t.jsx)("option",{value:"session_cancellation",children:"Annulation de session"}),(0,t.jsx)("option",{value:"evaluation_available",children:"Évaluation disponible"}),(0,t.jsx)("option",{value:"certificate_issued",children:"Certificat délivré"}),(0,t.jsx)("option",{value:"custom",children:"Personnalisé"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"edit-template_id",children:"Modèle de mail d'accompagnement"}),(0,t.jsxs)("select",{id:"edit-template_id",value:d.template_id||"",onChange:e=>o({...d,template_id:e.target.value||void 0}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"Template par défaut"}),s.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.email_type,")"]},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"edit-trigger_type",children:"Type de déclencheur *"}),(0,t.jsxs)("select",{id:"edit-trigger_type",value:d.trigger_type||"",onChange:e=>o({...d,trigger_type:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:!0,children:[(0,t.jsx)("option",{value:"before_session_start",children:"Avant le début de session"}),(0,t.jsx)("option",{value:"after_session_end",children:"Après la fin de session"}),(0,t.jsx)("option",{value:"before_evaluation_start",children:"Avant le début d'évaluation"}),(0,t.jsx)("option",{value:"after_evaluation_end",children:"Après la fin d'évaluation"}),(0,t.jsx)("option",{value:"fixed_date",children:"Date/heure fixe"})]})]}),"fixed_date"!==d.trigger_type&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"edit-trigger_days",children:"Jours avant/après"}),(0,t.jsx)(m.Input,{id:"edit-trigger_days",type:"number",value:d.trigger_days||"",onChange:e=>o({...d,trigger_days:parseInt(e.target.value)||void 0})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"edit-trigger_time",children:"Heure d'envoi"}),(0,t.jsx)(m.Input,{id:"edit-trigger_time",type:"time",value:d.trigger_time||"",onChange:e=>o({...d,trigger_time:e.target.value})})]})]}),"fixed_date"===d.trigger_type&&(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"edit-trigger_datetime",children:"Date/heure d'envoi"}),(0,t.jsx)(m.Input,{id:"edit-trigger_datetime",type:"datetime-local",value:d.trigger_datetime||"",onChange:e=>o({...d,trigger_datetime:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"edit-target_type",children:"Type de cible *"}),(0,t.jsxs)("select",{id:"edit-target_type",value:d.target_type||"",onChange:e=>o({...d,target_type:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:!0,children:[(0,t.jsx)("option",{value:"session",children:"Session"}),(0,t.jsx)("option",{value:"evaluation",children:"Évaluation"}),(0,t.jsx)("option",{value:"student",children:"Étudiant"}),(0,t.jsx)("option",{value:"teacher",children:"Enseignant"}),(0,t.jsx)("option",{value:"all",children:"Tous"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"edit-description",children:"Description"}),(0,t.jsx)(h.Textarea,{id:"edit-description",value:d.description||"",onChange:e=>o({...d,description:e.target.value}),rows:3})]}),(0,t.jsxs)("div",{className:"space-y-4 border-t pt-6",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:"Document à joindre"}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(p.Label,{htmlFor:"edit-send_document",className:"cursor-pointer",children:"Joindre un document à l'email"}),(0,t.jsx)(g.Switch,{checked:d.send_document??!1,onCheckedChange:e=>o({...d,send_document:e})})]}),d.send_document&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"edit-document_type",children:"Type de document *"}),(0,t.jsxs)("select",{id:"edit-document_type",value:d.document_type||"",onChange:e=>o({...d,document_type:e.target.value||void 0}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",required:d.send_document,children:[(0,t.jsx)("option",{value:"",children:"Sélectionner un type"}),(0,t.jsx)("option",{value:"convocation",children:"Convocation"}),(0,t.jsx)("option",{value:"certificat_realisation",children:"Certificat de réalisation"}),(0,t.jsx)("option",{value:"evaluation_pre_formation",children:"Évaluation pré-formation"}),(0,t.jsx)("option",{value:"evaluation_post_formation",children:"Évaluation post-formation"}),(0,t.jsx)("option",{value:"attestation",children:"Attestation"}),(0,t.jsx)("option",{value:"bulletin",children:"Bulletin"}),(0,t.jsx)("option",{value:"releve_notes",children:"Relevé de notes"}),(0,t.jsx)("option",{value:"certificat_presence",children:"Certificat de présence"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(p.Label,{htmlFor:"edit-document_template_id",children:"Modèle de document"}),(0,t.jsxs)("select",{id:"edit-document_template_id",value:d.document_template_id||"",onChange:e=>o({...d,document_template_id:e.target.value||void 0}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"Modèle par défaut"}),a.filter(e=>!d.document_type||e.type===d.document_type).map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.name," (",e.type,")"]},e.id))]}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Sélectionnez un modèle personnalisé ou laissez vide pour utiliser le modèle par défaut"})]})]})]})]}),(0,t.jsxs)("div",{className:"space-y-4 border-t pt-6",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:"Destinataires"}),(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(p.Label,{htmlFor:"edit-send_to_students",className:"cursor-pointer",children:"Envoyer aux étudiants"}),(0,t.jsx)(g.Switch,{checked:d.send_to_students??!1,onCheckedChange:e=>o({...d,send_to_students:e})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(p.Label,{htmlFor:"edit-send_to_teachers",className:"cursor-pointer",children:"Envoyer aux enseignants"}),(0,t.jsx)(g.Switch,{checked:d.send_to_teachers??!1,onCheckedChange:e=>o({...d,send_to_teachers:e})})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(p.Label,{htmlFor:"edit-send_to_coordinators",className:"cursor-pointer",children:"Envoyer aux coordinateurs"}),(0,t.jsx)(g.Switch,{checked:d.send_to_coordinators??!1,onCheckedChange:e=>o({...d,send_to_coordinators:e})})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(g.Switch,{checked:d.is_active??!1,onCheckedChange:e=>o({...d,is_active:e})}),(0,t.jsx)(p.Label,{htmlFor:"edit-is_active",className:"cursor-pointer",children:"Activer la règle"})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(c.Button,{type:"button",variant:"outline",onClick:n,disabled:l,children:"Annuler"}),(0,t.jsx)(c.Button,{type:"submit",disabled:l,className:"bg-brand-blue hover:bg-brand-blue/90",children:l?"Mise à jour...":"Enregistrer"})]})]})]})})})}e.s(["default",()=>F])}]);