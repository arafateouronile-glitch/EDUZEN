(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let s=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],871689)},503116,e=>{"use strict";let s=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>s],503116)},645760,e=>{"use strict";var s=e.i(843476),t=e.i(271645),r=e.i(647163);e.i(882205);var a=e.i(846932);let i=t.forwardRef(({className:e,variant:t="default",hoverable:i=!1,glow:l=!1,glowColor:n="rgba(51, 90, 207, 0.3)",...d},o)=>(0,s.jsxs)(a.motion.div,{ref:o,className:(0,r.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===t,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===t,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===t,"cursor-pointer":i,"hover:shadow-2xl hover:scale-[1.02]":i,"hover:bg-white/90 dark:hover:bg-gray-900/90":i},e),whileHover:i?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...d,children:[l&&(0,s.jsx)(a.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${n} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,s.jsx)("div",{className:"relative z-10",children:d.children})]}));i.displayName="GlassCard",e.s(["GlassCard",()=>i])},225913,e=>{"use strict";var s=e.i(207670);let t=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,r=s.clsx;e.s(["cva",0,(e,s)=>a=>{var i;if((null==s?void 0:s.variants)==null)return r(e,null==a?void 0:a.class,null==a?void 0:a.className);let{variants:l,defaultVariants:n}=s,d=Object.keys(l).map(e=>{let s=null==a?void 0:a[e],r=null==n?void 0:n[e];if(null===s)return null;let i=t(s)||t(r);return l[e][i]}),o=a&&Object.entries(a).reduce((e,s)=>{let[t,r]=s;return void 0===r||(e[t]=r),e},{});return r(e,d,null==s||null==(i=s.compoundVariants)?void 0:i.reduce((e,s)=>{let{class:t,className:r,...a}=s;return Object.entries(a).every(e=>{let[s,t]=e;return Array.isArray(t)?t.includes({...n,...o}[s]):({...n,...o})[s]===t})?[...e,t,r]:e},[]),null==a?void 0:a.class,null==a?void 0:a.className)}])},994179,e=>{"use strict";var s=e.i(843476),t=e.i(225913),r=e.i(647163);let a=(0,t.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground border-border hover:bg-accent hover:text-accent-foreground",success:"border-transparent bg-success-primary text-white shadow hover:bg-brand-blue-dark",warning:"border-transparent bg-warning-primary text-white shadow hover:bg-brand-cyan-dark",premium:"border-transparent bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 text-white shadow-lg shadow-purple-500/50 hover:shadow-xl hover:shadow-purple-500/60",glass:"border-white/20 bg-white/10 backdrop-blur-md text-foreground shadow-lg"},size:{default:"px-2.5 py-0.5 text-xs",sm:"px-2 py-0.5 text-xs",lg:"px-3 py-1 text-sm"}},defaultVariants:{variant:"default",size:"default"}});function i({className:e,variant:t,size:i,dot:l,pulse:n,children:d,...o}){return(0,s.jsxs)("div",{className:(0,r.cn)(a({variant:t,size:i}),e),...o,children:[l&&(0,s.jsx)("span",{className:(0,r.cn)("mr-1.5 h-1.5 w-1.5 rounded-full","success"===t&&"bg-white/80","warning"===t&&"bg-white/80","default"===t&&"bg-white/80",n&&"animate-pulse")}),d]})}e.s(["Badge",()=>i])},810980,e=>{"use strict";let s=(0,e.i(475254).default)("BookOpen",[["path",{d:"M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z",key:"vv98re"}],["path",{d:"M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z",key:"1cyq3y"}]]);e.s(["BookOpen",()=>s],810980)},440160,e=>{"use strict";let s=(0,e.i(475254).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>s],440160)},463059,e=>{"use strict";let s=(0,e.i(475254).default)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>s],463059)},473708,e=>{"use strict";let s=(0,e.i(475254).default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);e.s(["Image",()=>s],473708)},431343,e=>{"use strict";let s=(0,e.i(475254).default)("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);e.s(["Play",()=>s],431343)},373375,e=>{"use strict";let s=(0,e.i(475254).default)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>s],373375)},278716,e=>{"use strict";let s=(0,e.i(475254).default)("Video",[["path",{d:"m22 8-6 4 6 4V8Z",key:"50v9me"}],["rect",{width:"14",height:"12",x:"2",y:"6",rx:"2",ry:"2",key:"1rqjg6"}]]);e.s(["Video",()=>s],278716)},564245,e=>{"use strict";var s=e.i(843476),t=e.i(266027),r=e.i(954616),a=e.i(912598),i=e.i(383801),l=e.i(267824),n=e.i(645760),d=e.i(167881),o=e.i(994179),c=e.i(6799);e.i(882205);var u=e.i(846932),m=e.i(338456),x=e.i(810980),h=e.i(503116),g=e.i(465286),p=e.i(373375),b=e.i(463059),y=e.i(431343),f=e.i(842009),v=e.i(178583),j=e.i(278716),w=e.i(473708);let N=(0,e.i(475254).default)("ListChecks",[["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}],["path",{d:"M13 6h8",key:"15sg57"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 18h8",key:"oe0vm4"}]]);var _=e.i(871689),k=e.i(440160),C=e.i(522016),q=e.i(618566),S=e.i(271645),z=e.i(918789),B=e.i(790224);function $(){let e=(0,q.useParams)();(0,q.useRouter)();let $=e.slug,{student:T,studentId:L}=(0,i.useLearnerContext)(),O=(0,S.useMemo)(()=>L?(0,l.createLearnerClient)(L):null,[L]),A=(0,a.useQueryClient)(),{addToast:R}=(0,c.useToast)(),[P,M]=(0,S.useState)(0),[I,G]=(0,S.useState)(!1),Q=(0,S.useRef)(null),[E,F]=(0,S.useState)({}),K=(0,S.useMemo)(()=>L?`eduzen.inlineQuizAnswers.${L}`:null,[L]),{data:V,isLoading:D,refetch:J}=(0,t.useQuery)({queryKey:["learner-course",$],queryFn:async()=>{try{if(!O)return null;let{data:e,error:s}=await O.from("courses").select(`
            *,
            course_sections(
              id,
              title,
              description,
              order_index,
              lessons(
                id,
                title,
                description,
                content,
                lesson_type,
                video_duration_minutes,
                order_index,
                video_url,
                is_preview,
                quizzes(id)
              )
            )
          `).eq("slug",$).maybeSingle();if(s){if("PGRST116"===s.code||"42P01"===s.code||"PGRST301"===s.code||400===s.status||"400"===s.code||s.message?.includes("relation")||s.message?.includes("relationship")||s.message?.includes("does not exist")||s.message?.includes("schema cache"))return B.logger.warn("Course table or relations do not exist yet or invalid query",{slug:$,error:(0,B.sanitizeError)(s)}),null;throw s}return e}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===400||e?.code==="400"||e?.message?.includes("relation")||e?.message?.includes("relationship")||e?.message?.includes("does not exist")||e?.message?.includes("schema cache"))return B.logger.warn("Course table or relations do not exist yet or invalid query",{slug:$,error:(0,B.sanitizeError)(e)}),null;throw e}},enabled:!!$&&!!O}),H=V?.scores_enabled!==!1,{data:U}=(0,t.useQuery)({queryKey:["learner-lesson-progress",V?.id,L],queryFn:async()=>{if(!V?.id||!L||!O)return{};let{data:e}=await O.from("lesson_progress").select("*").eq("student_id",L),s={};return e?.forEach(e=>{s[e.lesson_id]=e}),s},enabled:!!V?.id&&!!L&&!!O}),{data:Z}=(0,t.useQuery)({queryKey:["learner-course-lessons-fallback",V?.id],queryFn:async()=>{if(!O||!V?.id||V?.course_sections?.length)return[];let{data:e,error:s}=await O.from("lessons").select(`
          id,
          title,
          description,
          content,
          lesson_type,
          video_duration_minutes,
          order_index,
          video_url,
          is_preview,
          course_id,
          section_id,
          section:course_sections(title),
          quizzes(id)
        `).eq("course_id",V.id).order("order_index",{ascending:!0});return s?(B.logger.warn("Error fetching lessons fallback",{courseId:(0,B.maskId)(V.id),error:(0,B.sanitizeError)(s)}),[]):e||[]},enabled:!!O&&!!V?.id}),W=V?.course_sections?.length?V.course_sections?.sort((e,s)=>e.order_index-s.order_index).flatMap(e=>(e.lessons||[]).sort((e,s)=>e.order_index-s.order_index).map(s=>({...s,sectionTitle:e.title})))||[]:(Z||[]).map(e=>({...e,sectionTitle:e?.section?.title||"Sans section"})),X=W[P],Y=W.length,ee=Object.values(U||{}).filter(e=>e.is_completed).length,es=Y>0?Math.round(ee/Y*100):0;(0,S.useEffect)(()=>{if(!X?.id)return;let e=(e=>{if(!K)return null;try{let s=localStorage.getItem(K);if(!s)return null;let t=JSON.parse(s),r=t?.[e];if(r&&"object"==typeof r)return r;return null}catch{return null}})(X.id);e&&F(s=>s[X.id]&&Object.keys(s[X.id]).length>0?s:{...s,[X.id]:e})},[X?.id,K]),(0,S.useEffect)(()=>{P>0&&P>=Y&&M(0)},[P,Y]);let et=(0,r.useMutation)({mutationFn:async e=>{if(!L||!O)throw Error("Student not found");let s=new Date().toISOString(),t={is_completed:!0,completed_at:s,completion_percentage:100},{data:r,error:a}=await O.from("lesson_progress").select("id").eq("lesson_id",e).eq("student_id",L).maybeSingle();if(a&&"PGRST116"!==a.code)throw a;if(r?.id){let{error:e}=await O.from("lesson_progress").update(t).eq("id",r.id);if(e)throw e}else{let{error:r}=await O.from("lesson_progress").insert({student_id:L,lesson_id:e,is_completed:!0,completed_at:s,completion_percentage:100});if(r)if("23505"===r.code||r.message?.toLowerCase().includes("duplicate")||r.message?.toLowerCase().includes("conflict")){let{error:s}=await O.from("lesson_progress").update(t).eq("lesson_id",e).eq("student_id",L);if(s)throw s}else throw r}},onSuccess:()=>{A.invalidateQueries({queryKey:["learner-lesson-progress"]}),A.invalidateQueries({queryKey:["learner-course-enrollment"]}),R({type:"success",title:"Leçon terminée !",description:"Votre progression a été enregistrée."})},onError:e=>{let s=e?.message||"";R({type:"error",title:"Impossible d’enregistrer",description:s.includes("401")||s.toLowerCase().includes("unauthorized")?"Accès non autorisé (RLS). Applique la migration '20251217000014_learner_write_lesson_progress.sql' puis réessaie.":s.includes("409")||s.toLowerCase().includes("conflict")?"Conflit (409). Très souvent: la FK de `lesson_progress.student_id` pointe vers `auth.users` au lieu de `public.students`. Applique '20251217000016_fix_lesson_progress_student_fk.sql' (et éventuellement '20251217000015_lesson_progress_unique_index.sql'), puis réessaie.":"Une erreur est survenue lors de l’enregistrement de votre progression."})}}),er=()=>{X&&et.mutate(X.id)},ea=e=>{switch(e){case"video":return(0,s.jsx)(j.Video,{className:"h-4 w-4"});case"quiz":return(0,s.jsx)(N,{className:"h-4 w-4"});case"text":return(0,s.jsx)(v.FileText,{className:"h-4 w-4"});case"image":return(0,s.jsx)(w.Image,{className:"h-4 w-4"});default:return(0,s.jsx)(x.BookOpen,{className:"h-4 w-4"})}},ei=e=>U?.[e]?.is_completed,el=(0,S.useMemo)(()=>{if(!X?.id||!X?.content)return{total:0,answered:0,correct:0,percentage:0,graded:!1};try{let e=JSON.parse(X.content);if(!Array.isArray(e))return{total:0,answered:0,correct:0,percentage:0,graded:!1};let s=e.filter(e=>e?.type==="quiz");if(!s.length)return{total:0,answered:0,correct:0,percentage:0,graded:!1};let t=E?.[X.id]||{},r=0,a=0,i=0;for(let e=0;e<s.length;e++){let l=s[e],n=String(l?.id||`quiz-${e}`),d=t[n];d&&(a+=1);let o=(l?.data?.options||[]).map((e,s)=>({id:String(e?.id||`${n}-opt-${s}`),text:String(e?.text||""),isCorrect:!!e?.isCorrect}));if(!o.filter(e=>e.isCorrect).length)continue;r+=1;let c=o.find(e=>(e.id||e.text)===d);d&&c?.isCorrect&&(i+=1)}let l=r>0,n=l?Math.round(i/r*100):0;return{total:r,answered:a,correct:i,percentage:n,graded:l}}catch{return{total:0,answered:0,correct:0,percentage:0,graded:!1}}},[X?.id,X?.content,E]);return D?(0,s.jsxs)("div",{className:"space-y-6 pb-24 lg:pb-8",children:[(0,s.jsx)("div",{className:"h-12 w-48 bg-gray-100 rounded-lg animate-pulse"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsx)("div",{className:"lg:col-span-2 h-96 bg-gray-100 rounded-2xl animate-pulse"}),(0,s.jsx)("div",{className:"h-96 bg-gray-100 rounded-2xl animate-pulse"})]})]}):V?(0,s.jsxs)("div",{className:"space-y-6 pb-24 lg:pb-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(C.default,{href:"/learner/elearning",children:(0,s.jsx)(d.Button,{variant:"ghost",size:"icon",children:(0,s.jsx)(_.ArrowLeft,{className:"h-5 w-5"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h1",{className:"text-xl md:text-2xl font-bold text-gray-900 line-clamp-1",children:V.title}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm text-gray-500 mt-1",children:[(0,s.jsxs)("span",{children:[es,"% complété"]}),(0,s.jsx)("span",{children:"•"}),(0,s.jsxs)("span",{children:[ee,"/",Y," leçons"]})]})]}),es>=100&&(0,s.jsxs)(o.Badge,{className:"bg-green-100 text-green-700",children:[(0,s.jsx)(f.Award,{className:"h-3 w-3 mr-1"}),"Terminé"]})]}),(0,s.jsx)("div",{className:"w-full h-2 bg-gray-100 rounded-full overflow-hidden",children:(0,s.jsx)(u.motion.div,{className:"h-full bg-gradient-to-r from-brand-blue to-indigo-500",initial:{width:0},animate:{width:`${es}%`},transition:{duration:.5}})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[X&&(0,s.jsxs)(n.GlassCard,{className:"overflow-hidden",children:[(0,s.jsx)("div",{className:"relative aspect-video bg-gray-900",children:X.video_url?(0,s.jsx)("video",{ref:Q,src:X.video_url,className:"w-full h-full object-contain",controls:!0,onEnded:er}):"quiz"===X.lesson_type?(0,s.jsxs)("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-white",children:[(0,s.jsx)(N,{className:"h-16 w-16 mb-4 text-brand-blue"}),(0,s.jsx)("h3",{className:"text-xl font-semibold mb-2",children:"Quiz interactif"}),(0,s.jsx)("p",{className:"text-gray-400 mb-4",children:"Testez vos connaissances"}),(0,s.jsx)(C.default,{href:`/learner/evaluations/${X?.quizzes?.[0]?.id||X.id}`,children:(0,s.jsxs)(d.Button,{children:[(0,s.jsx)(y.Play,{className:"h-4 w-4 mr-2"}),"Commencer le quiz"]})})]}):(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center text-white",children:[(0,s.jsx)(x.BookOpen,{className:"h-16 w-16 mx-auto mb-4 text-brand-blue"}),(0,s.jsx)("p",{className:"text-gray-400",children:"Contenu textuel ci-dessous"})]})})}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-brand-blue font-medium mb-1",children:X.sectionTitle}),(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:X.title}),H&&el.graded&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsxs)(o.Badge,{className:"bg-indigo-100 text-indigo-700",children:["Score quiz: ",el.correct,"/",el.total," (",el.percentage,"%)"]})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[X.video_duration_minutes&&(0,s.jsxs)(o.Badge,{variant:"outline",children:[(0,s.jsx)(h.Clock,{className:"h-3 w-3 mr-1"}),X.video_duration_minutes," min"]}),ei(X.id)&&(0,s.jsxs)(o.Badge,{className:"bg-green-100 text-green-700",children:[(0,s.jsx)(g.CheckCircle2,{className:"h-3 w-3 mr-1"}),"Terminé"]})]})]}),X.description&&(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:X.description}),((e,t)=>{if(!e)return null;try{let r=JSON.parse(e);if(Array.isArray(r))return(0,s.jsx)("div",{className:"space-y-4",children:r.map((e,r)=>{if(!e?.type)return null;if("text"===e.type)return(0,s.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,s.jsx)(z.default,{children:e?.data?.content||""})},e.id||r);if("media"===e.type){let t=e?.data?.mediaType,a=e?.data?.mediaUrl,i=e?.data?.caption;return a?"image"===t?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("img",{src:a,alt:i||"Image",className:"w-full rounded-lg border border-gray-200"}),i?(0,s.jsx)("p",{className:"text-sm text-gray-500 text-center italic",children:i}):null]},e.id||r):"video"===t?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("video",{src:a,controls:!0,className:"w-full rounded-lg"}),i?(0,s.jsx)("p",{className:"text-sm text-gray-500 text-center italic",children:i}):null]},e.id||r):"audio"===t?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("audio",{src:a,controls:!0,className:"w-full"}),i?(0,s.jsx)("p",{className:"text-sm text-gray-500 text-center italic",children:i}):null]},e.id||r):(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:i||"Fichier"}),(0,s.jsx)("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-brand-blue hover:underline",children:"Télécharger"})]},e.id||r):null}if("quiz"===e.type){let a=String(e?.id||`quiz-${r}`),i=t&&E?.[t]?.[a]||"",l=(e?.data?.options||[]).map((e,s)=>({id:String(e?.id||`${a}-opt-${s}`),text:String(e?.text||""),isCorrect:!!e?.isCorrect})),n=l.filter(e=>e.isCorrect),d=l.find(e=>(e.id||e.text)===i),c=!!i,u=n.length>0,m=!!c&&!!u&&!!d?.isCorrect;return(0,s.jsxs)("div",{className:"p-4 border rounded-lg bg-white",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3 mb-2",children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-900",children:H&&u?"Quiz (noté)":"Quiz"}),H&&u&&(0,s.jsx)(o.Badge,{className:c?m?"bg-green-100 text-green-700":"bg-red-100 text-red-700":"bg-gray-100 text-gray-700",children:c&&m?"1/1":"0/1"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-700 mb-3",children:e?.data?.question||""}),(0,s.jsx)("div",{className:"space-y-2",children:l.map(e=>{let r=e.id||e.text,l=i===r,n=!!i;return(0,s.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),e.stopPropagation(),!t||n||F(e=>{let s={...e[t]||{},[a]:r};if(K)try{let e=localStorage.getItem(K),r={...(e?JSON.parse(e):{})||{},[t]:s};localStorage.setItem(K,JSON.stringify(r))}catch{}return{...e,[t]:s}})},disabled:n,className:`w-full text-left border rounded-md px-3 py-2 text-sm transition-colors ${l?"border-brand-blue bg-brand-blue/10 text-gray-900":"border-gray-200 hover:bg-gray-50 text-gray-700"}`,children:e.text},r)})}),H&&c&&u&&(0,s.jsx)("div",{className:"mt-3 text-sm",children:m?(0,s.jsx)("p",{className:"text-green-700 font-medium",children:"Bonne réponse (+1)"}):(0,s.jsx)("p",{className:"text-red-700 font-medium",children:"Mauvaise réponse (0)"})}),i&&(0,s.jsx)("p",{className:"mt-2 text-xs text-gray-500",children:"Réponse verrouillée (vous ne pouvez plus la modifier)."})]},e.id||r)}return"poll"===e.type?(0,s.jsxs)("div",{className:"p-4 border rounded-lg bg-white",children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Sondage"}),(0,s.jsx)("p",{className:"text-sm text-gray-700 mb-3",children:e?.data?.pollQuestion||""}),(0,s.jsx)("ul",{className:"space-y-2",children:(e?.data?.pollOptions||[]).map(e=>(0,s.jsx)("li",{className:"text-sm text-gray-600 border rounded-md px-3 py-2",children:e.text},e.id))})]},e.id||r):null})})}catch{}return(0,s.jsx)("div",{className:"prose prose-sm max-w-none mt-6 pt-6 border-t",children:(0,s.jsx)(z.default,{children:e})})})(X.content,X.id),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-6 pt-6 border-t",children:[(0,s.jsxs)(d.Button,{variant:"outline",onClick:()=>{P>0&&M(P-1)},disabled:0===P,children:[(0,s.jsx)(p.ChevronLeft,{className:"h-4 w-4 mr-2"}),"Précédent"]}),!ei(X.id)&&(0,s.jsxs)(d.Button,{onClick:er,disabled:et.isPending,className:"bg-green-600 hover:bg-green-700",children:[(0,s.jsx)(g.CheckCircle2,{className:"h-4 w-4 mr-2"}),"Marquer comme terminé"]}),(0,s.jsxs)(d.Button,{onClick:()=>{P<Y-1&&M(P+1)},disabled:P>=Y-1,children:["Suivant",(0,s.jsx)(b.ChevronRight,{className:"h-4 w-4 ml-2"})]})]})]})]}),!X&&(0,s.jsxs)(n.GlassCard,{className:"p-6 border border-amber-200 bg-amber-50/40",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Impossible de démarrer le cours"}),(0,s.jsx)("p",{className:"text-sm text-gray-700 mb-4",children:"Ce cours ne contient pas encore de leçons, ou l’accès aux sections/leçons n’est pas encore autorisé."}),(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)(d.Button,{onClick:()=>J(),className:"bg-brand-blue hover:bg-brand-blue/90",children:"Réessayer"}),(0,s.jsx)(C.default,{href:"/learner/elearning",children:(0,s.jsx)(d.Button,{variant:"outline",children:"Retour aux cours"})})]})]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)(n.GlassCard,{className:"p-4",children:[(0,s.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:"Contenu du cours"}),(0,s.jsx)("div",{className:"space-y-2 max-h-[600px] overflow-y-auto pr-2",children:V.course_sections?.length?V.course_sections?.sort((e,s)=>e.order_index-s.order_index).map(e=>(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2 px-2",children:e.title}),(0,s.jsx)("div",{className:"space-y-1",children:e.lessons.sort((e,s)=>e.order_index-s.order_index).map((e,t)=>{let r=W.findIndex(s=>s.id===e.id),a=r===P,i=ei(e.id);return(0,s.jsxs)("button",{onClick:()=>M(r),className:`w-full flex items-center gap-3 p-3 rounded-xl text-left transition-all ${a?"bg-brand-blue text-white shadow-lg":i?"bg-green-50 text-gray-700 hover:bg-green-100":"hover:bg-gray-50 text-gray-600"}`,children:[(0,s.jsx)("div",{className:`p-1.5 rounded-lg ${a?"bg-white/20":i?"bg-green-100":"bg-gray-100"}`,children:i?(0,s.jsx)(g.CheckCircle2,{className:`h-4 w-4 ${a?"text-white":"text-green-600"}`}):ea(e.lesson_type)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:`text-sm font-medium truncate ${a?"text-white":""}`,children:e.title}),e.video_duration_minutes&&(0,s.jsxs)("p",{className:`text-xs ${a?"text-white/70":"text-gray-400"}`,children:[e.video_duration_minutes," min"]})]}),a&&(0,s.jsx)(m.PlayCircle,{className:"h-5 w-5 text-white"})]},e.id)})})]},e.id)):W.length?(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h4",{className:"text-sm font-semibold text-gray-700 mb-2 px-2",children:"Leçons"}),(0,s.jsx)("div",{className:"space-y-1",children:W.map(e=>{let t=W.findIndex(s=>s.id===e.id),r=t===P,a=ei(e.id);return(0,s.jsxs)("button",{onClick:()=>M(t),className:`w-full flex items-center gap-3 p-3 rounded-xl text-left transition-all ${r?"bg-brand-blue text-white shadow-lg":a?"bg-green-50 text-gray-700 hover:bg-green-100":"hover:bg-gray-50 text-gray-600"}`,children:[(0,s.jsx)("div",{className:`p-1.5 rounded-lg ${r?"bg-white/20":a?"bg-green-100":"bg-gray-100"}`,children:a?(0,s.jsx)(g.CheckCircle2,{className:`h-4 w-4 ${r?"text-white":"text-green-600"}`}):ea(e.lesson_type)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:`text-sm font-medium truncate ${r?"text-white":""}`,children:e.title}),e.video_duration_minutes&&(0,s.jsxs)("p",{className:`text-xs ${r?"text-white/70":"text-gray-400"}`,children:[e.video_duration_minutes," min"]})]}),r&&(0,s.jsx)(m.PlayCircle,{className:"h-5 w-5 text-white"})]},e.id)})})]}):(0,s.jsx)("div",{className:"text-sm text-gray-600 p-3 bg-gray-50 rounded-lg border",children:"Aucune section/leçon visible pour le moment. Si le cours est bien assigné, applique la migration RLS pour `course_sections` puis réessaye."})})]}),es>=100&&(0,s.jsxs)(n.GlassCard,{className:"p-4 bg-gradient-to-br from-amber-50 to-amber-100/50 border-amber-200",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"p-2 bg-amber-100 rounded-xl",children:(0,s.jsx)(f.Award,{className:"h-6 w-6 text-amber-600"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("h4",{className:"font-semibold text-gray-900",children:"Félicitations !"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Cours terminé avec succès"})]})]}),(0,s.jsxs)(d.Button,{variant:"outline",className:"w-full mt-3",children:[(0,s.jsx)(k.Download,{className:"h-4 w-4 mr-2"}),"Télécharger le certificat"]})]})]})]})]}):(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(x.BookOpen,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Cours introuvable"}),(0,s.jsx)(C.default,{href:"/learner/elearning",children:(0,s.jsxs)(d.Button,{variant:"outline",children:[(0,s.jsx)(_.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour aux cours"]})})]})}e.s(["default",()=>$],564245)}]);