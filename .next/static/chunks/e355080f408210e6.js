(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,486258,e=>{"use strict";var s=e.i(843476),t=e.i(271645),r=e.i(970065),a=e.i(167881),n=e.i(994179),l=e.i(23750);e.i(882205);var i=e.i(846932),c=e.i(647163),d=e.i(284614),o=e.i(25652),m=e.i(191741),u=e.i(842009),x=e.i(346897),h=e.i(87316),p=e.i(503116),j=e.i(440160),g=e.i(879002),f=e.i(286536),N=e.i(778917),b=e.i(555436),v=e.i(605631),y=e.i(738308),w=e.i(898791),_=e.i(101523),C=e.i(761911),q=e.i(32095),k=e.i(561659);let S=(0,e.i(475254).default)("Link2",[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]]);var P=e.i(174886),z=e.i(16715),B=e.i(629377),E=e.i(662031),A=e.i(954616),T=e.i(846696),$=e.i(266027),D=e.i(178583),L=e.i(107233),F=e.i(263488),M=e.i(598203),I=e.i(6799);function U({studentId:e,organizationId:t}){let{addToast:n}=(0,I.useToast)(),{data:l,isLoading:i}=(0,$.useQuery)({queryKey:["student-documents",e,t],queryFn:async()=>t?M.documentService.getAll(t,{studentId:e}):{data:[],total:0,page:1,limit:50,totalPages:0},enabled:!!e&&!!t});return(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)(r.CardTitle,{className:"text-base flex items-center justify-between",children:[(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)(D.FileText,{className:"h-5 w-5 mr-2"}),"Documents partagés"]}),(0,s.jsxs)(a.Button,{variant:"outline",size:"sm",onClick:()=>{n({type:"info",title:"Fonctionnalité à venir",description:"L'upload de documents sera implémenté prochainement. Vous pourrez ajouter des supports de cours, exercices et autres documents.",duration:7e3})},children:[(0,s.jsx)(L.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter un document"]})]})}),(0,s.jsx)(r.CardContent,{children:i?(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Chargement des documents..."}):l&&l.data&&l.data.length>0?(0,s.jsx)("div",{className:"space-y-3",children:l.data.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3 flex-1",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-blue-600",children:(e=>{switch(e){case"certificate":return(0,s.jsx)(u.Award,{className:"h-4 w-4"});case"transcript":case"attestation":case"contract":default:return(0,s.jsx)(D.FileText,{className:"h-4 w-4"});case"convocation":return(0,s.jsx)(F.Mail,{className:"h-4 w-4"})}})(e.type)}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("p",{className:"font-medium",children:e.title}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(e=>{switch(e){case"certificate":return"Certificat";case"transcript":return"Relevé de notes";case"attestation":return"Attestation";case"contract":return"Contrat";case"convocation":return"Convocation";case"invoice":return"Facture";case"receipt":return"Reçu";default:return e}})(e.type),e.created_at&&` • ${(0,c.formatDate)(e.created_at)}`]})]})]}),(0,s.jsx)("div",{className:"flex items-center space-x-2",children:e.file_url&&(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:()=>{e.file_url&&window.open(e.file_url,"_blank")},children:(0,s.jsx)(j.Download,{className:"h-4 w-4"})})})]},e.id))}):(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(D.FileText,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{className:"text-sm",children:"Aucun document partagé pour le moment"}),(0,s.jsx)("p",{className:"text-xs mt-1",children:"Les supports de cours et exercices apparaîtront ici"})]})})]})}var H=e.i(287336),O=e.i(630374),R=e.i(62870),G=e.i(10708),Q=e.i(625959),K=e.i(727612),V=e.i(810980),X=e.i(338456),W=e.i(912598),J=e.i(920755),Y=e.i(522016);function Z({sessionId:e,organizationId:i,enrollments:d}){let m=(0,J.createClient)(),u=(0,W.useQueryClient)(),[x,h]=(0,t.useState)(!1),[j,g]=(0,t.useState)(""),[b,k]=(0,t.useState)(!0),[S,P]=(0,t.useState)(""),[z,E]=(0,t.useState)(null),[D,F]=(0,t.useState)("student"),[M,I]=(0,t.useState)(null),U=e=>{let s=e?.code,t=e?.status,r=(e?.message||"").toLowerCase();return"PGRST116"===s||"PGRST205"===s||"42P01"===s||404===t||r.includes("could not find the table")||r.includes("schema cache")||r.includes("does not exist")},{data:Z,isLoading:ee}=(0,$.useQuery)({queryKey:["session-courses",e],queryFn:async()=>{try{let{data:s,error:t}=await m.from("session_courses").select(`
            *,
            course:courses(
              id, title, slug, short_description, difficulty_level,
              estimated_duration_hours, thumbnail_url, is_published
            )
          `).eq("session_id",e).order("assigned_at",{ascending:!1});if(t){if(U(t))return[];throw t}return s||[]}catch(e){if(U(e))return[];return console.warn("Error fetching session courses:",e),[]}},enabled:!!e}),{data:es}=(0,$.useQuery)({queryKey:["available-courses",i],queryFn:async()=>{try{let{data:e,error:s}=await m.from("courses").select("id, title, slug, is_published, difficulty_level").eq("organization_id",i).eq("is_published",!0).order("title",{ascending:!0});if(s){if("PGRST116"===s.code||"42P01"===s.code)return[];throw s}return e||[]}catch(e){return console.warn("Error fetching available courses:",e),[]}},enabled:!!i}),{data:et}=(0,$.useQuery)({queryKey:["session-elearning-progress",e,Z?.map(e=>e.course_id)],queryFn:async()=>{if(!Z?.length||!d.length)return[];let e=Z.map(e=>e.course_id),s=d.map(e=>e.student_id).filter(e=>null!==e);try{let{data:t,error:r}=await m.from("course_enrollments").select("*").in("course_id",e).in("student_id",s);if(r){if(U(r))return[];return console.warn("Error fetching course enrollments:",r),[]}let{data:a,error:n}=await m.from("lesson_progress").select("*, lessons(course_id)").in("student_id",s);n&&!U(n)&&console.warn("Error fetching lesson progress:",n);let{data:l,error:i}=await m.from("lessons").select("id, course_id").in("course_id",e);i&&!U(i)&&console.warn("Error fetching lessons:",i);let{data:c,error:o}=await m.from("quiz_attempts").select("*, quizzes(lesson_id, lessons(course_id))").in("student_id",s).not("completed_at","is",null);o&&!U(o)&&console.warn("Error fetching quiz attempts:",o);let u=[];for(let e of d){let s=e.students;if(s)for(let t of Z){let r=t.course_id,n=(l?.filter(e=>e.course_id===r)||[]).length,i=(a||[]).filter(s=>s.student_id===e.student_id&&s.lessons?.course_id===r),d=i.filter(e=>e.is_completed).length,o=n>0?Math.round(d/n*100):0,m=(c||[]).filter(s=>s.student_id===e.student_id&&s.quizzes?.lessons?.course_id===r),x=m.length>0?Math.round(m.reduce((e,s)=>e+(s.score||0),0)/m.length):null,h=i.sort((e,s)=>new Date(s.last_accessed_at||s.started_at||s.completed_at||0).getTime()-new Date(e.last_accessed_at||e.started_at||e.completed_at||0).getTime())[0],p="not_started";d>0&&d>=n?p="completed":d>0&&(p="in_progress"),e.student_id&&u.push({student_id:e.student_id,student_name:`${s.first_name} ${s.last_name}`,course_id:r,progress:o,completed_lessons:d,total_lessons:n,quiz_score:x,last_activity:h?.last_accessed_at||h?.started_at||h?.completed_at||null,status:p})}}return u}catch(e){if(U(e))return[];return console.warn("Error calculating progress:",e),[]}},enabled:!!Z?.length&&!!d.length}),er=(0,A.useMutation)({mutationFn:async()=>{if(!j)throw Error("Veuillez sélectionner un cours");let{data:s,error:t}=await m.from("session_courses").insert({session_id:e,course_id:j,is_required:b,due_date:S||null}).select().single();if(t)throw t;return s},onSuccess:()=>{T.toast.success("Cours ajouté à la session"),u.invalidateQueries({queryKey:["session-courses",e]}),h(!1),g(""),k(!0),P("")},onError:e=>{T.toast.error(e.message||"Erreur lors de l'ajout du cours")}}),ea=(0,A.useMutation)({mutationFn:async e=>{let{error:s}=await m.from("session_courses").delete().eq("id",e);if(s)throw s},onSuccess:()=>{T.toast.success("Cours retiré de la session"),u.invalidateQueries({queryKey:["session-courses",e]})},onError:e=>{T.toast.error(e.message||"Erreur lors de la suppression du cours")}}),en=(()=>{if(!et?.length||!Z?.length)return{avgProgress:0,completed:0,inProgress:0,notStarted:0,avgScore:null};let e=et.length,s=Math.round(et.reduce((e,s)=>e+s.progress,0)/e),t=et.filter(e=>"completed"===e.status).length,r=et.filter(e=>"in_progress"===e.status).length,a=et.filter(e=>"not_started"===e.status).length,n=et.filter(e=>null!==e.quiz_score);return{avgProgress:s,completed:t,inProgress:r,notStarted:a,avgScore:n.length>0?Math.round(n.reduce((e,s)=>e+(s.quiz_score||0),0)/n.length):null}})(),el=(es||[]).filter(e=>!Z?.some(s=>s.course_id===e.id)),ei=(et||[]).reduce((e,s)=>(e[s.student_id]=e[s.student_id]||{student_id:s.student_id,student_name:s.student_name,courses:[]},e[s.student_id].courses.push(s),e),{});return ee?(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"py-12",children:(0,s.jsx)("div",{className:"flex items-center justify-center",children:(0,s.jsx)(B.Loader2,{className:"h-8 w-8 animate-spin text-muted-foreground"})})})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)(r.Card,{className:"border-purple-200 bg-gradient-to-r from-purple-50/50 to-indigo-50/50",children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(r.CardTitle,{className:"text-lg flex items-center",children:[(0,s.jsx)(q.GraduationCap,{className:"h-5 w-5 mr-2 text-purple-600"}),"E-Learning de la session"]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2 items-center",children:[(0,s.jsxs)("div",{className:"flex rounded-lg border bg-white/70 p-1",children:[(0,s.jsx)("button",{type:"button",className:(0,c.cn)("px-3 py-1 text-sm rounded-md","student"===D?"bg-purple-600 text-white":"text-gray-700"),onClick:()=>F("student"),children:"Suivi nominatif"}),(0,s.jsx)("button",{type:"button",className:(0,c.cn)("px-3 py-1 text-sm rounded-md","course"===D?"bg-purple-600 text-white":"text-gray-700"),onClick:()=>F("course"),children:"Par séquence"})]}),(0,s.jsxs)(a.Button,{onClick:()=>h(!0),disabled:0===el.length,className:"bg-purple-600 hover:bg-purple-700",children:[(0,s.jsx)(L.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une séquence"]})]})]})}),(0,s.jsx)(r.CardContent,{children:(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Assignez des séquences e-learning aux apprenants de cette session et suivez leur progression."})})]}),Z&&Z.length>0&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Séquences"}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:Z.length})]}),(0,s.jsx)(V.BookOpen,{className:"h-8 w-8 text-purple-600 opacity-50"})]})})}),(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Progression moy."}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[en.avgProgress,"%"]})]}),(0,s.jsx)(o.TrendingUp,{className:"h-8 w-8 text-blue-600 opacity-50"})]})})}),(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Terminés"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-green-600",children:en.completed})]}),(0,s.jsx)(v.CheckCircle,{className:"h-8 w-8 text-green-600 opacity-50"})]})})}),(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"En cours"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:en.inProgress})]}),(0,s.jsx)(X.PlayCircle,{className:"h-8 w-8 text-yellow-600 opacity-50"})]})})}),(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Score moy."}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:null!==en.avgScore?`${en.avgScore}%`:"N/A"})]}),(0,s.jsx)(_.BarChart3,{className:"h-8 w-8 text-indigo-600 opacity-50"})]})})})]}),Z&&0!==Z.length?(0,s.jsx)(s.Fragment,{children:"student"===D?(0,s.jsx)("div",{className:"space-y-4",children:d.map(e=>{let t,l,i,d,o,m,u=e.students;if(!u||!e.student_id)return null;let x=e.student_id,h=(l=(t=ei?.[x]?.courses||[]).length?Math.round(t.reduce((e,s)=>e+s.progress,0)/t.length):0,i=t.filter(e=>"completed"===e.status).length,d=t.filter(e=>"in_progress"===e.status).length,o=t.filter(e=>"not_started"===e.status).length,{avgProgress:l,completed:i,inProgress:d,notStarted:o,avgScore:(m=t.filter(e=>null!==e.quiz_score).map(e=>e.quiz_score)).length?Math.round(m.reduce((e,s)=>e+s,0)/m.length):null}),p=M===x,j=ei?.[x]?.courses||[];return(0,s.jsx)(r.Card,{className:"overflow-hidden",children:(0,s.jsxs)(r.CardContent,{className:"p-0",children:[(0,s.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center",children:(0,s.jsx)(C.Users,{className:"h-5 w-5 text-purple-600"})}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsxs)("p",{className:"font-semibold truncate",children:[u.first_name," ",u.last_name]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground truncate",children:u.email})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-6 mr-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Progression"}),(0,s.jsxs)("p",{className:"text-sm font-semibold",children:[h.avgProgress,"%"]})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Terminés"}),(0,s.jsx)("p",{className:"text-sm font-semibold text-green-600",children:h.completed})]}),null!==h.avgScore&&(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Score"}),(0,s.jsxs)("p",{className:"text-sm font-semibold",children:[h.avgScore,"%"]})]})]}),(0,s.jsxs)(a.Button,{variant:"outline",size:"sm",onClick:()=>I(p?null:e.student_id),children:[(0,s.jsx)(f.Eye,{className:"h-4 w-4 mr-2"}),p?"Masquer":"Détails"]})]}),(0,s.jsx)("div",{className:"px-4 pb-4",children:(0,s.jsx)(H.Progress,{value:h.avgProgress,className:"h-2"})}),p&&(0,s.jsx)("div",{className:"border-t bg-gray-50/50 p-4 space-y-2",children:0===j.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune séquence assignée ou aucune progression enregistrée."}):j.map(e=>{let t=Z.find(s=>s.course_id===e.course_id);return(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-sm truncate",children:t?.course?.title||"Séquence"}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.completed_lessons,"/",e.total_lessons," leçons",e.last_activity&&` • Derni\xe8re activit\xe9: ${(0,c.formatDate)(e.last_activity)}`]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"w-24",children:[(0,s.jsx)(H.Progress,{value:e.progress,className:"h-2"}),(0,s.jsxs)("p",{className:"text-xs text-center mt-1",children:[e.progress,"%"]})]}),null!==e.quiz_score&&(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Quiz"}),(0,s.jsxs)("p",{className:"text-sm font-semibold",children:[e.quiz_score,"%"]})]}),(0,s.jsx)(n.Badge,{variant:"completed"===e.status?"default":"in_progress"===e.status?"secondary":"outline",children:"completed"===e.status?"Terminé":"in_progress"===e.status?"En cours":"Non commencé"})]})]},`${e.student_id}-${e.course_id}`)})})]})},e.student_id)})}):(0,s.jsx)("div",{className:"space-y-4",children:Z.map(e=>{let t=e.course;if(!t)return null;let l=(e=>{let s=et?.filter(s=>s.course_id===e)||[];if(!s.length)return{avgProgress:0,completed:0,total:d.length,avgScore:null};let t=Math.round(s.reduce((e,s)=>e+s.progress,0)/s.length),r=s.filter(e=>"completed"===e.status).length,a=s.filter(e=>null!==e.quiz_score),n=a.length>0?Math.round(a.reduce((e,s)=>e+(s.quiz_score||0),0)/a.length):null;return{avgProgress:t,completed:r,total:d.length,avgScore:n}})(e.course_id),i=z===e.id,o=et?.filter(s=>s.course_id===e.course_id)||[];return(0,s.jsx)(r.Card,{className:"overflow-hidden",children:(0,s.jsxs)(r.CardContent,{className:"p-0",children:[(0,s.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[t.thumbnail_url?(0,s.jsx)("img",{src:t.thumbnail_url,alt:t.title,className:"w-16 h-16 rounded-lg object-cover"}):(0,s.jsx)("div",{className:"w-16 h-16 rounded-lg bg-purple-100 flex items-center justify-center",children:(0,s.jsx)(V.BookOpen,{className:"h-8 w-8 text-purple-600"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("h3",{className:"font-semibold",children:t.title}),e.is_required&&(0,s.jsx)(n.Badge,{variant:"secondary",className:"text-xs",children:"Obligatoire"}),(0,s.jsx)(n.Badge,{variant:"outline",className:"text-xs",children:"beginner"===t.difficulty_level?"Débutant":"intermediate"===t.difficulty_level?"Intermédiaire":"Avancé"})]}),t.short_description&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground line-clamp-1",children:t.short_description}),(0,s.jsxs)("div",{className:"flex items-center gap-4 mt-2 text-xs text-muted-foreground",children:[t.estimated_duration_hours&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(p.Clock,{className:"h-3 w-3"}),t.estimated_duration_hours,"h"]}),e.due_date&&(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(w.AlertCircle,{className:"h-3 w-3"}),"Échéance: ",(0,c.formatDate)(e.due_date)]})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-6 mr-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Progression"}),(0,s.jsxs)("p",{className:"text-sm font-semibold",children:[l.avgProgress,"%"]})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Terminés"}),(0,s.jsxs)("p",{className:"text-sm font-semibold text-green-600",children:[l.completed,"/",l.total]})]}),null!==l.avgScore&&(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Score"}),(0,s.jsxs)("p",{className:"text-sm font-semibold",children:[l.avgScore,"%"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)(a.Button,{variant:"ghost",size:"sm",onClick:()=>E(i?null:e.id),children:[(0,s.jsx)(f.Eye,{className:"h-4 w-4 mr-1"}),i?"Masquer":"Détails"]}),(0,s.jsx)(Y.default,{href:`/dashboard/elearning/courses/${t.slug}`,target:"_blank",children:(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",children:(0,s.jsx)(N.ExternalLink,{className:"h-4 w-4"})})}),(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:()=>ea.mutate(e.id),disabled:ea.isPending,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,s.jsx)(K.Trash2,{className:"h-4 w-4"})})]})]}),(0,s.jsx)("div",{className:"px-4 pb-4",children:(0,s.jsx)(H.Progress,{value:l.avgProgress,className:"h-2"})}),i&&(0,s.jsxs)("div",{className:"border-t bg-gray-50/50 p-4",children:[(0,s.jsxs)("h4",{className:"text-sm font-medium mb-3 flex items-center",children:[(0,s.jsx)(C.Users,{className:"h-4 w-4 mr-2"}),"Progression par apprenant"]}),(0,s.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:0===o.length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune donnée de progression disponible"}):o.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1",children:[(0,s.jsx)("div",{className:(0,c.cn)("w-8 h-8 rounded-full flex items-center justify-center","completed"===e.status?"bg-green-100":"in_progress"===e.status?"bg-yellow-100":"bg-gray-100"),children:"completed"===e.status?(0,s.jsx)(v.CheckCircle,{className:"h-4 w-4 text-green-600"}):"in_progress"===e.status?(0,s.jsx)(X.PlayCircle,{className:"h-4 w-4 text-yellow-600"}):(0,s.jsx)(y.XCircle,{className:"h-4 w-4 text-gray-400"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-sm",children:e.student_name}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.completed_lessons,"/",e.total_lessons," leçons",e.last_activity&&` • Derni\xe8re activit\xe9: ${(0,c.formatDate)(e.last_activity)}`]})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("div",{className:"w-24",children:[(0,s.jsx)(H.Progress,{value:e.progress,className:"h-2"}),(0,s.jsxs)("p",{className:"text-xs text-center mt-1",children:[e.progress,"%"]})]}),null!==e.quiz_score&&(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Quiz"}),(0,s.jsxs)("p",{className:"text-sm font-semibold",children:[e.quiz_score,"%"]})]}),(0,s.jsx)(n.Badge,{variant:"completed"===e.status?"default":"in_progress"===e.status?"secondary":"outline",children:"completed"===e.status?"Terminé":"in_progress"===e.status?"En cours":"Non commencé"})]})]},`${e.student_id}-${e.course_id}`))})]})]})},e.id)})})}):(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"py-12",children:(0,s.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,s.jsx)(q.GraduationCap,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),(0,s.jsx)("p",{className:"text-lg font-medium mb-2",children:"Aucune séquence e-learning assignée"}),(0,s.jsx)("p",{className:"text-sm mb-4",children:"Ajoutez des séquences e-learning pour permettre aux apprenants de suivre des cours en ligne."}),el.length>0?(0,s.jsxs)(a.Button,{onClick:()=>h(!0),className:"bg-purple-600 hover:bg-purple-700",children:[(0,s.jsx)(L.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une séquence"]}):(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Aucun cours e-learning disponible."," ",(0,s.jsx)(Y.default,{href:"/dashboard/elearning",className:"text-purple-600 hover:underline",children:"Créer un cours"})]})]})})}),(0,s.jsx)(O.Dialog,{open:x,onOpenChange:h,children:(0,s.jsxs)(O.DialogContent,{children:[(0,s.jsxs)(O.DialogHeader,{children:[(0,s.jsx)(O.DialogTitle,{children:"Ajouter une séquence e-learning"}),(0,s.jsx)(O.DialogDescription,{children:"Sélectionnez une séquence à assigner aux apprenants de cette session."})]}),(0,s.jsxs)("div",{className:"space-y-4 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(G.Label,{children:"Séquence e-learning"}),(0,s.jsxs)(R.Select,{value:j,onValueChange:g,children:[(0,s.jsx)(R.SelectTrigger,{children:(0,s.jsx)(R.SelectValue,{placeholder:"Sélectionner une séquence"})}),(0,s.jsx)(R.SelectContent,{children:el.map(e=>(0,s.jsx)(R.SelectItem,{value:e.id,children:e.title},e.id))})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(Q.Checkbox,{id:"isRequired",checked:b,onCheckedChange:e=>k(e)}),(0,s.jsx)(G.Label,{htmlFor:"isRequired",className:"cursor-pointer",children:"Séquence obligatoire"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(G.Label,{children:"Date limite (optionnel)"}),(0,s.jsx)(l.Input,{type:"date",value:S,onChange:e=>P(e.target.value)})]})]}),(0,s.jsxs)(O.DialogFooter,{children:[(0,s.jsx)(a.Button,{variant:"outline",onClick:()=>h(!1),children:"Annuler"}),(0,s.jsx)(a.Button,{onClick:()=>er.mutate(),disabled:!j||er.isPending,className:"bg-purple-600 hover:bg-purple-700",children:er.isPending?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Ajout..."]}):"Ajouter"})]})]})})]})}var ee=e.i(348572);function es({sessionId:e,sessionData:D,formation:L,program:F,organization:M,enrollments:I=[],grades:H=[],attendanceStats:O,organizationId:R,onShowEnrollmentForm:G,onSwitchToGestion:Q}){let[K,V]=(0,t.useState)(""),[X,W]=(0,t.useState)(null),[es,et]=(0,t.useState)(!1),[er,ea]=(0,t.useState)([]),en=(0,J.createClient)(),el=(0,A.useMutation)({mutationFn:async({studentId:e,studentName:s,studentEmail:t})=>{let r=`${window.location.protocol}//${window.location.host}`;return{studentId:e,studentName:s,studentEmail:t,accessUrl:`${r}/learner/access/${e}`,expiresAt:new Date(Date.now()+2592e6).toISOString()}},onSuccess:e=>{ea(s=>{let t=s.findIndex(s=>s.studentId===e.studentId);if(t>=0){let r=[...s];return r[t]=e,r}return[...s,e]}),T.toast.success(`Lien g\xe9n\xe9r\xe9 pour ${e.studentName}`)},onError:e=>{T.toast.error(e.message)}}),ei=(0,A.useMutation)({mutationFn:async()=>{if(!I?.length)throw Error("Aucun étudiant inscrit à cette session");let e=`${window.location.protocol}//${window.location.host}`,s=I.map(s=>({studentId:s.students.id,studentName:`${s.students.first_name} ${s.students.last_name}`,studentEmail:s.students.email,accessUrl:`${e}/learner/access/${s.students.id}`,expiresAt:new Date(Date.now()+2592e6).toISOString()}));return{tokens:s,count:s.length}},onSuccess:e=>{ea(e.tokens||[]),T.toast.success(`${e.count} liens d'acc\xe8s g\xe9n\xe9r\xe9s avec succ\xe8s`)},onError:e=>{T.toast.error(e.message)}}),ec=async(e,s)=>{try{await navigator.clipboard.writeText(e),T.toast.success(`Lien copi\xe9 pour ${s}`)}catch{T.toast.error("Impossible de copier le lien")}},ed=async()=>{if(0===er.length)return;let e=er.map(e=>`${e.studentName}: ${e.accessUrl}`).join("\n");try{await navigator.clipboard.writeText(e),T.toast.success("Tous les liens ont été copiés")}catch{T.toast.error("Impossible de copier les liens")}},{handleGenerateCertificate:eo}=(0,ee.useDocumentGeneration)({sessionData:D,formation:L,program:F,organization:M}),{data:em,refetch:eu}=(0,$.useQuery)({queryKey:["student-payments",X,e,R],queryFn:async()=>{if(!X||!R)return[];let{data:e,error:s}=await en.from("payments").select("*, invoices(invoice_number, total_amount, status), students(first_name, last_name)").eq("student_id",X).eq("organization_id",R).order("paid_at",{ascending:!1});return s?(console.warn("Error fetching student payments:",s),[]):e||[]},enabled:!!X&&!!R,refetchOnWindowFocus:!0,refetchOnMount:!0}),{data:ex,refetch:eh}=(0,$.useQuery)({queryKey:["student-attendance-details",X,e],queryFn:async()=>{if(!X||!e)return[];let{data:s,error:t}=await en.from("attendance").select("*, session_slots(date, start_time, end_time)").eq("student_id",X).eq("session_id",e).order("created_at",{ascending:!1});return t?(console.warn("Error fetching student attendance:",t),[]):s||[]},enabled:!!X&&!!e,refetchOnWindowFocus:!0,refetchOnMount:!0}),{data:ep,refetch:ej}=(0,$.useQuery)({queryKey:["student-grades-details",X,e],queryFn:async()=>{if(!X||!e)return[];let{data:s,error:t}=await en.from("grades").select("*").eq("student_id",X).eq("session_id",e).order("graded_at",{ascending:!1});return t?(console.warn("Error fetching student grades:",t),[]):s||[]},enabled:!!X&&!!e,refetchOnWindowFocus:!0,refetchOnMount:!0}),eg=I.filter(e=>{if(!K)return!0;let s=e.students;if(!s)return!1;let t=K.toLowerCase();return s.first_name?.toLowerCase().includes(t)||s.last_name?.toLowerCase().includes(t)||s.email?.toLowerCase().includes(t)||s.student_number?.toLowerCase().includes(t)}),ef=I.length,eN=I.filter(e=>"confirmed"===e.status).length,eb=I.filter(e=>"completed"===e.status).length,ev=O&&ef>0?Math.round(O.present/O.total*100):0;if(0===I.length)return(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"py-12",children:(0,s.jsxs)("div",{className:"text-center text-muted-foreground",children:[(0,s.jsx)(d.User,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),(0,s.jsx)("p",{className:"text-lg font-medium mb-2",children:"Aucun apprenant inscrit"}),(0,s.jsx)("p",{className:"text-sm mb-4",children:"Les apprenants inscrits à cette session apparaîtront ici"}),(0,s.jsxs)(a.Button,{variant:"outline",onClick:()=>{Q(),G()},children:[(0,s.jsx)(g.UserPlus,{className:"h-4 w-4 mr-2"}),"Inscrire un apprenant"]})]})})});if(X){let e=I.find(e=>e.student_id===X);if(!e)return W(null),null;let t=e.students;if(!t)return null;let n=ex||[],l=ep||[],g=em||[],f=n.filter(e=>"present"===e.status||"late"===e.status).length,b=n.length,_=b>0?{present:f,total:b}:e.student_id&&O?.byStudent?.[e.student_id]||{present:0,total:0},C=_.total>0?Math.round(_.present/_.total*100):0,q=l.length>0?l:H.filter(s=>s.student_id===e.student_id);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(a.Button,{variant:"ghost",onClick:()=>W(null),children:"← Retour à la liste"}),(0,s.jsxs)("h2",{className:"text-2xl font-bold",children:["Espace Apprenant - ",t.first_name," ",t.last_name]}),(0,s.jsx)("div",{className:"w-24"})," "]}),(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center",children:(0,s.jsx)(d.User,{className:"h-8 w-8 text-primary"})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(r.CardTitle,{className:"text-xl",children:[t.first_name," ",t.last_name]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[t.student_number,t.email&&` • ${t.email}`]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(Y.default,{href:"/learner",target:"_blank",children:(0,s.jsxs)(a.Button,{variant:"outline",size:"sm",children:[(0,s.jsx)(N.ExternalLink,{className:"h-4 w-4 mr-2"}),"Voir son espace"]})}),(0,s.jsx)("span",{className:`px-3 py-1 rounded text-sm ${"completed"===e.status?"bg-brand-blue-ghost text-brand-blue":"confirmed"===e.status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:"completed"===e.status?"Terminé":"confirmed"===e.status?"Confirmé":"En attente"})]})]})})}),D&&(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsx)(r.CardTitle,{className:"text-base",children:"Informations de la session"})}),(0,s.jsx)(r.CardContent,{children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[D.start_date&&(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(h.Calendar,{className:"h-5 w-5 text-brand-blue"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"Dates"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[(0,c.formatDate)(D.start_date),D.end_date&&` - ${(0,c.formatDate)(D.end_date)}`]})]})]}),(D.start_time||D.end_time)&&(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(p.Clock,{className:"h-5 w-5 text-blue-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"Horaires"}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[D.start_time||"N/A",D.end_time&&` - ${D.end_time}`]})]})]}),D.location&&(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(x.MapPin,{className:"h-5 w-5 text-red-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"Lieu"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:D.location})]})]}),L&&(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(m.ClipboardList,{className:"h-5 w-5 text-purple-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"Formation"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:L.name})]})]})]})})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)(r.CardTitle,{className:"text-base flex items-center",children:[(0,s.jsx)(o.TrendingUp,{className:"h-5 w-5 mr-2"}),"Progression"]})}),(0,s.jsx)(r.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-sm font-medium",children:"Taux de présence"}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:[C,"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-3",children:(0,s.jsx)(i.motion.div,{className:"bg-brand-blue h-3 rounded-full transition-all",style:{width:`${C}%`}})}),(0,s.jsxs)("div",{className:"flex items-center justify-between mt-2 text-xs text-muted-foreground",children:[(0,s.jsxs)("span",{children:[_.present," présent",_.present>1?"s":""]}),(0,s.jsxs)("span",{children:[_.total-_.present," absent",_.total-_.present>1?"s":""]})]})]}),q.length>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium mb-3",children:"Notes récentes"}),(0,s.jsx)("div",{className:"space-y-2",children:q.slice(0,5).map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium",children:e.subject}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.assessment_type||"Évaluation"," • ",e.graded_at&&(0,c.formatDate)(e.graded_at)]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"text-sm font-bold",children:[e.score,"/",e.max_score||20]}),null!==e.percentage&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.percentage,"%"]})]})]},e.id))})]})]})})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)(r.CardTitle,{className:"text-base flex items-center",children:[(0,s.jsx)(m.ClipboardList,{className:"h-5 w-5 mr-2"}),"Évaluations"]})}),(0,s.jsx)(r.CardContent,{children:q.length>0?(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mb-3",children:[q.length," évaluation",q.length>1?"s":""," complétée",q.length>1?"s":""]}),(0,s.jsx)("div",{className:"space-y-2",children:q.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(m.ClipboardList,{className:"h-5 w-5 text-brand-blue"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.subject}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:e.graded_at&&(0,c.formatDate)(e.graded_at)})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"font-bold",children:[e.score,"/",e.max_score||20]}),null!==e.percentage&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.percentage,"%"]})]})]},e.id))})]}):(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(m.ClipboardList,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{className:"text-sm",children:"Aucune évaluation complétée pour le moment"})]})})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)(r.CardTitle,{className:"text-base flex items-center",children:[(0,s.jsx)(k.CreditCard,{className:"h-5 w-5 mr-2"}),"Paiements"]})}),(0,s.jsx)(r.CardContent,{children:g.length>0?(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("div",{className:"space-y-2",children:g.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(k.CreditCard,{className:"h-5 w-5 text-brand-blue"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:(0,c.formatCurrency)(e.amount||0,e.currency||"EUR")}),(0,s.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.paid_at?(0,c.formatDate)(e.paid_at):"Date non disponible",e.invoices&&e.invoices.invoice_number&&` • Facture ${e.invoices.invoice_number}`]})]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"completed"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:"completed"===e.status?"Payé":"pending"===e.status?"En attente":e.status}),e.payment_method&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"cash"===e.payment_method?"Espèces":"card"===e.payment_method?"Carte":"bank_transfer"===e.payment_method?"Virement":"sepa"===e.payment_method?"SEPA":e.payment_method})]})]},e.id))}),(0,s.jsx)("div",{className:"pt-3 border-t",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"font-medium",children:"Total payé"}),(0,s.jsx)("span",{className:"font-bold text-lg",children:(0,c.formatCurrency)(g.filter(e=>"completed"===e.status).reduce((e,s)=>e+parseFloat(s.amount||0),0),g[0]?.currency||"EUR")})]})})]}):(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(k.CreditCard,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{className:"text-sm",children:"Aucun paiement enregistré pour le moment"})]})})]}),(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)(r.CardTitle,{className:"text-base flex items-center",children:[(0,s.jsx)(h.Calendar,{className:"h-5 w-5 mr-2"}),"Historique des présences"]})}),(0,s.jsx)(r.CardContent,{children:n.length>0?(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsx)("div",{className:"space-y-2",children:n.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:["present"===e.status?(0,s.jsx)(v.CheckCircle,{className:"h-5 w-5 text-green-600"}):"late"===e.status?(0,s.jsx)(p.Clock,{className:"h-5 w-5 text-yellow-600"}):"excused"===e.status?(0,s.jsx)(w.AlertCircle,{className:"h-5 w-5 text-blue-600"}):(0,s.jsx)(y.XCircle,{className:"h-5 w-5 text-red-600"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"font-medium",children:[e.session_slots?.date?(0,c.formatDate)(e.session_slots.date):"Date non disponible",e.session_slots?.start_time&&e.session_slots?.end_time&&(0,s.jsxs)("span",{className:"text-sm text-muted-foreground ml-2",children:[e.session_slots.start_time," - ",e.session_slots.end_time]})]}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:e.created_at&&(0,c.formatDate)(e.created_at)})]})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"present"===e.status?"bg-green-100 text-green-800":"late"===e.status?"bg-yellow-100 text-yellow-800":"excused"===e.status?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:"present"===e.status?"Présent":"late"===e.status?"En retard":"excused"===e.status?"Excusé":"Absent"})})]},e.id))})}):(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(h.Calendar,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{className:"text-sm",children:"Aucune présence enregistrée pour le moment"})]})})]}),R&&e.student_id&&(0,s.jsx)(U,{studentId:e.student_id,organizationId:R}),(0,s.jsxs)(r.Card,{children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)(r.CardTitle,{className:"text-base flex items-center",children:[(0,s.jsx)(u.Award,{className:"h-5 w-5 mr-2"}),"Certificats"]})}),(0,s.jsx)(r.CardContent,{children:"completed"===e.status?(0,s.jsx)("div",{className:"space-y-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-warning-bg to-brand-cyan-ghost border border-warning-border rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsx)(u.Award,{className:"h-8 w-8 text-brand-cyan"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:"Certificat de formation"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Session terminée avec succès"})]})]}),(0,s.jsxs)(a.Button,{variant:"outline",size:"sm",onClick:()=>eo(e),children:[(0,s.jsx)(j.Download,{className:"h-4 w-4 mr-2"}),"Télécharger"]})]})}):(0,s.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,s.jsx)(u.Award,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{className:"text-sm",children:"Le certificat sera disponible une fois la session terminée"})]})})]})]})}return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{label:"Total apprenants",value:ef,icon:C.Users,iconBg:"bg-gradient-to-br from-brand-blue to-brand-blue-dark",cardBg:"bg-gradient-to-br from-brand-blue/5 via-brand-blue/10 to-brand-cyan/5",borderColor:"border-brand-blue/20",glowColor:"rgba(39, 68, 114, 0.15)"},{label:"Confirmés",value:eN,icon:v.CheckCircle,iconBg:"bg-gradient-to-br from-emerald-500 to-emerald-600",cardBg:"bg-gradient-to-br from-emerald-50 via-emerald-100/50 to-teal-50",borderColor:"border-emerald-200",glowColor:"rgba(16, 185, 129, 0.15)"},{label:"Terminés",value:eb,icon:q.GraduationCap,iconBg:"bg-gradient-to-br from-brand-cyan to-brand-cyan-dark",cardBg:"bg-gradient-to-br from-brand-cyan/5 via-brand-cyan/10 to-brand-blue/5",borderColor:"border-brand-cyan/20",glowColor:"rgba(52, 185, 238, 0.15)"},{label:"Présence moyenne",value:`${ev}%`,icon:_.BarChart3,iconBg:"bg-gradient-to-br from-purple-500 to-purple-600",cardBg:"bg-gradient-to-br from-purple-50 via-purple-100/50 to-pink-50",borderColor:"border-purple-200",glowColor:"rgba(168, 85, 247, 0.15)"}].map((e,t)=>(0,s.jsx)(i.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.05*t,ease:[.16,1,.3,1]},whileHover:{y:-6,scale:1.02},className:"group relative",children:(0,s.jsxs)(i.motion.div,{className:(0,c.cn)("relative overflow-hidden rounded-2xl p-6 border-2 transition-all duration-500 shadow-lg hover:shadow-2xl",e.cardBg,e.borderColor),style:{boxShadow:`0 10px 40px -10px ${e.glowColor}, 0 0 0 1px rgba(255, 255, 255, 0.1)`},children:[(0,s.jsx)(i.motion.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent",initial:{x:"-100%"},whileHover:{x:"100%"},transition:{duration:.6,ease:"easeInOut"}}),(0,s.jsxs)("div",{className:"relative z-10",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,s.jsx)(i.motion.div,{className:(0,c.cn)("p-3.5 rounded-2xl shadow-xl",e.iconBg),whileHover:{rotate:12,scale:1.15},transition:{type:"spring",stiffness:500,damping:15},children:(0,s.jsx)(e.icon,{className:"h-6 w-6 text-white"})}),(0,s.jsxs)(i.motion.div,{className:"text-right",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{delay:.05*t+.2,duration:.5},children:[(0,s.jsx)("div",{className:"text-4xl font-display font-bold tracking-tighter text-gray-900 leading-none mb-1",children:e.value}),(0,s.jsx)("p",{className:"text-xs font-bold text-gray-600 uppercase tracking-widest",children:e.label})]})]}),(0,s.jsx)(i.motion.div,{className:"h-1.5 rounded-full mt-4",style:{background:e.iconBg.replace("bg-gradient-to-br","linear-gradient(to right,")},initial:{scaleX:0},animate:{scaleX:1},transition:{delay:.05*t+.3,duration:.6,ease:[.16,1,.3,1]}})]}),(0,s.jsx)(i.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-500",style:{background:`radial-gradient(circle at 50% 50%, ${e.glowColor} 0%, transparent 70%)`}})]})},e.label))}),(0,s.jsxs)(r.Card,{className:"border-blue-200 bg-gradient-to-r from-blue-50/50 to-indigo-50/50",children:[(0,s.jsx)(r.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(r.CardTitle,{className:"text-base flex items-center",children:[(0,s.jsx)(S,{className:"h-5 w-5 mr-2 text-blue-600"}),"Liens d'accès directs"]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[es&&er.length>0&&(0,s.jsxs)(a.Button,{variant:"outline",size:"sm",onClick:ed,children:[(0,s.jsx)(P.Copy,{className:"h-4 w-4 mr-2"}),"Copier tous"]}),(0,s.jsxs)(a.Button,{variant:es?"secondary":"outline",size:"sm",onClick:()=>et(!es),children:[(0,s.jsx)(E.Share2,{className:"h-4 w-4 mr-2"}),es?"Masquer":"Gérer les liens"]})]})]})}),es&&(0,s.jsx)(r.CardContent,{className:"pt-0",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"text-sm text-muted-foreground bg-white/50 p-3 rounded-lg",children:[(0,s.jsxs)("p",{children:["Générez des liens d'accès personnalisés pour permettre aux stagiaires d'accéder directement à leur espace personnel ",(0,s.jsx)("strong",{children:"sans avoir besoin de se connecter"}),"."]}),(0,s.jsx)("p",{className:"mt-2 text-xs",children:"⏱️ Les liens expirent après 30 jours et peuvent être régénérés à tout moment."})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)(a.Button,{onClick:()=>ei.mutate(),disabled:ei.isPending,className:"bg-blue-600 hover:bg-blue-700",children:[ei.isPending?(0,s.jsx)(B.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,s.jsx)(z.RefreshCw,{className:"h-4 w-4 mr-2"}),"Générer tous les liens"]}),(0,s.jsxs)("span",{className:"text-sm text-muted-foreground",children:["(",I.length," apprenant",I.length>1?"s":"",")"]})]}),(0,s.jsxs)("div",{className:"space-y-2 mt-4",children:[(0,s.jsx)("h4",{className:"text-sm font-medium mb-3",children:"Générer des liens pour chaque apprenant :"}),(0,s.jsx)("div",{className:"max-h-96 overflow-y-auto space-y-2",children:I.map(e=>{let t=e.students;if(!t)return null;let r=er.find(s=>s.studentId===e.student_id),n=`${t.first_name} ${t.last_name}`;return(0,s.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white rounded-lg border",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:(0,s.jsx)(d.User,{className:"h-4 w-4 text-blue-600"})}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"font-medium text-sm truncate",children:n}),t.email&&(0,s.jsx)("p",{className:"text-xs text-muted-foreground truncate max-w-xs",children:t.email})]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2 flex-shrink-0",children:r?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"flex items-center gap-2 min-w-0 max-w-xs",children:(0,s.jsx)("p",{className:"text-xs text-muted-foreground truncate hidden md:block",children:r.accessUrl})}),(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",onClick:()=>ec(r.accessUrl,n),title:"Copier le lien",children:(0,s.jsx)(P.Copy,{className:"h-4 w-4"})}),(0,s.jsx)(a.Button,{variant:"ghost",size:"sm",asChild:!0,title:"Ouvrir le lien",children:(0,s.jsx)("a",{href:r.accessUrl,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsx)(N.ExternalLink,{className:"h-4 w-4"})})}),(0,s.jsx)(a.Button,{variant:"outline",size:"sm",onClick:()=>el.mutate({studentId:e.student_id||"",studentName:n,studentEmail:t.email||""}),disabled:el.isPending,title:"Régénérer le lien",children:el.isPending?(0,s.jsx)(B.Loader2,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(z.RefreshCw,{className:"h-4 w-4"})})]}):(0,s.jsx)(a.Button,{variant:"default",size:"sm",onClick:()=>el.mutate({studentId:e.student_id||"",studentName:n,studentEmail:t.email||""}),disabled:el.isPending,className:"bg-blue-600 hover:bg-blue-700",children:el.isPending?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(B.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Génération..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S,{className:"h-4 w-4 mr-2"}),"Générer"]})})})]},e.student_id)})})]}),0===er.length&&!ei.isPending&&(0,s.jsxs)("div",{className:"text-center py-6 text-muted-foreground",children:[(0,s.jsx)(S,{className:"h-10 w-10 mx-auto mb-3 opacity-30"}),(0,s.jsx)("p",{className:"text-sm",children:"Aucun lien généré pour cette session"}),(0,s.jsx)("p",{className:"text-xs mt-1",children:'Cliquez sur "Générer tous les liens" pour créer les accès'})]})]})})]}),R&&(0,s.jsx)(Z,{sessionId:e,organizationId:R,enrollments:I}),(0,s.jsx)(r.Card,{children:(0,s.jsx)(r.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,s.jsxs)("div",{className:"flex-1 relative",children:[(0,s.jsx)(b.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(l.Input,{placeholder:"Rechercher un apprenant...",value:K,onChange:e=>V(e.target.value),className:"pl-10"})]}),(0,s.jsxs)(a.Button,{variant:"outline",onClick:()=>{Q(),G()},children:[(0,s.jsx)(g.UserPlus,{className:"h-4 w-4 mr-2"}),"Ajouter un apprenant"]})]})})}),(0,s.jsx)("div",{className:"space-y-4",children:0===eg.length?(0,s.jsx)(r.Card,{children:(0,s.jsxs)(r.CardContent,{className:"py-12 text-center text-muted-foreground",children:[(0,s.jsx)(d.User,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),(0,s.jsx)("p",{children:"Aucun apprenant trouvé"})]})}):eg.map(e=>{let t,l=e.students;if(!l)return null;let c=e.student_id&&O?.byStudent?.[e.student_id]||{present:0,total:0},o=c.total>0?Math.round(c.present/c.total*100):0,m=e.student_id?H.filter(s=>s.student_id===e.student_id):[],u=m.length>0?Math.round(m.reduce((e,s)=>e+(null!==s.percentage?s.percentage:(s.score??0)/(s.max_score||20)*100),0)/m.length):null;return(0,s.jsx)(r.Card,{className:"hover:shadow-md transition-shadow",children:(0,s.jsxs)(r.CardContent,{className:"pt-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center",children:(0,s.jsx)(d.User,{className:"h-6 w-6 text-primary"})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,s.jsxs)("h3",{className:"font-semibold text-lg",children:[l.first_name," ",l.last_name]}),(0,s.jsx)(n.Badge,{variant:"completed"===e.status?"default":"confirmed"===e.status?"secondary":"outline",children:"completed"===e.status?"Terminé":"confirmed"===e.status?"Confirmé":"En attente"})]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[l.student_number,l.email&&` • ${l.email}`]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-6 mr-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Présence"}),(0,s.jsxs)("p",{className:"text-sm font-semibold",children:[o,"%"]})]}),null!==u&&(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Moyenne"}),(0,s.jsxs)("p",{className:"text-sm font-semibold",children:[u,"%"]})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("p",{className:"text-xs text-muted-foreground",children:"Évaluations"}),(0,s.jsx)("p",{className:"text-sm font-semibold",children:m.length})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)(a.Button,{variant:"outline",size:"sm",onClick:()=>W(e.student_id),children:[(0,s.jsx)(f.Eye,{className:"h-4 w-4 mr-2"}),"Voir détails"]}),(t=er.find(s=>s.studentId===e.student_id))?(0,s.jsx)("a",{href:t.accessUrl,target:"_blank",rel:"noopener noreferrer",children:(0,s.jsxs)(a.Button,{variant:"outline",size:"sm",children:[(0,s.jsx)(N.ExternalLink,{className:"h-4 w-4 mr-2"}),"Accès direct"]})}):(0,s.jsx)(Y.default,{href:"/learner",target:"_blank",children:(0,s.jsxs)(a.Button,{variant:"outline",size:"sm",children:[(0,s.jsx)(N.ExternalLink,{className:"h-4 w-4 mr-2"}),"Espace apprenant"]})})]})]}),c.total>0&&(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:"Progression de présence"}),(0,s.jsxs)("span",{className:"text-xs text-muted-foreground",children:[c.present,"/",c.total," séances"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)(i.motion.div,{className:`h-2 rounded-full transition-all ${o>=80?"bg-green-500":o>=60?"bg-yellow-500":"bg-red-500"}`,style:{width:`${o}%`}})})]})]})},e.id)})})]})}e.s(["EspaceApprenant",()=>es],486258)}]);