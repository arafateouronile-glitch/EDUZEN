(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let t=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],107233)},871689,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},503116,e=>{"use strict";let t=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],503116)},605631,e=>{"use strict";let t=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],605631)},356909,e=>{"use strict";let t=(0,e.i(475254).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);e.s(["Save",()=>t],356909)},263488,e=>{"use strict";let t=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>t],263488)},738308,e=>{"use strict";let t=(0,e.i(475254).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>t],738308)},127341,e=>{"use strict";var t=e.i(843476),r=e.i(271645),s=e.i(647163);let a=r.createContext(void 0);function i({value:e,defaultValue:i,onValueChange:n,children:o,className:l}){let d=void 0!==e,[c,u]=r.useState(i??"");r.useEffect(()=>{d||void 0===i||u(i)},[i]);let m=d?e:c,h=r.useCallback(e=>{d||u(e),n?.(e)},[d,n]);return(0,t.jsx)(a.Provider,{value:{value:m,onValueChange:h},children:(0,t.jsx)("div",{className:(0,s.cn)("w-full",l),children:o})})}function n(){let e=r.useContext(a);if(!e)throw Error("Tabs components must be used within a Tabs component");return e}function o({children:e,className:r}){return(0,t.jsx)("div",{className:(0,s.cn)("inline-flex h-10 items-center justify-center rounded-lg bg-bg-gray-100 p-1 text-text-tertiary",r),children:e})}function l({value:e,children:r,className:a}){let{value:i,onValueChange:o}=n(),l=i===e;return(0,t.jsx)("button",{type:"button",onClick:()=>o(e),className:(0,s.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-outline-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",l?"bg-white text-text-primary shadow-sm":"text-text-tertiary hover:text-text-primary",a),children:r})}function d({value:e,children:r,className:a}){let{value:i}=n();return i!==e?null:(0,t.jsx)("div",{className:(0,s.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",a),children:r})}e.s(["Tabs",()=>i,"TabsContent",()=>d,"TabsList",()=>o,"TabsTrigger",()=>l])},514764,e=>{"use strict";let t=(0,e.i(475254).default)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);e.s(["Send",()=>t],514764)},246704,779478,e=>{"use strict";var t,r,s=e.i(790224),a=((t={}).AUTH_REQUIRED="AUTH_1001",t.AUTH_INVALID_CREDENTIALS="AUTH_1002",t.AUTH_SESSION_EXPIRED="AUTH_1003",t.AUTH_INSUFFICIENT_PERMISSIONS="AUTH_1004",t.AUTH_2FA_REQUIRED="AUTH_1005",t.AUTH_2FA_INVALID="AUTH_1006",t.VALIDATION_ERROR="VALID_2001",t.VALIDATION_REQUIRED_FIELD="VALID_2002",t.VALIDATION_INVALID_FORMAT="VALID_2003",t.VALIDATION_UNIQUE_CONSTRAINT="VALID_2004",t.DB_CONNECTION_ERROR="DB_3001",t.DB_QUERY_ERROR="DB_3002",t.DB_NOT_FOUND="DB_3003",t.DB_CONSTRAINT_VIOLATION="DB_3004",t.DB_FOREIGN_KEY_CONSTRAINT="DB_3006",t.DB_RLS_POLICY_VIOLATION="DB_3005",t.NETWORK_ERROR="NET_4001",t.API_TIMEOUT="NET_4002",t.API_RATE_LIMIT="NET_4003",t.API_SERVER_ERROR="NET_4004",t.API_NOT_FOUND="NET_4005",t.API_BAD_REQUEST="NET_4006",t.BUSINESS_LOGIC_ERROR="BIZ_5001",t.RESOURCE_LOCKED="BIZ_5002",t.OPERATION_NOT_ALLOWED="BIZ_5003",t.QUOTA_EXCEEDED="BIZ_5004",t.INTERNAL_ERROR="SYS_6001",t.CONFIGURATION_ERROR="SYS_6002",t.SERVICE_UNAVAILABLE="SYS_6003",t);(r={}).LOW="low",r.MEDIUM="medium",r.HIGH="high",r.CRITICAL="critical";class i extends Error{code;severity;userMessage;retryable;context;originalError;constructor(e,t="SYS_6001",r="medium",s={},a){super(e),this.name="AppError",this.code=t,this.severity=r,this.userMessage=s.userMessage||this.getDefaultUserMessage(t),this.retryable=s.retryable??this.isRetryable(t),this.context={...s,code:t,severity:r,timestamp:new Date().toISOString()},this.originalError=a,Error.captureStackTrace&&Error.captureStackTrace(this,i)}getDefaultUserMessage(e){return({AUTH_1001:"Vous devez être connecté pour effectuer cette action.",AUTH_1002:"Email ou mot de passe incorrect.",AUTH_1003:"Votre session a expiré. Veuillez vous reconnecter.",AUTH_1004:"Vous n'avez pas les permissions nécessaires.",AUTH_1005:"Authentification à deux facteurs requise.",AUTH_1006:"Code d'authentification invalide.",VALID_2001:"Les données fournies ne sont pas valides.",VALID_2002:"Certains champs obligatoires sont manquants.",VALID_2003:"Le format des données est incorrect.",VALID_2004:"Cette valeur existe déjà.",DB_3001:"Impossible de se connecter à la base de données.",DB_3002:"Erreur lors de l'exécution de la requête.",DB_3003:"Ressource introuvable.",DB_3004:"Cette opération viole une contrainte de la base de données.",DB_3006:"Cette opération viole une contrainte de clé étrangère.",DB_3005:"Vous n'avez pas accès à cette ressource.",NET_4001:"Erreur de connexion réseau. Vérifiez votre connexion internet.",NET_4002:"La requête a pris trop de temps. Veuillez réessayer.",NET_4003:"Trop de requêtes. Veuillez patienter quelques instants.",NET_4004:"Erreur serveur. Veuillez réessayer plus tard.",NET_4005:"Ressource introuvable.",NET_4006:"Requête invalide.",BIZ_5001:"Cette opération n'est pas autorisée dans le contexte actuel.",BIZ_5002:"Cette ressource est actuellement verrouillée.",BIZ_5003:"Cette opération n'est pas autorisée.",BIZ_5004:"Vous avez atteint la limite autorisée.",SYS_6001:"Une erreur interne est survenue. Veuillez réessayer.",SYS_6002:"Erreur de configuration du système.",SYS_6003:"Service temporairement indisponible."})[e]||"Une erreur inattendue est survenue."}isRetryable(e){return["NET_4001","NET_4002","NET_4004","DB_3001","SYS_6003"].includes(e)}toJSON(){return{name:this.name,message:this.message,code:this.code,severity:this.severity,userMessage:this.userMessage,retryable:this.retryable,context:this.context,stack:this.stack,originalError:this.originalError instanceof Error?{name:this.originalError.name,message:this.originalError.message,stack:this.originalError.stack}:this.originalError}}}let n=new class{handleError(e,t={}){if(e instanceof i)return this.logError(e),e;if(e instanceof Error)return this.handleStandardError(e,t);if(this.isSupabaseError(e))return this.handleSupabaseError(e,t);let r=new i("Une erreur inattendue est survenue.","SYS_6001","high",t,e);return this.logError(r),r}handleStandardError(e,t){let r=e.message.toLowerCase(),s="SYS_6001",a="medium";r.includes("network")||r.includes("fetch")?(s="NET_4001",a="medium"):r.includes("timeout")?(s="NET_4002",a="medium"):r.includes("unauthorized")||r.includes("401")?(s="AUTH_1001",a="high"):r.includes("forbidden")||r.includes("403")?(s="AUTH_1004",a="high"):r.includes("not found")||r.includes("404")?(s="DB_3003",a="low"):(r.includes("validation")||r.includes("invalid"))&&(s="VALID_2001",a="low");let n=new i(e.message,s,a,t,e);return this.logError(n),n}handleSupabaseError(e,t){let r=e.code||e.status,s=e.message||"Erreur Supabase",a=t.code||"DB_3002",n="medium";if(!t.code)switch(r){case"PGRST116":case"42P01":a="DB_3003",n="low";break;case"42501":a="DB_3005",n="high";break;case"23505":a="VALID_2004",n="low";break;case"23503":a="DB_3004",n="medium";break;case"PGRST301":case"400":a="NET_4006",n="low";break;case"401":a="AUTH_1001",n="high";break;case"403":a="AUTH_1004",n="high";break;case"404":a="NET_4005",n="low";break;case"500":a="NET_4004",n="high"}"DB_3006"===a&&(n="medium");let o=new i(s,a,n,t,e);return this.logError(o),o}isSupabaseError(e){return e&&(e.code||e.status||e.message)&&("string"==typeof e.code||"number"==typeof e.status)}logError(e){let t={...e.context,code:e.code,severity:e.severity,retryable:e.retryable};switch(e.severity){case"critical":case"high":s.logger.error(e.message,e.originalError||e,t);break;case"medium":s.logger.warn(e.message,t);break;case"low":s.logger.info(`Error: ${e.message}`,t)}}createValidationError(e,t){return new i(e,"VALID_2001","low",{field:t,userMessage:e})}createAuthError(e,t){return new i(t||"Erreur d'authentification",e,"high")}createDatabaseError(e,t){return new i(e,"DB_3002","medium",{},t)}createNotFoundError(e,t){return new i(e,"DB_3003","low",t)}};e.s(["AppError",()=>i,"ErrorCode",()=>a,"errorHandler",0,n],779478),e.s([],246704)},627404,e=>{"use strict";e.i(246704);var t=e.i(779478);async function r(e,r,s,a){try{let i=e.from(r).select(a?.select||"*").eq("organization_id",s);a?.filters&&Object.entries(a.filters).forEach(([e,t])=>{null!=t&&(i=i.eq(e,t))}),a?.search&&(i=i.ilike(a.search.field,`%${a.search.value}%`)),i=a?.orderBy?i.order(a.orderBy.column,{ascending:a.orderBy.ascending??!1}):i.order("created_at",{ascending:!1});let{data:n,error:o}=await i;if(o)throw t.errorHandler.handleError(o,{organizationId:s,operation:"getAllByOrganization",table:r});return n||[]}catch(e){if(e instanceof t.AppError)throw e;throw t.errorHandler.handleError(e,{organizationId:s,operation:"getAllByOrganization",table:r})}}async function s(e,r,s,a){try{let{data:i,error:n}=await e.from(r).select(a||"*").eq("id",s).single();if(n){if("PGRST116"===n.code||"42P01"===n.code)throw t.errorHandler.handleError(n,{code:t.ErrorCode.DB_NOT_FOUND,operation:"getById",id:s,table:r});throw t.errorHandler.handleError(n,{operation:"getById",id:s,table:r})}if(!i)throw t.errorHandler.createDatabaseError(`Enregistrement avec l'ID ${s} introuvable dans ${r}`,{id:s,table:r});return i}catch(e){if(e instanceof t.AppError)throw e;throw t.errorHandler.handleError(e,{operation:"getById",id:s,table:r})}}e.s(["getAllByOrganization",()=>r,"getById",()=>s])},2034,e=>{"use strict";var t=e.i(920755);let r=async(e,t)=>(console.warn("videoconferenceService.createMeetingForSession not implemented"),null),s=new class{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async getAllSessions(e,t){let r=this.supabase.from("sessions").select(`
        *,
        formations!inner(
          *,
          programs(*)
        )
      `).eq("formations.organization_id",e);t?.formationId&&(r=r.eq("formation_id",t.formationId)),t?.status&&(r=r.eq("status",t.status)),t?.startDate&&(r=r.gte("start_date",t.startDate)),t?.endDate&&(r=r.lte("end_date",t.endDate)),t?.search&&(r=r.ilike("name",`%${t.search}%`));let{data:s,error:a}=await r.order("start_date",{ascending:!0});if(a)throw a;return s}async getSessionById(e){let{data:t,error:r}=await this.supabase.from("sessions").select(`
        *,
        formations!inner(
          *,
          programs(*)
        )
      `).eq("id",e).single();if(r)throw r;let{data:s,error:a}=await this.supabase.from("session_programs").select(`
        program_id,
        programs(*)
      `).eq("session_id",e);if(a)throw a;return{...t,session_programs:s?.map(e=>e.programs).filter(Boolean)||[]}}async createSession(e,t,r){if(e.formation_id){let{data:t,error:r}=await this.supabase.from("formations").select("id, organization_id").eq("id",e.formation_id).single();if(r)throw console.error("Erreur lors de la vérification de la formation:",r),Error(`Formation non trouv\xe9e: ${r.message}`);if(!t)throw Error("Formation non trouvée");console.log("Formation trouvée:",t)}let{data:s,error:a}=await this.supabase.from("sessions").insert(e).select().single();if(a)throw console.error("Erreur RLS lors de la création de la session:",{code:a.code,message:a.message,details:a.details,hint:a.hint,formation_id:e.formation_id}),a;if(t&&t.length>0&&s){let{data:e}=await this.supabase.from("formations").select("organization_id").eq("id",s.formation_id).single();if(e){let r=t.map(t=>({session_id:s.id,program_id:t,organization_id:e.organization_id})),{error:a}=await this.supabase.from("session_programs").insert(r);a&&console.error("Erreur lors de la création des associations session-programme:",a),e.organization_id&&await this.syncWithCalendars(s.id,e.organization_id,"create").catch(e=>{console.error("Erreur lors de la synchronisation calendrier:",e)}),e.organization_id&&await this.createVideoconferenceMeeting(s.id,e.organization_id).catch(e=>{console.error("Erreur lors de la création de la réunion visioconférence:",e)})}}return console.log("Session créée avec succès:",s),s}async updateSessionPrograms(e,t,r){let{error:s}=await this.supabase.from("session_programs").delete().eq("session_id",e);if(s)throw s;if(t.length>0){let s=t.map(t=>({session_id:e,program_id:t,organization_id:r})),{error:a}=await this.supabase.from("session_programs").insert(s);if(a)throw a}return!0}async getSessionPrograms(e){let{data:t,error:r}=await this.supabase.from("session_programs").select(`
        program_id,
        programs(*)
      `).eq("session_id",e);if(r)throw r;return t?.map(e=>e.programs).filter(Boolean)||[]}async updateSession(e,t){let{data:r}=await this.supabase.from("sessions").select("formation_id, formations(organization_id)").eq("id",e).single(),{data:s,error:a}=await this.supabase.from("sessions").update(t).eq("id",e).select().single();if(a)throw a;let i=r?.formations;return r&&i?.organization_id&&await this.syncWithCalendars(e,i.organization_id,"update").catch(e=>{console.error("Erreur lors de la synchronisation calendrier:",e)}),s}async deleteSession(e){let{data:t}=await this.supabase.from("sessions").select("formation_id, formations(organization_id)").eq("id",e).single(),r=t?.formations;t&&r?.organization_id&&await this.syncWithCalendars(e,r.organization_id,"delete").catch(e=>{console.error("Erreur lors de la suppression de l'événement calendrier:",e)});let{error:s}=await this.supabase.from("sessions").delete().eq("id",e);if(s)throw s}async createVideoconferenceMeeting(e,t){let{data:s}=await this.supabase.from("videoconference_integrations").select("*").eq("organization_id",t).eq("is_active",!0).eq("auto_create_meetings",!0);if(s&&0!==s.length)for(let a of s)try{await r(e,{organizationId:t,provider:a.provider})}catch(e){console.error(`Erreur lors de la cr\xe9ation de r\xe9union avec ${a.provider}:`,e)}}async syncWithCalendars(e,t,r){let{data:s}=await this.supabase.from("calendar_integrations").select("*").eq("organization_id",t).eq("is_active",!0).eq("sync_sessions",!0).eq("create_events_for_sessions",!0);if(s&&0!==s.length)for(let e of s)try{console.warn(`Calendar sync for ${r} not implemented yet for provider ${e.provider}`)}catch(t){console.error(`Erreur lors de la synchronisation avec ${e.provider}:`,t)}}async getUpcomingSessions(e,t=10){let r=new Date().toISOString().split("T")[0],{data:s,error:a}=await this.supabase.from("sessions").select(`
        *,
        formations!inner(
          *,
          programs(*)
        )
      `).eq("formations.organization_id",e).gte("start_date",r).eq("status","planned").order("start_date",{ascending:!0}).limit(t);if(a)throw a;return s}async getOngoingSessions(e){let t=new Date().toISOString().split("T")[0],{data:r,error:s}=await this.supabase.from("sessions").select(`
        *,
        formations!inner(
          *,
          programs(*)
        )
      `).eq("formations.organization_id",e).lte("start_date",t).gte("end_date",t).eq("status","ongoing").order("start_date",{ascending:!0});if(s)throw s;return r}async addSessionToFormations(e,t,r){let s=t.map((t,s)=>({session_id:e,formation_id:t,organization_id:r,order_index:s})),{data:a,error:i}=await this.supabase.from("formation_sessions").insert(s).select();if(i)throw i;return a}async removeSessionFromFormation(e,t){let{error:r}=await this.supabase.from("formation_sessions").delete().eq("session_id",e).eq("formation_id",t);if(r)throw r;return!0}async updateSessionFormations(e,t,r){let{error:s}=await this.supabase.from("formation_sessions").delete().eq("session_id",e);if(s)throw s;return t.length>0?this.addSessionToFormations(e,t,r):[]}async getSessionFormations(e){let{data:t,error:r}=await this.supabase.from("formation_sessions").select(`
        formation_id,
        order_index,
        formations(*)
      `).eq("session_id",e).order("order_index",{ascending:!0});if(r)throw r;return t?.map(e=>e.formations).filter(Boolean)||[]}async getFormationSessions(e){let{data:t,error:r}=await this.supabase.from("formation_sessions").select(`
        session_id,
        order_index,
        sessions(*)
      `).eq("formation_id",e).order("order_index",{ascending:!0});if(r)throw r;return t?.map(e=>e.sessions).filter(Boolean)||[]}async createIndependentSession(e,t,r){let{data:s,error:a}=await this.supabase.from("sessions").insert({...e,formation_id:null}).select().single();if(a)throw a;return t&&t.length>0&&s&&await this.updateSessionPrograms(s.id,t,e.organization_id),r&&r.length>0&&s&&await this.addSessionToFormations(s.id,r,e.organization_id),s}};e.s(["sessionService",0,s],2034)},625959,e=>{"use strict";var t=e.i(843476),r=e.i(271645),s=e.i(647163),a=e.i(643531);let i=r.forwardRef(({className:e,checked:r,onCheckedChange:i,...n},o)=>(0,t.jsxs)("div",{className:"relative inline-flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",ref:o,checked:r,onChange:e=>i?.(e.target.checked),className:(0,s.cn)("peer h-4 w-4 shrink-0 rounded border border-gray-300","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-blue focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","cursor-pointer",r&&"border-brand-blue bg-brand-blue",e),...n}),r&&(0,t.jsx)(a.Check,{className:"absolute h-3 w-3 text-white pointer-events-none left-0.5 top-0.5"})]}));i.displayName="Checkbox",e.s(["Checkbox",()=>i])},781947,e=>{"use strict";var t=e.i(843476),r=e.i(271645),s=e.i(225913),a=e.i(647163);let i=(0,s.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),n=r.forwardRef(({className:e,variant:r,...s},n)=>(0,t.jsx)("div",{ref:n,role:"alert",className:(0,a.cn)(i({variant:r}),e),...s}));n.displayName="Alert",r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("h5",{ref:s,className:(0,a.cn)("mb-1 font-medium leading-none tracking-tight",e),...r})).displayName="AlertTitle";let o=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("div",{ref:s,className:(0,a.cn)("text-sm [&_p]:leading-relaxed",e),...r}));o.displayName="AlertDescription",e.s(["Alert",()=>n,"AlertDescription",()=>o])},303054,e=>{"use strict";var t=e.i(65433),r=e.i(307703);function s(e){(0,r.default)(1,arguments);var s=(0,t.default)(e),a=s.getMonth();return s.setFullYear(s.getFullYear(),a+1,0),s.setHours(23,59,59,999),s}e.s(["default",()=>s])},576844,e=>{"use strict";var t=e.i(109432),r=e.i(65433),s=e.i(307703);function a(e,t){(0,s.default)(2,arguments);var a=(0,r.default)(e),i=(0,r.default)(t),n=a.getTime()-i.getTime();return n<0?-1:n>0?1:n}var i=e.i(303054),n={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}},o=e.i(735150);function l(e,t){if(null==e)throw TypeError("assign requires that input parameter not be null or undefined");for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}var d=e.i(402335);function c(e,c){return(0,s.default)(1,arguments),function(e,c,u){(0,s.default)(2,arguments);var m,h,f,g,p,x=(0,t.getDefaultOptions)(),_=null!=(m=null!=(h=null==u?void 0:u.locale)?h:x.locale)?m:o.default;if(!_.formatDistance)throw RangeError("locale must contain formatDistance property");var v=a(e,c);if(isNaN(v))throw RangeError("Invalid time value");var b=l(l({},u),{addSuffix:!!(null==u?void 0:u.addSuffix),comparison:v});v>0?(f=(0,r.default)(c),g=(0,r.default)(e)):(f=(0,r.default)(e),g=(0,r.default)(c));var y=function(e,t,a){(0,s.default)(2,arguments);var i,o=function(e,t){return(0,s.default)(2,arguments),(0,r.default)(e).getTime()-(0,r.default)(t).getTime()}(e,t)/1e3;return((i=null==a?void 0:a.roundingMethod)?n[i]:n.trunc)(o)}(g,f),j=Math.round((y-((0,d.default)(g)-(0,d.default)(f))/1e3)/60);if(j<2)if(null!=u&&u.includeSeconds)if(y<5)return _.formatDistance("lessThanXSeconds",5,b);else if(y<10)return _.formatDistance("lessThanXSeconds",10,b);else if(y<20)return _.formatDistance("lessThanXSeconds",20,b);else if(y<40)return _.formatDistance("halfAMinute",0,b);else if(y<60)return _.formatDistance("lessThanXMinutes",1,b);else return _.formatDistance("xMinutes",1,b);else if(0===j)return _.formatDistance("lessThanXMinutes",1,b);else return _.formatDistance("xMinutes",j,b);if(j<45)return _.formatDistance("xMinutes",j,b);if(j<90)return _.formatDistance("aboutXHours",1,b);if(j<1440){var w=Math.round(j/60);return _.formatDistance("aboutXHours",w,b)}if(j<2520)return _.formatDistance("xDays",1,b);else if(j<43200){var N=Math.round(j/1440);return _.formatDistance("xDays",N,b)}else if(j<86400)return p=Math.round(j/43200),_.formatDistance("aboutXMonths",p,b);if((p=function(e,t){(0,s.default)(2,arguments);var n,o=(0,r.default)(e),l=(0,r.default)(t),d=a(o,l),c=Math.abs(function(e,t){(0,s.default)(2,arguments);var a=(0,r.default)(e),i=(0,r.default)(t);return 12*(a.getFullYear()-i.getFullYear())+(a.getMonth()-i.getMonth())}(o,l));if(c<1)n=0;else{1===o.getMonth()&&o.getDate()>27&&o.setDate(30),o.setMonth(o.getMonth()-d*c);var u=a(o,l)===-d;(function(e){(0,s.default)(1,arguments);var t=(0,r.default)(e);return(function(e){(0,s.default)(1,arguments);var t=(0,r.default)(e);return t.setHours(23,59,59,999),t})(t).getTime()===(0,i.default)(t).getTime()})((0,r.default)(e))&&1===c&&1===a(e,l)&&(u=!1),n=d*(c-Number(u))}return 0===n?0:n}(g,f))<12){var E=Math.round(j/43200);return _.formatDistance("xMonths",E,b)}var T=p%12,S=Math.floor(p/12);return T<3?_.formatDistance("aboutXYears",S,b):T<9?_.formatDistance("overXYears",S,b):_.formatDistance("almostXYears",S+1,b)}(e,Date.now(),c)}e.s(["formatDistanceToNow",()=>c],576844)},849200,e=>{"use strict";var t=e.i(920755);e.i(246704);var r=e.i(779478),s=e.i(790224),a=e.i(627404);let i=new class{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async getAll(e,t){try{let r={};return t?.studentId&&(r.student_id=t.studentId),t?.classId&&(r.class_id=t.classId),t?.programSessionId&&(r.session_id=t.programSessionId),t?.date&&(r.date=t.date),t?.status&&(r.status=t.status),(0,a.getAllByOrganization)(this.supabase,"attendance",e,{select:"*, students(id, first_name, last_name, student_number), classes(id, name), sessions(id, title, start_time)",filters:r,orderBy:{column:"date",ascending:!1}})}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{organizationId:e,operation:"getAll"})}}async getByClassAndDate(e,t){try{let{data:s,error:a}=await this.supabase.from("attendance").select("*, students(id, first_name, last_name, student_number)").eq("class_id",e).eq("date",t).order("students(last_name)",{ascending:!0});if(a)throw r.errorHandler.handleError(a,{operation:"getByClassAndDate",classId:e,date:t});return s||[]}catch(s){if(s instanceof r.AppError)throw s;throw r.errorHandler.handleError(s,{operation:"getByClassAndDate",classId:e,date:t})}}async getBySessionAndDate(e,t){try{let{data:s,error:a}=await this.supabase.from("attendance").select("*, students(id, first_name, last_name, student_number)").eq("session_id",e).eq("date",t).order("students(last_name)",{ascending:!0});if(a)throw r.errorHandler.handleError(a,{operation:"getBySessionAndDate",sessionId:e,date:t});return s||[]}catch(s){if(s instanceof r.AppError)throw s;throw r.errorHandler.handleError(s,{operation:"getBySessionAndDate",sessionId:e,date:t})}}async upsert(e){if(e.session_id&&(e.latitude||e.longitude)){let t=await this.validateLocation(e.session_id,e.latitude,e.longitude);if(!t.valid)throw r.errorHandler.createValidationError(t.error||"Localisation invalide","location");e.location_verified=t.verified}try{let{data:t,error:a}=await this.supabase.from("attendance").upsert(e,{onConflict:"student_id,class_id,session_id,date"}).select().single();if(a){if("42501"===a.code)throw r.errorHandler.handleError(a,{code:r.ErrorCode.DB_RLS_POLICY_VIOLATION,operation:"upsert"});throw r.errorHandler.handleError(a,{operation:"upsert",attendance:e})}return s.logger.info("Émargement créé/mis à jour avec succès",{id:t?.id,studentId:e.student_id,date:e.date}),t}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"upsert",attendance:e})}}async validateLocation(e,t,r){if(!t||!r)return{valid:!1,verified:!1,error:"Coordonnées GPS manquantes"};let{data:s,error:a}=await this.supabase.from("sessions").select("latitude, longitude, require_location_for_attendance, allowed_attendance_radius_meters").eq("id",e).single();if(a||!s)return{valid:!1,verified:!1,error:"Session non trouvée"};if(!s.require_location_for_attendance)return{valid:!0,verified:!1};if(!s.latitude||!s.longitude)return{valid:!0,verified:!1,error:"Session sans coordonnées GPS"};let i=this.calculateDistance(s.latitude,s.longitude,t,r);return s.allowed_attendance_radius_meters&&i>s.allowed_attendance_radius_meters?{valid:!1,verified:!1,error:`Vous \xeates trop loin de la session (${Math.round(i)}m, maximum: ${s.allowed_attendance_radius_meters}m)`,distance:i}:{valid:!0,verified:!0,distance:i}}calculateDistance(e,t,r,s){let a=e*Math.PI/180,i=r*Math.PI/180,n=(r-e)*Math.PI/180,o=(s-t)*Math.PI/180,l=Math.sin(n/2)*Math.sin(n/2)+Math.cos(a)*Math.cos(i)*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3}async update(e,t){try{let{data:a,error:i}=await this.supabase.from("attendance").update(t).eq("id",e).select().single();if(i){if("PGRST116"===i.code||"42P01"===i.code)throw r.errorHandler.handleError(i,{code:r.ErrorCode.DB_NOT_FOUND,operation:"update",id:e});if("42501"===i.code)throw r.errorHandler.handleError(i,{code:r.ErrorCode.DB_RLS_POLICY_VIOLATION,operation:"update",id:e});throw r.errorHandler.handleError(i,{operation:"update",id:e,updates:t})}if(!a)throw r.errorHandler.createDatabaseError(`\xc9margement avec l'ID ${e} introuvable pour la mise \xe0 jour`,{id:e});return s.logger.info("Émargement mis à jour avec succès",{id:e,updates:t}),a}catch(s){if(s instanceof r.AppError)throw s;throw r.errorHandler.handleError(s,{operation:"update",id:e,updates:t})}}async markMultiple(e,t){let a=t.map(t=>({organization_id:e,...t,late_minutes:t.late_minutes||0}));try{if(!t||0===t.length)throw r.errorHandler.createValidationError("Aucun enregistrement à marquer","records");let{data:i,error:n}=await this.supabase.from("attendance").upsert(a,{onConflict:"student_id,class_id,session_id,date"}).select();if(n)throw r.errorHandler.handleError(n,{operation:"markMultiple",organizationId:e,count:t.length});return s.logger.info("Présences marquées en masse avec succès",{organizationId:e,count:i?.length||0}),i||[]}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"markMultiple",organizationId:e})}}async getStudentStats(e,t,s){let a=this.supabase.from("attendance").select("status, date").eq("student_id",e);t&&(a=a.gte("date",t)),s&&(a=a.lte("date",s));try{let{data:e,error:t}=await a;if(t)throw t;let r=e?.length||0,s=e?.filter(e=>"present"===e.status).length||0,i=e?.filter(e=>"absent"===e.status).length||0,n=e?.filter(e=>"late"===e.status).length||0,o=e?.filter(e=>"excused"===e.status).length||0;return{total:r,present:s,absent:i,late:n,excused:o,attendanceRate:r>0?s/r*100:0}}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"getStudentStats",studentId:e})}}async getClassStats(e,t){let s=this.supabase.from("attendance").select("status").eq("class_id",e);t&&(s=s.eq("date",t));try{let{data:a,error:i}=await s;if(i)throw r.errorHandler.handleError(i,{operation:"getClassStats",classId:e,date:t});let n=a?.length||0,o=a?.filter(e=>"present"===e.status).length||0,l=a?.filter(e=>"absent"===e.status).length||0;return{total:n,present:o,absent:l,attendanceRate:n>0?o/n*100:0}}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"getClassStats",classId:e})}}async saveTeacherSignature(e,t){return this.update(e,{teacher_signature_url:t})}};e.s(["attendanceService",0,i])},262478,424407,e=>{"use strict";var t=e.i(843476),r=e.i(271645),s=e.i(167881),a=e.i(970065),i=e.i(781947),n=e.i(994179),o=e.i(630374),l=e.i(23750),d=e.i(10708),c=e.i(625959),u=e.i(647163);let m=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:s,className:(0,u.cn)("w-full caption-bottom text-sm",e),...r})}));m.displayName="Table";let h=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("thead",{ref:s,className:(0,u.cn)("[&_tr]:border-b",e),...r}));h.displayName="TableHeader";let f=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("tbody",{ref:s,className:(0,u.cn)("[&_tr:last-child]:border-0",e),...r}));f.displayName="TableBody",r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("tfoot",{ref:s,className:(0,u.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...r})).displayName="TableFooter";let g=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("tr",{ref:s,className:(0,u.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...r}));g.displayName="TableRow";let p=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("th",{ref:s,className:(0,u.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...r}));p.displayName="TableHead";let x=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("td",{ref:s,className:(0,u.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...r}));x.displayName="TableCell",r.forwardRef(({className:e,...r},s)=>(0,t.jsx)("caption",{ref:s,className:(0,u.cn)("mt-4 text-sm text-muted-foreground",e),...r})).displayName="TableCaption";var _=e.i(629377),v=e.i(107233),b=e.i(514764),y=e.i(605631),j=e.i(263488),w=e.i(346897),N=e.i(440160),E=e.i(576844),T=e.i(587470);function S({sessionId:e,organizationId:u}){let[S,C]=(0,r.useState)([]),[D,A]=(0,r.useState)(!0),[I,R]=(0,r.useState)(null),[q,M]=(0,r.useState)(!1),[B,k]=(0,r.useState)(!1),[O,L]=(0,r.useState)({title:"",date:new Date().toISOString().split("T")[0],startTime:"",endTime:"",requireGeolocation:!1,allowedRadiusMeters:100});(0,r.useEffect)(()=>{H()},[e]);let H=async()=>{try{A(!0),R(null);let t=await fetch(`/api/electronic-attendance/sessions?sessionId=${e}`);if(!t.ok)throw Error("Erreur lors du chargement");let r=await t.json();C(r)}catch(e){R(e instanceof Error?e.message:"Erreur inconnue")}finally{A(!1)}},z=async()=>{try{k(!0),R(null);let t=await fetch("/api/electronic-attendance/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,organizationId:u,title:O.title,date:O.date,startTime:O.startTime||null,endTime:O.endTime||null,mode:"electronic",requireGeolocation:O.requireGeolocation,allowedRadiusMeters:O.allowedRadiusMeters})});if(!t.ok){let e=await t.json();throw Error(e.error||"Erreur lors de la création")}M(!1),L({title:"",date:new Date().toISOString().split("T")[0],startTime:"",endTime:"",requireGeolocation:!1,allowedRadiusMeters:100}),H()}catch(e){R(e instanceof Error?e.message:"Erreur inconnue")}finally{k(!1)}},U=async e=>{if(confirm("Voulez-vous lancer cette session d'émargement ? Des emails seront envoyés à tous les apprenants inscrits."))try{let t=await fetch(`/api/electronic-attendance/sessions/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"launch",sendEmails:!0})});if(!t.ok){let e=await t.json();throw Error(e.error||"Erreur lors du lancement")}H()}catch(e){R(e instanceof Error?e.message:"Erreur inconnue")}},V=async e=>{if(confirm("Voulez-vous fermer cette session d'émargement ? Les demandes non signées seront marquées comme expirées."))try{let t=await fetch(`/api/electronic-attendance/sessions/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"close"})});if(!t.ok){let e=await t.json();throw Error(e.error||"Erreur lors de la fermeture")}H()}catch(e){R(e instanceof Error?e.message:"Erreur inconnue")}},P=async e=>{try{let t=await fetch(`/api/electronic-attendance/requests/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"remind"})});if(!t.ok){let e=await t.json();throw Error(e.error||"Erreur lors de l'envoi du rappel")}alert("Rappel envoyé avec succès")}catch(e){R(e instanceof Error?e.message:"Erreur inconnue")}},F=e=>{switch(e){case"draft":return(0,t.jsx)(n.Badge,{variant:"secondary",children:"Brouillon"});case"active":return(0,t.jsx)(n.Badge,{className:"bg-green-500",children:"Active"});case"closed":return(0,t.jsx)(n.Badge,{variant:"outline",children:"Fermée"});case"cancelled":return(0,t.jsx)(n.Badge,{variant:"destructive",children:"Annulée"});case"signed":return(0,t.jsx)(n.Badge,{className:"bg-green-500",children:"Signé"});case"pending":return(0,t.jsx)(n.Badge,{variant:"secondary",children:"En attente"});case"expired":return(0,t.jsx)(n.Badge,{variant:"outline",children:"Expiré"});default:return(0,t.jsx)(n.Badge,{children:e})}};return D&&0===S.length?(0,t.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,t.jsx)(_.Loader2,{className:"h-6 w-6 animate-spin"})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(a.Card,{children:(0,t.jsx)(a.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Gestion des émargements"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Deux modes d'émargement sont disponibles pour vos sessions de formation :"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)("div",{className:"p-4 border rounded-lg bg-blue-50 border-blue-200",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(y.CheckCircle,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold text-blue-900 mb-1",children:"Émargement manuel"}),(0,t.jsx)("p",{className:"text-sm text-blue-700",children:"Cochez directement les présences, absences et retards depuis l'interface. Idéal pour les formations en présentiel avec contrôle direct."})]})]})}),(0,t.jsx)("div",{className:"p-4 border rounded-lg bg-green-50 border-green-200",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(j.Mail,{className:"h-5 w-5 text-green-600 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold text-green-900 mb-1",children:"Émargement numérique"}),(0,t.jsx)("p",{className:"text-sm text-green-700",children:"Envoyez automatiquement des demandes d'émargement par email avec signature électronique. Support de la géolocalisation pour valider la présence physique."})]})]})})]})]})})}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Sessions d'émargement numérique"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Créez et gérez les sessions d'émargement avec envoi d'emails automatiques aux apprenants"})]}),(0,t.jsxs)(o.Dialog,{open:q,onOpenChange:M,children:[(0,t.jsx)(o.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(s.Button,{children:[(0,t.jsx)(v.Plus,{className:"h-4 w-4 mr-2"}),"Nouvelle session"]})}),(0,t.jsxs)(o.DialogContent,{children:[(0,t.jsxs)(o.DialogHeader,{children:[(0,t.jsx)(o.DialogTitle,{children:"Nouvelle session d'émargement numérique"}),(0,t.jsx)(o.DialogDescription,{children:"Créez une session d'émargement avec envoi automatique d'emails aux apprenants inscrits"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"title",children:"Titre *"}),(0,t.jsx)(l.Input,{id:"title",value:O.title,onChange:e=>L({...O,title:e.target.value}),placeholder:"Ex: Émargement du 15 janvier"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"date",children:"Date *"}),(0,t.jsx)(l.Input,{id:"date",type:"date",value:O.date,onChange:e=>L({...O,date:e.target.value})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"startTime",children:"Heure de début"}),(0,t.jsx)(l.Input,{id:"startTime",type:"time",value:O.startTime,onChange:e=>L({...O,startTime:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"endTime",children:"Heure de fin"}),(0,t.jsx)(l.Input,{id:"endTime",type:"time",value:O.endTime,onChange:e=>L({...O,endTime:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(c.Checkbox,{id:"requireGeolocation",checked:O.requireGeolocation,onCheckedChange:e=>L({...O,requireGeolocation:e})}),(0,t.jsx)(d.Label,{htmlFor:"requireGeolocation",className:"cursor-pointer",children:"Exiger la géolocalisation"})]}),O.requireGeolocation&&(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"allowedRadiusMeters",children:"Rayon autorisé (mètres)"}),(0,t.jsx)(l.Input,{id:"allowedRadiusMeters",type:"number",min:"10",value:O.allowedRadiusMeters,onChange:e=>L({...O,allowedRadiusMeters:parseInt(e.target.value)||100})})]})]}),(0,t.jsxs)(o.DialogFooter,{children:[(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>M(!1),disabled:B,children:"Annuler"}),(0,t.jsxs)(s.Button,{onClick:z,disabled:B||!O.title,children:[B&&(0,t.jsx)(_.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Créer"]})]})]})]})]}),I&&(0,t.jsx)(i.Alert,{variant:"destructive",children:(0,t.jsx)(i.AlertDescription,{children:I})}),0===S.length?(0,t.jsx)(a.Card,{children:(0,t.jsxs)(a.CardContent,{className:"flex flex-col items-center justify-center p-8 text-center",children:[(0,t.jsx)("p",{className:"text-gray-500",children:"Aucune session d'émargement"}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Créez une session pour commencer à gérer les émargements"})]})}):(0,t.jsx)("div",{className:"space-y-4",children:S.map(e=>(0,t.jsxs)(a.Card,{children:[(0,t.jsx)(a.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(a.CardTitle,{className:"text-base",children:e.title}),(0,t.jsxs)(a.CardDescription,{children:[new Date(e.date).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),e.start_time&&` • ${e.start_time}`,e.require_geolocation&&(0,t.jsxs)("span",{className:"inline-flex items-center ml-2",children:[(0,t.jsx)(w.MapPin,{className:"h-3 w-3 mr-1"}),"Géolocalisation requise"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[F(e.status),(0,t.jsxs)(n.Badge,{variant:"outline",children:[e.total_signed,"/",e.total_expected]})]})]})}),(0,t.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["draft"===e.status&&(0,t.jsxs)(s.Button,{onClick:()=>U(e.id),size:"sm",children:[(0,t.jsx)(b.Send,{className:"h-4 w-4 mr-2"}),"Lancer"]}),"active"===e.status&&(0,t.jsx)(s.Button,{onClick:()=>V(e.id),size:"sm",variant:"outline",children:"Fermer"}),(0,t.jsxs)(s.Button,{size:"sm",variant:"outline",children:[(0,t.jsx)(N.Download,{className:"h-4 w-4 mr-2"}),"Exporter"]})]}),e.requests&&e.requests.length>0&&(0,t.jsx)("div",{className:"border rounded-lg",children:(0,t.jsxs)(m,{children:[(0,t.jsx)(h,{children:(0,t.jsxs)(g,{children:[(0,t.jsx)(p,{children:"Apprenant"}),(0,t.jsx)(p,{children:"Email"}),(0,t.jsx)(p,{children:"Statut"}),(0,t.jsx)(p,{children:"Date de signature"}),(0,t.jsx)(p,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(f,{children:e.requests.map(e=>(0,t.jsxs)(g,{children:[(0,t.jsx)(x,{className:"font-medium",children:e.student_name}),(0,t.jsx)(x,{children:e.student_email}),(0,t.jsx)(x,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[F(e.status),e.location_verified&&(0,t.jsx)("span",{title:"Position vérifiée",children:(0,t.jsx)(w.MapPin,{className:"h-3 w-3 text-green-500"})})]})}),(0,t.jsx)(x,{children:e.signed_at?(0,E.formatDistanceToNow)(new Date(e.signed_at),{addSuffix:!0,locale:T.fr}):"-"}),(0,t.jsx)(x,{className:"text-right",children:"pending"===e.status&&(0,t.jsx)(s.Button,{size:"sm",variant:"ghost",onClick:()=>P(e.id),children:(0,t.jsx)(j.Mail,{className:"h-4 w-4"})})})]},e.id))})]})})]})]},e.id))})]})}e.s(["ElectronicAttendanceManager",()=>S],424407),e.s([],262478)},220890,e=>{"use strict";var t=e.i(843476),r=e.i(618566),s=e.i(266027),a=e.i(954616),i=e.i(920755),n=e.i(849200),o=e.i(2034),l=e.i(325715),d=e.i(167881),c=e.i(970065),u=e.i(871689),m=e.i(356909),h=e.i(605631),f=e.i(738308),g=e.i(503116),p=e.i(898791),x=e.i(87316),_=e.i(522016),v=e.i(647163),b=e.i(271645);e.i(262478);var y=e.i(424407),j=e.i(127341);function w(){let e=(0,r.useParams)(),w=(0,r.useSearchParams)();(0,r.useRouter)();let N=e.id,E=w.get("date")||new Date().toISOString().split("T")[0],{user:T}=(0,l.useAuth)(),S=(0,i.createClient)(),{data:C,isLoading:D}=(0,s.useQuery)({queryKey:["session",N],queryFn:()=>o.sessionService.getSessionById(N),enabled:!!N}),{data:A,isLoading:I}=(0,s.useQuery)({queryKey:["session-enrollments",N],queryFn:async()=>{let{data:e,error:t}=await S.from("enrollments").select("*, students(*)").eq("session_id",N).in("status",["confirmed","completed"]).order("students(last_name)",{ascending:!0});if(t)throw t;return(e||[]).map(e=>({...e,students:e.students||void 0}))},enabled:!!N}),{data:R,refetch:q}=(0,s.useQuery)({queryKey:["attendance-session",N,E],queryFn:async()=>(await n.attendanceService.getBySessionAndDate(N,E)).map(e=>({...e,students:e.students||void 0})),enabled:!!N}),[M,B]=(0,b.useState)({});(0,b.useEffect)(()=>{if(R&&Array.isArray(R)&&A){let e={};for(let t of R)t.student_id&&(e[t.student_id]={status:t.status,lateMinutes:t.late_minutes??void 0,notes:t.notes||""});A.forEach(t=>{let r=t.student_id;r&&!e[r]&&(e[r]={status:"present",lateMinutes:0,notes:""})}),B(e)}else if(A&&Array.isArray(A)){let e={};for(let t of A)t.student_id&&(e[t.student_id]={status:"present",lateMinutes:0,notes:""});B(e)}},[R,A]);let k=(e,t,r)=>{B(s=>({...s,[e]:{...s[e],[t]:r}}))},O=(0,a.useMutation)({mutationFn:async()=>{if(!T?.organization_id||!A)throw Error("Données manquantes");let e=A.filter(e=>e.student_id).map(e=>({student_id:e.student_id,session_id:N,date:E,status:M[e.student_id]?.status||"present",late_minutes:M[e.student_id]?.lateMinutes||0,teacher_id:T.id,notes:M[e.student_id]?.notes||void 0}));return n.attendanceService.markMultiple(T.organization_id,e)},onSuccess:()=>{q()}}),L=A?.map(e=>e.students).filter(Boolean)||[],H=L.length>0?{total:L.length,present:Object.values(M).filter(e=>"present"===e.status).length,absent:Object.values(M).filter(e=>"absent"===e.status).length,late:Object.values(M).filter(e=>"late"===e.status).length,excused:Object.values(M).filter(e=>"excused"===e.status).length}:null;if(D||I)return(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsx)("div",{className:"text-center",children:(0,t.jsx)("div",{className:"text-muted-foreground",children:"Chargement..."})})});if(!C)return(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-muted-foreground",children:"Session non trouvée"}),(0,t.jsx)(_.default,{href:"/dashboard/sessions",children:(0,t.jsx)(d.Button,{className:"mt-4",children:"Retour à la liste des sessions"})})]})});let z=C?.formations,U=z?.programs;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)(_.default,{href:`/dashboard/sessions/${N}`,children:(0,t.jsx)(d.Button,{variant:"ghost",size:"icon",children:(0,t.jsx)(u.ArrowLeft,{className:"h-4 w-4"})})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-3xl font-bold text-gray-900",children:["Émargement - ",C?.name||"Session"]}),(0,t.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:[z&&(0,t.jsx)(_.default,{href:`/dashboard/formations/${z?.id}`,className:"text-primary hover:underline",children:z?.name}),U&&(0,t.jsxs)(t.Fragment,{children:[" • ",(0,t.jsx)(_.default,{href:`/dashboard/programs/${U?.id}`,className:"text-primary hover:underline",children:U?.name})]})," - ",(0,t.jsxs)("span",{className:"flex items-center inline-flex mt-1",children:[(0,t.jsx)(x.Calendar,{className:"mr-1 h-3 w-3"}),(0,v.formatDate)(E)]}),C?.location&&` - ${C.location}`]})]})]}),(0,t.jsxs)(j.Tabs,{defaultValue:"manual",className:"w-full",children:[(0,t.jsxs)(j.TabsList,{className:"grid w-full grid-cols-2",children:[(0,t.jsx)(j.TabsTrigger,{value:"manual",children:"Émargement manuel"}),(0,t.jsx)(j.TabsTrigger,{value:"electronic",children:"Émargement électronique"})]}),(0,t.jsxs)(j.TabsContent,{value:"manual",className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-end",children:(0,t.jsxs)(d.Button,{onClick:()=>O.mutate(),disabled:O.isPending||0===L.length,children:[(0,t.jsx)(m.Save,{className:"mr-2 h-4 w-4"}),O.isPending?"Enregistrement...":"Enregistrer"]})}),H&&(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,t.jsx)(c.Card,{children:(0,t.jsx)(c.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:H.total}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total"})]})})}),(0,t.jsx)(c.Card,{children:(0,t.jsx)(c.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-success-primary",children:H.present}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Présents"})]})})}),(0,t.jsx)(c.Card,{children:(0,t.jsx)(c.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-red-600",children:H.absent}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Absents"})]})})}),(0,t.jsx)(c.Card,{children:(0,t.jsx)(c.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-warning-primary",children:H.late}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"En retard"})]})})}),(0,t.jsx)(c.Card,{children:(0,t.jsx)(c.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:H.excused}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:"Justifiés"})]})})})]}),(0,t.jsxs)(c.Card,{children:[(0,t.jsx)(c.CardHeader,{children:(0,t.jsx)(c.CardTitle,{children:"Liste des participants"})}),(0,t.jsx)(c.CardContent,{children:A&&A.length>0?(0,t.jsx)("div",{className:"space-y-4",children:A.map(e=>{let r=e.students;if(!r)return null;let s=M[e.student_id||""]||{status:"present",lateMinutes:0,notes:""};return(0,t.jsxs)("div",{className:"flex items-center space-x-4 p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:r.photo_url?(0,t.jsx)("img",{src:r.photo_url,alt:`${r.first_name} ${r.last_name}`,className:"h-12 w-12 rounded-full object-cover"}):(0,t.jsxs)("div",{className:"h-12 w-12 rounded-full bg-primary text-white flex items-center justify-center font-semibold",children:[r.first_name.charAt(0),r.last_name.charAt(0)]})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("h3",{className:"font-semibold truncate",children:[r.first_name," ",r.last_name]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:r.student_number})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"flex space-x-2",children:["present","absent","late","excused"].map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>k(r.id,"status",e),className:`p-2 rounded-lg transition-colors min-touch-target touch-manipulation ${s.status===e?"bg-primary text-white":"bg-gray-100 hover:bg-gray-200"}`,title:(e=>{switch(e){case"present":return"Présent";case"absent":return"Absent";case"late":return"En retard";case"excused":return"Justifié"}})(e),children:(e=>{switch(e){case"present":return(0,t.jsx)(h.CheckCircle,{className:"h-5 w-5 text-success-primary"});case"absent":return(0,t.jsx)(f.XCircle,{className:"h-5 w-5 text-red-600"});case"late":return(0,t.jsx)(g.Clock,{className:"h-5 w-5 text-warning-primary"});case"excused":return(0,t.jsx)(p.AlertCircle,{className:"h-5 w-5 text-blue-600"})}})(e)},e))}),"late"===s.status&&(0,t.jsxs)("div",{className:"w-20",children:[(0,t.jsx)("input",{type:"number",min:"0",value:s.lateMinutes||0,onChange:t=>k(e.student_id||"","lateMinutes",parseInt(t.target.value)||0),className:"w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"min"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground text-center mt-1",children:"min"})]}),(0,t.jsx)("div",{className:"w-32",children:(0,t.jsx)("input",{type:"text",value:s.notes||"",onChange:t=>k(e.student_id||"","notes",t.target.value),className:"w-full px-2 py-1 text-sm border rounded focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"Notes..."})})]})]},e.id)})}):(0,t.jsx)("div",{className:"text-center py-12 text-muted-foreground",children:"Aucun participant inscrit à cette session"})})]}),O.error&&(0,t.jsx)("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-lg text-sm",children:O.error instanceof Error?O.error.message:"Une erreur est survenue lors de l'enregistrement"}),O.isSuccess&&(0,t.jsx)("div",{className:"bg-success-bg text-success-primary px-4 py-3 rounded-lg text-sm",children:"Émargement enregistré avec succès !"})]}),(0,t.jsx)(j.TabsContent,{value:"electronic",className:"space-y-6",children:T?.organization_id&&(0,t.jsx)(y.ElectronicAttendanceManager,{sessionId:N,organizationId:T.organization_id})})]})]})}e.s(["default",()=>w])}]);