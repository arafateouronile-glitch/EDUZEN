(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let s=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],871689)},356909,e=>{"use strict";let s=(0,e.i(475254).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);e.s(["Save",()=>s],356909)},263488,e=>{"use strict";let s=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>s],263488)},182774,e=>{"use strict";var s=e.i(843476),a=e.i(325715),t=e.i(618566),i=e.i(271645);let l=(0,e.i(475254).default)("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var r=e.i(167881),n=e.i(970065),d=e.i(522016);function c({children:e,allowedRoles:c,fallback:u,redirectTo:o="/dashboard"}){let{user:m,isLoading:h}=(0,a.useAuth)(),x=(0,t.useRouter)(),[p,f]=(0,i.useState)(null);return((0,i.useEffect)(()=>{if(!h&&m){let e=m.role||"",s=c.includes(e);f(s),s||!o||u||x.push(o)}},[m,h,c,o,x,u]),h||null===p)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):p?(0,s.jsx)(s.Fragment,{children:e}):u?(0,s.jsx)(s.Fragment,{children:u}):(0,s.jsx)("div",{className:"container mx-auto py-16 px-4",children:(0,s.jsx)(n.Card,{className:"max-w-md mx-auto",children:(0,s.jsxs)(n.CardContent,{className:"py-12 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,s.jsx)(l,{className:"h-8 w-8 text-red-600"})}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Accès non autorisé"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Vous n'avez pas les permissions nécessaires pour accéder à cette page."}),(0,s.jsx)(d.default,{href:"/dashboard",children:(0,s.jsx)(r.Button,{children:"Retour au tableau de bord"})})]})})})}e.s(["ADMIN_ROLES",0,["super_admin","admin","secretary","accountant"],"FINANCE_ROLES",0,["super_admin","admin","secretary","accountant"],"FORMATION_MANAGEMENT_ROLES",0,["super_admin","admin","secretary"],"RoleGuard",()=>c],182774)},238491,e=>{"use strict";let s=(0,e.i(475254).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);e.s(["Phone",()=>s],238491)},708502,e=>{"use strict";var s=e.i(843476),a=e.i(271645),t=e.i(618566),i=e.i(266027),l=e.i(954616),r=e.i(912598),n=e.i(325715),d=e.i(920755),c=e.i(167881),u=e.i(970065),o=e.i(23750),m=e.i(10708),h=e.i(6799),x=e.i(182774),p=e.i(871689),f=e.i(284614),j=e.i(263488),b=e.i(238491),v=e.i(98919),y=e.i(356909),g=e.i(16715);let N=(0,e.i(475254).default)("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);var w=e.i(522016);let k=[{value:"admin",label:"Administrateur"},{value:"teacher",label:"Enseignant"},{value:"secretary",label:"Secrétaire"},{value:"accountant",label:"Comptable"},{value:"parent",label:"Parent"},{value:"student",label:"Étudiant"}];function _(){let e=(0,t.useRouter)(),x=(0,t.useParams)().id,{user:_}=(0,n.useAuth)(),C=(0,d.createClient)(),{addToast:A}=(0,h.useToast)(),E=(0,r.useQueryClient)(),[M,R]=(0,a.useState)({email:"",full_name:"",phone:"",role:"teacher",is_active:!0}),{data:S,isLoading:L}=(0,i.useQuery)({queryKey:["user",x],queryFn:async()=>{let{data:e,error:s}=await C.from("users").select("id, email, full_name, phone, role, is_active, organization_id").eq("id",x).single();if(s)throw s;return e},enabled:!!x});(0,a.useEffect)(()=>{S&&R({email:S.email||"",full_name:S.full_name||"",phone:S.phone||"",role:S.role||"teacher",is_active:S.is_active??!0})},[S]);let q=(0,l.useMutation)({mutationFn:async e=>{let{error:s}=await C.from("users").update({email:e.email,full_name:e.full_name,phone:e.phone||null,role:e.role,is_active:e.is_active}).eq("id",x);if(s)throw s},onSuccess:()=>{E.invalidateQueries({queryKey:["organization-users"]}),E.invalidateQueries({queryKey:["user",x]}),A({type:"success",title:"Succès",description:"L'utilisateur a été mis à jour avec succès"}),setTimeout(()=>{e.push("/dashboard/settings/users")},300)},onError:e=>{console.error("❌ [UPDATE USER] Erreur:",e),A({type:"error",title:"Erreur",description:e.message||"Une erreur est survenue lors de la mise à jour"})}});return L?(0,s.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-3xl",children:(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)(g.RefreshCw,{className:"h-8 w-8 animate-spin text-brand-blue"})})}):S?(0,s.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-3xl",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)(w.default,{href:"/dashboard/settings/users",className:"inline-flex items-center text-sm text-muted-foreground hover:text-foreground mb-4",children:[(0,s.jsx)(p.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour à la liste des utilisateurs"]}),(0,s.jsxs)("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-2",children:[(0,s.jsx)(N,{className:"h-8 w-8 text-brand-blue"}),"Modifier l'utilisateur"]}),(0,s.jsx)("p",{className:"text-muted-foreground",children:"Modifiez les informations de l'utilisateur"})]}),(0,s.jsxs)(u.Card,{children:[(0,s.jsxs)(u.CardHeader,{children:[(0,s.jsx)(u.CardTitle,{children:"Informations de l'utilisateur"}),(0,s.jsx)(u.CardDescription,{children:"Modifiez les informations de l'utilisateur"})]}),(0,s.jsx)(u.CardContent,{children:(0,s.jsxs)("form",{onSubmit:e=>{(e.preventDefault(),M.email&&M.full_name)?q.mutate(M):A({type:"error",title:"Erreur",description:"Veuillez remplir tous les champs obligatoires"})},className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(m.Label,{htmlFor:"full_name",children:[(0,s.jsx)(f.User,{className:"h-4 w-4 inline mr-2"}),"Nom complet ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(o.Input,{id:"full_name",type:"text",value:M.full_name,onChange:e=>R({...M,full_name:e.target.value}),placeholder:"Jean Dupont",required:!0,className:"mt-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(m.Label,{htmlFor:"email",children:[(0,s.jsx)(j.Mail,{className:"h-4 w-4 inline mr-2"}),"Email ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(o.Input,{id:"email",type:"email",value:M.email,onChange:e=>R({...M,email:e.target.value}),placeholder:"jean.dupont@example.com",required:!0,className:"mt-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(m.Label,{htmlFor:"phone",children:[(0,s.jsx)(b.Phone,{className:"h-4 w-4 inline mr-2"}),"Téléphone"]}),(0,s.jsx)(o.Input,{id:"phone",type:"tel",value:M.phone,onChange:e=>R({...M,phone:e.target.value}),placeholder:"+221 77 123 45 67",className:"mt-2"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)(m.Label,{htmlFor:"role",children:[(0,s.jsx)(v.Shield,{className:"h-4 w-4 inline mr-2"}),"Rôle ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("select",{id:"role",value:M.role,onChange:e=>R({...M,role:e.target.value}),className:"mt-2 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",required:!0,children:k.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("input",{type:"checkbox",id:"is_active",checked:M.is_active,onChange:e=>R({...M,is_active:e.target.checked}),className:"h-4 w-4 rounded border-gray-300 text-brand-blue focus:ring-brand-blue"}),(0,s.jsx)(m.Label,{htmlFor:"is_active",className:"cursor-pointer",children:"Utilisateur actif"})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-4 pt-4",children:[(0,s.jsx)(c.Button,{type:"button",variant:"outline",onClick:()=>e.push("/dashboard/settings/users"),disabled:q.isPending,children:"Annuler"}),(0,s.jsx)(c.Button,{type:"submit",disabled:q.isPending,children:q.isPending?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}),"Enregistrement..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.Save,{className:"h-4 w-4 mr-2"}),"Enregistrer les modifications"]})})]})]})})]})]}):(0,s.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-3xl",children:(0,s.jsx)(u.Card,{children:(0,s.jsx)(u.CardContent,{className:"pt-6",children:(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)(f.User,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:"Utilisateur introuvable"}),(0,s.jsx)(c.Button,{asChild:!0,children:(0,s.jsx)(w.default,{href:"/dashboard/settings/users",children:"Retour à la liste"})})]})})})})}function C(){return(0,s.jsx)(x.RoleGuard,{allowedRoles:x.ADMIN_ROLES,children:(0,s.jsx)(_,{})})}e.s(["default",()=>C],708502)}]);