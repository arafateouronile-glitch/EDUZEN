(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let s=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],871689)},503116,e=>{"use strict";let s=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>s],503116)},605631,e=>{"use strict";let s=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>s],605631)},286536,e=>{"use strict";let s=(0,e.i(475254).default)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>s],286536)},790597,e=>{"use strict";let s=(0,e.i(475254).default)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);e.s(["Heart",()=>s],790597)},660724,e=>{"use strict";var s=e.i(920755);let t=new class{supabase;constructor(e){this.supabase=e||(0,s.createClient)()}async getFAQCategories(e){let{data:s,error:t}=await this.supabase.from("faq_categories").select("*").eq("organization_id",e).eq("is_active",!0).order("order_index",{ascending:!0});if(t)throw t;return s}async createFAQCategory(e){let{data:s,error:t}=await this.supabase.from("faq_categories").insert(e).select().single();if(t)throw t;return s}async updateFAQCategory(e,s){let{data:t,error:i}=await this.supabase.from("faq_categories").update(s).eq("id",e).select().single();if(i)throw i;return t}async deleteFAQCategory(e){let{error:s}=await this.supabase.from("faq_categories").delete().eq("id",e);if(s)throw s}async getFAQItems(e,s){let t=this.supabase.from("faq_items").select("*, category:faq_categories(*)").eq("organization_id",e).eq("is_active",!0);s?.categoryId&&(t=t.eq("category_id",s.categoryId)),s?.search&&(t=t.or(`question.ilike.%${s.search}%,answer.ilike.%${s.search}%`)),s?.featured&&(t=t.eq("is_featured",!0));let{data:i,error:a}=await t.order("order_index",{ascending:!0}).order("view_count",{ascending:!1});if(a)throw a;return i}async getFAQItemById(e){let{data:s,error:t}=await this.supabase.from("faq_items").select("*, category:faq_categories(*)").eq("id",e).single();if(t)throw t;return s&&await this.supabase.rpc("increment_faq_view_count",{faq_uuid:s.id}),s}async createFAQItem(e){let{data:s,error:t}=await this.supabase.from("faq_items").insert(e).select().single();if(t)throw t;return s}async updateFAQItem(e,s){let{data:t,error:i}=await this.supabase.from("faq_items").update(s).eq("id",e).select().single();if(i)throw i;return t}async deleteFAQItem(e){let{error:s}=await this.supabase.from("faq_items").delete().eq("id",e);if(s)throw s}async createFAQFeedback(e,s,t,i){let{data:a,error:r}=await this.supabase.from("faq_feedback").insert({faq_id:e,user_id:s,is_helpful:t,comment:i}).select().single();if(r)throw r;return a}async getGuides(e,s){let t=this.supabase.from("guides").select("*, author:users(id, full_name, email)").eq("organization_id",e).eq("is_active",!0);s?.category&&(t=t.eq("category",s.category)),s?.difficulty&&(t=t.eq("difficulty",s.difficulty)),s?.search&&(t=t.or(`title.ilike.%${s.search}%,description.ilike.%${s.search}%,content.ilike.%${s.search}%`)),s?.featured&&(t=t.eq("is_featured",!0));let{data:i,error:a}=await t.order("published_at",{ascending:!1}).order("view_count",{ascending:!1});if(a)throw a;return i}async getGuideBySlug(e,s){let{data:t,error:i}=await this.supabase.from("guides").select("*, author:users(id, full_name, email), steps:guide_steps(*)").eq("slug",e).eq("organization_id",s).eq("is_active",!0).single();if(i)throw i;return t&&await this.supabase.rpc("increment_guide_view_count",{guide_uuid:t.id}),t}async createGuide(e){let{data:s,error:t}=await this.supabase.from("guides").insert(e).select().single();if(t)throw t;return s}async updateGuide(e,s){let{data:t,error:i}=await this.supabase.from("guides").update(s).eq("id",e).select().single();if(i)throw i;return t}async deleteGuide(e){let{error:s}=await this.supabase.from("guides").delete().eq("id",e);if(s)throw s}async getGuideSteps(e){let{data:s,error:t}=await this.supabase.from("guide_steps").select("*").eq("guide_id",e).order("step_number",{ascending:!0});if(t)throw t;return s}async createGuideStep(e){let{data:s,error:t}=await this.supabase.from("guide_steps").insert(e).select().single();if(t)throw t;return s}async updateGuideStep(e,s){let{data:t,error:i}=await this.supabase.from("guide_steps").update(s).eq("id",e).select().single();if(i)throw i;return t}async deleteGuideStep(e){let{error:s}=await this.supabase.from("guide_steps").delete().eq("id",e);if(s)throw s}async addGuideToFavorites(e,s){let{data:t,error:i}=await this.supabase.from("guide_favorites").insert({user_id:e,guide_id:s}).select().single();if(i)throw i;return t}async removeGuideFromFavorites(e,s){let{error:t}=await this.supabase.from("guide_favorites").delete().eq("user_id",e).eq("guide_id",s);if(t)throw t}async isGuideFavorite(e,s){let{data:t,error:i}=await this.supabase.from("guide_favorites").select("id").eq("user_id",e).eq("guide_id",s).maybeSingle();if(i)throw i;return!!t}async getUserFavoriteGuides(e){let{data:s,error:t}=await this.supabase.from("guide_favorites").select("*, guide:guides(*, author:users(id, full_name))").eq("user_id",e).order("created_at",{ascending:!1});if(t)throw t;return s}async getGuideProgress(e,s){let{data:t,error:i}=await this.supabase.from("guide_progress").select("*").eq("user_id",e).eq("guide_id",s).maybeSingle();if(i)throw i;return t}async updateGuideProgress(e,s,t,i){let a=await this.getGuideProgress(e,s),r=await this.getGuideSteps(s),d=i.length===r.length;if(a){let{data:e,error:s}=await this.supabase.from("guide_progress").update({current_step:t,completed_steps:i,is_completed:d,completed_at:d?new Date().toISOString():null}).eq("id",a.id).select().single();if(s)throw s;return e}{let{data:a,error:r}=await this.supabase.from("guide_progress").insert({user_id:e,guide_id:s,current_step:t,completed_steps:i,is_completed:d,completed_at:d?new Date().toISOString():null}).select().single();if(r)throw r;return a}}async markStepAsCompleted(e,s,t){let i=await this.getGuideProgress(e,s),a=i?.completed_steps||[];return a.includes(t)||a.push(t),this.updateGuideProgress(e,s,t,a)}};e.s(["knowledgeBaseService",0,t])},92692,e=>{"use strict";var s=e.i(843476),t=e.i(271645),i=e.i(618566),a=e.i(266027),r=e.i(954616),d=e.i(912598),l=e.i(325715),n=e.i(660724),c=e.i(970065),u=e.i(167881),o=e.i(871689),m=e.i(605631),h=e.i(114683),g=e.i(790597),p=e.i(503116),f=e.i(810980),x=e.i(286536),y=e.i(522016),w=e.i(918789),_=e.i(647163);function b(){let e=(0,i.useParams)();(0,i.useRouter)();let b=e.slug,{user:v}=(0,l.useAuth)(),j=(0,d.useQueryClient)(),[N,q]=(0,t.useState)(1),{data:C}=(0,a.useQuery)({queryKey:["guide",b,v?.organization_id],queryFn:()=>n.knowledgeBaseService.getGuideBySlug(b,v?.organization_id||""),enabled:!!b&&!!v?.organization_id}),{data:k}=(0,a.useQuery)({queryKey:["guide-progress",v?.id,C?.id],queryFn:()=>n.knowledgeBaseService.getGuideProgress(v?.id||"",C?.id||""),enabled:!!v?.id&&!!C?.id}),{data:S}=(0,a.useQuery)({queryKey:["guide-favorite",v?.id,C?.id],queryFn:()=>n.knowledgeBaseService.isGuideFavorite(v?.id||"",C?.id||""),enabled:!!v?.id&&!!C?.id}),F=(0,r.useMutation)({mutationFn:async e=>{if(v?.id&&C?.id)return n.knowledgeBaseService.markStepAsCompleted(v.id,C.id,e)},onSuccess:()=>{j.invalidateQueries({queryKey:["guide-progress"]})}}),G=(0,r.useMutation)({mutationFn:async()=>{v?.id&&C?.id&&(S?await n.knowledgeBaseService.removeGuideFromFavorites(v.id,C.id):await n.knowledgeBaseService.addGuideToFavorites(v.id,C.id))},onSuccess:()=>{j.invalidateQueries({queryKey:["guide-favorite"]})}});if((0,t.useEffect)(()=>{k&&k.current_step?q(k.current_step):C?.steps&&C.steps.length>0&&q(1)},[k,C]),!C)return(0,s.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-4xl",children:(0,s.jsx)("div",{className:"text-center py-12",children:"Chargement..."})});let A=k?.completed_steps||[];return(0,s.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-5xl",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(y.default,{href:"/dashboard/knowledge-base",children:(0,s.jsxs)(u.Button,{variant:"ghost",size:"sm",className:"mb-4",children:[(0,s.jsx)(o.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour à la base de connaissances"]})})}),(0,s.jsx)(c.Card,{className:"mb-6",children:(0,s.jsx)(c.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)(f.BookOpen,{className:"h-6 w-6 text-primary"}),(0,s.jsx)(c.CardTitle,{className:"text-3xl",children:C.title})]}),C.description&&(0,s.jsx)("p",{className:"text-muted-foreground mb-4",children:C.description}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[(0,s.jsx)("span",{className:`px-2 py-1 rounded ${(e=>{if(!e)return"bg-gray-100 text-gray-800";switch(e){case"beginner":return"bg-green-100 text-green-800";case"intermediate":return"bg-yellow-100 text-yellow-800";case"advanced":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(C.difficulty)}`,children:(e=>{if(!e)return"Non spécifié";switch(e){case"beginner":return"Débutant";case"intermediate":return"Intermédiaire";case"advanced":return"Avancé";default:return e}})(C.difficulty)}),C.estimated_time_minutes&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(p.Clock,{className:"h-4 w-4"}),(0,s.jsxs)("span",{children:[C.estimated_time_minutes," minutes"]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(x.Eye,{className:"h-4 w-4"}),(0,s.jsxs)("span",{children:[C.view_count," vues"]})]}),C.author&&(0,s.jsxs)("span",{children:["Par ",C.author.full_name||C.author.email]}),C.published_at&&(0,s.jsxs)("span",{children:["Publié le ",(0,_.formatDate)(C.published_at)]})]})]}),(0,s.jsxs)(u.Button,{variant:"outline",size:"sm",onClick:()=>G.mutate(),disabled:G.isPending,children:[(0,s.jsx)(g.Heart,{className:`h-4 w-4 mr-2 ${S?"fill-red-500 text-red-500":""}`}),S?"Retirer des favoris":"Ajouter aux favoris"]})]})})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,s.jsxs)("div",{className:"lg:col-span-3",children:[(0,s.jsx)(c.Card,{className:"mb-6",children:(0,s.jsx)(c.CardContent,{className:"pt-6",children:(0,s.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,s.jsx)(w.default,{children:C.content})})})}),C.steps&&C.steps.length>0&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-semibold mb-4",children:"Étapes"}),C.steps.map((e,t)=>{let i=e.step_number,a=A.includes(i),r=i===N;return(0,s.jsxs)(c.Card,{className:r?"border-primary border-2":"",children:[(0,s.jsx)(c.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:a?(0,s.jsx)(m.CheckCircle,{className:"h-6 w-6 text-green-600"}):(0,s.jsx)(h.Circle,{className:"h-6 w-6 text-muted-foreground"})}),(0,s.jsxs)(c.CardTitle,{className:"text-xl",children:["Étape ",i,": ",e.title]})]}),!a&&(0,s.jsx)(u.Button,{size:"sm",onClick:()=>{F.mutate(i),C?.steps&&i<C.steps.length&&q(i+1)},disabled:F.isPending,children:"Marquer comme complété"})]})}),(0,s.jsxs)(c.CardContent,{children:[e.image_url&&(0,s.jsx)("img",{src:e.image_url,alt:e.title,className:"mb-4 rounded-lg w-full"}),(0,s.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,s.jsx)(w.default,{children:e.content})}),e.video_url&&(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)("a",{href:e.video_url,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"Voir la vidéo →"})})]})]},e.id)})]}),k&&(0,s.jsxs)(c.Card,{className:"mt-6",children:[(0,s.jsx)(c.CardHeader,{children:(0,s.jsx)(c.CardTitle,{children:"Votre progression"})}),(0,s.jsx)(c.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Étapes complétées"}),(0,s.jsxs)("span",{className:"font-semibold",children:[A.length," / ",C.steps?.length||0]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,s.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${C.steps?A.length/C.steps.length*100:0}%`}})}),k.is_completed&&(0,s.jsxs)("div",{className:"flex items-center gap-2 text-green-600 mt-2",children:[(0,s.jsx)(m.CheckCircle,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Guide complété !"})]})]})})]})]}),(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsxs)(c.Card,{className:"sticky top-4",children:[(0,s.jsx)(c.CardHeader,{children:(0,s.jsx)(c.CardTitle,{className:"text-lg",children:"Navigation"})}),(0,s.jsx)(c.CardContent,{children:C.steps&&C.steps.length>0&&(0,s.jsx)("div",{className:"space-y-2",children:C.steps.map(e=>{let t=e.step_number,i=A.includes(t),a=t===N;return(0,s.jsxs)("button",{onClick:()=>q(t),className:`w-full text-left p-2 rounded-lg transition-colors ${a?"bg-primary text-white":i?"bg-green-50 text-green-800 hover:bg-green-100":"bg-gray-50 hover:bg-gray-100"}`,children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[i?(0,s.jsx)(m.CheckCircle,{className:"h-4 w-4 flex-shrink-0"}):(0,s.jsx)(h.Circle,{className:"h-4 w-4 flex-shrink-0"}),(0,s.jsxs)("span",{className:"text-sm font-medium",children:["Étape ",t]})]}),(0,s.jsx)("p",{className:"text-xs mt-1 line-clamp-2",children:e.title})]},e.id)})})})]})})]})]})}e.s(["default",()=>b])}]);