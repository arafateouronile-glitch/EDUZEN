(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let s=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>s],107233)},503116,e=>{"use strict";let s=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>s],503116)},605631,e=>{"use strict";let s=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>s],605631)},514764,e=>{"use strict";let s=(0,e.i(475254).default)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);e.s(["Send",()=>s],514764)},212426,e=>{"use strict";let s=(0,e.i(475254).default)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>s],212426)},612598,e=>{"use strict";var s=e.i(843476),r=e.i(271645),a=e.i(266027),t=e.i(954616),n=e.i(912598),i=e.i(325715),l=e.i(920755);let d=new class{supabase;constructor(e){this.supabase=e||(0,l.createClient)()}async getReports(e){try{let{data:s,error:r}=await this.supabase.from("bpf_reports").select("*").eq("organization_id",e).order("year",{ascending:!1});if(r){if(this.is404Error(r))return console.warn("[BPF] Reports table does not exist yet"),[];throw r}return s||[]}catch(e){if(this.is404Error(e))return[];throw e}}async getReport(e){let{data:s,error:r}=await this.supabase.from("bpf_reports").select("*").eq("id",e).maybeSingle();if(r)throw r;return s}async getReportByYear(e,s){let{data:r,error:a}=await this.supabase.from("bpf_reports").select("*").eq("organization_id",e).eq("year",s).maybeSingle();if(a&&!this.is404Error(a))throw a;return r}async createReport(e,s){if(await this.getReportByYear(e,s))throw Error(`Un rapport existe d\xe9j\xe0 pour l'ann\xe9e ${s}`);let r=await this.calculateMetrics(e,s),a={organization_id:e,year:s,status:"draft",...r},{data:t,error:n}=await this.supabase.from("bpf_reports").insert(a).select().single();if(n)throw n;return t}async updateReport(e,s){let r={...s};delete r.id,delete r.created_at,delete r.updated_at;let{data:a,error:t}=await this.supabase.from("bpf_reports").update(r).eq("id",e).select().single();if(t)throw t;return a}async submitReport(e,s){return await this.updateReport(e,{status:"submitted",submitted_at:new Date().toISOString(),submitted_by:s})}async calculateMetrics(e,s){try{let{data:r,error:a}=await this.supabase.rpc("calculate_bpf_metrics",{org_id:e,year_val:s});if(a)return console.warn("[BPF] Could not calculate metrics automatically:",a.message),this.getDefaultMetrics();return r||this.getDefaultMetrics()}catch(e){return console.warn("[BPF] Error calculating metrics:",e),this.getDefaultMetrics()}}async getTrainingDomains(e){try{let{data:s,error:r}=await this.supabase.from("bpf_training_domains").select("*").eq("bpf_report_id",e).order("revenue",{ascending:!1});if(r){if(this.is404Error(r))return[];throw r}return s||[]}catch(e){if(this.is404Error(e))return[];throw e}}async addTrainingDomain(e){let{data:s,error:r}=await this.supabase.from("bpf_training_domains").insert(e).select().single();if(r)throw r;return s}getDefaultMetrics(){return{total_revenue:0,revenue_cpf:0,revenue_opco:0,revenue_companies:0,revenue_individuals:0,revenue_pole_emploi:0,revenue_regions:0,revenue_state:0,revenue_other:0,total_students:0,students_men:0,students_women:0,students_under_26:0,students_over_45:0,students_disabled:0,total_training_hours:0,total_trainee_hours:0,total_programs:0,total_sessions:0,total_trainers:0,permanent_trainers:0,freelance_trainers:0,trainer_hours:0,training_locations:0,owned_locations:0,rented_locations:0,total_capacity:0,subcontracting_amount:0}}is404Error(e){return e?.code==="PGRST116"||e?.code==="42P01"||e?.code==="PGRST301"||e?.status===404||e?.message?.includes("relation")||e?.message?.includes("does not exist")}};var o=e.i(970065),c=e.i(167881),m=e.i(994179),u=e.i(6799),x=e.i(101523),b=e.i(107233),h=e.i(178583),g=e.i(440160),p=e.i(514764),f=e.i(605631),j=e.i(503116),y=e.i(898791),v=e.i(761911),N=e.i(212426),w=e.i(810980),_=e.i(522016);function C(){let{user:e}=(0,i.useAuth)(),l=(0,n.useQueryClient)(),{addToast:C}=(0,u.useToast)(),[k,B]=(0,r.useState)(new Date().getFullYear()-1),{data:F=[],isLoading:D}=(0,a.useQuery)({queryKey:["bpf-reports",e?.organization_id],queryFn:async()=>e?.organization_id?await d.getReports(e.organization_id):[],enabled:!!e?.organization_id,retry:!1}),P=(0,t.useMutation)({mutationFn:async s=>{if(!e?.organization_id)throw Error("Organization ID required");return await d.createReport(e.organization_id,s)},onSuccess:()=>{l.invalidateQueries({queryKey:["bpf-reports"]}),C({type:"success",title:"Rapport BPF créé",description:`Le rapport pour l'ann\xe9e ${k} a \xe9t\xe9 cr\xe9\xe9 avec succ\xe8s.`})},onError:e=>{C({type:"error",title:"Erreur",description:e?.message||"Impossible de créer le rapport BPF."})}}),S={draft:"bg-gray-100 text-gray-800",in_progress:"bg-blue-100 text-blue-800",completed:"bg-green-100 text-green-800",submitted:"bg-purple-100 text-purple-800"},q={draft:j.Clock,in_progress:y.AlertCircle,completed:f.CheckCircle,submitted:p.Send},R={draft:"Brouillon",in_progress:"En cours",completed:"Complété",submitted:"Soumis"},z=e=>new Intl.NumberFormat("fr-FR").format(e);return e?(0,s.jsxs)("div",{className:"p-6 space-y-8 animate-in fade-in duration-500",children:[(0,s.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"inline-flex items-center gap-3 mb-2",children:[(0,s.jsx)("div",{className:"p-2.5 bg-gradient-to-br from-brand-blue to-brand-cyan rounded-xl shadow-lg",children:(0,s.jsx)(x.BarChart3,{className:"h-7 w-7 text-white"})}),(0,s.jsx)("h1",{className:"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-brand-blue to-brand-cyan bg-clip-text text-transparent",children:"Bilan Pédagogique et Financier"})]}),(0,s.jsx)("p",{className:"text-muted-foreground text-sm lg:text-base max-w-2xl",children:"Gérez vos rapports annuels obligatoires pour les Organismes de Formation de manière simple et efficace"})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3",children:[(0,s.jsx)("select",{value:k,onChange:e=>B(parseInt(e.target.value)),className:"px-4 py-2.5 border-2 border-input rounded-xl focus:ring-2 focus:ring-primary focus:border-primary transition-all bg-background hover:bg-accent/5 text-sm font-medium",children:Array.from({length:5},(e,s)=>new Date().getFullYear()-s).map(e=>(0,s.jsxs)("option",{value:e,children:["Année ",e]},e))}),(0,s.jsxs)(c.Button,{onClick:()=>P.mutate(k),disabled:P.isPending,className:"shadow-md hover:shadow-lg transition-all",children:[(0,s.jsx)(b.Plus,{className:"h-4 w-4 mr-2"}),"Créer rapport ",k]})]})]}),(0,s.jsx)(o.Card,{className:"border-brand-blue/20 bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost backdrop-blur-sm shadow-sm hover:shadow-md transition-all duration-300",children:(0,s.jsx)(o.CardContent,{className:"p-6",children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("div",{className:"p-3 bg-brand-blue/10 rounded-xl border border-brand-blue/20",children:(0,s.jsx)(y.AlertCircle,{className:"h-6 w-6 text-brand-blue"})}),(0,s.jsxs)("div",{className:"flex-1 space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h3",{className:"font-semibold text-gray-900 text-lg",children:"Obligation réglementaire"}),(0,s.jsx)(m.Badge,{className:"bg-brand-blue-ghost text-brand-blue text-xs",children:"Important"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("p",{className:"text-sm text-gray-700 leading-relaxed",children:"Le Bilan Pédagogique et Financier est un document obligatoire que tout organisme de formation doit transmettre chaque année à l'administration."}),(0,s.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,s.jsx)(j.Clock,{className:"h-4 w-4 text-brand-blue"}),(0,s.jsx)("span",{className:"font-medium text-gray-900",children:"Date limite : 30 avril de l'année N+1"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-600 leading-relaxed",children:"Ce rapport présente les données financières (chiffre d'affaires par source de financement) et pédagogiques (nombre de stagiaires, heures de formation) de l'année écoulée."})]})]})]})})}),D?(0,s.jsx)("div",{className:"space-y-4",children:[1,2].map(e=>(0,s.jsxs)(o.Card,{className:"animate-pulse",children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"h-6 w-32 bg-muted rounded"}),(0,s.jsx)("div",{className:"h-4 w-48 bg-muted rounded"})]}),(0,s.jsx)("div",{className:"h-6 w-24 bg-muted rounded-full"})]})}),(0,s.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4].map(e=>(0,s.jsxs)("div",{className:"p-5 bg-muted/50 rounded-xl",children:[(0,s.jsx)("div",{className:"h-5 w-5 bg-muted rounded mb-3"}),(0,s.jsx)("div",{className:"h-7 w-24 bg-muted rounded mb-2"}),(0,s.jsx)("div",{className:"h-3 w-16 bg-muted rounded"})]},e))}),(0,s.jsxs)("div",{className:"flex items-center justify-between pt-4 border-t",children:[(0,s.jsx)("div",{className:"h-5 w-32 bg-muted rounded"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("div",{className:"h-9 w-28 bg-muted rounded"}),(0,s.jsx)("div",{className:"h-9 w-28 bg-muted rounded"})]})]})]})]},e))}):0===F.length?(0,s.jsx)(o.Card,{className:"border-dashed border-2 hover:border-primary/50 transition-all duration-300",children:(0,s.jsx)(o.CardContent,{className:"p-16 text-center",children:(0,s.jsxs)("div",{className:"max-w-md mx-auto space-y-6",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,s.jsx)("div",{className:"w-24 h-24 bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost rounded-full opacity-50 blur-2xl"})}),(0,s.jsx)("div",{className:"relative p-6 bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost rounded-2xl inline-block",children:(0,s.jsx)(h.FileText,{className:"h-16 w-16 mx-auto text-brand-blue"})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("h3",{className:"text-2xl font-bold text-foreground",children:"Aucun rapport BPF"}),(0,s.jsx)("p",{className:"text-muted-foreground max-w-sm mx-auto",children:"Créez votre premier Bilan Pédagogique et Financier pour commencer à suivre vos indicateurs de formation"})]}),(0,s.jsxs)(c.Button,{onClick:()=>P.mutate(k),size:"lg",className:"shadow-lg hover:shadow-xl transition-all",children:[(0,s.jsx)(b.Plus,{className:"h-5 w-5 mr-2"}),"Créer le rapport ",k]})]})})}):(0,s.jsx)("div",{className:"space-y-4",children:F.map(e=>{let r,a=q[e.status],t=e.total_revenue>0||e.total_students>0;return(0,s.jsxs)(o.Card,{className:"hover:shadow-lg hover:scale-[1.01] transition-all duration-300 border-l-4 border-l-brand-blue/30",children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,s.jsxs)("div",{className:"space-y-1.5",children:[(0,s.jsxs)(o.CardTitle,{className:"flex items-center gap-2.5 text-xl",children:[(0,s.jsx)("div",{className:"p-2 bg-gradient-to-br from-brand-blue/10 to-brand-cyan/10 rounded-lg",children:(0,s.jsx)(x.BarChart3,{className:"h-5 w-5 text-brand-blue"})}),"BPF ",e.year]}),(0,s.jsxs)(o.CardDescription,{className:"flex items-center gap-1.5",children:[(0,s.jsx)(j.Clock,{className:"h-3.5 w-3.5"}),e.submitted_at?`Soumis le ${new Date(e.submitted_at).toLocaleDateString("fr-FR")}`:`Cr\xe9\xe9 le ${new Date(e.created_at).toLocaleDateString("fr-FR")}`]})]}),(0,s.jsx)("div",{className:"flex items-center gap-2",children:(0,s.jsxs)(m.Badge,{className:`${S[e.status]} px-3 py-1.5 text-xs font-medium`,children:[(0,s.jsx)(a,{className:"h-3.5 w-3.5 mr-1.5"}),R[e.status]]})})]})}),(0,s.jsxs)(o.CardContent,{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"group p-5 bg-gradient-to-br from-brand-blue-ghost to-brand-blue-ghost/50 rounded-xl border border-brand-blue/20 hover:shadow-lg hover:scale-105 transition-all duration-300",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,s.jsx)("div",{className:"p-2.5 bg-brand-blue/10 rounded-lg group-hover:bg-brand-blue/20 transition-colors",children:(0,s.jsx)(N.DollarSign,{className:"h-5 w-5 text-brand-blue"})}),(0,s.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"CA Total"})]}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:(r=e.total_revenue,new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(r))}),(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"Chiffre d'affaires"})]}),(0,s.jsxs)("div",{className:"group p-5 bg-gradient-to-br from-brand-cyan-ghost to-brand-cyan-ghost/50 rounded-xl border border-brand-cyan/20 hover:shadow-lg hover:scale-105 transition-all duration-300",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,s.jsx)("div",{className:"p-2.5 bg-brand-cyan/10 rounded-lg group-hover:bg-brand-cyan/20 transition-colors",children:(0,s.jsx)(v.Users,{className:"h-5 w-5 text-brand-cyan"})}),(0,s.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Stagiaires"})]}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:z(e.total_students)}),(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"Apprenants formés"})]}),(0,s.jsxs)("div",{className:"group p-5 bg-gradient-to-br from-brand-blue-ghost to-brand-cyan-ghost/50 rounded-xl border border-brand-blue/20 hover:shadow-lg hover:scale-105 transition-all duration-300",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,s.jsx)("div",{className:"p-2.5 bg-brand-blue/10 rounded-lg group-hover:bg-brand-blue/20 transition-colors",children:(0,s.jsx)(j.Clock,{className:"h-5 w-5 text-brand-blue"})}),(0,s.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Heures"})]}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:[z(e.total_training_hours),"h"]}),(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"Heures de formation"})]}),(0,s.jsxs)("div",{className:"group p-5 bg-gradient-to-br from-brand-cyan-ghost to-brand-blue-ghost/50 rounded-xl border border-brand-cyan/20 hover:shadow-lg hover:scale-105 transition-all duration-300",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,s.jsx)("div",{className:"p-2.5 bg-brand-cyan/10 rounded-lg group-hover:bg-brand-cyan/20 transition-colors",children:(0,s.jsx)(w.BookOpen,{className:"h-5 w-5 text-brand-cyan"})}),(0,s.jsx)("p",{className:"text-xs font-medium text-gray-600",children:"Programmes"})]}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900 mb-1",children:z(e.total_programs)}),(0,s.jsx)("p",{className:"text-xs text-gray-600",children:"Formations actives"})]})]}),(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 pt-5 border-t",children:[(0,s.jsx)("div",{className:"text-sm",children:t?(0,s.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-green-50 text-green-700 rounded-lg border border-green-200/50",children:[(0,s.jsx)(f.CheckCircle,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"font-medium",children:"Données renseignées"})]}):(0,s.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-amber-50 text-amber-700 rounded-lg border border-amber-200/50",children:[(0,s.jsx)(y.AlertCircle,{className:"h-4 w-4"}),(0,s.jsx)("span",{className:"font-medium",children:"Données à compléter"})]})}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsx)(_.default,{href:`/dashboard/bpf/${e.year}`,children:(0,s.jsxs)(c.Button,{variant:"outline",size:"sm",className:"hover:bg-brand-blue-ghost hover:border-brand-blue/30 hover:text-brand-blue transition-all",children:[(0,s.jsx)(h.FileText,{className:"h-4 w-4 mr-2"}),"Voir le détail"]})}),(0,s.jsxs)(c.Button,{variant:"outline",size:"sm",className:"hover:bg-brand-cyan-ghost hover:border-brand-cyan/30 hover:text-brand-cyan transition-all",children:[(0,s.jsx)(g.Download,{className:"h-4 w-4 mr-2"}),"Exporter PDF"]}),"completed"===e.status&&(0,s.jsxs)(c.Button,{size:"sm",className:"bg-brand-blue hover:bg-brand-blue-dark shadow-md hover:shadow-lg transition-all",children:[(0,s.jsx)(p.Send,{className:"h-4 w-4 mr-2"}),"Soumettre"]})]})]})]})]},e.id)})})]}):(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Chargement..."})})}e.s(["default",()=>C],612598)}]);