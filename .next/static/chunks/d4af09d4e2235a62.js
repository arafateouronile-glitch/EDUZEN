(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,367240,e=>{"use strict";let t=(0,e.i(475254).default)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);e.s(["RotateCcw",()=>t],367240)},625959,e=>{"use strict";var t=e.i(843476),r=e.i(271645),n=e.i(647163),i=e.i(643531);let a=r.forwardRef(({className:e,checked:r,onCheckedChange:a,...s},o)=>(0,t.jsxs)("div",{className:"relative inline-flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",ref:o,checked:r,onChange:e=>a?.(e.target.checked),className:(0,n.cn)("peer h-4 w-4 shrink-0 rounded border border-gray-300","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-blue focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","cursor-pointer",r&&"border-brand-blue bg-brand-blue",e),...s}),r&&(0,t.jsx)(i.Check,{className:"absolute h-3 w-3 text-white pointer-events-none left-0.5 top-0.5"})]}));a.displayName="Checkbox",e.s(["Checkbox",()=>a])},781947,e=>{"use strict";var t=e.i(843476),r=e.i(271645),n=e.i(225913),i=e.i(647163);let a=(0,n.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),s=r.forwardRef(({className:e,variant:r,...n},s)=>(0,t.jsx)("div",{ref:s,role:"alert",className:(0,i.cn)(a({variant:r}),e),...n}));s.displayName="Alert",r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("h5",{ref:n,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",e),...r})).displayName="AlertTitle";let o=r.forwardRef(({className:e,...r},n)=>(0,t.jsx)("div",{ref:n,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",e),...r}));o.displayName="AlertDescription",e.s(["Alert",()=>s,"AlertDescription",()=>o])},51483,e=>{"use strict";var t=e.i(920755);e.i(246704);var r=e.i(779478),n=e.i(790224);let i=new class{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async getSignaturesByDocument(e){try{let{data:t,error:r}=await this.supabase.from("document_signatures").select(`
          *,
          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role)
        `).eq("document_id",e).eq("status","signed").order("signed_at",{ascending:!0});if(r)throw r;return t||[]}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"getSignaturesByDocument",documentId:e})}}async getSignatureById(e){try{let{data:t,error:n}=await this.supabase.from("document_signatures").select(`
          *,
          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role),
          document:documents(id, title, organization_id)
        `).eq("id",e).single();if(n){if("PGRST116"===n.code)throw r.errorHandler.createNotFoundError(`Signature avec l'ID ${e} introuvable`,{signatureId:e});throw n}return t}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"getSignatureById",signatureId:e})}}async getSignaturesByUser(e,t){try{let{data:r,error:n}=await this.supabase.from("document_signatures").select(`
          *,
          document:documents(id, title, type, organization_id)
        `).eq("signer_id",e).eq("organization_id",t).order("signed_at",{ascending:!1});if(n)throw n;return r||[]}catch(n){if(n instanceof r.AppError)throw n;throw r.errorHandler.handleError(n,{operation:"getSignaturesByUser",userId:e,organizationId:t})}}async getSignaturesBySession(e,t){try{let{data:r,error:n}=await this.supabase.from("enrollments").select("student_id").eq("session_id",e).in("status",["confirmed","completed","active"]);if(n)throw n;if(!r||0===r.length)return[];let i=r.map(e=>e.student_id).filter(Boolean),{data:a,error:s}=await this.supabase.from("documents").select("id").eq("organization_id",t).in("student_id",i);if(s)throw s;if(!a||0===a.length)return[];let o=a.map(e=>e.id),{data:l,error:d}=await this.supabase.from("document_signatures").select(`
          *,
          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role),
          document:documents(id, title, type, student_id, students(id, first_name, last_name))
        `).in("document_id",o).eq("organization_id",t).order("signed_at",{ascending:!1});if(d)throw d;return l||[]}catch(n){if(n instanceof r.AppError)throw n;throw r.errorHandler.handleError(n,{operation:"getSignaturesBySession",sessionId:e,organizationId:t})}}async createSignature(e){try{let{data:t}=await this.supabase.auth.getUser();if(!t.user)throw r.errorHandler.createAuthError(r.ErrorCode.AUTH_REQUIRED,"Utilisateur non authentifié");let i=this.generateValidationCode(),a=null;a=navigator.userAgent;let s={document_id:e.documentId,organization_id:e.organizationId,signer_id:e.signerId,signature_data:e.signatureData,signature_type:e.signatureType||"handwritten",signer_name:e.signerName||t.user.user_metadata?.full_name||"Utilisateur",signer_email:e.signerEmail||t.user.email||null,signer_role:e.signerRole||null,position_x:e.positionX||null,position_y:e.positionY||null,width:e.width||200,height:e.height||80,page_number:e.pageNumber||1,status:"signed",is_valid:!0,validation_code:i,comment:e.comment||null,ip_address:null,user_agent:a},{data:o,error:l}=await this.supabase.from("document_signatures").insert(s).select(`
          *,
          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role)
        `).single();if(l)throw l;return n.logger.info("Signature créée",{signatureId:o.id,documentId:e.documentId,signerId:e.signerId}),o}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"createSignature",documentId:e.documentId,signerId:e.signerId})}}async updateSignature(e,t){try{let{data:n,error:i}=await this.supabase.from("document_signatures").update(t).eq("id",e).select().single();if(i){if("PGRST116"===i.code)throw r.errorHandler.createNotFoundError(`Signature avec l'ID ${e} introuvable`,{signatureId:e});throw i}return n}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"updateSignature",signatureId:e})}}async revokeSignature(e,t){try{return this.updateSignature(e,{status:"revoked",is_valid:!1,comment:t||"Signature révoquée"})}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"revokeSignature",signatureId:e})}}async deleteSignature(e){try{let{error:t}=await this.supabase.from("document_signatures").delete().eq("id",e);if(t)throw t;n.logger.info("Signature supprimée",{signatureId:e})}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"deleteSignature",signatureId:e})}}async hasSignatures(e){try{let{count:t,error:r}=await this.supabase.from("document_signatures").select("*",{count:"exact",head:!0}).eq("document_id",e).eq("status","signed");if(r)throw r;return(t||0)>0}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"hasSignatures",documentId:e})}}generateValidationCode(){let e=Date.now(),t=Math.random().toString(36).substring(2,15);return`${e}-${t}`}async validateSignature(e,t){try{let r=await this.getSignatureById(e);return r.validation_code===t&&!0===r.is_valid}catch(e){return!1}}};e.s(["signatureService",0,i])},97422,e=>{"use strict";function t(e,t,r){this.x=e,this.y=t,this.time=r||new Date().getTime()}function r(e,t,r,n){this.startPoint=e,this.control1=t,this.control2=r,this.endPoint=n}function n(e,t){var r,i,a,s,o,l,d,u,c,h=this,p=t||{};(this.velocityFilterWeight=p.velocityFilterWeight||.7,this.minWidth=p.minWidth||.5,this.maxWidth=p.maxWidth||2.5,this.throttle="throttle"in p?p.throttle:16,this.minDistance="minDistance"in p?p.minDistance:5,this.throttle)?this._strokeMoveUpdate=(r=n.prototype._strokeUpdate,i=this.throttle,d=null,u=0,a||(a={}),c=function(){u=!1===a.leading?0:Date.now(),d=null,l=r.apply(s,o),d||(s=o=null)},function(){var e=Date.now();u||!1!==a.leading||(u=e);var t=i-(e-u);return s=this,o=arguments,t<=0||t>i?(d&&(clearTimeout(d),d=null),u=e,l=r.apply(s,o),d||(s=o=null)):d||!1===a.trailing||(d=setTimeout(c,t)),l}):this._strokeMoveUpdate=n.prototype._strokeUpdate,this.dotSize=p.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=p.penColor||"black",this.backgroundColor=p.backgroundColor||"rgba(0,0,0,0)",this.onBegin=p.onBegin,this.onEnd=p.onEnd,this._canvas=e,this._ctx=e.getContext("2d"),this.clear(),this._handleMouseDown=function(e){1===e.which&&(h._mouseButtonDown=!0,h._strokeBegin(e))},this._handleMouseMove=function(e){h._mouseButtonDown&&h._strokeMoveUpdate(e)},this._handleMouseUp=function(e){1===e.which&&h._mouseButtonDown&&(h._mouseButtonDown=!1,h._strokeEnd(e))},this._handleTouchStart=function(e){if(1===e.targetTouches.length){var t=e.changedTouches[0];h._strokeBegin(t)}},this._handleTouchMove=function(e){e.preventDefault();var t=e.targetTouches[0];h._strokeMoveUpdate(t)},this._handleTouchEnd=function(e){e.target===h._canvas&&(e.preventDefault(),h._strokeEnd(e))},this.on()}t.prototype.velocityFrom=function(e){return this.time!==e.time?this.distanceTo(e)/(this.time-e.time):1},t.prototype.distanceTo=function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},t.prototype.equals=function(e){return this.x===e.x&&this.y===e.y&&this.time===e.time},r.prototype.length=function(){for(var e=0,t=void 0,r=void 0,n=0;n<=10;n+=1){var i=n/10,a=this._point(i,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),s=this._point(i,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(n>0){var o=a-t,l=s-r;e+=Math.sqrt(o*o+l*l)}t=a,r=s}return e},r.prototype._point=function(e,t,r,n,i){return t*(1-e)*(1-e)*(1-e)+3*r*(1-e)*(1-e)*e+3*n*(1-e)*e*e+i*e*e*e},n.prototype.clear=function(){var e=this._ctx,t=this._canvas;e.fillStyle=this.backgroundColor,e.clearRect(0,0,t.width,t.height),e.fillRect(0,0,t.width,t.height),this._data=[],this._reset(),this._isEmpty=!0},n.prototype.fromDataURL=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new Image,i=r.ratio||window.devicePixelRatio||1,a=r.width||this._canvas.width/i,s=r.height||this._canvas.height/i;this._reset(),n.src=e,n.onload=function(){t._ctx.drawImage(n,0,0,a,s)},this._isEmpty=!1},n.prototype.toDataURL=function(e){var t;if("image/svg+xml"===e)return this._toSVG();for(var r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return(t=this._canvas).toDataURL.apply(t,[e].concat(n))},n.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()},n.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)},n.prototype.isEmpty=function(){return this._isEmpty},n.prototype._strokeBegin=function(e){this._data.push([]),this._reset(),this._strokeUpdate(e),"function"==typeof this.onBegin&&this.onBegin(e)},n.prototype._strokeUpdate=function(e){var t=e.clientX,r=e.clientY,n=this._createPoint(t,r),i=this._data[this._data.length-1],a=i&&i[i.length-1],s=a&&n.distanceTo(a)<this.minDistance;if(!(a&&s)){var o=this._addPoint(n),l=o.curve,d=o.widths;l&&d&&this._drawCurve(l,d.start,d.end),this._data[this._data.length-1].push({x:n.x,y:n.y,time:n.time,color:this.penColor})}},n.prototype._strokeEnd=function(e){var t=this.points.length>2,r=this.points[0];if(!t&&r&&this._drawDot(r),r){var n=this._data[this._data.length-1],i=n[n.length-1];r.equals(i)||n.push({x:r.x,y:r.y,time:r.time,color:this.penColor})}"function"==typeof this.onEnd&&this.onEnd(e)},n.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)},n.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)},n.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor},n.prototype._createPoint=function(e,r,n){var i=this._canvas.getBoundingClientRect();return new t(e-i.left,r-i.top,n||new Date().getTime())},n.prototype._addPoint=function(e){var t=this.points;if(t.push(e),t.length>2){3===t.length&&t.unshift(t[0]);var n=this._calculateCurveControlPoints(t[0],t[1],t[2]).c2,i=this._calculateCurveControlPoints(t[1],t[2],t[3]).c1,a=new r(t[1],n,i,t[2]),s=this._calculateCurveWidths(a);return t.shift(),{curve:a,widths:s}}return{}},n.prototype._calculateCurveControlPoints=function(e,r,n){var i=e.x-r.x,a=e.y-r.y,s=r.x-n.x,o=r.y-n.y,l={x:(e.x+r.x)/2,y:(e.y+r.y)/2},d={x:(r.x+n.x)/2,y:(r.y+n.y)/2},u=Math.sqrt(i*i+a*a),c=Math.sqrt(s*s+o*o),h=l.x-d.x,p=l.y-d.y,g=c/(u+c),f={x:d.x+h*g,y:d.y+p*g},m=r.x-f.x,v=r.y-f.y;return{c1:new t(l.x+m,l.y+v),c2:new t(d.x+m,d.y+v)}},n.prototype._calculateCurveWidths=function(e){var t=e.startPoint,r=e.endPoint,n={start:null,end:null},i=this.velocityFilterWeight*r.velocityFrom(t)+(1-this.velocityFilterWeight)*this._lastVelocity,a=this._strokeWidth(i);return n.start=this._lastWidth,n.end=a,this._lastVelocity=i,this._lastWidth=a,n},n.prototype._strokeWidth=function(e){return Math.max(this.maxWidth/(e+1),this.minWidth)},n.prototype._drawPoint=function(e,t,r){var n=this._ctx;n.moveTo(e,t),n.arc(e,t,r,0,2*Math.PI,!1),this._isEmpty=!1},n.prototype._drawCurve=function(e,t,r){var n=this._ctx,i=r-t,a=Math.floor(e.length());n.beginPath();for(var s=0;s<a;s+=1){var o=s/a,l=o*o,d=l*o,u=1-o,c=u*u,h=c*u,p=h*e.startPoint.x;p+=3*c*o*e.control1.x+3*u*l*e.control2.x+d*e.endPoint.x;var g=h*e.startPoint.y;g+=3*c*o*e.control1.y+3*u*l*e.control2.y+d*e.endPoint.y;var f=t+d*i;this._drawPoint(p,g,f)}n.closePath(),n.fill()},n.prototype._drawDot=function(e){var t=this._ctx,r="function"==typeof this.dotSize?this.dotSize():this.dotSize;t.beginPath(),this._drawPoint(e.x,e.y,r),t.closePath(),t.fill()},n.prototype._fromData=function(e,r,n){for(var i=0;i<e.length;i+=1){var a=e[i];if(a.length>1)for(var s=0;s<a.length;s+=1){var o=a[s],l=new t(o.x,o.y,o.time),d=o.color;if(0===s)this.penColor=d,this._reset(),this._addPoint(l);else if(s!==a.length-1){var u=this._addPoint(l),c=u.curve,h=u.widths;c&&h&&r(c,h,d)}}else this._reset(),n(a[0])}},n.prototype._toSVG=function(){var e=this,t=this._data,r=this._canvas,n=Math.max(window.devicePixelRatio||1,1),i=r.width/n,a=r.height/n,s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttributeNS(null,"width",r.width),s.setAttributeNS(null,"height",r.height),this._fromData(t,function(e,t,r){var n=document.createElement("path");if(!isNaN(e.control1.x)&&!isNaN(e.control1.y)&&!isNaN(e.control2.x)&&!isNaN(e.control2.y)){var i="M "+e.startPoint.x.toFixed(3)+","+e.startPoint.y.toFixed(3)+" "+("C "+e.control1.x.toFixed(3)+",")+e.control1.y.toFixed(3)+" "+(e.control2.x.toFixed(3)+",")+e.control2.y.toFixed(3)+" "+e.endPoint.x.toFixed(3)+","+e.endPoint.y.toFixed(3);n.setAttribute("d",i),n.setAttribute("stroke-width",(2.25*t.end).toFixed(3)),n.setAttribute("stroke",r),n.setAttribute("fill","none"),n.setAttribute("stroke-linecap","round"),s.appendChild(n)}},function(t){var r=document.createElement("circle"),n="function"==typeof e.dotSize?e.dotSize():e.dotSize;r.setAttribute("r",n),r.setAttribute("cx",t.x),r.setAttribute("cy",t.y),r.setAttribute("fill",t.color),s.appendChild(r)});var o='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"'+(' viewBox="0 0 '+i+" ")+a+'" width="'+i+'" height="'+a+'">',l=s.innerHTML;if(void 0===l){var d=document.createElement("dummy"),u=s.childNodes;d.innerHTML="";for(var c=0;c<u.length;c+=1)d.appendChild(u[c].cloneNode(!0));l=d.innerHTML}return"data:image/svg+xml;base64,"+btoa(o+l+"</svg>")},n.prototype.fromData=function(e){var t=this;this.clear(),this._fromData(e,function(e,r){return t._drawCurve(e,r.start,r.end)},function(e){return t._drawDot(e)}),this._data=e},n.prototype.toData=function(){return this._data},e.s(["default",0,n])},476611,(e,t,r)=>{e.e,t.exports=function(){var e=[function(e,t){"use strict";function r(e,t,r,n){return({red:n[4*(r*t+e)],green:n[4*(r*t+e)+1],blue:n[4*(r*t+e)+2],alpha:n[4*(r*t+e)+3]}).alpha}function n(e,t,n,i){for(var a=e?1:-1,s=e?0:n-1,o=s;e?o<n:o>-1;o+=a)for(var l=0;l<t;l++)if(r(l,o,t,i))return o;return null}function i(e,t,n,i){for(var a=e?1:-1,s=e?0:t-1,o=s;e?o<t:o>-1;o+=a)for(var l=0;l<n;l++)if(r(o,l,t,i))return o;return null}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.getContext("2d"),r=e.width,a=e.height,s=t.getImageData(0,0,r,a).data,o=n(!0,r,a,s),l=n(!1,r,a,s),d=i(!0,r,a,s),u=i(!1,r,a,s)-d+1,c=l-o+1,h=t.getImageData(d,o,u,c);return e.width=u,e.height=c,t.clearRect(0,0,u,c),t.putImageData(h,0,0),e}}];function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}()},942012,(e,t,r)=>{e.e,t.exports=function(e,t,r,n){var i=[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=n(r(1)),l=r(2),d=n(l),u=n(r(3)),c=n(r(4)),h=function(e){function t(){var e,r,n;if(!(this instanceof t))throw TypeError("Cannot call a class as a function");for(var a=arguments.length,s=Array(a),o=0;o<a;o++)s[o]=arguments[o];return r=n=i(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(s))),n._sigPad=null,n._excludeOurProps=function(){var e=n.props;return e.canvasProps,e.clearOnResize,function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["canvasProps","clearOnResize"])},n.getCanvas=function(){return n._canvas},n.getTrimmedCanvas=function(){var e=document.createElement("canvas");return e.width=n._canvas.width,e.height=n._canvas.height,e.getContext("2d").drawImage(n._canvas,0,0),(0,c.default)(e)},n.getSignaturePad=function(){return n._sigPad},n._checkClearOnResize=function(){n.props.clearOnResize&&n._resizeCanvas()},n._resizeCanvas=function(){var e=n.props.canvasProps||{},t=e.width,r=e.height;if(!t||!r){var i=n._canvas,a=Math.max(window.devicePixelRatio||1,1);t||(i.width=i.offsetWidth*a),r||(i.height=i.offsetHeight*a),i.getContext("2d").scale(a,a),n.clear()}},n.on=function(){return window.addEventListener("resize",n._checkClearOnResize),n._sigPad.on()},n.off=function(){return window.removeEventListener("resize",n._checkClearOnResize),n._sigPad.off()},n.clear=function(){return n._sigPad.clear()},n.isEmpty=function(){return n._sigPad.isEmpty()},n.fromDataURL=function(e,t){return n._sigPad.fromDataURL(e,t)},n.toDataURL=function(e,t){return n._sigPad.toDataURL(e,t)},n.fromData=function(e){return n._sigPad.fromData(e)},n.toData=function(){return n._sigPad.toData()},i(n,r)}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),s(t,[{key:"componentDidMount",value:function(){this._sigPad=new u.default(this._canvas,this._excludeOurProps()),this._resizeCanvas(),this.on()}},{key:"componentWillUnmount",value:function(){this.off()}},{key:"componentDidUpdate",value:function(){Object.assign(this._sigPad,this._excludeOurProps())}},{key:"render",value:function(){var e=this,t=this.props.canvasProps;return d.default.createElement("canvas",a({ref:function(t){e._canvas=t}},t))}}]),t}(l.Component);h.propTypes={velocityFilterWeight:o.default.number,minWidth:o.default.number,maxWidth:o.default.number,minDistance:o.default.number,dotSize:o.default.oneOfType([o.default.number,o.default.func]),penColor:o.default.string,throttle:o.default.number,onEnd:o.default.func,onBegin:o.default.func,canvasProps:o.default.object,clearOnResize:o.default.bool},h.defaultProps={clearOnResize:!0},t.default=h},function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n}];function a(e){if(s[e])return s[e].exports;var t=s[e]={exports:{},id:e,loaded:!1};return i[e].call(t.exports,t,t.exports,a),t.loaded=!0,t.exports}var s={};return a.m=i,a.c=s,a.p="",a(0)}(e.r(745009),e.r(271645),e.r(97422),e.r(476611))},424403,826609,67146,e=>{"use strict";var t=e.i(843476),r=e.i(271645),n=e.i(942012),i=e.i(167881),a=e.i(970065),s=e.i(367240),o=e.i(440160),l=e.i(569074),d=e.i(647163);function u({width:e=600,height:u=200,backgroundColor:c="#ffffff",penColor:h="#000000",onSave:p,onClear:g,defaultValue:f,className:m,disabled:v=!1,showControls:x=!0,title:_,description:y}){let w=(0,r.useRef)(null),[b,j]=(0,r.useState)(!0),[S,C]=(0,r.useState)(f||null);return(0,r.useEffect)(()=>{if(f&&w.current&&b){let e=new Image;e.src=f,e.onload=()=>{let t=w.current?.getCanvas()?.getContext("2d");t&&(t.drawImage(e,0,0),j(!1),C(f))}}},[f,b]),(0,t.jsxs)(a.Card,{className:(0,d.cn)("w-full",m),children:[(_||y)&&(0,t.jsxs)(a.CardHeader,{children:[_&&(0,t.jsx)(a.CardTitle,{children:_}),y&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:y})]}),(0,t.jsxs)(a.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"relative border-2 border-dashed rounded-lg overflow-hidden bg-white",children:[(0,t.jsx)(n.default,{ref:w,canvasProps:{width:e,height:u,className:"w-full h-full cursor-crosshair",style:{backgroundColor:c,width:"100%",height:`${u}px`}},backgroundColor:c,penColor:h,onEnd:()=>{if(w.current){let e=w.current.isEmpty();if(j(e),!e){let e=w.current.toDataURL("image/png");C(e),p?.(e)}}},disabled:v}),b&&!S&&(0,t.jsx)("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Signez dans la zone ci-dessus"})})]}),x&&(0,t.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,t.jsxs)(i.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{w.current?.clear(),j(!0),C(null),g?.()},disabled:v||b&&!S,children:[(0,t.jsx)(s.RotateCcw,{className:"h-4 w-4 mr-2"}),"Effacer"]}),S&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{if(S){let e=document.createElement("a");e.download=`signature-${Date.now()}.png`,e.href=S,e.click()}},disabled:v,children:[(0,t.jsx)(o.Download,{className:"h-4 w-4 mr-2"}),"Télécharger"]}),(0,t.jsxs)("label",{children:[(0,t.jsx)(i.Button,{type:"button",variant:"outline",size:"sm",asChild:!0,disabled:v,children:(0,t.jsxs)("span",{children:[(0,t.jsx)(l.Upload,{className:"h-4 w-4 mr-2"}),"Importer"]})}),(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{let t=e.target.files?.[0];if(t&&t.type.startsWith("image/")){let e=new FileReader;e.onload=e=>{let t=e.target?.result;if(t&&w.current){let e=new Image;e.src=t,e.onload=()=>{let r=w.current?.getCanvas(),n=r?.getContext("2d");n&&r&&(n.clearRect(0,0,r.width,r.height),n.drawImage(e,0,0,r.width,r.height),j(!1),C(t),p?.(t))}}},e.readAsDataURL(t)}},className:"hidden",disabled:v})]})]}),!b&&!S&&(0,t.jsx)(i.Button,{type:"button",variant:"default",size:"sm",onClick:()=>{if(w.current&&!b){let e=w.current.toDataURL("image/png");C(e),p?.(e)}},disabled:v,children:"Enregistrer la signature"})]}),S&&(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Signature enregistrée le ",new Date().toLocaleString("fr-FR")]})]})]})}e.s(["SignaturePad",()=>u],826609),e.i(51483);var c=e.i(630374),h=e.i(62870),p=e.i(23750),g=e.i(10708),f=e.i(184762),m=e.i(781947),v=e.i(625959),x=e.i(514764),_=e.i(629377),y=e.i(263488);function w({documentId:e,documentTitle:n,availableRecipients:a=[],onSuccess:s,trigger:o}){let[l,d]=(0,r.useState)(!1),[u,w]=(0,r.useState)(!1),[b,j]=(0,r.useState)(null),[S,C]=(0,r.useState)("single"),[E,D]=(0,r.useState)(""),[P,k]=(0,r.useState)(""),[N,T]=(0,r.useState)("student"),[A,M]=(0,r.useState)([]),[I,R]=(0,r.useState)(`Demande de signature : ${n}`),[z,L]=(0,r.useState)(""),[O,U]=(0,r.useState)(30),B=async()=>{try{let t;w(!0),j(null);let r=new Date;if(r.setDate(r.getDate()+O),"single"===S){if(!E||!P)return void j("Veuillez remplir tous les champs requis");t=await fetch("/api/signature-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({documentId:e,recipientEmail:E,recipientName:P,recipientType:N,subject:I,message:z||null,expiresAt:r.toISOString()})})}else{if(0===A.length)return void j("Veuillez sélectionner au moins un destinataire");let n=a.filter(e=>A.includes(e.id)).map(e=>({id:e.id,email:e.email,name:e.name,type:e.type}));t=await fetch("/api/signature-requests",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({documentId:e,recipients:n,subject:I,message:z||null,expiresAt:r.toISOString()})})}if(!t.ok){let e=await t.json();throw Error(e.error||"Erreur lors de l'envoi")}D(""),k(""),T("student"),M([]),L(""),d(!1),s&&s()}catch(e){j(e instanceof Error?e.message:"Erreur inconnue")}finally{w(!1)}};return(0,t.jsxs)(c.Dialog,{open:l,onOpenChange:d,children:[(0,t.jsx)(c.DialogTrigger,{asChild:!0,children:o||(0,t.jsxs)(i.Button,{children:[(0,t.jsx)(x.Send,{className:"h-4 w-4 mr-2"}),"Envoyer en signature"]})}),(0,t.jsxs)(c.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)(c.DialogHeader,{children:[(0,t.jsx)(c.DialogTitle,{children:"Envoyer une demande de signature"}),(0,t.jsx)(c.DialogDescription,{children:"Envoyez ce document pour signature électronique par email"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Document"}),(0,t.jsx)("p",{className:"font-medium",children:n})]}),a.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)(g.Label,{children:"Mode d'envoi"}),(0,t.jsxs)(h.Select,{value:S,onValueChange:e=>C(e),children:[(0,t.jsx)(h.SelectTrigger,{children:(0,t.jsx)(h.SelectValue,{})}),(0,t.jsxs)(h.SelectContent,{children:[(0,t.jsx)(h.SelectItem,{value:"single",children:"Un seul destinataire"}),(0,t.jsx)(h.SelectItem,{value:"multiple",children:"Plusieurs destinataires"})]})]})]}),"single"===S&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(g.Label,{htmlFor:"recipientEmail",children:"Email du destinataire *"}),(0,t.jsx)(p.Input,{id:"recipientEmail",type:"email",value:E,onChange:e=>D(e.target.value),placeholder:"email@example.com"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(g.Label,{htmlFor:"recipientName",children:"Nom du destinataire *"}),(0,t.jsx)(p.Input,{id:"recipientName",value:P,onChange:e=>k(e.target.value),placeholder:"Jean Dupont"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(g.Label,{htmlFor:"recipientType",children:"Type de destinataire"}),(0,t.jsxs)(h.Select,{value:N,onValueChange:e=>T(e),children:[(0,t.jsx)(h.SelectTrigger,{children:(0,t.jsx)(h.SelectValue,{})}),(0,t.jsxs)(h.SelectContent,{children:[(0,t.jsx)(h.SelectItem,{value:"student",children:"Apprenant"}),(0,t.jsx)(h.SelectItem,{value:"funder",children:"Financeur"}),(0,t.jsx)(h.SelectItem,{value:"teacher",children:"Formateur"}),(0,t.jsx)(h.SelectItem,{value:"other",children:"Autre"})]})]})]})]}),"multiple"===S&&a.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsxs)(g.Label,{children:["Destinataires (",A.length," sélectionné",A.length>1?"s":"",")"]}),(0,t.jsx)("div",{className:"border rounded-lg max-h-60 overflow-y-auto",children:a.map(e=>(0,t.jsxs)("label",{className:"flex items-center gap-3 p-3 hover:bg-gray-50 cursor-pointer border-b last:border-b-0",children:[(0,t.jsx)(v.Checkbox,{checked:A.includes(e.id),onCheckedChange:()=>{var t;return t=e.id,void M(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])}}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:e.email})]}),(0,t.jsxs)("span",{className:"text-xs px-2 py-1 bg-gray-100 rounded",children:["student"===e.type&&"Apprenant","funder"===e.type&&"Financeur","teacher"===e.type&&"Formateur","other"===e.type&&"Autre"]})]},e.id))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(g.Label,{htmlFor:"subject",children:"Sujet de l'email"}),(0,t.jsx)(p.Input,{id:"subject",value:I,onChange:e=>R(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(g.Label,{htmlFor:"message",children:"Message personnalisé (optionnel)"}),(0,t.jsx)(f.Textarea,{id:"message",value:z,onChange:e=>L(e.target.value),placeholder:"Ajoutez un message personnalisé pour le destinataire...",rows:4})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(g.Label,{htmlFor:"expiresInDays",children:"Expiration (jours)"}),(0,t.jsx)(p.Input,{id:"expiresInDays",type:"number",min:"1",max:"365",value:O,onChange:e=>U(parseInt(e.target.value)||30)}),(0,t.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:["La demande expirera dans ",O," jour",O>1?"s":""]})]}),b&&(0,t.jsx)(m.Alert,{variant:"destructive",children:(0,t.jsx)(m.AlertDescription,{children:b})}),(0,t.jsxs)(m.Alert,{children:[(0,t.jsx)(y.Mail,{className:"h-4 w-4"}),(0,t.jsx)(m.AlertDescription,{children:"single"===S?"Un email sera envoyé au destinataire avec un lien sécurisé pour signer le document.":`${A.length} email${A.length>1?"s":""} ${A.length>1?"seront envoyés":"sera envoyé"} avec un lien s\xe9curis\xe9 pour chaque destinataire.`})]})]}),(0,t.jsxs)(c.DialogFooter,{children:[(0,t.jsx)(i.Button,{variant:"outline",onClick:()=>d(!1),disabled:u,children:"Annuler"}),(0,t.jsxs)(i.Button,{onClick:B,disabled:u,children:[u&&(0,t.jsx)(_.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Envoyer"]})]})]})]})}e.s(["SendSignatureRequestDialog",()=>w],67146),e.s([],424403)}]);