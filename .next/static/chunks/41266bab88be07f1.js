(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let t=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],107233)},263488,e=>{"use strict";let t=(0,e.i(475254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>t],263488)},25652,e=>{"use strict";let t=(0,e.i(475254).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);e.s(["TrendingUp",()=>t],25652)},127341,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(647163);let s=r.createContext(void 0);function n({value:e,defaultValue:n,onValueChange:i,children:l,className:o}){let d=void 0!==e,[c,u]=r.useState(n??"");r.useEffect(()=>{d||void 0===n||u(n)},[n]);let m=d?e:c,h=r.useCallback(e=>{d||u(e),i?.(e)},[d,i]);return(0,t.jsx)(s.Provider,{value:{value:m,onValueChange:h},children:(0,t.jsx)("div",{className:(0,a.cn)("w-full",o),children:l})})}function i(){let e=r.useContext(s);if(!e)throw Error("Tabs components must be used within a Tabs component");return e}function l({children:e,className:r}){return(0,t.jsx)("div",{className:(0,a.cn)("inline-flex h-10 items-center justify-center rounded-lg bg-bg-gray-100 p-1 text-text-tertiary",r),children:e})}function o({value:e,children:r,className:s}){let{value:n,onValueChange:l}=i(),o=n===e;return(0,t.jsx)("button",{type:"button",onClick:()=>l(e),className:(0,a.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-outline-none focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",o?"bg-white text-text-primary shadow-sm":"text-text-tertiary hover:text-text-primary",s),children:r})}function d({value:e,children:r,className:s}){let{value:n}=i();return n!==e?null:(0,t.jsx)("div",{className:(0,a.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),children:r})}e.s(["Tabs",()=>n,"TabsContent",()=>d,"TabsList",()=>l,"TabsTrigger",()=>o])},246704,779478,e=>{"use strict";var t,r,a=e.i(790224),s=((t={}).AUTH_REQUIRED="AUTH_1001",t.AUTH_INVALID_CREDENTIALS="AUTH_1002",t.AUTH_SESSION_EXPIRED="AUTH_1003",t.AUTH_INSUFFICIENT_PERMISSIONS="AUTH_1004",t.AUTH_2FA_REQUIRED="AUTH_1005",t.AUTH_2FA_INVALID="AUTH_1006",t.VALIDATION_ERROR="VALID_2001",t.VALIDATION_REQUIRED_FIELD="VALID_2002",t.VALIDATION_INVALID_FORMAT="VALID_2003",t.VALIDATION_UNIQUE_CONSTRAINT="VALID_2004",t.DB_CONNECTION_ERROR="DB_3001",t.DB_QUERY_ERROR="DB_3002",t.DB_NOT_FOUND="DB_3003",t.DB_CONSTRAINT_VIOLATION="DB_3004",t.DB_FOREIGN_KEY_CONSTRAINT="DB_3006",t.DB_RLS_POLICY_VIOLATION="DB_3005",t.NETWORK_ERROR="NET_4001",t.API_TIMEOUT="NET_4002",t.API_RATE_LIMIT="NET_4003",t.API_SERVER_ERROR="NET_4004",t.API_NOT_FOUND="NET_4005",t.API_BAD_REQUEST="NET_4006",t.BUSINESS_LOGIC_ERROR="BIZ_5001",t.RESOURCE_LOCKED="BIZ_5002",t.OPERATION_NOT_ALLOWED="BIZ_5003",t.QUOTA_EXCEEDED="BIZ_5004",t.INTERNAL_ERROR="SYS_6001",t.CONFIGURATION_ERROR="SYS_6002",t.SERVICE_UNAVAILABLE="SYS_6003",t);(r={}).LOW="low",r.MEDIUM="medium",r.HIGH="high",r.CRITICAL="critical";class n extends Error{code;severity;userMessage;retryable;context;originalError;constructor(e,t="SYS_6001",r="medium",a={},s){super(e),this.name="AppError",this.code=t,this.severity=r,this.userMessage=a.userMessage||this.getDefaultUserMessage(t),this.retryable=a.retryable??this.isRetryable(t),this.context={...a,code:t,severity:r,timestamp:new Date().toISOString()},this.originalError=s,Error.captureStackTrace&&Error.captureStackTrace(this,n)}getDefaultUserMessage(e){return({AUTH_1001:"Vous devez être connecté pour effectuer cette action.",AUTH_1002:"Email ou mot de passe incorrect.",AUTH_1003:"Votre session a expiré. Veuillez vous reconnecter.",AUTH_1004:"Vous n'avez pas les permissions nécessaires.",AUTH_1005:"Authentification à deux facteurs requise.",AUTH_1006:"Code d'authentification invalide.",VALID_2001:"Les données fournies ne sont pas valides.",VALID_2002:"Certains champs obligatoires sont manquants.",VALID_2003:"Le format des données est incorrect.",VALID_2004:"Cette valeur existe déjà.",DB_3001:"Impossible de se connecter à la base de données.",DB_3002:"Erreur lors de l'exécution de la requête.",DB_3003:"Ressource introuvable.",DB_3004:"Cette opération viole une contrainte de la base de données.",DB_3006:"Cette opération viole une contrainte de clé étrangère.",DB_3005:"Vous n'avez pas accès à cette ressource.",NET_4001:"Erreur de connexion réseau. Vérifiez votre connexion internet.",NET_4002:"La requête a pris trop de temps. Veuillez réessayer.",NET_4003:"Trop de requêtes. Veuillez patienter quelques instants.",NET_4004:"Erreur serveur. Veuillez réessayer plus tard.",NET_4005:"Ressource introuvable.",NET_4006:"Requête invalide.",BIZ_5001:"Cette opération n'est pas autorisée dans le contexte actuel.",BIZ_5002:"Cette ressource est actuellement verrouillée.",BIZ_5003:"Cette opération n'est pas autorisée.",BIZ_5004:"Vous avez atteint la limite autorisée.",SYS_6001:"Une erreur interne est survenue. Veuillez réessayer.",SYS_6002:"Erreur de configuration du système.",SYS_6003:"Service temporairement indisponible."})[e]||"Une erreur inattendue est survenue."}isRetryable(e){return["NET_4001","NET_4002","NET_4004","DB_3001","SYS_6003"].includes(e)}toJSON(){return{name:this.name,message:this.message,code:this.code,severity:this.severity,userMessage:this.userMessage,retryable:this.retryable,context:this.context,stack:this.stack,originalError:this.originalError instanceof Error?{name:this.originalError.name,message:this.originalError.message,stack:this.originalError.stack}:this.originalError}}}let i=new class{handleError(e,t={}){if(e instanceof n)return this.logError(e),e;if(e instanceof Error)return this.handleStandardError(e,t);if(this.isSupabaseError(e))return this.handleSupabaseError(e,t);let r=new n("Une erreur inattendue est survenue.","SYS_6001","high",t,e);return this.logError(r),r}handleStandardError(e,t){let r=e.message.toLowerCase(),a="SYS_6001",s="medium";r.includes("network")||r.includes("fetch")?(a="NET_4001",s="medium"):r.includes("timeout")?(a="NET_4002",s="medium"):r.includes("unauthorized")||r.includes("401")?(a="AUTH_1001",s="high"):r.includes("forbidden")||r.includes("403")?(a="AUTH_1004",s="high"):r.includes("not found")||r.includes("404")?(a="DB_3003",s="low"):(r.includes("validation")||r.includes("invalid"))&&(a="VALID_2001",s="low");let i=new n(e.message,a,s,t,e);return this.logError(i),i}handleSupabaseError(e,t){let r=e.code||e.status,a=e.message||"Erreur Supabase",s=t.code||"DB_3002",i="medium";if(!t.code)switch(r){case"PGRST116":case"42P01":s="DB_3003",i="low";break;case"42501":s="DB_3005",i="high";break;case"23505":s="VALID_2004",i="low";break;case"23503":s="DB_3004",i="medium";break;case"PGRST301":case"400":s="NET_4006",i="low";break;case"401":s="AUTH_1001",i="high";break;case"403":s="AUTH_1004",i="high";break;case"404":s="NET_4005",i="low";break;case"500":s="NET_4004",i="high"}"DB_3006"===s&&(i="medium");let l=new n(a,s,i,t,e);return this.logError(l),l}isSupabaseError(e){return e&&(e.code||e.status||e.message)&&("string"==typeof e.code||"number"==typeof e.status)}logError(e){let t={...e.context,code:e.code,severity:e.severity,retryable:e.retryable};switch(e.severity){case"critical":case"high":a.logger.error(e.message,e.originalError||e,t);break;case"medium":a.logger.warn(e.message,t);break;case"low":a.logger.info(`Error: ${e.message}`,t)}}createValidationError(e,t){return new n(e,"VALID_2001","low",{field:t,userMessage:e})}createAuthError(e,t){return new n(t||"Erreur d'authentification",e,"high")}createDatabaseError(e,t){return new n(e,"DB_3002","medium",{},t)}createNotFoundError(e,t){return new n(e,"DB_3003","low",t)}};e.s(["AppError",()=>n,"ErrorCode",()=>s,"errorHandler",0,i],779478),e.s([],246704)},870273,e=>{"use strict";let t=(0,e.i(475254).default)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);e.s(["Star",()=>t],870273)},514764,e=>{"use strict";let t=(0,e.i(475254).default)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);e.s(["Send",()=>t],514764)},785817,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(647163);e.i(882205);var s=e.i(846932);let n=r.forwardRef(({className:e,columns:r=4,gap:s="md",children:n,...i},l)=>(0,t.jsx)("div",{ref:l,className:(0,a.cn)("grid",{1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 md:grid-cols-2 lg:grid-cols-4"}[r],{sm:"gap-4",md:"gap-6",lg:"gap-8"}[s],e),...i,children:n}));n.displayName="BentoGrid";let i=r.forwardRef(({className:e,span:r=1,rowSpan:n=1,children:i,...l},o)=>(0,t.jsx)(s.motion.div,{ref:o,className:(0,a.cn)({1:"col-span-1",2:"col-span-1 md:col-span-2",3:"col-span-1 md:col-span-2 lg:col-span-3",4:"col-span-1 md:col-span-2 lg:col-span-4"}[r],{1:"row-span-1",2:"row-span-1 md:row-span-2",3:"row-span-1 md:row-span-3"}[n],e),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:[.16,1,.3,1]},...l,children:i}));i.displayName="BentoCard",e.s(["BentoCard",()=>i,"BentoGrid",()=>n])},669671,e=>{"use strict";let t=new class{async blobToBase64(e){return new Promise((t,r)=>{let a=new FileReader;a.onloadend=()=>{t(a.result.split(",")[1])},a.onerror=r,a.readAsDataURL(e)})}async sendEmail(e){try{let t=e.attachments?await Promise.all(e.attachments.map(async e=>{let t;if(e.content instanceof Blob)t=await this.blobToBase64(e.content);else if(e.content instanceof ArrayBuffer){let r=new Blob([e.content],{type:e.contentType});t=await this.blobToBase64(r)}else t=e.content;return{filename:e.filename,content:t,contentType:e.contentType}})):void 0,r=await fetch("/api/email/send",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({to:e.to,subject:e.subject,html:e.html,text:e.text,attachments:t,cc:e.cc,bcc:e.bcc,replyTo:e.replyTo})});if(!r.ok){let e=await r.json();throw Error(e.message||"Erreur lors de l'envoi de l'email")}let a=await r.json();return{success:!0,message:a.message||"Email envoyé avec succès"}}catch(e){throw Error(e instanceof Error?e.message:"Erreur lors de l'envoi de l'email")}}async sendDocument(e,t,r,a,s,n){return this.sendEmail({to:e,subject:t,html:s,text:n,attachments:[{filename:a,content:r,contentType:"application/pdf"}]})}async sendMultipleDocuments(e,t,r,a,s){return this.sendEmail({to:e,subject:t,html:a,text:s,attachments:r.map(e=>({filename:e.filename,content:e.blob,contentType:"application/pdf"}))})}};e.s(["emailService",0,t])},509694,e=>{"use strict";var t=e.i(883966),r=e.i(475225),a=e.i(785183),s=e.i(93230),n=e.i(844171),i=(0,t.generateCategoricalChart)({chartName:"BarChart",GraphicalChild:r.Bar,defaultTooltipEventType:"axis",validateTooltipEventTypes:["axis","item"],axisComponents:[{axisType:"xAxis",AxisComp:a.XAxis},{axisType:"yAxis",AxisComp:s.YAxis}],formatAxisMap:n.formatAxisMap});e.s(["BarChart",()=>i])},303054,e=>{"use strict";var t=e.i(65433),r=e.i(307703);function a(e){(0,r.default)(1,arguments);var a=(0,t.default)(e),s=a.getMonth();return a.setFullYear(a.getFullYear(),s+1,0),a.setHours(23,59,59,999),a}e.s(["default",()=>a])},576844,e=>{"use strict";var t=e.i(109432),r=e.i(65433),a=e.i(307703);function s(e,t){(0,a.default)(2,arguments);var s=(0,r.default)(e),n=(0,r.default)(t),i=s.getTime()-n.getTime();return i<0?-1:i>0?1:i}var n=e.i(303054),i={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(e){return e<0?Math.ceil(e):Math.floor(e)}},l=e.i(735150);function o(e,t){if(null==e)throw TypeError("assign requires that input parameter not be null or undefined");for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}var d=e.i(402335);function c(e,c){return(0,a.default)(1,arguments),function(e,c,u){(0,a.default)(2,arguments);var m,h,g,x,p,f=(0,t.getDefaultOptions)(),b=null!=(m=null!=(h=null==u?void 0:u.locale)?h:f.locale)?m:l.default;if(!b.formatDistance)throw RangeError("locale must contain formatDistance property");var v=s(e,c);if(isNaN(v))throw RangeError("Invalid time value");var y=o(o({},u),{addSuffix:!!(null==u?void 0:u.addSuffix),comparison:v});v>0?(g=(0,r.default)(c),x=(0,r.default)(e)):(g=(0,r.default)(e),x=(0,r.default)(c));var j=function(e,t,s){(0,a.default)(2,arguments);var n,l=function(e,t){return(0,a.default)(2,arguments),(0,r.default)(e).getTime()-(0,r.default)(t).getTime()}(e,t)/1e3;return((n=null==s?void 0:s.roundingMethod)?i[n]:i.trunc)(l)}(x,g),N=Math.round((j-((0,d.default)(x)-(0,d.default)(g))/1e3)/60);if(N<2)if(null!=u&&u.includeSeconds)if(j<5)return b.formatDistance("lessThanXSeconds",5,y);else if(j<10)return b.formatDistance("lessThanXSeconds",10,y);else if(j<20)return b.formatDistance("lessThanXSeconds",20,y);else if(j<40)return b.formatDistance("halfAMinute",0,y);else if(j<60)return b.formatDistance("lessThanXMinutes",1,y);else return b.formatDistance("xMinutes",1,y);else if(0===N)return b.formatDistance("lessThanXMinutes",1,y);else return b.formatDistance("xMinutes",N,y);if(N<45)return b.formatDistance("xMinutes",N,y);if(N<90)return b.formatDistance("aboutXHours",1,y);if(N<1440){var _=Math.round(N/60);return b.formatDistance("aboutXHours",_,y)}if(N<2520)return b.formatDistance("xDays",1,y);else if(N<43200){var w=Math.round(N/1440);return b.formatDistance("xDays",w,y)}else if(N<86400)return p=Math.round(N/43200),b.formatDistance("aboutXMonths",p,y);if((p=function(e,t){(0,a.default)(2,arguments);var i,l=(0,r.default)(e),o=(0,r.default)(t),d=s(l,o),c=Math.abs(function(e,t){(0,a.default)(2,arguments);var s=(0,r.default)(e),n=(0,r.default)(t);return 12*(s.getFullYear()-n.getFullYear())+(s.getMonth()-n.getMonth())}(l,o));if(c<1)i=0;else{1===l.getMonth()&&l.getDate()>27&&l.setDate(30),l.setMonth(l.getMonth()-d*c);var u=s(l,o)===-d;(function(e){(0,a.default)(1,arguments);var t=(0,r.default)(e);return(function(e){(0,a.default)(1,arguments);var t=(0,r.default)(e);return t.setHours(23,59,59,999),t})(t).getTime()===(0,n.default)(t).getTime()})((0,r.default)(e))&&1===c&&1===s(e,o)&&(u=!1),i=d*(c-Number(u))}return 0===i?0:i}(x,g))<12){var E=Math.round(N/43200);return b.formatDistance("xMonths",E,y)}var T=p%12,S=Math.floor(p/12);return T<3?b.formatDistance("aboutXYears",S,y):T<9?b.formatDistance("overXYears",S,y):b.formatDistance("almostXYears",S+1,y)}(e,Date.now(),c)}e.s(["formatDistanceToNow",()=>c],576844)},625959,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(647163),s=e.i(643531);let n=r.forwardRef(({className:e,checked:r,onCheckedChange:n,...i},l)=>(0,t.jsxs)("div",{className:"relative inline-flex items-center",children:[(0,t.jsx)("input",{type:"checkbox",ref:l,checked:r,onChange:e=>n?.(e.target.checked),className:(0,a.cn)("peer h-4 w-4 shrink-0 rounded border border-gray-300","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-brand-blue focus-visible:ring-offset-2","disabled:cursor-not-allowed disabled:opacity-50","cursor-pointer",r&&"border-brand-blue bg-brand-blue",e),...i}),r&&(0,t.jsx)(s.Check,{className:"absolute h-3 w-3 text-white pointer-events-none left-0.5 top-0.5"})]}));n.displayName="Checkbox",e.s(["Checkbox",()=>n])},781947,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(225913),s=e.i(647163);let n=(0,a.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),i=r.forwardRef(({className:e,variant:r,...a},i)=>(0,t.jsx)("div",{ref:i,role:"alert",className:(0,s.cn)(n({variant:r}),e),...a}));i.displayName="Alert",r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("h5",{ref:a,className:(0,s.cn)("mb-1 font-medium leading-none tracking-tight",e),...r})).displayName="AlertTitle";let l=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{ref:a,className:(0,s.cn)("text-sm [&_p]:leading-relaxed",e),...r}));l.displayName="AlertDescription",e.s(["Alert",()=>i,"AlertDescription",()=>l])},51483,e=>{"use strict";var t=e.i(920755);e.i(246704);var r=e.i(779478),a=e.i(790224);let s=new class{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async getSignaturesByDocument(e){try{let{data:t,error:r}=await this.supabase.from("document_signatures").select(`
          *,
          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role)
        `).eq("document_id",e).eq("status","signed").order("signed_at",{ascending:!0});if(r)throw r;return t||[]}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"getSignaturesByDocument",documentId:e})}}async getSignatureById(e){try{let{data:t,error:a}=await this.supabase.from("document_signatures").select(`
          *,
          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role),
          document:documents(id, title, organization_id)
        `).eq("id",e).single();if(a){if("PGRST116"===a.code)throw r.errorHandler.createNotFoundError(`Signature avec l'ID ${e} introuvable`,{signatureId:e});throw a}return t}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"getSignatureById",signatureId:e})}}async getSignaturesByUser(e,t){try{let{data:r,error:a}=await this.supabase.from("document_signatures").select(`
          *,
          document:documents(id, title, type, organization_id)
        `).eq("signer_id",e).eq("organization_id",t).order("signed_at",{ascending:!1});if(a)throw a;return r||[]}catch(a){if(a instanceof r.AppError)throw a;throw r.errorHandler.handleError(a,{operation:"getSignaturesByUser",userId:e,organizationId:t})}}async getSignaturesBySession(e,t){try{let{data:r,error:a}=await this.supabase.from("enrollments").select("student_id").eq("session_id",e).in("status",["confirmed","completed","active"]);if(a)throw a;if(!r||0===r.length)return[];let s=r.map(e=>e.student_id).filter(Boolean),{data:n,error:i}=await this.supabase.from("documents").select("id").eq("organization_id",t).in("student_id",s);if(i)throw i;if(!n||0===n.length)return[];let l=n.map(e=>e.id),{data:o,error:d}=await this.supabase.from("document_signatures").select(`
          *,
          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role),
          document:documents(id, title, type, student_id, students(id, first_name, last_name))
        `).in("document_id",l).eq("organization_id",t).order("signed_at",{ascending:!1});if(d)throw d;return o||[]}catch(a){if(a instanceof r.AppError)throw a;throw r.errorHandler.handleError(a,{operation:"getSignaturesBySession",sessionId:e,organizationId:t})}}async createSignature(e){try{let{data:t}=await this.supabase.auth.getUser();if(!t.user)throw r.errorHandler.createAuthError(r.ErrorCode.AUTH_REQUIRED,"Utilisateur non authentifié");let s=this.generateValidationCode(),n=null;n=navigator.userAgent;let i={document_id:e.documentId,organization_id:e.organizationId,signer_id:e.signerId,signature_data:e.signatureData,signature_type:e.signatureType||"handwritten",signer_name:e.signerName||t.user.user_metadata?.full_name||"Utilisateur",signer_email:e.signerEmail||t.user.email||null,signer_role:e.signerRole||null,position_x:e.positionX||null,position_y:e.positionY||null,width:e.width||200,height:e.height||80,page_number:e.pageNumber||1,status:"signed",is_valid:!0,validation_code:s,comment:e.comment||null,ip_address:null,user_agent:n},{data:l,error:o}=await this.supabase.from("document_signatures").insert(i).select(`
          *,
          signer:users!document_signatures_signer_id_fkey(id, full_name, email, role)
        `).single();if(o)throw o;return a.logger.info("Signature créée",{signatureId:l.id,documentId:e.documentId,signerId:e.signerId}),l}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"createSignature",documentId:e.documentId,signerId:e.signerId})}}async updateSignature(e,t){try{let{data:a,error:s}=await this.supabase.from("document_signatures").update(t).eq("id",e).select().single();if(s){if("PGRST116"===s.code)throw r.errorHandler.createNotFoundError(`Signature avec l'ID ${e} introuvable`,{signatureId:e});throw s}return a}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"updateSignature",signatureId:e})}}async revokeSignature(e,t){try{return this.updateSignature(e,{status:"revoked",is_valid:!1,comment:t||"Signature révoquée"})}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"revokeSignature",signatureId:e})}}async deleteSignature(e){try{let{error:t}=await this.supabase.from("document_signatures").delete().eq("id",e);if(t)throw t;a.logger.info("Signature supprimée",{signatureId:e})}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"deleteSignature",signatureId:e})}}async hasSignatures(e){try{let{count:t,error:r}=await this.supabase.from("document_signatures").select("*",{count:"exact",head:!0}).eq("document_id",e).eq("status","signed");if(r)throw r;return(t||0)>0}catch(t){if(t instanceof r.AppError)throw t;throw r.errorHandler.handleError(t,{operation:"hasSignatures",documentId:e})}}generateValidationCode(){let e=Date.now(),t=Math.random().toString(36).substring(2,15);return`${e}-${t}`}async validateSignature(e,t){try{let r=await this.getSignatureById(e);return r.validation_code===t&&!0===r.is_valid}catch(e){return!1}}};e.s(["signatureService",0,s])},955716,e=>{"use strict";let t=(0,e.i(475254).default)("GitBranch",[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]]);e.s(["GitBranch",()=>t],955716)},262478,424407,e=>{"use strict";var t=e.i(843476),r=e.i(271645),a=e.i(167881),s=e.i(970065),n=e.i(781947),i=e.i(994179),l=e.i(630374),o=e.i(23750),d=e.i(10708),c=e.i(625959),u=e.i(647163);let m=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("div",{className:"relative w-full overflow-auto",children:(0,t.jsx)("table",{ref:a,className:(0,u.cn)("w-full caption-bottom text-sm",e),...r})}));m.displayName="Table";let h=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("thead",{ref:a,className:(0,u.cn)("[&_tr]:border-b",e),...r}));h.displayName="TableHeader";let g=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("tbody",{ref:a,className:(0,u.cn)("[&_tr:last-child]:border-0",e),...r}));g.displayName="TableBody",r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("tfoot",{ref:a,className:(0,u.cn)("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...r})).displayName="TableFooter";let x=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("tr",{ref:a,className:(0,u.cn)("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...r}));x.displayName="TableRow";let p=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("th",{ref:a,className:(0,u.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...r}));p.displayName="TableHead";let f=r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("td",{ref:a,className:(0,u.cn)("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...r}));f.displayName="TableCell",r.forwardRef(({className:e,...r},a)=>(0,t.jsx)("caption",{ref:a,className:(0,u.cn)("mt-4 text-sm text-muted-foreground",e),...r})).displayName="TableCaption";var b=e.i(629377),v=e.i(107233),y=e.i(514764),j=e.i(605631),N=e.i(263488),_=e.i(346897),w=e.i(440160),E=e.i(576844),T=e.i(587470);function S({sessionId:e,organizationId:u}){let[S,C]=(0,r.useState)([]),[A,D]=(0,r.useState)(!0),[B,I]=(0,r.useState)(null),[R,k]=(0,r.useState)(!1),[M,L]=(0,r.useState)(!1),[O,U]=(0,r.useState)({title:"",date:new Date().toISOString().split("T")[0],startTime:"",endTime:"",requireGeolocation:!1,allowedRadiusMeters:100});(0,r.useEffect)(()=>{q()},[e]);let q=async()=>{try{D(!0),I(null);let t=await fetch(`/api/electronic-attendance/sessions?sessionId=${e}`);if(!t.ok)throw Error("Erreur lors du chargement");let r=await t.json();C(r)}catch(e){I(e instanceof Error?e.message:"Erreur inconnue")}finally{D(!1)}},H=async()=>{try{L(!0),I(null);let t=await fetch("/api/electronic-attendance/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,organizationId:u,title:O.title,date:O.date,startTime:O.startTime||null,endTime:O.endTime||null,mode:"electronic",requireGeolocation:O.requireGeolocation,allowedRadiusMeters:O.allowedRadiusMeters})});if(!t.ok){let e=await t.json();throw Error(e.error||"Erreur lors de la création")}k(!1),U({title:"",date:new Date().toISOString().split("T")[0],startTime:"",endTime:"",requireGeolocation:!1,allowedRadiusMeters:100}),q()}catch(e){I(e instanceof Error?e.message:"Erreur inconnue")}finally{L(!1)}},P=async e=>{if(confirm("Voulez-vous lancer cette session d'émargement ? Des emails seront envoyés à tous les apprenants inscrits."))try{let t=await fetch(`/api/electronic-attendance/sessions/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"launch",sendEmails:!0})});if(!t.ok){let e=await t.json();throw Error(e.error||"Erreur lors du lancement")}q()}catch(e){I(e instanceof Error?e.message:"Erreur inconnue")}},F=async e=>{if(confirm("Voulez-vous fermer cette session d'émargement ? Les demandes non signées seront marquées comme expirées."))try{let t=await fetch(`/api/electronic-attendance/sessions/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"close"})});if(!t.ok){let e=await t.json();throw Error(e.error||"Erreur lors de la fermeture")}q()}catch(e){I(e instanceof Error?e.message:"Erreur inconnue")}},z=async e=>{try{let t=await fetch(`/api/electronic-attendance/requests/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"remind"})});if(!t.ok){let e=await t.json();throw Error(e.error||"Erreur lors de l'envoi du rappel")}alert("Rappel envoyé avec succès")}catch(e){I(e instanceof Error?e.message:"Erreur inconnue")}},V=e=>{switch(e){case"draft":return(0,t.jsx)(i.Badge,{variant:"secondary",children:"Brouillon"});case"active":return(0,t.jsx)(i.Badge,{className:"bg-green-500",children:"Active"});case"closed":return(0,t.jsx)(i.Badge,{variant:"outline",children:"Fermée"});case"cancelled":return(0,t.jsx)(i.Badge,{variant:"destructive",children:"Annulée"});case"signed":return(0,t.jsx)(i.Badge,{className:"bg-green-500",children:"Signé"});case"pending":return(0,t.jsx)(i.Badge,{variant:"secondary",children:"En attente"});case"expired":return(0,t.jsx)(i.Badge,{variant:"outline",children:"Expiré"});default:return(0,t.jsx)(i.Badge,{children:e})}};return A&&0===S.length?(0,t.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,t.jsx)(b.Loader2,{className:"h-6 w-6 animate-spin"})}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(s.Card,{children:(0,t.jsx)(s.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Gestion des émargements"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Deux modes d'émargement sont disponibles pour vos sessions de formation :"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsx)("div",{className:"p-4 border rounded-lg bg-blue-50 border-blue-200",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(j.CheckCircle,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold text-blue-900 mb-1",children:"Émargement manuel"}),(0,t.jsx)("p",{className:"text-sm text-blue-700",children:"Cochez directement les présences, absences et retards depuis l'interface. Idéal pour les formations en présentiel avec contrôle direct."})]})]})}),(0,t.jsx)("div",{className:"p-4 border rounded-lg bg-green-50 border-green-200",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(N.Mail,{className:"h-5 w-5 text-green-600 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold text-green-900 mb-1",children:"Émargement numérique"}),(0,t.jsx)("p",{className:"text-sm text-green-700",children:"Envoyez automatiquement des demandes d'émargement par email avec signature électronique. Support de la géolocalisation pour valider la présence physique."})]})]})})]})]})})}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold",children:"Sessions d'émargement numérique"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Créez et gérez les sessions d'émargement avec envoi d'emails automatiques aux apprenants"})]}),(0,t.jsxs)(l.Dialog,{open:R,onOpenChange:k,children:[(0,t.jsx)(l.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(a.Button,{children:[(0,t.jsx)(v.Plus,{className:"h-4 w-4 mr-2"}),"Nouvelle session"]})}),(0,t.jsxs)(l.DialogContent,{children:[(0,t.jsxs)(l.DialogHeader,{children:[(0,t.jsx)(l.DialogTitle,{children:"Nouvelle session d'émargement numérique"}),(0,t.jsx)(l.DialogDescription,{children:"Créez une session d'émargement avec envoi automatique d'emails aux apprenants inscrits"})]}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"title",children:"Titre *"}),(0,t.jsx)(o.Input,{id:"title",value:O.title,onChange:e=>U({...O,title:e.target.value}),placeholder:"Ex: Émargement du 15 janvier"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"date",children:"Date *"}),(0,t.jsx)(o.Input,{id:"date",type:"date",value:O.date,onChange:e=>U({...O,date:e.target.value})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"startTime",children:"Heure de début"}),(0,t.jsx)(o.Input,{id:"startTime",type:"time",value:O.startTime,onChange:e=>U({...O,startTime:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"endTime",children:"Heure de fin"}),(0,t.jsx)(o.Input,{id:"endTime",type:"time",value:O.endTime,onChange:e=>U({...O,endTime:e.target.value})})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(c.Checkbox,{id:"requireGeolocation",checked:O.requireGeolocation,onCheckedChange:e=>U({...O,requireGeolocation:e})}),(0,t.jsx)(d.Label,{htmlFor:"requireGeolocation",className:"cursor-pointer",children:"Exiger la géolocalisation"})]}),O.requireGeolocation&&(0,t.jsxs)("div",{children:[(0,t.jsx)(d.Label,{htmlFor:"allowedRadiusMeters",children:"Rayon autorisé (mètres)"}),(0,t.jsx)(o.Input,{id:"allowedRadiusMeters",type:"number",min:"10",value:O.allowedRadiusMeters,onChange:e=>U({...O,allowedRadiusMeters:parseInt(e.target.value)||100})})]})]}),(0,t.jsxs)(l.DialogFooter,{children:[(0,t.jsx)(a.Button,{variant:"outline",onClick:()=>k(!1),disabled:M,children:"Annuler"}),(0,t.jsxs)(a.Button,{onClick:H,disabled:M||!O.title,children:[M&&(0,t.jsx)(b.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}),"Créer"]})]})]})]})]}),B&&(0,t.jsx)(n.Alert,{variant:"destructive",children:(0,t.jsx)(n.AlertDescription,{children:B})}),0===S.length?(0,t.jsx)(s.Card,{children:(0,t.jsxs)(s.CardContent,{className:"flex flex-col items-center justify-center p-8 text-center",children:[(0,t.jsx)("p",{className:"text-gray-500",children:"Aucune session d'émargement"}),(0,t.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Créez une session pour commencer à gérer les émargements"})]})}):(0,t.jsx)("div",{className:"space-y-4",children:S.map(e=>(0,t.jsxs)(s.Card,{children:[(0,t.jsx)(s.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(s.CardTitle,{className:"text-base",children:e.title}),(0,t.jsxs)(s.CardDescription,{children:[new Date(e.date).toLocaleDateString("fr-FR",{weekday:"long",day:"numeric",month:"long",year:"numeric"}),e.start_time&&` • ${e.start_time}`,e.require_geolocation&&(0,t.jsxs)("span",{className:"inline-flex items-center ml-2",children:[(0,t.jsx)(_.MapPin,{className:"h-3 w-3 mr-1"}),"Géolocalisation requise"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[V(e.status),(0,t.jsxs)(i.Badge,{variant:"outline",children:[e.total_signed,"/",e.total_expected]})]})]})}),(0,t.jsxs)(s.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:["draft"===e.status&&(0,t.jsxs)(a.Button,{onClick:()=>P(e.id),size:"sm",children:[(0,t.jsx)(y.Send,{className:"h-4 w-4 mr-2"}),"Lancer"]}),"active"===e.status&&(0,t.jsx)(a.Button,{onClick:()=>F(e.id),size:"sm",variant:"outline",children:"Fermer"}),(0,t.jsxs)(a.Button,{size:"sm",variant:"outline",children:[(0,t.jsx)(w.Download,{className:"h-4 w-4 mr-2"}),"Exporter"]})]}),e.requests&&e.requests.length>0&&(0,t.jsx)("div",{className:"border rounded-lg",children:(0,t.jsxs)(m,{children:[(0,t.jsx)(h,{children:(0,t.jsxs)(x,{children:[(0,t.jsx)(p,{children:"Apprenant"}),(0,t.jsx)(p,{children:"Email"}),(0,t.jsx)(p,{children:"Statut"}),(0,t.jsx)(p,{children:"Date de signature"}),(0,t.jsx)(p,{className:"text-right",children:"Actions"})]})}),(0,t.jsx)(g,{children:e.requests.map(e=>(0,t.jsxs)(x,{children:[(0,t.jsx)(f,{className:"font-medium",children:e.student_name}),(0,t.jsx)(f,{children:e.student_email}),(0,t.jsx)(f,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[V(e.status),e.location_verified&&(0,t.jsx)("span",{title:"Position vérifiée",children:(0,t.jsx)(_.MapPin,{className:"h-3 w-3 text-green-500"})})]})}),(0,t.jsx)(f,{children:e.signed_at?(0,E.formatDistanceToNow)(new Date(e.signed_at),{addSuffix:!0,locale:T.fr}):"-"}),(0,t.jsx)(f,{className:"text-right",children:"pending"===e.status&&(0,t.jsx)(a.Button,{size:"sm",variant:"ghost",onClick:()=>z(e.id),children:(0,t.jsx)(N.Mail,{className:"h-4 w-4"})})})]},e.id))})]})})]})]},e.id))})]})}e.s(["ElectronicAttendanceManager",()=>S],424407),e.s([],262478)},256221,e=>{"use strict";var t=e.i(843476),r=e.i(645760),a=e.i(785817),s=e.i(167881),n=e.i(127341),i=e.i(21218),l=e.i(605631),o=e.i(870273),d=e.i(212426),c=e.i(440160),u=e.i(25652),m=e.i(191741),h=e.i(955716),g=e.i(647163),x=e.i(509694),p=e.i(475225),f=e.i(841891),b=e.i(438814),v=e.i(322787),y=e.i(785183),j=e.i(93230),N=e.i(872526),_=e.i(234239),w=e.i(559559),E=e.i(731195),T=e.i(348572);e.i(882205);var S=e.i(846932),C=e.i(325715),A=e.i(266027),D=e.i(51483);e.i(262478);var B=e.i(424407);let I=(0,e.i(770703).default)(()=>e.A(305272).then(e=>({default:e.SessionTimeline})).catch(e=>(console.error("Erreur lors du chargement de SessionTimeline:",e),{default:()=>(0,t.jsx)("div",{className:"p-8 text-center text-red-500",children:"Erreur lors du chargement de la timeline"})})),{loadableGenerated:{modules:[265295]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"p-8 text-center text-gray-500",children:(0,t.jsx)("p",{children:"Chargement de la timeline..."})})}),R=({active:e,payload:r,label:a})=>e&&r&&r.length?(0,t.jsxs)("div",{className:"bg-white/90 backdrop-blur-md border border-gray-100 p-3 rounded-xl shadow-xl z-50",children:[(0,t.jsx)("p",{className:"font-semibold text-gray-800 text-sm mb-1",children:a}),r.map((e,r)=>(0,t.jsxs)("p",{className:"text-sm",style:{color:e.color},children:[e.name,": ",(0,t.jsx)("span",{className:"font-bold",children:e.value})]},r))]}):null;function k({sessionData:e,formation:k,program:M,organization:L,enrollments:O=[],grades:U=[],gradesStats:q,attendanceStats:H}){let{user:P}=(0,C.useAuth)(),{handleGenerateSessionReport:F}=(0,T.useDocumentGeneration)({sessionData:e,formation:k,program:M,organization:L}),{data:z}=(0,A.useQuery)({queryKey:["session-signatures",e?.id,P?.organization_id],queryFn:()=>e?.id&&P?.organization_id?D.signatureService.getSignaturesBySession(e.id,P.organization_id):[],enabled:!!e?.id&&!!P?.organization_id}),V=H&&H.total>0?Math.round(H.present/H.total*100):0,G=O.length>0?Math.round(O.filter(e=>"completed"===e.status).length/O.length*100):0,$=O.length>0?Math.round(O.reduce((e,t)=>e+Number(t.paid_amount||0),0)/Math.max(O.reduce((e,t)=>e+Number(t.total_amount||0),1),1)*100):0,Y=O.reduce((e,t)=>e+Number(t.total_amount||0),0),X=O.reduce((e,t)=>e+Number(t.paid_amount||0),0),K=H?[{name:"Présent",value:H.present,color:"#335ACF"},{name:"Absent",value:H.absent,color:"#ef4444"},{name:"En retard",value:H.late,color:"#34B9EE"},{name:"Justifié",value:H.excused,color:"#3b82f6"}]:[],Q=[{status:"En attente",count:O.filter(e=>"pending"===e.payment_status).length},{status:"Partiel",count:O.filter(e=>"partial"===e.payment_status).length},{status:"Payé",count:O.filter(e=>"paid"===e.payment_status).length},{status:"En retard",count:O.filter(e=>"overdue"===e.payment_status).length}],Z=O.map(e=>{let t=e.students;if(!t)return null;let r=U.filter(t=>t.student_id===e.student_id),a=r.length>0?r.reduce((e,t)=>{let r=Number(t.max_score)||20;return e+(Number(t.score)||0)/r*20},0)/r.length:null,s=e.student_id&&H?.byStudent?.[e.student_id]||{present:0,total:0},n=s.total>0?Math.round(s.present/s.total*100):0;return{id:e.id,student:{name:`${t.first_name} ${t.last_name}`,number:t.student_number},attendanceRate:n,avgGrade:a,gradeCount:r.length,paymentStatus:e.payment_status,paidAmount:Number(e.paid_amount||0),totalAmount:Number(e.total_amount||0)}}).filter(e=>null!==e);return(0,t.jsxs)(n.Tabs,{defaultValue:"statistics",className:"space-y-6",children:[(0,t.jsxs)(n.TabsList,{className:"grid w-full grid-cols-3 p-1 bg-gray-100/50 backdrop-blur-sm rounded-xl",children:[(0,t.jsxs)(n.TabsTrigger,{value:"statistics",className:"rounded-lg data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-brand-blue transition-all",children:[(0,t.jsx)(u.TrendingUp,{className:"h-4 w-4 mr-2"}),"Statistiques"]}),(0,t.jsxs)(n.TabsTrigger,{value:"timeline",className:"rounded-lg data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-brand-blue transition-all",children:[(0,t.jsx)(h.GitBranch,{className:"h-4 w-4 mr-2"}),"Timeline & Tâches"]}),(0,t.jsxs)(n.TabsTrigger,{value:"attendance",className:"rounded-lg data-[state=active]:bg-white data-[state=active]:shadow-sm data-[state=active]:text-brand-blue transition-all",children:[(0,t.jsx)(m.ClipboardList,{className:"h-4 w-4 mr-2"}),"Émargements"]})]}),(0,t.jsx)(n.TabsContent,{value:"timeline",className:"space-y-6",children:e?.id?(0,t.jsx)(r.GlassCard,{variant:"premium",className:"p-6",children:(0,t.jsx)(I,{sessionId:e.id,sessionData:{name:e.name||"",start_date:e.start_date||"",end_date:e.end_date||"",status:e.status||"planned",enrollmentsCount:O.length,hasConventions:O.some(e=>"confirmed"===e.status),hasConvocations:!1,attendanceRate:V,invoicesGenerated:O.some(e=>"pending"!==e.payment_status),evaluationsCompleted:!!(q&&q.total>0)}})}):(0,t.jsx)("div",{className:"p-8 text-center text-gray-500",children:(0,t.jsx)("p",{children:"Chargement des données de session..."})})}),(0,t.jsxs)(n.TabsContent,{value:"statistics",className:"space-y-6",children:[(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[{label:"Taux de présence",value:`${V}%`,detail:`${H?.present||0} pr\xe9sent${(H?.present||0)>1?"s":""} sur ${H?.total||0} s\xe9ance${(H?.total||0)>1?"s":""}`,icon:i.Activity,iconBg:"bg-gradient-to-br from-brand-blue to-brand-blue-dark",cardBg:"bg-gradient-to-br from-brand-blue/5 via-brand-blue/10 to-brand-cyan/5",borderColor:"border-brand-blue/20",glowColor:"rgba(39, 68, 114, 0.15)"},{label:"Taux de complétion",value:`${G}%`,detail:`${O.filter(e=>"completed"===e.status).length} compl\xe9t\xe9${O.filter(e=>"completed"===e.status).length>1?"s":""} sur ${O.length} inscription${O.length>1?"s":""}`,icon:l.CheckCircle,iconBg:"bg-gradient-to-br from-emerald-500 to-emerald-600",cardBg:"bg-gradient-to-br from-emerald-50 via-emerald-100/50 to-teal-50",borderColor:"border-emerald-200",glowColor:"rgba(16, 185, 129, 0.15)"},{label:"Note moyenne",value:`${q?.average?.toFixed(1)||0}/${q?.average?Math.round(q.average*(100/(q.averagePercentage||1))):20}`,detail:q?.averagePercentage!==null&&q?.averagePercentage!==void 0?`${q.averagePercentage.toFixed(1)}% \xb7 ${q?.total||0} note${(q?.total||0)>1?"s":""}`:`${q?.total||0} note${(q?.total||0)>1?"s":""}`,icon:o.Star,iconBg:"bg-gradient-to-br from-amber-500 to-amber-600",cardBg:"bg-gradient-to-br from-amber-50 via-amber-100/50 to-orange-50",borderColor:"border-amber-200",glowColor:"rgba(245, 158, 11, 0.15)"},{label:"Taux de recouvrement",value:`${$}%`,detail:`${(0,g.formatCurrency)(X,"XOF")} pay\xe9 sur ${(0,g.formatCurrency)(Y,"XOF")}`,icon:d.DollarSign,iconBg:"bg-gradient-to-br from-brand-cyan to-brand-cyan-dark",cardBg:"bg-gradient-to-br from-brand-cyan/5 via-brand-cyan/10 to-brand-blue/5",borderColor:"border-brand-cyan/20",glowColor:"rgba(52, 185, 238, 0.15)"}].map((e,r)=>(0,t.jsx)(S.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.05*r,ease:[.16,1,.3,1]},whileHover:{y:-6,scale:1.02},className:"group relative",children:(0,t.jsxs)(S.motion.div,{className:(0,g.cn)("relative overflow-hidden rounded-3xl p-6 border transition-all duration-500 shadow-lg hover:shadow-2xl",e.cardBg,e.borderColor),style:{boxShadow:`0 10px 40px -10px ${e.glowColor}, 0 0 0 1px rgba(255, 255, 255, 0.1)`},children:[(0,t.jsx)(S.motion.div,{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent",initial:{x:"-100%"},whileHover:{x:"100%"},transition:{duration:.6,ease:"easeInOut"}}),(0,t.jsxs)("div",{className:"relative z-10",children:[(0,t.jsx)("div",{className:"flex items-start justify-between mb-4",children:(0,t.jsx)(S.motion.div,{className:(0,g.cn)("p-3 rounded-2xl shadow-xl",e.iconBg),whileHover:{rotate:12,scale:1.15},transition:{type:"spring",stiffness:500,damping:15},children:(0,t.jsx)(e.icon,{className:"h-5 w-5 text-white"})})}),(0,t.jsx)("div",{className:"text-4xl font-display font-bold tracking-tighter text-gray-900 leading-none mb-2",children:e.value}),(0,t.jsx)("p",{className:"text-xs font-bold text-gray-600 uppercase tracking-widest mb-1 opacity-80",children:e.label}),(0,t.jsx)("p",{className:"text-xs text-gray-500 font-medium tracking-tight",children:e.detail}),(0,t.jsx)(S.motion.div,{className:"h-1.5 rounded-full mt-4",style:{background:e.iconBg.replace("bg-gradient-to-br","linear-gradient(to right,")},initial:{scaleX:0},animate:{scaleX:1},transition:{delay:.05*r+.3,duration:.6,ease:[.16,1,.3,1]}})]}),(0,t.jsx)(S.motion.div,{className:"absolute inset-0 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-500",style:{background:`radial-gradient(circle at 50% 50%, ${e.glowColor} 0%, transparent 70%)`}})]})},e.label))}),(0,t.jsxs)(a.BentoGrid,{columns:4,gap:"md",className:"auto-rows-[400px]",children:[(0,t.jsx)(a.BentoCard,{span:1,children:(0,t.jsxs)(r.GlassCard,{variant:"premium",className:"h-full flex flex-col p-6 border-2 border-transparent hover:border-brand-blue/10 transition-all duration-500 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,t.jsx)(i.Activity,{className:"h-5 w-5 text-brand-blue"}),(0,t.jsx)("h3",{className:"font-display font-bold text-gray-900",children:"Présences"})]}),(0,t.jsx)("div",{className:"flex-1 min-h-[250px] w-full",children:H&&H.total>0?(0,t.jsx)(E.ResponsiveContainer,{width:"100%",height:"100%",children:(0,t.jsxs)(f.PieChart,{children:[(0,t.jsx)(b.Pie,{data:H?[{name:"Présent",value:H.present,color:"#335ACF"},{name:"Absent",value:H.absent,color:"#ef4444"},{name:"En retard",value:H.late,color:"#34B9EE"},{name:"Justifié",value:H.excused,color:"#3b82f6"}]:[],cx:"50%",cy:"50%",innerRadius:60,outerRadius:80,paddingAngle:5,dataKey:"value",children:K.map((e,r)=>(0,t.jsx)(v.Cell,{fill:e.color,strokeWidth:0},`cell-${r}`))}),(0,t.jsx)(_.Tooltip,{content:(0,t.jsx)(R,{})}),(0,t.jsx)(w.Legend,{verticalAlign:"bottom",height:36,formatter:e=>(0,t.jsx)("span",{className:"text-xs font-medium text-gray-600 ml-1",children:e})})]})}):(0,t.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-sm text-gray-500 gap-2",children:[(0,t.jsx)("div",{className:"p-3 bg-gray-100 rounded-full",children:(0,t.jsx)(i.Activity,{className:"h-6 w-6 text-gray-400"})}),(0,t.jsx)("p",{children:"Aucune donnée de présence"})]})})]})}),(0,t.jsx)(a.BentoCard,{span:1,children:(0,t.jsxs)(r.GlassCard,{variant:"premium",className:"h-full flex flex-col p-6 border-2 border-transparent hover:border-brand-cyan/10 transition-all duration-500 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,t.jsx)(d.DollarSign,{className:"h-5 w-5 text-brand-cyan"}),(0,t.jsx)("h3",{className:"font-display font-bold text-gray-900",children:"Paiements"})]}),(0,t.jsx)("div",{className:"flex-1 min-h-[250px] w-full",children:O.length>0?(0,t.jsx)(E.ResponsiveContainer,{width:"100%",height:"100%",children:(0,t.jsxs)(x.BarChart,{data:Q,margin:{top:10,right:10,left:-20,bottom:0},children:[(0,t.jsx)(N.CartesianGrid,{strokeDasharray:"3 3",vertical:!1,stroke:"#E5E7EB"}),(0,t.jsx)(y.XAxis,{dataKey:"status",axisLine:!1,tickLine:!1,tick:{fill:"#6B7280",fontSize:10},dy:10}),(0,t.jsx)(j.YAxis,{axisLine:!1,tickLine:!1,tick:{fill:"#6B7280",fontSize:10}}),(0,t.jsx)(_.Tooltip,{cursor:{fill:"#F3F4F6"},content:(0,t.jsx)(R,{})}),(0,t.jsx)(p.Bar,{dataKey:"count",radius:[4,4,0,0],children:Q.map((e,r)=>(0,t.jsx)(v.Cell,{fill:"Payé"===e.status?"#10B981":"En retard"===e.status?"#EF4444":"Partiel"===e.status?"#34B9EE":"#9CA3AF"},`cell-${r}`))})]})}):(0,t.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-sm text-gray-500 gap-2",children:[(0,t.jsx)("div",{className:"p-3 bg-gray-100 rounded-full",children:(0,t.jsx)(d.DollarSign,{className:"h-6 w-6 text-gray-400"})}),(0,t.jsx)("p",{children:"Aucune inscription"})]})})]})}),(0,t.jsx)(a.BentoCard,{span:2,children:(0,t.jsxs)(r.GlassCard,{variant:"premium",className:"h-full flex flex-col p-6 border-2 border-transparent hover:border-amber-400/10 transition-all duration-500 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-6",children:[(0,t.jsx)(o.Star,{className:"h-5 w-5 text-amber-500"}),(0,t.jsx)("h3",{className:"font-display font-bold text-gray-900",children:"Distribution des notes"})]}),(0,t.jsx)("div",{className:"flex-1 min-h-[250px] w-full",children:q&&q.total>0?(0,t.jsx)(E.ResponsiveContainer,{width:"100%",height:"100%",children:(0,t.jsxs)(x.BarChart,{data:[{range:"0-5",count:U.filter(e=>{let t=Number(e.score)||0,r=Number(e.max_score)||20;return t/r*20>=0&&t/r*20<5}).length,color:"#EF4444"},{range:"5-10",count:U.filter(e=>{let t=Number(e.score)||0,r=Number(e.max_score)||20;return t/r*20>=5&&t/r*20<10}).length,color:"#F59E0B"},{range:"10-15",count:U.filter(e=>{let t=Number(e.score)||0,r=Number(e.max_score)||20;return t/r*20>=10&&t/r*20<15}).length,color:"#34B9EE"},{range:"15-20",count:U.filter(e=>{let t=Number(e.score)||0,r=Number(e.max_score)||20;return t/r*20>=15&&t/r*20<=20}).length,color:"#10B981"}],margin:{top:10,right:10,left:-20,bottom:0},children:[(0,t.jsx)(N.CartesianGrid,{strokeDasharray:"3 3",vertical:!1,stroke:"#E5E7EB"}),(0,t.jsx)(y.XAxis,{dataKey:"range",axisLine:!1,tickLine:!1,tick:{fill:"#6B7280",fontSize:12},dy:10}),(0,t.jsx)(j.YAxis,{axisLine:!1,tickLine:!1,tick:{fill:"#6B7280",fontSize:12}}),(0,t.jsx)(_.Tooltip,{cursor:{fill:"#F3F4F6"},content:(0,t.jsx)(R,{})}),(0,t.jsx)(p.Bar,{dataKey:"count",radius:[6,6,0,0],children:[0,1,2,3].map((e,r)=>(0,t.jsx)(v.Cell,{fill:["#EF4444","#F59E0B","#34B9EE","#10B981"][r]},`cell-${r}`))})]})}):(0,t.jsxs)("div",{className:"h-full flex flex-col items-center justify-center text-sm text-gray-500 gap-2",children:[(0,t.jsx)("div",{className:"p-3 bg-gray-100 rounded-full",children:(0,t.jsx)(o.Star,{className:"h-6 w-6 text-gray-400"})}),(0,t.jsx)("p",{children:"Aucune note enregistrée"})]})})]})})]}),Z.length>0&&(0,t.jsxs)(r.GlassCard,{variant:"premium",className:"overflow-hidden border-2 border-transparent hover:border-brand-blue/10 transition-all duration-500",children:[(0,t.jsxs)("div",{className:"p-6 border-b border-gray-100/50 bg-gray-50/50 backdrop-blur-sm flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-brand-blue/10 rounded-lg",children:(0,t.jsx)(u.TrendingUp,{className:"h-5 w-5 text-brand-blue"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-display font-bold text-gray-900",children:"Performance par apprenant"}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Suivi individuel détaillé"})]})]}),(0,t.jsxs)(s.Button,{variant:"outline",size:"sm",className:"gap-2",children:[(0,t.jsx)(c.Download,{className:"h-4 w-4"}),"Exporter"]})]}),(0,t.jsx)("div",{className:"p-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Z.map((e,r)=>(0,t.jsx)(S.motion.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.05*r},children:(0,t.jsxs)("div",{className:"group p-4 rounded-2xl border border-gray-200 bg-white hover:border-brand-blue/30 hover:shadow-lg transition-all duration-300",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[(0,t.jsx)("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-brand-blue to-brand-cyan flex items-center justify-center text-white font-bold text-sm shadow-md",children:e.student.name.charAt(0)}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-bold text-gray-900 line-clamp-1 group-hover:text-brand-blue transition-colors",children:e.student.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.student.number||"Sans matricule"})]})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between text-xs mb-1",children:[(0,t.jsx)("span",{className:"text-gray-500",children:"Présence"}),(0,t.jsxs)("span",{className:"font-bold text-gray-900",children:[e.attendanceRate,"%"]})]}),(0,t.jsx)("div",{className:"h-1.5 w-full bg-gray-100 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-brand-blue rounded-full",style:{width:`${e.attendanceRate}%`}})})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center py-2 border-t border-dashed border-gray-200",children:[(0,t.jsx)("span",{className:"text-xs text-gray-500",children:"Moyenne"}),(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)(o.Star,{className:"h-3 w-3 text-amber-500 fill-amber-500"}),(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-900",children:[null!==e.avgGrade?e.avgGrade.toFixed(2):"-",(0,t.jsx)("span",{className:"text-xs text-gray-400 font-normal",children:"/20"})]})]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center pt-1",children:[(0,t.jsx)("span",{className:`text-[10px] font-bold px-2 py-0.5 rounded-full border ${"paid"===e.paymentStatus?"bg-emerald-50 text-emerald-700 border-emerald-200":"partial"===e.paymentStatus?"bg-brand-cyan-ghost text-brand-cyan border-brand-cyan/20":"overdue"===e.paymentStatus?"bg-red-50 text-red-700 border-red-200":"bg-gray-100 text-gray-600 border-gray-200"}`,children:"paid"===e.paymentStatus?"PAYÉ":"partial"===e.paymentStatus?"PARTIEL":"overdue"===e.paymentStatus?"RETARD":"ATTENTE"}),(0,t.jsxs)("span",{className:"text-xs font-medium text-gray-600",children:[Math.round(e.paidAmount/Math.max(e.totalAmount,1)*100),"%"]})]})]})]})},e.id))})]}),e?.id&&P?.organization_id&&z&&z.length>0&&(0,t.jsxs)(r.GlassCard,{variant:"premium",className:"overflow-hidden border-2 border-transparent hover:border-brand-blue/10 transition-all duration-500",children:[(0,t.jsx)("div",{className:"p-6 border-b border-gray-100/50 bg-gray-50/50 backdrop-blur-sm",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"p-2 bg-indigo-500/10 rounded-lg",children:(0,t.jsx)(l.CheckCircle,{className:"h-5 w-5 text-indigo-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-display font-bold text-gray-900",children:"Historique des signatures"}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[z.length," document",z.length>1?"s":""," signé",z.length>1?"s":""]})]})]})}),(0,t.jsx)("div",{className:"divide-y divide-gray-100",children:z.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-4 p-4 hover:bg-gray-50 transition-colors",children:[(0,t.jsx)("div",{className:"flex-shrink-0 w-20 h-14 border rounded-lg bg-white p-1 flex items-center justify-center shadow-sm",children:(0,t.jsx)("img",{src:e.signature_data,alt:`Signature de ${e.signer_name}`,className:"max-w-full max-h-full object-contain"})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsx)("p",{className:"font-bold text-gray-900 text-sm",children:e.signer_name||e.signer?.full_name||"Signataire inconnu"}),(0,t.jsx)("span",{className:"text-xs text-gray-400",children:(0,g.formatDate)(e.signed_at)})]}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:e.document?.title||"Document sans titre"}),e.document?.students&&(0,t.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,t.jsx)("div",{className:"w-4 h-4 rounded-full bg-gray-200 flex items-center justify-center text-[8px] font-bold text-gray-600",children:e.document.students.first_name[0]}),(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:[e.document.students.first_name," ",e.document.students.last_name]})]})]}),e.comment&&(0,t.jsxs)("div",{className:"hidden md:block text-xs italic text-gray-400 max-w-[200px] truncate bg-gray-50 px-2 py-1 rounded",children:['"',e.comment,'"']})]},e.id))})]}),(0,t.jsxs)(r.GlassCard,{variant:"premium",className:"p-8 flex flex-col md:flex-row items-center justify-between gap-6 border-2 border-transparent hover:border-brand-blue/20 transition-all duration-500 bg-gradient-to-r from-brand-blue-ghost/20 to-transparent",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:"p-4 bg-white rounded-2xl shadow-lg shadow-brand-blue/10",children:(0,t.jsx)(c.Download,{className:"h-8 w-8 text-brand-blue"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-xl font-display font-bold text-gray-900 mb-1",children:"Rapport de session complet"}),(0,t.jsx)("p",{className:"text-gray-600 max-w-lg",children:"Téléchargez un rapport PDF détaillé incluant toutes les statistiques, la progression, l'assiduité et les données financières."})]})]}),(0,t.jsxs)(s.Button,{onClick:F,className:"bg-brand-blue hover:bg-brand-blue-dark text-white shadow-lg shadow-brand-blue/20 px-8 py-6 h-auto text-base font-bold rounded-xl",children:[(0,t.jsx)(c.Download,{className:"mr-2 h-5 w-5"}),"Exporter le PDF"]})]})]}),(0,t.jsx)(n.TabsContent,{value:"attendance",className:"space-y-6",children:e?.id&&P?.organization_id&&(0,t.jsx)(r.GlassCard,{variant:"premium",className:"p-6",children:(0,t.jsx)(B.ElectronicAttendanceManager,{sessionId:e.id,organizationId:P.organization_id})})})]})}e.s(["Suivi",()=>k])},48503,e=>{e.v(e=>Promise.resolve().then(()=>e(915833)))},870653,e=>{e.v(t=>Promise.all(["static/chunks/e551d4a510c7c3c6.js"].map(t=>e.l(t))).then(()=>t(424154)))},195111,e=>{e.v(t=>Promise.all(["static/chunks/9fc253a1d558cb4a.js"].map(t=>e.l(t))).then(()=>t(38201)))},305272,e=>{e.v(t=>Promise.all(["static/chunks/675d4ec0d7f5f3fd.js"].map(t=>e.l(t))).then(()=>t(265295)))}]);