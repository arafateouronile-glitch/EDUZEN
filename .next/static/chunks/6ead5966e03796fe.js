(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let t=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],107233)},871689,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},356909,e=>{"use strict";let t=(0,e.i(475254).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);e.s(["Save",()=>t],356909)},569074,e=>{"use strict";let t=(0,e.i(475254).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",()=>t],569074)},319036,e=>{"use strict";var t=e.i(843476),i=e.i(271645),s=e.i(647163);let a=i.forwardRef(({checked:e,onCheckedChange:i,disabled:a,className:l,...r},n)=>(0,t.jsx)("button",{type:"button",role:"switch","aria-checked":e,ref:n,disabled:a,onClick:()=>i?.(!e),className:(0,s.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e?"bg-brand-blue":"bg-input",l),...r,children:(0,t.jsx)("span",{className:(0,s.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",e?"translate-x-5":"translate-x-0")})}));a.displayName="Switch",e.s(["Switch",0,a])},870273,e=>{"use strict";let t=(0,e.i(475254).default)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);e.s(["Star",()=>t],870273)},655900,e=>{"use strict";let t=(0,e.i(475254).default)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);e.s(["ChevronUp",()=>t],655900)},771649,e=>{"use strict";let t=(0,e.i(475254).default)("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]);e.s(["Type",()=>t],771649)},750570,e=>{"use strict";let t=(0,e.i(475254).default)("GripVertical",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);e.s(["GripVertical",()=>t],750570)},370956,e=>{"use strict";let t=(0,e.i(475254).default)("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);e.s(["List",()=>t],370956)},684428,e=>{"use strict";let t=(0,e.i(475254).default)("AlignLeft",[["line",{x1:"21",x2:"3",y1:"6",y2:"6",key:"1fp77t"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}],["line",{x1:"17",x2:"3",y1:"18",y2:"18",key:"1awlsn"}]]);e.s(["AlignLeft",()=>t],684428)},88081,878265,e=>{"use strict";var t=e.i(475254);let i=(0,t.default)("Hash",[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]]);e.s(["Hash",()=>i],88081);let s=(0,t.default)("CheckSquare",[["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}],["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11",key:"1jnkn4"}]]);e.s(["CheckSquare",()=>s],878265)},570134,e=>{"use strict";var t=e.i(843476),i=e.i(271645),s=e.i(618566),a=e.i(954616),l=e.i(266027),r=e.i(325715),n=e.i(920755),o=e.i(970065),c=e.i(167881),d=e.i(23750),u=e.i(10708),m=e.i(184762),p=e.i(319036),x=e.i(6799),h=e.i(871689),y=e.i(356909),f=e.i(107233),g=e.i(727612),v=e.i(750570),j=e.i(664659),b=e.i(655900),N=e.i(178583),k=e.i(771649),_=e.i(684428),w=e.i(88081),C=e.i(370956),L=e.i(878265),q=e.i(87316),A=e.i(569074),S=e.i(870273),T=e.i(842009),z=e.i(239616),P=e.i(629377),F=e.i(522016);e.i(882205);var M=e.i(846932),E=e.i(88653);let I=[{value:"text",label:"Texte court",icon:k.Type},{value:"textarea",label:"Texte long",icon:_.AlignLeft},{value:"number",label:"Nombre",icon:w.Hash},{value:"select",label:"Liste déroulante",icon:C.List},{value:"checkbox",label:"Case à cocher",icon:L.CheckSquare},{value:"date",label:"Date",icon:q.Calendar},{value:"file",label:"Fichier",icon:A.Upload},{value:"rating",label:"Note (étoiles)",icon:S.Star},{value:"competency",label:"Compétence",icon:T.Award}];function B(){let e=(0,s.useRouter)(),k=(0,s.useParams)().id,{user:_}=(0,r.useAuth)(),w=(0,n.createClient)(),{addToast:C}=(0,x.useToast)(),[L,q]=(0,i.useState)({name:"",description:"",primary_color:"#335ACF",secondary_color:"#34B9EE",formation_id:"",is_default:!1}),[A,S]=(0,i.useState)([]),[T,B]=(0,i.useState)([]),{data:D,isLoading:H}=(0,l.useQuery)({queryKey:["portfolio-template",k],queryFn:async()=>{try{let{data:e,error:t}=await w.from("learning_portfolio_templates").select("*").eq("id",k).single();if(t){if("PGRST116"===t.code||"42P01"===t.code||t.message?.includes("does not exist"))return console.warn("Table learning_portfolio_templates non disponible"),null;throw t}if(!e)return null;if(e.formation_id)try{let{data:t}=await w.from("formations").select("id, name").eq("id",e.formation_id).single();return{...e,formation:t||null}}catch(e){console.warn("Impossible de récupérer la formation:",e)}return{...e,formation:null}}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01"||e?.message?.includes("does not exist"))return console.warn("Table learning_portfolio_templates non disponible"),null;throw e}},enabled:!!k});(0,i.useEffect)(()=>{D&&(q({name:D.name||"",description:D.description||"",primary_color:D.primary_color||"#335ACF",secondary_color:D.secondary_color||"#34B9EE",formation_id:D.formation_id||"",is_default:D.is_default||!1}),D.template_structure&&Array.isArray(D.template_structure)&&(S(D.template_structure),B(D.template_structure.map(e=>e.id))))},[D]);let{data:R}=(0,l.useQuery)({queryKey:["formations-select",_?.organization_id],queryFn:async()=>{if(!_?.organization_id)return[];let{data:e,error:t}=await w.from("formations").select("id, name").eq("organization_id",_.organization_id).eq("is_active",!0);return t?[]:e||[]},enabled:!!_?.organization_id}),U=(0,a.useMutation)({mutationFn:async()=>{let{data:e,error:t}=await w.from("learning_portfolio_templates").update({name:L.name,description:L.description,template_structure:A,primary_color:L.primary_color,secondary_color:L.secondary_color,formation_id:L.formation_id||null,is_default:L.is_default,updated_at:new Date().toISOString()}).eq("id",k).select().single();if(t)throw t;return e},onSuccess:()=>{C({type:"success",title:"Modèle mis à jour",description:"Le modèle de livret a été mis à jour avec succès."}),e.push("/dashboard/evaluations/portfolios/templates")},onError:e=>{C({type:"error",title:"Erreur",description:e.message||"Impossible de mettre à jour le modèle."})}}),O=()=>{let e={id:`section_${Date.now()}`,title:"Nouvelle section",description:"",fields:[]};S([...A,e]),B([...T,e.id])},G=(e,t)=>{S(A.map(i=>i.id===e?{...i,...t}:i))},V=(e,t,i)=>{S(A.map(s=>s.id===e?{...s,fields:s.fields.map(e=>e.id===t?{...e,...i}:e)}:s))};return H?(0,t.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-5xl",children:(0,t.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,t.jsx)(P.Loader2,{className:"h-8 w-8 animate-spin text-brand-blue"})})}):D?(0,t.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-5xl",children:[(0,t.jsx)(M.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,t.jsx)(F.default,{href:"/dashboard/evaluations/portfolios/templates",children:(0,t.jsx)(c.Button,{variant:"ghost",size:"icon",children:(0,t.jsx)(h.ArrowLeft,{className:"h-5 w-5"})})}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Modifier le modèle"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Modifiez le modèle de livret d'apprentissage"})]})]})}),(0,t.jsx)("form",{onSubmit:e=>{(e.preventDefault(),L.name)?0===A.length?C({type:"error",title:"Erreur",description:"Ajoutez au moins une section."}):U.mutate():C({type:"error",title:"Erreur",description:"Le nom du modèle est requis."})},children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)(o.Card,{className:"sticky top-4",children:[(0,t.jsx)(o.CardHeader,{children:(0,t.jsxs)(o.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(z.Settings,{className:"h-5 w-5"}),"Paramètres"]})}),(0,t.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"name",children:"Nom du modèle *"}),(0,t.jsx)(d.Input,{id:"name",value:L.name,onChange:e=>q({...L,name:e.target.value}),placeholder:"Ex: Livret de suivi formation",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"description",children:"Description"}),(0,t.jsx)(m.Textarea,{id:"description",value:L.description,onChange:e=>q({...L,description:e.target.value}),placeholder:"Description du modèle...",rows:3})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"formation",children:"Formation associée (optionnel)"}),(0,t.jsxs)("select",{id:"formation",value:L.formation_id,onChange:e=>q({...L,formation_id:e.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue",children:[(0,t.jsx)("option",{value:"",children:"Aucune (modèle générique)"}),R?.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"primary_color",children:"Couleur principale"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"color",id:"primary_color",value:L.primary_color,onChange:e=>q({...L,primary_color:e.target.value}),className:"w-10 h-10 rounded cursor-pointer"}),(0,t.jsx)(d.Input,{value:L.primary_color,onChange:e=>q({...L,primary_color:e.target.value}),className:"flex-1"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"secondary_color",children:"Couleur secondaire"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"color",id:"secondary_color",value:L.secondary_color,onChange:e=>q({...L,secondary_color:e.target.value}),className:"w-10 h-10 rounded cursor-pointer"}),(0,t.jsx)(d.Input,{value:L.secondary_color,onChange:e=>q({...L,secondary_color:e.target.value}),className:"flex-1"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(u.Label,{htmlFor:"is_default",children:"Modèle par défaut"}),(0,t.jsx)(p.Switch,{checked:L.is_default,onCheckedChange:e=>q({...L,is_default:e})})]}),(0,t.jsx)("div",{className:"pt-4 border-t",children:(0,t.jsxs)(c.Button,{type:"submit",className:"w-full",disabled:U.isPending,children:[(0,t.jsx)(y.Save,{className:"h-4 w-4 mr-2"}),U.isPending?"Mise à jour...":"Enregistrer les modifications"]})})]})]})}),(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("h2",{className:"text-lg font-semibold text-gray-900",children:["Structure du livret (",A.length," section",A.length>1?"s":"",")"]}),(0,t.jsxs)(c.Button,{type:"button",onClick:O,children:[(0,t.jsx)(f.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une section"]})]}),0===A.length?(0,t.jsx)(o.Card,{children:(0,t.jsxs)(o.CardContent,{className:"py-12 text-center",children:[(0,t.jsx)(N.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucune section"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"Ajoutez des sections pour structurer votre livret d'apprentissage."}),(0,t.jsxs)(c.Button,{type:"button",onClick:O,children:[(0,t.jsx)(f.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter une section"]})]})}):(0,t.jsx)(E.AnimatePresence,{children:A.map((e,i)=>(0,t.jsx)(M.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{delay:.05*i},children:(0,t.jsxs)(o.Card,{className:"border-l-4",style:{borderLeftColor:L.primary_color},children:[(0,t.jsx)(o.CardHeader,{className:"py-3",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)(v.GripVertical,{className:"h-5 w-5 text-gray-400 cursor-move"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(d.Input,{value:e.title,onChange:t=>G(e.id,{title:t.target.value}),className:"font-semibold text-lg border-none p-0 h-auto focus:ring-0",placeholder:"Titre de la section"}),(0,t.jsx)(d.Input,{value:e.description||"",onChange:t=>G(e.id,{description:t.target.value}),className:"text-sm text-gray-500 border-none p-0 h-auto focus:ring-0 mt-1",placeholder:"Description (optionnel)"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:[e.fields.length," champ",e.fields.length>1?"s":""]}),(0,t.jsx)(c.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{var t;return t=e.id,void B(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},children:T.includes(e.id)?(0,t.jsx)(b.ChevronUp,{className:"h-4 w-4"}):(0,t.jsx)(j.ChevronDown,{className:"h-4 w-4"})}),(0,t.jsx)(c.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{var t;return t=e.id,void S(A.filter(e=>e.id!==t))},className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,t.jsx)(g.Trash2,{className:"h-4 w-4"})})]})]})}),(0,t.jsx)(E.AnimatePresence,{children:T.includes(e.id)&&(0,t.jsx)(M.motion.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},children:(0,t.jsxs)(o.CardContent,{className:"pt-0",children:[(0,t.jsx)("div",{className:"space-y-3",children:e.fields.map((i,s)=>(0,t.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg border",children:[(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-3",children:[(0,t.jsxs)("div",{className:"col-span-5",children:[(0,t.jsx)(u.Label,{className:"text-xs",children:"Label"}),(0,t.jsx)(d.Input,{value:i.label,onChange:t=>V(e.id,i.id,{label:t.target.value}),placeholder:"Nom du champ"})]}),(0,t.jsxs)("div",{className:"col-span-4",children:[(0,t.jsx)(u.Label,{className:"text-xs",children:"Type"}),(0,t.jsx)("select",{value:i.type,onChange:t=>V(e.id,i.id,{type:t.target.value}),className:"w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-brand-blue text-sm",children:I.map(e=>(0,t.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,t.jsx)("div",{className:"col-span-2 flex items-end justify-center",children:(0,t.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("input",{type:"checkbox",checked:i.required,onChange:t=>V(e.id,i.id,{required:t.target.checked}),className:"rounded"}),"Requis"]})}),(0,t.jsx)("div",{className:"col-span-1 flex items-end justify-end",children:(0,t.jsx)(c.Button,{type:"button",variant:"ghost",size:"sm",onClick:()=>{var t,s;return t=e.id,s=i.id,void S(A.map(e=>e.id===t?{...e,fields:e.fields.filter(e=>e.id!==s)}:e))},className:"text-red-600 hover:text-red-700",children:(0,t.jsx)(g.Trash2,{className:"h-4 w-4"})})})]}),("select"===i.type||"competency"===i.type)&&(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsxs)(u.Label,{className:"text-xs",children:["competency"===i.type?"Niveaux de compétence":"Options"," (séparées par des virgules)"]}),(0,t.jsx)(d.Input,{value:"competency"===i.type?(i.competencyLevels||["Non acquis","En cours","Acquis","Maîtrisé"]).join(", "):(i.options||[]).join(", "),onChange:t=>{let s=t.target.value.split(",").map(e=>e.trim());"competency"===i.type?V(e.id,i.id,{competencyLevels:s}):V(e.id,i.id,{options:s})},placeholder:"competency"===i.type?"Non acquis, En cours, Acquis, Maîtrisé":"Option 1, Option 2, Option 3"})]}),"rating"===i.type&&(0,t.jsxs)("div",{className:"mt-3 grid grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{className:"text-xs",children:"Note min"}),(0,t.jsx)(d.Input,{type:"number",value:i.min||1,onChange:t=>V(e.id,i.id,{min:parseInt(t.target.value)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{className:"text-xs",children:"Note max"}),(0,t.jsx)(d.Input,{type:"number",value:i.max||5,onChange:t=>V(e.id,i.id,{max:parseInt(t.target.value)})})]})]})]},i.id))}),(0,t.jsxs)(c.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{var t;let i;return t=e.id,i={id:`field_${Date.now()}`,label:"Nouveau champ",type:"text",required:!1},void S(A.map(e=>e.id===t?{...e,fields:[...e.fields,i]}:e))},className:"mt-3 w-full",children:[(0,t.jsx)(f.Plus,{className:"h-4 w-4 mr-2"}),"Ajouter un champ"]})]})})})]})},e.id))})]})]})})]}):(0,t.jsx)("div",{className:"container mx-auto py-8 px-4 max-w-5xl",children:(0,t.jsx)(o.Card,{children:(0,t.jsxs)(o.CardContent,{className:"py-12 text-center",children:[(0,t.jsx)(N.FileText,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Modèle introuvable"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"Le modèle que vous recherchez n'existe pas ou a été supprimé."}),(0,t.jsx)(F.default,{href:"/dashboard/evaluations/portfolios/templates",children:(0,t.jsxs)(c.Button,{children:[(0,t.jsx)(h.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour aux modèles"]})})]})})})}e.s(["default",()=>B])}]);