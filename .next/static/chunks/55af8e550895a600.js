(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},503116,e=>{"use strict";let t=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],503116)},645760,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(647163);e.i(882205);var r=e.i(846932);let n=a.forwardRef(({className:e,variant:a="default",hoverable:n=!1,glow:i=!1,glowColor:l="rgba(51, 90, 207, 0.3)",...d},o)=>(0,t.jsxs)(r.motion.div,{ref:o,className:(0,s.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===a,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===a,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===a,"cursor-pointer":n,"hover:shadow-2xl hover:scale-[1.02]":n,"hover:bg-white/90 dark:hover:bg-gray-900/90":n},e),whileHover:n?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...d,children:[i&&(0,t.jsx)(r.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${l} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,t.jsx)("div",{className:"relative z-10",children:d.children})]}));n.displayName="GlassCard",e.s(["GlassCard",()=>n])},797548,e=>{"use strict";let t=(0,e.i(475254).default)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);e.s(["Filter",()=>t],797548)},882293,e=>{"use strict";let t=(0,e.i(475254).default)("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);e.s(["UserCheck",()=>t],882293)},98962,e=>{"use strict";let t=(0,e.i(475254).default)("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);e.s(["UserX",()=>t],98962)},117801,e=>{"use strict";let t=(0,e.i(475254).default)("UserMinus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);e.s(["UserMinus",()=>t],117801)},768377,e=>{"use strict";var t=e.i(843476),a=e.i(271645),s=e.i(266027),r=e.i(325715),n=e.i(920755),i=e.i(167881),l=e.i(645760),d=e.i(871689),o=e.i(555436),c=e.i(797548),u=e.i(440160),m=e.i(882293),x=e.i(98962),g=e.i(503116),h=e.i(117801),b=e.i(87316),y=e.i(647163),p=e.i(522016);e.i(882205);var f=e.i(846932),v=e.i(479370);function j(){let{user:e}=(0,r.useAuth)(),j=(0,n.createClient)(),[w,N]=(0,a.useState)(""),[k,_]=(0,a.useState)("all"),[C,z]=(0,a.useState)(""),[S,q]=(0,a.useState)(""),[D,U]=(0,a.useState)(""),[A,F]=(0,a.useState)(1),{data:E}=(0,s.useQuery)({queryKey:["all-sessions-for-history",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)return[];let{data:t,error:a}=await j.from("sessions").select("id, name, formations!inner(name, organization_id)").eq("formations.organization_id",e.organization_id).order("name",{ascending:!0});return a?(console.warn("Erreur récupération sessions:",a),[]):t||[]},enabled:!!e?.organization_id}),{data:M}=(0,s.useQuery)({queryKey:["student-search",w],queryFn:async()=>{if(!w||!e?.organization_id)return null;let{data:t,error:a}=await j.from("students").select("id").eq("organization_id",e.organization_id).or(`first_name.ilike.%${w}%,last_name.ilike.%${w}%,student_number.ilike.%${w}%`);return a?(console.warn("Erreur recherche étudiants:",a),null):t?.map(e=>e.id)||[]},enabled:!!w&&!!e?.organization_id}),{data:T,isLoading:$}=(0,s.useQuery)({queryKey:["attendance-history",e?.organization_id,w,M,k,C,S,D,A],queryFn:async()=>{if(!e?.organization_id)return{data:[],total:0};let t=j.from("attendance").select("*, students(first_name, last_name, student_number), sessions(name, formations(name, programs(name)))",{count:"exact"}).eq("organization_id",e.organization_id);if("all"!==k&&(t=t.eq("status",k)),C&&(t=t.gte("date",C)),S&&(t=t.lte("date",S)),D&&(t=t.eq("session_id",D)),w&&M&&M.length>0)t=t.in("student_id",M);else if(w&&(!M||0===M.length))return{data:[],total:0};t=t.order("date",{ascending:!1}).order("created_at",{ascending:!1}).range((A-1)*50,50*A-1);let{data:a,error:s,count:r}=await t;if(s)throw s;return{data:a||[],total:r||0}},enabled:!!e?.organization_id&&(!w||void 0!==M)}),P=Math.ceil((T?.total||0)/50),B=e=>{switch(e){case"present":return"Présent";case"absent":return"Absent";case"late":return"En retard";case"excused":return"Justifié";default:return e}},R=e=>{switch(e){case"present":return"bg-brand-blue-ghost text-brand-blue border-brand-blue/20";case"absent":return"bg-red-50 text-red-600 border-red-100";case"late":return"bg-brand-cyan-ghost text-brand-cyan border-brand-cyan/20";case"excused":return"bg-blue-50 text-blue-600 border-blue-100";default:return"bg-gray-50 text-gray-600 border-gray-100"}},H=async t=>{if(!T?.data||0===T.data.length)return void alert("Aucun émargement à exporter");try{if(!e?.organization_id)throw Error("Organization ID required");let a=j.from("attendance").select("*, students(first_name, last_name, student_number), sessions(name, formations(name, programs(name)))").eq("organization_id",e.organization_id);if("all"!==k&&(a=a.eq("status",k)),C&&(a=a.gte("date",C)),S&&(a=a.lte("date",S)),D&&(a=a.eq("session_id",D)),w&&M&&M.length>0)a=a.in("student_id",M);else if(w&&(!M||0===M.length))return void alert("Aucun étudiant trouvé avec ce critère de recherche");let{data:s,error:r}=await a.order("date",{ascending:!1}).order("created_at",{ascending:!1});if(r)throw r;let n=s.map(e=>{let t=e.students,a=e.sessions,s=a?.formations,r=s?.programs;return{Date:(0,y.formatDate)(e.date),Élève:`${t?.first_name||""} ${t?.last_name||""}`.trim(),Numéro:t?.student_number||"",Session:a?.name||"",Formation:s?.name||"",Programme:r?.name||"",Statut:B(e.status),"Retard (min)":e.late_minutes||0,Notes:e.notes||""}});"xlsx"===t?await (0,v.exportToExcel)({filename:`historique_emargements_${new Date().toISOString().split("T")[0]}.xlsx`,sheetName:"Historique Émargements",columns:[{header:"Date",key:"Date",width:12},{header:"Élève",key:"Élève",width:20},{header:"Numéro",key:"Numéro",width:15},{header:"Session",key:"Session",width:30},{header:"Formation",key:"Formation",width:25},{header:"Programme",key:"Programme",width:25},{header:"Statut",key:"Statut",width:12},{header:"Retard (min)",key:"Retard (min)",width:12},{header:"Notes",key:"Notes",width:30}],data:n}):(0,v.exportToCSV)(`historique_emargements_${new Date().toISOString().split("T")[0]}.csv`,n),alert(`Export ${t.toUpperCase()} r\xe9ussi ! ${n.length} \xe9margement(s) export\xe9(s).`)}catch(e){console.error("Erreur lors de l'export:",e),alert("Erreur lors de l'export des données")}};return(0,t.jsxs)("div",{className:"space-y-6 pb-8 max-w-[1600px] mx-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(p.default,{href:"/dashboard/attendance",children:(0,t.jsx)(i.Button,{variant:"ghost",size:"icon",children:(0,t.jsx)(d.ArrowLeft,{className:"h-5 w-5"})})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Historique des présences"}),(0,t.jsxs)("p",{className:"text-gray-500 mt-1",children:[T?.total||0," émargement",T?.total!==1?"s":""," trouvé",T?.total!==1?"s":""]})]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(i.Button,{variant:"outline",onClick:()=>H("csv"),children:[(0,t.jsx)(u.Download,{className:"mr-2 h-4 w-4"}),"CSV"]}),(0,t.jsxs)(i.Button,{variant:"outline",onClick:()=>H("xlsx"),children:[(0,t.jsx)(u.Download,{className:"mr-2 h-4 w-4"}),"Excel"]})]})]}),(0,t.jsxs)(l.GlassCard,{variant:"default",className:"p-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[(0,t.jsxs)("div",{className:"lg:col-span-2",children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Recherche"}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(o.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,t.jsx)("input",{type:"text",placeholder:"Nom, prénom ou numéro...",value:w,onChange:e=>{N(e.target.value),F(1)},className:"w-full pl-10 pr-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Statut"}),(0,t.jsxs)("select",{value:k,onChange:e=>{_(e.target.value),F(1)},className:"w-full px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm",children:[(0,t.jsx)("option",{value:"all",children:"Tous"}),(0,t.jsx)("option",{value:"present",children:"Présent"}),(0,t.jsx)("option",{value:"absent",children:"Absent"}),(0,t.jsx)("option",{value:"late",children:"En retard"}),(0,t.jsx)("option",{value:"excused",children:"Justifié"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Date début"}),(0,t.jsx)("input",{type:"date",value:C,onChange:e=>{z(e.target.value),F(1)},className:"w-full px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Date fin"}),(0,t.jsx)("input",{type:"date",value:S,onChange:e=>{q(e.target.value),F(1)},className:"w-full px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1.5 block",children:"Session"}),(0,t.jsxs)("select",{value:D,onChange:e=>{U(e.target.value),F(1)},className:"w-full px-4 py-2.5 rounded-xl bg-gray-50 border-transparent focus:bg-white focus:border-brand-blue/20 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm",children:[(0,t.jsx)("option",{value:"",children:"Toutes les sessions"}),E?.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsx)("div",{className:"flex items-end",children:(0,t.jsxs)(i.Button,{variant:"outline",onClick:()=>{N(""),_("all"),z(""),q(""),U(""),F(1)},className:"w-full",children:[(0,t.jsx)(c.Filter,{className:"mr-2 h-4 w-4"}),"Réinitialiser"]})})]})]}),(0,t.jsx)(l.GlassCard,{variant:"default",className:"overflow-hidden p-0",children:$?(0,t.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Chargement..."}):T&&T.data.length>0?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"divide-y divide-gray-100",children:T.data.map(e=>{let a=e.students,s=e.sessions,r=s?.formations;return(0,t.jsxs)(f.motion.div,{initial:{opacity:0},animate:{opacity:1},className:"p-4 hover:bg-gray-50/50 transition-colors flex items-center justify-between group",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,t.jsx)("div",{className:(0,y.cn)("h-10 w-10 rounded-full flex items-center justify-center transition-colors",R(e.status).replace("border-","").replace("text-","bg-opacity-20 text-")),children:(e=>{switch(e){case"present":return(0,t.jsx)(m.UserCheck,{className:"h-5 w-5"});case"absent":return(0,t.jsx)(x.UserX,{className:"h-5 w-5"});case"late":return(0,t.jsx)(g.Clock,{className:"h-5 w-5"});case"excused":return(0,t.jsx)(h.UserMinus,{className:"h-5 w-5"});default:return null}})(e.status)}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("p",{className:"font-semibold text-gray-900",children:[a?.first_name," ",a?.last_name,a?.student_number&&(0,t.jsxs)("span",{className:"text-sm text-gray-500 ml-2",children:["(",a.student_number,")"]})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-500 flex items-center gap-2 mt-1",children:[(0,t.jsx)("span",{className:"font-medium text-brand-blue/80",children:s?.name}),r?.name&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),(0,t.jsx)("span",{children:r.name})]}),(0,t.jsx)("span",{className:"w-1 h-1 rounded-full bg-gray-300"}),(0,t.jsx)(b.Calendar,{className:"h-3 w-3"}),(0,t.jsx)("span",{children:(0,y.formatDate)(e.date)})]}),e.notes&&(0,t.jsx)("p",{className:"text-xs text-gray-400 mt-1 italic",children:e.notes})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[e.late_minutes&&e.late_minutes>0&&(0,t.jsxs)("span",{className:"text-sm font-medium text-brand-cyan bg-brand-cyan-ghost px-2 py-1 rounded-md",children:["+",e.late_minutes," min"]}),(0,t.jsx)("span",{className:(0,y.cn)("px-3 py-1 rounded-full text-xs font-medium border",R(e.status)),children:B(e.status)})]})]},e.id)})}),P>1&&(0,t.jsxs)("div",{className:"p-4 border-t border-gray-100 bg-gray-50/30 flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["Page ",A," sur ",P]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>F(e=>Math.max(1,e-1)),disabled:1===A,children:"Précédent"}),(0,t.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>F(e=>Math.min(P,e+1)),disabled:A===P,children:"Suivant"})]})]})]}):(0,t.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Aucun émargement trouvé avec ces critères"})})]})}e.s(["default",()=>j])}]);