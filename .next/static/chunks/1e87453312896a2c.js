(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let a=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>a],107233)},645760,e=>{"use strict";var a=e.i(843476),i=e.i(271645),t=e.i(647163);e.i(882205);var s=e.i(846932);let r=i.forwardRef(({className:e,variant:i="default",hoverable:r=!1,glow:l=!1,glowColor:n="rgba(51, 90, 207, 0.3)",...d},o)=>(0,a.jsxs)(s.motion.div,{ref:o,className:(0,t.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===i,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===i,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===i,"cursor-pointer":r,"hover:shadow-2xl hover:scale-[1.02]":r,"hover:bg-white/90 dark:hover:bg-gray-900/90":r},e),whileHover:r?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...d,children:[l&&(0,a.jsx)(s.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${n} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,a.jsx)("div",{className:"relative z-10",children:d.children})]}));r.displayName="GlassCard",e.s(["GlassCard",()=>r])},605631,e=>{"use strict";let a=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>a],605631)},286536,e=>{"use strict";let a=(0,e.i(475254).default)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>a],286536)},738308,e=>{"use strict";let a=(0,e.i(475254).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>a],738308)},436332,e=>{"use strict";let a=(0,e.i(475254).default)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);e.s(["Edit",()=>a],436332)},182774,e=>{"use strict";var a=e.i(843476),i=e.i(325715),t=e.i(618566),s=e.i(271645);let r=(0,e.i(475254).default)("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var l=e.i(167881),n=e.i(970065),d=e.i(522016);function o({children:e,allowedRoles:o,fallback:c,redirectTo:u="/dashboard"}){let{user:m,isLoading:b}=(0,i.useAuth)(),h=(0,t.useRouter)(),[p,x]=(0,s.useState)(null);return((0,s.useEffect)(()=>{if(!b&&m){let e=m.role||"",a=o.includes(e);x(a),a||!u||c||h.push(u)}},[m,b,o,u,h,c]),b||null===p)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):p?(0,a.jsx)(a.Fragment,{children:e}):c?(0,a.jsx)(a.Fragment,{children:c}):(0,a.jsx)("div",{className:"container mx-auto py-16 px-4",children:(0,a.jsx)(n.Card,{className:"max-w-md mx-auto",children:(0,a.jsxs)(n.CardContent,{className:"py-12 text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,a.jsx)(r,{className:"h-8 w-8 text-red-600"})}),(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Accès non autorisé"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Vous n'avez pas les permissions nécessaires pour accéder à cette page."}),(0,a.jsx)(d.default,{href:"/dashboard",children:(0,a.jsx)(l.Button,{children:"Retour au tableau de bord"})})]})})})}e.s(["ADMIN_ROLES",0,["super_admin","admin","secretary","accountant"],"FINANCE_ROLES",0,["super_admin","admin","secretary","accountant"],"FORMATION_MANAGEMENT_ROLES",0,["super_admin","admin","secretary"],"RoleGuard",()=>o],182774)},785817,e=>{"use strict";var a=e.i(843476),i=e.i(271645),t=e.i(647163);e.i(882205);var s=e.i(846932);let r=i.forwardRef(({className:e,columns:i=4,gap:s="md",children:r,...l},n)=>(0,a.jsx)("div",{ref:n,className:(0,t.cn)("grid",{1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 md:grid-cols-2 lg:grid-cols-4"}[i],{sm:"gap-4",md:"gap-6",lg:"gap-8"}[s],e),...l,children:r}));r.displayName="BentoGrid";let l=i.forwardRef(({className:e,span:i=1,rowSpan:r=1,children:l,...n},d)=>(0,a.jsx)(s.motion.div,{ref:d,className:(0,t.cn)({1:"col-span-1",2:"col-span-1 md:col-span-2",3:"col-span-1 md:col-span-2 lg:col-span-3",4:"col-span-1 md:col-span-2 lg:col-span-4"}[i],{1:"row-span-1",2:"row-span-1 md:row-span-2",3:"row-span-1 md:row-span-3"}[r],e),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:[.16,1,.3,1]},...n,children:l}));l.displayName="BentoCard",e.s(["BentoCard",()=>l,"BentoGrid",()=>r])},805449,e=>{"use strict";var a=e.i(920755);let i=new class{supabase;constructor(e){this.supabase=e||(0,a.createClient)()}async getPublicFormations(e){let a=this.supabase.from("public_formations").select("*").eq("is_public",!0).not("published_at","is",null);e?.organizationId&&(a=a.eq("organization_id",e.organizationId)),e?.featured&&(a=a.eq("is_featured",!0)),e?.siteId&&(a=a.contains("available_at_sites",[e.siteId])),e?.search&&(a=a.or(`public_title.ilike.%${e.search}%,public_description.ilike.%${e.search}%,seo_keywords.cs.{${e.search}}`)),a=a.order("is_featured",{ascending:!1}).order("published_at",{ascending:!1}),e?.limit&&(a=a.limit(e.limit));let{data:i,error:t}=await a;if(t)throw t;return i||[]}async getBySlug(e){let{data:a,error:i}=await this.supabase.from("public_formations").select("*").eq("slug",e).eq("is_public",!0).not("published_at","is",null).maybeSingle();if(i)throw i;return a}async getById(e,a){let i=this.supabase.from("public_formations").select("*").eq("id",e);a&&(i=i.eq("organization_id",a));let{data:t,error:s}=await i.single();if(s)throw s;return t}async getAll(e,a){let i=this.supabase.from("public_formations").select("*").eq("organization_id",e);a?.isPublic!==void 0&&(i=i.eq("is_public",a.isPublic)),a?.search&&(i=i.or(`public_title.ilike.%${a.search}%,slug.ilike.%${a.search}%`));let{data:t,error:s}=await i.order("created_at",{ascending:!1});if(s)throw s;return t||[]}async create(e){!e.slug&&e.public_title&&(e.slug=this.generateSlug(e.public_title,e.organization_id));let{data:a,error:i}=await this.supabase.from("public_formations").insert(e).select().single();if(i)throw i;return a}async update(e,a){if(a.public_title&&!a.slug){let i=await this.getById(e);i.organization_id&&(a.slug=this.generateSlug(a.public_title,i.organization_id))}a.is_public&&!a.published_at&&((await this.getById(e)).published_at||(a.published_at=new Date().toISOString()));let{data:i,error:t}=await this.supabase.from("public_formations").update(a).eq("id",e).select().single();if(t)throw t;return i}async delete(e){let{error:a}=await this.supabase.from("public_formations").delete().eq("id",e);if(a)throw a}generateSlug(e,a){let i=e.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").slice(0,100);return`${i}-${a.slice(0,8)}`}async createEnrollment(e){let a=await this.getById(e.public_formation_id,e.organization_id);if(!a.allow_online_registration)throw Error("Cette formation n'accepte pas les inscriptions en ligne");if(a.registration_deadline){let e=new Date(a.registration_deadline);if(new Date>e)throw Error("La date limite d'inscription est dépassée")}let{data:i,error:t}=await this.supabase.from("public_enrollments").insert(e).select().single();if(t)throw t;return i}async getEnrollments(e,a){let i=this.supabase.from("public_enrollments").select("*, public_formations(*), sites(*)").eq("organization_id",e);a?.status&&(i=i.eq("status",a.status)),a?.formationId&&(i=i.eq("public_formation_id",a.formationId)),a?.search&&(i=i.or(`first_name.ilike.%${a.search}%,last_name.ilike.%${a.search}%,email.ilike.%${a.search}%`));let{data:t,error:s}=await i.order("created_at",{ascending:!1});if(s)throw s;return t||[]}async updateEnrollmentStatus(e,a,i,t){let s={status:a,processed_at:new Date().toISOString()};i&&(s.processed_by=i),t&&(s.admin_notes=t);let{data:r,error:l}=await this.supabase.from("public_enrollments").update(s).eq("id",e).select().single();if(l)throw l;return r}};e.s(["publicCatalogService",0,i])},222921,e=>{"use strict";var a=e.i(843476),i=e.i(266027),t=e.i(954616),s=e.i(912598),r=e.i(325715),l=e.i(805449),n=e.i(167881),d=e.i(645760),o=e.i(785817),c=e.i(6799),u=e.i(107233),m=e.i(248256),b=e.i(286536),h=e.i(436332),p=e.i(605631),x=e.i(738308),g=e.i(778917),f=e.i(810980),y=e.i(178583),j=e.i(761911),v=e.i(283086),w=e.i(182774),N=e.i(920755),_=e.i(522016);e.i(882205);var C=e.i(846932),k=e.i(647163);function z(){return(0,a.jsx)(w.RoleGuard,{allowedRoles:w.FORMATION_MANAGEMENT_ROLES,children:(0,a.jsx)(B,{})})}function B(){let{user:e}=(0,r.useAuth)(),b=(0,s.useQueryClient)(),{addToast:h}=(0,c.useToast)(),x=(0,N.createClient)(),{data:w}=(0,i.useQuery)({queryKey:["organization-code",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)return null;let{data:a,error:i}=await x.from("organizations").select("id, code").eq("id",e.organization_id).maybeSingle();if(i)throw i;return a},enabled:!!e?.organization_id}),{data:k,isLoading:z}=(0,i.useQuery)({queryKey:["public-formations",e?.organization_id],queryFn:async()=>e?.organization_id?await l.publicCatalogService.getAll(e.organization_id):[],enabled:!!e?.organization_id}),{data:B}=(0,i.useQuery)({queryKey:["public-enrollments",e?.organization_id],queryFn:async()=>e?.organization_id?l.publicCatalogService.getEnrollments(e.organization_id,{status:"pending"}):[],enabled:!!e?.organization_id}),S=(0,t.useMutation)({mutationFn:async({id:e,isPublic:a})=>l.publicCatalogService.update(e,{is_public:a}),onSuccess:()=>{b.invalidateQueries({queryKey:["public-formations"]}),h({title:"Succès",description:"Formation mise à jour avec succès",type:"success"})}});if(!e?.organization_id)return(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("p",{children:"Aucune organisation"})});let E=k?.filter(e=>e.is_public)||[],G=k?.filter(e=>!e.is_public)||[];return(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)(C.motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"flex justify-between items-start mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold bg-gradient-to-r from-brand-blue to-brand-cyan bg-clip-text text-transparent",children:"Catalogue Public"}),(0,a.jsx)("p",{className:"text-gray-600 mt-2",children:"Gérez vos formations publiques et inscriptions en ligne"})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[w&&(0,a.jsx)(_.default,{href:`/cataloguepublic/${w.code||w.id}`,target:"_blank",children:(0,a.jsxs)(n.Button,{variant:"outline",className:"border-brand-blue/20 hover:bg-brand-blue/5",children:[(0,a.jsx)(g.ExternalLink,{className:"w-4 h-4 mr-2"}),"Voir le site public"]})}),(0,a.jsxs)(n.Button,{className:"bg-brand-blue hover:bg-brand-blue-dark shadow-lg shadow-brand-blue/20",children:[(0,a.jsx)(u.Plus,{className:"w-4 h-4 mr-2"}),"Nouvelle formation"]})]})]}),(0,a.jsxs)(o.BentoGrid,{columns:4,gap:"md",children:[(0,a.jsx)(o.BentoCard,{span:1,children:(0,a.jsx)(d.GlassCard,{variant:"premium",className:"p-6 h-full border-2 border-transparent hover:border-brand-blue/10 transition-all duration-500",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-brand-blue",children:k?.length||0}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Total formations"})]}),(0,a.jsx)(f.BookOpen,{className:"w-8 h-8 text-brand-blue/30"})]})})}),(0,a.jsx)(o.BentoCard,{span:1,children:(0,a.jsx)(d.GlassCard,{variant:"premium",className:"p-6 h-full border-2 border-transparent hover:border-green-500/10 transition-all duration-500",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-green-600",children:E.length}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Publiées"})]}),(0,a.jsx)(p.CheckCircle,{className:"w-8 h-8 text-green-500/30"})]})})}),(0,a.jsx)(o.BentoCard,{span:1,children:(0,a.jsx)(d.GlassCard,{variant:"premium",className:"p-6 h-full border-2 border-transparent hover:border-gray-400/10 transition-all duration-500",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-gray-600",children:G.length}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Brouillons"})]}),(0,a.jsx)(y.FileText,{className:"w-8 h-8 text-gray-400/30"})]})})}),(0,a.jsx)(o.BentoCard,{span:1,children:(0,a.jsx)(d.GlassCard,{variant:"premium",className:"p-6 h-full border-2 border-transparent hover:border-brand-cyan/10 transition-all duration-500",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-brand-cyan",children:B?.length||0}),(0,a.jsx)("div",{className:"text-sm text-gray-600 mt-1",children:"Inscriptions en attente"})]}),(0,a.jsx)(j.Users,{className:"w-8 h-8 text-brand-cyan/30"})]})})})]}),E.length>0&&(0,a.jsxs)(C.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,a.jsx)(v.Sparkles,{className:"w-5 h-5 text-brand-blue"}),(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Formations publiées"})]}),(0,a.jsx)(o.BentoGrid,{columns:3,gap:"md",children:E.map(e=>(0,a.jsx)(o.BentoCard,{span:1,children:(0,a.jsx)(q,{formation:e,onTogglePublish:a=>S.mutate({id:e.id,isPublic:a})})},e.id))})]}),G.length>0&&(0,a.jsxs)(C.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-4 mt-8",children:[(0,a.jsx)(y.FileText,{className:"w-5 h-5 text-gray-500"}),(0,a.jsx)("h2",{className:"text-xl font-bold",children:"Brouillons"})]}),(0,a.jsx)(o.BentoGrid,{columns:3,gap:"md",children:G.map(e=>(0,a.jsx)(o.BentoCard,{span:1,children:(0,a.jsx)(q,{formation:e,onTogglePublish:a=>S.mutate({id:e.id,isPublic:a})})},e.id))})]}),z?(0,a.jsx)(d.GlassCard,{variant:"default",className:"p-12 text-center border-2 border-brand-blue/20 bg-gradient-to-br from-brand-blue-ghost/30 to-brand-cyan-ghost/30",children:(0,a.jsx)("div",{className:"animate-pulse",children:"Chargement..."})}):k&&0===k.length?(0,a.jsxs)(d.GlassCard,{variant:"default",className:"p-12 text-center border-2 border-brand-blue/20 bg-gradient-to-br from-brand-blue-ghost/30 to-brand-cyan-ghost/30",children:[(0,a.jsx)(m.Globe,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6 text-lg",children:"Aucune formation dans le catalogue"}),(0,a.jsxs)(n.Button,{className:"bg-brand-blue hover:bg-brand-blue-dark shadow-lg shadow-brand-blue/20",children:[(0,a.jsx)(u.Plus,{className:"w-4 h-4 mr-2"}),"Créer la première formation"]})]}):null]})}function q({formation:e,onTogglePublish:i}){return(0,a.jsxs)(d.GlassCard,{variant:"premium",className:"p-6 h-full flex flex-col border-2 border-transparent hover:border-brand-blue/10 transition-all duration-500",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"flex justify-between items-start mb-3",children:(0,a.jsx)("h3",{className:"font-bold text-lg line-clamp-2 flex-1 pr-2",children:e.public_title})}),e.is_featured&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs bg-gradient-to-r from-yellow-100 to-yellow-50 text-yellow-800 rounded-full mb-3 border border-yellow-200",children:[(0,a.jsx)(v.Sparkles,{className:"w-3 h-3"}),"Mise en avant"]}),(0,a.jsx)("div",{className:"flex items-center gap-2 mb-3",children:e.is_public?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.CheckCircle,{className:"w-4 h-4 text-green-600"}),(0,a.jsx)("span",{className:"text-sm text-green-600 font-medium",children:"Publiée"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.XCircle,{className:"w-4 h-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"Brouillon"})]})}),e.slug&&(0,a.jsxs)("div",{className:"text-xs text-gray-500 mb-4 font-mono bg-gray-50 px-2 py-1 rounded",children:["/formations/",e.slug]})]}),(0,a.jsxs)("div",{className:"flex gap-2 pt-4 border-t border-gray-200",children:[(0,a.jsx)(_.default,{href:`/formations/${e.slug||e.id}`,target:"_blank",className:"flex-1",children:(0,a.jsxs)(n.Button,{variant:"outline",size:"sm",className:"w-full border-brand-blue/20 hover:bg-brand-blue/5",children:[(0,a.jsx)(b.Eye,{className:"w-3 h-3 mr-1"}),"Voir"]})}),(0,a.jsx)(n.Button,{variant:"outline",size:"sm",className:"border-brand-blue/20 hover:bg-brand-blue/5",children:(0,a.jsx)(h.Edit,{className:"w-3 h-3"})}),(0,a.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>i(!e.is_public),className:(0,k.cn)("border-brand-blue/20 hover:bg-brand-blue/5",e.is_public?"hover:border-red-300":"hover:border-green-300"),children:e.is_public?(0,a.jsx)(x.XCircle,{className:"w-3 h-3 text-red-600"}):(0,a.jsx)(p.CheckCircle,{className:"w-3 h-3 text-green-600"})})]})]})}e.s(["default",()=>z])}]);