(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,487894,e=>{"use strict";var a=e.i(843476),t=e.i(271645),r=e.i(266027),s=e.i(954616),n=e.i(912598),i=e.i(325715),l=e.i(631259),o=e.i(134150),d=e.i(920755),c=e.i(167881),u=e.i(645760),m=e.i(785817),x=e.i(107233),h=e.i(555436),g=e.i(178583),b=e.i(898791),p=e.i(605631),y=e.i(25652),v=e.i(37727),f=e.i(212426),j=e.i(350627),N=e.i(561659),w=e.i(115057),_=e.i(649582),C=e.i(635408),k=e.i(664659),S=e.i(655900),z=e.i(647163),E=e.i(522016),D=e.i(129228),R=e.i(555706),q=e.i(841891),T=e.i(438814),P=e.i(322787),B=e.i(785183),F=e.i(93230),A=e.i(872526),U=e.i(234239),M=e.i(559559),G=e.i(731195);e.i(882205);var K=e.i(846932),L=e.i(88653),H=e.i(182774);function O(){return(0,a.jsx)(H.RoleGuard,{allowedRoles:H.FINANCE_ROLES,children:(0,a.jsx)(Q,{})})}function Q(){let{user:e}=(0,i.useAuth)(),H=(0,d.createClient)(),O=(0,n.useQueryClient)(),[Q,W]=(0,t.useState)(""),[I,$]=(0,t.useState)("all"),[Y,V]=(0,t.useState)("all"),[X,J]=(0,t.useState)(!1),[Z,ee]=(0,t.useState)("all"),[ea,et]=(0,t.useState)("all"),[er,es]=(0,t.useState)(!1),[en,ei]=(0,t.useState)(!1),[el,eo]=(0,t.useState)(""),{data:ed}=(0,r.useQuery)({queryKey:["sessions",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)return[];let{data:a,error:t}=await H.from("sessions").select("id, name, start_date, end_date").eq("organization_id",e.organization_id).order("start_date",{ascending:!1}).limit(100);return t?(console.error("Erreur rÃ©cupÃ©ration sessions:",t),[]):a||[]},enabled:!!e?.organization_id}),{data:ec}=(0,r.useQuery)({queryKey:["charge-categories",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)return[];let a=await o.sessionChargesService.getCategories(e.organization_id);return 0===a.length?(await o.sessionChargesService.initDefaultCategories(e.organization_id),o.sessionChargesService.getCategories(e.organization_id)):a},enabled:!!e?.organization_id}),{data:eu,isLoading:em}=(0,r.useQuery)({queryKey:["all-session-charges",e?.organization_id],queryFn:async()=>e?.organization_id?await o.sessionChargesService.getAll(e.organization_id):[],enabled:!!e?.organization_id&&er}),[ex,eh]=(0,t.useState)({description:"",amount:"",currency:"EUR",charge_date:new Date().toISOString().split("T")[0],category_id:"",payment_method:"",payment_status:"pending",vendor:"",vendor_invoice_number:"",vendor_invoice_date:"",notes:""}),eg=(0,s.useMutation)({mutationFn:async()=>{if(!e?.organization_id)throw Error("Organisation non trouvÃ©e");if(!el)throw Error("Veuillez sÃ©lectionner une session");if(!ex.description||!ex.amount)throw Error("La description et le montant sont requis");return o.sessionChargesService.create(e.organization_id,el,{description:ex.description,amount:parseFloat(ex.amount),currency:ex.currency,charge_date:ex.charge_date,category_id:ex.category_id||null,payment_method:ex.payment_method||null,payment_status:ex.payment_status,paid_at:"paid"===ex.payment_status?new Date().toISOString():null,vendor:ex.vendor||null,vendor_invoice_number:ex.vendor_invoice_number||null,vendor_invoice_date:ex.vendor_invoice_date||null,notes:ex.notes||null})},onSuccess:()=>{O.invalidateQueries({queryKey:["session-charges"]}),O.invalidateQueries({queryKey:["session-charges-summary"]}),O.invalidateQueries({queryKey:["all-session-charges",e?.organization_id]}),ei(!1),eh({description:"",amount:"",currency:"EUR",charge_date:new Date().toISOString().split("T")[0],category_id:"",payment_method:"",payment_status:"pending",vendor:"",vendor_invoice_number:"",vendor_invoice_date:"",notes:""}),eo("")}}),eb=(0,s.useMutation)({mutationFn:async e=>l.invoiceService.convertQuoteToInvoice(e),onSuccess:()=>{O.invalidateQueries({queryKey:["invoices"]}),O.invalidateQueries({queryKey:["overdue-invoices"]})}}),{data:ep,isLoading:ey}=(0,r.useQuery)({queryKey:["invoices",e?.organization_id,Q,I,Z],queryFn:async()=>{if(!e?.organization_id)return[];try{return await l.invoiceService.getAll(e.organization_id,{search:Q,status:"all"!==I?I:void 0,documentType:"all"!==Z?Z:void 0})}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01")return[];throw e}},enabled:!!e?.organization_id,retry:!1}),ev=ep?.filter(e=>"quotes"===ea?"quote"===e.document_type:"invoices"!==ea||"invoice"===e.document_type||!e.document_type)||[],{data:ef}=(0,r.useQuery)({queryKey:["overdue-invoices",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)return[];try{return await l.invoiceService.getOverdue(e.organization_id)}catch(e){if(e?.code==="PGRST116"||e?.code==="42P01")return[];throw e}},enabled:!!e?.organization_id,retry:!1}),{data:ej}=(0,r.useQuery)({queryKey:["payment-stats",e?.organization_id,Y],queryFn:async()=>{if(!e?.organization_id)return null;let a=null,t=new Date;switch(Y){case"month":a=new Date(t.getFullYear(),t.getMonth(),1);break;case"quarter":let r=Math.floor(t.getMonth()/3);a=new Date(t.getFullYear(),3*r,1);break;case"year":a=new Date(t.getFullYear(),0,1);break;default:a=null}let s=H.from("payments").select("amount, currency, payment_method, paid_at").eq("organization_id",e.organization_id).eq("status","completed");a&&(s=s.gte("paid_at",a.toISOString()));let{data:n,error:i}=await s;if(i){if("PGRST116"===i.code||"42P01"===i.code||"PGRST301"===i.code||"400"===i.code||i.message?.includes("relation")||i.message?.includes("relationship")||i.message?.includes("does not exist")||i.message?.includes("schema cache")||i.message?.includes("column")||i.message?.includes("permission"))return console.warn("Erreur lors de la rÃ©cupÃ©ration des paiements:",i.message),{totalAmount:0,count:0,byMethod:[],monthlyData:[]};throw i}let l=n||[],o=l.reduce((e,a)=>e+Number(a.amount),0),d={};l.forEach(e=>{let a=e.payment_method||"unknown";d[a]=(d[a]||0)+Number(e.amount)});let c={};l.forEach(e=>{if(e.paid_at){let a=new Date(e.paid_at),t=`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}`;c[t]=(c[t]||0)+Number(e.amount)}});let u=Object.entries(c).sort(([e],[a])=>e.localeCompare(a)).slice(-6).map(([e,a])=>({month:new Date(e+"-01").toLocaleDateString("fr-FR",{month:"short",year:"numeric"}),amount:Math.round(a)})),m=Object.entries(d).map(([e,a])=>({name:"cash"===e?"EspÃ¨ces":"mobile_money"===e?"Mobile Money":"card"===e?"Carte":"bank_transfer"===e?"Virement":e,value:Math.round(a),color:"cash"===e?"#335ACF":"mobile_money"===e?"#34B9EE":"card"===e?"#3B82F6":"bank_transfer"===e?"#8B5CF6":"#6B7280"}));return{totalAmount:o,count:n?.length||0,byMethod:m,monthlyData:u}},enabled:!!e?.organization_id}),eN=ep?.filter(e=>"invoice"===e.document_type||!e.document_type)||[],ew=eN.filter(e=>"paid"===e.status).reduce((e,a)=>e+Number(a.total_amount),0)||0,e_=ef?.reduce((e,a)=>e+Number(a.total_amount)-Number(a.paid_amount||0),0)||0,eC=eN.filter(e=>["sent","partial"].includes(e.status)).reduce((e,a)=>{let t=a.paid_amount||0;return e+Number(a.total_amount)-Number(t)},0)||0,ek={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5,ease:[.16,1,.3,1]}}};return(0,a.jsxs)(K.motion.div,{className:"space-y-8 pb-12 max-w-[1600px] mx-auto",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"visible",children:[(0,a.jsxs)(K.motion.div,{variants:ek,className:"relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-mesh opacity-30 rounded-3xl"}),(0,a.jsxs)("div",{className:"relative flex flex-col md:flex-row items-start md:items-center justify-between gap-6 p-8 rounded-3xl bg-white/50 backdrop-blur-sm border border-gray-100",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-3",children:[(0,a.jsx)(K.motion.div,{className:"p-3 rounded-2xl bg-gradient-to-br from-brand-blue to-brand-cyan",whileHover:{scale:1.05,rotate:5},transition:{duration:.3},children:(0,a.jsx)(f.DollarSign,{className:"h-6 w-6 text-white"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-5xl font-black text-gray-900 tracking-tightest font-display",children:"Paiements"}),(0,a.jsxs)("div",{className:"flex items-center gap-3 mt-2",children:[(0,a.jsxs)("span",{className:"px-4 py-1.5 bg-brand-blue-ghost text-brand-blue rounded-full text-sm font-semibold",children:[ev.length," documents"]}),(0,a.jsx)("span",{className:"text-sm text-gray-400",children:"â€¢"}),(0,a.jsxs)("span",{className:"text-sm text-gray-500 font-medium",children:[(0,z.formatCurrency)(ew+eC+e_,"EUR")," au total"]})]})]})]}),(0,a.jsx)("p",{className:"text-lg text-gray-600 font-light ml-[72px]",children:"GÃ©rez vos devis, factures et suivez les paiements en temps rÃ©el"})]}),(0,a.jsx)(K.motion.div,{whileHover:{scale:1.02,y:-2},whileTap:{scale:.98},children:(0,a.jsx)(E.default,{href:"/dashboard/payments/new",children:(0,a.jsxs)(c.Button,{className:"h-14 px-8 text-base font-semibold shadow-2xl shadow-brand-blue/20 hover:shadow-brand-blue/40 bg-gradient-to-r from-brand-blue to-brand-cyan hover:opacity-90 transition-all duration-300",children:[(0,a.jsx)(x.Plus,{className:"mr-2 h-5 w-5"}),"Nouvelle transaction"]})})})]})]}),(0,a.jsx)(K.motion.div,{variants:ek,children:(0,a.jsx)(m.BentoGrid,{columns:4,gap:"md",children:[{title:"Total payÃ©",value:(0,z.formatCurrency)(ew,"EUR"),icon:p.CheckCircle,color:"text-emerald-600",bg:"bg-gradient-to-br from-emerald-50 to-emerald-100/50",borderColor:"border-emerald-200",trend:"+12%",trendUp:!0},{title:"En attente",value:(0,z.formatCurrency)(eC,"EUR"),icon:b.AlertCircle,color:"text-amber-600",bg:"bg-gradient-to-br from-amber-50 to-amber-100/50",borderColor:"border-amber-200",trend:"-5%",trendUp:!1},{title:"En retard",value:(0,z.formatCurrency)(e_,"EUR"),icon:v.X,color:"text-red-600",bg:"bg-gradient-to-br from-red-50 to-red-100/50",borderColor:"border-red-200",trend:"-15%",trendUp:!1},{title:"Total factures",value:eN.length.toString(),icon:j.Receipt,color:"text-brand-blue",bg:"bg-gradient-to-br from-brand-blue-ghost to-brand-blue-pale/50",borderColor:"border-brand-blue-pale",trend:"+8%",trendUp:!0}].map((e,t)=>(0,a.jsx)(m.BentoCard,{span:1,children:(0,a.jsx)(K.motion.div,{whileHover:{y:-8,scale:1.02},transition:{duration:.4,ease:[.16,1,.3,1]},children:(0,a.jsxs)(u.GlassCard,{variant:"premium",hoverable:!0,glow:2===t&&e_>0,glowColor:"rgba(239, 68, 68, 0.2)",className:(0,z.cn)("h-full p-8 border-2",e.borderColor,e.bg),children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1",children:e.title}),(0,a.jsx)("div",{className:(0,z.cn)("text-3xl font-black tracking-tighter font-display mt-2",e.color),children:e.value})]}),(0,a.jsx)(K.motion.div,{className:(0,z.cn)("p-4 rounded-2xl shadow-lg",e.bg),whileHover:{scale:1.15,rotate:10},transition:{duration:.3},children:(0,a.jsx)(e.icon,{className:(0,z.cn)("h-6 w-6",e.color)})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 pt-4 border-t border-gray-200/50",children:[(0,a.jsxs)(K.motion.div,{initial:{scale:0},animate:{scale:1},transition:{delay:.1*t+.3,type:"spring"},className:(0,z.cn)("flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold",e.trendUp?"bg-emerald-100 text-emerald-700":"bg-red-100 text-red-700"),children:[e.trendUp?"â†—":"â†˜"," ",e.trend]}),(0,a.jsx)("span",{className:"text-xs text-gray-500 font-medium",children:"vs mois dernier"})]})]})})},e.title))})}),(0,a.jsx)(K.motion.div,{variants:ek,children:(0,a.jsxs)(u.GlassCard,{variant:"default",className:"p-4 shadow-xl",children:[(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 items-center justify-between",children:[(0,a.jsx)("div",{className:"relative flex p-1.5 bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl w-full lg:w-auto shadow-inner",children:["all","quotes","invoices"].map(e=>(0,a.jsxs)(K.motion.button,{onClick:()=>et(e),className:(0,z.cn)("relative px-8 py-3 rounded-xl text-sm font-semibold transition-all duration-300 flex-1 lg:flex-none",ea===e?"text-white":"text-gray-600 hover:text-gray-900"),whileHover:{scale:ea!==e?1.05:1},whileTap:{scale:.98},children:[ea===e&&(0,a.jsx)(K.motion.div,{layoutId:"activeTabBg",className:"absolute inset-0 bg-gradient-to-r from-brand-blue to-brand-cyan rounded-xl shadow-lg",transition:{duration:.4,ease:[.16,1,.3,1]}}),(0,a.jsx)("span",{className:"relative z-10",children:"all"===e?"Tous":"quotes"===e?"Devis":"Factures"})]},e))}),(0,a.jsxs)("div",{className:"flex flex-1 w-full lg:w-auto gap-3",children:[(0,a.jsxs)("div",{className:"relative flex-1 group",children:[(0,a.jsx)(h.Search,{className:"absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400 group-focus-within:text-brand-blue transition-all duration-300 group-focus-within:scale-110"}),(0,a.jsx)("input",{type:"text",placeholder:"Rechercher un document...",value:Q,onChange:e=>W(e.target.value),className:"w-full pl-12 pr-4 py-3 rounded-xl bg-gray-50 border-2 border-transparent focus:bg-white focus:border-brand-blue/30 focus:ring-4 focus:ring-brand-blue/10 transition-all outline-none text-sm font-medium placeholder:text-gray-400"})]}),(0,a.jsx)(K.motion.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:(0,a.jsxs)(c.Button,{variant:"ghost",onClick:()=>J(!X),className:(0,z.cn)("h-12 px-5 gap-2 rounded-xl font-semibold transition-all duration-300",X?"bg-brand-blue text-white shadow-lg shadow-brand-blue/30":"bg-gray-50 text-gray-700 hover:bg-gray-100"),children:[(0,a.jsx)(_.SlidersHorizontal,{className:"h-4 w-4"}),"Filtres"]})})]})]}),(0,a.jsx)(L.AnimatePresence,{children:X&&(0,a.jsx)(K.motion.div,{initial:{height:0,opacity:0,y:-20},animate:{height:"auto",opacity:1,y:0},exit:{height:0,opacity:0,y:-20},transition:{duration:.4,ease:[.16,1,.3,1]},className:"overflow-hidden",children:(0,a.jsxs)("div",{className:"pt-6 mt-6 grid grid-cols-1 md:grid-cols-3 gap-5 border-t border-gray-200",children:[(0,a.jsxs)(K.motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.1},className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs font-bold text-gray-700 uppercase tracking-widest",children:[(0,a.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-blue"}),"Statut"]}),(0,a.jsxs)("select",{value:I,onChange:e=>$(e.target.value),className:"w-full px-4 py-3 rounded-xl bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 focus:border-brand-blue/50 focus:ring-4 focus:ring-brand-blue/10 outline-none text-sm font-medium transition-all shadow-sm",children:[(0,a.jsx)("option",{value:"all",children:"Tous les statuts"}),(0,a.jsx)("option",{value:"paid",children:"âœ“ PayÃ©e"}),(0,a.jsx)("option",{value:"sent",children:"â†’ EnvoyÃ©e"}),(0,a.jsx)("option",{value:"partial",children:"âš¡ Partielle"}),(0,a.jsx)("option",{value:"overdue",children:"âš  En retard"}),(0,a.jsx)("option",{value:"draft",children:"ðŸ“ Brouillon"})]})]}),(0,a.jsxs)(K.motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.2},className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs font-bold text-gray-700 uppercase tracking-widest",children:[(0,a.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-brand-cyan"}),"PÃ©riode"]}),(0,a.jsxs)("select",{value:Y,onChange:e=>V(e.target.value),className:"w-full px-4 py-3 rounded-xl bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 focus:border-brand-cyan/50 focus:ring-4 focus:ring-brand-cyan/10 outline-none text-sm font-medium transition-all shadow-sm",children:[(0,a.jsx)("option",{value:"all",children:"Toutes les pÃ©riodes"}),(0,a.jsx)("option",{value:"month",children:"ðŸ“… Ce mois"}),(0,a.jsx)("option",{value:"quarter",children:"ðŸ“Š Ce trimestre"}),(0,a.jsx)("option",{value:"year",children:"ðŸ“† Cette annÃ©e"})]})]}),(0,a.jsxs)(K.motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3},className:"space-y-2",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-xs font-bold text-gray-700 uppercase tracking-widest",children:[(0,a.jsx)("div",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),"Type de document"]}),(0,a.jsxs)("select",{value:Z,onChange:e=>ee(e.target.value),className:"w-full px-4 py-3 rounded-xl bg-gradient-to-br from-gray-50 to-white border-2 border-gray-200 focus:border-emerald-500/50 focus:ring-4 focus:ring-emerald-500/10 outline-none text-sm font-medium transition-all shadow-sm",children:[(0,a.jsx)("option",{value:"all",children:"Tous les types"}),(0,a.jsx)("option",{value:"quote",children:"ðŸ“„ Devis"}),(0,a.jsx)("option",{value:"invoice",children:"ðŸ§¾ Factures"})]})]})]})})})]})}),ej&&(ej.byMethod.length>0||ej.monthlyData.length>0)&&(0,a.jsxs)(K.motion.div,{variants:ek,className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[ej.byMethod.length>0&&(0,a.jsx)(K.motion.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.6,ease:[.16,1,.3,1]},children:(0,a.jsxs)(u.GlassCard,{variant:"premium",className:"p-8 h-full border-2 border-gray-100 shadow-xl hover:shadow-2xl transition-all duration-500",children:[(0,a.jsx)("div",{className:"mb-8 flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(K.motion.div,{className:"p-3 rounded-2xl bg-gradient-to-br from-brand-blue-ghost to-brand-blue-pale",whileHover:{scale:1.1,rotate:5},children:(0,a.jsx)(N.CreditCard,{className:"h-6 w-6 text-brand-blue"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-black text-gray-900 tracking-tight font-display",children:"MÃ©thodes de paiement"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 font-medium",children:"RÃ©partition par type"})]})]})}),(0,a.jsxs)("div",{className:"h-[340px] relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-mesh opacity-20 rounded-2xl"}),(0,a.jsx)(G.ResponsiveContainer,{width:"100%",height:"100%",children:(0,a.jsxs)(q.PieChart,{children:[(0,a.jsx)(T.Pie,{data:ej.byMethod,cx:"50%",cy:"50%",innerRadius:70,outerRadius:100,paddingAngle:6,dataKey:"value",children:ej.byMethod.map((e,t)=>(0,a.jsx)(P.Cell,{fill:e.color},`cell-${t}`))}),(0,a.jsx)(U.Tooltip,{formatter:e=>(0,z.formatCurrency)(Number(e),"EUR"),contentStyle:{borderRadius:"16px",border:"none",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",padding:"12px 16px",fontWeight:"600"}}),(0,a.jsx)(M.Legend,{verticalAlign:"bottom",height:48,wrapperStyle:{fontSize:"14px",fontWeight:"600"}})]})})]})]})}),ej.monthlyData.length>0&&(0,a.jsx)(K.motion.div,{initial:{opacity:0,y:40},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1,ease:[.16,1,.3,1]},children:(0,a.jsxs)(u.GlassCard,{variant:"premium",className:"p-8 h-full border-2 border-gray-100 shadow-xl hover:shadow-2xl transition-all duration-500",children:[(0,a.jsx)("div",{className:"mb-8 flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(K.motion.div,{className:"p-3 rounded-2xl bg-gradient-to-br from-cyan-50 to-cyan-100",whileHover:{scale:1.1,rotate:5},children:(0,a.jsx)(y.TrendingUp,{className:"h-6 w-6 text-brand-cyan"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-xl font-black text-gray-900 tracking-tight font-display",children:"Ã‰volution des paiements"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 font-medium",children:"6 derniers mois"})]})]})}),(0,a.jsxs)("div",{className:"h-[340px] relative",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-gradient-aurora opacity-20 rounded-2xl"}),(0,a.jsx)(G.ResponsiveContainer,{width:"100%",height:"100%",children:(0,a.jsxs)(D.LineChart,{data:ej.monthlyData,children:[(0,a.jsx)(A.CartesianGrid,{strokeDasharray:"5 5",vertical:!1,stroke:"#E5E7EB"}),(0,a.jsx)(B.XAxis,{dataKey:"month",axisLine:!1,tickLine:!1,tick:{fill:"#6B7280",fontSize:12,fontWeight:"600"},dy:12}),(0,a.jsx)(F.YAxis,{axisLine:!1,tickLine:!1,tick:{fill:"#6B7280",fontSize:12,fontWeight:"600"},dx:-10}),(0,a.jsx)(U.Tooltip,{formatter:e=>(0,z.formatCurrency)(Number(e),"EUR"),contentStyle:{borderRadius:"16px",border:"none",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)",padding:"12px 16px",fontWeight:"600"}}),(0,a.jsx)(R.Line,{type:"monotone",dataKey:"amount",stroke:"url(#colorGradient)",strokeWidth:4,dot:{fill:"#34B9EE",r:5,strokeWidth:3,stroke:"#fff"},activeDot:{r:7,strokeWidth:0,fill:"#274472"}}),(0,a.jsx)("defs",{children:(0,a.jsxs)("linearGradient",{id:"colorGradient",x1:"0",y1:"0",x2:"1",y2:"0",children:[(0,a.jsx)("stop",{offset:"0%",stopColor:"#274472"}),(0,a.jsx)("stop",{offset:"100%",stopColor:"#34B9EE"})]})})]})})]})]})})]}),(0,a.jsx)(K.motion.div,{variants:ek,children:ey?(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5",children:[...Array(8)].map((e,t)=>(0,a.jsx)(K.motion.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.05*t},className:"h-64 bg-gradient-to-br from-gray-50 to-gray-100 rounded-3xl animate-pulse"},t))}):0===ev.length?(0,a.jsx)(u.GlassCard,{variant:"premium",className:"p-16 text-center border-2 border-dashed border-gray-200",children:(0,a.jsxs)(K.motion.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},children:[(0,a.jsx)("div",{className:"w-24 h-24 bg-gradient-to-br from-gray-50 to-gray-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner",children:(0,a.jsx)(j.Receipt,{className:"h-12 w-12 text-gray-300"})}),(0,a.jsx)("h3",{className:"text-2xl font-black text-gray-900 mb-3 font-display",children:"Aucun document trouvÃ©"}),(0,a.jsx)("p",{className:"text-lg text-gray-500 mb-8 max-w-md mx-auto",children:Q||"all"!==I||"all"!==Z?"Essayez de modifier vos filtres de recherche.":"Commencez par crÃ©er votre premier document de paiement."}),!Q&&"all"===I&&"all"===Z&&(0,a.jsx)(K.motion.div,{whileHover:{scale:1.05,y:-2},whileTap:{scale:.98},children:(0,a.jsx)(E.default,{href:"/dashboard/payments/new",children:(0,a.jsxs)(c.Button,{className:"h-12 px-8 text-base font-semibold shadow-lg",children:[(0,a.jsx)(x.Plus,{className:"mr-2 h-5 w-5"}),"CrÃ©er un document"]})})})]})}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5",children:(0,a.jsx)(L.AnimatePresence,{mode:"popLayout",children:ev.map((e,t)=>{let r="quote"===e.document_type,s=e.students;return(0,a.jsx)(K.motion.div,{layout:!0,initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-20},transition:{delay:.04*t,duration:.4,ease:[.16,1,.3,1]},children:(0,a.jsx)(E.default,{href:`/dashboard/payments/${e.id}`,children:(0,a.jsx)(K.motion.div,{whileHover:{y:-8,scale:1.02},transition:{duration:.3},children:(0,a.jsxs)(u.GlassCard,{variant:"premium",hoverable:!0,className:"h-full p-6 group flex flex-col justify-between relative overflow-hidden border-2 border-gray-100 hover:border-brand-blue/30 transition-all duration-300",children:[r&&(0,a.jsx)("div",{className:"absolute top-0 right-0 bg-gradient-to-br from-blue-100 to-blue-200 text-blue-700 text-[10px] font-bold px-3 py-1.5 rounded-bl-2xl uppercase tracking-widest shadow-sm",children:"Devis"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-5",children:[(0,a.jsx)(K.motion.div,{whileHover:{scale:1.15,rotate:8},transition:{duration:.3},className:(0,z.cn)("h-14 w-14 rounded-2xl flex items-center justify-center shadow-lg",r?"bg-gradient-to-br from-blue-50 to-blue-100 text-blue-600":"bg-gradient-to-br from-brand-blue-ghost to-brand-blue-pale text-brand-blue"),children:r?(0,a.jsx)(g.FileText,{className:"h-6 w-6"}):(0,a.jsx)(j.Receipt,{className:"h-6 w-6"})}),(0,a.jsx)("span",{className:(0,z.cn)("px-3 py-1.5 rounded-xl text-xs font-bold border-2 shadow-sm",(e=>{switch(e){case"paid":return"bg-emerald-50 text-emerald-700 border-emerald-100";case"sent":return"bg-blue-50 text-blue-700 border-blue-100";case"partial":return"bg-amber-50 text-amber-700 border-amber-100";case"overdue":return"bg-red-50 text-red-700 border-red-100";default:return"bg-gray-50 text-gray-700 border-gray-100"}})(e.status||"draft")),children:(e=>{switch(e){case"paid":return"PayÃ©e";case"sent":return"EnvoyÃ©e";case"partial":return"Partielle";case"overdue":return"En retard";case"draft":return"Brouillon";case"cancelled":return"AnnulÃ©e";default:return e}})(e.status||"draft")})]}),(0,a.jsxs)("div",{className:"mb-5",children:[(0,a.jsx)("h3",{className:"text-lg font-black text-gray-900 truncate group-hover:text-brand-blue transition-colors font-display tracking-tight",children:e.invoice_number||"Brouillon"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1.5 font-medium",children:s?`${s.first_name} ${s.last_name}`:"Client inconnu"})]}),(0,a.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-xl",children:[(0,a.jsx)("span",{className:"text-gray-500 font-medium",children:"Montant"}),(0,a.jsx)("span",{className:"text-lg font-black text-brand-blue font-display",children:(0,z.formatCurrency)(Number(e.total_amount),e.currency||"EUR")})]}),e.issue_date&&(0,a.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,a.jsx)("span",{className:"text-gray-400 font-medium",children:"Date d'Ã©mission"}),(0,a.jsx)("span",{className:"text-gray-600 font-semibold",children:(0,z.formatDate)(e.issue_date)})]})]})]}),(0,a.jsxs)("div",{className:"mt-6 pt-5 border-t-2 border-gray-100 flex items-center justify-between",children:[r?(0,a.jsx)(c.Button,{variant:"ghost",size:"sm",className:"h-9 text-xs font-semibold hover:text-brand-blue hover:bg-brand-blue-ghost -ml-2 px-3",onClick:a=>{a.preventDefault(),eb.mutate(e.id)},disabled:eb.isPending,children:"Convertir en facture"}):(0,a.jsx)("span",{className:"text-xs text-gray-400 font-medium",children:"Voir les dÃ©tails"}),(0,a.jsx)(K.motion.div,{whileHover:{x:2,y:-2},transition:{duration:.2},children:(0,a.jsx)(w.ArrowUpRight,{className:"h-5 w-5 text-gray-300 group-hover:text-brand-blue transition-colors"})})]})]})})})},e.id)})})})}),(0,a.jsx)(K.motion.div,{variants:ek,children:(0,a.jsxs)(u.GlassCard,{variant:"default",className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(C.TrendingDown,{className:"h-5 w-5 text-red-600"}),(0,a.jsx)("h3",{className:"font-bold text-gray-900",children:"Charges de session"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(c.Button,{variant:"outline",size:"sm",onClick:()=>{ei(!0),es(!0)},children:[(0,a.jsx)(x.Plus,{className:"mr-2 h-4 w-4"}),"Nouvelle charge"]}),(0,a.jsx)(c.Button,{variant:"ghost",size:"icon",onClick:()=>es(!er),children:er?(0,a.jsx)(S.ChevronUp,{className:"h-4 w-4"}):(0,a.jsx)(k.ChevronDown,{className:"h-4 w-4"})})]})]}),er&&(0,a.jsxs)("div",{className:"space-y-4",children:[en&&(0,a.jsxs)("div",{className:"border rounded-lg p-6 bg-gray-50",children:[(0,a.jsx)("h4",{className:"font-semibold mb-4",children:"CrÃ©er une nouvelle charge"}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),eg.mutate()},className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Session *"}),(0,a.jsxs)("select",{required:!0,value:el,onChange:e=>eo(e.target.value),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"SÃ©lectionner une session"}),ed?.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.name," (",e.start_date?new Date(e.start_date).toLocaleDateString("fr-FR"):"N/A",")"]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Description *"}),(0,a.jsx)("input",{type:"text",required:!0,value:ex.description,onChange:e=>eh({...ex,description:e.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"Ex: Location de salle pour la formation"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant *"}),(0,a.jsx)("input",{type:"number",required:!0,step:"0.01",min:"0.01",value:ex.amount,onChange:e=>eh({...ex,amount:e.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"0.00"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Devise"}),(0,a.jsxs)("select",{value:ex.currency,onChange:e=>eh({...ex,currency:e.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,a.jsx)("option",{value:"EUR",children:"EUR"}),(0,a.jsx)("option",{value:"USD",children:"USD"}),(0,a.jsx)("option",{value:"XOF",children:"XOF"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date *"}),(0,a.jsx)("input",{type:"date",required:!0,value:ex.charge_date,onChange:e=>eh({...ex,charge_date:e.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"CatÃ©gorie"}),(0,a.jsxs)("select",{value:ex.category_id,onChange:e=>eh({...ex,category_id:e.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"SÃ©lectionner une catÃ©gorie"}),ec?.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"MÃ©thode de paiement"}),(0,a.jsxs)("select",{value:ex.payment_method,onChange:e=>eh({...ex,payment_method:e.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"Non spÃ©cifiÃ©"}),(0,a.jsx)("option",{value:"cash",children:"EspÃ¨ces"}),(0,a.jsx)("option",{value:"bank_transfer",children:"Virement bancaire"}),(0,a.jsx)("option",{value:"card",children:"Carte bancaire"}),(0,a.jsx)("option",{value:"mobile_money",children:"Mobile Money"}),(0,a.jsx)("option",{value:"check",children:"ChÃ¨que"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Statut de paiement"}),(0,a.jsxs)("select",{value:ex.payment_status,onChange:e=>eh({...ex,payment_status:e.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",children:[(0,a.jsx)("option",{value:"pending",children:"En attente"}),(0,a.jsx)("option",{value:"paid",children:"PayÃ©"}),(0,a.jsx)("option",{value:"cancelled",children:"AnnulÃ©"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Fournisseur"}),(0,a.jsx)("input",{type:"text",value:ex.vendor,onChange:e=>eh({...ex,vendor:e.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"Nom du fournisseur/prestataire"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"NÂ° facture fournisseur"}),(0,a.jsx)("input",{type:"text",value:ex.vendor_invoice_number,onChange:e=>eh({...ex,vendor_invoice_number:e.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"NÂ° de facture"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date facture fournisseur"}),(0,a.jsx)("input",{type:"date",value:ex.vendor_invoice_date,onChange:e=>eh({...ex,vendor_invoice_date:e.target.value}),className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,a.jsx)("textarea",{value:ex.notes,onChange:e=>eh({...ex,notes:e.target.value}),rows:3,className:"w-full px-4 py-2 rounded-lg bg-white border focus:ring-2 focus:ring-brand-blue focus:border-transparent",placeholder:"Notes supplÃ©mentaires..."})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(c.Button,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{ei(!1),eo("")},children:"Annuler"}),(0,a.jsx)(c.Button,{type:"submit",className:"flex-1",disabled:eg.isPending,children:eg.isPending?"CrÃ©ation...":"CrÃ©er la charge"})]})]})]}),!en&&(0,a.jsx)("div",{className:"space-y-4",children:em?(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent"}),(0,a.jsx)("p",{className:"mt-4 text-muted-foreground",children:"Chargement des charges..."})]}):eu&&eu.length>0?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h4",{className:"font-semibold text-gray-900",children:[eu.length," charge",eu.length>1?"s":""," enregistrÃ©e",eu.length>1?"s":""]}),(0,a.jsxs)(c.Button,{variant:"outline",size:"sm",onClick:()=>ei(!0),children:[(0,a.jsx)(x.Plus,{className:"mr-2 h-4 w-4"}),"Ajouter une charge"]})]}),(0,a.jsx)("div",{className:"space-y-2",children:eu.map(e=>{let t=e.sessions,r=e.charge_categories,s={pending:"bg-yellow-100 text-yellow-800 border-yellow-200",paid:"bg-green-100 text-green-800 border-green-200",cancelled:"bg-red-100 text-red-800 border-red-200"};return(0,a.jsx)("div",{className:"border rounded-lg p-4 bg-white hover:shadow-md transition-shadow",children:(0,a.jsx)("div",{className:"flex items-start justify-between",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)("h5",{className:"font-semibold text-gray-900",children:e.description}),(0,a.jsx)("span",{className:`px-2 py-1 rounded text-xs font-medium border ${s[e.payment_status]||s.pending}`,children:"pending"===e.payment_status?"En attente":"paid"===e.payment_status?"PayÃ©":"AnnulÃ©"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm text-gray-600",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Montant:"})," ",(0,a.jsx)("span",{className:"font-bold text-gray-900",children:(0,z.formatCurrency)(Number(e.amount),e.currency||"EUR")})]}),t&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Session:"})," ",(0,a.jsx)("span",{className:"text-gray-900",children:t.name})]}),r&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"CatÃ©gorie:"})," ",(0,a.jsx)("span",{className:"text-gray-900",children:r.name})]}),e.charge_date&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Date:"})," ",(0,a.jsx)("span",{className:"text-gray-900",children:(0,z.formatDate)(e.charge_date)})]})]}),e.vendor&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,a.jsx)("span",{className:"font-medium",children:"Fournisseur:"})," ",(0,a.jsx)("span",{className:"text-gray-900",children:e.vendor})]}),e.notes&&(0,a.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:[(0,a.jsx)("span",{className:"font-medium",children:"Notes:"})," ",(0,a.jsx)("span",{className:"text-gray-900",children:e.notes})]})]})})},e.id)})})]}):(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(C.TrendingDown,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"GÃ©rez les charges (dÃ©penses) associÃ©es aux sessions de formation."}),(0,a.jsxs)(c.Button,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>ei(!0),children:[(0,a.jsx)(x.Plus,{className:"mr-2 h-4 w-4"}),"Ajouter une charge"]})]})})]})]})})]})}e.s(["default",()=>O])}]);