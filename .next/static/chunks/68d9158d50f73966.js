(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,870273,e=>{"use strict";let a=(0,e.i(475254).default)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);e.s(["Star",()=>a],870273)},653339,e=>{"use strict";let a=(0,e.i(475254).default)("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);e.s(["Music",()=>a],653339)},751975,e=>{"use strict";let a=(0,e.i(475254).default)("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]);e.s(["Tag",()=>a],751975)},364528,e=>{"use strict";var a=e.i(843476),s=e.i(271645),l=e.i(970065),i=e.i(167881),t=e.i(23750),r=e.i(630374),c=e.i(569074),n=e.i(555436),o=e.i(473708),d=e.i(178583),m=e.i(278716),u=e.i(653339),h=e.i(870273),x=e.i(727612),g=e.i(751975),p=e.i(964978),f=e.i(370956),v=e.i(605631),j=e.i(629377);e.i(882205);var y=e.i(846932),w=e.i(88653),N=e.i(647163);let b={getAll:async(e,a)=>(console.warn("mediaLibraryService.getAll not implemented"),[]),uploadFile:async(e,a,s,l)=>(console.warn("mediaLibraryService.uploadFile not implemented"),null),getPublicUrl:e=>(console.warn("mediaLibraryService.getPublicUrl not implemented"),e),async toggleFavorite(e,a){console.warn("mediaLibraryService.toggleFavorite not implemented")},async delete(e){console.warn("mediaLibraryService.delete not implemented")}};var S=e.i(325715),_=e.i(6799);function C({onSelect:e,onInsert:C,category:z,multiple:B=!1,showUpload:k=!0}){let{user:T}=(0,S.useAuth)(),{addToast:M}=(0,_.useToast)(),[A,I]=(0,s.useState)(!1),[L,P]=(0,s.useState)([]),[E,U]=(0,s.useState)(!1),[F,D]=(0,s.useState)(!1),[q,K]=(0,s.useState)(new Set),[O,R]=(0,s.useState)("grid"),[V,G]=(0,s.useState)(""),[H,$]=(0,s.useState)(z||"all"),[Z,J]=(0,s.useState)(!1),[Q,W]=(0,s.useState)(!1),X=(0,s.useCallback)(async()=>{if(T?.organization_id){U(!0);try{let e={};"all"!==H&&(e.category=H),Z&&(e.is_favorite=!0),Q&&(e.is_logo=!0),V&&(e.search=V);let a=await b.getAll(T.organization_id,e);P(a)}catch(e){console.error("Erreur lors du chargement des médias:",e),M({type:"error",title:"Erreur",description:"Impossible de charger les médias"})}finally{U(!1)}}},[T?.organization_id,H,Z,Q,V,toast]);(0,s.useEffect)(()=>{A&&T?.organization_id&&X()},[A,X,T?.organization_id]);let Y=async e=>{if(e&&0!==e.length&&T?.organization_id&&T?.id){D(!0);try{let a=Array.from(e).map(e=>b.uploadFile(e,T.organization_id,T.id,{category:"all"!==H?H:void 0}));await Promise.all(a),M({type:"success",title:"Succès",description:`${e.length} fichier(s) upload\xe9(s) avec succ\xe8s`}),await X()}catch(e){console.error("Erreur lors de l'upload:",e),M({type:"error",title:"Erreur",description:"Impossible d'uploader les fichiers"})}finally{D(!1)}}},ee=async(e,a)=>{a.stopPropagation();try{await b.toggleFavorite(e.id,!e.is_favorite),await X()}catch(e){console.error("Erreur:",e),M({type:"error",title:"Erreur",description:"Impossible de modifier le favori"})}},ea=async(e,a)=>{if(a.stopPropagation(),confirm(`\xcates-vous s\xfbr de vouloir supprimer "${e.title||e.file_name}" ?`))try{await b.delete(e.id),M({type:"success",title:"Succès",description:"Média supprimé avec succès"}),await X()}catch(e){console.error("Erreur:",e),M({type:"error",title:"Erreur",description:"Impossible de supprimer le média"})}},es=e=>{if(0===e)return"0 Bytes";let a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["Bytes","KB","MB","GB"][a]};return(0,a.jsxs)(r.Dialog,{open:A,onOpenChange:I,children:[(0,a.jsx)(r.DialogTrigger,{asChild:!0,children:(0,a.jsxs)(i.Button,{variant:"outline",size:"sm",children:[(0,a.jsx)(o.Image,{className:"h-4 w-4 mr-2"}),"Bibliothèque de médias"]})}),(0,a.jsxs)(r.DialogContent,{className:"max-w-6xl max-h-[90vh] overflow-hidden flex flex-col",children:[(0,a.jsx)(r.DialogHeader,{children:(0,a.jsxs)(r.DialogTitle,{className:"flex items-center gap-2",children:[(0,a.jsx)(o.Image,{className:"h-5 w-5"}),"Bibliothèque de médias"]})}),(0,a.jsxs)("div",{className:"flex-1 overflow-hidden flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 flex-wrap",children:[k&&(0,a.jsxs)("label",{className:"cursor-pointer",children:[(0,a.jsx)("input",{type:"file",multiple:!0,className:"hidden",onChange:e=>Y(e.target.files),accept:"image/*,video/*,audio/*,.pdf,.doc,.docx"}),(0,a.jsxs)(i.Button,{variant:"outline",size:"sm",disabled:F,className:"cursor-pointer",children:[F?(0,a.jsx)(j.Loader2,{className:"h-4 w-4 mr-2 animate-spin"}):(0,a.jsx)(c.Upload,{className:"h-4 w-4 mr-2"}),"Uploader"]})]}),(0,a.jsx)("div",{className:"flex-1 min-w-[200px]",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(n.Search,{className:"absolute left-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)(t.Input,{placeholder:"Rechercher...",value:V,onChange:e=>G(e.target.value),className:"pl-8"})]})}),(0,a.jsx)("select",{value:H,onChange:e=>$(e.target.value),className:"px-3 py-2 border rounded-md text-sm",children:[{value:"all",label:"Tous"},{value:"image",label:"Images"},{value:"logo",label:"Logos"},{value:"document",label:"Documents"},{value:"video",label:"Vidéos"},{value:"audio",label:"Audio"},{value:"other",label:"Autres"}].map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))}),(0,a.jsx)(i.Button,{variant:Z?"default":"outline",size:"sm",onClick:()=>J(!Z),children:(0,a.jsx)(h.Star,{className:(0,N.cn)("h-4 w-4",Z&&"fill-current")})}),(0,a.jsx)(i.Button,{variant:Q?"default":"outline",size:"sm",onClick:()=>W(!Q),children:(0,a.jsx)(g.Tag,{className:(0,N.cn)("h-4 w-4",Q&&"fill-current")})}),(0,a.jsxs)("div",{className:"flex border rounded-md",children:[(0,a.jsx)(i.Button,{variant:"grid"===O?"default":"ghost",size:"sm",onClick:()=>R("grid"),className:"rounded-r-none",children:(0,a.jsx)(p.Grid3x3,{className:"h-4 w-4"})}),(0,a.jsx)(i.Button,{variant:"list"===O?"default":"ghost",size:"sm",onClick:()=>R("list"),className:"rounded-l-none",children:(0,a.jsx)(f.List,{className:"h-4 w-4"})})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto",children:E?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)(j.Loader2,{className:"h-8 w-8 animate-spin text-brand-blue"})}):0===L.length?(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[(0,a.jsx)(o.Image,{className:"h-12 w-12 mb-4 opacity-50"}),(0,a.jsx)("p",{children:"Aucun média trouvé"}),k&&(0,a.jsx)("p",{className:"text-sm mt-2",children:"Commencez par uploader un fichier"})]}):(0,a.jsx)("div",{className:(0,N.cn)("grid"===O?"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4":"space-y-2"),children:(0,a.jsx)(w.AnimatePresence,{children:L.map(s=>{let t=(e=>{switch(e){case"image":case"logo":return o.Image;case"document":default:return d.FileText;case"video":return m.Video;case"audio":return u.Music}})(s.category),r=q.has(s.id),c=b.getPublicUrl(s.file_path);return(0,a.jsx)(y.motion.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},className:(0,N.cn)("relative group cursor-pointer","grid"===O?"":"flex items-center gap-4 p-2 border rounded-lg"),onClick:()=>(a=>{if(B){let e=new Set(q);e.has(a.id)?e.delete(a.id):e.add(a.id),K(e)}else e&&e(a),C&&C(b.getPublicUrl(a.file_path),a.alt_text||a.title),I(!1)})(s),children:"grid"===O?(0,a.jsxs)(l.Card,{className:(0,N.cn)("overflow-hidden transition-all",r&&"ring-2 ring-brand-blue"),children:[(0,a.jsxs)("div",{className:"aspect-square relative bg-gray-100",children:["image"===s.category||"logo"===s.category?(0,a.jsx)("img",{src:c,alt:s.alt_text||s.title||s.file_name,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)(t,{className:"h-12 w-12 text-gray-400"})}),r&&(0,a.jsx)("div",{className:"absolute top-2 right-2",children:(0,a.jsx)(v.CheckCircle,{className:"h-6 w-6 text-brand-blue fill-white"})})]}),(0,a.jsxs)(l.CardContent,{className:"p-2",children:[(0,a.jsx)("p",{className:"text-xs font-medium truncate",children:s.title||s.file_name}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:es(s.file_size)})]}),(0,a.jsxs)("div",{className:"absolute top-2 left-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,a.jsx)(i.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 bg-white/90",onClick:e=>ee(s,e),children:s.is_favorite?(0,a.jsx)(h.Star,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}):(0,a.jsx)(h.Star,{className:"h-3 w-3"})}),(0,a.jsx)(i.Button,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 bg-white/90",onClick:e=>ea(s,e),children:(0,a.jsx)(x.Trash2,{className:"h-3 w-3 text-red-600"})})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-16 h-16 flex-shrink-0 bg-gray-100 rounded overflow-hidden",children:"image"===s.category||"logo"===s.category?(0,a.jsx)("img",{src:c,alt:s.alt_text||s.title||s.file_name,className:"w-full h-full object-cover"}):(0,a.jsx)("div",{className:"w-full h-full flex items-center justify-center",children:(0,a.jsx)(t,{className:"h-6 w-6 text-gray-400"})})}),(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsx)("p",{className:"font-medium truncate",children:s.title||s.file_name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[es(s.file_size)," • ",s.category]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[s.is_favorite&&(0,a.jsx)(h.Star,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),s.is_logo&&(0,a.jsx)(g.Tag,{className:"h-4 w-4 text-brand-blue"}),(0,a.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:e=>ee(s,e),children:(0,a.jsx)(h.Star,{className:"h-4 w-4"})}),(0,a.jsx)(i.Button,{variant:"ghost",size:"sm",onClick:e=>ea(s,e),children:(0,a.jsx)(x.Trash2,{className:"h-4 w-4 text-red-600"})})]})]})},s.id)})})})}),B&&q.size>0&&(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("span",{children:[q.size," média(s) sélectionné(s)"]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(i.Button,{variant:"outline",onClick:()=>{L.filter(e=>q.has(e.id)).forEach(e=>{C&&C(b.getPublicUrl(e.file_path),e.alt_text||e.title)}),I(!1)},children:["Insérer ",q.size," média(s)"]}),(0,a.jsx)(i.Button,{variant:"outline",onClick:()=>K(new Set),children:"Annuler"})]})]})]})]})]})}e.s(["MediaLibrary",()=>C],364528)},697899,e=>{e.n(e.i(364528))}]);