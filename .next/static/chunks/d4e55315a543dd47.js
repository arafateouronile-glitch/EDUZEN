(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let t=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],107233)},436332,e=>{"use strict";let t=(0,e.i(475254).default)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);e.s(["Edit",()=>t],436332)},434249,e=>{"use strict";var t=e.i(920755);let s=new class{supabase;constructor(e){this.supabase=e||(0,t.createClient)()}async getTemplates(e){let{data:t,error:s}=await this.supabase.from("evaluation_templates").select(`
        *,
        questions:evaluation_template_questions(*)
      `).or(`organization_id.eq.${e},organization_id.is.null`).eq("is_active",!0).order("created_at",{ascending:!1});return s?(console.error("Erreur récupération modèles:",s),[]):t||[]}async getTemplateById(e){let{data:t,error:s}=await this.supabase.from("evaluation_templates").select(`
        *,
        questions:evaluation_template_questions(*)
      `).eq("id",e).single();return s?(console.error("Erreur récupération modèle:",s),null):t}async createTemplate(e,t,s){let{data:a,error:r}=await this.supabase.from("evaluation_templates").insert({...t,organization_id:e}).select().single();if(r)throw r;if(s.length>0){let e=s.map((e,t)=>({...e,template_id:a.id,order_index:e.order_index??t+1})),{error:t}=await this.supabase.from("evaluation_template_questions").insert(e);if(t)throw t}let i=await this.getTemplateById(a.id);if(!i)throw Error("Erreur lors de la récupération du modèle créé");return i}async updateTemplate(e,t,s){let{error:a}=await this.supabase.from("evaluation_templates").update(t).eq("id",e);if(a)throw a;if(void 0!==s){let{error:t}=await this.supabase.from("evaluation_template_questions").delete().eq("template_id",e);if(t)throw t;if(s.length>0){let t=s.map((t,s)=>({...t,template_id:e,order_index:t.order_index??s+1})),{error:a}=await this.supabase.from("evaluation_template_questions").insert(t);if(a)throw a}}let r=await this.getTemplateById(e);if(!r)throw Error("Erreur lors de la récupération du modèle mis à jour");return r}async deleteTemplate(e){let{error:t}=await this.supabase.from("evaluation_templates").delete().eq("id",e);if(t)throw t}async createInstance(e,t,s){let{data:a,error:r}=await this.supabase.from("evaluation_template_instances").insert({grade_id:e,template_id:t,max_score:s?.max_score,time_limit_minutes:s?.time_limit_minutes}).select().single();if(r)throw r;return a}async getInstanceByGradeId(e){try{let{data:t,error:s}=await this.supabase.from("evaluation_template_instances").select(`
          *,
          template:evaluation_templates(
            *,
            questions:evaluation_template_questions(*)
          ),
          grade:grades(*)
        `).eq("grade_id",e).single();if(s){if("PGRST116"===s.code)return null;throw s}return t}catch{return null}}async getResponses(e,t){let s=this.supabase.from("evaluation_responses").select("*").eq("instance_id",e);t&&(s=s.eq("student_id",t));let{data:a,error:r}=await s.order("created_at",{ascending:!0});return r?(console.error("Erreur récupération réponses:",r),[]):a||[]}async saveResponse(e,t,s,a){let{data:r,error:i}=await this.supabase.from("evaluation_responses").upsert({instance_id:e,question_id:t,student_id:s,answer_text:a.answer_text,answer_choice:a.answer_choice,answer_boolean:a.answer_boolean},{onConflict:"instance_id,question_id,student_id"}).select().single();if(i)throw i;return r}async autoCorrectResponses(e){let{data:t,error:s}=await this.supabase.rpc("auto_correct_evaluation_responses",{p_instance_id:e});if(s)throw s;return t||0}async calculateScore(e){let{data:t,error:s}=await this.supabase.rpc("calculate_evaluation_score",{p_instance_id:e});return s?(console.error("Erreur calcul score:",s),null):t&&0!==t.length?{total_score:Number(t[0].total_score)||0,max_score:Number(t[0].max_score)||0,percentage:Number(t[0].percentage)||0,correct_count:Number(t[0].correct_count)||0,total_questions:Number(t[0].total_questions)||0}:null}async updateGradeFromScore(e,t){let s=await this.calculateScore(t);if(!s)return;let{error:a}=await this.supabase.from("grades").update({score:s.total_score,max_score:s.max_score}).eq("id",e);if(a)throw a}};e.s(["evaluationTemplateService",0,s])},249945,e=>{"use strict";let t=(0,e.i(475254).default)("FileQuestion",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["path",{d:"M10 10.3c.2-.4.5-.8.9-1a2.1 2.1 0 0 1 2.6.4c.3.4.5.8.5 1.3 0 1.3-2 2-2 2",key:"1umxtm"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["FileQuestion",()=>t],249945)},129126,e=>{"use strict";var t=e.i(843476),s=e.i(271645),a=e.i(266027),r=e.i(954616),i=e.i(912598),n=e.i(325715),l=e.i(434249),o=e.i(970065),d=e.i(167881),c=e.i(23750),u=e.i(994179),m=e.i(6799),p=e.i(107233),h=e.i(555436),x=e.i(436332),_=e.i(727612),v=e.i(249945),f=e.i(522016);e.i(882205);var g=e.i(846932),j=e.i(647163);function w(){let{user:e}=(0,n.useAuth)(),w=(0,i.useQueryClient)(),{addToast:y}=(0,m.useToast)(),[N,b]=(0,s.useState)(""),{data:q,isLoading:C}=(0,a.useQuery)({queryKey:["evaluation-templates",e?.organization_id],queryFn:async()=>e?.organization_id?await l.evaluationTemplateService.getTemplates(e.organization_id):[],enabled:!!e?.organization_id}),T=(0,r.useMutation)({mutationFn:async e=>{let t=q?.find(t=>t.id===e);if(t&&!t.organization_id)throw Error("Les modèles système ne peuvent pas être supprimés");await l.evaluationTemplateService.deleteTemplate(e)},onSuccess:()=>{w.invalidateQueries({queryKey:["evaluation-templates"]}),y({type:"success",title:"Modèle supprimé",description:"Le modèle a été supprimé avec succès."})},onError:e=>{y({type:"error",title:"Erreur",description:e.message||"Une erreur est survenue lors de la suppression."})}}),z=q?.filter(e=>e.name.toLowerCase().includes(N.toLowerCase())||e.description?.toLowerCase().includes(N.toLowerCase())||e.subject?.toLowerCase().includes(N.toLowerCase()))||[];return C?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"h-8 bg-gray-200 rounded w-64 animate-pulse"}),(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[1,2,3].map(e=>(0,t.jsx)("div",{className:"h-48 bg-gray-200 rounded animate-pulse"},e))})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Modèles d'évaluations"}),(0,t.jsx)("p",{className:"text-muted-foreground mt-1",children:"Créez et gérez vos modèles d'évaluations avec questions/réponses"})]}),(0,t.jsx)(f.default,{href:"/dashboard/evaluations/templates/new",children:(0,t.jsxs)(d.Button,{children:[(0,t.jsx)(p.Plus,{className:"h-4 w-4 mr-2"}),"Nouveau modèle"]})})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(h.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,t.jsx)(c.Input,{placeholder:"Rechercher un modèle...",value:N,onChange:e=>b(e.target.value),className:"pl-10"})]}),0===z.length?(0,t.jsx)(o.Card,{children:(0,t.jsxs)(o.CardContent,{className:"flex flex-col items-center justify-center py-12",children:[(0,t.jsx)(v.FileQuestion,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Aucun modèle trouvé"}),(0,t.jsx)("p",{className:"text-muted-foreground text-center mb-4",children:N?"Aucun modèle ne correspond à votre recherche.":"Créez votre premier modèle d'évaluation pour commencer."}),!N&&(0,t.jsx)(f.default,{href:"/dashboard/evaluations/templates/new",children:(0,t.jsxs)(d.Button,{children:[(0,t.jsx)(p.Plus,{className:"h-4 w-4 mr-2"}),"Créer un modèle"]})})]})}):(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:z.map(e=>(0,t.jsx)(g.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.2},children:(0,t.jsxs)(o.Card,{className:"hover:shadow-lg transition-shadow",children:[(0,t.jsx)(o.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.CardTitle,{className:"text-lg",children:e.name}),!e.organization_id&&(0,t.jsx)(u.Badge,{variant:"outline",className:"text-xs",children:"Système"})]}),(0,t.jsx)(o.CardDescription,{className:"mt-1",children:e.description||"Aucune description"})]}),(0,t.jsxs)(u.Badge,{variant:"secondary",children:[e.questions?.length||0," questions"]})]})}),(0,t.jsxs)(o.CardContent,{children:[(0,t.jsxs)("div",{className:"space-y-3",children:[e.subject&&(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Sujet :"})," ",(0,t.jsx)("span",{className:"text-muted-foreground",children:e.subject})]}),e.assessment_type&&(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Type :"})," ",(0,t.jsx)("span",{className:"text-muted-foreground",children:e.assessment_type})]}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Note max :"})," ",(0,t.jsxs)("span",{className:"text-muted-foreground",children:[e.max_score," points"]})]}),e.time_limit_minutes&&(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("span",{className:"font-medium",children:"Durée :"})," ",(0,t.jsxs)("span",{className:"text-muted-foreground",children:[e.time_limit_minutes," min"]})]}),(0,t.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Créé le ",(0,j.formatDate)(e.created_at)]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t",children:[(0,t.jsx)(f.default,{href:`/dashboard/evaluations/templates/${e.id}`,className:"flex-1",children:(0,t.jsxs)(d.Button,{variant:"outline",size:"sm",className:"w-full",children:[(0,t.jsx)(x.Edit,{className:"h-4 w-4 mr-2"}),"Modifier"]})}),e.organization_id&&(0,t.jsx)(d.Button,{variant:"outline",size:"sm",onClick:()=>{confirm("Êtes-vous sûr de vouloir supprimer ce modèle ?")&&T.mutate(e.id)},children:(0,t.jsx)(_.Trash2,{className:"h-4 w-4"})})]})]})]})},e.id))})]})}e.s(["default",()=>w])}]);