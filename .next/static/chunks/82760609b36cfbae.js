(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,25652,e=>{"use strict";let t=(0,e.i(475254).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);e.s(["TrendingUp",()=>t],25652)},80647,e=>{"use strict";var t=e.i(843476),s=e.i(266027),r=e.i(325715),a=e.i(920755),n=e.i(970065),d=e.i(284614),l=e.i(25652),i=e.i(898791),c=e.i(647163),u=e.i(522016);function o(){let{user:e}=(0,r.useAuth)(),o=(0,a.createClient)(),{data:m}=(0,s.useQuery)({queryKey:["children",e?.id],queryFn:async()=>{if(!e?.id||e?.role!=="parent")return[];let{data:t}=await o.from("guardians").select("id").eq("user_id",e.id);if(!t||0===t.length)return[];let{data:s}=await o.from("student_guardians").select("student_id").in("guardian_id",t.map(e=>e.id));if(!s||0===s.length)return[];let{data:r}=await o.from("students").select("*, classes(name)").in("id",s.map(e=>e.student_id).filter(e=>null!==e)).eq("status","active");return r||[]},enabled:!!e?.id&&e?.role==="parent"}),{data:x}=(0,s.useQuery)({queryKey:["student",e?.id],queryFn:async()=>{if(!e?.id||e?.role!=="student")return null;let{data:t}=await o.from("students").select("*, classes(name)").eq("id",e.id).single();return t},enabled:!!e?.id&&e?.role==="student"}),{data:h}=(0,s.useQuery)({queryKey:["unpaid-invoices",e?.id],queryFn:async()=>{if(!e?.id)return[];let t=[];if(e?.role==="parent"&&m?t=m.map(e=>e.id):e?.role==="student"&&x&&(t=[x.id]),0===t.length)return[];let{data:s}=await o.from("invoices").select("*").in("student_id",t).in("status",["sent","partial","overdue"]).order("due_date",{ascending:!0}).limit(5);return s||[]},enabled:!!e?.id&&e?.role==="parent"&&!!m||!!e?.id&&e?.role==="student"&&!!x}),{data:f}=(0,s.useQuery)({queryKey:["recent-attendance",e?.id],queryFn:async()=>{if(!e?.id)return[];let t=[];if(e?.role==="parent"&&m?t=m.map(e=>e.id):e?.role==="student"&&x&&(t=[x.id]),0===t.length)return[];let{data:s}=await o.from("attendance").select("*, students(first_name, last_name), classes(name)").in("student_id",t).order("date",{ascending:!1}).limit(10);return s||[]},enabled:!!e?.id&&e?.role==="parent"&&!!m||!!e?.id&&e?.role==="student"&&!!x}),{data:p}=(0,s.useQuery)({queryKey:["attendance-stats",e?.id],queryFn:async()=>{if(!e?.id)return null;let t=[];if(e?.role==="parent"&&m?t=m.map(e=>e.id):e?.role==="student"&&x&&(t=[x.id]),0===t.length)return null;let s=new Date;s.setDate(1);let{data:r}=await o.from("attendance").select("status").in("student_id",t).gte("date",s.toISOString().split("T")[0]),a=r?.length||0,n=r?.filter(e=>"present"===e.status).length||0;return{total:a,present:n,absent:r?.filter(e=>"absent"===e.status).length||0,rate:a>0?Math.round(n/a*100):0}},enabled:!!e?.id&&e?.role==="parent"&&!!m||!!e?.id&&e?.role==="student"&&!!x});return e?.role,(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:e?.role==="parent"?"Tableau de bord Parent":"Tableau de bord Étudiant"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Vue d'ensemble de la scolarité"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsxs)(n.Card,{children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Taux de présence (mois)"}),(0,t.jsx)(l.TrendingUp,{className:"h-5 w-5 text-brand-blue"})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsxs)("div",{className:"text-2xl font-bold text-brand-blue",children:[p?.rate||0,"%"]}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:[p?.present||0," présences / ",p?.total||0," jours"]})]})]}),(0,t.jsxs)(n.Card,{children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Factures en attente"}),(0,t.jsx)(i.AlertCircle,{className:"h-5 w-5 text-red-600"})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-red-600",children:h?.length||0}),h&&h.length>0&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Total: ",(0,c.formatCurrency)(h.reduce((e,t)=>e+Number(t.total_amount)-Number(t.paid_amount||0),0),h[0]?.currency||"XOF")]})]})]}),(0,t.jsxs)(n.Card,{children:[(0,t.jsxs)(n.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(n.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:e?.role==="parent"?"Enfants":"Classe"}),(0,t.jsx)(d.User,{className:"h-5 w-5 text-blue-600"})]}),(0,t.jsxs)(n.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:e?.role==="parent"?m?.length||0:+!!x}),e?.role==="student"&&x&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:x.classes?.name||"Non assigné"})]})]})]}),e?.role==="parent"&&m&&m.length>0&&(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{children:(0,t.jsx)(n.CardTitle,{children:"Mes enfants"})}),(0,t.jsx)(n.CardContent,{children:(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(e=>(0,t.jsx)(u.default,{href:`/portal/children/${e.id}`,className:"p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[e.photo_url?(0,t.jsx)("img",{src:e.photo_url,alt:`${e.first_name} ${e.last_name}`,className:"h-16 w-16 rounded-full object-cover"}):(0,t.jsxs)("div",{className:"h-16 w-16 rounded-full bg-primary text-white flex items-center justify-center text-xl font-semibold",children:[e.first_name.charAt(0),e.last_name.charAt(0)]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-semibold",children:[e.first_name," ",e.last_name]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:e.classes?.name||"Non assigné"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.student_number})]})]})},e.id))})})]}),h&&h.length>0&&(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{children:(0,t.jsx)(n.CardTitle,{children:"Factures en attente de paiement"})}),(0,t.jsx)(n.CardContent,{children:(0,t.jsx)("div",{className:"space-y-4",children:h.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",children:e.invoice_number}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Échéance: ",(0,c.formatDate)(e.due_date)]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"font-semibold text-lg",children:(0,c.formatCurrency)(Number(e.total_amount)-Number(e.paid_amount||0),e.currency)}),(0,t.jsx)(u.default,{href:`/portal/payments/${e.id}`,children:(0,t.jsx)("button",{className:"mt-2 px-4 py-2 bg-primary text-white rounded-lg text-sm hover:bg-primary-dark transition-colors",children:"Payer"})})]})]},e.id))})})]}),f&&f.length>0&&(0,t.jsxs)(n.Card,{children:[(0,t.jsx)(n.CardHeader,{children:(0,t.jsx)(n.CardTitle,{children:"Présences récentes"})}),(0,t.jsx)(n.CardContent,{children:(0,t.jsx)("div",{className:"space-y-2",children:f.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("p",{className:"font-medium",children:[e.students?.first_name," ",e.students?.last_name,e.classes?.name&&` - ${e.classes.name}`]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:(0,c.formatDate)(e.date)})]}),(0,t.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"present"===e.status?"bg-success-bg text-success-primary":"absent"===e.status?"bg-red-100 text-red-800":"late"===e.status?"bg-warning-bg text-warning-primary":"bg-blue-100 text-blue-800"}`,children:"present"===e.status?"Présent":"absent"===e.status?"Absent":"late"===e.status?"En retard":"Justifié"})]},e.id))})})]})]})}e.s(["default",()=>o])}]);