(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let t=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>t],871689)},356909,e=>{"use strict";let t=(0,e.i(475254).default)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);e.s(["Save",()=>t],356909)},319036,e=>{"use strict";var t=e.i(843476),r=e.i(271645),n=e.i(647163);let i=r.forwardRef(({checked:e,onCheckedChange:r,disabled:i,className:a,...s},o)=>(0,t.jsx)("button",{type:"button",role:"switch","aria-checked":e,ref:o,disabled:i,onClick:()=>r?.(!e),className:(0,n.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e?"bg-brand-blue":"bg-input",a),...s,children:(0,t.jsx)("span",{className:(0,n.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",e?"translate-x-5":"translate-x-0")})}));i.displayName="Switch",e.s(["Switch",0,i])},62870,e=>{"use strict";var t=e.i(843476),r=e.i(271645),n=e.i(647163);e.i(882205);var i=e.i(846932),a=e.i(88653),s=e.i(664659),o=e.i(898791);r.forwardRef(({className:e,label:l,error:c,helperText:d,variant:u="default",leftIcon:m,id:p,options:h,placeholder:x,value:f,...g},b)=>{let[v,y]=r.useState(!1),[j,w]=r.useState(!1),C=p||`select-${Math.random().toString(36).substr(2,9)}`,N=(0,n.cn)("flex w-full rounded-lg font-medium transition-all duration-300","appearance-none cursor-pointer","focus:outline-none focus:ring-2 focus:ring-primary/20","disabled:cursor-not-allowed disabled:opacity-50",{"border-2 border-input bg-background px-4 py-3 pr-11":"default"===u,"focus:border-primary focus:bg-white":"default"===u&&!c,"border-destructive focus:border-destructive focus:ring-destructive/20":c,"border-2 border-input bg-transparent px-4 py-3 pr-11":"outlined"===u,"focus:border-primary focus:shadow-md focus:shadow-primary/10":"outlined"===u&&!c,"border-0 border-b-2 border-input bg-muted/50 px-4 py-3 pr-11 rounded-b-none":"filled"===u,"focus:bg-muted focus:border-primary":"filled"===u&&!c,"focus:border-destructive bg-destructive/5":"filled"===u&&c},m&&"pl-11",e);return(0,t.jsxs)("div",{className:"w-full space-y-1.5",children:[l&&(0,t.jsxs)(i.motion.label,{htmlFor:C,initial:!1,animate:{color:c?"#EF4444":v?"rgb(37, 99, 235)":"rgb(107, 114, 128)"},className:(0,n.cn)("block text-sm font-medium transition-colors duration-200",c&&"text-destructive"),children:[l,g.required&&(0,t.jsx)("span",{className:"text-destructive ml-1",children:"*"})]}),(0,t.jsxs)("div",{className:"relative",children:[m&&(0,t.jsx)("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground pointer-events-none z-10",children:m}),(0,t.jsxs)(i.motion.select,{ref:b,id:C,value:f,...g,onFocus:e=>{y(!0),g.onFocus?.(e)},onBlur:e=>{y(!1),w(!1),g.onBlur?.(e)},onMouseDown:()=>w(!j),className:N,animate:{scale:v?1.01:1,borderColor:c?"#EF4444":v?"rgb(37, 99, 235)":"rgb(226, 232, 240)"},transition:{duration:.2},children:[x&&(0,t.jsx)("option",{value:"",disabled:!0,children:x}),(h||[]).map(e=>(0,t.jsx)("option",{value:e.value,disabled:e.disabled,children:e.label},e.value))]}),(0,t.jsx)(i.motion.div,{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-muted-foreground",animate:{rotate:180*!!j},transition:{duration:.2},children:(0,t.jsx)(s.ChevronDown,{className:"h-5 w-5"})}),c&&(0,t.jsx)(i.motion.div,{className:"absolute right-11 top-1/2 -translate-y-1/2 pointer-events-none",initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},transition:{type:"spring",stiffness:500,damping:30},children:(0,t.jsx)(o.AlertCircle,{className:"h-5 w-5 text-destructive"})})]}),(0,t.jsx)(a.AnimatePresence,{mode:"wait",children:(c||d)&&(0,t.jsx)(i.motion.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},exit:{opacity:0,y:-5},transition:{duration:.2},className:(0,n.cn)("text-xs transition-colors duration-200",c?"text-destructive":"text-muted-foreground"),children:c||d})})]})}).displayName="SelectNative";let l=r.createContext({}),c=r.forwardRef(({value:e,onValueChange:n,children:i},a)=>{let[s,o]=r.useState(!1);return(0,t.jsx)(l.Provider,{value:{value:e,onValueChange:n,open:s,setOpen:o},children:(0,t.jsx)("div",{className:"relative",ref:a,children:i})})});c.displayName="SelectRoot";let d=r.forwardRef(({children:e,className:i,...a},o)=>{let{open:c,setOpen:d}=r.useContext(l);return(0,t.jsxs)("button",{ref:o,type:"button",className:(0,n.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",i),onClick:()=>d?.(!c),...a,children:[e,(0,t.jsx)(s.ChevronDown,{className:(0,n.cn)("h-4 w-4 opacity-50 transition-transform",c&&"rotate-180")})]})});d.displayName="SelectTrigger";let u=r.forwardRef(({placeholder:e},n)=>{let{value:i}=r.useContext(l);return(0,t.jsx)("span",{ref:n,children:i||e})});u.displayName="SelectValue";let m=r.forwardRef(({children:e},n)=>{let i=r.useContext(l);return i?.open&&e?(0,t.jsx)("div",{ref:n,className:"absolute top-full left-0 z-50 mt-1 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md",children:(0,t.jsx)("div",{className:"p-1",children:e})}):null});m.displayName="SelectContent";let p=r.forwardRef(({value:e,children:i,className:a,...s},o)=>{let{value:c,onValueChange:d,setOpen:u}=r.useContext(l),m=c===e;return(0,t.jsx)("div",{ref:o,role:"option","aria-selected":m,className:(0,n.cn)("relative flex w-full cursor-pointer select-none items-center rounded-sm py-1.5 px-2 text-sm outline-none hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground",m&&"bg-accent text-accent-foreground",a),onClick:()=>{d?.(e),u?.(!1)},...s,children:i})});p.displayName="SelectItem",e.s(["Select",0,c,"SelectContent",0,m,"SelectItem",0,p,"SelectRoot",0,c,"SelectTrigger",0,d,"SelectValue",0,u])},834161,e=>{"use strict";let t=(0,e.i(475254).default)("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);e.s(["Key",()=>t],834161)},27523,e=>{"use strict";var t=e.i(843476),r=e.i(271645),n=e.i(266027),i=e.i(954616),a=e.i(912598),s=e.i(325715),o=e.i(920755),l=e.i(970065),c=e.i(167881),d=e.i(23750),u=e.i(10708),m=e.i(319036),p=e.i(6799),h=e.i(871689),x=e.i(356909),f=e.i(32095),g=e.i(607486),b=e.i(834161),v=e.i(16715),y=e.i(898791),j=e.i(952571),w=e.i(522016),C=e.i(62870);function N(){let{user:e}=(0,s.useAuth)(),N=(0,o.createClient)(),_=(0,a.useQueryClient)(),{addToast:S}=(0,p.useToast)(),[k,F]=(0,r.useState)({organization_id:e?.organization_id||"",provider_name:"",siret_number:"",api_endpoint:"https://api.moncompteformation.gouv.fr",is_active:!1,sync_frequency:"daily"}),[I,z]=(0,r.useState)(!1),{data:P,isLoading:A}=(0,n.useQuery)({queryKey:["cpf-configuration",e?.organization_id],queryFn:async()=>{if(!e?.organization_id)return null;let{data:t,error:r}=await N.from("cpf_configurations").select("*").eq("organization_id",e.organization_id).single();if(r){if("PGRST116"===r.code)return null;throw r}return t},enabled:!!e?.organization_id,retry:!1});(0,r.useEffect)(()=>{P&&F({...P,organization_id:e?.organization_id||""})},[P,e?.organization_id]);let q=(0,i.useMutation)({mutationFn:async t=>{if(!e?.organization_id)throw Error("Organisation non trouvée");let r={...t,organization_id:e.organization_id,updated_at:new Date().toISOString()};if(P?.id){let{data:e,error:t}=await N.from("cpf_configurations").update(r).eq("id",P.id).select().single();if(t)throw t;return e}{let{data:e,error:t}=await N.from("cpf_configurations").insert({...r,created_at:new Date().toISOString()}).select().single();if(t){if("PGRST116"===t.code||"42P01"===t.code)throw Error("La table cpf_configurations n'existe pas encore. Veuillez exécuter les migrations Supabase.");throw t}return e}},onSuccess:()=>{S({type:"success",title:"Configuration sauvegardée",description:"La configuration CPF a été enregistrée avec succès."}),_.invalidateQueries({queryKey:["cpf-configuration",e?.organization_id]})},onError:e=>{S({type:"error",title:"Erreur lors de la sauvegarde",description:e?.message||"Une erreur est survenue lors de la sauvegarde de la configuration."})}}),R=async e=>{e.preventDefault(),z(!0);try{await q.mutateAsync(k)}finally{z(!1)}},L=async()=>{S({type:"info",title:"Synchronisation",description:"La synchronisation avec Mon Compte Formation sera disponible prochainement."})};return A?(0,t.jsx)("div",{className:"container mx-auto py-8 px-4",children:(0,t.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,t.jsx)(v.RefreshCw,{className:"h-8 w-8 animate-spin text-brand-blue"})})}):(0,t.jsxs)("div",{className:"container mx-auto py-8 px-4 max-w-4xl",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)(w.default,{href:"/dashboard/cpf",children:(0,t.jsxs)(c.Button,{variant:"ghost",className:"mb-4",children:[(0,t.jsx)(h.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Retour"]})}),(0,t.jsxs)("h1",{className:"text-3xl font-bold mb-2 flex items-center gap-2",children:[(0,t.jsx)(f.GraduationCap,{className:"h-8 w-8 text-brand-blue"}),"Configuration CPF"]}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Configurez l'intégration avec Mon Compte Formation pour votre organisation"})]}),q.error?.message?.includes("n'existe pas")&&(0,t.jsx)(l.Card,{className:"mb-6 border-yellow-200 bg-yellow-50",children:(0,t.jsx)(l.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)(y.AlertCircle,{className:"h-5 w-5 text-yellow-600 mt-0.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-yellow-900 mb-1",children:"Table manquante"}),(0,t.jsx)("p",{className:"text-sm text-yellow-800",children:"La table cpf_configurations n'existe pas encore dans votre base de données. Veuillez exécuter les migrations Supabase nécessaires."})]})]})})}),(0,t.jsx)("form",{onSubmit:R,children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)(l.Card,{children:[(0,t.jsxs)(l.CardHeader,{children:[(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(g.Building2,{className:"h-5 w-5"}),"Informations de l'organisme"]}),(0,t.jsx)(l.CardDescription,{children:"Informations requises pour l'intégration avec Mon Compte Formation"})]}),(0,t.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"provider_name",children:"Nom de l'organisme *"}),(0,t.jsx)(d.Input,{id:"provider_name",value:k.provider_name,onChange:e=>F({...k,provider_name:e.target.value}),placeholder:"Nom de votre organisme de formation",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"siret_number",children:"Numéro SIRET *"}),(0,t.jsx)(d.Input,{id:"siret_number",value:k.siret_number,onChange:e=>F({...k,siret_number:e.target.value}),placeholder:"12345678901234",required:!0,maxLength:14})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"cpf_provider_number",children:"Numéro d'organisme CPF (optionnel)"}),(0,t.jsx)(d.Input,{id:"cpf_provider_number",value:k.cpf_provider_number||"",onChange:e=>F({...k,cpf_provider_number:e.target.value}),placeholder:"Numéro attribué par Mon Compte Formation"})]})]})]}),(0,t.jsxs)(l.Card,{children:[(0,t.jsxs)(l.CardHeader,{children:[(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(b.Key,{className:"h-5 w-5"}),"Configuration API"]}),(0,t.jsx)(l.CardDescription,{children:"Paramètres de connexion à l'API Mon Compte Formation"})]}),(0,t.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"api_endpoint",children:"Endpoint API *"}),(0,t.jsx)(d.Input,{id:"api_endpoint",value:k.api_endpoint,onChange:e=>F({...k,api_endpoint:e.target.value}),placeholder:"https://api.moncompteformation.gouv.fr",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"api_key",children:"Clé API (optionnel)"}),(0,t.jsx)(d.Input,{id:"api_key",type:"password",value:k.api_key||"",onChange:e=>F({...k,api_key:e.target.value}),placeholder:"Votre clé API"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"La clé API sera stockée de manière sécurisée"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"api_secret",children:"Secret API (optionnel)"}),(0,t.jsx)(d.Input,{id:"api_secret",type:"password",value:k.api_secret||"",onChange:e=>F({...k,api_secret:e.target.value}),placeholder:"Votre secret API"})]})]})]}),(0,t.jsxs)(l.Card,{children:[(0,t.jsxs)(l.CardHeader,{children:[(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(v.RefreshCw,{className:"h-5 w-5"}),"Paramètres de synchronisation"]}),(0,t.jsx)(l.CardDescription,{children:"Configurez la fréquence de synchronisation avec Mon Compte Formation"})]}),(0,t.jsxs)(l.CardContent,{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(u.Label,{htmlFor:"sync_frequency",children:"Fréquence de synchronisation *"}),(0,t.jsxs)(C.Select,{value:k.sync_frequency,onValueChange:e=>F({...k,sync_frequency:e}),children:[(0,t.jsx)(C.SelectTrigger,{children:(0,t.jsx)(C.SelectValue,{})}),(0,t.jsxs)(C.SelectContent,{children:[(0,t.jsx)(C.SelectItem,{value:"manual",children:"Manuelle"}),(0,t.jsx)(C.SelectItem,{value:"hourly",children:"Toutes les heures"}),(0,t.jsx)(C.SelectItem,{value:"daily",children:"Quotidienne"}),(0,t.jsx)(C.SelectItem,{value:"weekly",children:"Hebdomadaire"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"space-y-0.5",children:[(0,t.jsx)(u.Label,{htmlFor:"is_active",children:"Activer la synchronisation"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Activez la synchronisation automatique avec Mon Compte Formation"})]}),(0,t.jsx)(m.Switch,{checked:k.is_active,onCheckedChange:e=>F({...k,is_active:e})})]}),P?.last_sync_date&&(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,t.jsx)(j.Info,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["Dernière synchronisation :"," ",new Date(P.last_sync_date).toLocaleString("fr-FR")]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)(c.Button,{type:"button",variant:"outline",onClick:L,disabled:!k.is_active||!P,children:[(0,t.jsx)(v.RefreshCw,{className:"h-4 w-4 mr-2"}),"Synchroniser maintenant"]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(w.default,{href:"/dashboard/cpf",children:(0,t.jsx)(c.Button,{type:"button",variant:"outline",children:"Annuler"})}),(0,t.jsx)(c.Button,{type:"submit",disabled:I||q.isPending,children:I||q.isPending?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(v.RefreshCw,{className:"h-4 w-4 mr-2 animate-spin"}),"Enregistrement..."]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.Save,{className:"h-4 w-4 mr-2"}),"Enregistrer"]})})]})]})]})})]})}e.s(["default",()=>N])}]);