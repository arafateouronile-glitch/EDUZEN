(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let r=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>r],107233)},645760,e=>{"use strict";var r=e.i(843476),t=e.i(271645),a=e.i(647163);e.i(882205);var i=e.i(846932);let n=t.forwardRef(({className:e,variant:t="default",hoverable:n=!1,glow:o=!1,glowColor:s="rgba(51, 90, 207, 0.3)",...l},c)=>(0,r.jsxs)(i.motion.div,{ref:c,className:(0,a.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===t,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===t,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===t,"cursor-pointer":n,"hover:shadow-2xl hover:scale-[1.02]":n,"hover:bg-white/90 dark:hover:bg-gray-900/90":n},e),whileHover:n?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...l,children:[o&&(0,r.jsx)(i.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${s} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,r.jsx)("div",{className:"relative z-10",children:l.children})]}));n.displayName="GlassCard",e.s(["GlassCard",()=>n])},605631,e=>{"use strict";let r=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>r],605631)},25652,e=>{"use strict";let r=(0,e.i(475254).default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);e.s(["TrendingUp",()=>r],25652)},212426,e=>{"use strict";let r=(0,e.i(475254).default)("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>r],212426)},182774,e=>{"use strict";var r=e.i(843476),t=e.i(325715),a=e.i(618566),i=e.i(271645);let n=(0,e.i(475254).default)("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var o=e.i(167881),s=e.i(970065),l=e.i(522016);function c({children:e,allowedRoles:c,fallback:u,redirectTo:d="/dashboard"}){let{user:p,isLoading:h}=(0,t.useAuth)(),f=(0,a.useRouter)(),[m,y]=(0,i.useState)(null);return((0,i.useEffect)(()=>{if(!h&&p){let e=p.role||"",r=c.includes(e);y(r),r||!d||u||f.push(d)}},[p,h,c,d,f,u]),h||null===m)?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):m?(0,r.jsx)(r.Fragment,{children:e}):u?(0,r.jsx)(r.Fragment,{children:u}):(0,r.jsx)("div",{className:"container mx-auto py-16 px-4",children:(0,r.jsx)(s.Card,{className:"max-w-md mx-auto",children:(0,r.jsxs)(s.CardContent,{className:"py-12 text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,r.jsx)(n,{className:"h-8 w-8 text-red-600"})}),(0,r.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Accès non autorisé"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"Vous n'avez pas les permissions nécessaires pour accéder à cette page."}),(0,r.jsx)(l.default,{href:"/dashboard",children:(0,r.jsx)(o.Button,{children:"Retour au tableau de bord"})})]})})})}e.s(["ADMIN_ROLES",0,["super_admin","admin","secretary","accountant"],"FINANCE_ROLES",0,["super_admin","admin","secretary","accountant"],"FORMATION_MANAGEMENT_ROLES",0,["super_admin","admin","secretary"],"RoleGuard",()=>c],182774)},785817,e=>{"use strict";var r=e.i(843476),t=e.i(271645),a=e.i(647163);e.i(882205);var i=e.i(846932);let n=t.forwardRef(({className:e,columns:t=4,gap:i="md",children:n,...o},s)=>(0,r.jsx)("div",{ref:s,className:(0,a.cn)("grid",{1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3",4:"grid-cols-1 md:grid-cols-2 lg:grid-cols-4"}[t],{sm:"gap-4",md:"gap-6",lg:"gap-8"}[i],e),...o,children:n}));n.displayName="BentoGrid";let o=t.forwardRef(({className:e,span:t=1,rowSpan:n=1,children:o,...s},l)=>(0,r.jsx)(i.motion.div,{ref:l,className:(0,a.cn)({1:"col-span-1",2:"col-span-1 md:col-span-2",3:"col-span-1 md:col-span-2 lg:col-span-3",4:"col-span-1 md:col-span-2 lg:col-span-4"}[t],{1:"row-span-1",2:"row-span-1 md:row-span-2",3:"row-span-1 md:row-span-3"}[n],e),initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,ease:[.16,1,.3,1]},...s,children:o}));o.displayName="BentoCard",e.s(["BentoCard",()=>o,"BentoGrid",()=>n])},350627,e=>{"use strict";let r=(0,e.i(475254).default)("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]);e.s(["Receipt",()=>r],350627)},655900,e=>{"use strict";let r=(0,e.i(475254).default)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);e.s(["ChevronUp",()=>r],655900)},246704,779478,e=>{"use strict";var r,t,a=e.i(790224),i=((r={}).AUTH_REQUIRED="AUTH_1001",r.AUTH_INVALID_CREDENTIALS="AUTH_1002",r.AUTH_SESSION_EXPIRED="AUTH_1003",r.AUTH_INSUFFICIENT_PERMISSIONS="AUTH_1004",r.AUTH_2FA_REQUIRED="AUTH_1005",r.AUTH_2FA_INVALID="AUTH_1006",r.VALIDATION_ERROR="VALID_2001",r.VALIDATION_REQUIRED_FIELD="VALID_2002",r.VALIDATION_INVALID_FORMAT="VALID_2003",r.VALIDATION_UNIQUE_CONSTRAINT="VALID_2004",r.DB_CONNECTION_ERROR="DB_3001",r.DB_QUERY_ERROR="DB_3002",r.DB_NOT_FOUND="DB_3003",r.DB_CONSTRAINT_VIOLATION="DB_3004",r.DB_FOREIGN_KEY_CONSTRAINT="DB_3006",r.DB_RLS_POLICY_VIOLATION="DB_3005",r.NETWORK_ERROR="NET_4001",r.API_TIMEOUT="NET_4002",r.API_RATE_LIMIT="NET_4003",r.API_SERVER_ERROR="NET_4004",r.API_NOT_FOUND="NET_4005",r.API_BAD_REQUEST="NET_4006",r.BUSINESS_LOGIC_ERROR="BIZ_5001",r.RESOURCE_LOCKED="BIZ_5002",r.OPERATION_NOT_ALLOWED="BIZ_5003",r.QUOTA_EXCEEDED="BIZ_5004",r.INTERNAL_ERROR="SYS_6001",r.CONFIGURATION_ERROR="SYS_6002",r.SERVICE_UNAVAILABLE="SYS_6003",r);(t={}).LOW="low",t.MEDIUM="medium",t.HIGH="high",t.CRITICAL="critical";class n extends Error{code;severity;userMessage;retryable;context;originalError;constructor(e,r="SYS_6001",t="medium",a={},i){super(e),this.name="AppError",this.code=r,this.severity=t,this.userMessage=a.userMessage||this.getDefaultUserMessage(r),this.retryable=a.retryable??this.isRetryable(r),this.context={...a,code:r,severity:t,timestamp:new Date().toISOString()},this.originalError=i,Error.captureStackTrace&&Error.captureStackTrace(this,n)}getDefaultUserMessage(e){return({AUTH_1001:"Vous devez être connecté pour effectuer cette action.",AUTH_1002:"Email ou mot de passe incorrect.",AUTH_1003:"Votre session a expiré. Veuillez vous reconnecter.",AUTH_1004:"Vous n'avez pas les permissions nécessaires.",AUTH_1005:"Authentification à deux facteurs requise.",AUTH_1006:"Code d'authentification invalide.",VALID_2001:"Les données fournies ne sont pas valides.",VALID_2002:"Certains champs obligatoires sont manquants.",VALID_2003:"Le format des données est incorrect.",VALID_2004:"Cette valeur existe déjà.",DB_3001:"Impossible de se connecter à la base de données.",DB_3002:"Erreur lors de l'exécution de la requête.",DB_3003:"Ressource introuvable.",DB_3004:"Cette opération viole une contrainte de la base de données.",DB_3006:"Cette opération viole une contrainte de clé étrangère.",DB_3005:"Vous n'avez pas accès à cette ressource.",NET_4001:"Erreur de connexion réseau. Vérifiez votre connexion internet.",NET_4002:"La requête a pris trop de temps. Veuillez réessayer.",NET_4003:"Trop de requêtes. Veuillez patienter quelques instants.",NET_4004:"Erreur serveur. Veuillez réessayer plus tard.",NET_4005:"Ressource introuvable.",NET_4006:"Requête invalide.",BIZ_5001:"Cette opération n'est pas autorisée dans le contexte actuel.",BIZ_5002:"Cette ressource est actuellement verrouillée.",BIZ_5003:"Cette opération n'est pas autorisée.",BIZ_5004:"Vous avez atteint la limite autorisée.",SYS_6001:"Une erreur interne est survenue. Veuillez réessayer.",SYS_6002:"Erreur de configuration du système.",SYS_6003:"Service temporairement indisponible."})[e]||"Une erreur inattendue est survenue."}isRetryable(e){return["NET_4001","NET_4002","NET_4004","DB_3001","SYS_6003"].includes(e)}toJSON(){return{name:this.name,message:this.message,code:this.code,severity:this.severity,userMessage:this.userMessage,retryable:this.retryable,context:this.context,stack:this.stack,originalError:this.originalError instanceof Error?{name:this.originalError.name,message:this.originalError.message,stack:this.originalError.stack}:this.originalError}}}let o=new class{handleError(e,r={}){if(e instanceof n)return this.logError(e),e;if(e instanceof Error)return this.handleStandardError(e,r);if(this.isSupabaseError(e))return this.handleSupabaseError(e,r);let t=new n("Une erreur inattendue est survenue.","SYS_6001","high",r,e);return this.logError(t),t}handleStandardError(e,r){let t=e.message.toLowerCase(),a="SYS_6001",i="medium";t.includes("network")||t.includes("fetch")?(a="NET_4001",i="medium"):t.includes("timeout")?(a="NET_4002",i="medium"):t.includes("unauthorized")||t.includes("401")?(a="AUTH_1001",i="high"):t.includes("forbidden")||t.includes("403")?(a="AUTH_1004",i="high"):t.includes("not found")||t.includes("404")?(a="DB_3003",i="low"):(t.includes("validation")||t.includes("invalid"))&&(a="VALID_2001",i="low");let o=new n(e.message,a,i,r,e);return this.logError(o),o}handleSupabaseError(e,r){let t=e.code||e.status,a=e.message||"Erreur Supabase",i=r.code||"DB_3002",o="medium";if(!r.code)switch(t){case"PGRST116":case"42P01":i="DB_3003",o="low";break;case"42501":i="DB_3005",o="high";break;case"23505":i="VALID_2004",o="low";break;case"23503":i="DB_3004",o="medium";break;case"PGRST301":case"400":i="NET_4006",o="low";break;case"401":i="AUTH_1001",o="high";break;case"403":i="AUTH_1004",o="high";break;case"404":i="NET_4005",o="low";break;case"500":i="NET_4004",o="high"}"DB_3006"===i&&(o="medium");let s=new n(a,i,o,r,e);return this.logError(s),s}isSupabaseError(e){return e&&(e.code||e.status||e.message)&&("string"==typeof e.code||"number"==typeof e.status)}logError(e){let r={...e.context,code:e.code,severity:e.severity,retryable:e.retryable};switch(e.severity){case"critical":case"high":a.logger.error(e.message,e.originalError||e,r);break;case"medium":a.logger.warn(e.message,r);break;case"low":a.logger.info(`Error: ${e.message}`,r)}}createValidationError(e,r){return new n(e,"VALID_2001","low",{field:r,userMessage:e})}createAuthError(e,r){return new n(r||"Erreur d'authentification",e,"high")}createDatabaseError(e,r){return new n(e,"DB_3002","medium",{},r)}createNotFoundError(e,r){return new n(e,"DB_3003","low",r)}};e.s(["AppError",()=>n,"ErrorCode",()=>i,"errorHandler",0,o],779478),e.s([],246704)},627404,e=>{"use strict";e.i(246704);var r=e.i(779478);async function t(e,t,a,i){try{let n=e.from(t).select(i?.select||"*").eq("organization_id",a);i?.filters&&Object.entries(i.filters).forEach(([e,r])=>{null!=r&&(n=n.eq(e,r))}),i?.search&&(n=n.ilike(i.search.field,`%${i.search.value}%`)),n=i?.orderBy?n.order(i.orderBy.column,{ascending:i.orderBy.ascending??!1}):n.order("created_at",{ascending:!1});let{data:o,error:s}=await n;if(s)throw r.errorHandler.handleError(s,{organizationId:a,operation:"getAllByOrganization",table:t});return o||[]}catch(e){if(e instanceof r.AppError)throw e;throw r.errorHandler.handleError(e,{organizationId:a,operation:"getAllByOrganization",table:t})}}async function a(e,t,a,i){try{let{data:n,error:o}=await e.from(t).select(i||"*").eq("id",a).single();if(o){if("PGRST116"===o.code||"42P01"===o.code)throw r.errorHandler.handleError(o,{code:r.ErrorCode.DB_NOT_FOUND,operation:"getById",id:a,table:t});throw r.errorHandler.handleError(o,{operation:"getById",id:a,table:t})}if(!n)throw r.errorHandler.createDatabaseError(`Enregistrement avec l'ID ${a} introuvable dans ${t}`,{id:a,table:t});return n}catch(e){if(e instanceof r.AppError)throw e;throw r.errorHandler.handleError(e,{operation:"getById",id:a,table:t})}}e.s(["getAllByOrganization",()=>t,"getById",()=>a])},34458,e=>{"use strict";e.i(246704);var r=e.i(779478);function t(e,t){for(let a of t)if(!e[a])throw r.errorHandler.createValidationError(`Le champ ${String(a)} est obligatoire`,String(a))}e.s(["validateRequired",()=>t])},631259,e=>{"use strict";var r=e.i(920755);e.i(246704);var t=e.i(779478),a=e.i(790224),i=e.i(627404),n=e.i(34458);let o=new class{supabase;constructor(e){this.supabase=e||(0,r.createClient)()}async getAll(e,r){try{let t={};return r?.studentId&&(t.student_id=r.studentId),r?.status&&(t.status=r.status),r?.documentType&&(t.document_type=r.documentType),(0,i.getAllByOrganization)(this.supabase,"invoices",e,{select:"*, students(id, first_name, last_name, student_number), payments(id, amount, status, paid_at)",filters:t,search:r?.search?{field:"invoice_number",value:r.search}:void 0,orderBy:{column:"issue_date",ascending:!1}})}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{organizationId:e,operation:"getAll"})}}async getById(e){try{return(0,i.getById)(this.supabase,"invoices",e,"*, students(*), enrollments(*), payments(*)")}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"getById",id:e})}}async generateInvoiceNumber(e,r="invoice"){let t=new Date().getFullYear().toString(),{data:a}=await this.supabase.from("invoices").select("invoice_number").eq("organization_id",e).eq("document_type",r).like("invoice_number",`${t}-%`).order("invoice_number",{ascending:!1}).limit(1).maybeSingle(),i=1;if(a?.invoice_number){let e=a.invoice_number.split("-");e.length>=2&&e[0]===t&&(i=parseInt(e[1]||"0",10)+1)}return`${t}-${String(i).padStart(3,"0")}`}async create(e){try{(0,n.validateRequired)(e,["organization_id","student_id"]);let r=e.invoice_number;if(!r||""===r.trim()){let a=e.organization_id;if(!a)throw t.errorHandler.createValidationError("Organization ID is required to create an invoice.");r=await this.generateInvoiceNumber(a,e.document_type||"invoice")}let{data:i,error:o}=await this.supabase.from("invoices").insert({...e,invoice_number:r}).select().single();if(o){if("23505"===o.code)throw t.errorHandler.handleError(o,{code:t.ErrorCode.VALIDATION_UNIQUE_CONSTRAINT,operation:"create",field:"invoice_number"});if("42501"===o.code)throw t.errorHandler.handleError(o,{code:t.ErrorCode.DB_RLS_POLICY_VIOLATION,operation:"create"});throw t.errorHandler.handleError(o,{operation:"create",invoice:e})}return a.logger.info("Facture créée avec succès",{id:i?.id,organizationId:e.organization_id||void 0,invoiceNumber:i?.invoice_number}),i}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"create",invoice:e})}}async update(e,r){try{let{data:i,error:n}=await this.supabase.from("invoices").update(r).eq("id",e).select().single();if(n){if("PGRST116"===n.code||"42P01"===n.code)throw t.errorHandler.handleError(n,{code:t.ErrorCode.DB_NOT_FOUND,operation:"update",id:e});if("42501"===n.code)throw t.errorHandler.handleError(n,{code:t.ErrorCode.DB_RLS_POLICY_VIOLATION,operation:"update",id:e});throw t.errorHandler.handleError(n,{operation:"update",id:e,updates:r})}if(!i)throw t.errorHandler.createDatabaseError(`Facture avec l'ID ${e} introuvable pour la mise \xe0 jour`,{id:e});return a.logger.info("Facture mise à jour avec succès",{id:e,updates:r}),i}catch(a){if(a instanceof t.AppError)throw a;throw t.errorHandler.handleError(a,{operation:"update",id:e,updates:r})}}async generateForClass(e,r,i,n,o,s="tuition"){let{data:l,error:c}=await this.supabase.from("students").select("id").eq("organization_id",e).eq("class_id",r).eq("status","active");if(c)throw t.errorHandler.handleError(c,{operation:"generateForClass",organizationId:e,classId:r,step:"fetchStudents"});if(!l||0===l.length)throw t.errorHandler.createValidationError("Aucun élève actif dans cette classe","classId");let{data:u}=await this.supabase.from("organizations").select("code").eq("id",e).single(),d=u?.code||"ORG",p=new Date().getFullYear().toString().slice(-2),{data:h}=await this.supabase.from("invoices").select("invoice_number").eq("organization_id",e).like("invoice_number",`FAC-${d}-${p}-%`).order("invoice_number",{ascending:!1}).limit(1).maybeSingle(),f=1;if(h?.invoice_number){let e=h.invoice_number.split("-");f=parseInt(e[e.length-1]||"0")+1}let m=l.map((r,t)=>({organization_id:e,student_id:r.id,invoice_number:`FAC-${d}-${p}-${String(f+t).padStart(6,"0")}`,type:s,document_type:"invoice",issue_date:new Date().toISOString().split("T")[0],due_date:o,amount:i,tax_amount:0,total_amount:i,currency:n,status:"draft",items:[]})),{data:y,error:g}=await this.supabase.from("invoices").insert(m).select();if(g)throw t.errorHandler.handleError(g,{operation:"generateForClass",organizationId:e,classId:r,count:m.length});return a.logger.info("Factures générées en masse avec succès",{organizationId:e,classId:r,count:y?.length||0}),y||[]}async getOverdue(e){let r=new Date().toISOString().split("T")[0];try{let{data:a,error:i}=await this.supabase.from("invoices").select("*, students(id, first_name, last_name, student_number)").eq("organization_id",e).eq("document_type","invoice").in("status",["sent","partial"]).lt("due_date",r).order("due_date",{ascending:!0});if(i)throw t.errorHandler.handleError(i,{operation:"getOverdue",organizationId:e});return a||[]}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"getOverdue",organizationId:e})}}async convertQuoteToInvoice(e){try{let{data:r,error:i}=await this.supabase.from("invoices").select("*").eq("id",e).eq("document_type","quote").single();if(i){if("PGRST116"===i.code||"42P01"===i.code)throw t.errorHandler.handleError(i,{code:t.ErrorCode.DB_NOT_FOUND,operation:"convertQuoteToInvoice",quoteId:e});throw t.errorHandler.handleError(i,{operation:"convertQuoteToInvoice",quoteId:e,step:"fetchQuote"})}if(!r)throw t.errorHandler.createDatabaseError(`Devis avec l'ID ${e} introuvable`,{quoteId:e});let{data:n,error:o}=await this.supabase.from("invoices").update({document_type:"invoice",status:"draft",issue_date:r.issue_date||new Date().toISOString().split("T")[0]}).eq("id",e).select().single();if(o)throw t.errorHandler.handleError(o,{operation:"convertQuoteToInvoice",quoteId:e,step:"updateInvoice"});return a.logger.info("Devis converti en facture avec succès",{quoteId:e,invoiceId:n?.id}),n}catch(r){if(r instanceof t.AppError)throw r;throw t.errorHandler.handleError(r,{operation:"convertQuoteToInvoice",quoteId:e})}}};e.s(["invoiceService",0,o])},129228,555706,e=>{"use strict";var r=e.i(883966),t=e.i(271645),a=e.i(273050),i=e.i(771223),n=e.i(629873),o=e.i(898892),s=e.i(207670),l=e.i(372733),c=e.i(238279),u=e.i(997865),d=e.i(969212),p=e.i(734251),h=e.i(794395),f=e.i(781977),m=e.i(562728),y=e.i(198770),g=["type","layout","connectNulls","ref"],_=["key"];function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e,r){if(null==e)return{};var t,a,i=function(e,r){if(null==e)return{};var t={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(r.indexOf(a)>=0)continue;t[a]=e[a]}return t}(e,r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)t=n[a],!(r.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function E(){return(E=Object.assign.bind()).apply(this,arguments)}function A(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);r&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,a)}return t}function w(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?A(Object(t),!0).forEach(function(r){N(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):A(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function I(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,r){if(e){if("string"==typeof e)return S(e,void 0);var t=Object.prototype.toString.call(e).slice(8,-1);if("Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return S(e,void 0)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=Array(r);t<r;t++)a[t]=e[t];return a}function x(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,k(a.key),a)}}function O(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(O=function(){return!!e})()}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,r){return(T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e})(e,r)}function N(e,r,t){return(r=k(r))in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function k(e){var r=function(e,r){if("object"!=v(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,r||"default");if("object"!=v(a))return a;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"==v(r)?r:r+""}var C=function(e){var r,m;function A(){var e,r,t;if(!(this instanceof A))throw TypeError("Cannot call a class as a function");for(var a=arguments.length,i=Array(a),n=0;n<a;n++)i[n]=arguments[n];return r=A,t=[].concat(i),r=D(r),N(e=function(e,r){if(r&&("object"===v(r)||"function"==typeof r))return r;if(void 0!==r)throw TypeError("Derived constructors may only return object or undefined");var t=e;if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(this,O()?Reflect.construct(r,t||[],D(this).constructor):r.apply(this,t)),"state",{isAnimationFinished:!0,totalLength:0}),N(e,"generateSimpleStrokeDasharray",function(e,r){return"".concat(r,"px ").concat(e-r,"px")}),N(e,"getStrokeDasharray",function(r,t,a){var i=a.reduce(function(e,r){return e+r});if(!i)return e.generateSimpleStrokeDasharray(t,r);for(var n=Math.floor(r/i),o=r%i,s=t-r,l=[],c=0,u=0;c<a.length;u+=a[c],++c)if(u+a[c]>o){l=[].concat(I(a.slice(0,c)),[o-u]);break}var d=l.length%2==0?[0,s]:[s];return[].concat(I(A.repeat(a,n)),I(l),d).map(function(e){return"".concat(e,"px")}).join(", ")}),N(e,"id",(0,h.uniqueId)("recharts-line-")),N(e,"pathRef",function(r){e.mainCurve=r}),N(e,"handleAnimationEnd",function(){e.setState({isAnimationFinished:!0}),e.props.onAnimationEnd&&e.props.onAnimationEnd()}),N(e,"handleAnimationStart",function(){e.setState({isAnimationFinished:!1}),e.props.onAnimationStart&&e.props.onAnimationStart()}),e}if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");return A.prototype=Object.create(e&&e.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),Object.defineProperty(A,"prototype",{writable:!1}),e&&T(A,e),r=[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var e=this.getTotalLength();this.setState({totalLength:e})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var e=this.getTotalLength();e!==this.state.totalLength&&this.setState({totalLength:e})}}},{key:"getTotalLength",value:function(){var e=this.mainCurve;try{return e&&e.getTotalLength&&e.getTotalLength()||0}catch(e){return 0}}},{key:"renderErrorBar",value:function(e,r){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var a=this.props,i=a.points,n=a.xAxis,o=a.yAxis,s=a.layout,l=a.children,c=(0,f.findAllByType)(l,p.ErrorBar);if(!c)return null;var d=function(e,r){return{x:e.x,y:e.y,value:e.value,errorVal:(0,y.getValueByDataKey)(e.payload,r)}};return t.default.createElement(u.Layer,{clipPath:e?"url(#clipPath-".concat(r,")"):null},c.map(function(e){return t.default.cloneElement(e,{key:"bar-".concat(e.props.dataKey),data:i,xAxis:n,yAxis:o,layout:s,dataPointFormatter:d})}))}},{key:"renderDots",value:function(e,r,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var i=this.props,n=i.dot,o=i.points,s=i.dataKey,l=(0,f.filterProps)(this.props,!1),c=(0,f.filterProps)(n,!0),d=o.map(function(e,r){var t=w(w(w({key:"dot-".concat(r),r:3},l),c),{},{index:r,cx:e.x,cy:e.y,value:e.value,dataKey:s,payload:e.payload,points:o});return A.renderDotItem(n,t)}),p={clipPath:e?"url(#clipPath-".concat(r?"":"dots-").concat(a,")"):null};return t.default.createElement(u.Layer,E({className:"recharts-line-dots",key:"dots"},p),d)}},{key:"renderCurveStatically",value:function(e,r,a,i){var n=this.props,o=n.type,s=n.layout,c=n.connectNulls,u=(n.ref,b(n,g)),d=w(w(w({},(0,f.filterProps)(u,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:r?"url(#clipPath-".concat(a,")"):null,points:e},i),{},{type:o,layout:s,connectNulls:c});return t.default.createElement(l.Curve,E({},d,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(e,r){var i=this,n=this.props,o=n.points,s=n.strokeDasharray,l=n.isAnimationActive,c=n.animationBegin,u=n.animationDuration,d=n.animationEasing,p=n.animationId,f=n.animateNewValues,m=n.width,y=n.height,g=this.state,_=g.prevPoints,v=g.totalLength;return t.default.createElement(a.default,{begin:c,duration:u,isActive:l,easing:d,from:{t:0},to:{t:1},key:"line-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(t){var a,n=t.t;if(_){var l=_.length/o.length,c=o.map(function(e,r){var t=Math.floor(r*l);if(_[t]){var a=_[t],i=(0,h.interpolateNumber)(a.x,e.x),o=(0,h.interpolateNumber)(a.y,e.y);return w(w({},e),{},{x:i(n),y:o(n)})}if(f){var s=(0,h.interpolateNumber)(2*m,e.x),c=(0,h.interpolateNumber)(y/2,e.y);return w(w({},e),{},{x:s(n),y:c(n)})}return w(w({},e),{},{x:e.x,y:e.y})});return i.renderCurveStatically(c,e,r)}var u=(0,h.interpolateNumber)(0,v)(n);if(s){var d="".concat(s).split(/[,\s]+/gim).map(function(e){return parseFloat(e)});a=i.getStrokeDasharray(u,v,d)}else a=i.generateSimpleStrokeDasharray(v,u);return i.renderCurveStatically(o,e,r,{strokeDasharray:a})})}},{key:"renderCurve",value:function(e,r){var t=this.props,a=t.points,i=t.isAnimationActive,n=this.state,s=n.prevPoints,l=n.totalLength;return i&&a&&a.length&&(!s&&l>0||!(0,o.default)(s,a))?this.renderCurveWithAnimation(e,r):this.renderCurveStatically(a,e,r)}},{key:"render",value:function(){var e,r=this.props,a=r.hide,i=r.dot,o=r.points,l=r.className,c=r.xAxis,p=r.yAxis,h=r.top,m=r.left,y=r.width,g=r.height,_=r.isAnimationActive,v=r.id;if(a||!o||!o.length)return null;var b=this.state.isAnimationFinished,E=1===o.length,A=(0,s.default)("recharts-line",l),w=c&&c.allowDataOverflow,I=p&&p.allowDataOverflow,S=w||I,x=(0,n.default)(v)?this.id:v,O=null!=(e=(0,f.filterProps)(i,!1))?e:{r:3,strokeWidth:2},D=O.r,T=O.strokeWidth,N=((0,f.hasClipDot)(i)?i:{}).clipDot,k=void 0===N||N,C=2*(void 0===D?3:D)+(void 0===T?2:T);return t.default.createElement(u.Layer,{className:A},w||I?t.default.createElement("defs",null,t.default.createElement("clipPath",{id:"clipPath-".concat(x)},t.default.createElement("rect",{x:w?m:m-y/2,y:I?h:h-g/2,width:w?y:2*y,height:I?g:2*g})),!k&&t.default.createElement("clipPath",{id:"clipPath-dots-".concat(x)},t.default.createElement("rect",{x:m-C/2,y:h-C/2,width:y+C,height:g+C}))):null,!E&&this.renderCurve(S,x),this.renderErrorBar(S,x),(E||i)&&this.renderDots(S,k,x),(!_||b)&&d.LabelList.renderCallByParent(this.props,o))}}],m=[{key:"getDerivedStateFromProps",value:function(e,r){return e.animationId!==r.prevAnimationId?{prevAnimationId:e.animationId,curPoints:e.points,prevPoints:r.curPoints}:e.points!==r.curPoints?{curPoints:e.points}:null}},{key:"repeat",value:function(e,r){for(var t=e.length%2!=0?[].concat(I(e),[0]):e,a=[],i=0;i<r;++i)a=[].concat(I(a),I(t));return a}},{key:"renderDotItem",value:function(e,r){var a;if(t.default.isValidElement(e))a=t.default.cloneElement(e,r);else if((0,i.default)(e))a=e(r);else{var n=r.key,o=b(r,_),l=(0,s.default)("recharts-line-dot","boolean"!=typeof e?e.className:"");a=t.default.createElement(c.Dot,E({key:n},o,{className:l}))}return a}}],r&&x(A.prototype,r),m&&x(A,m),Object.defineProperty(A,"prototype",{writable:!1}),A}(t.PureComponent);N(C,"displayName","Line"),N(C,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!m.Global.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1}),N(C,"getComposedData",function(e){var r=e.props,t=e.xAxis,a=e.yAxis,i=e.xAxisTicks,o=e.yAxisTicks,s=e.dataKey,l=e.bandSize,c=e.displayedData,u=e.offset,d=r.layout;return w({points:c.map(function(e,r){var c=(0,y.getValueByDataKey)(e,s);return"horizontal"===d?{x:(0,y.getCateCoordinateOfLine)({axis:t,ticks:i,bandSize:l,entry:e,index:r}),y:(0,n.default)(c)?null:a.scale(c),value:c,payload:e}:{x:(0,n.default)(c)?null:t.scale(c),y:(0,y.getCateCoordinateOfLine)({axis:a,ticks:o,bandSize:l,entry:e,index:r}),value:c,payload:e}}),layout:d},u)}),e.s(["Line",()=>C],555706);var R=e.i(785183),B=e.i(93230),P=e.i(844171),L=(0,r.generateCategoricalChart)({chartName:"LineChart",GraphicalChild:C,axisComponents:[{axisType:"xAxis",AxisComp:R.XAxis},{axisType:"yAxis",AxisComp:B.YAxis}],formatAxisMap:P.formatAxisMap});e.s(["LineChart",()=>L],129228)},115057,e=>{"use strict";let r=(0,e.i(475254).default)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]);e.s(["ArrowUpRight",()=>r],115057)},649582,e=>{"use strict";let r=(0,e.i(475254).default)("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);e.s(["SlidersHorizontal",()=>r],649582)},134150,635408,e=>{"use strict";var r=e.i(920755);let t=new class{supabase;constructor(e){this.supabase=e||(0,r.createClient)()}async getCategories(e){let{data:r,error:t}=await this.supabase.from("charge_categories").select("*").eq("organization_id",e).eq("is_active",!0).order("name",{ascending:!0});return t?(console.error("Erreur récupération catégories:",t),[]):r||[]}async createCategory(e,r){let{data:t,error:a}=await this.supabase.from("charge_categories").insert({...r,organization_id:e}).select().single();if(a)throw a;return t}async initDefaultCategories(e){let{error:r}=await this.supabase.rpc("init_default_charge_categories",{p_organization_id:e});if(r)throw r}async getBySession(e){let{data:r,error:t}=await this.supabase.from("session_charges").select(`
        *,
        charge_categories(*)
      `).eq("session_id",e).order("charge_date",{ascending:!1});return t?(console.error("Erreur récupération charges:",t),[]):r||[]}async getAll(e,r){let t=this.supabase.from("session_charges").select(`
        *,
        charge_categories(*),
        sessions(id, name)
      `).eq("organization_id",e);r?.sessionId&&(t=t.eq("session_id",r.sessionId)),r?.categoryId&&(t=t.eq("category_id",r.categoryId)),r?.paymentStatus&&(t=t.eq("payment_status",r.paymentStatus)),r?.startDate&&(t=t.gte("charge_date",r.startDate)),r?.endDate&&(t=t.lte("charge_date",r.endDate));let{data:a,error:i}=await t.order("charge_date",{ascending:!1});return i?(console.error("Erreur récupération charges:",i),[]):a||[]}async getById(e){let{data:r,error:t}=await this.supabase.from("session_charges").select(`
        *,
        charge_categories(*),
        sessions(id, name)
      `).eq("id",e).single();if(t){if("PGRST116"===t.code)return null;throw t}return r}async create(e,r,t){let{data:a,error:i}=await this.supabase.from("session_charges").insert({...t,organization_id:e,session_id:r}).select(`
        *,
        charge_categories(*)
      `).single();if(i)throw i;return a}async update(e,r){let{data:t,error:a}=await this.supabase.from("session_charges").update(r).eq("id",e).select(`
        *,
        charge_categories(*)
      `).single();if(a)throw a;return t}async delete(e){let{error:r}=await this.supabase.from("session_charges").delete().eq("id",e);if(r)throw r}async getSessionSummary(e){let{data:r,error:t}=await this.supabase.rpc("calculate_session_charges_total",{p_session_id:e});return t?(console.error("Erreur calcul résumé charges:",t),null):r&&0!==r.length?{total_amount:Number(r[0].total_amount)||0,paid_amount:Number(r[0].paid_amount)||0,pending_amount:Number(r[0].pending_amount)||0,charge_count:Number(r[0].charge_count)||0}:{total_amount:0,paid_amount:0,pending_amount:0,charge_count:0}}};e.s(["sessionChargesService",0,t],134150);let a=(0,e.i(475254).default)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);e.s(["TrendingDown",()=>a],635408)}]);