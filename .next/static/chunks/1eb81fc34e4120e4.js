(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let s=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>s],107233)},605631,e=>{"use strict";let s=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>s],605631)},738308,e=>{"use strict";let s=(0,e.i(475254).default)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);e.s(["XCircle",()=>s],738308)},319036,e=>{"use strict";var s=e.i(843476),i=e.i(271645),t=e.i(647163);let a=i.forwardRef(({checked:e,onCheckedChange:i,disabled:a,className:r,...n},l)=>(0,s.jsx)("button",{type:"button",role:"switch","aria-checked":e,ref:l,disabled:a,onClick:()=>i?.(!e),className:(0,t.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",e?"bg-brand-blue":"bg-input",r),...n,children:(0,s.jsx)("span",{className:(0,t.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",e?"translate-x-5":"translate-x-0")})}));a.displayName="Switch",e.s(["Switch",0,a])},436332,e=>{"use strict";let s=(0,e.i(475254).default)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]]);e.s(["Edit",()=>s],436332)},182774,e=>{"use strict";var s=e.i(843476),i=e.i(325715),t=e.i(618566),a=e.i(271645);let r=(0,e.i(475254).default)("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var n=e.i(167881),l=e.i(970065),d=e.i(522016);function c({children:e,allowedRoles:c,fallback:o,redirectTo:u="/dashboard"}){let{user:h,isLoading:m}=(0,i.useAuth)(),p=(0,t.useRouter)(),[x,g]=(0,a.useState)(null);return((0,a.useEffect)(()=>{if(!m&&h){let e=h.role||"",s=c.includes(e);g(s),s||!u||o||p.push(u)}},[h,m,c,u,p,o]),m||null===x)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):x?(0,s.jsx)(s.Fragment,{children:e}):o?(0,s.jsx)(s.Fragment,{children:o}):(0,s.jsx)("div",{className:"container mx-auto py-16 px-4",children:(0,s.jsx)(l.Card,{className:"max-w-md mx-auto",children:(0,s.jsxs)(l.CardContent,{className:"py-12 text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,s.jsx)(r,{className:"h-8 w-8 text-red-600"})}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"AccÃ¨s non autorisÃ©"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"Vous n'avez pas les permissions nÃ©cessaires pour accÃ©der Ã  cette page."}),(0,s.jsx)(d.default,{href:"/dashboard",children:(0,s.jsx)(n.Button,{children:"Retour au tableau de bord"})})]})})})}e.s(["ADMIN_ROLES",0,["super_admin","admin","secretary","accountant"],"FINANCE_ROLES",0,["super_admin","admin","secretary","accountant"],"FORMATION_MANAGEMENT_ROLES",0,["super_admin","admin","secretary"],"RoleGuard",()=>c],182774)},746042,e=>{"use strict";var s=e.i(843476),i=e.i(271645),t=e.i(266027),a=e.i(954616),r=e.i(912598),n=e.i(325715),l=e.i(920755);let d=new class{supabase;constructor(e){this.supabase=e||(0,l.createClient)()}async getAll(e,s){let i=this.supabase.from("sites").select("*").eq("organization_id",e);s?.isActive!==void 0&&(i=i.eq("is_active",s.isActive)),s?.type&&(i=i.eq("type",s.type)),s?.search&&(i=i.or(`name.ilike.%${s.search}%,city.ilike.%${s.search}%,code.ilike.%${s.search}%`));let{data:t,error:a}=await i.order("is_headquarters",{ascending:!1}).order("name",{ascending:!0});if(a)throw a;return t||[]}async getById(e){let{data:s,error:i}=await this.supabase.from("sites").select("*").eq("id",e).single();if(i)throw i;return s}async getHeadquarters(e){let{data:s,error:i}=await this.supabase.from("sites").select("*").eq("organization_id",e).eq("is_headquarters",!0).eq("is_active",!0).maybeSingle();if(i)throw i;return s}async create(e){if(e.is_headquarters){let s=await this.getHeadquarters(e.organization_id);if(s&&s.id!==e.id)throw Error("Il existe dÃ©jÃ  un siÃ¨ge principal. DÃ©signez d'abord le nouveau siÃ¨ge comme non-siÃ¨ge.")}let{data:s,error:i}=await this.supabase.from("sites").insert(e).select().single();if(i)throw i;return s}async update(e,s){if(s.is_headquarters){let s=await this.getById(e);if(s.organization_id){let i=await this.getHeadquarters(s.organization_id);i&&i.id!==e&&await this.supabase.from("sites").update({is_headquarters:!1}).eq("id",i.id)}}let{data:i,error:t}=await this.supabase.from("sites").update(s).eq("id",e).select().single();if(t)throw t;return i}async delete(e){let{error:s}=await this.supabase.from("sites").update({is_active:!1}).eq("id",e);if(s)throw s}async getPublicSites(e){let{data:s,error:i}=await this.supabase.from("sites").select("*").eq("organization_id",e).eq("is_active",!0).order("is_headquarters",{ascending:!1}).order("name",{ascending:!0});if(i)throw i;return s||[]}calculateDistance(e,s,i,t){let a=this.toRad(i-e),r=this.toRad(t-s),n=Math.sin(a/2)*Math.sin(a/2)+Math.cos(this.toRad(e))*Math.cos(this.toRad(i))*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(n),Math.sqrt(1-n))*6371}toRad(e){return Math.PI/180*e}async findNearestSites(e,s,i,t=5){return(await this.getPublicSites(e)).filter(e=>e.latitude&&e.longitude).map(e=>({...e,distance:this.calculateDistance(s,i,Number(e.latitude),Number(e.longitude))})).sort((e,s)=>(e.distance||0)-(s.distance||0)).slice(0,t)}};var c=e.i(167881),o=e.i(970065),u=e.i(630374),h=e.i(23750),m=e.i(10708),p=e.i(184762),x=e.i(319036),g=e.i(6799),j=e.i(107233),v=e.i(346897),b=e.i(607486),y=e.i(436332),f=e.i(727612),N=e.i(605631),_=e.i(738308),w=e.i(182774);function C(){return(0,s.jsx)(w.RoleGuard,{allowedRoles:w.FORMATION_MANAGEMENT_ROLES,children:(0,s.jsx)(q,{})})}function q(){let{user:e}=(0,n.useAuth)(),l=(0,r.useQueryClient)(),{addToast:u}=(0,g.useToast)(),[h,m]=(0,i.useState)(!1),[p,x]=(0,i.useState)(null),{data:w,isLoading:C}=(0,t.useQuery)({queryKey:["sites",e?.organization_id],queryFn:async()=>e?.organization_id?d.getAll(e.organization_id):[],enabled:!!e?.organization_id}),q=(0,a.useMutation)({mutationFn:async s=>{if(!e?.organization_id)throw Error("Organization ID missing");return d.create({...s,organization_id:e.organization_id})},onSuccess:()=>{l.invalidateQueries({queryKey:["sites"]}),m(!1),u({title:"SuccÃ¨s",description:"Site crÃ©Ã© avec succÃ¨s",type:"success"})},onError:e=>{u({title:"Erreur",description:e.message||"Erreur lors de la crÃ©ation du site",type:"error"})}}),k=(0,a.useMutation)({mutationFn:async({id:e,data:s})=>d.update(e,s),onSuccess:()=>{l.invalidateQueries({queryKey:["sites"]}),m(!1),x(null),u({title:"SuccÃ¨s",description:"Site mis Ã  jour avec succÃ¨s",type:"success"})},onError:e=>{u({title:"Erreur",description:e.message||"Erreur lors de la mise Ã  jour",type:"error"})}}),F=(0,a.useMutation)({mutationFn:async e=>d.delete(e),onSuccess:()=>{l.invalidateQueries({queryKey:["sites"]}),u({title:"SuccÃ¨s",description:"Site supprimÃ© avec succÃ¨s",type:"success"})},onError:e=>{u({title:"Erreur",description:e.message||"Erreur lors de la suppression",type:"error"})}}),M=async e=>{confirm("ÃŠtes-vous sÃ»r de vouloir supprimer ce site ?")&&F.mutate(e)};return e?.organization_id?(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"Sites et Antennes"}),(0,s.jsx)("p",{className:"text-gray-600 mt-1",children:"GÃ©rez les sites et antennes de votre organisation"})]}),(0,s.jsxs)(c.Button,{onClick:()=>{x(null),m(!0)},className:"bg-brand-blue hover:bg-brand-blue-dark",children:[(0,s.jsx)(j.Plus,{className:"w-4 h-4 mr-2"}),"Nouveau site"]})]}),C?(0,s.jsx)("div",{className:"text-center py-12",children:"Chargement..."}):w&&w.length>0?(0,s.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:w.map(e=>(0,s.jsxs)(o.Card,{className:"hover:shadow-lg transition-shadow",children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)(o.CardTitle,{className:"flex items-center gap-2",children:[(0,s.jsx)(b.Building2,{className:"w-5 h-5 text-brand-blue"}),e.name]}),e.is_headquarters&&(0,s.jsx)("span",{className:"inline-block mt-2 px-2 py-1 text-xs bg-yellow-100 text-yellow-800 rounded-full",children:"SiÃ¨ge principal"}),(0,s.jsx)("span",{className:"inline-block mt-2 ml-2 px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full",children:e.type})]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(c.Button,{variant:"outline",size:"icon",onClick:()=>{x(e),m(!0)},children:(0,s.jsx)(y.Edit,{className:"w-4 h-4"})}),(0,s.jsx)(c.Button,{variant:"outline",size:"icon",onClick:()=>M(e.id),children:(0,s.jsx)(f.Trash2,{className:"w-4 h-4 text-red-600"})})]})]})}),(0,s.jsxs)(o.CardContent,{className:"space-y-2",children:[e.address&&(0,s.jsxs)("div",{className:"flex items-start text-sm text-gray-600",children:[(0,s.jsx)(v.MapPin,{className:"w-4 h-4 mr-2 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{children:e.address}),e.postal_code&&e.city&&(0,s.jsxs)("div",{children:[e.postal_code," ",e.city]}),e.country&&(0,s.jsx)("div",{children:e.country})]})]}),e.phone&&(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["ðŸ“ž ",e.phone]}),e.email&&(0,s.jsxs)("div",{className:"text-sm text-gray-600",children:["âœ‰ï¸ ",e.email]}),(0,s.jsx)("div",{className:"flex items-center gap-2 pt-2 border-t",children:e.is_active?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(N.CheckCircle,{className:"w-4 h-4 text-green-600"}),(0,s.jsx)("span",{className:"text-sm text-green-600",children:"Actif"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(_.XCircle,{className:"w-4 h-4 text-gray-400"}),(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"Inactif"})]})})]})]},e.id))}):(0,s.jsx)(o.Card,{children:(0,s.jsxs)(o.CardContent,{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-gray-600",children:"Aucun site configurÃ©"}),(0,s.jsxs)(c.Button,{onClick:()=>m(!0),className:"mt-4 bg-brand-blue hover:bg-brand-blue-dark",children:[(0,s.jsx)(j.Plus,{className:"w-4 h-4 mr-2"}),"CrÃ©er le premier site"]})]})}),(0,s.jsx)(S,{open:h,onClose:()=>{m(!1),x(null)},site:p,onSubmit:e=>{p?k.mutate({id:p.id,data:e}):q.mutate(e)},isSubmitting:q.isPending||k.isPending})]}):(0,s.jsx)("div",{className:"p-6",children:(0,s.jsx)("p",{children:"Aucune organisation"})})}function S({open:e,onClose:t,site:a,onSubmit:r,isSubmitting:n}){let[l,d]=(0,i.useState)({name:"",code:"",type:"site",address:"",city:"",postal_code:"",country:"FR",phone:"",email:"",is_active:!0,is_headquarters:!1,description:"",latitude:"",longitude:""});return(0,i.useEffect)(()=>{a?d({name:a.name||"",code:a.code||"",type:a.type||"site",address:a.address||"",city:a.city||"",postal_code:a.postal_code||"",country:a.country||"FR",phone:a.phone||"",email:a.email||"",is_active:a.is_active??!0,is_headquarters:a.is_headquarters??!1,description:a.description||"",latitude:a.latitude?.toString()||"",longitude:a.longitude?.toString()||""}):d({name:"",code:"",type:"site",address:"",city:"",postal_code:"",country:"FR",phone:"",email:"",is_active:!0,is_headquarters:!1,description:"",latitude:"",longitude:""})},[a,e]),(0,s.jsx)(u.Dialog,{open:e,onOpenChange:t,children:(0,s.jsxs)(u.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,s.jsx)(u.DialogHeader,{children:(0,s.jsx)(u.DialogTitle,{children:a?"Modifier le site":"Nouveau site"})}),(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),r({...l,latitude:l.latitude?parseFloat(l.latitude):null,longitude:l.longitude?parseFloat(l.longitude):null})},className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)(m.Label,{htmlFor:"name",children:["Nom du site ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)(h.Input,{id:"name",value:l.name,onChange:e=>d({...l,name:e.target.value}),required:!0,disabled:n})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"code",children:"Code (optionnel)"}),(0,s.jsx)(h.Input,{id:"code",value:l.code,onChange:e=>d({...l,code:e.target.value}),disabled:n})]})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"type",children:"Type"}),(0,s.jsxs)("select",{id:"type",value:l.type,onChange:e=>d({...l,type:e.target.value}),className:"w-full px-3 py-2 border rounded-lg",disabled:n,children:[(0,s.jsx)("option",{value:"headquarters",children:"SiÃ¨ge"}),(0,s.jsx)("option",{value:"site",children:"Site"}),(0,s.jsx)("option",{value:"antenna",children:"Antenne"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 pt-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(x.Switch,{checked:l.is_headquarters,onCheckedChange:e=>d({...l,is_headquarters:e}),disabled:n}),(0,s.jsx)(m.Label,{children:"SiÃ¨ge principal"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(x.Switch,{checked:l.is_active,onCheckedChange:e=>d({...l,is_active:e}),disabled:n}),(0,s.jsx)(m.Label,{htmlFor:"is_active",children:"Actif"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"address",children:"Adresse"}),(0,s.jsx)(h.Input,{id:"address",value:l.address,onChange:e=>d({...l,address:e.target.value}),disabled:n})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"postal_code",children:"Code postal"}),(0,s.jsx)(h.Input,{id:"postal_code",value:l.postal_code,onChange:e=>d({...l,postal_code:e.target.value}),disabled:n})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"city",children:"Ville"}),(0,s.jsx)(h.Input,{id:"city",value:l.city,onChange:e=>d({...l,city:e.target.value}),disabled:n})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"country",children:"Pays"}),(0,s.jsx)(h.Input,{id:"country",value:l.country,onChange:e=>d({...l,country:e.target.value}),disabled:n})]})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"phone",children:"TÃ©lÃ©phone"}),(0,s.jsx)(h.Input,{id:"phone",value:l.phone,onChange:e=>d({...l,phone:e.target.value}),disabled:n})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"email",children:"Email"}),(0,s.jsx)(h.Input,{id:"email",type:"email",value:l.email,onChange:e=>d({...l,email:e.target.value}),disabled:n})]})]}),(0,s.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"latitude",children:"Latitude (GPS)"}),(0,s.jsx)(h.Input,{id:"latitude",type:"number",step:"any",value:l.latitude,onChange:e=>d({...l,latitude:e.target.value}),disabled:n})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"longitude",children:"Longitude (GPS)"}),(0,s.jsx)(h.Input,{id:"longitude",type:"number",step:"any",value:l.longitude,onChange:e=>d({...l,longitude:e.target.value}),disabled:n})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(m.Label,{htmlFor:"description",children:"Description"}),(0,s.jsx)(p.Textarea,{id:"description",value:l.description,onChange:e=>d({...l,description:e.target.value}),rows:3,disabled:n})]}),(0,s.jsxs)(u.DialogFooter,{children:[(0,s.jsx)(c.Button,{type:"button",variant:"outline",onClick:t,disabled:n,children:"Annuler"}),(0,s.jsx)(c.Button,{type:"submit",disabled:n,className:"bg-brand-blue hover:bg-brand-blue-dark",children:a?"Enregistrer":"CrÃ©er"})]})]})]})})}e.s(["default",()=>C],746042)}]);