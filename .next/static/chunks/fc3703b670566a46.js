(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,503116,e=>{"use strict";let t=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],503116)},605631,e=>{"use strict";let t=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],605631)},982868,e=>{"use strict";var t=e.i(843476),s=e.i(266027),r=e.i(325715),a=e.i(920755),i=e.i(970065),n=e.i(167881),d=e.i(605631),l=e.i(503116),c=e.i(898791),m=e.i(561659),u=e.i(647163),o=e.i(522016);function x(){let{user:e}=(0,r.useAuth)(),x=(0,a.createClient)(),{data:h}=(0,s.useQuery)({queryKey:["portal-invoices",e?.id],queryFn:async()=>{if(!e?.id)return[];let t=[];if(e?.role==="parent"){let{data:s}=await x.from("guardians").select("id").eq("user_id",e.id);if(!s||0===s.length)return[];let{data:r}=await x.from("student_guardians").select("student_id").in("guardian_id",s.map(e=>e.id));if(!r||0===r.length)return[];t=r.map(e=>e.student_id).filter(e=>null!==e)}else if(e?.role==="student"){let{data:s}=await x.from("students").select("id").eq("id",e.id).single();s&&(t=[s.id])}if(0===t.length)return[];let{data:s}=await x.from("invoices").select("*, students(first_name, last_name)").in("student_id",t).order("issue_date",{ascending:!1});return s||[]},enabled:!!e?.id}),{data:f}=(0,s.useQuery)({queryKey:["portal-payments",e?.id],queryFn:async()=>{if(!e?.id)return[];let t=[];if(e?.role==="parent"){let{data:s}=await x.from("guardians").select("id").eq("user_id",e.id);if(!s||0===s.length)return[];let{data:r}=await x.from("student_guardians").select("student_id").in("guardian_id",s.map(e=>e.id));if(!r||0===r.length)return[];t=r.map(e=>e.student_id).filter(e=>null!==e)}else e?.role==="student"&&(t=[e.id]);if(0===t.length)return[];let{data:s}=await x.from("payments").select("*, invoices(invoice_number), students(first_name, last_name)").in("student_id",t).eq("status","completed").order("paid_at",{ascending:!1}).limit(10);return s||[]},enabled:!!e?.id}),p=h?.filter(e=>"invoice"===e.document_type||!e.document_type)||[],j=p.filter(e=>["sent","partial","overdue"].includes(e.status))||[],y=p.filter(e=>"paid"===e.status)||[];return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Paiements"}),(0,t.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Gérez vos factures et paiements"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)(i.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Factures en attente"}),(0,t.jsx)(c.AlertCircle,{className:"h-5 w-5 text-red-600"})]}),(0,t.jsxs)(i.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-red-600",children:j.length}),j.length>0&&(0,t.jsxs)("p",{className:"text-sm text-muted-foreground mt-1",children:["Total: ",(0,u.formatCurrency)(j.reduce((e,t)=>e+Number(t.total_amount)-Number(t.paid_amount||0),0),j[0]?.currency||"XOF")]})]})]}),(0,t.jsxs)(i.Card,{children:[(0,t.jsxs)(i.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,t.jsx)(i.CardTitle,{className:"text-sm font-medium text-muted-foreground",children:"Factures payées"}),(0,t.jsx)(d.CheckCircle,{className:"h-5 w-5 text-success-primary"})]}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)("div",{className:"text-2xl font-bold text-success-primary",children:y.length})})]})]}),j.length>0&&(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsx)(i.CardTitle,{children:"Factures en attente de paiement"})}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)("div",{className:"space-y-4",children:j.map(e=>{let s=Number(e.total_amount)-Number(e.paid_amount||0);return(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(e=>{switch(e){case"paid":return(0,t.jsx)(d.CheckCircle,{className:"h-5 w-5 text-success-primary"});case"sent":case"partial":return(0,t.jsx)(l.Clock,{className:"h-5 w-5 text-warning-primary"});case"overdue":return(0,t.jsx)(c.AlertCircle,{className:"h-5 w-5 text-red-600"});default:return null}})(e.status),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",children:e.invoice_number}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.students?.first_name," ",e.students?.last_name]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:["Échéance: ",(0,u.formatDate)(e.due_date)]})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"font-semibold text-lg",children:(0,u.formatCurrency)(s,e.currency)}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["sur ",(0,u.formatCurrency)(Number(e.total_amount),e.currency)]})]}),(0,t.jsx)(o.default,{href:`/portal/payments/${e.id}`,children:(0,t.jsxs)(n.Button,{children:[(0,t.jsx)(m.CreditCard,{className:"mr-2 h-4 w-4"}),"Payer"]})})]})]},e.id)})})})]}),f&&f.length>0&&(0,t.jsxs)(i.Card,{children:[(0,t.jsx)(i.CardHeader,{children:(0,t.jsx)(i.CardTitle,{children:"Historique des paiements"})}),(0,t.jsx)(i.CardContent,{children:(0,t.jsx)("div",{className:"space-y-4",children:f.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",children:e.invoices?.invoice_number||"Paiement"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.students?.first_name," ",e.students?.last_name]}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:(0,u.formatDate)(e.paid_at||e.created_at)})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"font-semibold text-success-primary",children:(0,u.formatCurrency)(Number(e.amount),e.currency)}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"mobile_money"===e.payment_method?"Mobile Money":"cash"===e.payment_method?"Espèces":"card"===e.payment_method?"Carte":e.payment_method})]})]},e.id))})})]}),(!h||0===h.length)&&(0,t.jsx)(i.Card,{children:(0,t.jsxs)(i.CardContent,{className:"text-center py-12 text-muted-foreground",children:[(0,t.jsx)(m.CreditCard,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),(0,t.jsx)("p",{children:"Aucune facture disponible"})]})})]})}e.s(["default",()=>x])}]);