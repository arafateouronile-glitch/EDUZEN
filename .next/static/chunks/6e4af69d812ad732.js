(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,503116,e=>{"use strict";let t=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>t],503116)},645760,e=>{"use strict";var t=e.i(843476),r=e.i(271645),s=e.i(647163);e.i(882205);var a=e.i(846932);let i=r.forwardRef(({className:e,variant:r="default",hoverable:i=!1,glow:l=!1,glowColor:n="rgba(51, 90, 207, 0.3)",...d},c)=>(0,t.jsxs)(a.motion.div,{ref:c,className:(0,s.cn)("relative rounded-2xl border backdrop-blur-xl transition-all duration-300",{"bg-white/70 dark:bg-gray-900/70 border-white/20 dark:border-gray-700/30 shadow-lg":"default"===r,"bg-white/80 dark:bg-gray-900/80 border-white/30 dark:border-gray-700/40 shadow-xl":"premium"===r,"bg-white/50 dark:bg-gray-900/50 border-white/10 dark:border-gray-700/20 shadow-md":"subtle"===r,"cursor-pointer":i,"hover:shadow-2xl hover:scale-[1.02]":i,"hover:bg-white/90 dark:hover:bg-gray-900/90":i},e),whileHover:i?{scale:1.02,y:-2}:void 0,transition:{type:"spring",stiffness:300,damping:30},...d,children:[l&&(0,t.jsx)(a.motion.div,{className:"absolute inset-0 rounded-2xl opacity-0 blur-xl",style:{background:`radial-gradient(circle, ${n} 0%, transparent 70%)`},animate:{opacity:[0,.5,0]},transition:{duration:3,repeat:1/0,ease:"easeInOut"}}),(0,t.jsx)("div",{className:"relative z-10",children:d.children})]}));i.displayName="GlassCard",e.s(["GlassCard",()=>i])},605631,e=>{"use strict";let t=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],605631)},440160,e=>{"use strict";let t=(0,e.i(475254).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",()=>t],440160)},286536,e=>{"use strict";let t=(0,e.i(475254).default)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);e.s(["Eye",()=>t],286536)},17991,e=>{"use strict";var t=e.i(843476),r=e.i(266027),s=e.i(271645),a=e.i(383801),i=e.i(267824),l=e.i(970065),n=e.i(167881),d=e.i(605631),c=e.i(503116),o=e.i(898791),m=e.i(561659),x=e.i(440160),u=e.i(286536),h=e.i(178583),y=e.i(647163);e.i(882205);var p=e.i(846932),g=e.i(645760),f=e.i(790224);function j(){let{student:e,studentId:j}=(0,a.useLearnerContext)(),b=(0,s.useMemo)(()=>j?(0,i.createLearnerClient)(j):null,[j]),{data:v,isLoading:N}=(0,r.useQuery)({queryKey:["learner-invoices",j],queryFn:async()=>{if(!j||!b)return[];try{let{data:e,error:t}=await b.from("invoices").select("*").eq("student_id",j).order("issue_date",{ascending:!1});if(t)return f.logger.warn("Error fetching invoices",{studentId:(0,f.maskId)(j),error:(0,f.sanitizeError)(t)}),[];return e||[]}catch(e){return f.logger.error("Unexpected error fetching invoices",e,{studentId:(0,f.maskId)(j),error:(0,f.sanitizeError)(e)}),[]}},enabled:!!j&&!!b,refetchOnWindowFocus:!0,refetchOnMount:!0}),{data:C,isLoading:w}=(0,r.useQuery)({queryKey:["learner-payments",j],queryFn:async()=>{if(!j||!b)return[];try{let{data:e,error:t}=await b.from("invoices").select("id").eq("student_id",j);if(t)return f.logger.warn("Error fetching invoices for payments",{studentId:(0,f.maskId)(j),error:(0,f.sanitizeError)(t)}),[];if(!e||0===e.length)return[];let r=e.map(e=>e.id),{data:s,error:a}=await b.from("payments").select("*").in("invoice_id",r).order("paid_at",{ascending:!1});if(a)return f.logger.warn("Error fetching payments",{studentId:(0,f.maskId)(j),error:(0,f.sanitizeError)(a)}),[];return s||[]}catch(e){return f.logger.error("Unexpected error fetching payments",e,{studentId:(0,f.maskId)(j),error:(0,f.sanitizeError)(e)}),[]}},enabled:!!j&&!!b,refetchOnWindowFocus:!0,refetchOnMount:!0}),k=v?.reduce((e,t)=>e+Number(t.total_amount||0),0)||0,_=C?.reduce((e,t)=>"completed"===t.status?e+Number(t.amount||0):e,0)||0,z=v?.filter(e=>(C?.filter(t=>t.invoice_id===e.id)||[]).filter(e=>"completed"===e.status).reduce((e,t)=>e+Number(t.amount||0),0)<Number(e.total_amount||0))||[],E=e=>{let t=(C?.filter(t=>t.invoice_id===e.id)||[]).filter(e=>"completed"===e.status).reduce((e,t)=>e+Number(t.amount||0),0);return t>=Number(e.total_amount||0)?{status:"paid",label:"Payée",icon:d.CheckCircle,color:"text-emerald-600"}:t>0?{status:"partial",label:"Partiellement payée",icon:c.Clock,color:"text-yellow-600"}:{status:"unpaid",label:"Impayée",icon:o.AlertCircle,color:"text-red-600"}};return N||w?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-blue mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Chargement des paiements..."})]})}):(0,t.jsxs)("div",{className:"space-y-8 pb-24 lg:pb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Paiements"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Gérez vos factures et paiements"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,t.jsx)(g.GlassCard,{children:(0,t.jsx)(l.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Total factures"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(0,y.formatCurrency)(k)})]}),(0,t.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,t.jsx)(h.FileText,{className:"h-6 w-6 text-blue-600"})})]})})}),(0,t.jsx)(g.GlassCard,{children:(0,t.jsx)(l.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"Total payé"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-emerald-600",children:(0,y.formatCurrency)(_)})]}),(0,t.jsx)("div",{className:"p-3 bg-emerald-100 rounded-full",children:(0,t.jsx)(d.CheckCircle,{className:"h-6 w-6 text-emerald-600"})})]})})}),(0,t.jsx)(g.GlassCard,{children:(0,t.jsx)(l.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-600 mb-1",children:"En attente"}),(0,t.jsx)("p",{className:"text-2xl font-bold text-red-600",children:(0,y.formatCurrency)(k-_)})]}),(0,t.jsx)("div",{className:"p-3 bg-red-100 rounded-full",children:(0,t.jsx)(o.AlertCircle,{className:"h-6 w-6 text-red-600"})})]})})})]}),z.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Factures en attente"}),(0,t.jsx)("div",{className:"grid gap-4",children:z.map((e,r)=>{let s=E(e),a=s.icon;return(0,t.jsx)(p.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1*r},children:(0,t.jsx)(g.GlassCard,{children:(0,t.jsx)(l.CardContent,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)(a,{className:`h-5 w-5 ${s.color}`}),(0,t.jsxs)("h3",{className:"font-semibold text-gray-900",children:["Facture #",e.invoice_number||e.id.slice(0,8)]}),(0,t.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.color} bg-opacity-10`,children:s.label})]}),(0,t.jsxs)("div",{className:"space-y-1 text-sm text-gray-600",children:[(0,t.jsxs)("p",{children:["Date d'émission : ",e.issue_date?(0,y.formatDate)(e.issue_date):"N/A"]}),e.due_date&&(0,t.jsxs)("p",{children:["Échéance : ",(0,y.formatDate)(e.due_date)]})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-gray-900 mb-2",children:(0,y.formatCurrency)(e.total_amount||0)}),(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",children:[(0,t.jsx)(u.Eye,{className:"h-4 w-4 mr-2"}),"Voir détails"]})]})]})})})},e.id)})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Historique des factures"}),v&&v.length>0?(0,t.jsx)("div",{className:"space-y-4",children:v.map((e,r)=>{let s=E(e),a=s.icon;return(0,t.jsx)(p.motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.05*r},children:(0,t.jsx)(g.GlassCard,{children:(0,t.jsx)(l.CardContent,{className:"p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("div",{className:`p-2 rounded-lg ${s.color.replace("text-","bg-").replace("-600","-100")}`,children:(0,t.jsx)(a,{className:`h-5 w-5 ${s.color}`})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h3",{className:"font-semibold text-gray-900",children:["Facture #",e.invoice_number||e.id.slice(0,8)]}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.issue_date?(0,y.formatDate)(e.issue_date):"N/A"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-lg font-bold text-gray-900",children:(0,y.formatCurrency)(e.total_amount||0)}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:s.label})]}),(0,t.jsxs)(n.Button,{variant:"outline",size:"sm",children:[(0,t.jsx)(x.Download,{className:"h-4 w-4 mr-2"}),"Télécharger"]})]})]})})})},e.id)})}):(0,t.jsx)(g.GlassCard,{children:(0,t.jsxs)(l.CardContent,{className:"py-12 text-center",children:[(0,t.jsx)(m.CreditCard,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Aucune facture disponible"})]})})]})]})}e.s(["default",()=>j])}]);