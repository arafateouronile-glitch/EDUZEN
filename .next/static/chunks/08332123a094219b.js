(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let s=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>s],871689)},503116,e=>{"use strict";let s=(0,e.i(475254).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",()=>s],503116)},2034,e=>{"use strict";var s=e.i(920755);let t=async(e,s)=>(console.warn("videoconferenceService.createMeetingForSession not implemented"),null),a=new class{supabase;constructor(e){this.supabase=e||(0,s.createClient)()}async getAllSessions(e,s){let t=this.supabase.from("sessions").select(`
        *,
        formations!inner(
          *,
          programs(*)
        )
      `).eq("formations.organization_id",e);s?.formationId&&(t=t.eq("formation_id",s.formationId)),s?.status&&(t=t.eq("status",s.status)),s?.startDate&&(t=t.gte("start_date",s.startDate)),s?.endDate&&(t=t.lte("end_date",s.endDate)),s?.search&&(t=t.ilike("name",`%${s.search}%`));let{data:a,error:r}=await t.order("start_date",{ascending:!0});if(r)throw r;return a}async getSessionById(e){let{data:s,error:t}=await this.supabase.from("sessions").select(`
        *,
        formations!inner(
          *,
          programs(*)
        )
      `).eq("id",e).single();if(t)throw t;let{data:a,error:r}=await this.supabase.from("session_programs").select(`
        program_id,
        programs(*)
      `).eq("session_id",e);if(r)throw r;return{...s,session_programs:a?.map(e=>e.programs).filter(Boolean)||[]}}async createSession(e,s,t){if(e.formation_id){let{data:s,error:t}=await this.supabase.from("formations").select("id, organization_id").eq("id",e.formation_id).single();if(t)throw console.error("Erreur lors de la vérification de la formation:",t),Error(`Formation non trouv\xe9e: ${t.message}`);if(!s)throw Error("Formation non trouvée");console.log("Formation trouvée:",s)}let{data:a,error:r}=await this.supabase.from("sessions").insert(e).select().single();if(r)throw console.error("Erreur RLS lors de la création de la session:",{code:r.code,message:r.message,details:r.details,hint:r.hint,formation_id:e.formation_id}),r;if(s&&s.length>0&&a){let{data:e}=await this.supabase.from("formations").select("organization_id").eq("id",a.formation_id).single();if(e){let t=s.map(s=>({session_id:a.id,program_id:s,organization_id:e.organization_id})),{error:r}=await this.supabase.from("session_programs").insert(t);r&&console.error("Erreur lors de la création des associations session-programme:",r),e.organization_id&&await this.syncWithCalendars(a.id,e.organization_id,"create").catch(e=>{console.error("Erreur lors de la synchronisation calendrier:",e)}),e.organization_id&&await this.createVideoconferenceMeeting(a.id,e.organization_id).catch(e=>{console.error("Erreur lors de la création de la réunion visioconférence:",e)})}}return console.log("Session créée avec succès:",a),a}async updateSessionPrograms(e,s,t){let{error:a}=await this.supabase.from("session_programs").delete().eq("session_id",e);if(a)throw a;if(s.length>0){let a=s.map(s=>({session_id:e,program_id:s,organization_id:t})),{error:r}=await this.supabase.from("session_programs").insert(a);if(r)throw r}return!0}async getSessionPrograms(e){let{data:s,error:t}=await this.supabase.from("session_programs").select(`
        program_id,
        programs(*)
      `).eq("session_id",e);if(t)throw t;return s?.map(e=>e.programs).filter(Boolean)||[]}async updateSession(e,s){let{data:t}=await this.supabase.from("sessions").select("formation_id, formations(organization_id)").eq("id",e).single(),{data:a,error:r}=await this.supabase.from("sessions").update(s).eq("id",e).select().single();if(r)throw r;let i=t?.formations;return t&&i?.organization_id&&await this.syncWithCalendars(e,i.organization_id,"update").catch(e=>{console.error("Erreur lors de la synchronisation calendrier:",e)}),a}async deleteSession(e){let{data:s}=await this.supabase.from("sessions").select("formation_id, formations(organization_id)").eq("id",e).single(),t=s?.formations;s&&t?.organization_id&&await this.syncWithCalendars(e,t.organization_id,"delete").catch(e=>{console.error("Erreur lors de la suppression de l'événement calendrier:",e)});let{error:a}=await this.supabase.from("sessions").delete().eq("id",e);if(a)throw a}async createVideoconferenceMeeting(e,s){let{data:a}=await this.supabase.from("videoconference_integrations").select("*").eq("organization_id",s).eq("is_active",!0).eq("auto_create_meetings",!0);if(a&&0!==a.length)for(let r of a)try{await t(e,{organizationId:s,provider:r.provider})}catch(e){console.error(`Erreur lors de la cr\xe9ation de r\xe9union avec ${r.provider}:`,e)}}async syncWithCalendars(e,s,t){let{data:a}=await this.supabase.from("calendar_integrations").select("*").eq("organization_id",s).eq("is_active",!0).eq("sync_sessions",!0).eq("create_events_for_sessions",!0);if(a&&0!==a.length)for(let e of a)try{console.warn(`Calendar sync for ${t} not implemented yet for provider ${e.provider}`)}catch(s){console.error(`Erreur lors de la synchronisation avec ${e.provider}:`,s)}}async getUpcomingSessions(e,s=10){let t=new Date().toISOString().split("T")[0],{data:a,error:r}=await this.supabase.from("sessions").select(`
        *,
        formations!inner(
          *,
          programs(*)
        )
      `).eq("formations.organization_id",e).gte("start_date",t).eq("status","planned").order("start_date",{ascending:!0}).limit(s);if(r)throw r;return a}async getOngoingSessions(e){let s=new Date().toISOString().split("T")[0],{data:t,error:a}=await this.supabase.from("sessions").select(`
        *,
        formations!inner(
          *,
          programs(*)
        )
      `).eq("formations.organization_id",e).lte("start_date",s).gte("end_date",s).eq("status","ongoing").order("start_date",{ascending:!0});if(a)throw a;return t}async addSessionToFormations(e,s,t){let a=s.map((s,a)=>({session_id:e,formation_id:s,organization_id:t,order_index:a})),{data:r,error:i}=await this.supabase.from("formation_sessions").insert(a).select();if(i)throw i;return r}async removeSessionFromFormation(e,s){let{error:t}=await this.supabase.from("formation_sessions").delete().eq("session_id",e).eq("formation_id",s);if(t)throw t;return!0}async updateSessionFormations(e,s,t){let{error:a}=await this.supabase.from("formation_sessions").delete().eq("session_id",e);if(a)throw a;return s.length>0?this.addSessionToFormations(e,s,t):[]}async getSessionFormations(e){let{data:s,error:t}=await this.supabase.from("formation_sessions").select(`
        formation_id,
        order_index,
        formations(*)
      `).eq("session_id",e).order("order_index",{ascending:!0});if(t)throw t;return s?.map(e=>e.formations).filter(Boolean)||[]}async getFormationSessions(e){let{data:s,error:t}=await this.supabase.from("formation_sessions").select(`
        session_id,
        order_index,
        sessions(*)
      `).eq("formation_id",e).order("order_index",{ascending:!0});if(t)throw t;return s?.map(e=>e.sessions).filter(Boolean)||[]}async createIndependentSession(e,s,t){let{data:a,error:r}=await this.supabase.from("sessions").insert({...e,formation_id:null}).select().single();if(r)throw r;return s&&s.length>0&&a&&await this.updateSessionPrograms(a.id,s,e.organization_id),t&&t.length>0&&a&&await this.addSessionToFormations(a.id,t,e.organization_id),a}};e.s(["sessionService",0,a],2034)},771251,e=>{"use strict";var s=e.i(843476),t=e.i(618566),a=e.i(266027),r=e.i(2034),i=e.i(920755),n=e.i(167881),o=e.i(970065),d=e.i(871689),l=e.i(87316),c=e.i(503116),m=e.i(346897),u=e.i(761911),x=e.i(810980),h=e.i(522016),f=e.i(647163);function g(){let g=(0,t.useParams)();(0,t.useRouter)();let p=g.id,j=g.sessionId,y=(0,i.createClient)(),{data:_,isLoading:b}=(0,a.useQuery)({queryKey:["session",j],queryFn:()=>r.sessionService.getSessionById(j),enabled:!!j}),{data:N,isLoading:v}=(0,a.useQuery)({queryKey:["session-enrollments",j],queryFn:async()=>{let{data:e,error:s}=await y.from("enrollments").select("*, students(*)").eq("session_id",j).order("enrollment_date",{ascending:!1});if(s)throw s;return e||[]},enabled:!!j}),{data:w}=(0,a.useQuery)({queryKey:["teacher",_?.teacher_id],queryFn:async()=>{if(!_?.teacher_id)return null;let{createClient:s}=await e.A(90015),t=s(),{data:a,error:r}=await t.from("users").select("id, full_name, email").eq("id",_.teacher_id).single();return r?(console.error("Erreur lors de la récupération de l'enseignant:",r),null):a},enabled:!!_?.teacher_id});if(b)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("div",{className:"text-muted-foreground",children:"Chargement..."})})});if(!_)return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-muted-foreground",children:"Session non trouvée"}),(0,s.jsx)(h.default,{href:`/dashboard/programs/${p}/sessions`,children:(0,s.jsx)(n.Button,{className:"mt-4",children:"Retour aux sessions"})})]})});let C=_?.formations,q=C?.programs;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)(h.default,{href:`/dashboard/programs/${p}/sessions`,children:(0,s.jsx)(n.Button,{variant:"ghost",size:"icon",children:(0,s.jsx)(d.ArrowLeft,{className:"h-4 w-4"})})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:_.name}),(0,s.jsxs)("p",{className:"mt-2 text-sm text-gray-600",children:["Session de la formation ",(0,s.jsx)(h.default,{href:`/dashboard/programs/${p}`,className:"text-primary hover:underline",children:q?.name})]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{className:`px-3 py-1 rounded-full text-sm font-medium ${(e=>{switch(e){case"planned":return"bg-blue-100 text-blue-800";case"ongoing":return"bg-success-bg text-success-primary";case"completed":default:return"bg-gray-100 text-gray-800";case"cancelled":return"bg-red-100 text-red-800"}})(_.status)}`,children:(e=>{switch(e){case"planned":return"Planifiée";case"ongoing":return"En cours";case"completed":return"Terminée";case"cancelled":return"Annulée";default:return e}})(_.status)}),(0,s.jsx)(h.default,{href:`/dashboard/programs/${p}/sessions/${j}/attendance`,children:(0,s.jsxs)(n.Button,{variant:"outline",children:[(0,s.jsx)(u.Users,{className:"mr-2 h-4 w-4"}),"Gérer l'assiduité"]})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)(o.Card,{children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsxs)(o.CardTitle,{className:"flex items-center",children:[(0,s.jsx)(l.Calendar,{className:"mr-2 h-5 w-5"}),"Dates et horaires"]})}),(0,s.jsxs)(o.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Date de début"}),(0,s.jsx)("p",{className:"text-lg",children:(0,f.formatDate)(_.start_date)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Date de fin"}),(0,s.jsx)("p",{className:"text-lg",children:(0,f.formatDate)(_.end_date)})]}),_.start_time&&_.end_time&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Heure de début"}),(0,s.jsxs)("p",{className:"text-lg flex items-center",children:[(0,s.jsx)(c.Clock,{className:"mr-2 h-4 w-4"}),_.start_time]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Heure de fin"}),(0,s.jsxs)("p",{className:"text-lg flex items-center",children:[(0,s.jsx)(c.Clock,{className:"mr-2 h-4 w-4"}),_.end_time]})]})]}),_.location&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Lieu"}),(0,s.jsxs)("p",{className:"text-lg flex items-center",children:[(0,s.jsx)(m.MapPin,{className:"mr-2 h-4 w-4"}),_.location]})]})]})]}),(0,s.jsxs)(o.Card,{children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsxs)(o.CardTitle,{className:"flex items-center",children:[(0,s.jsx)(u.Users,{className:"mr-2 h-5 w-5"}),"Participants"]})}),(0,s.jsxs)(o.CardContent,{className:"space-y-4",children:[_.capacity_max&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Capacité maximale"}),(0,s.jsxs)("p",{className:"text-lg",children:[_.capacity_max," apprenants"]})]}),N&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Élèves inscrits"}),(0,s.jsxs)("p",{className:"text-lg font-semibold text-primary",children:[N.length," ",1===N.length?"élève":"élèves"]}),_.capacity_max&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[Math.round(N.length/_.capacity_max*100),"% de la capacité"]})]}),w?(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Enseignant"}),(0,s.jsx)("p",{className:"text-lg",children:w.full_name}),w.email&&(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:w.email})]}):_.teacher_id?(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Enseignant"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Non assigné ou non trouvé"})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Enseignant"}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:"Aucun enseignant assigné"})]})]})]})]}),q&&(0,s.jsxs)(o.Card,{children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsxs)(o.CardTitle,{className:"flex items-center",children:[(0,s.jsx)(x.BookOpen,{className:"mr-2 h-5 w-5"}),"Formation associée"]})}),(0,s.jsx)(o.CardContent,{children:(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Nom de la formation"}),(0,s.jsx)("p",{className:"text-lg",children:(0,s.jsx)(h.default,{href:`/dashboard/programs/${p}`,className:"text-primary hover:underline",children:q.name})})]}),q.code&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Code"}),(0,s.jsx)("p",{className:"text-lg",children:q.code})]}),q.description&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:q.description})]})]})})]}),(0,s.jsxs)(o.Card,{children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)(o.CardTitle,{className:"flex items-center",children:[(0,s.jsx)(u.Users,{className:"mr-2 h-5 w-5"}),"Élèves inscrits (",N?.length||0,")"]}),(0,s.jsx)(h.default,{href:`/dashboard/programs/${p}/sessions/${j}/attendance`,children:(0,s.jsxs)(n.Button,{variant:"outline",size:"sm",children:[(0,s.jsx)(u.Users,{className:"mr-2 h-4 w-4"}),"Gérer l'assiduité"]})})]})}),(0,s.jsx)(o.CardContent,{children:v?(0,s.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"Chargement des inscriptions..."}):N&&N.length>0?(0,s.jsx)("div",{className:"space-y-3",children:N.map(e=>{let t=e.students;return t?(0,s.jsx)("div",{className:"p-4 border rounded-lg hover:bg-gray-50 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("h3",{className:"font-semibold text-lg",children:[t.first_name," ",t.last_name]}),(0,s.jsxs)("p",{className:"text-sm text-muted-foreground",children:[t.student_number,t.email&&` • ${t.email}`]}),(0,s.jsxs)("div",{className:"mt-2 flex items-center space-x-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Date d'inscription:"})," ",(0,s.jsx)("span",{className:"font-medium",children:(0,f.formatDate)(e.enrollment_date)})]}),q&&e.total_amount>0&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"Montant:"})," ",(0,s.jsx)("span",{className:"font-medium",children:(0,f.formatCurrency)(e.total_amount,q.currency||"XOF")}),e.paid_amount>0&&(0,s.jsxs)("span",{className:"text-success-primary ml-1",children:["(Payé: ",(0,f.formatCurrency)(e.paid_amount,q.currency||"XOF"),")"]})]})]})]}),(0,s.jsxs)("div",{className:"flex flex-col items-end space-y-2",children:[(0,s.jsx)("span",{className:`px-2 py-1 rounded text-xs font-medium ${(e=>{switch(e){case"pending":return"bg-warning-bg text-warning-primary";case"confirmed":return"bg-blue-100 text-blue-800";case"completed":return"bg-success-bg text-success-primary";case"cancelled":default:return"bg-gray-100 text-gray-800";case"failed":return"bg-red-100 text-red-800"}})(e.status)}`,children:"pending"===e.status?"En attente":"confirmed"===e.status?"Confirmée":"completed"===e.status?"Terminée":"cancelled"===e.status?"Annulée":"failed"===e.status?"Échouée":e.status}),(0,s.jsx)("span",{className:`px-2 py-1 rounded text-xs font-medium ${(e=>{switch(e){case"pending":return"bg-warning-bg text-warning-primary";case"partial":return"bg-blue-100 text-blue-800";case"paid":return"bg-success-bg text-success-primary";case"overdue":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(e.payment_status)}`,children:"pending"===e.payment_status?"En attente":"partial"===e.payment_status?"Partiel":"paid"===e.payment_status?"Payé":"overdue"===e.payment_status?"En retard":e.payment_status})]})]})},e.id):null})}):(0,s.jsxs)("div",{className:"text-center py-12 text-muted-foreground",children:["Aucun élève inscrit à cette session pour le moment.",(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsx)(h.default,{href:`/dashboard/programs/${p}/sessions`,children:(0,s.jsx)(n.Button,{variant:"outline",size:"sm",children:"Inscrire un élève"})})})]})})]}),(0,s.jsxs)(o.Card,{children:[(0,s.jsx)(o.CardHeader,{children:(0,s.jsx)(o.CardTitle,{children:"Informations supplémentaires"})}),(0,s.jsx)(o.CardContent,{children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-700 mb-1",children:"ID de la session"}),(0,s.jsx)("p",{className:"text-muted-foreground font-mono text-xs",children:_.id})]}),_.created_at&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-700 mb-1",children:"Date de création"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:(0,f.formatDate)(_.created_at)})]}),_.updated_at&&(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-gray-700 mb-1",children:"Dernière modification"}),(0,s.jsx)("p",{className:"text-muted-foreground",children:(0,f.formatDate)(_.updated_at)})]})]})})]})]})}e.s(["default",()=>g])},90015,e=>{e.v(e=>Promise.resolve().then(()=>e(920755)))}]);