(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,871689,e=>{"use strict";let r=(0,e.i(475254).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",()=>r],871689)},683909,e=>{"use strict";var r=e.i(920755);let a=new class{supabase;constructor(e){this.supabase=e||(0,r.createClient)()}async getAllPrograms(e,r){let a=this.supabase.from("programs").select("*").eq("organization_id",e);r?.isActive!==void 0&&(a=a.eq("is_active",r.isActive)),r?.search&&(a=a.or(`name.ilike.%${r.search}%,code.ilike.%${r.search}%,description.ilike.%${r.search}%`));let{data:t,error:s}=await a.order("created_at",{ascending:!1});if(s)throw s;return t}async getProgramById(e){let{data:r,error:a}=await this.supabase.from("programs").select(`
        *,
        formations(*)
      `).eq("id",e).single();if(a)throw a;return r}async createProgram(e){let{data:r,error:a}=await this.supabase.from("programs").insert(e).select().single();if(a)throw a;return r}async updateProgram(e,r){let{data:a,error:t}=await this.supabase.from("programs").update(r).eq("id",e).select().single();if(t)throw t;return a}async deleteProgram(e){return this.updateProgram(e,{is_active:!1})}async getFormationsByProgram(e){let{data:r,error:a}=await this.supabase.from("formations").select("*").eq("program_id",e).order("created_at",{ascending:!1});if(a)throw a;return r}async getGlobalStats(e){let{data:r,error:a}=await this.supabase.from("programs").select("id, is_active, created_at").eq("organization_id",e);if(a)throw a;let t=r||[],s=t.length,i=t.filter(e=>e.is_active).length,n=t.filter(e=>!e.is_active).length,o=0,l=t.map(e=>e.id);if(l.length>0){let{count:e,error:r}=await this.supabase.from("formations").select("*",{count:"exact",head:!0}).in("program_id",l);if(r)throw r;o=e||0}let c=0;if(l.length>0){let{data:e,error:r}=await this.supabase.from("formations").select("id").in("program_id",l);if(r)throw r;let a=e?.map(e=>e.id)||[];if(a.length>0){let{count:e,error:r}=await this.supabase.from("sessions").select("*",{count:"exact",head:!0}).in("formation_id",a);if(r)throw r;c=e||0}}let d=0;if(l.length>0){let{data:e,error:r}=await this.supabase.from("formations").select("id").in("program_id",l);if(r)throw r;let a=e?.map(e=>e.id)||[];if(a.length>0){let{data:e,error:r}=await this.supabase.from("sessions").select("id").in("formation_id",a);if(r)throw r;let t=e?.map(e=>e.id)||[];if(t.length>0){let{count:e,error:r}=await this.supabase.from("enrollments").select("*",{count:"exact",head:!0}).in("session_id",t);if(r)throw r;d=e||0}}}let m=[{name:"Actifs",value:i,color:"#335ACF"},{name:"Inactifs",value:n,color:"#6B7280"}].filter(e=>e.value>0),u={};return t.forEach(e=>{if(e.created_at){let r=new Date(e.created_at),a=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;u[a]=(u[a]||0)+1}}),{total:s,active:i,inactive:n,totalFormations:o,totalSessions:c,totalEnrollments:d,statusData:m,monthlyData:Object.entries(u).sort(([e],[r])=>e.localeCompare(r)).slice(-6).map(([e,r])=>({month:new Date(e+"-01").toLocaleDateString("fr-FR",{month:"short",year:"numeric"}),programmes:r}))}}};e.s(["programService",0,a])},317977,e=>{"use strict";var r=e.i(843476),a=e.i(271645),t=e.i(618566),s=e.i(954616),i=e.i(266027),n=e.i(912598),o=e.i(325715),l=e.i(683909),c=e.i(167881),d=e.i(970065),m=e.i(871689),u=e.i(522016);function p(){let e=(0,t.useRouter)(),p=(0,t.useParams)().id,g=(0,n.useQueryClient)(),{user:h,isLoading:x}=(0,o.useAuth)(),[f,b]=(0,a.useState)({code:"",name:"",description:"",duration_hours:"",price:"",currency:"XOF",payment_plan:"full",prerequisites:"",capacity_max:"",age_min:"",age_max:"",certification_issued:!1,is_active:!0}),{data:v,isLoading:j}=(0,i.useQuery)({queryKey:["program",p],queryFn:()=>l.programService.getProgramById(p),enabled:!!p});(0,a.useEffect)(()=>{if(v){let e=v.formations?.[0];b({code:v.code||"",name:v.name||"",description:v.description||"",duration_hours:e?.duration_hours?.toString()||"",price:e?.price?.toString()||"",currency:e?.currency||"XOF",payment_plan:e?.payment_plan||"full",prerequisites:e?.prerequisites||"",capacity_max:e?.capacity_max?.toString()||"",age_min:e?.age_min?.toString()||"",age_max:e?.age_max?.toString()||"",certification_issued:e?.certification_issued||!1,is_active:v.is_active??!0})}},[v]);let y=(0,s.useMutation)({mutationFn:async()=>{if(!h?.organization_id)throw Error("Organization ID manquant");console.log("Mise à jour du programme:",p,f);let e=await l.programService.updateProgram(p,{code:f.code,name:f.name,description:f.description||null,is_active:f.is_active});return console.log("Programme mis à jour avec succès:",e),e},onSuccess:r=>{console.log("onSuccess appelé avec:",r),g.invalidateQueries({queryKey:["program",p]}),g.invalidateQueries({queryKey:["programs"]}),e.push(`/dashboard/programs/${r.id}`)},onError:e=>{console.error("Erreur lors de la mise à jour du programme:",e)}});return x||j?(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsx)("p",{children:"Chargement..."})}):h?h.organization_id?v?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)(u.default,{href:`/dashboard/programs/${p}`,children:(0,r.jsx)(c.Button,{variant:"ghost",size:"icon",children:(0,r.jsx)(m.ArrowLeft,{className:"h-4 w-4"})})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Modifier la formation"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Modifiez les informations de la formation"})]})]}),(0,r.jsxs)(d.Card,{children:[(0,r.jsx)(d.CardHeader,{children:(0,r.jsx)(d.CardTitle,{children:"Informations de la formation"})}),(0,r.jsx)(d.CardContent,{children:(0,r.jsxs)("form",{onSubmit:e=>{e.preventDefault(),y.mutate()},className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Code de la formation *"}),(0,r.jsx)("input",{type:"text",required:!0,value:f.code,onChange:e=>b({...f,code:e.target.value.toUpperCase()}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"EX: FORM-2024-001"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Nom de la formation *"}),(0,r.jsx)("input",{type:"text",required:!0,value:f.name,onChange:e=>b({...f,name:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"Ex: Formation en Informatique"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Description"}),(0,r.jsx)("textarea",{value:f.description,onChange:e=>b({...f,description:e.target.value}),rows:4,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Description détaillée de la formation..."})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Durée (heures)"}),(0,r.jsx)("input",{type:"number",value:f.duration_hours,onChange:e=>b({...f,duration_hours:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"Ex: 120"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Prix *"}),(0,r.jsx)("input",{type:"number",required:!0,step:"0.01",value:f.price,onChange:e=>b({...f,price:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"0.00"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Devise"}),(0,r.jsxs)("select",{value:f.currency,onChange:e=>b({...f,currency:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,r.jsx)("option",{value:"XOF",children:"XOF (Franc CFA Ouest)"}),(0,r.jsx)("option",{value:"XAF",children:"XAF (Franc CFA Centre)"}),(0,r.jsx)("option",{value:"EUR",children:"EUR (Euro)"}),(0,r.jsx)("option",{value:"USD",children:"USD (Dollar)"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Plan de paiement"}),(0,r.jsxs)("select",{value:f.payment_plan,onChange:e=>b({...f,payment_plan:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",children:[(0,r.jsx)("option",{value:"full",children:"Paiement unique"}),(0,r.jsx)("option",{value:"installment",children:"Échelonné"}),(0,r.jsx)("option",{value:"custom",children:"Personnalisé"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Capacité maximale"}),(0,r.jsx)("input",{type:"number",value:f.capacity_max,onChange:e=>b({...f,capacity_max:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target",placeholder:"Ex: 30"})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Âge minimum"}),(0,r.jsx)("input",{type:"number",value:f.age_min,onChange:e=>b({...f,age_min:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Âge maximum"}),(0,r.jsx)("input",{type:"number",value:f.age_max,onChange:e=>b({...f,age_max:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent min-touch-target"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Prérequis"}),(0,r.jsx)("textarea",{value:f.prerequisites,onChange:e=>b({...f,prerequisites:e.target.value}),rows:2,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Prérequis pour suivre cette formation..."})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"certification",checked:f.certification_issued,onChange:e=>b({...f,certification_issued:e.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),(0,r.jsx)("label",{htmlFor:"certification",className:"text-sm font-medium",children:"Certificat délivré à l'issue de la formation"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("input",{type:"checkbox",id:"is_active",checked:f.is_active,onChange:e=>b({...f,is_active:e.target.checked}),className:"rounded border-gray-300 text-primary focus:ring-primary"}),(0,r.jsx)("label",{htmlFor:"is_active",className:"text-sm font-medium",children:"Formation active"})]})]}),y.error&&(0,r.jsx)("div",{className:"bg-destructive/10 text-destructive px-4 py-3 rounded-lg text-sm",children:y.error instanceof Error?y.error.message:"Une erreur est survenue"}),(0,r.jsxs)("div",{className:"flex justify-end space-x-4 pt-4",children:[(0,r.jsx)(u.default,{href:`/dashboard/programs/${p}`,children:(0,r.jsx)(c.Button,{type:"button",variant:"outline",children:"Annuler"})}),(0,r.jsx)(c.Button,{type:"submit",disabled:y.isPending,children:y.isPending?"Enregistrement...":"Enregistrer les modifications"})]})]})})]})]}):(0,r.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("p",{className:"text-muted-foreground mb-4",children:"Formation non trouvée"}),(0,r.jsx)(u.default,{href:"/dashboard/programs",children:(0,r.jsx)(c.Button,{children:"Retour à la liste"})})]})}):(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-red-800 mb-2",children:"Organization ID manquant"}),(0,r.jsx)("p",{className:"text-red-700 mb-4",children:"Votre compte n'est pas associé à une organisation."})]})}):(0,r.jsx)("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"bg-warning-bg border border-warning-border rounded-lg p-4",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-warning-primary mb-2",children:"Utilisateur non trouvé"}),(0,r.jsx)("p",{className:"text-warning-primary",children:"Votre compte n'existe pas encore dans la base de données. Déconnectez-vous et créez un nouveau compte."})]})})}e.s(["default",()=>p])}]);