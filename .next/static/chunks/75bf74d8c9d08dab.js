(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,107233,e=>{"use strict";let t=(0,e.i(475254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],107233)},605631,e=>{"use strict";let t=(0,e.i(475254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],605631)},182774,e=>{"use strict";var t=e.i(843476),i=e.i(325715),s=e.i(618566),a=e.i(271645);let r=(0,e.i(475254).default)("ShieldAlert",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var n=e.i(167881),c=e.i(970065),l=e.i(522016);function d({children:e,allowedRoles:d,fallback:o,redirectTo:u="/dashboard"}){let{user:h,isLoading:x}=(0,i.useAuth)(),f=(0,s.useRouter)(),[m,p]=(0,a.useState)(null);return((0,a.useEffect)(()=>{if(!x&&h){let e=h.role||"",t=d.includes(e);p(t),t||!u||o||f.push(u)}},[h,x,d,u,f,o]),x||null===m)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[200px]",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-blue"})}):m?(0,t.jsx)(t.Fragment,{children:e}):o?(0,t.jsx)(t.Fragment,{children:o}):(0,t.jsx)("div",{className:"container mx-auto py-16 px-4",children:(0,t.jsx)(c.Card,{className:"max-w-md mx-auto",children:(0,t.jsxs)(c.CardContent,{className:"py-12 text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6",children:(0,t.jsx)(r,{className:"h-8 w-8 text-red-600"})}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Accès non autorisé"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"Vous n'avez pas les permissions nécessaires pour accéder à cette page."}),(0,t.jsx)(l.default,{href:"/dashboard",children:(0,t.jsx)(n.Button,{children:"Retour au tableau de bord"})})]})})})}e.s(["ADMIN_ROLES",0,["super_admin","admin","secretary","accountant"],"FINANCE_ROLES",0,["super_admin","admin","secretary","accountant"],"FORMATION_MANAGEMENT_ROLES",0,["super_admin","admin","secretary"],"RoleGuard",()=>d],182774)},968894,e=>{"use strict";var t=e.i(843476),i=e.i(266027),s=e.i(912598),a=e.i(325715),r=e.i(920755);let n=new class{supabase;constructor(e){this.supabase=e||(0,r.createClient)()}async getCertifications(e,t){let i=this.supabase.from("rncp_certifications").select("*").eq("organization_id",e);t?.isActive!==void 0&&(i=i.eq("is_active",t.isActive)),t?.type&&(i=i.eq("certification_type",t.type)),t?.search&&(i=i.or(`title.ilike.%${t.search}%,rncp_code.ilike.%${t.search}%,rs_code.ilike.%${t.search}%`));let{data:s,error:a}=await i.order("title",{ascending:!0});if(a)throw a;return s||[]}async getCertificationById(e){let{data:t,error:i}=await this.supabase.from("rncp_certifications").select("*").eq("id",e).single();if(i)throw i;return t}async createCertification(e){let{data:t,error:i}=await this.supabase.from("rncp_certifications").insert(e).select().single();if(i)throw i;return t}async updateCertification(e,t){let{data:i,error:s}=await this.supabase.from("rncp_certifications").update(t).eq("id",e).select().single();if(s)throw s;return i}async getJuries(e,t){let i=this.supabase.from("certification_juries").select("*, rncp_certifications(*), sites(*)").eq("organization_id",e);t?.certificationId&&(i=i.eq("certification_id",t.certificationId)),t?.status&&(i=i.eq("status",t.status)),t?.startDate&&(i=i.gte("jury_date",t.startDate)),t?.endDate&&(i=i.lte("jury_date",t.endDate));let{data:s,error:a}=await i.order("jury_date",{ascending:!1});if(a)throw a;return s||[]}async getJuryById(e){let{data:t,error:i}=await this.supabase.from("certification_juries").select("*, rncp_certifications(*), sites(*), jury_candidates(*, students(*))").eq("id",e).single();if(i)throw i;return t}async createJury(e){let{data:t,error:i}=await this.supabase.from("certification_juries").insert(e).select().single();if(i)throw i;return t}async updateJury(e,t){let{data:i,error:s}=await this.supabase.from("certification_juries").update(t).eq("id",e).select().single();if(s)throw s;return i}async addCandidate(e){let{data:t,error:i}=await this.supabase.from("jury_candidates").insert(e).select().single();if(i)throw i;return t}async updateCandidateResult(e,t){let i={status:t.status,decision_date:new Date().toISOString().split("T")[0]};void 0!==t.finalScore&&(i.final_score=t.finalScore),t.decisionNotes&&(i.decision_notes=t.decisionNotes),t.evaluationDetails&&(i.evaluation_details=t.evaluationDetails);let{data:s,error:a}=await this.supabase.from("jury_candidates").update(i).eq("id",e).select().single();if(a)throw a;return s}async getJuryCandidates(e){let{data:t,error:i}=await this.supabase.from("jury_candidates").select("*, students(*)").eq("jury_id",e).order("created_at",{ascending:!0});if(i)throw i;return t||[]}async getJuryMinutes(e){let{data:t,error:i}=await this.supabase.from("jury_minutes").select("*").eq("jury_id",e).order("created_at",{ascending:!1});if(i)throw i;return t||[]}async createMinute(e){let{data:t,error:i}=await this.supabase.from("jury_minutes").insert(e).select().single();if(i)throw i;return t}async updateMinute(e,t){let{data:i,error:s}=await this.supabase.from("jury_minutes").update(t).eq("id",e).select().single();if(s)throw s;return i}generateCertificateNumber(e,t){let i="RNCP"===e.certification_type?"RNCP":"RS",s=e.rncp_code||e.rs_code||"CERT",a=new Date().getFullYear(),r=t.slice(0,8).toUpperCase();return`${i}-${s}-${a}-${r}-${Date.now().toString(36).toUpperCase()}`}async createCertificate(e){if(!e.certificate_number){let t=await this.getCertificationById(e.certification_id);e.certificate_number=this.generateCertificateNumber(t,e.student_id)}let{data:t,error:i}=await this.supabase.from("certification_certificates").insert(e).select().single();if(i)throw i;return t}async getCertificates(e,t){let i=this.supabase.from("certification_certificates").select("*, rncp_certifications(*), students(*), certification_juries(*)").eq("organization_id",e);t?.certificationId&&(i=i.eq("certification_id",t.certificationId)),t?.studentId&&(i=i.eq("student_id",t.studentId)),t?.status&&(i=i.eq("status",t.status));let{data:s,error:a}=await i.order("issue_date",{ascending:!1});if(a)throw a;return s||[]}async generateCertificatesForJury(e,t){let i=await this.getJuryById(e),s=(await this.getJuryCandidates(e)).filter(e=>"admitted"===e.status),a=[];for(let r of s){let s=await this.getCertificationById(i.certification_id),n=await this.createCertificate({organization_id:i.organization_id,certification_id:i.certification_id,jury_id:e,student_id:r.student_id,session_id:i.session_id||null,issue_date:new Date().toISOString().split("T")[0],certification_level:s.level||null,rncp_code:s.rncp_code||null,status:"issued",issued_by:t});a.push(n)}return a}};var c=e.i(167881),l=e.i(970065),d=e.i(6799),o=e.i(107233),u=e.i(842009),h=e.i(605631),x=e.i(87316),f=e.i(761911),m=e.i(178583),p=e.i(182774),j=e.i(522016);function g(){return(0,t.jsx)(p.RoleGuard,{allowedRoles:p.FORMATION_MANAGEMENT_ROLES,children:(0,t.jsx)(y,{})})}function y(){let{user:e}=(0,a.useAuth)();(0,s.useQueryClient)();let{addToast:r}=(0,d.useToast)(),{data:h,isLoading:p}=(0,i.useQuery)({queryKey:["rncp-certifications",e?.organization_id],queryFn:async()=>e?.organization_id?await n.getCertifications(e.organization_id):[],enabled:!!e?.organization_id}),{data:g}=(0,i.useQuery)({queryKey:["certification-juries",e?.organization_id],queryFn:async()=>e?.organization_id?n.getJuries(e.organization_id,{status:"scheduled"}):[],enabled:!!e?.organization_id});if(!e?.organization_id)return(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("p",{children:"Aucune organisation"})});let y=h?.filter(e=>e.is_active)||[];return(0,t.jsxs)("div",{className:"p-6 space-y-6",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold",children:"Certifications RNCP/RS"}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:"Gérez vos certifications et jurys"})]}),(0,t.jsxs)(c.Button,{className:"bg-brand-blue hover:bg-brand-blue-dark",children:[(0,t.jsx)(o.Plus,{className:"w-4 h-4 mr-2"}),"Nouvelle certification"]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-4 gap-4",children:[(0,t.jsx)(l.Card,{children:(0,t.jsxs)(l.CardContent,{className:"pt-6",children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:h?.length||0}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Total certifications"})]})}),(0,t.jsx)(l.Card,{children:(0,t.jsxs)(l.CardContent,{className:"pt-6",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:y.length}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Actives"})]})}),(0,t.jsx)(l.Card,{children:(0,t.jsxs)(l.CardContent,{className:"pt-6",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:g?.length||0}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Jurys à venir"})]})}),(0,t.jsx)(l.Card,{children:(0,t.jsx)(l.CardContent,{className:"pt-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(u.Award,{className:"w-5 h-5 text-brand-blue"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:"RNCP/RS"}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Certifications"})]})]})})})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-3 gap-4",children:[(0,t.jsx)(j.default,{href:"/dashboard/certifications/juries",children:(0,t.jsxs)(l.Card,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(f.Users,{className:"w-5 h-5 text-brand-blue"}),"Jurys"]})}),(0,t.jsx)(l.CardContent,{children:(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Gérer les jurys de certification"})})]})}),(0,t.jsx)(j.default,{href:"/dashboard/certifications/attestations",children:(0,t.jsxs)(l.Card,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(m.FileText,{className:"w-5 h-5 text-brand-blue"}),"Attestations"]})}),(0,t.jsx)(l.CardContent,{children:(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Consulter les attestations délivrées"})})]})}),(0,t.jsxs)(l.Card,{className:"hover:shadow-lg transition-shadow",children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,t.jsx)(x.Calendar,{className:"w-5 h-5 text-brand-blue"}),"Calendrier"]})}),(0,t.jsx)(l.CardContent,{children:(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Voir le calendrier des jurys"})})]})]}),p?(0,t.jsx)("div",{className:"text-center py-12",children:"Chargement..."}):h&&h.length>0?(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Certifications"}),(0,t.jsx)("div",{className:"grid md:grid-cols-2 gap-4",children:h.map(e=>(0,t.jsx)(_,{certification:e},e.id))})]}):(0,t.jsx)(l.Card,{children:(0,t.jsxs)(l.CardContent,{className:"text-center py-12",children:[(0,t.jsx)(u.Award,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"Aucune certification enregistrée"}),(0,t.jsxs)(c.Button,{className:"bg-brand-blue hover:bg-brand-blue-dark",children:[(0,t.jsx)(o.Plus,{className:"w-4 h-4 mr-2"}),"Créer la première certification"]})]})})]})}function _({certification:e}){let i=e=>e?new Date(e).toLocaleDateString("fr-FR"):"Non définie";return(0,t.jsxs)(l.Card,{className:"hover:shadow-lg transition-shadow",children:[(0,t.jsx)(l.CardHeader,{children:(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)(l.CardTitle,{children:e.title}),(0,t.jsxs)("div",{className:"flex gap-2 mt-2",children:[(0,t.jsx)("span",{className:`inline-block px-2 py-1 text-xs rounded-full ${"RNCP"===e.certification_type?"bg-blue-100 text-blue-800":"RS"===e.certification_type?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:e.certification_type}),e.rncp_code&&(0,t.jsx)("span",{className:"inline-block px-2 py-1 text-xs bg-gray-100 text-gray-800 rounded-full",children:e.rncp_code}),e.level&&(0,t.jsxs)("span",{className:"inline-block px-2 py-1 text-xs bg-purple-100 text-purple-800 rounded-full",children:["Niveau ",e.level]})]})]}),e.is_active?(0,t.jsx)(h.CheckCircle,{className:"w-5 h-5 text-green-600"}):(0,t.jsx)(h.CheckCircle,{className:"w-5 h-5 text-gray-400"})]})}),(0,t.jsxs)(l.CardContent,{className:"space-y-2",children:[e.validity_start_date&&(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,t.jsx)("strong",{children:"Validité :"})," Du ",i(e.validity_start_date)," au"," ",i(e.validity_end_date)]}),e.description&&(0,t.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.description}),(0,t.jsxs)("div",{className:"flex gap-2 pt-2 border-t",children:[(0,t.jsxs)(c.Button,{variant:"outline",size:"sm",className:"flex-1",children:[(0,t.jsx)(m.FileText,{className:"w-3 h-3 mr-1"}),"Détails"]}),(0,t.jsx)(c.Button,{variant:"outline",size:"sm",children:(0,t.jsx)(f.Users,{className:"w-3 h-3"})})]})]})]})}e.s(["default",()=>g],968894)}]);