(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,698512,e=>{"use strict";var t=e.i(843476),n=e.i(271645),s=e.i(266027),r=e.i(954616),a=e.i(912598),i=e.i(325715),l=e.i(920755),d=e.i(631259),o=e.i(548347),c=e.i(69319),u=e.i(134150),m=e.i(875976),p=e.i(330293),x=e.i(674824),h=e.i(970065),g=e.i(167881),y=e.i(647163),f=e.i(6799),v=e.i(522016),b=e.i(440160),j=e.i(178583),_=e.i(107233),N=e.i(350627),C=e.i(212426),w=e.i(286536),E=e.i(664659),S=e.i(655900),z=e.i(727612),D=e.i(436332),q=e.i(635408);function T({enrollments:e=[],payments:T=[],sessionId:k,sessionData:F,organization:R}){let{user:P}=(0,i.useAuth)(),U=(0,l.createClient)(),B=(0,a.useQueryClient)(),{addToast:M}=(0,f.useToast)(),[H,A]=(0,n.useState)(null),[L,I]=(0,n.useState)(!1),[O,K]=(0,n.useState)(!1),[$,Q]=(0,n.useState)(!1),[V,X]=(0,n.useState)(null),[G,J]=(0,n.useState)(null),[W,Y]=(0,n.useState)(null),[Z,ee]=(0,n.useState)(!1),[et,en]=(0,n.useState)(!1),[es,er]=(0,n.useState)(null),ea=e.map(e=>e.student_id).filter(Boolean),{data:ei}=(0,s.useQuery)({queryKey:["session-invoices",k,ea],queryFn:async()=>{if(!P?.organization_id||0===ea.length)return[];let e=[];for(let t of ea){if(!t)continue;let n=await d.invoiceService.getAll(P.organization_id,{studentId:t});e.push(...n)}return e},enabled:!!P?.organization_id&&ea.length>0}),{data:el}=(0,s.useQuery)({queryKey:["organization",P?.organization_id],queryFn:async()=>{if(!P?.organization_id)return null;let{data:e,error:t}=await U.from("organizations").select("*").eq("id",P.organization_id).single();if(t)throw t;return e},enabled:!!P?.organization_id}),ed=R||el,{data:eo}=(0,s.useQuery)({queryKey:["academic-year",P?.organization_id],queryFn:async()=>{if(!P?.organization_id)return null;let{data:e,error:t}=await U.from("academic_years").select("*").eq("organization_id",P.organization_id).eq("is_current",!0).maybeSingle();return t?(console.warn("Erreur lors de la récupération de l'année académique:",t),null):e||null},enabled:!!P?.organization_id}),{data:ec}=(0,s.useQuery)({queryKey:["invoice-template",P?.organization_id],queryFn:async()=>{if(!P?.organization_id)return null;let e=await c.documentTemplateService.getTemplatesByType("facture",P.organization_id);return e.length>0?e[0]:null},enabled:!!P?.organization_id}),{data:eu}=(0,s.useQuery)({queryKey:["quote-template",P?.organization_id],queryFn:async()=>{if(!P?.organization_id)return null;let e=await c.documentTemplateService.getTemplatesByType("devis",P.organization_id);return e.length>0?e[0]:null},enabled:!!P?.organization_id}),{data:em,refetch:ep}=(0,s.useQuery)({queryKey:["session-charges",k],queryFn:async()=>k?u.sessionChargesService.getBySession(k):[],enabled:!!k}),{data:ex}=(0,s.useQuery)({queryKey:["session-charges-summary",k],queryFn:async()=>k?u.sessionChargesService.getSessionSummary(k):null,enabled:!!k}),{data:eh}=(0,s.useQuery)({queryKey:["charge-categories",P?.organization_id],queryFn:async()=>{if(!P?.organization_id)return[];let e=await u.sessionChargesService.getCategories(P.organization_id);return 0===e.length?(await u.sessionChargesService.initDefaultCategories(P.organization_id),u.sessionChargesService.getCategories(P.organization_id)):e},enabled:!!P?.organization_id}),[eg,ey]=(0,n.useState)({description:"",amount:"",currency:"EUR",charge_date:new Date().toISOString().split("T")[0],category_id:"",payment_method:"",payment_status:"pending",vendor:"",vendor_invoice_number:"",vendor_invoice_date:"",notes:""}),[ef,ev]=(0,n.useState)({amount:"",currency:"EUR",payment_method:"cash",transaction_id:"",notes:""}),[eb,ej]=(0,n.useState)({amount:"",tax_amount:"0",currency:"EUR",issue_date:new Date().toISOString().split("T")[0],due_date:new Date(Date.now()+2592e6).toISOString().split("T")[0],notes:""}),e_=async(e,t)=>{if(!ed||!e)return void M({type:"error",title:"Erreur",description:"Données manquantes pour la génération du document."});let n="invoice"===t?ec:eu;if(!n)return void M({type:"error",title:"Erreur",description:`Aucun mod\xe8le de ${"invoice"===t?"facture":"devis"} trouv\xe9.`});J(e.id);try{let s=e.students,r=(0,p.extractDocumentVariables)({student:s,organization:ed,session:F,invoice:e,academicYear:eo,language:"fr",issueDate:e.issue_date}),a=await (0,m.generateHTML)(n,r,void 0,P?.organization_id||void 0),i=`${"invoice"===t?"facture":"devis"}_${e.invoice_number}.pdf`,l=document.createElement("div");l.style.position="absolute",l.style.left="-9999px",l.style.top="0",l.style.width="794px",l.style.minHeight="1123px",l.style.backgroundColor="#ffffff",l.style.overflow="visible",l.style.fontFamily="Arial, sans-serif",document.body.appendChild(l),l.innerHTML=new DOMParser().parseFromString(a.html,"text/html").body.innerHTML;let d=l.querySelector(".document-container")||l.querySelector('[id$="-document"]')||l.firstElementChild;d&&d instanceof HTMLElement||(d=l);let o=`temp-pdf-${t}-${e.id}-${Date.now()}`;if(d instanceof HTMLElement&&(d.id=o,d.style.width||(d.style.width="794px"),d.style.minHeight||(d.style.minHeight="1123px"),d.style.backgroundColor="#ffffff"),await new Promise(e=>setTimeout(e,1e3)),d instanceof HTMLElement){let e=d.getBoundingClientRect();(0===e.width||0===e.height)&&(d=l,l.id=o,l.style.width="794px",l.style.minHeight="1123px")}await (0,x.generatePDFFromHTML)(o,i),M({type:"success",title:"Document téléchargé",description:`Le ${"invoice"===t?"facture":"devis"} a \xe9t\xe9 g\xe9n\xe9r\xe9 et t\xe9l\xe9charg\xe9 avec succ\xe8s.`})}catch(e){console.error("Erreur lors de la génération du document:",e),M({type:"error",title:"Erreur",description:"Une erreur est survenue lors de la génération du document."})}finally{J(null),document.querySelectorAll(`[id^="temp-pdf-${t}-"]`).forEach(e=>{e.parentNode===document.body&&document.body.removeChild(e)})}},eN=(0,r.useMutation)({mutationFn:async()=>{if(!P?.organization_id)throw Error("Données manquantes");if(!H)throw Error("Veuillez sélectionner un étudiant depuis la liste ci-dessus.");let t=e.find(e=>e.id===H);if(!t||!t.students)throw Error("Inscription non trouvée");let n=parseFloat(eb.amount)||0,s=parseFloat(eb.tax_amount)||0;return d.invoiceService.create({organization_id:P.organization_id,student_id:t.student_id,invoice_number:"",type:"tuition",document_type:"invoice",issue_date:eb.issue_date,due_date:eb.due_date,amount:n,tax_amount:s,total_amount:n+s,currency:eb.currency,status:"sent",notes:eb.notes})},onSuccess:()=>{M({type:"success",title:"Facture créée",description:"La facture a été créée avec succès."}),K(!1),ej({amount:"",tax_amount:"0",currency:"EUR",issue_date:new Date().toISOString().split("T")[0],due_date:new Date(Date.now()+2592e6).toISOString().split("T")[0],notes:""}),B.invalidateQueries({queryKey:["session-invoices",k]})},onError:e=>{M({type:"error",title:"Erreur",description:e?.message||"Erreur lors de la création de la facture."})}}),eC=(0,r.useMutation)({mutationFn:async()=>{if(!P?.organization_id)throw Error("Données manquantes");if(!H)throw Error("Veuillez sélectionner un étudiant depuis la liste ci-dessus.");let t=e.find(e=>e.id===H);if(!t||!t.students)throw Error("Inscription non trouvée");let n=parseFloat(eb.amount)||0,s=parseFloat(eb.tax_amount)||0;return d.invoiceService.create({organization_id:P.organization_id,student_id:t.student_id,invoice_number:"",type:"tuition",document_type:"quote",issue_date:eb.issue_date,due_date:eb.due_date,amount:n,tax_amount:s,total_amount:n+s,currency:eb.currency,status:"draft",notes:eb.notes})},onSuccess:()=>{M({type:"success",title:"Devis créé",description:"Le devis a été créé avec succès."}),Q(!1),ej({amount:"",tax_amount:"0",currency:"EUR",issue_date:new Date().toISOString().split("T")[0],due_date:new Date(Date.now()+2592e6).toISOString().split("T")[0],notes:""}),B.invalidateQueries({queryKey:["session-invoices",k]})},onError:e=>{M({type:"error",title:"Erreur",description:e?.message||"Erreur lors de la création du devis."})}}),ew=(0,r.useMutation)({mutationFn:async()=>{if(!H||!P?.organization_id)throw Error("Données manquantes");let t=e.find(e=>e.id===H);if(!t||!t.students)throw Error("Inscription non trouvée");let n=parseFloat(ef.amount);if(isNaN(n)||n<=0)throw Error("Montant de paiement invalide");let s=ei?.find(e=>e.student_id===t.student_id&&"invoice"===e.document_type);return o.paymentService.create({organization_id:P.organization_id,invoice_id:s?.id||null,student_id:t.student_id,amount:n,currency:ef.currency,payment_method:ef.payment_method,payment_provider:"card"===ef.payment_method||"sepa"===ef.payment_method?"stripe":null,transaction_id:ef.transaction_id||null,status:"cash"===ef.payment_method?"completed":"pending",paid_at:"cash"===ef.payment_method?new Date().toISOString():null,metadata:{notes:ef.notes}})},onSuccess:()=>{M({type:"success",title:"Paiement enregistré",description:"Le paiement a été enregistré avec succès."}),I(!1),ev({amount:"",currency:"EUR",payment_method:"cash",transaction_id:"",notes:""}),B.invalidateQueries({queryKey:["payments"]})},onError:e=>{M({type:"error",title:"Erreur",description:e?.message||"Erreur lors de l'enregistrement du paiement."})}}),eE=e.reduce((e,t)=>e+Number(t.total_amount||0),0),eS=e.reduce((e,t)=>e+Number(t.paid_amount||0),0),ez=e.reduce((e,t)=>e+(Number(t.total_amount||0)-Number(t.paid_amount||0)),0),eD=T.reduce((e,t)=>e+Number(t.amount||0),0),eq=e.filter(e=>Number(e.total_amount||0)-Number(e.paid_amount||0)>0),eT=(0,r.useMutation)({mutationFn:async()=>{if(!P?.organization_id||!k)throw Error("Données manquantes");if(!eg.description||!eg.amount)throw Error("La description et le montant sont requis");return u.sessionChargesService.create(P.organization_id,k,{description:eg.description,amount:parseFloat(eg.amount),currency:eg.currency,charge_date:eg.charge_date,category_id:eg.category_id||null,payment_method:eg.payment_method||null,payment_status:eg.payment_status,paid_at:"paid"===eg.payment_status?new Date().toISOString():null,vendor:eg.vendor||null,vendor_invoice_number:eg.vendor_invoice_number||null,vendor_invoice_date:eg.vendor_invoice_date||null,notes:eg.notes||null})},onSuccess:()=>{M({type:"success",title:"Charge créée",description:"La charge a été créée avec succès."}),en(!1),ey({description:"",amount:"",currency:"EUR",charge_date:new Date().toISOString().split("T")[0],category_id:"",payment_method:"",payment_status:"pending",vendor:"",vendor_invoice_number:"",vendor_invoice_date:"",notes:""}),ep(),B.invalidateQueries({queryKey:["session-charges-summary",k]})},onError:e=>{M({type:"error",title:"Erreur",description:e?.message||"Erreur lors de la création de la charge."})}}),ek=(0,r.useMutation)({mutationFn:async()=>{if(!es)throw Error("Aucune charge sélectionnée");if(!eg.description||!eg.amount)throw Error("La description et le montant sont requis");return u.sessionChargesService.update(es.id,{description:eg.description,amount:parseFloat(eg.amount),currency:eg.currency,charge_date:eg.charge_date,category_id:eg.category_id||null,payment_method:eg.payment_method||null,payment_status:eg.payment_status,paid_at:"paid"===eg.payment_status?es.paid_at||new Date().toISOString():null,vendor:eg.vendor||null,vendor_invoice_number:eg.vendor_invoice_number||null,vendor_invoice_date:eg.vendor_invoice_date||null,notes:eg.notes||null})},onSuccess:()=>{M({type:"success",title:"Charge mise à jour",description:"La charge a été mise à jour avec succès."}),en(!1),er(null),ey({description:"",amount:"",currency:"EUR",charge_date:new Date().toISOString().split("T")[0],category_id:"",payment_method:"",payment_status:"pending",vendor:"",vendor_invoice_number:"",vendor_invoice_date:"",notes:""}),ep(),B.invalidateQueries({queryKey:["session-charges-summary",k]})},onError:e=>{M({type:"error",title:"Erreur",description:e?.message||"Erreur lors de la mise à jour de la charge."})}}),eF=(0,r.useMutation)({mutationFn:async e=>{await u.sessionChargesService.delete(e)},onSuccess:()=>{M({type:"success",title:"Charge supprimée",description:"La charge a été supprimée avec succès."}),ep(),B.invalidateQueries({queryKey:["session-charges-summary",k]})},onError:e=>{M({type:"error",title:"Erreur",description:e?.message||"Erreur lors de la suppression de la charge."})}}),eR=()=>{er(null),ey({description:"",amount:"",currency:"EUR",charge_date:new Date().toISOString().split("T")[0],category_id:"",payment_method:"",payment_status:"pending",vendor:"",vendor_invoice_number:"",vendor_invoice_date:"",notes:""}),en(!0)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)(h.Card,{children:[(0,t.jsx)(h.CardHeader,{className:"pb-3",children:(0,t.jsx)(h.CardTitle,{className:"text-base font-medium",children:"Revenu total"})}),(0,t.jsxs)(h.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-brand-blue",children:(0,y.formatCurrency)(eE,"EUR")}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[e.length," inscription",e.length>1?"s":""]})]})]}),(0,t.jsxs)(h.Card,{children:[(0,t.jsx)(h.CardHeader,{className:"pb-3",children:(0,t.jsx)(h.CardTitle,{className:"text-base font-medium",children:"Montant payé"})}),(0,t.jsxs)(h.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:(0,y.formatCurrency)(eS,"EUR")}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[(0,y.formatCurrency)(eD,"EUR")," via paiements"]})]})]}),(0,t.jsxs)(h.Card,{children:[(0,t.jsx)(h.CardHeader,{className:"pb-3",children:(0,t.jsx)(h.CardTitle,{className:"text-base font-medium",children:"Reste à payer"})}),(0,t.jsxs)(h.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:(0,y.formatCurrency)(ez,"EUR")}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[eq.length," inscription",eq.length>1?"s":""," avec solde"]})]})]}),(0,t.jsxs)(h.Card,{children:[(0,t.jsx)(h.CardHeader,{className:"pb-3",children:(0,t.jsx)(h.CardTitle,{className:"text-base font-medium",children:"Charges totales"})}),(0,t.jsxs)(h.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-red-600",children:(0,y.formatCurrency)(ex?.total_amount||0,"EUR")}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[ex?.charge_count||0," charge",(ex?.charge_count||0)>1?"s":""]})]})]})]}),(0,t.jsxs)(h.Card,{children:[(0,t.jsx)(h.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(h.CardTitle,{children:"Charges de la session"}),ex&&ex.charge_count>0&&(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:["(",(0,y.formatCurrency)(ex.total_amount,"EUR"),")"]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:eR,children:[(0,t.jsx)(_.Plus,{className:"mr-2 h-4 w-4"}),"Nouvelle charge"]}),(0,t.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>ee(!Z),children:Z?(0,t.jsx)(S.ChevronUp,{className:"h-4 w-4"}):(0,t.jsx)(E.ChevronDown,{className:"h-4 w-4"})})]})]})}),Z&&(0,t.jsx)(h.CardContent,{children:em&&em.length>0?(0,t.jsxs)("div",{className:"space-y-3",children:[em.map(e=>(0,t.jsx)("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,t.jsx)("h4",{className:"font-medium",children:e.description}),e.charge_categories&&(0,t.jsx)("span",{className:"text-xs px-2 py-1 bg-blue-50 text-blue-700 rounded",children:e.charge_categories.name})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm text-muted-foreground",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Montant:"})," ",(0,t.jsx)("span",{className:"text-red-600 font-bold",children:(0,y.formatCurrency)(Number(e.amount),e.currency)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Date:"})," ",new Date(e.charge_date).toLocaleDateString("fr-FR")]}),e.vendor&&(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium",children:"Fournisseur:"})," ",e.vendor]}),(0,t.jsx)("div",{children:(0,t.jsx)("span",{className:`px-2 py-1 rounded text-xs ${"paid"===e.payment_status?"bg-green-100 text-green-700":"pending"===e.payment_status?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:"paid"===e.payment_status?"Payé":"pending"===e.payment_status?"En attente":"Annulé"})})]}),e.notes&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:e.notes})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,t.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>{er(e),ey({description:e.description,amount:String(e.amount),currency:e.currency,charge_date:e.charge_date,category_id:e.category_id||"",payment_method:e.payment_method||"",payment_status:e.payment_status,vendor:e.vendor||"",vendor_invoice_number:e.vendor_invoice_number||"",vendor_invoice_date:e.vendor_invoice_date||"",notes:e.notes||""}),en(!0)},children:(0,t.jsx)(D.Edit,{className:"h-4 w-4"})}),(0,t.jsx)(g.Button,{variant:"ghost",size:"icon",onClick:()=>{confirm("Êtes-vous sûr de vouloir supprimer cette charge ?")&&eF.mutate(e.id)},children:(0,t.jsx)(z.Trash2,{className:"h-4 w-4 text-destructive"})})]})]})},e.id)),ex&&(0,t.jsxs)("div",{className:"mt-4 pt-4 border-t grid grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Total"}),(0,t.jsx)("p",{className:"text-lg font-bold text-red-600",children:(0,y.formatCurrency)(ex.total_amount,"EUR")})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Payé"}),(0,t.jsx)("p",{className:"text-lg font-bold text-green-600",children:(0,y.formatCurrency)(ex.paid_amount,"EUR")})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"En attente"}),(0,t.jsx)("p",{className:"text-lg font-bold text-yellow-600",children:(0,y.formatCurrency)(ex.pending_amount,"EUR")})]})]})]}):(0,t.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,t.jsx)(q.TrendingDown,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"Aucune charge enregistrée pour cette session."}),(0,t.jsxs)(g.Button,{variant:"outline",size:"sm",className:"mt-4",onClick:eR,children:[(0,t.jsx)(_.Plus,{className:"mr-2 h-4 w-4"}),"Ajouter une charge"]})]})})]}),(0,t.jsxs)(h.Card,{children:[(0,t.jsx)(h.CardHeader,{children:(0,t.jsx)(h.CardTitle,{children:"Répartition par statut de paiement"})}),(0,t.jsx)(h.CardContent,{children:(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:e.filter(e=>"pending"===e.payment_status).length}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"En attente"})]}),(0,t.jsxs)("div",{className:"text-center p-4 bg-brand-cyan-ghost rounded-lg",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-brand-cyan",children:e.filter(e=>"partial"===e.payment_status).length}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Partiel"})]}),(0,t.jsxs)("div",{className:"text-center p-4 bg-brand-blue-ghost rounded-lg",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-brand-blue",children:e.filter(e=>"paid"===e.payment_status).length}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Payé"})]}),(0,t.jsxs)("div",{className:"text-center p-4 bg-red-50 rounded-lg",children:[(0,t.jsx)("p",{className:"text-2xl font-bold text-red-600",children:e.filter(e=>"overdue"===e.payment_status).length}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"En retard"})]})]})})]}),(0,t.jsxs)(h.Card,{children:[(0,t.jsx)(h.CardHeader,{children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)(h.CardTitle,{children:"Détails des inscriptions"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>{A(null),Q(!0),K(!1)},children:[(0,t.jsx)(_.Plus,{className:"mr-2 h-4 w-4"}),"Nouveau devis"]}),(0,t.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>{A(null),K(!0),Q(!1)},children:[(0,t.jsx)(_.Plus,{className:"mr-2 h-4 w-4"}),"Nouvelle facture"]})]})]})}),(0,t.jsx)(h.CardContent,{children:(0,t.jsx)("div",{className:"space-y-3",children:0===e.length?(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center py-8",children:"Aucune inscription pour le moment"}):e.map(e=>{let n,s=e.students;if(!s)return null;let r=Number(e.total_amount||0),a=Number(e.paid_amount||0),i=r-a,l=e.student_id?(n=e.student_id,ei?.filter(e=>e.student_id===n)||[]):[],d=l.filter(e=>"invoice"===e.document_type),o=l.filter(e=>"quote"===e.document_type);return(0,t.jsxs)("div",{className:"border rounded-lg p-4 hover:bg-gray-50 space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("p",{className:"font-medium",children:[s.first_name," ",s.last_name]}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:s.student_number})]}),(0,t.jsxs)("div",{className:"text-right space-y-1",children:[(0,t.jsxs)("p",{className:"text-sm",children:["Total: ",(0,t.jsx)("span",{className:"font-medium",children:(0,y.formatCurrency)(r,"EUR")})]}),(0,t.jsxs)("p",{className:"text-sm",children:["Payé: ",(0,t.jsx)("span",{className:"font-medium text-blue-600",children:(0,y.formatCurrency)(a,"EUR")})]}),i>0&&(0,t.jsxs)("p",{className:"text-sm",children:["Reste: ",(0,t.jsx)("span",{className:"font-medium text-orange-600",children:(0,y.formatCurrency)(i,"EUR")})]}),(0,t.jsx)("span",{className:`text-xs px-2 py-1 rounded inline-block mt-2 ${"paid"===e.payment_status?"bg-brand-blue-ghost text-brand-blue":"partial"===e.payment_status?"bg-brand-cyan-ghost text-brand-cyan":"overdue"===e.payment_status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"}`,children:"paid"===e.payment_status?"Payé":"partial"===e.payment_status?"Partiel":"overdue"===e.payment_status?"En retard":"En attente"})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 pt-2 border-t",children:[(0,t.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>{A(e.id),ej({...eb,amount:e.total_amount?String(e.total_amount):""}),Q(!0),K(!1)},children:[(0,t.jsx)(j.FileText,{className:"mr-2 h-3 w-3"}),"Créer devis"]}),(0,t.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>{A(e.id),ej({...eb,amount:e.total_amount?String(e.total_amount):""}),K(!0),Q(!1)},children:[(0,t.jsx)(N.Receipt,{className:"mr-2 h-3 w-3"}),"Créer facture"]}),(0,t.jsxs)(g.Button,{variant:"outline",size:"sm",onClick:()=>{A(e.id),I(!0)},children:[(0,t.jsx)(C.DollarSign,{className:"mr-2 h-3 w-3"}),"Saisir paiement"]})]}),(d.length>0||o.length>0)&&(0,t.jsxs)("div",{className:"pt-2 border-t space-y-2",children:[o.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Devis :"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:o.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:e.invoice_number}),(0,t.jsx)(g.Button,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>e_(e,"quote"),disabled:G===e.id,children:G===e.id?"...":(0,t.jsx)(b.Download,{className:"h-3 w-3"})})]},e.id))})]}),d.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Factures :"}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:d.map(e=>(0,t.jsxs)("div",{className:"flex items-center gap-2 text-xs",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:e.invoice_number}),(0,t.jsx)(g.Button,{variant:"ghost",size:"sm",className:"h-6 px-2",onClick:()=>e_(e,"invoice"),disabled:G===e.id,children:G===e.id?"...":(0,t.jsx)(b.Download,{className:"h-3 w-3"})}),(0,t.jsx)(v.default,{href:`/dashboard/payments/${e.id}`,children:(0,t.jsx)(g.Button,{variant:"ghost",size:"sm",className:"h-6 px-2",children:(0,t.jsx)(w.Eye,{className:"h-3 w-3"})})})]},e.id))})]})]})]},e.id)})})})]}),T.length>0&&(0,t.jsxs)(h.Card,{children:[(0,t.jsx)(h.CardHeader,{children:(0,t.jsx)(h.CardTitle,{children:"Paiements récents"})}),(0,t.jsx)(h.CardContent,{children:(0,t.jsx)("div",{className:"space-y-3",children:T.slice(0,10).map(e=>{let n=e.students;return(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 border rounded-lg hover:bg-gray-50",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-medium",children:n?`${n.first_name} ${n.last_name}`:"Apprenant"}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:[e.paid_at&&new Date(e.paid_at).toLocaleDateString("fr-FR"),e.payment_method&&` • ${e.payment_method}`]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"font-bold text-lg text-brand-blue",children:(0,y.formatCurrency)(Number(e.amount||0),e.currency||"EUR")}),(0,t.jsx)("p",{className:`text-xs px-2 py-1 rounded inline-block mt-1 ${"completed"===e.status?"bg-brand-blue-ghost text-brand-blue":"pending"===e.status?"bg-brand-cyan-ghost text-brand-cyan":"bg-red-100 text-red-800"}`,children:"completed"===e.status?"Complété":"pending"===e.status?"En attente":"Échoué"})]})]},e.id)})})})]}),L&&H&&(0,t.jsxs)(h.Card,{children:[(0,t.jsx)(h.CardHeader,{children:(0,t.jsx)(h.CardTitle,{children:"Enregistrer un paiement"})}),(0,t.jsx)(h.CardContent,{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),ew.mutate()},className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant *"}),(0,t.jsx)("input",{type:"number",required:!0,step:"0.01",min:"0.01",value:ef.amount,onChange:e=>ev({...ef,amount:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Méthode de paiement *"}),(0,t.jsxs)("select",{required:!0,value:ef.payment_method,onChange:e=>ev({...ef,payment_method:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,t.jsx)("option",{value:"cash",children:"Espèces"}),(0,t.jsx)("option",{value:"card",children:"Carte bancaire"}),(0,t.jsx)("option",{value:"bank_transfer",children:"Virement bancaire"}),(0,t.jsx)("option",{value:"sepa",children:"Virement SEPA"})]})]}),"cash"!==ef.payment_method&&(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"ID de transaction"}),(0,t.jsx)("input",{type:"text",value:ef.transaction_id,onChange:e=>ev({...ef,transaction_id:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"ID de la transaction"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,t.jsx)("textarea",{value:ef.notes,onChange:e=>ev({...ef,notes:e.target.value}),rows:2,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Notes supplémentaires..."})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(g.Button,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{I(!1),A(null)},children:"Annuler"}),(0,t.jsx)(g.Button,{type:"submit",className:"flex-1",disabled:ew.isPending,children:ew.isPending?"Enregistrement...":"Enregistrer"})]})]})})]}),O&&(0,t.jsxs)(h.Card,{children:[(0,t.jsx)(h.CardHeader,{children:(0,t.jsx)(h.CardTitle,{children:"Créer une facture"})}),(0,t.jsxs)(h.CardContent,{children:[!H&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-yellow-800",children:"⚠️ Veuillez sélectionner un étudiant depuis la liste ci-dessus avant de créer la facture."})}),H&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,t.jsxs)("p",{className:"text-sm text-blue-800",children:["Étudiant sélectionné : ",e.find(e=>e.id===H)?.students?.first_name," ",e.find(e=>e.id===H)?.students?.last_name]})}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),eN.mutate()},className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant HT *"}),(0,t.jsx)("input",{type:"number",required:!0,step:"0.01",min:"0.01",value:eb.amount,onChange:e=>ej({...eb,amount:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"TVA"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",value:eb.tax_amount,onChange:e=>ej({...eb,tax_amount:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date d'émission *"}),(0,t.jsx)("input",{type:"date",required:!0,value:eb.issue_date,onChange:e=>ej({...eb,issue_date:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date d'échéance *"}),(0,t.jsx)("input",{type:"date",required:!0,value:eb.due_date,onChange:e=>ej({...eb,due_date:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,t.jsx)("textarea",{value:eb.notes,onChange:e=>ej({...eb,notes:e.target.value}),rows:2,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Notes supplémentaires..."})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(g.Button,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{K(!1),A(null)},children:"Annuler"}),(0,t.jsx)(g.Button,{type:"submit",className:"flex-1",disabled:eN.isPending||!H,children:eN.isPending?"Création...":"Créer la facture"})]})]})]})]}),$&&(0,t.jsxs)(h.Card,{children:[(0,t.jsx)(h.CardHeader,{children:(0,t.jsx)(h.CardTitle,{children:"Créer un devis"})}),(0,t.jsxs)(h.CardContent,{children:[!H&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-yellow-800",children:"⚠️ Veuillez sélectionner un étudiant depuis la liste ci-dessus avant de créer le devis."})}),H&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:(0,t.jsxs)("p",{className:"text-sm text-blue-800",children:["Étudiant sélectionné : ",e.find(e=>e.id===H)?.students?.first_name," ",e.find(e=>e.id===H)?.students?.last_name]})}),(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),eC.mutate()},className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant HT *"}),(0,t.jsx)("input",{type:"number",required:!0,step:"0.01",min:"0.01",value:eb.amount,onChange:e=>ej({...eb,amount:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"TVA"}),(0,t.jsx)("input",{type:"number",step:"0.01",min:"0",value:eb.tax_amount,onChange:e=>ej({...eb,tax_amount:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date d'émission *"}),(0,t.jsx)("input",{type:"date",required:!0,value:eb.issue_date,onChange:e=>ej({...eb,issue_date:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date d'échéance *"}),(0,t.jsx)("input",{type:"date",required:!0,value:eb.due_date,onChange:e=>ej({...eb,due_date:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,t.jsx)("textarea",{value:eb.notes,onChange:e=>ej({...eb,notes:e.target.value}),rows:2,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Notes supplémentaires..."})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(g.Button,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{Q(!1),A(null)},children:"Annuler"}),(0,t.jsx)(g.Button,{type:"submit",className:"flex-1",disabled:eC.isPending||!H,children:eC.isPending?"Création...":"Créer le devis"})]})]})]})]}),et&&(0,t.jsxs)(h.Card,{children:[(0,t.jsx)(h.CardHeader,{children:(0,t.jsx)(h.CardTitle,{children:es?"Modifier la charge":"Nouvelle charge"})}),(0,t.jsx)(h.CardContent,{children:(0,t.jsxs)("form",{onSubmit:e=>{e.preventDefault(),es?ek.mutate():eT.mutate()},className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Description *"}),(0,t.jsx)("input",{type:"text",required:!0,value:eg.description,onChange:e=>ey({...eg,description:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Ex: Location de salle pour la formation"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Montant *"}),(0,t.jsx)("input",{type:"number",required:!0,step:"0.01",min:"0.01",value:eg.amount,onChange:e=>ey({...eg,amount:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"0.00"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Devise"}),(0,t.jsxs)("select",{value:eg.currency,onChange:e=>ey({...eg,currency:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,t.jsx)("option",{value:"EUR",children:"EUR"}),(0,t.jsx)("option",{value:"USD",children:"USD"}),(0,t.jsx)("option",{value:"XOF",children:"XOF"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date *"}),(0,t.jsx)("input",{type:"date",required:!0,value:eg.charge_date,onChange:e=>ey({...eg,charge_date:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Catégorie"}),(0,t.jsxs)("select",{value:eg.category_id,onChange:e=>ey({...eg,category_id:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"Sélectionner une catégorie"}),eh?.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Méthode de paiement"}),(0,t.jsxs)("select",{value:eg.payment_method,onChange:e=>ey({...eg,payment_method:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,t.jsx)("option",{value:"",children:"Non spécifié"}),(0,t.jsx)("option",{value:"cash",children:"Espèces"}),(0,t.jsx)("option",{value:"bank_transfer",children:"Virement bancaire"}),(0,t.jsx)("option",{value:"card",children:"Carte bancaire"}),(0,t.jsx)("option",{value:"mobile_money",children:"Mobile Money"}),(0,t.jsx)("option",{value:"check",children:"Chèque"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Statut de paiement"}),(0,t.jsxs)("select",{value:eg.payment_status,onChange:e=>ey({...eg,payment_status:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",children:[(0,t.jsx)("option",{value:"pending",children:"En attente"}),(0,t.jsx)("option",{value:"paid",children:"Payé"}),(0,t.jsx)("option",{value:"cancelled",children:"Annulé"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Fournisseur"}),(0,t.jsx)("input",{type:"text",value:eg.vendor,onChange:e=>ey({...eg,vendor:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Nom du fournisseur/prestataire"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"N° facture fournisseur"}),(0,t.jsx)("input",{type:"text",value:eg.vendor_invoice_number,onChange:e=>ey({...eg,vendor_invoice_number:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"N° de facture"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Date facture fournisseur"}),(0,t.jsx)("input",{type:"date",value:eg.vendor_invoice_date,onChange:e=>ey({...eg,vendor_invoice_date:e.target.value}),className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),(0,t.jsx)("textarea",{value:eg.notes,onChange:e=>ey({...eg,notes:e.target.value}),rows:3,className:"w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Notes supplémentaires..."})]}),(0,t.jsxs)("div",{className:"flex space-x-2",children:[(0,t.jsx)(g.Button,{type:"button",variant:"outline",className:"flex-1",onClick:()=>{en(!1),er(null)},children:"Annuler"}),(0,t.jsx)(g.Button,{type:"submit",className:"flex-1",disabled:eT.isPending||ek.isPending,children:eT.isPending||ek.isPending?"Enregistrement...":es?"Mettre à jour":"Créer la charge"})]})]})})]})]})}e.s(["GestionFinances",()=>T])}]);